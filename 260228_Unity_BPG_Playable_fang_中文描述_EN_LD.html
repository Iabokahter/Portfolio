<!doctype html><html><head><meta charset="utf-8"><title>Cocos Creator | hello</title><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="format-detection" content="telephone=no"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="msapplication-tap-highlight" content="no"><meta name="full-screen" content="yes"><meta name="x5-fullscreen" content="true"><meta name="360-fullscreen" content="true"><meta name="screen-orientation" content=""><meta name="x5-orientation" content=""><meta name="x5-page-mode" content="app"><style>html{-ms-touch-action:none}body,canvas,div{display:block;outline:0;-webkit-tap-highlight-color:transparent;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;-khtml-user-select:none;-webkit-tap-highlight-color:transparent}input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}body{position:absolute;top:0;left:0;width:100%;height:100%;padding:0;border:0;margin:0;cursor:default;color:#888;background-color:#333;text-align:center;font-family:Helvetica,Verdana,Arial,sans-serif;display:flex;flex-direction:column;overflow:hidden}#Cocos2dGameContainer{position:absolute;margin:0;left:0;top:0;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:center;-webkit-box-pack:center}canvas{background-color:rgba(0,0,0,0)}a:link,a:visited{color:#666}a:active,a:hover{color:#666}p.header{font-size:small}p.footer{font-size:x-small}#splash{position:absolute;top:0;left:0;width:100%;height:100%;background:#171717;background-size:45%}.progress-bar{position:absolute;left:27.5%;top:80%;height:3px;padding:2px;width:45%;border-radius:7px;box-shadow:0 1px 5px #000 inset,0 1px 0 #444}.progress-bar span{display:block;height:100%;border-radius:3px;transition:width .4s ease-in-out;background-color:#3dc5de}.stripes span{background-size:30px 30px;background-image:linear-gradient(135deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);animation:animate-stripes 1s linear infinite}@keyframes animate-stripes{0%{background-position:0 0}100%{background-position:60px 0}}</style></head><body><script>function getBorwserInfo_NBT(){return{userAgent:navigator.userAgent.toLowerCase(),isAndroid:!!navigator.userAgent.match(/android/gi),isIOS:!!navigator.userAgent.match(/iphone|ipod|ipad/gi),isIpad:!!navigator.userAgent.match(/ipad/gi),isWeixin:!!navigator.userAgent.match(/MicroMessenger/gi)}}function isIOS_NBT(){return getBorwserInfo_NBT().isIOS}function isAndroid_NBT(){return getBorwserInfo_NBT().isAndroid}const channel_NBT=2,appleStore_NBT="https://apps.apple.com/jo/app/party-tycoon-business-sim/id6737510782",googleStore_NBT="https://play.google.com/store/apps/details?id=com.aqal.partytycoon";var Cocos2Playable={callToAction:()=>{1===channel_NBT||2===channel_NBT||9===channel_NBT?isAndroid_NBT()?mraid.open(googleStore_NBT):mraid.open(appleStore_NBT):3===channel_NBT?window.openAppStore():4===channel_NBT||10===channel_NBT?FbPlayableAd.onCTAClick():5===channel_NBT?dapi.openStoreUrl():6===channel_NBT?parent.postMessage("download","*"):7===channel_NBT?ExitApi.exit():8===channel_NBT?window.install&&window.install():11===channel_NBT?window.playableSDK&&window.playableSDK.openAppStore():12===channel_NBT?window._gdtUnSdk&&window._gdtUnSdk.playAble.onClick():13===channel_NBT?window.playableSDK&&window.playableSDK.openAppStore():14===channel_NBT&&window.BGY_MRAID&&window.BGY_MRAID.open()},gameReady:()=>{8===channel_NBT?window.gameReady&&window.gameReady():13===channel_NBT?window.playableSDK&&window.playableSDK.sendEvent(window.playableSDK.CONSTANTS.AD_TRY_PLAY_GAME_START):14===channel_NBT&&window.BGY_MRAID&&window.BGY_MRAID.gameReady()},gameComplete:()=>{6===channel_NBT?parent.postMessage("complete","*"):8===channel_NBT?window.gameEnd&&window.gameEnd():13===channel_NBT?window.playableSDK&&window.playableSDK.sendEvent(window.playableSDK.CONSTANTS.AD_TRY_PLAY_GAME_END):14===channel_NBT&&window.BGY_MRAID&&window.BGY_MRAID.gameEnd()}};</script><canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="0"></canvas><div id="splash"><div class="progress-bar stripes"><span style="width:0%"></span></div></div><script>window.res={"res/import/03/03ab6c522.json":'{"type":"cc.Texture2D","data":"0,9729,9729,33071,33071,0,0,1|0,9729,9729,33071,33071,1,0,0|0,9729,9729,33071,33071,0,0,1|0,9729,9729,33071,33071,0,0,1|0,9729,9729,33071,33071,0,0,1|0,9729,9729,33071,33071,0,0,1|0,9729,9729,33071,33071,0,0,1"}',"res/import/03/03f133834.json":'[{"__type__":"cc.SpriteFrame","content":{"name":"default_btn_disabled","texture":"71VhFCTINJM6/Ky3oX9nBT","rect":[0,0,40,40],"offset":[0,0],"originalSize":[40,40],"capInsets":[12,12,12,12]}},[{"__type__":"cc.SceneAsset","_name":"helloworld","scene":{"__id__":1},"asyncLoadAssets":null},{"__type__":"cc.Scene","_name":"New Node","_children":[{"__id__":2}],"_anchorPoint":{"__type__":"cc.Vec2"},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[0,0,0,0,0,0,1,1,1,1]},"autoReleaseAssets":false},{"__type__":"cc.Node","_name":"Canvas","_parent":{"__id__":1},"_children":[{"__id__":3},{"__id__":4},{"__id__":5},{"__id__":6},{"__id__":7},{"__id__":10},{"__id__":13}],"_components":[{"__type__":"cc.Canvas","node":{"__id__":2}},{"__type__":"cc.Widget","node":{"__id__":2},"_alignFlags":45},{"__type__":"022bdTiycxNbptQlUdWs387","node":{"__id__":2}}],"_color":{"__type__":"cc.Color","r":252,"g":252,"b":252},"_contentSize":{"__type__":"cc.Size","width":960,"height":640},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[480,320,0,0,0,0,1,1,1,1]},"_id":"a286bbGknJLZpRpxROV6M94"},{"__type__":"cc.Node","_name":"Main Camera","_parent":{"__id__":2},"_components":[{"__type__":"cc.Camera","node":{"__id__":3},"_clearFlags":7,"_depth":-1}],"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[0,0,539.6710426885695,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"background","_parent":{"__id__":2},"_components":[{"__type__":"cc.Widget","node":{"__id__":4},"alignMode":0,"_alignFlags":45,"_originalWidth":200,"_originalHeight":150},{"__type__":"cc.Sprite","node":{"__id__":4},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_spriteFrame":{"__uuid__":"41D7kWhyFGY7q4NDlzkazn"},"_type":1,"_sizeMode":0}],"_color":{"__type__":"cc.Color","r":27,"g":38,"b":46},"_contentSize":{"__type__":"cc.Size","width":960,"height":640},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[0,0,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"cocos","_parent":{"__id__":2},"_components":[{"__type__":"cc.Sprite","node":{"__id__":5},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_spriteFrame":{"__uuid__":"31vIlawANFZqnzLlSuHBfc"}}],"_contentSize":{"__type__":"cc.Size","width":195,"height":270},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[0,50,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"label","_parent":{"__id__":2},"_components":[{"__type__":"cc.Label","node":{"__id__":6},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_useOriginalSize":false,"_string":"Hello, World!asdasd","_N$string":"Hello, World!asdasd","_fontSize":60,"_lineHeight":60,"_N$horizontalAlign":1,"_N$verticalAlign":1}],"_contentSize":{"__type__":"cc.Size","width":535.81,"height":75.6},"_anchorPoint":{"__type__":"cc.Vec2","x":1.13011633020353,"y":-0.4083202337539771},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[231,-180,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"New Button","_parent":{"__id__":2},"_children":[{"__id__":8}],"_components":[{"__type__":"cc.Button","node":{"__id__":7},"_N$transition":2,"transition":2,"_N$normalColor":{"__type__":"cc.Color","r":230,"g":230,"b":230},"_N$pressedColor":{"__type__":"cc.Color","r":200,"g":200,"b":200},"pressedColor":{"__type__":"cc.Color","r":200,"g":200,"b":200},"_N$disabledColor":{"__type__":"cc.Color","r":120,"g":120,"b":120,"a":200},"_N$normalSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_N$pressedSprite":{"__uuid__":"e97GVMl6JHh5Ml5qEDdSGa"},"pressedSprite":{"__uuid__":"e97GVMl6JHh5Ml5qEDdSGa"},"_N$hoverSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"hoverSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_N$disabledSprite":{"__uuid__":"29FYIk+N1GYaeWH/q1NxQO"},"_N$target":{"__id__":8}}],"_contentSize":{"__type__":"cc.Size","width":502,"height":181},"_anchorPoint":{"__type__":"cc.Vec2","x":1.3397438655084084,"y":0.921540881963172},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[201,-71,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"Background","_parent":{"__id__":7},"_children":[{"__id__":9}],"_components":[{"__type__":"cc.Sprite","node":{"__id__":8},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_spriteFrame":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_type":1,"_sizeMode":0},{"__type__":"cc.Widget","node":{"__id__":8},"alignMode":0,"_alignFlags":45,"_originalWidth":100,"_originalHeight":40}],"_contentSize":{"__type__":"cc.Size","width":502,"height":181},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[-421.551420485221,-76.29889963533412,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"Label","_parent":{"__id__":8},"_components":[{"__type__":"cc.Label","node":{"__id__":9},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_useOriginalSize":false,"_string":"CTA","_N$string":"CTA","_fontSize":126.40000000000009,"_enableWrapText":false,"_N$horizontalAlign":1,"_N$verticalAlign":1,"_N$overflow":1,"_N$cacheMode":1}],"_color":{"__type__":"cc.Color"},"_contentSize":{"__type__":"cc.Size","width":462,"height":162},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[0,0,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"New Button copy","_parent":{"__id__":2},"_children":[{"__id__":11}],"_components":[{"__type__":"cc.Button","node":{"__id__":10},"clickEvents":[{"__type__":"cc.ClickEvent","target":{"__id__":2},"_componentId":"022bdTiycxNbptQlUdWs387","handler":"CTA"}],"_N$transition":2,"transition":2,"_N$normalColor":{"__type__":"cc.Color","r":230,"g":230,"b":230},"_N$pressedColor":{"__type__":"cc.Color","r":200,"g":200,"b":200},"pressedColor":{"__type__":"cc.Color","r":200,"g":200,"b":200},"_N$disabledColor":{"__type__":"cc.Color","r":120,"g":120,"b":120,"a":200},"_N$normalSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_N$pressedSprite":{"__uuid__":"e97GVMl6JHh5Ml5qEDdSGa"},"pressedSprite":{"__uuid__":"e97GVMl6JHh5Ml5qEDdSGa"},"_N$hoverSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"hoverSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_N$disabledSprite":{"__uuid__":"29FYIk+N1GYaeWH/q1NxQO"},"_N$target":{"__id__":11}}],"_contentSize":{"__type__":"cc.Size","width":502,"height":181},"_anchorPoint":{"__type__":"cc.Vec2","x":1.3397438655084084,"y":0.921540881963172},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[201,-71,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"Background","_parent":{"__id__":10},"_children":[{"__id__":12}],"_components":[{"__type__":"cc.Sprite","node":{"__id__":11},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_spriteFrame":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_type":1,"_sizeMode":0},{"__type__":"cc.Widget","node":{"__id__":11},"alignMode":0,"_alignFlags":45,"_originalWidth":100,"_originalHeight":40}],"_contentSize":{"__type__":"cc.Size","width":502,"height":181},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[-421.551420485221,-76.29889963533412,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"Label","_parent":{"__id__":11},"_components":[{"__type__":"cc.Label","node":{"__id__":12},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_useOriginalSize":false,"_string":"CTA","_N$string":"CTA","_fontSize":126.40000000000009,"_enableWrapText":false,"_N$horizontalAlign":1,"_N$verticalAlign":1,"_N$overflow":1,"_N$cacheMode":1}],"_color":{"__type__":"cc.Color"},"_contentSize":{"__type__":"cc.Size","width":462,"height":162},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[0,0,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"New Button copy","_parent":{"__id__":2},"_children":[{"__id__":14}],"_components":[{"__type__":"cc.Button","node":{"__id__":13},"clickEvents":[{"__type__":"cc.ClickEvent","target":{"__id__":2},"_componentId":"022bdTiycxNbptQlUdWs387","handler":"complete"}],"_N$transition":2,"transition":2,"_N$normalColor":{"__type__":"cc.Color","r":230,"g":230,"b":230},"_N$pressedColor":{"__type__":"cc.Color","r":200,"g":200,"b":200},"pressedColor":{"__type__":"cc.Color","r":200,"g":200,"b":200},"_N$disabledColor":{"__type__":"cc.Color","r":120,"g":120,"b":120,"a":200},"_N$normalSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_N$pressedSprite":{"__uuid__":"e97GVMl6JHh5Ml5qEDdSGa"},"pressedSprite":{"__uuid__":"e97GVMl6JHh5Ml5qEDdSGa"},"_N$hoverSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"hoverSprite":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_N$disabledSprite":{"__uuid__":"29FYIk+N1GYaeWH/q1NxQO"},"_N$target":{"__id__":14}}],"_contentSize":{"__type__":"cc.Size","width":357,"height":181},"_anchorPoint":{"__type__":"cc.Vec2","x":1.3397438655084084,"y":0.921540881963172},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[517,-69,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"Background","_parent":{"__id__":13},"_children":[{"__id__":15}],"_components":[{"__type__":"cc.Sprite","node":{"__id__":14},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_spriteFrame":{"__uuid__":"f0BIwQ8D5Ml7nTNQbh1YlS"},"_type":1,"_sizeMode":0},{"__type__":"cc.Widget","node":{"__id__":14},"alignMode":0,"_alignFlags":45,"_originalWidth":100,"_originalHeight":40}],"_contentSize":{"__type__":"cc.Size","width":357,"height":181},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[-299.7885599865018,-76.29889963533412,0,0,0,0,1,1,1,1]}},{"__type__":"cc.Node","_name":"Label","_parent":{"__id__":14},"_components":[{"__type__":"cc.Label","node":{"__id__":15},"_materials":[{"__uuid__":"ecpdLyjvZBwrvm+cedCcQy"}],"_useOriginalSize":false,"_string":"complete","_N$string":"complete","_fontSize":126.40000000000009,"_enableWrapText":false,"_N$horizontalAlign":1,"_N$verticalAlign":1,"_N$overflow":1,"_N$cacheMode":1}],"_color":{"__type__":"cc.Color"},"_contentSize":{"__type__":"cc.Size","width":462,"height":162},"_trs":{"__type__":"TypedArray","ctor":"Float64Array","array":[0,0,0,0,0,0,1,1,1,1]}}],{"__type__":"cc.SpriteFrame","content":{"name":"HelloWorld","texture":"6aoKpq6+5BVaCIpoemqt7E","rect":[0,0,195,270],"offset":[0,0],"originalSize":[195,270],"capInsets":[0,0,0,0]}},{"__type__":"cc.SpriteFrame","content":{"name":"singleColor","texture":"a8Anh32NZGRZegUtSgEj26","rect":[0,0,2,2],"offset":[0,0],"originalSize":[2,2],"capInsets":[0,0,0,0]}},{"__type__":"cc.SpriteFrame","content":{"name":"default_btn_pressed","texture":"b4P/PCArtIdIH38t6mlw8Y","rect":[0,0,40,40],"offset":[0,0],"originalSize":[40,40],"capInsets":[12,12,12,12]}},{"__type__":"cc.SpriteFrame","content":{"name":"default_btn_normal","texture":"e8Ueib+qJEhL6mXAHdnwbi","rect":[0,0,40,40],"offset":[0,0],"originalSize":[40,40],"capInsets":[12,12,12,12]}}]',"res/import/07/0771a325d.json":'[{"__type__":"cc.Material","_name":"builtin-3d-particle","_effectAsset":{"__uuid__":"82migssElAGb04Ws6NimQX"},"_techniqueData":{"0":{"props":{"mainTiling_Offset":{"__type__":"cc.Vec4","x":1,"y":1},"tintColor":{"__type__":"cc.Color","r":172,"g":165,"b":165,"a":127},"mainTexture":{"__uuid__":"60AwGqM1dKELCGhPAR+jK6"}},"defines":{"CC_USE_BILLBOARD":true,"CC_USE_STRETCHED_BILLBOARD":false,"CC_USE_HORIZONTAL_BILLBOARD":false,"CC_USE_VERTICAL_BILLBOARD":false,"CC_USE_MESH":false}}}},{"__type__":"cc.EffectAsset","_name":"builtin-3d-particle","techniques":[{"name":"add","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":770,"blendDst":1,"blendSrcAlpha":770,"blendDstAlpha":1}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16},"tintColor":{"value":[0.5,0.5,0.5,0.5],"inspector":{"type":"color"},"type":16}},"program":"builtin-3d-particle|particle-vs-legacy:lpvs_main|tinted-fs:add"}]},{"name":"alpha-blend","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":770,"blendDst":771,"blendSrcAlpha":770,"blendDstAlpha":771}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16},"tintColor":{"value":[0.5,0.5,0.5,0.5],"inspector":{"type":"color"},"type":16}},"program":"builtin-3d-particle|particle-vs-legacy:lpvs_main|tinted-fs:add"}]},{"name":"add-multiply","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":770,"blendDst":771,"blendSrcAlpha":770,"blendDstAlpha":771}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16},"tintColor":{"value":[0.5,0.5,0.5,0.5],"inspector":{"type":"color"},"type":16}},"program":"builtin-3d-particle|particle-vs-legacy:lpvs_main|tinted-fs:multiply"}]},{"name":"add-smooth","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":770,"blendDst":771,"blendSrcAlpha":770,"blendDstAlpha":771}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16}},"program":"builtin-3d-particle|particle-vs-legacy:lpvs_main|no-tint-fs:addSmooth"}]},{"name":"premultiply-blend","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":770,"blendDst":771,"blendSrcAlpha":770,"blendDstAlpha":771}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16}},"program":"builtin-3d-particle|particle-vs-legacy:lpvs_main|no-tint-fs:premultiplied"}]}],"shaders":[{"hash":1682193167,"glsl3":{"vert":"\\nprecision highp float;\\nvec4 quaternionFromAxis(vec3 xAxis,vec3 yAxis,vec3 zAxis){\\n    mat3 m = mat3(xAxis,yAxis,zAxis);\\n    float trace = m[0][0] + m[1][1] + m[2][2];\\n    vec4 quat;\\n    if (trace > 0.) {\\n        float s = 0.5 / sqrt(trace + 1.0);\\n        quat.w = 0.25 / s;\\n        quat.x = (m[2][1] - m[1][2]) * s;\\n        quat.y = (m[0][2] - m[2][0]) * s;\\n        quat.z = (m[1][0] - m[0][1]) * s;\\n    } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\\n        float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\\n        quat.w = (m[2][1] - m[1][2]) / s;\\n        quat.x = 0.25 * s;\\n        quat.y = (m[0][1] + m[1][0]) / s;\\n        quat.z = (m[0][2] + m[2][0]) / s;\\n    } else if (m[1][1] > m[2][2]) {\\n        float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\\n        quat.w = (m[0][2] - m[2][0]) / s;\\n        quat.x = (m[0][1] + m[1][0]) / s;\\n        quat.y = 0.25 * s;\\n        quat.z = (m[1][2] + m[2][1]) / s;\\n    } else {\\n        float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\\n        quat.w = (m[1][0] - m[0][1]) / s;\\n        quat.x = (m[0][2] + m[2][0]) / s;\\n        quat.y = (m[1][2] + m[2][1]) / s;\\n        quat.z = 0.25 * s;\\n    }\\n    float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\\n    if (len > 0.) {\\n        len = 1. / sqrt(len);\\n        quat.x = quat.x * len;\\n        quat.y = quat.y * len;\\n        quat.z = quat.z * len;\\n        quat.w = quat.w * len;\\n    }\\n    return quat;\\n}\\nvec4 quaternionFromEuler(vec3 angle){\\n    float x = angle.x / 2.;\\n    float y = angle.y / 2.;\\n    float z = angle.z / 2.;\\n    float sx = sin(x);\\n    float cx = cos(x);\\n    float sy = sin(y);\\n    float cy = cos(y);\\n    float sz = sin(z);\\n    float cz = cos(z);\\n    vec4 quat = vec4(0);\\n    quat.x = sx * cy * cz + cx * sy * sz;\\n    quat.y = cx * sy * cz + sx * cy * sz;\\n    quat.z = cx * cy * sz - sx * sy * cz;\\n    quat.w = cx * cy * cz - sx * sy * sz;\\n    return quat;\\n}\\nmat4 matrixFromRT(vec4 q, vec3 p){\\n    float x2 = q.x + q.x;\\n    float y2 = q.y + q.y;\\n    float z2 = q.z + q.z;\\n    float xx = q.x * x2;\\n    float xy = q.x * y2;\\n    float xz = q.x * z2;\\n    float yy = q.y * y2;\\n    float yz = q.y * z2;\\n    float zz = q.z * z2;\\n    float wx = q.w * x2;\\n    float wy = q.w * y2;\\n    float wz = q.w * z2;\\n    return mat4(\\n        1. - (yy + zz), xy + wz, xz - wy, 0,\\n        xy - wz, 1. - (xx + zz), yz + wx, 0,\\n        xz + wy, yz - wx, 1. - (xx + yy), 0,\\n        p.x, p.y, p.z, 1\\n    );\\n}\\nmat4 matFromRTS(vec4 q, vec3 t, vec3 s){\\n    float x = q.x, y = q.y, z = q.z, w = q.w;\\n    float x2 = x + x;\\n    float y2 = y + y;\\n    float z2 = z + z;\\n    float xx = x * x2;\\n    float xy = x * y2;\\n    float xz = x * z2;\\n    float yy = y * y2;\\n    float yz = y * z2;\\n    float zz = z * z2;\\n    float wx = w * x2;\\n    float wy = w * y2;\\n    float wz = w * z2;\\n    float sx = s.x;\\n    float sy = s.y;\\n    float sz = s.z;\\n    return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\\n        (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\\n        (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\\n        t.x, t.y, t.z, 1);\\n}\\nvec4 quatMultiply(vec4 a, vec4 b){\\n    vec4 quat;\\n    quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\\n    quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\\n    quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\\n    quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\\n    return quat;\\n}\\nvoid rotateVecFromQuat(inout vec3 v, vec4 q){\\n    float ix = q.w * v.x + q.y * v.z - q.z * v.y;\\n    float iy = q.w * v.y + q.z * v.x - q.x * v.z;\\n    float iz = q.w * v.z + q.x * v.y - q.y * v.x;\\n    float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\\n    v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\\n    v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\\n    v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\\n}\\nvec3 rotateInLocalSpace(vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\\n    float z = pos.z;\\n    float x = pos.x;\\n    float y = pos.y;\\n    vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\\n    vec4 rotQuat = quatMultiply(viewQuat, q);\\n    rotateVecFromQuat(pos, rotQuat);\\n    return pos;\\n}\\nvoid rotateCorner(inout vec2 corner, float angle){\\n    float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\\n    float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\\n    corner.x = xOS;\\n    corner.y = yOS;\\n}\\nuniform Constants{\\n    vec4 mainTiling_Offset;\\n    vec4 frameTile_velLenScale;\\n    vec4 scale;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nout vec2 uv;\\nout vec4 color;\\nvoid computeVertPos(inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\\n#if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n    , mat4 viewInv\\n#endif\\n#if CC_USE_STRETCHED_BILLBOARD\\n    , vec3 eye\\n    , vec4 velocity\\n    , float velocityScale\\n    , float lengthScale\\n    , float xIndex\\n#endif\\n) {\\n#if CC_USE_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\\n    vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\\n    vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\\n#elif CC_USE_STRETCHED_BILLBOARD\\n    vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\\n    vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\\n    pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\\n#elif CC_USE_HORIZONTAL_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = vec3(1, 0, 0);\\n    vec3 camY = vec3(0, 0, -1);\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\\n#elif CC_USE_VERTICAL_BILLBOARD\\n    vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\\n    rotateCorner(viewSpaceVert, q.z);\\n    vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\\n    vec3 camY = vec3(0, 1, 0);\\n    vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\\n    pos.xyz += offset;\\n#else\\n    pos.x += vertOffset.x;\\n    pos.y += vertOffset.y;\\n#endif\\n}\\nvec2 computeUV(float frameIndex, vec2 vertIndex, vec2 frameTile){\\n    vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\\n    aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\\n#if !CC_USE_MESH\\n    vertIndex.y = 1. - vertIndex.y;\\n#endif\\n    return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\\n}\\nin vec3 a_position;\\nin vec3 a_texCoord;\\nin vec3 a_texCoord1;\\nin vec3 a_texCoord2;\\nin vec4 a_color;\\n#if CC_USE_STRETCHED_BILLBOARD\\n    in vec3 a_color1;\\n#endif\\n#if CC_USE_MESH\\n    in vec3 a_texCoord3;\\n    in vec3 a_normal;\\n    in vec4 a_color1;\\n#endif\\nvec4 lpvs_main() {\\n    vec3 compScale = scale.xyz * a_texCoord1;\\n    vec4 pos = vec4(a_position, 1);\\n#if CC_USE_STRETCHED_BILLBOARD\\n    vec4 velocity = vec4(a_color1.xyz, 0);\\n#endif\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        velocity = cc_matWorld * velocity;\\n    #endif\\n#endif\\n#if !CC_USE_MESH\\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\\n    #if CC_USE_BILLBOARD\\n        vec3 rotEuler = a_texCoord2;\\n    #elif CC_USE_STRETCHED_BILLBOARD\\n        vec3 rotEuler = vec3(0.);\\n    #else\\n        vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\\n    #endif\\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\\n    #if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n        , cc_matViewInv\\n    #endif\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        , cc_cameraPos.xyz\\n        , velocity\\n        , frameTile_velLenScale.z\\n        , frameTile_velLenScale.w\\n        , a_texCoord.x\\n    #endif\\n    );\\n    color = a_color;\\n#else\\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\\n    pos = xform * vec4(a_texCoord3, 1);\\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\\n    color = a_color * a_color1;\\n#endif\\n    uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\\n    pos = cc_matViewProj * pos;\\n    return pos;\\n}\\nvoid main() { gl_Position = lpvs_main(); }","frag":"\\nprecision highp float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nin vec2 uv;\\nin vec4 color;\\nuniform sampler2D mainTexture;\\nuniform FragConstants {\\n  vec4 tintColor;\\n};\\nvec4 add () {\\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\\n  return CCFragOutput(col);\\n}\\nout vec4 cc_FragColor;\\nvoid main() { cc_FragColor = add(); }"},"glsl1":{"vert":"\\nprecision highp float;\\nvec4 quaternionFromAxis(vec3 xAxis,vec3 yAxis,vec3 zAxis){\\n    mat3 m = mat3(xAxis,yAxis,zAxis);\\n    float trace = m[0][0] + m[1][1] + m[2][2];\\n    vec4 quat;\\n    if (trace > 0.) {\\n        float s = 0.5 / sqrt(trace + 1.0);\\n        quat.w = 0.25 / s;\\n        quat.x = (m[2][1] - m[1][2]) * s;\\n        quat.y = (m[0][2] - m[2][0]) * s;\\n        quat.z = (m[1][0] - m[0][1]) * s;\\n    } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\\n        float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\\n        quat.w = (m[2][1] - m[1][2]) / s;\\n        quat.x = 0.25 * s;\\n        quat.y = (m[0][1] + m[1][0]) / s;\\n        quat.z = (m[0][2] + m[2][0]) / s;\\n    } else if (m[1][1] > m[2][2]) {\\n        float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\\n        quat.w = (m[0][2] - m[2][0]) / s;\\n        quat.x = (m[0][1] + m[1][0]) / s;\\n        quat.y = 0.25 * s;\\n        quat.z = (m[1][2] + m[2][1]) / s;\\n    } else {\\n        float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\\n        quat.w = (m[1][0] - m[0][1]) / s;\\n        quat.x = (m[0][2] + m[2][0]) / s;\\n        quat.y = (m[1][2] + m[2][1]) / s;\\n        quat.z = 0.25 * s;\\n    }\\n    float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\\n    if (len > 0.) {\\n        len = 1. / sqrt(len);\\n        quat.x = quat.x * len;\\n        quat.y = quat.y * len;\\n        quat.z = quat.z * len;\\n        quat.w = quat.w * len;\\n    }\\n    return quat;\\n}\\nvec4 quaternionFromEuler(vec3 angle){\\n    float x = angle.x / 2.;\\n    float y = angle.y / 2.;\\n    float z = angle.z / 2.;\\n    float sx = sin(x);\\n    float cx = cos(x);\\n    float sy = sin(y);\\n    float cy = cos(y);\\n    float sz = sin(z);\\n    float cz = cos(z);\\n    vec4 quat = vec4(0);\\n    quat.x = sx * cy * cz + cx * sy * sz;\\n    quat.y = cx * sy * cz + sx * cy * sz;\\n    quat.z = cx * cy * sz - sx * sy * cz;\\n    quat.w = cx * cy * cz - sx * sy * sz;\\n    return quat;\\n}\\nmat4 matrixFromRT(vec4 q, vec3 p){\\n    float x2 = q.x + q.x;\\n    float y2 = q.y + q.y;\\n    float z2 = q.z + q.z;\\n    float xx = q.x * x2;\\n    float xy = q.x * y2;\\n    float xz = q.x * z2;\\n    float yy = q.y * y2;\\n    float yz = q.y * z2;\\n    float zz = q.z * z2;\\n    float wx = q.w * x2;\\n    float wy = q.w * y2;\\n    float wz = q.w * z2;\\n    return mat4(\\n        1. - (yy + zz), xy + wz, xz - wy, 0,\\n        xy - wz, 1. - (xx + zz), yz + wx, 0,\\n        xz + wy, yz - wx, 1. - (xx + yy), 0,\\n        p.x, p.y, p.z, 1\\n    );\\n}\\nmat4 matFromRTS(vec4 q, vec3 t, vec3 s){\\n    float x = q.x, y = q.y, z = q.z, w = q.w;\\n    float x2 = x + x;\\n    float y2 = y + y;\\n    float z2 = z + z;\\n    float xx = x * x2;\\n    float xy = x * y2;\\n    float xz = x * z2;\\n    float yy = y * y2;\\n    float yz = y * z2;\\n    float zz = z * z2;\\n    float wx = w * x2;\\n    float wy = w * y2;\\n    float wz = w * z2;\\n    float sx = s.x;\\n    float sy = s.y;\\n    float sz = s.z;\\n    return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\\n        (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\\n        (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\\n        t.x, t.y, t.z, 1);\\n}\\nvec4 quatMultiply(vec4 a, vec4 b){\\n    vec4 quat;\\n    quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\\n    quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\\n    quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\\n    quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\\n    return quat;\\n}\\nvoid rotateVecFromQuat(inout vec3 v, vec4 q){\\n    float ix = q.w * v.x + q.y * v.z - q.z * v.y;\\n    float iy = q.w * v.y + q.z * v.x - q.x * v.z;\\n    float iz = q.w * v.z + q.x * v.y - q.y * v.x;\\n    float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\\n    v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\\n    v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\\n    v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\\n}\\nvec3 rotateInLocalSpace(vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\\n    float z = pos.z;\\n    float x = pos.x;\\n    float y = pos.y;\\n    vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\\n    vec4 rotQuat = quatMultiply(viewQuat, q);\\n    rotateVecFromQuat(pos, rotQuat);\\n    return pos;\\n}\\nvoid rotateCorner(inout vec2 corner, float angle){\\n    float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\\n    float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\\n    corner.x = xOS;\\n    corner.y = yOS;\\n}\\nuniform vec4 mainTiling_Offset;\\nuniform vec4 frameTile_velLenScale;\\nuniform vec4 scale;\\nuniform mat4 cc_matView;\\nuniform mat4 cc_matViewInv;\\nuniform mat4 cc_matViewProj;\\nuniform vec4 cc_cameraPos;\\nuniform mat4 cc_matWorld;\\nvarying vec2 uv;\\nvarying vec4 color;\\nvoid computeVertPos(inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\\n#if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n    , mat4 viewInv\\n#endif\\n#if CC_USE_STRETCHED_BILLBOARD\\n    , vec3 eye\\n    , vec4 velocity\\n    , float velocityScale\\n    , float lengthScale\\n    , float xIndex\\n#endif\\n) {\\n#if CC_USE_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\\n    vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\\n    vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\\n#elif CC_USE_STRETCHED_BILLBOARD\\n    vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\\n    vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\\n    pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\\n#elif CC_USE_HORIZONTAL_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = vec3(1, 0, 0);\\n    vec3 camY = vec3(0, 0, -1);\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\\n#elif CC_USE_VERTICAL_BILLBOARD\\n    vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\\n    rotateCorner(viewSpaceVert, q.z);\\n    vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\\n    vec3 camY = vec3(0, 1, 0);\\n    vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\\n    pos.xyz += offset;\\n#else\\n    pos.x += vertOffset.x;\\n    pos.y += vertOffset.y;\\n#endif\\n}\\nvec2 computeUV(float frameIndex, vec2 vertIndex, vec2 frameTile){\\n    vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\\n    aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\\n#if !CC_USE_MESH\\n    vertIndex.y = 1. - vertIndex.y;\\n#endif\\n    return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\\n}\\nattribute vec3 a_position;\\nattribute vec3 a_texCoord;\\nattribute vec3 a_texCoord1;\\nattribute vec3 a_texCoord2;\\nattribute vec4 a_color;\\n#if CC_USE_STRETCHED_BILLBOARD\\n    attribute vec3 a_color1;\\n#endif\\n#if CC_USE_MESH\\n    attribute vec3 a_texCoord3;\\n    attribute vec3 a_normal;\\n    attribute vec4 a_color1;\\n#endif\\nvec4 lpvs_main() {\\n    vec3 compScale = scale.xyz * a_texCoord1;\\n    vec4 pos = vec4(a_position, 1);\\n#if CC_USE_STRETCHED_BILLBOARD\\n    vec4 velocity = vec4(a_color1.xyz, 0);\\n#endif\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        velocity = cc_matWorld * velocity;\\n    #endif\\n#endif\\n#if !CC_USE_MESH\\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\\n    #if CC_USE_BILLBOARD\\n        vec3 rotEuler = a_texCoord2;\\n    #elif CC_USE_STRETCHED_BILLBOARD\\n        vec3 rotEuler = vec3(0.);\\n    #else\\n        vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\\n    #endif\\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\\n    #if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n        , cc_matViewInv\\n    #endif\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        , cc_cameraPos.xyz\\n        , velocity\\n        , frameTile_velLenScale.z\\n        , frameTile_velLenScale.w\\n        , a_texCoord.x\\n    #endif\\n    );\\n    color = a_color;\\n#else\\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\\n    pos = xform * vec4(a_texCoord3, 1);\\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\\n    color = a_color * a_color1;\\n#endif\\n    uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\\n    pos = cc_matViewProj * pos;\\n    return pos;\\n}\\nvoid main() { gl_Position = lpvs_main(); }","frag":"\\nprecision highp float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nvarying vec2 uv;\\nvarying vec4 color;\\nuniform sampler2D mainTexture;\\nuniform vec4 tintColor;\\nvec4 add () {\\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\\n  return CCFragOutput(col);\\n}\\nvoid main() { gl_FragColor = add(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_USE_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_STRETCHED_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_HORIZONTAL_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_VERTICAL_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_MESH","type":"boolean","defines":[]},{"name":"CC_USE_WORLD_SPACE","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"Constants","members":[{"name":"mainTiling_Offset","type":16,"count":1},{"name":"frameTile_velLenScale","type":16,"count":1},{"name":"scale","type":16,"count":1}],"defines":[],"binding":0},{"name":"FragConstants","members":[{"name":"tintColor","type":16,"count":1}],"defines":[],"binding":1}],"samplers":[{"name":"mainTexture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-3d-particle|particle-vs-legacy:lpvs_main|tinted-fs:add"},{"hash":1933642753,"glsl3":{"vert":"\\nprecision highp float;\\nvec4 quaternionFromAxis(vec3 xAxis,vec3 yAxis,vec3 zAxis){\\n    mat3 m = mat3(xAxis,yAxis,zAxis);\\n    float trace = m[0][0] + m[1][1] + m[2][2];\\n    vec4 quat;\\n    if (trace > 0.) {\\n        float s = 0.5 / sqrt(trace + 1.0);\\n        quat.w = 0.25 / s;\\n        quat.x = (m[2][1] - m[1][2]) * s;\\n        quat.y = (m[0][2] - m[2][0]) * s;\\n        quat.z = (m[1][0] - m[0][1]) * s;\\n    } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\\n        float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\\n        quat.w = (m[2][1] - m[1][2]) / s;\\n        quat.x = 0.25 * s;\\n        quat.y = (m[0][1] + m[1][0]) / s;\\n        quat.z = (m[0][2] + m[2][0]) / s;\\n    } else if (m[1][1] > m[2][2]) {\\n        float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\\n        quat.w = (m[0][2] - m[2][0]) / s;\\n        quat.x = (m[0][1] + m[1][0]) / s;\\n        quat.y = 0.25 * s;\\n        quat.z = (m[1][2] + m[2][1]) / s;\\n    } else {\\n        float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\\n        quat.w = (m[1][0] - m[0][1]) / s;\\n        quat.x = (m[0][2] + m[2][0]) / s;\\n        quat.y = (m[1][2] + m[2][1]) / s;\\n        quat.z = 0.25 * s;\\n    }\\n    float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\\n    if (len > 0.) {\\n        len = 1. / sqrt(len);\\n        quat.x = quat.x * len;\\n        quat.y = quat.y * len;\\n        quat.z = quat.z * len;\\n        quat.w = quat.w * len;\\n    }\\n    return quat;\\n}\\nvec4 quaternionFromEuler(vec3 angle){\\n    float x = angle.x / 2.;\\n    float y = angle.y / 2.;\\n    float z = angle.z / 2.;\\n    float sx = sin(x);\\n    float cx = cos(x);\\n    float sy = sin(y);\\n    float cy = cos(y);\\n    float sz = sin(z);\\n    float cz = cos(z);\\n    vec4 quat = vec4(0);\\n    quat.x = sx * cy * cz + cx * sy * sz;\\n    quat.y = cx * sy * cz + sx * cy * sz;\\n    quat.z = cx * cy * sz - sx * sy * cz;\\n    quat.w = cx * cy * cz - sx * sy * sz;\\n    return quat;\\n}\\nmat4 matrixFromRT(vec4 q, vec3 p){\\n    float x2 = q.x + q.x;\\n    float y2 = q.y + q.y;\\n    float z2 = q.z + q.z;\\n    float xx = q.x * x2;\\n    float xy = q.x * y2;\\n    float xz = q.x * z2;\\n    float yy = q.y * y2;\\n    float yz = q.y * z2;\\n    float zz = q.z * z2;\\n    float wx = q.w * x2;\\n    float wy = q.w * y2;\\n    float wz = q.w * z2;\\n    return mat4(\\n        1. - (yy + zz), xy + wz, xz - wy, 0,\\n        xy - wz, 1. - (xx + zz), yz + wx, 0,\\n        xz + wy, yz - wx, 1. - (xx + yy), 0,\\n        p.x, p.y, p.z, 1\\n    );\\n}\\nmat4 matFromRTS(vec4 q, vec3 t, vec3 s){\\n    float x = q.x, y = q.y, z = q.z, w = q.w;\\n    float x2 = x + x;\\n    float y2 = y + y;\\n    float z2 = z + z;\\n    float xx = x * x2;\\n    float xy = x * y2;\\n    float xz = x * z2;\\n    float yy = y * y2;\\n    float yz = y * z2;\\n    float zz = z * z2;\\n    float wx = w * x2;\\n    float wy = w * y2;\\n    float wz = w * z2;\\n    float sx = s.x;\\n    float sy = s.y;\\n    float sz = s.z;\\n    return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\\n        (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\\n        (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\\n        t.x, t.y, t.z, 1);\\n}\\nvec4 quatMultiply(vec4 a, vec4 b){\\n    vec4 quat;\\n    quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\\n    quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\\n    quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\\n    quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\\n    return quat;\\n}\\nvoid rotateVecFromQuat(inout vec3 v, vec4 q){\\n    float ix = q.w * v.x + q.y * v.z - q.z * v.y;\\n    float iy = q.w * v.y + q.z * v.x - q.x * v.z;\\n    float iz = q.w * v.z + q.x * v.y - q.y * v.x;\\n    float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\\n    v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\\n    v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\\n    v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\\n}\\nvec3 rotateInLocalSpace(vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\\n    float z = pos.z;\\n    float x = pos.x;\\n    float y = pos.y;\\n    vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\\n    vec4 rotQuat = quatMultiply(viewQuat, q);\\n    rotateVecFromQuat(pos, rotQuat);\\n    return pos;\\n}\\nvoid rotateCorner(inout vec2 corner, float angle){\\n    float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\\n    float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\\n    corner.x = xOS;\\n    corner.y = yOS;\\n}\\nuniform Constants{\\n    vec4 mainTiling_Offset;\\n    vec4 frameTile_velLenScale;\\n    vec4 scale;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nout vec2 uv;\\nout vec4 color;\\nvoid computeVertPos(inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\\n#if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n    , mat4 viewInv\\n#endif\\n#if CC_USE_STRETCHED_BILLBOARD\\n    , vec3 eye\\n    , vec4 velocity\\n    , float velocityScale\\n    , float lengthScale\\n    , float xIndex\\n#endif\\n) {\\n#if CC_USE_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\\n    vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\\n    vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\\n#elif CC_USE_STRETCHED_BILLBOARD\\n    vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\\n    vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\\n    pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\\n#elif CC_USE_HORIZONTAL_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = vec3(1, 0, 0);\\n    vec3 camY = vec3(0, 0, -1);\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\\n#elif CC_USE_VERTICAL_BILLBOARD\\n    vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\\n    rotateCorner(viewSpaceVert, q.z);\\n    vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\\n    vec3 camY = vec3(0, 1, 0);\\n    vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\\n    pos.xyz += offset;\\n#else\\n    pos.x += vertOffset.x;\\n    pos.y += vertOffset.y;\\n#endif\\n}\\nvec2 computeUV(float frameIndex, vec2 vertIndex, vec2 frameTile){\\n    vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\\n    aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\\n#if !CC_USE_MESH\\n    vertIndex.y = 1. - vertIndex.y;\\n#endif\\n    return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\\n}\\nin vec3 a_position;\\nin vec3 a_texCoord;\\nin vec3 a_texCoord1;\\nin vec3 a_texCoord2;\\nin vec4 a_color;\\n#if CC_USE_STRETCHED_BILLBOARD\\n    in vec3 a_color1;\\n#endif\\n#if CC_USE_MESH\\n    in vec3 a_texCoord3;\\n    in vec3 a_normal;\\n    in vec4 a_color1;\\n#endif\\nvec4 lpvs_main() {\\n    vec3 compScale = scale.xyz * a_texCoord1;\\n    vec4 pos = vec4(a_position, 1);\\n#if CC_USE_STRETCHED_BILLBOARD\\n    vec4 velocity = vec4(a_color1.xyz, 0);\\n#endif\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        velocity = cc_matWorld * velocity;\\n    #endif\\n#endif\\n#if !CC_USE_MESH\\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\\n    #if CC_USE_BILLBOARD\\n        vec3 rotEuler = a_texCoord2;\\n    #elif CC_USE_STRETCHED_BILLBOARD\\n        vec3 rotEuler = vec3(0.);\\n    #else\\n        vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\\n    #endif\\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\\n    #if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n        , cc_matViewInv\\n    #endif\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        , cc_cameraPos.xyz\\n        , velocity\\n        , frameTile_velLenScale.z\\n        , frameTile_velLenScale.w\\n        , a_texCoord.x\\n    #endif\\n    );\\n    color = a_color;\\n#else\\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\\n    pos = xform * vec4(a_texCoord3, 1);\\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\\n    color = a_color * a_color1;\\n#endif\\n    uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\\n    pos = cc_matViewProj * pos;\\n    return pos;\\n}\\nvoid main() { gl_Position = lpvs_main(); }","frag":"\\nprecision highp float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nin vec2 uv;\\nin vec4 color;\\nuniform sampler2D mainTexture;\\nuniform FragConstants {\\n  vec4 tintColor;\\n};\\nvec4 multiply () {\\n  vec4 col;\\n  vec4 texColor = texture(mainTexture, uv);\\n  col.rgb = tintColor.rgb * texColor.rgb * color.rgb * vec3(2.0);\\n  col.a = (1.0 - texColor.a) * (tintColor.a * color.a * 2.0);\\n  return CCFragOutput(col);\\n}\\nout vec4 cc_FragColor;\\nvoid main() { cc_FragColor = multiply(); }"},"glsl1":{"vert":"\\nprecision highp float;\\nvec4 quaternionFromAxis(vec3 xAxis,vec3 yAxis,vec3 zAxis){\\n    mat3 m = mat3(xAxis,yAxis,zAxis);\\n    float trace = m[0][0] + m[1][1] + m[2][2];\\n    vec4 quat;\\n    if (trace > 0.) {\\n        float s = 0.5 / sqrt(trace + 1.0);\\n        quat.w = 0.25 / s;\\n        quat.x = (m[2][1] - m[1][2]) * s;\\n        quat.y = (m[0][2] - m[2][0]) * s;\\n        quat.z = (m[1][0] - m[0][1]) * s;\\n    } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\\n        float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\\n        quat.w = (m[2][1] - m[1][2]) / s;\\n        quat.x = 0.25 * s;\\n        quat.y = (m[0][1] + m[1][0]) / s;\\n        quat.z = (m[0][2] + m[2][0]) / s;\\n    } else if (m[1][1] > m[2][2]) {\\n        float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\\n        quat.w = (m[0][2] - m[2][0]) / s;\\n        quat.x = (m[0][1] + m[1][0]) / s;\\n        quat.y = 0.25 * s;\\n        quat.z = (m[1][2] + m[2][1]) / s;\\n    } else {\\n        float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\\n        quat.w = (m[1][0] - m[0][1]) / s;\\n        quat.x = (m[0][2] + m[2][0]) / s;\\n        quat.y = (m[1][2] + m[2][1]) / s;\\n        quat.z = 0.25 * s;\\n    }\\n    float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\\n    if (len > 0.) {\\n        len = 1. / sqrt(len);\\n        quat.x = quat.x * len;\\n        quat.y = quat.y * len;\\n        quat.z = quat.z * len;\\n        quat.w = quat.w * len;\\n    }\\n    return quat;\\n}\\nvec4 quaternionFromEuler(vec3 angle){\\n    float x = angle.x / 2.;\\n    float y = angle.y / 2.;\\n    float z = angle.z / 2.;\\n    float sx = sin(x);\\n    float cx = cos(x);\\n    float sy = sin(y);\\n    float cy = cos(y);\\n    float sz = sin(z);\\n    float cz = cos(z);\\n    vec4 quat = vec4(0);\\n    quat.x = sx * cy * cz + cx * sy * sz;\\n    quat.y = cx * sy * cz + sx * cy * sz;\\n    quat.z = cx * cy * sz - sx * sy * cz;\\n    quat.w = cx * cy * cz - sx * sy * sz;\\n    return quat;\\n}\\nmat4 matrixFromRT(vec4 q, vec3 p){\\n    float x2 = q.x + q.x;\\n    float y2 = q.y + q.y;\\n    float z2 = q.z + q.z;\\n    float xx = q.x * x2;\\n    float xy = q.x * y2;\\n    float xz = q.x * z2;\\n    float yy = q.y * y2;\\n    float yz = q.y * z2;\\n    float zz = q.z * z2;\\n    float wx = q.w * x2;\\n    float wy = q.w * y2;\\n    float wz = q.w * z2;\\n    return mat4(\\n        1. - (yy + zz), xy + wz, xz - wy, 0,\\n        xy - wz, 1. - (xx + zz), yz + wx, 0,\\n        xz + wy, yz - wx, 1. - (xx + yy), 0,\\n        p.x, p.y, p.z, 1\\n    );\\n}\\nmat4 matFromRTS(vec4 q, vec3 t, vec3 s){\\n    float x = q.x, y = q.y, z = q.z, w = q.w;\\n    float x2 = x + x;\\n    float y2 = y + y;\\n    float z2 = z + z;\\n    float xx = x * x2;\\n    float xy = x * y2;\\n    float xz = x * z2;\\n    float yy = y * y2;\\n    float yz = y * z2;\\n    float zz = z * z2;\\n    float wx = w * x2;\\n    float wy = w * y2;\\n    float wz = w * z2;\\n    float sx = s.x;\\n    float sy = s.y;\\n    float sz = s.z;\\n    return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\\n        (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\\n        (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\\n        t.x, t.y, t.z, 1);\\n}\\nvec4 quatMultiply(vec4 a, vec4 b){\\n    vec4 quat;\\n    quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\\n    quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\\n    quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\\n    quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\\n    return quat;\\n}\\nvoid rotateVecFromQuat(inout vec3 v, vec4 q){\\n    float ix = q.w * v.x + q.y * v.z - q.z * v.y;\\n    float iy = q.w * v.y + q.z * v.x - q.x * v.z;\\n    float iz = q.w * v.z + q.x * v.y - q.y * v.x;\\n    float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\\n    v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\\n    v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\\n    v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\\n}\\nvec3 rotateInLocalSpace(vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\\n    float z = pos.z;\\n    float x = pos.x;\\n    float y = pos.y;\\n    vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\\n    vec4 rotQuat = quatMultiply(viewQuat, q);\\n    rotateVecFromQuat(pos, rotQuat);\\n    return pos;\\n}\\nvoid rotateCorner(inout vec2 corner, float angle){\\n    float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\\n    float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\\n    corner.x = xOS;\\n    corner.y = yOS;\\n}\\nuniform vec4 mainTiling_Offset;\\nuniform vec4 frameTile_velLenScale;\\nuniform vec4 scale;\\nuniform mat4 cc_matView;\\nuniform mat4 cc_matViewInv;\\nuniform mat4 cc_matViewProj;\\nuniform vec4 cc_cameraPos;\\nuniform mat4 cc_matWorld;\\nvarying vec2 uv;\\nvarying vec4 color;\\nvoid computeVertPos(inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\\n#if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n    , mat4 viewInv\\n#endif\\n#if CC_USE_STRETCHED_BILLBOARD\\n    , vec3 eye\\n    , vec4 velocity\\n    , float velocityScale\\n    , float lengthScale\\n    , float xIndex\\n#endif\\n) {\\n#if CC_USE_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\\n    vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\\n    vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\\n#elif CC_USE_STRETCHED_BILLBOARD\\n    vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\\n    vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\\n    pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\\n#elif CC_USE_HORIZONTAL_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = vec3(1, 0, 0);\\n    vec3 camY = vec3(0, 0, -1);\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\\n#elif CC_USE_VERTICAL_BILLBOARD\\n    vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\\n    rotateCorner(viewSpaceVert, q.z);\\n    vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\\n    vec3 camY = vec3(0, 1, 0);\\n    vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\\n    pos.xyz += offset;\\n#else\\n    pos.x += vertOffset.x;\\n    pos.y += vertOffset.y;\\n#endif\\n}\\nvec2 computeUV(float frameIndex, vec2 vertIndex, vec2 frameTile){\\n    vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\\n    aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\\n#if !CC_USE_MESH\\n    vertIndex.y = 1. - vertIndex.y;\\n#endif\\n    return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\\n}\\nattribute vec3 a_position;\\nattribute vec3 a_texCoord;\\nattribute vec3 a_texCoord1;\\nattribute vec3 a_texCoord2;\\nattribute vec4 a_color;\\n#if CC_USE_STRETCHED_BILLBOARD\\n    attribute vec3 a_color1;\\n#endif\\n#if CC_USE_MESH\\n    attribute vec3 a_texCoord3;\\n    attribute vec3 a_normal;\\n    attribute vec4 a_color1;\\n#endif\\nvec4 lpvs_main() {\\n    vec3 compScale = scale.xyz * a_texCoord1;\\n    vec4 pos = vec4(a_position, 1);\\n#if CC_USE_STRETCHED_BILLBOARD\\n    vec4 velocity = vec4(a_color1.xyz, 0);\\n#endif\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        velocity = cc_matWorld * velocity;\\n    #endif\\n#endif\\n#if !CC_USE_MESH\\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\\n    #if CC_USE_BILLBOARD\\n        vec3 rotEuler = a_texCoord2;\\n    #elif CC_USE_STRETCHED_BILLBOARD\\n        vec3 rotEuler = vec3(0.);\\n    #else\\n        vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\\n    #endif\\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\\n    #if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n        , cc_matViewInv\\n    #endif\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        , cc_cameraPos.xyz\\n        , velocity\\n        , frameTile_velLenScale.z\\n        , frameTile_velLenScale.w\\n        , a_texCoord.x\\n    #endif\\n    );\\n    color = a_color;\\n#else\\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\\n    pos = xform * vec4(a_texCoord3, 1);\\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\\n    color = a_color * a_color1;\\n#endif\\n    uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\\n    pos = cc_matViewProj * pos;\\n    return pos;\\n}\\nvoid main() { gl_Position = lpvs_main(); }","frag":"\\nprecision highp float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nvarying vec2 uv;\\nvarying vec4 color;\\nuniform sampler2D mainTexture;\\nuniform vec4 tintColor;\\nvec4 multiply () {\\n  vec4 col;\\n  vec4 texColor = texture2D(mainTexture, uv);\\n  col.rgb = tintColor.rgb * texColor.rgb * color.rgb * vec3(2.0);\\n  col.a = (1.0 - texColor.a) * (tintColor.a * color.a * 2.0);\\n  return CCFragOutput(col);\\n}\\nvoid main() { gl_FragColor = multiply(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_USE_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_STRETCHED_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_HORIZONTAL_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_VERTICAL_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_MESH","type":"boolean","defines":[]},{"name":"CC_USE_WORLD_SPACE","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"Constants","members":[{"name":"mainTiling_Offset","type":16,"count":1},{"name":"frameTile_velLenScale","type":16,"count":1},{"name":"scale","type":16,"count":1}],"defines":[],"binding":0},{"name":"FragConstants","members":[{"name":"tintColor","type":16,"count":1}],"defines":[],"binding":1}],"samplers":[{"name":"mainTexture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-3d-particle|particle-vs-legacy:lpvs_main|tinted-fs:multiply"},{"hash":1851787849,"glsl3":{"vert":"\\nprecision highp float;\\nvec4 quaternionFromAxis(vec3 xAxis,vec3 yAxis,vec3 zAxis){\\n    mat3 m = mat3(xAxis,yAxis,zAxis);\\n    float trace = m[0][0] + m[1][1] + m[2][2];\\n    vec4 quat;\\n    if (trace > 0.) {\\n        float s = 0.5 / sqrt(trace + 1.0);\\n        quat.w = 0.25 / s;\\n        quat.x = (m[2][1] - m[1][2]) * s;\\n        quat.y = (m[0][2] - m[2][0]) * s;\\n        quat.z = (m[1][0] - m[0][1]) * s;\\n    } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\\n        float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\\n        quat.w = (m[2][1] - m[1][2]) / s;\\n        quat.x = 0.25 * s;\\n        quat.y = (m[0][1] + m[1][0]) / s;\\n        quat.z = (m[0][2] + m[2][0]) / s;\\n    } else if (m[1][1] > m[2][2]) {\\n        float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\\n        quat.w = (m[0][2] - m[2][0]) / s;\\n        quat.x = (m[0][1] + m[1][0]) / s;\\n        quat.y = 0.25 * s;\\n        quat.z = (m[1][2] + m[2][1]) / s;\\n    } else {\\n        float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\\n        quat.w = (m[1][0] - m[0][1]) / s;\\n        quat.x = (m[0][2] + m[2][0]) / s;\\n        quat.y = (m[1][2] + m[2][1]) / s;\\n        quat.z = 0.25 * s;\\n    }\\n    float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\\n    if (len > 0.) {\\n        len = 1. / sqrt(len);\\n        quat.x = quat.x * len;\\n        quat.y = quat.y * len;\\n        quat.z = quat.z * len;\\n        quat.w = quat.w * len;\\n    }\\n    return quat;\\n}\\nvec4 quaternionFromEuler(vec3 angle){\\n    float x = angle.x / 2.;\\n    float y = angle.y / 2.;\\n    float z = angle.z / 2.;\\n    float sx = sin(x);\\n    float cx = cos(x);\\n    float sy = sin(y);\\n    float cy = cos(y);\\n    float sz = sin(z);\\n    float cz = cos(z);\\n    vec4 quat = vec4(0);\\n    quat.x = sx * cy * cz + cx * sy * sz;\\n    quat.y = cx * sy * cz + sx * cy * sz;\\n    quat.z = cx * cy * sz - sx * sy * cz;\\n    quat.w = cx * cy * cz - sx * sy * sz;\\n    return quat;\\n}\\nmat4 matrixFromRT(vec4 q, vec3 p){\\n    float x2 = q.x + q.x;\\n    float y2 = q.y + q.y;\\n    float z2 = q.z + q.z;\\n    float xx = q.x * x2;\\n    float xy = q.x * y2;\\n    float xz = q.x * z2;\\n    float yy = q.y * y2;\\n    float yz = q.y * z2;\\n    float zz = q.z * z2;\\n    float wx = q.w * x2;\\n    float wy = q.w * y2;\\n    float wz = q.w * z2;\\n    return mat4(\\n        1. - (yy + zz), xy + wz, xz - wy, 0,\\n        xy - wz, 1. - (xx + zz), yz + wx, 0,\\n        xz + wy, yz - wx, 1. - (xx + yy), 0,\\n        p.x, p.y, p.z, 1\\n    );\\n}\\nmat4 matFromRTS(vec4 q, vec3 t, vec3 s){\\n    float x = q.x, y = q.y, z = q.z, w = q.w;\\n    float x2 = x + x;\\n    float y2 = y + y;\\n    float z2 = z + z;\\n    float xx = x * x2;\\n    float xy = x * y2;\\n    float xz = x * z2;\\n    float yy = y * y2;\\n    float yz = y * z2;\\n    float zz = z * z2;\\n    float wx = w * x2;\\n    float wy = w * y2;\\n    float wz = w * z2;\\n    float sx = s.x;\\n    float sy = s.y;\\n    float sz = s.z;\\n    return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\\n        (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\\n        (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\\n        t.x, t.y, t.z, 1);\\n}\\nvec4 quatMultiply(vec4 a, vec4 b){\\n    vec4 quat;\\n    quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\\n    quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\\n    quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\\n    quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\\n    return quat;\\n}\\nvoid rotateVecFromQuat(inout vec3 v, vec4 q){\\n    float ix = q.w * v.x + q.y * v.z - q.z * v.y;\\n    float iy = q.w * v.y + q.z * v.x - q.x * v.z;\\n    float iz = q.w * v.z + q.x * v.y - q.y * v.x;\\n    float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\\n    v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\\n    v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\\n    v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\\n}\\nvec3 rotateInLocalSpace(vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\\n    float z = pos.z;\\n    float x = pos.x;\\n    float y = pos.y;\\n    vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\\n    vec4 rotQuat = quatMultiply(viewQuat, q);\\n    rotateVecFromQuat(pos, rotQuat);\\n    return pos;\\n}\\nvoid rotateCorner(inout vec2 corner, float angle){\\n    float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\\n    float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\\n    corner.x = xOS;\\n    corner.y = yOS;\\n}\\nuniform Constants{\\n    vec4 mainTiling_Offset;\\n    vec4 frameTile_velLenScale;\\n    vec4 scale;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nout vec2 uv;\\nout vec4 color;\\nvoid computeVertPos(inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\\n#if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n    , mat4 viewInv\\n#endif\\n#if CC_USE_STRETCHED_BILLBOARD\\n    , vec3 eye\\n    , vec4 velocity\\n    , float velocityScale\\n    , float lengthScale\\n    , float xIndex\\n#endif\\n) {\\n#if CC_USE_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\\n    vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\\n    vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\\n#elif CC_USE_STRETCHED_BILLBOARD\\n    vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\\n    vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\\n    pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\\n#elif CC_USE_HORIZONTAL_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = vec3(1, 0, 0);\\n    vec3 camY = vec3(0, 0, -1);\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\\n#elif CC_USE_VERTICAL_BILLBOARD\\n    vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\\n    rotateCorner(viewSpaceVert, q.z);\\n    vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\\n    vec3 camY = vec3(0, 1, 0);\\n    vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\\n    pos.xyz += offset;\\n#else\\n    pos.x += vertOffset.x;\\n    pos.y += vertOffset.y;\\n#endif\\n}\\nvec2 computeUV(float frameIndex, vec2 vertIndex, vec2 frameTile){\\n    vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\\n    aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\\n#if !CC_USE_MESH\\n    vertIndex.y = 1. - vertIndex.y;\\n#endif\\n    return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\\n}\\nin vec3 a_position;\\nin vec3 a_texCoord;\\nin vec3 a_texCoord1;\\nin vec3 a_texCoord2;\\nin vec4 a_color;\\n#if CC_USE_STRETCHED_BILLBOARD\\n    in vec3 a_color1;\\n#endif\\n#if CC_USE_MESH\\n    in vec3 a_texCoord3;\\n    in vec3 a_normal;\\n    in vec4 a_color1;\\n#endif\\nvec4 lpvs_main() {\\n    vec3 compScale = scale.xyz * a_texCoord1;\\n    vec4 pos = vec4(a_position, 1);\\n#if CC_USE_STRETCHED_BILLBOARD\\n    vec4 velocity = vec4(a_color1.xyz, 0);\\n#endif\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        velocity = cc_matWorld * velocity;\\n    #endif\\n#endif\\n#if !CC_USE_MESH\\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\\n    #if CC_USE_BILLBOARD\\n        vec3 rotEuler = a_texCoord2;\\n    #elif CC_USE_STRETCHED_BILLBOARD\\n        vec3 rotEuler = vec3(0.);\\n    #else\\n        vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\\n    #endif\\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\\n    #if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n        , cc_matViewInv\\n    #endif\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        , cc_cameraPos.xyz\\n        , velocity\\n        , frameTile_velLenScale.z\\n        , frameTile_velLenScale.w\\n        , a_texCoord.x\\n    #endif\\n    );\\n    color = a_color;\\n#else\\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\\n    pos = xform * vec4(a_texCoord3, 1);\\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\\n    color = a_color * a_color1;\\n#endif\\n    uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\\n    pos = cc_matViewProj * pos;\\n    return pos;\\n}\\nvoid main() { gl_Position = lpvs_main(); }","frag":"\\nprecision highp float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nin vec2 uv;\\nin vec4 color;\\nuniform sampler2D mainTexture;\\nvec4 addSmooth () {\\n  vec4 col = color * texture(mainTexture, uv);\\n  col.rgb *= col.a;\\n  return CCFragOutput(col);\\n}\\nout vec4 cc_FragColor;\\nvoid main() { cc_FragColor = addSmooth(); }"},"glsl1":{"vert":"\\nprecision highp float;\\nvec4 quaternionFromAxis(vec3 xAxis,vec3 yAxis,vec3 zAxis){\\n    mat3 m = mat3(xAxis,yAxis,zAxis);\\n    float trace = m[0][0] + m[1][1] + m[2][2];\\n    vec4 quat;\\n    if (trace > 0.) {\\n        float s = 0.5 / sqrt(trace + 1.0);\\n        quat.w = 0.25 / s;\\n        quat.x = (m[2][1] - m[1][2]) * s;\\n        quat.y = (m[0][2] - m[2][0]) * s;\\n        quat.z = (m[1][0] - m[0][1]) * s;\\n    } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\\n        float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\\n        quat.w = (m[2][1] - m[1][2]) / s;\\n        quat.x = 0.25 * s;\\n        quat.y = (m[0][1] + m[1][0]) / s;\\n        quat.z = (m[0][2] + m[2][0]) / s;\\n    } else if (m[1][1] > m[2][2]) {\\n        float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\\n        quat.w = (m[0][2] - m[2][0]) / s;\\n        quat.x = (m[0][1] + m[1][0]) / s;\\n        quat.y = 0.25 * s;\\n        quat.z = (m[1][2] + m[2][1]) / s;\\n    } else {\\n        float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\\n        quat.w = (m[1][0] - m[0][1]) / s;\\n        quat.x = (m[0][2] + m[2][0]) / s;\\n        quat.y = (m[1][2] + m[2][1]) / s;\\n        quat.z = 0.25 * s;\\n    }\\n    float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\\n    if (len > 0.) {\\n        len = 1. / sqrt(len);\\n        quat.x = quat.x * len;\\n        quat.y = quat.y * len;\\n        quat.z = quat.z * len;\\n        quat.w = quat.w * len;\\n    }\\n    return quat;\\n}\\nvec4 quaternionFromEuler(vec3 angle){\\n    float x = angle.x / 2.;\\n    float y = angle.y / 2.;\\n    float z = angle.z / 2.;\\n    float sx = sin(x);\\n    float cx = cos(x);\\n    float sy = sin(y);\\n    float cy = cos(y);\\n    float sz = sin(z);\\n    float cz = cos(z);\\n    vec4 quat = vec4(0);\\n    quat.x = sx * cy * cz + cx * sy * sz;\\n    quat.y = cx * sy * cz + sx * cy * sz;\\n    quat.z = cx * cy * sz - sx * sy * cz;\\n    quat.w = cx * cy * cz - sx * sy * sz;\\n    return quat;\\n}\\nmat4 matrixFromRT(vec4 q, vec3 p){\\n    float x2 = q.x + q.x;\\n    float y2 = q.y + q.y;\\n    float z2 = q.z + q.z;\\n    float xx = q.x * x2;\\n    float xy = q.x * y2;\\n    float xz = q.x * z2;\\n    float yy = q.y * y2;\\n    float yz = q.y * z2;\\n    float zz = q.z * z2;\\n    float wx = q.w * x2;\\n    float wy = q.w * y2;\\n    float wz = q.w * z2;\\n    return mat4(\\n        1. - (yy + zz), xy + wz, xz - wy, 0,\\n        xy - wz, 1. - (xx + zz), yz + wx, 0,\\n        xz + wy, yz - wx, 1. - (xx + yy), 0,\\n        p.x, p.y, p.z, 1\\n    );\\n}\\nmat4 matFromRTS(vec4 q, vec3 t, vec3 s){\\n    float x = q.x, y = q.y, z = q.z, w = q.w;\\n    float x2 = x + x;\\n    float y2 = y + y;\\n    float z2 = z + z;\\n    float xx = x * x2;\\n    float xy = x * y2;\\n    float xz = x * z2;\\n    float yy = y * y2;\\n    float yz = y * z2;\\n    float zz = z * z2;\\n    float wx = w * x2;\\n    float wy = w * y2;\\n    float wz = w * z2;\\n    float sx = s.x;\\n    float sy = s.y;\\n    float sz = s.z;\\n    return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\\n        (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\\n        (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\\n        t.x, t.y, t.z, 1);\\n}\\nvec4 quatMultiply(vec4 a, vec4 b){\\n    vec4 quat;\\n    quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\\n    quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\\n    quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\\n    quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\\n    return quat;\\n}\\nvoid rotateVecFromQuat(inout vec3 v, vec4 q){\\n    float ix = q.w * v.x + q.y * v.z - q.z * v.y;\\n    float iy = q.w * v.y + q.z * v.x - q.x * v.z;\\n    float iz = q.w * v.z + q.x * v.y - q.y * v.x;\\n    float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\\n    v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\\n    v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\\n    v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\\n}\\nvec3 rotateInLocalSpace(vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\\n    float z = pos.z;\\n    float x = pos.x;\\n    float y = pos.y;\\n    vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\\n    vec4 rotQuat = quatMultiply(viewQuat, q);\\n    rotateVecFromQuat(pos, rotQuat);\\n    return pos;\\n}\\nvoid rotateCorner(inout vec2 corner, float angle){\\n    float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\\n    float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\\n    corner.x = xOS;\\n    corner.y = yOS;\\n}\\nuniform vec4 mainTiling_Offset;\\nuniform vec4 frameTile_velLenScale;\\nuniform vec4 scale;\\nuniform mat4 cc_matView;\\nuniform mat4 cc_matViewInv;\\nuniform mat4 cc_matViewProj;\\nuniform vec4 cc_cameraPos;\\nuniform mat4 cc_matWorld;\\nvarying vec2 uv;\\nvarying vec4 color;\\nvoid computeVertPos(inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\\n#if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n    , mat4 viewInv\\n#endif\\n#if CC_USE_STRETCHED_BILLBOARD\\n    , vec3 eye\\n    , vec4 velocity\\n    , float velocityScale\\n    , float lengthScale\\n    , float xIndex\\n#endif\\n) {\\n#if CC_USE_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\\n    vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\\n    vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\\n#elif CC_USE_STRETCHED_BILLBOARD\\n    vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\\n    vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\\n    pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\\n#elif CC_USE_HORIZONTAL_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = vec3(1, 0, 0);\\n    vec3 camY = vec3(0, 0, -1);\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\\n#elif CC_USE_VERTICAL_BILLBOARD\\n    vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\\n    rotateCorner(viewSpaceVert, q.z);\\n    vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\\n    vec3 camY = vec3(0, 1, 0);\\n    vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\\n    pos.xyz += offset;\\n#else\\n    pos.x += vertOffset.x;\\n    pos.y += vertOffset.y;\\n#endif\\n}\\nvec2 computeUV(float frameIndex, vec2 vertIndex, vec2 frameTile){\\n    vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\\n    aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\\n#if !CC_USE_MESH\\n    vertIndex.y = 1. - vertIndex.y;\\n#endif\\n    return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\\n}\\nattribute vec3 a_position;\\nattribute vec3 a_texCoord;\\nattribute vec3 a_texCoord1;\\nattribute vec3 a_texCoord2;\\nattribute vec4 a_color;\\n#if CC_USE_STRETCHED_BILLBOARD\\n    attribute vec3 a_color1;\\n#endif\\n#if CC_USE_MESH\\n    attribute vec3 a_texCoord3;\\n    attribute vec3 a_normal;\\n    attribute vec4 a_color1;\\n#endif\\nvec4 lpvs_main() {\\n    vec3 compScale = scale.xyz * a_texCoord1;\\n    vec4 pos = vec4(a_position, 1);\\n#if CC_USE_STRETCHED_BILLBOARD\\n    vec4 velocity = vec4(a_color1.xyz, 0);\\n#endif\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        velocity = cc_matWorld * velocity;\\n    #endif\\n#endif\\n#if !CC_USE_MESH\\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\\n    #if CC_USE_BILLBOARD\\n        vec3 rotEuler = a_texCoord2;\\n    #elif CC_USE_STRETCHED_BILLBOARD\\n        vec3 rotEuler = vec3(0.);\\n    #else\\n        vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\\n    #endif\\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\\n    #if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n        , cc_matViewInv\\n    #endif\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        , cc_cameraPos.xyz\\n        , velocity\\n        , frameTile_velLenScale.z\\n        , frameTile_velLenScale.w\\n        , a_texCoord.x\\n    #endif\\n    );\\n    color = a_color;\\n#else\\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\\n    pos = xform * vec4(a_texCoord3, 1);\\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\\n    color = a_color * a_color1;\\n#endif\\n    uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\\n    pos = cc_matViewProj * pos;\\n    return pos;\\n}\\nvoid main() { gl_Position = lpvs_main(); }","frag":"\\nprecision highp float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nvarying vec2 uv;\\nvarying vec4 color;\\nuniform sampler2D mainTexture;\\nvec4 addSmooth () {\\n  vec4 col = color * texture2D(mainTexture, uv);\\n  col.rgb *= col.a;\\n  return CCFragOutput(col);\\n}\\nvoid main() { gl_FragColor = addSmooth(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_USE_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_STRETCHED_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_HORIZONTAL_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_VERTICAL_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_MESH","type":"boolean","defines":[]},{"name":"CC_USE_WORLD_SPACE","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"Constants","members":[{"name":"mainTiling_Offset","type":16,"count":1},{"name":"frameTile_velLenScale","type":16,"count":1},{"name":"scale","type":16,"count":1}],"defines":[],"binding":0}],"samplers":[{"name":"mainTexture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-3d-particle|particle-vs-legacy:lpvs_main|no-tint-fs:addSmooth"},{"hash":145387972,"glsl3":{"vert":"\\nprecision highp float;\\nvec4 quaternionFromAxis(vec3 xAxis,vec3 yAxis,vec3 zAxis){\\n    mat3 m = mat3(xAxis,yAxis,zAxis);\\n    float trace = m[0][0] + m[1][1] + m[2][2];\\n    vec4 quat;\\n    if (trace > 0.) {\\n        float s = 0.5 / sqrt(trace + 1.0);\\n        quat.w = 0.25 / s;\\n        quat.x = (m[2][1] - m[1][2]) * s;\\n        quat.y = (m[0][2] - m[2][0]) * s;\\n        quat.z = (m[1][0] - m[0][1]) * s;\\n    } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\\n        float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\\n        quat.w = (m[2][1] - m[1][2]) / s;\\n        quat.x = 0.25 * s;\\n        quat.y = (m[0][1] + m[1][0]) / s;\\n        quat.z = (m[0][2] + m[2][0]) / s;\\n    } else if (m[1][1] > m[2][2]) {\\n        float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\\n        quat.w = (m[0][2] - m[2][0]) / s;\\n        quat.x = (m[0][1] + m[1][0]) / s;\\n        quat.y = 0.25 * s;\\n        quat.z = (m[1][2] + m[2][1]) / s;\\n    } else {\\n        float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\\n        quat.w = (m[1][0] - m[0][1]) / s;\\n        quat.x = (m[0][2] + m[2][0]) / s;\\n        quat.y = (m[1][2] + m[2][1]) / s;\\n        quat.z = 0.25 * s;\\n    }\\n    float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\\n    if (len > 0.) {\\n        len = 1. / sqrt(len);\\n        quat.x = quat.x * len;\\n        quat.y = quat.y * len;\\n        quat.z = quat.z * len;\\n        quat.w = quat.w * len;\\n    }\\n    return quat;\\n}\\nvec4 quaternionFromEuler(vec3 angle){\\n    float x = angle.x / 2.;\\n    float y = angle.y / 2.;\\n    float z = angle.z / 2.;\\n    float sx = sin(x);\\n    float cx = cos(x);\\n    float sy = sin(y);\\n    float cy = cos(y);\\n    float sz = sin(z);\\n    float cz = cos(z);\\n    vec4 quat = vec4(0);\\n    quat.x = sx * cy * cz + cx * sy * sz;\\n    quat.y = cx * sy * cz + sx * cy * sz;\\n    quat.z = cx * cy * sz - sx * sy * cz;\\n    quat.w = cx * cy * cz - sx * sy * sz;\\n    return quat;\\n}\\nmat4 matrixFromRT(vec4 q, vec3 p){\\n    float x2 = q.x + q.x;\\n    float y2 = q.y + q.y;\\n    float z2 = q.z + q.z;\\n    float xx = q.x * x2;\\n    float xy = q.x * y2;\\n    float xz = q.x * z2;\\n    float yy = q.y * y2;\\n    float yz = q.y * z2;\\n    float zz = q.z * z2;\\n    float wx = q.w * x2;\\n    float wy = q.w * y2;\\n    float wz = q.w * z2;\\n    return mat4(\\n        1. - (yy + zz), xy + wz, xz - wy, 0,\\n        xy - wz, 1. - (xx + zz), yz + wx, 0,\\n        xz + wy, yz - wx, 1. - (xx + yy), 0,\\n        p.x, p.y, p.z, 1\\n    );\\n}\\nmat4 matFromRTS(vec4 q, vec3 t, vec3 s){\\n    float x = q.x, y = q.y, z = q.z, w = q.w;\\n    float x2 = x + x;\\n    float y2 = y + y;\\n    float z2 = z + z;\\n    float xx = x * x2;\\n    float xy = x * y2;\\n    float xz = x * z2;\\n    float yy = y * y2;\\n    float yz = y * z2;\\n    float zz = z * z2;\\n    float wx = w * x2;\\n    float wy = w * y2;\\n    float wz = w * z2;\\n    float sx = s.x;\\n    float sy = s.y;\\n    float sz = s.z;\\n    return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\\n        (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\\n        (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\\n        t.x, t.y, t.z, 1);\\n}\\nvec4 quatMultiply(vec4 a, vec4 b){\\n    vec4 quat;\\n    quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\\n    quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\\n    quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\\n    quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\\n    return quat;\\n}\\nvoid rotateVecFromQuat(inout vec3 v, vec4 q){\\n    float ix = q.w * v.x + q.y * v.z - q.z * v.y;\\n    float iy = q.w * v.y + q.z * v.x - q.x * v.z;\\n    float iz = q.w * v.z + q.x * v.y - q.y * v.x;\\n    float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\\n    v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\\n    v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\\n    v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\\n}\\nvec3 rotateInLocalSpace(vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\\n    float z = pos.z;\\n    float x = pos.x;\\n    float y = pos.y;\\n    vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\\n    vec4 rotQuat = quatMultiply(viewQuat, q);\\n    rotateVecFromQuat(pos, rotQuat);\\n    return pos;\\n}\\nvoid rotateCorner(inout vec2 corner, float angle){\\n    float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\\n    float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\\n    corner.x = xOS;\\n    corner.y = yOS;\\n}\\nuniform Constants{\\n    vec4 mainTiling_Offset;\\n    vec4 frameTile_velLenScale;\\n    vec4 scale;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nout vec2 uv;\\nout vec4 color;\\nvoid computeVertPos(inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\\n#if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n    , mat4 viewInv\\n#endif\\n#if CC_USE_STRETCHED_BILLBOARD\\n    , vec3 eye\\n    , vec4 velocity\\n    , float velocityScale\\n    , float lengthScale\\n    , float xIndex\\n#endif\\n) {\\n#if CC_USE_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\\n    vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\\n    vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\\n#elif CC_USE_STRETCHED_BILLBOARD\\n    vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\\n    vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\\n    pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\\n#elif CC_USE_HORIZONTAL_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = vec3(1, 0, 0);\\n    vec3 camY = vec3(0, 0, -1);\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\\n#elif CC_USE_VERTICAL_BILLBOARD\\n    vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\\n    rotateCorner(viewSpaceVert, q.z);\\n    vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\\n    vec3 camY = vec3(0, 1, 0);\\n    vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\\n    pos.xyz += offset;\\n#else\\n    pos.x += vertOffset.x;\\n    pos.y += vertOffset.y;\\n#endif\\n}\\nvec2 computeUV(float frameIndex, vec2 vertIndex, vec2 frameTile){\\n    vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\\n    aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\\n#if !CC_USE_MESH\\n    vertIndex.y = 1. - vertIndex.y;\\n#endif\\n    return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\\n}\\nin vec3 a_position;\\nin vec3 a_texCoord;\\nin vec3 a_texCoord1;\\nin vec3 a_texCoord2;\\nin vec4 a_color;\\n#if CC_USE_STRETCHED_BILLBOARD\\n    in vec3 a_color1;\\n#endif\\n#if CC_USE_MESH\\n    in vec3 a_texCoord3;\\n    in vec3 a_normal;\\n    in vec4 a_color1;\\n#endif\\nvec4 lpvs_main() {\\n    vec3 compScale = scale.xyz * a_texCoord1;\\n    vec4 pos = vec4(a_position, 1);\\n#if CC_USE_STRETCHED_BILLBOARD\\n    vec4 velocity = vec4(a_color1.xyz, 0);\\n#endif\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        velocity = cc_matWorld * velocity;\\n    #endif\\n#endif\\n#if !CC_USE_MESH\\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\\n    #if CC_USE_BILLBOARD\\n        vec3 rotEuler = a_texCoord2;\\n    #elif CC_USE_STRETCHED_BILLBOARD\\n        vec3 rotEuler = vec3(0.);\\n    #else\\n        vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\\n    #endif\\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\\n    #if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n        , cc_matViewInv\\n    #endif\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        , cc_cameraPos.xyz\\n        , velocity\\n        , frameTile_velLenScale.z\\n        , frameTile_velLenScale.w\\n        , a_texCoord.x\\n    #endif\\n    );\\n    color = a_color;\\n#else\\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\\n    pos = xform * vec4(a_texCoord3, 1);\\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\\n    color = a_color * a_color1;\\n#endif\\n    uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\\n    pos = cc_matViewProj * pos;\\n    return pos;\\n}\\nvoid main() { gl_Position = lpvs_main(); }","frag":"\\nprecision highp float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nin vec2 uv;\\nin vec4 color;\\nuniform sampler2D mainTexture;\\nvec4 premultiplied () {\\n  vec4 col = color * texture(mainTexture, uv) * color.a;\\n  return CCFragOutput(col);\\n}\\nout vec4 cc_FragColor;\\nvoid main() { cc_FragColor = premultiplied(); }"},"glsl1":{"vert":"\\nprecision highp float;\\nvec4 quaternionFromAxis(vec3 xAxis,vec3 yAxis,vec3 zAxis){\\n    mat3 m = mat3(xAxis,yAxis,zAxis);\\n    float trace = m[0][0] + m[1][1] + m[2][2];\\n    vec4 quat;\\n    if (trace > 0.) {\\n        float s = 0.5 / sqrt(trace + 1.0);\\n        quat.w = 0.25 / s;\\n        quat.x = (m[2][1] - m[1][2]) * s;\\n        quat.y = (m[0][2] - m[2][0]) * s;\\n        quat.z = (m[1][0] - m[0][1]) * s;\\n    } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\\n        float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\\n        quat.w = (m[2][1] - m[1][2]) / s;\\n        quat.x = 0.25 * s;\\n        quat.y = (m[0][1] + m[1][0]) / s;\\n        quat.z = (m[0][2] + m[2][0]) / s;\\n    } else if (m[1][1] > m[2][2]) {\\n        float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\\n        quat.w = (m[0][2] - m[2][0]) / s;\\n        quat.x = (m[0][1] + m[1][0]) / s;\\n        quat.y = 0.25 * s;\\n        quat.z = (m[1][2] + m[2][1]) / s;\\n    } else {\\n        float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\\n        quat.w = (m[1][0] - m[0][1]) / s;\\n        quat.x = (m[0][2] + m[2][0]) / s;\\n        quat.y = (m[1][2] + m[2][1]) / s;\\n        quat.z = 0.25 * s;\\n    }\\n    float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\\n    if (len > 0.) {\\n        len = 1. / sqrt(len);\\n        quat.x = quat.x * len;\\n        quat.y = quat.y * len;\\n        quat.z = quat.z * len;\\n        quat.w = quat.w * len;\\n    }\\n    return quat;\\n}\\nvec4 quaternionFromEuler(vec3 angle){\\n    float x = angle.x / 2.;\\n    float y = angle.y / 2.;\\n    float z = angle.z / 2.;\\n    float sx = sin(x);\\n    float cx = cos(x);\\n    float sy = sin(y);\\n    float cy = cos(y);\\n    float sz = sin(z);\\n    float cz = cos(z);\\n    vec4 quat = vec4(0);\\n    quat.x = sx * cy * cz + cx * sy * sz;\\n    quat.y = cx * sy * cz + sx * cy * sz;\\n    quat.z = cx * cy * sz - sx * sy * cz;\\n    quat.w = cx * cy * cz - sx * sy * sz;\\n    return quat;\\n}\\nmat4 matrixFromRT(vec4 q, vec3 p){\\n    float x2 = q.x + q.x;\\n    float y2 = q.y + q.y;\\n    float z2 = q.z + q.z;\\n    float xx = q.x * x2;\\n    float xy = q.x * y2;\\n    float xz = q.x * z2;\\n    float yy = q.y * y2;\\n    float yz = q.y * z2;\\n    float zz = q.z * z2;\\n    float wx = q.w * x2;\\n    float wy = q.w * y2;\\n    float wz = q.w * z2;\\n    return mat4(\\n        1. - (yy + zz), xy + wz, xz - wy, 0,\\n        xy - wz, 1. - (xx + zz), yz + wx, 0,\\n        xz + wy, yz - wx, 1. - (xx + yy), 0,\\n        p.x, p.y, p.z, 1\\n    );\\n}\\nmat4 matFromRTS(vec4 q, vec3 t, vec3 s){\\n    float x = q.x, y = q.y, z = q.z, w = q.w;\\n    float x2 = x + x;\\n    float y2 = y + y;\\n    float z2 = z + z;\\n    float xx = x * x2;\\n    float xy = x * y2;\\n    float xz = x * z2;\\n    float yy = y * y2;\\n    float yz = y * z2;\\n    float zz = z * z2;\\n    float wx = w * x2;\\n    float wy = w * y2;\\n    float wz = w * z2;\\n    float sx = s.x;\\n    float sy = s.y;\\n    float sz = s.z;\\n    return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\\n        (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\\n        (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\\n        t.x, t.y, t.z, 1);\\n}\\nvec4 quatMultiply(vec4 a, vec4 b){\\n    vec4 quat;\\n    quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\\n    quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\\n    quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\\n    quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\\n    return quat;\\n}\\nvoid rotateVecFromQuat(inout vec3 v, vec4 q){\\n    float ix = q.w * v.x + q.y * v.z - q.z * v.y;\\n    float iy = q.w * v.y + q.z * v.x - q.x * v.z;\\n    float iz = q.w * v.z + q.x * v.y - q.y * v.x;\\n    float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\\n    v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\\n    v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\\n    v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\\n}\\nvec3 rotateInLocalSpace(vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\\n    float z = pos.z;\\n    float x = pos.x;\\n    float y = pos.y;\\n    vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\\n    vec4 rotQuat = quatMultiply(viewQuat, q);\\n    rotateVecFromQuat(pos, rotQuat);\\n    return pos;\\n}\\nvoid rotateCorner(inout vec2 corner, float angle){\\n    float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\\n    float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\\n    corner.x = xOS;\\n    corner.y = yOS;\\n}\\nuniform vec4 mainTiling_Offset;\\nuniform vec4 frameTile_velLenScale;\\nuniform vec4 scale;\\nuniform mat4 cc_matView;\\nuniform mat4 cc_matViewInv;\\nuniform mat4 cc_matViewProj;\\nuniform vec4 cc_cameraPos;\\nuniform mat4 cc_matWorld;\\nvarying vec2 uv;\\nvarying vec4 color;\\nvoid computeVertPos(inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\\n#if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n    , mat4 viewInv\\n#endif\\n#if CC_USE_STRETCHED_BILLBOARD\\n    , vec3 eye\\n    , vec4 velocity\\n    , float velocityScale\\n    , float lengthScale\\n    , float xIndex\\n#endif\\n) {\\n#if CC_USE_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\\n    vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\\n    vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\\n#elif CC_USE_STRETCHED_BILLBOARD\\n    vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\\n    vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\\n    pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\\n#elif CC_USE_HORIZONTAL_BILLBOARD\\n    vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\\n    vec3 camX = vec3(1, 0, 0);\\n    vec3 camY = vec3(0, 0, -1);\\n    pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\\n#elif CC_USE_VERTICAL_BILLBOARD\\n    vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\\n    rotateCorner(viewSpaceVert, q.z);\\n    vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\\n    vec3 camY = vec3(0, 1, 0);\\n    vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\\n    pos.xyz += offset;\\n#else\\n    pos.x += vertOffset.x;\\n    pos.y += vertOffset.y;\\n#endif\\n}\\nvec2 computeUV(float frameIndex, vec2 vertIndex, vec2 frameTile){\\n    vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\\n    aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\\n#if !CC_USE_MESH\\n    vertIndex.y = 1. - vertIndex.y;\\n#endif\\n    return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\\n}\\nattribute vec3 a_position;\\nattribute vec3 a_texCoord;\\nattribute vec3 a_texCoord1;\\nattribute vec3 a_texCoord2;\\nattribute vec4 a_color;\\n#if CC_USE_STRETCHED_BILLBOARD\\n    attribute vec3 a_color1;\\n#endif\\n#if CC_USE_MESH\\n    attribute vec3 a_texCoord3;\\n    attribute vec3 a_normal;\\n    attribute vec4 a_color1;\\n#endif\\nvec4 lpvs_main() {\\n    vec3 compScale = scale.xyz * a_texCoord1;\\n    vec4 pos = vec4(a_position, 1);\\n#if CC_USE_STRETCHED_BILLBOARD\\n    vec4 velocity = vec4(a_color1.xyz, 0);\\n#endif\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        velocity = cc_matWorld * velocity;\\n    #endif\\n#endif\\n#if !CC_USE_MESH\\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\\n    #if CC_USE_BILLBOARD\\n        vec3 rotEuler = a_texCoord2;\\n    #elif CC_USE_STRETCHED_BILLBOARD\\n        vec3 rotEuler = vec3(0.);\\n    #else\\n        vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\\n    #endif\\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\\n    #if CC_USE_BILLBOARD || CC_USE_VERTICAL_BILLBOARD\\n        , cc_matViewInv\\n    #endif\\n    #if CC_USE_STRETCHED_BILLBOARD\\n        , cc_cameraPos.xyz\\n        , velocity\\n        , frameTile_velLenScale.z\\n        , frameTile_velLenScale.w\\n        , a_texCoord.x\\n    #endif\\n    );\\n    color = a_color;\\n#else\\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\\n    pos = xform * vec4(a_texCoord3, 1);\\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\\n    color = a_color * a_color1;\\n#endif\\n    uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\\n    pos = cc_matViewProj * pos;\\n    return pos;\\n}\\nvoid main() { gl_Position = lpvs_main(); }","frag":"\\nprecision highp float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nvarying vec2 uv;\\nvarying vec4 color;\\nuniform sampler2D mainTexture;\\nvec4 premultiplied () {\\n  vec4 col = color * texture2D(mainTexture, uv) * color.a;\\n  return CCFragOutput(col);\\n}\\nvoid main() { gl_FragColor = premultiplied(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_USE_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_STRETCHED_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_HORIZONTAL_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_VERTICAL_BILLBOARD","type":"boolean","defines":[]},{"name":"CC_USE_MESH","type":"boolean","defines":[]},{"name":"CC_USE_WORLD_SPACE","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"Constants","members":[{"name":"mainTiling_Offset","type":16,"count":1},{"name":"frameTile_velLenScale","type":16,"count":1},{"name":"scale","type":16,"count":1}],"defines":[],"binding":0}],"samplers":[{"name":"mainTexture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-3d-particle|particle-vs-legacy:lpvs_main|no-tint-fs:premultiplied"}]}]',"res/import/07/079499991.json":'[{"__type__":"cc.Material","_name":"builtin-unlit","_effectAsset":{"__uuid__":"6dkeWRTOBGXICfYQ7JUBnG"},"_techniqueData":{"0":{"props":{"diffuseTexture":{"__uuid__":"02delMVqdBD70a/HSD99FK"}},"defines":{"USE_DIFFUSE_TEXTURE":true}}}},{"__type__":"cc.EffectAsset","_name":"builtin-unlit","techniques":[{"name":"opaque","passes":[{"blendState":{"targets":[{"blend":true}]},"rasterizerState":{"cullMode":0},"depthStencilState":{"depthTest":true,"depthWrite":true},"properties":{"diffuseTexture":{"value":"white","type":29},"diffuseColor":{"value":[1,1,1,1],"editor":{"type":"color"},"type":16},"alphaThreshold":{"value":[0.5],"type":13},"mainTiling":{"value":[1,1],"type":14},"mainOffset":{"value":[0,0],"type":14}},"program":"builtin-unlit|unlit-vs|unlit-fs"}]},{"name":"transparent","passes":[{"stage":"transparent","blendState":{"targets":[{"blend":true}]},"rasterizerState":{"cullMode":0},"depthStencilState":{"depthTest":true,"depthWrite":true},"properties":{"diffuseTexture":{"value":"white","type":29},"diffuseColor":{"value":[1,1,1,1],"editor":{"type":"color"},"type":16},"alphaThreshold":{"value":[0.5],"type":13},"mainTiling":{"value":[1,1],"type":14},"mainOffset":{"value":[0,0],"type":14}},"program":"builtin-unlit|unlit-vs|unlit-fs"}]}],"shaders":[{"hash":922858114,"glsl3":{"vert":"\\nprecision highp float;\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\n#if CC_USE_SKINNING\\n  in vec4 a_weights;\\n  in vec4 a_joints;\\n  #if CC_USE_JOINTS_TEXTRUE\\n    uniform SKINNING {\\n      vec2 jointsTextureSize;\\n    };\\n    uniform sampler2D jointsTexture;\\n    #if CC_JOINTS_TEXTURE_FLOAT32\\n      mat4 getBoneMatrix(const in float i) {\\n        float width = jointsTextureSize.x;\\n        float height = jointsTextureSize.y;\\n        float j = i * 4.0;\\n        float x = mod(j, width);\\n        float y = floor(j / width);\\n        float dx = 1.0 / width;\\n        float dy = 1.0 / height;\\n        y = dy * (y + 0.5);\\n        vec4 v1 = texture(jointsTexture, vec2(dx * (x + 0.5), y));\\n        vec4 v2 = texture(jointsTexture, vec2(dx * (x + 1.5), y));\\n        vec4 v3 = texture(jointsTexture, vec2(dx * (x + 2.5), y));\\n        vec4 v4 = texture(jointsTexture, vec2(dx * (x + 3.5), y));\\n        return mat4(v1, v2, v3, v4);\\n      }\\n    #else\\n      float decode32(vec4 rgba) {\\n        float Sign = 1.0 - step(128.0, rgba[0]) * 2.0;\\n        float Exponent = 2.0 * mod(rgba[0], 128.0) + step(128.0, rgba[1]) - 127.0;\\n        float Mantissa = mod(rgba[1], 128.0) * 65536.0 + rgba[2] * 256.0 + rgba[3] + 8388608.0;\\n        return Sign * exp2(Exponent - 23.0) * Mantissa;\\n      }\\n      vec4 decodevec4 (vec4 x, vec4 y, vec4 z, vec4 w) {\\n        return vec4(\\n          decode32(x.wzyx * 255.0),\\n          decode32(y.wzyx * 255.0),\\n          decode32(z.wzyx * 255.0),\\n          decode32(w.wzyx * 255.0)\\n        );\\n      }\\n      vec4 decodevec4 (float dx, float x, float y) {\\n        return decodevec4(\\n          texture(jointsTexture, vec2(dx * (x + 0.5), y)),\\n          texture(jointsTexture, vec2(dx * (x + 1.5), y)),\\n          texture(jointsTexture, vec2(dx * (x + 2.5), y)),\\n          texture(jointsTexture, vec2(dx * (x + 3.5), y))\\n        );\\n      }\\n      mat4 getBoneMatrix(const in float i) {\\n        float width = jointsTextureSize.x;\\n        float height = jointsTextureSize.y;\\n        float j = i * 16.0;\\n        float x = mod(j, width);\\n        float y = floor(j / width);\\n        float dx = 1.0 / width;\\n        float dy = 1.0 / height;\\n        y = dy * (y + 0.5);\\n        vec4 v1 = decodevec4(dx, x,       y);\\n        vec4 v2 = decodevec4(dx, x+4.0,   y);\\n        vec4 v3 = decodevec4(dx, x+8.0,   y);\\n        vec4 v4 = decodevec4(dx, x+12.0,  y);\\n        return mat4(v1, v2, v3, v4);\\n      }\\n    #endif\\n  #else\\n    uniform JOINT_MATRIX {\\n      mat4 jointMatrices[50];\\n    };\\n    mat4 getBoneMatrix(const in float i) {\\n      return jointMatrices[int(i)];\\n    }\\n  #endif\\n    mat4 skinMatrix() {\\n      return\\n        getBoneMatrix(a_joints.x) * a_weights.x +\\n        getBoneMatrix(a_joints.y) * a_weights.y +\\n        getBoneMatrix(a_joints.z) * a_weights.z +\\n        getBoneMatrix(a_joints.w) * a_weights.w\\n        ;\\n    }\\n#endif\\nstruct StandardVertInput {\\n  vec2 uv;\\n  vec4 position;\\n  vec3 normal;\\n  vec4 tangent;\\n  vec4 color;\\n};\\nin vec3 a_position;\\n#if CC_USE_ATTRIBUTE_UV0\\nin vec2 a_uv0;\\n#endif\\n#if CC_USE_ATTRIBUTE_COLOR\\nin vec4 a_color;\\n#endif\\n#if CC_USE_ATTRIBUTE_NORMAL\\nin vec3 a_normal;\\n#endif\\n#if CC_USE_ATTRIBUTE_TANGENT\\nin vec4 a_tangent;\\n#endif\\nvoid CCAttribute (out StandardVertInput In) {\\n  In.position = vec4(a_position, 1.0);\\n  #if CC_USE_ATTRIBUTE_UV0\\n    In.uv = a_uv0;\\n  #else\\n    In.uv = vec2(0.0);\\n  #endif\\n  #if CC_USE_ATTRIBUTE_COLOR\\n    In.color = a_color;\\n  #else\\n    In.color = vec4(1.0);\\n  #endif\\n  #if CC_USE_ATTRIBUTE_NORMAL\\n    In.normal = a_normal;\\n  #else\\n    In.normal = vec3(0.0, 1.0, 0.0);\\n  #endif\\n  #if CC_USE_ATTRIBUTE_TANGENT\\n    In.tangent = a_tangent;\\n  #else\\n    In.tangent = vec4(1.0, 0.0, 0.0, 0.0);\\n  #endif\\n}\\nvoid CCVertInput(out StandardVertInput In) {\\n  CCAttribute(In);\\n  #if CC_USE_SKINNING\\n    mat4 m = skinMatrix();\\n    In.position = m * In.position;\\n    #if CC_USE_ATTRIBUTE_NORMAL\\n      In.normal = (m * vec4(In.normal, 0)).xyz;\\n    #endif\\n    #if CC_USE_ATTRIBUTE_TANGENT\\n      In.tangent = m * In.tangent;\\n    #endif\\n  #endif\\n}\\nuniform MAIN_TILING {\\n  vec2 mainTiling;\\n  vec2 mainOffset;\\n};\\n#if CC_USE_ATTRIBUTE_UV0 && USE_DIFFUSE_TEXTURE\\n  out mediump vec2 v_uv0;\\n#endif\\n#if CC_USE_ATTRIBUTE_COLOR\\n  out lowp vec4 v_color;\\n#endif\\nvoid main () {\\n  StandardVertInput In;\\n  CCVertInput(In);\\n  #if CC_USE_ATTRIBUTE_COLOR\\n    v_color = In.color;\\n  #endif\\n  #if CC_USE_ATTRIBUTE_UV0 && USE_DIFFUSE_TEXTURE\\n    v_uv0 = In.uv * mainTiling + mainOffset;\\n  #endif\\n  gl_Position = cc_matViewProj * cc_matWorld * In.position;\\n}","frag":"\\nprecision highp float;\\n#if USE_ALPHA_TEST\\n  uniform ALPHA_TEST {\\n    float alphaThreshold;\\n  };\\n#endif\\nvoid ALPHA_TEST (in vec4 color) {\\n  #if USE_ALPHA_TEST\\n      if (color.a < alphaThreshold) discard;\\n  #endif\\n}\\nvoid ALPHA_TEST (in float alpha) {\\n  #if USE_ALPHA_TEST\\n      if (alpha < alphaThreshold) discard;\\n  #endif\\n}\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nuniform UNLIT {\\n  lowp vec4 diffuseColor;\\n};\\n#if USE_DIFFUSE_TEXTURE\\n  uniform sampler2D diffuseTexture;\\n#endif\\n#if CC_USE_ATTRIBUTE_COLOR\\n  in lowp vec4 v_color;\\n#endif\\n#if CC_USE_ATTRIBUTE_UV0 && USE_DIFFUSE_TEXTURE\\n  in mediump vec2 v_uv0;\\n#endif\\nvoid main () {\\n  vec4 color = diffuseColor;\\n  #if CC_USE_ATTRIBUTE_UV0 && USE_DIFFUSE_TEXTURE\\n  vec4 diffuseTexture_tmp = texture(diffuseTexture, v_uv0);\\n  #if CC_USE_ALPHA_ATLAS_diffuseTexture\\n      diffuseTexture_tmp.a *= texture(diffuseTexture, v_uv0 + vec2(0, 0.5)).r;\\n  #endif\\n  #if INPUT_IS_GAMMA\\n    color.rgb *= (diffuseTexture_tmp.rgb * diffuseTexture_tmp.rgb);\\n    color.a *= diffuseTexture_tmp.a;\\n  #else\\n    color *= diffuseTexture_tmp;\\n  #endif\\n  #endif\\n  #if CC_USE_ATTRIBUTE_COLOR\\n    color *= v_color;\\n  #endif\\n  ALPHA_TEST(color);\\n  gl_FragColor = CCFragOutput(color);\\n}"},"glsl1":{"vert":"\\nprecision highp float;\\nuniform mat4 cc_matWorld;\\nuniform mat4 cc_matViewProj;\\n#if CC_USE_SKINNING\\n  attribute vec4 a_weights;\\n  attribute vec4 a_joints;\\n  #if CC_USE_JOINTS_TEXTRUE\\n    uniform vec2 jointsTextureSize;\\n    uniform sampler2D jointsTexture;\\n    #if CC_JOINTS_TEXTURE_FLOAT32\\n      mat4 getBoneMatrix(const in float i) {\\n        float width = jointsTextureSize.x;\\n        float height = jointsTextureSize.y;\\n        float j = i * 4.0;\\n        float x = mod(j, width);\\n        float y = floor(j / width);\\n        float dx = 1.0 / width;\\n        float dy = 1.0 / height;\\n        y = dy * (y + 0.5);\\n        vec4 v1 = texture2D(jointsTexture, vec2(dx * (x + 0.5), y));\\n        vec4 v2 = texture2D(jointsTexture, vec2(dx * (x + 1.5), y));\\n        vec4 v3 = texture2D(jointsTexture, vec2(dx * (x + 2.5), y));\\n        vec4 v4 = texture2D(jointsTexture, vec2(dx * (x + 3.5), y));\\n        return mat4(v1, v2, v3, v4);\\n      }\\n    #else\\n      float decode32(vec4 rgba) {\\n        float Sign = 1.0 - step(128.0, rgba[0]) * 2.0;\\n        float Exponent = 2.0 * mod(rgba[0], 128.0) + step(128.0, rgba[1]) - 127.0;\\n        float Mantissa = mod(rgba[1], 128.0) * 65536.0 + rgba[2] * 256.0 + rgba[3] + 8388608.0;\\n        return Sign * exp2(Exponent - 23.0) * Mantissa;\\n      }\\n      vec4 decodevec4 (vec4 x, vec4 y, vec4 z, vec4 w) {\\n        return vec4(\\n          decode32(x.wzyx * 255.0),\\n          decode32(y.wzyx * 255.0),\\n          decode32(z.wzyx * 255.0),\\n          decode32(w.wzyx * 255.0)\\n        );\\n      }\\n      vec4 decodevec4 (float dx, float x, float y) {\\n        return decodevec4(\\n          texture2D(jointsTexture, vec2(dx * (x + 0.5), y)),\\n          texture2D(jointsTexture, vec2(dx * (x + 1.5), y)),\\n          texture2D(jointsTexture, vec2(dx * (x + 2.5), y)),\\n          texture2D(jointsTexture, vec2(dx * (x + 3.5), y))\\n        );\\n      }\\n      mat4 getBoneMatrix(const in float i) {\\n        float width = jointsTextureSize.x;\\n        float height = jointsTextureSize.y;\\n        float j = i * 16.0;\\n        float x = mod(j, width);\\n        float y = floor(j / width);\\n        float dx = 1.0 / width;\\n        float dy = 1.0 / height;\\n        y = dy * (y + 0.5);\\n        vec4 v1 = decodevec4(dx, x,       y);\\n        vec4 v2 = decodevec4(dx, x+4.0,   y);\\n        vec4 v3 = decodevec4(dx, x+8.0,   y);\\n        vec4 v4 = decodevec4(dx, x+12.0,  y);\\n        return mat4(v1, v2, v3, v4);\\n      }\\n    #endif\\n  #else\\n    uniform mat4 jointMatrices[50];\\n    mat4 getBoneMatrix(const in float i) {\\n      return jointMatrices[int(i)];\\n    }\\n  #endif\\n    mat4 skinMatrix() {\\n      return\\n        getBoneMatrix(a_joints.x) * a_weights.x +\\n        getBoneMatrix(a_joints.y) * a_weights.y +\\n        getBoneMatrix(a_joints.z) * a_weights.z +\\n        getBoneMatrix(a_joints.w) * a_weights.w\\n        ;\\n    }\\n#endif\\nstruct StandardVertInput {\\n  vec2 uv;\\n  vec4 position;\\n  vec3 normal;\\n  vec4 tangent;\\n  vec4 color;\\n};\\nattribute vec3 a_position;\\n#if CC_USE_ATTRIBUTE_UV0\\nattribute vec2 a_uv0;\\n#endif\\n#if CC_USE_ATTRIBUTE_COLOR\\nattribute vec4 a_color;\\n#endif\\n#if CC_USE_ATTRIBUTE_NORMAL\\nattribute vec3 a_normal;\\n#endif\\n#if CC_USE_ATTRIBUTE_TANGENT\\nattribute vec4 a_tangent;\\n#endif\\nvoid CCAttribute (out StandardVertInput In) {\\n  In.position = vec4(a_position, 1.0);\\n  #if CC_USE_ATTRIBUTE_UV0\\n    In.uv = a_uv0;\\n  #else\\n    In.uv = vec2(0.0);\\n  #endif\\n  #if CC_USE_ATTRIBUTE_COLOR\\n    In.color = a_color;\\n  #else\\n    In.color = vec4(1.0);\\n  #endif\\n  #if CC_USE_ATTRIBUTE_NORMAL\\n    In.normal = a_normal;\\n  #else\\n    In.normal = vec3(0.0, 1.0, 0.0);\\n  #endif\\n  #if CC_USE_ATTRIBUTE_TANGENT\\n    In.tangent = a_tangent;\\n  #else\\n    In.tangent = vec4(1.0, 0.0, 0.0, 0.0);\\n  #endif\\n}\\nvoid CCVertInput(out StandardVertInput In) {\\n  CCAttribute(In);\\n  #if CC_USE_SKINNING\\n    mat4 m = skinMatrix();\\n    In.position = m * In.position;\\n    #if CC_USE_ATTRIBUTE_NORMAL\\n      In.normal = (m * vec4(In.normal, 0)).xyz;\\n    #endif\\n    #if CC_USE_ATTRIBUTE_TANGENT\\n      In.tangent = m * In.tangent;\\n    #endif\\n  #endif\\n}\\nuniform vec2 mainTiling;\\nuniform vec2 mainOffset;\\n#if CC_USE_ATTRIBUTE_UV0 && USE_DIFFUSE_TEXTURE\\n  varying mediump vec2 v_uv0;\\n#endif\\n#if CC_USE_ATTRIBUTE_COLOR\\n  varying lowp vec4 v_color;\\n#endif\\nvoid main () {\\n  StandardVertInput In;\\n  CCVertInput(In);\\n  #if CC_USE_ATTRIBUTE_COLOR\\n    v_color = In.color;\\n  #endif\\n  #if CC_USE_ATTRIBUTE_UV0 && USE_DIFFUSE_TEXTURE\\n    v_uv0 = In.uv * mainTiling + mainOffset;\\n  #endif\\n  gl_Position = cc_matViewProj * cc_matWorld * In.position;\\n}","frag":"\\nprecision highp float;\\n#if USE_ALPHA_TEST\\n  uniform float alphaThreshold;\\n#endif\\nvoid ALPHA_TEST (in vec4 color) {\\n  #if USE_ALPHA_TEST\\n      if (color.a < alphaThreshold) discard;\\n  #endif\\n}\\nvoid ALPHA_TEST (in float alpha) {\\n  #if USE_ALPHA_TEST\\n      if (alpha < alphaThreshold) discard;\\n  #endif\\n}\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nuniform lowp vec4 diffuseColor;\\n#if USE_DIFFUSE_TEXTURE\\n  uniform sampler2D diffuseTexture;\\n#endif\\n#if CC_USE_ATTRIBUTE_COLOR\\n  varying lowp vec4 v_color;\\n#endif\\n#if CC_USE_ATTRIBUTE_UV0 && USE_DIFFUSE_TEXTURE\\n  varying mediump vec2 v_uv0;\\n#endif\\nvoid main () {\\n  vec4 color = diffuseColor;\\n  #if CC_USE_ATTRIBUTE_UV0 && USE_DIFFUSE_TEXTURE\\n  vec4 diffuseTexture_tmp = texture2D(diffuseTexture, v_uv0);\\n  #if CC_USE_ALPHA_ATLAS_diffuseTexture\\n      diffuseTexture_tmp.a *= texture2D(diffuseTexture, v_uv0 + vec2(0, 0.5)).r;\\n  #endif\\n  #if INPUT_IS_GAMMA\\n    color.rgb *= (diffuseTexture_tmp.rgb * diffuseTexture_tmp.rgb);\\n    color.a *= diffuseTexture_tmp.a;\\n  #else\\n    color *= diffuseTexture_tmp;\\n  #endif\\n  #endif\\n  #if CC_USE_ATTRIBUTE_COLOR\\n    color *= v_color;\\n  #endif\\n  ALPHA_TEST(color);\\n  gl_FragColor = CCFragOutput(color);\\n}"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_USE_SKINNING","type":"boolean","defines":[]},{"name":"CC_USE_JOINTS_TEXTRUE","type":"boolean","defines":["CC_USE_SKINNING"]},{"name":"CC_JOINTS_TEXTURE_FLOAT32","type":"boolean","defines":["CC_USE_SKINNING","CC_USE_JOINTS_TEXTRUE"]},{"name":"CC_USE_ATTRIBUTE_UV0","type":"boolean","defines":[]},{"name":"CC_USE_ATTRIBUTE_COLOR","type":"boolean","defines":[]},{"name":"CC_USE_ATTRIBUTE_NORMAL","type":"boolean","defines":[]},{"name":"CC_USE_ATTRIBUTE_TANGENT","type":"boolean","defines":[]},{"name":"USE_DIFFUSE_TEXTURE","type":"boolean","defines":[]},{"name":"USE_ALPHA_TEST","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]},{"name":"CC_USE_ALPHA_ATLAS_diffuseTexture","type":"boolean","defines":["CC_USE_ATTRIBUTE_UV0","USE_DIFFUSE_TEXTURE"]},{"name":"INPUT_IS_GAMMA","type":"boolean","defines":["CC_USE_ATTRIBUTE_UV0","USE_DIFFUSE_TEXTURE"]}],"blocks":[{"name":"SKINNING","members":[{"name":"jointsTextureSize","type":14,"count":1}],"defines":["CC_USE_SKINNING","CC_USE_JOINTS_TEXTRUE"],"binding":0},{"name":"JOINT_MATRIX","members":[{"name":"jointMatrices","type":26,"count":50}],"defines":["CC_USE_SKINNING"],"binding":1},{"name":"MAIN_TILING","members":[{"name":"mainTiling","type":14,"count":1},{"name":"mainOffset","type":14,"count":1}],"defines":[],"binding":2},{"name":"ALPHA_TEST","members":[{"name":"alphaThreshold","type":13,"count":1}],"defines":["USE_ALPHA_TEST"],"binding":3},{"name":"UNLIT","members":[{"name":"diffuseColor","type":16,"count":1}],"defines":[],"binding":4}],"samplers":[{"name":"jointsTexture","type":29,"count":1,"defines":["CC_USE_SKINNING","CC_USE_JOINTS_TEXTRUE"],"binding":30},{"name":"diffuseTexture","type":29,"count":1,"defines":["USE_DIFFUSE_TEXTURE"],"binding":31}],"record":null,"name":"builtin-unlit|unlit-vs|unlit-fs"}]}]',"res/import/07/07ce7530a.json":'[{"__type__":"cc.EffectAsset","_name":"builtin-2d-gray-sprite","techniques":[{"passes":[{"blendState":{"targets":[{"blend":true}]},"rasterizerState":{"cullMode":0},"properties":{"texture":{"value":"white","type":29}},"program":"builtin-2d-gray-sprite|vs|fs"}]}],"shaders":[{"hash":4278481454,"glsl3":{"vert":"\\nprecision highp float;\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nin vec3 a_position;\\nin mediump vec2 a_uv0;\\nout mediump vec2 v_uv0;\\nin vec4 a_color;\\nout vec4 v_color;\\nvoid main () {\\n  gl_Position = cc_matViewProj * vec4(a_position, 1);\\n  v_uv0 = a_uv0;\\n  v_color = a_color;\\n}","frag":"\\nprecision highp float;\\nuniform sampler2D texture;\\nin mediump vec2 v_uv0;\\nin vec4 v_color;\\nvoid main () {\\n  vec4 color = v_color;\\n  vec4 texture_tmp = texture(texture, v_uv0);\\n  #if CC_USE_ALPHA_ATLAS_texture\\n      texture_tmp.a *= texture(texture, v_uv0 + vec2(0, 0.5)).r;\\n  #endif\\n  #if INPUT_IS_GAMMA\\n    color.rgb *= (texture_tmp.rgb * texture_tmp.rgb);\\n    color.a *= texture_tmp.a;\\n  #else\\n    color *= texture_tmp;\\n  #endif\\n  float gray = 0.2126*color.r + 0.7152*color.g + 0.0722*color.b;\\n  gl_FragColor = vec4(gray, gray, gray, color.a);\\n}"},"glsl1":{"vert":"\\nprecision highp float;\\nuniform mat4 cc_matViewProj;\\nattribute vec3 a_position;\\nattribute mediump vec2 a_uv0;\\nvarying mediump vec2 v_uv0;\\nattribute vec4 a_color;\\nvarying vec4 v_color;\\nvoid main () {\\n  gl_Position = cc_matViewProj * vec4(a_position, 1);\\n  v_uv0 = a_uv0;\\n  v_color = a_color;\\n}","frag":"\\nprecision highp float;\\nuniform sampler2D texture;\\nvarying mediump vec2 v_uv0;\\nvarying vec4 v_color;\\nvoid main () {\\n  vec4 color = v_color;\\n  vec4 texture_tmp = texture2D(texture, v_uv0);\\n  #if CC_USE_ALPHA_ATLAS_texture\\n      texture_tmp.a *= texture2D(texture, v_uv0 + vec2(0, 0.5)).r;\\n  #endif\\n  #if INPUT_IS_GAMMA\\n    color.rgb *= (texture_tmp.rgb * texture_tmp.rgb);\\n    color.a *= texture_tmp.a;\\n  #else\\n    color *= texture_tmp;\\n  #endif\\n  float gray = 0.2126*color.r + 0.7152*color.g + 0.0722*color.b;\\n  gl_FragColor = vec4(gray, gray, gray, color.a);\\n}"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[],"samplers":[]}},"defines":[{"name":"CC_USE_ALPHA_ATLAS_texture","type":"boolean","defines":[]},{"name":"INPUT_IS_GAMMA","type":"boolean","defines":[]}],"blocks":[],"samplers":[{"name":"texture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-2d-gray-sprite|vs|fs"}]},{"__type__":"cc.Material","_name":"builtin-2d-gray-sprite","_effectAsset":{"__uuid__":"14TDKXr2NJ6LjvHPops74o"},"_techniqueData":{}}]',"res/import/0a/0a5cba09d.json":'[{"__type__":"cc.EffectAsset","_name":"builtin-3d-trail","techniques":[{"name":"add","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":770,"blendDst":1,"blendSrcAlpha":770,"blendDstAlpha":1}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16},"frameTile_velLenScale":{"value":[1,1,0,0],"type":16},"tintColor":{"value":[0.5,0.5,0.5,0.5],"inspector":{"type":"color"},"type":16}},"program":"builtin-3d-trail|particle-trail:vs_main|tinted-fs:add"}]},{"name":"alpha-blend","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":1,"blendDst":771,"blendSrcAlpha":1,"blendDstAlpha":771}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16},"frameTile_velLenScale":{"value":[1,1,0,0],"type":16},"tintColor":{"value":[0.5,0.5,0.5,0.5],"inspector":{"type":"color"},"type":16}},"program":"builtin-3d-trail|particle-trail:vs_main|tinted-fs:add"}]},{"name":"add-multiply","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":1,"blendDst":771,"blendSrcAlpha":1,"blendDstAlpha":771}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16},"frameTile_velLenScale":{"value":[1,1,0,0],"type":16},"tintColor":{"value":[0.5,0.5,0.5,0.5],"inspector":{"type":"color"},"type":16}},"program":"builtin-3d-trail|particle-trail:vs_main|tinted-fs:multiply"}]},{"name":"add-smooth","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":1,"blendDst":771,"blendSrcAlpha":1,"blendDstAlpha":771}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16},"frameTile_velLenScale":{"value":[1,1,0,0],"type":16}},"program":"builtin-3d-trail|particle-trail:vs_main|no-tint-fs:addSmooth"}]},{"name":"premultiply-blend","passes":[{"rasterizerState":{"cullMode":0},"blendState":{"targets":[{"blend":true,"blendSrc":1,"blendDst":771,"blendSrcAlpha":1,"blendDstAlpha":771}]},"depthStencilState":{"depthTest":true,"depthWrite":false},"properties":{"mainTexture":{"value":"grey","type":29},"mainTiling_Offset":{"value":[1,1,0,0],"type":16},"frameTile_velLenScale":{"value":[1,1,0,0],"type":16}},"program":"builtin-3d-trail|particle-trail:vs_main|no-tint-fs:premultiplied"}]}],"shaders":[{"hash":2929688198,"glsl3":{"vert":"\\nprecision mediump float;\\nuniform Constants{\\n    vec4 mainTiling_Offset;\\n    vec4 frameTile_velLenScale;\\n    vec4 scale;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nout vec2 uv;\\nout vec4 color;\\nin vec3 a_position;\\nin vec4 a_texCoord;\\nin vec3 a_texCoord1;\\nin vec3 a_texCoord2;\\nin vec4 a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    out vec3 vBarycentric;\\n#endif\\nvec4 vs_main() {\\n    highp vec4 pos = vec4(a_position, 1);\\n    vec4 velocity = vec4(a_texCoord1.xyz, 0);\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    velocity = cc_matWorld * velocity;\\n#endif\\n    float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\\n    vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\\n    pos.xyz += camUp * vertOffset;\\n    pos = cc_matViewProj * pos;\\n    uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\\n    color = a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    vBarycentric = a_texCoord2;\\n#endif\\n    return pos;\\n}\\nvoid main() { gl_Position = vs_main(); }","frag":"\\nprecision mediump float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nin vec2 uv;\\nin vec4 color;\\n#if CC_DRAW_WIRE_FRAME\\n  in vec3 vBarycentric;\\n#endif\\nuniform sampler2D mainTexture;\\nuniform FragConstants {\\n  vec4 tintColor;\\n};\\nvec4 add () {\\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\\n  #if CC_DRAW_WIRE_FRAME\\n      if (any(lessThan(vBarycentric, vec3(0.02)))) {\\n          col = vec4(0., 1., 1., 1.);\\n      }\\n  #endif\\n  return CCFragOutput(col);\\n}\\nout vec4 cc_FragColor;\\nvoid main() { cc_FragColor = add(); }"},"glsl1":{"vert":"\\nprecision mediump float;\\nuniform vec4 mainTiling_Offset;\\nuniform mat4 cc_matViewProj;\\nuniform vec4 cc_cameraPos;\\nuniform mat4 cc_matWorld;\\nvarying vec2 uv;\\nvarying vec4 color;\\nattribute vec3 a_position;\\nattribute vec4 a_texCoord;\\nattribute vec3 a_texCoord1;\\nattribute vec3 a_texCoord2;\\nattribute vec4 a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    varying vec3 vBarycentric;\\n#endif\\nvec4 vs_main() {\\n    highp vec4 pos = vec4(a_position, 1);\\n    vec4 velocity = vec4(a_texCoord1.xyz, 0);\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    velocity = cc_matWorld * velocity;\\n#endif\\n    float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\\n    vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\\n    pos.xyz += camUp * vertOffset;\\n    pos = cc_matViewProj * pos;\\n    uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\\n    color = a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    vBarycentric = a_texCoord2;\\n#endif\\n    return pos;\\n}\\nvoid main() { gl_Position = vs_main(); }","frag":"\\nprecision mediump float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nvarying vec2 uv;\\nvarying vec4 color;\\n#if CC_DRAW_WIRE_FRAME\\n  varying vec3 vBarycentric;\\n#endif\\nuniform sampler2D mainTexture;\\nuniform vec4 tintColor;\\nvec4 add () {\\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\\n  #if CC_DRAW_WIRE_FRAME\\n      if (any(lessThan(vBarycentric, vec3(0.02)))) {\\n          col = vec4(0., 1., 1., 1.);\\n      }\\n  #endif\\n  return CCFragOutput(col);\\n}\\nvoid main() { gl_FragColor = add(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_DRAW_WIRE_FRAME","type":"boolean","defines":[]},{"name":"CC_USE_WORLD_SPACE","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"Constants","members":[{"name":"mainTiling_Offset","type":16,"count":1},{"name":"frameTile_velLenScale","type":16,"count":1},{"name":"scale","type":16,"count":1}],"defines":[],"binding":0},{"name":"FragConstants","members":[{"name":"tintColor","type":16,"count":1}],"defines":[],"binding":1}],"samplers":[{"name":"mainTexture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-3d-trail|particle-trail:vs_main|tinted-fs:add"},{"hash":4224037318,"glsl3":{"vert":"\\nprecision mediump float;\\nuniform Constants{\\n    vec4 mainTiling_Offset;\\n    vec4 frameTile_velLenScale;\\n    vec4 scale;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nout vec2 uv;\\nout vec4 color;\\nin vec3 a_position;\\nin vec4 a_texCoord;\\nin vec3 a_texCoord1;\\nin vec3 a_texCoord2;\\nin vec4 a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    out vec3 vBarycentric;\\n#endif\\nvec4 vs_main() {\\n    highp vec4 pos = vec4(a_position, 1);\\n    vec4 velocity = vec4(a_texCoord1.xyz, 0);\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    velocity = cc_matWorld * velocity;\\n#endif\\n    float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\\n    vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\\n    pos.xyz += camUp * vertOffset;\\n    pos = cc_matViewProj * pos;\\n    uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\\n    color = a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    vBarycentric = a_texCoord2;\\n#endif\\n    return pos;\\n}\\nvoid main() { gl_Position = vs_main(); }","frag":"\\nprecision mediump float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nin vec2 uv;\\nin vec4 color;\\n#if CC_DRAW_WIRE_FRAME\\n  in vec3 vBarycentric;\\n#endif\\nuniform sampler2D mainTexture;\\nuniform FragConstants {\\n  vec4 tintColor;\\n};\\nvec4 multiply () {\\n  vec4 col;\\n  vec4 texColor = texture(mainTexture, uv);\\n  col.rgb = tintColor.rgb * texColor.rgb * color.rgb * vec3(2.0);\\n  col.a = (1.0 - texColor.a) * (tintColor.a * color.a * 2.0);\\n  #if CC_DRAW_WIRE_FRAME\\n      if (any(lessThan(vBarycentric, vec3(0.02)))) {\\n          col = vec4(0., 1., 1., col.a);\\n      }\\n  #endif\\n  return CCFragOutput(col);\\n}\\nout vec4 cc_FragColor;\\nvoid main() { cc_FragColor = multiply(); }"},"glsl1":{"vert":"\\nprecision mediump float;\\nuniform vec4 mainTiling_Offset;\\nuniform mat4 cc_matViewProj;\\nuniform vec4 cc_cameraPos;\\nuniform mat4 cc_matWorld;\\nvarying vec2 uv;\\nvarying vec4 color;\\nattribute vec3 a_position;\\nattribute vec4 a_texCoord;\\nattribute vec3 a_texCoord1;\\nattribute vec3 a_texCoord2;\\nattribute vec4 a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    varying vec3 vBarycentric;\\n#endif\\nvec4 vs_main() {\\n    highp vec4 pos = vec4(a_position, 1);\\n    vec4 velocity = vec4(a_texCoord1.xyz, 0);\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    velocity = cc_matWorld * velocity;\\n#endif\\n    float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\\n    vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\\n    pos.xyz += camUp * vertOffset;\\n    pos = cc_matViewProj * pos;\\n    uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\\n    color = a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    vBarycentric = a_texCoord2;\\n#endif\\n    return pos;\\n}\\nvoid main() { gl_Position = vs_main(); }","frag":"\\nprecision mediump float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nvarying vec2 uv;\\nvarying vec4 color;\\n#if CC_DRAW_WIRE_FRAME\\n  varying vec3 vBarycentric;\\n#endif\\nuniform sampler2D mainTexture;\\nuniform vec4 tintColor;\\nvec4 multiply () {\\n  vec4 col;\\n  vec4 texColor = texture2D(mainTexture, uv);\\n  col.rgb = tintColor.rgb * texColor.rgb * color.rgb * vec3(2.0);\\n  col.a = (1.0 - texColor.a) * (tintColor.a * color.a * 2.0);\\n  #if CC_DRAW_WIRE_FRAME\\n      if (any(lessThan(vBarycentric, vec3(0.02)))) {\\n          col = vec4(0., 1., 1., col.a);\\n      }\\n  #endif\\n  return CCFragOutput(col);\\n}\\nvoid main() { gl_FragColor = multiply(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_DRAW_WIRE_FRAME","type":"boolean","defines":[]},{"name":"CC_USE_WORLD_SPACE","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"Constants","members":[{"name":"mainTiling_Offset","type":16,"count":1},{"name":"frameTile_velLenScale","type":16,"count":1},{"name":"scale","type":16,"count":1}],"defines":[],"binding":0},{"name":"FragConstants","members":[{"name":"tintColor","type":16,"count":1}],"defines":[],"binding":1}],"samplers":[{"name":"mainTexture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-3d-trail|particle-trail:vs_main|tinted-fs:multiply"},{"hash":1704877102,"glsl3":{"vert":"\\nprecision mediump float;\\nuniform Constants{\\n    vec4 mainTiling_Offset;\\n    vec4 frameTile_velLenScale;\\n    vec4 scale;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nout vec2 uv;\\nout vec4 color;\\nin vec3 a_position;\\nin vec4 a_texCoord;\\nin vec3 a_texCoord1;\\nin vec3 a_texCoord2;\\nin vec4 a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    out vec3 vBarycentric;\\n#endif\\nvec4 vs_main() {\\n    highp vec4 pos = vec4(a_position, 1);\\n    vec4 velocity = vec4(a_texCoord1.xyz, 0);\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    velocity = cc_matWorld * velocity;\\n#endif\\n    float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\\n    vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\\n    pos.xyz += camUp * vertOffset;\\n    pos = cc_matViewProj * pos;\\n    uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\\n    color = a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    vBarycentric = a_texCoord2;\\n#endif\\n    return pos;\\n}\\nvoid main() { gl_Position = vs_main(); }","frag":"\\nprecision mediump float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nin vec2 uv;\\nin vec4 color;\\nuniform sampler2D mainTexture;\\nvec4 addSmooth () {\\n  vec4 col = color * texture(mainTexture, uv);\\n  col.rgb *= col.a;\\n  return CCFragOutput(col);\\n}\\nout vec4 cc_FragColor;\\nvoid main() { cc_FragColor = addSmooth(); }"},"glsl1":{"vert":"\\nprecision mediump float;\\nuniform vec4 mainTiling_Offset;\\nuniform mat4 cc_matViewProj;\\nuniform vec4 cc_cameraPos;\\nuniform mat4 cc_matWorld;\\nvarying vec2 uv;\\nvarying vec4 color;\\nattribute vec3 a_position;\\nattribute vec4 a_texCoord;\\nattribute vec3 a_texCoord1;\\nattribute vec3 a_texCoord2;\\nattribute vec4 a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    varying vec3 vBarycentric;\\n#endif\\nvec4 vs_main() {\\n    highp vec4 pos = vec4(a_position, 1);\\n    vec4 velocity = vec4(a_texCoord1.xyz, 0);\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    velocity = cc_matWorld * velocity;\\n#endif\\n    float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\\n    vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\\n    pos.xyz += camUp * vertOffset;\\n    pos = cc_matViewProj * pos;\\n    uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\\n    color = a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    vBarycentric = a_texCoord2;\\n#endif\\n    return pos;\\n}\\nvoid main() { gl_Position = vs_main(); }","frag":"\\nprecision mediump float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nvarying vec2 uv;\\nvarying vec4 color;\\nuniform sampler2D mainTexture;\\nvec4 addSmooth () {\\n  vec4 col = color * texture2D(mainTexture, uv);\\n  col.rgb *= col.a;\\n  return CCFragOutput(col);\\n}\\nvoid main() { gl_FragColor = addSmooth(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_DRAW_WIRE_FRAME","type":"boolean","defines":[]},{"name":"CC_USE_WORLD_SPACE","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"Constants","members":[{"name":"mainTiling_Offset","type":16,"count":1},{"name":"frameTile_velLenScale","type":16,"count":1},{"name":"scale","type":16,"count":1}],"defines":[],"binding":0}],"samplers":[{"name":"mainTexture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-3d-trail|particle-trail:vs_main|no-tint-fs:addSmooth"},{"hash":2717357054,"glsl3":{"vert":"\\nprecision mediump float;\\nuniform Constants{\\n    vec4 mainTiling_Offset;\\n    vec4 frameTile_velLenScale;\\n    vec4 scale;\\n};\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nout vec2 uv;\\nout vec4 color;\\nin vec3 a_position;\\nin vec4 a_texCoord;\\nin vec3 a_texCoord1;\\nin vec3 a_texCoord2;\\nin vec4 a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    out vec3 vBarycentric;\\n#endif\\nvec4 vs_main() {\\n    highp vec4 pos = vec4(a_position, 1);\\n    vec4 velocity = vec4(a_texCoord1.xyz, 0);\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    velocity = cc_matWorld * velocity;\\n#endif\\n    float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\\n    vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\\n    pos.xyz += camUp * vertOffset;\\n    pos = cc_matViewProj * pos;\\n    uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\\n    color = a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    vBarycentric = a_texCoord2;\\n#endif\\n    return pos;\\n}\\nvoid main() { gl_Position = vs_main(); }","frag":"\\nprecision mediump float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nin vec2 uv;\\nin vec4 color;\\nuniform sampler2D mainTexture;\\nvec4 premultiplied () {\\n  vec4 col = color * texture(mainTexture, uv) * color.a;\\n  return CCFragOutput(col);\\n}\\nout vec4 cc_FragColor;\\nvoid main() { cc_FragColor = premultiplied(); }"},"glsl1":{"vert":"\\nprecision mediump float;\\nuniform vec4 mainTiling_Offset;\\nuniform mat4 cc_matViewProj;\\nuniform vec4 cc_cameraPos;\\nuniform mat4 cc_matWorld;\\nvarying vec2 uv;\\nvarying vec4 color;\\nattribute vec3 a_position;\\nattribute vec4 a_texCoord;\\nattribute vec3 a_texCoord1;\\nattribute vec3 a_texCoord2;\\nattribute vec4 a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    varying vec3 vBarycentric;\\n#endif\\nvec4 vs_main() {\\n    highp vec4 pos = vec4(a_position, 1);\\n    vec4 velocity = vec4(a_texCoord1.xyz, 0);\\n#if !CC_USE_WORLD_SPACE\\n    pos = cc_matWorld * pos;\\n    velocity = cc_matWorld * velocity;\\n#endif\\n    float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\\n    vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\\n    pos.xyz += camUp * vertOffset;\\n    pos = cc_matViewProj * pos;\\n    uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\\n    color = a_color;\\n#if CC_DRAW_WIRE_FRAME\\n    vBarycentric = a_texCoord2;\\n#endif\\n    return pos;\\n}\\nvoid main() { gl_Position = vs_main(); }","frag":"\\nprecision mediump float;\\nvec4 CCFragOutput (vec4 color) {\\n  #if OUTPUT_TO_GAMMA\\n    color.rgb = sqrt(color.rgb);\\n  #endif\\n\\treturn color;\\n}\\nvarying vec2 uv;\\nvarying vec4 color;\\nuniform sampler2D mainTexture;\\nvec4 premultiplied () {\\n  vec4 col = color * texture2D(mainTexture, uv) * color.a;\\n  return CCFragOutput(col);\\n}\\nvoid main() { gl_FragColor = premultiplied(); }"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"CC_DRAW_WIRE_FRAME","type":"boolean","defines":[]},{"name":"CC_USE_WORLD_SPACE","type":"boolean","defines":[]},{"name":"OUTPUT_TO_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"Constants","members":[{"name":"mainTiling_Offset","type":16,"count":1},{"name":"frameTile_velLenScale","type":16,"count":1},{"name":"scale","type":16,"count":1}],"defines":[],"binding":0}],"samplers":[{"name":"mainTexture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-3d-trail|particle-trail:vs_main|no-tint-fs:premultiplied"}]},{"__type__":"cc.Material","_name":"builtin-3d-trail","_effectAsset":{"__uuid__":"2afAA24LNP4YmYiaVLiivs"},"_techniqueData":{"0":{"props":{"mainTexture":{"__uuid__":"02delMVqdBD70a/HSD99FK"}}}}}]',"res/import/0d/0d669730c.json":'[{"__type__":"cc.EffectAsset","_name":"builtin-clear-stencil","techniques":[{"passes":[{"blendState":{"targets":[{"blend":true}]},"rasterizerState":{"cullMode":0},"program":"builtin-clear-stencil|vs|fs"}]}],"shaders":[{"hash":2075641479,"glsl3":{"vert":"\\nprecision highp float;\\nin vec3 a_position;\\nvoid main () {\\n  gl_Position = vec4(a_position, 1);\\n}","frag":"\\nprecision highp float;\\nvoid main () {\\n  gl_FragColor = vec4(1.0);\\n}"},"glsl1":{"vert":"\\nprecision highp float;\\nattribute vec3 a_position;\\nvoid main () {\\n  gl_Position = vec4(a_position, 1);\\n}","frag":"\\nprecision highp float;\\nvoid main () {\\n  gl_FragColor = vec4(1.0);\\n}"},"builtins":{"globals":{"blocks":[],"samplers":[]},"locals":{"blocks":[],"samplers":[]}},"defines":[],"blocks":[],"samplers":[],"record":null,"name":"builtin-clear-stencil|vs|fs"}]},{"__type__":"cc.Material","_name":"builtin-clear-stencil","_effectAsset":{"__uuid__":"c0BAyVxX9JzZy8EjFrc9DU"},"_techniqueData":{}}]',"res/import/0e/0e4bc3b03.json":'[{"__type__":"cc.EffectAsset","_name":"builtin-2d-spine","techniques":[{"passes":[{"blendState":{"targets":[{"blend":true}]},"rasterizerState":{"cullMode":0},"properties":{"texture":{"value":"white","type":29},"alphaThreshold":{"value":[0.5],"type":13}},"program":"builtin-2d-spine|vs|fs"}]}],"shaders":[{"hash":3550530479,"glsl3":{"vert":"\\nprecision highp float;\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nin vec3 a_position;\\nin vec4 a_color;\\n#if USE_TINT\\n  in vec4 a_color0;\\n#endif\\nin vec2 a_uv0;\\nout vec2 v_uv0;\\nout vec4 v_light;\\n#if USE_TINT\\n  out vec4 v_dark;\\n#endif\\nvoid main () {\\n  mat4 mvp;\\n  #if CC_USE_MODEL\\n    mvp = cc_matViewProj * cc_matWorld;\\n  #else\\n    mvp = cc_matViewProj;\\n  #endif\\n  v_uv0 = a_uv0;\\n  v_light = a_color;\\n  #if USE_TINT\\n    v_dark = a_color0;\\n  #endif\\n  gl_Position = mvp * vec4(a_position, 1);\\n}","frag":"\\nprecision highp float;\\nuniform sampler2D texture;\\nin vec2 v_uv0;\\nin vec4 v_light;\\n#if USE_TINT\\n  in vec4 v_dark;\\n#endif\\n#if USE_ALPHA_TEST\\n  uniform ALPHA_TEST {\\n    float alphaThreshold;\\n  };\\n#endif\\nvoid ALPHA_TEST (in vec4 color) {\\n  #if USE_ALPHA_TEST\\n      if (color.a < alphaThreshold) discard;\\n  #endif\\n}\\nvoid ALPHA_TEST (in float alpha) {\\n  #if USE_ALPHA_TEST\\n      if (alpha < alphaThreshold) discard;\\n  #endif\\n}\\nvoid main () {\\n  vec4 texColor = vec4(1.0);\\n  vec4 texture_tmp = texture(texture, v_uv0);\\n  #if CC_USE_ALPHA_ATLAS_texture\\n      texture_tmp.a *= texture(texture, v_uv0 + vec2(0, 0.5)).r;\\n  #endif\\n  #if INPUT_IS_GAMMA\\n    texColor.rgb *= (texture_tmp.rgb * texture_tmp.rgb);\\n    texColor.a *= texture_tmp.a;\\n  #else\\n    texColor *= texture_tmp;\\n  #endif\\n  vec4 finalColor;\\n  #if USE_TINT\\n    finalColor.a = v_light.a * texColor.a;\\n    finalColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\\n  #else\\n    finalColor = texColor * v_light;\\n  #endif\\n  ALPHA_TEST(finalColor);\\n  gl_FragColor = finalColor;\\n}"},"glsl1":{"vert":"\\nprecision highp float;\\nuniform mat4 cc_matViewProj;\\nuniform mat4 cc_matWorld;\\nattribute vec3 a_position;\\nattribute vec4 a_color;\\n#if USE_TINT\\n  attribute vec4 a_color0;\\n#endif\\nattribute vec2 a_uv0;\\nvarying vec2 v_uv0;\\nvarying vec4 v_light;\\n#if USE_TINT\\n  varying vec4 v_dark;\\n#endif\\nvoid main () {\\n  mat4 mvp;\\n  #if CC_USE_MODEL\\n    mvp = cc_matViewProj * cc_matWorld;\\n  #else\\n    mvp = cc_matViewProj;\\n  #endif\\n  v_uv0 = a_uv0;\\n  v_light = a_color;\\n  #if USE_TINT\\n    v_dark = a_color0;\\n  #endif\\n  gl_Position = mvp * vec4(a_position, 1);\\n}","frag":"\\nprecision highp float;\\nuniform sampler2D texture;\\nvarying vec2 v_uv0;\\nvarying vec4 v_light;\\n#if USE_TINT\\n  varying vec4 v_dark;\\n#endif\\n#if USE_ALPHA_TEST\\n  uniform float alphaThreshold;\\n#endif\\nvoid ALPHA_TEST (in vec4 color) {\\n  #if USE_ALPHA_TEST\\n      if (color.a < alphaThreshold) discard;\\n  #endif\\n}\\nvoid ALPHA_TEST (in float alpha) {\\n  #if USE_ALPHA_TEST\\n      if (alpha < alphaThreshold) discard;\\n  #endif\\n}\\nvoid main () {\\n  vec4 texColor = vec4(1.0);\\n  vec4 texture_tmp = texture2D(texture, v_uv0);\\n  #if CC_USE_ALPHA_ATLAS_texture\\n      texture_tmp.a *= texture2D(texture, v_uv0 + vec2(0, 0.5)).r;\\n  #endif\\n  #if INPUT_IS_GAMMA\\n    texColor.rgb *= (texture_tmp.rgb * texture_tmp.rgb);\\n    texColor.a *= texture_tmp.a;\\n  #else\\n    texColor *= texture_tmp;\\n  #endif\\n  vec4 finalColor;\\n  #if USE_TINT\\n    finalColor.a = v_light.a * texColor.a;\\n    finalColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\\n  #else\\n    finalColor = texColor * v_light;\\n  #endif\\n  ALPHA_TEST(finalColor);\\n  gl_FragColor = finalColor;\\n}"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"USE_TINT","type":"boolean","defines":[]},{"name":"CC_USE_MODEL","type":"boolean","defines":[]},{"name":"USE_ALPHA_TEST","type":"boolean","defines":[]},{"name":"CC_USE_ALPHA_ATLAS_texture","type":"boolean","defines":[]},{"name":"INPUT_IS_GAMMA","type":"boolean","defines":[]}],"blocks":[{"name":"ALPHA_TEST","members":[{"name":"alphaThreshold","type":13,"count":1}],"defines":["USE_ALPHA_TEST"],"binding":0}],"samplers":[{"name":"texture","type":29,"count":1,"defines":[],"binding":30}],"record":null,"name":"builtin-2d-spine|vs|fs"}]},{"__type__":"cc.Material","_name":"builtin-2d-spine","_effectAsset":{"__uuid__":"0ek66qC1NOQLjgYmi04HvX"},"_techniqueData":{}}]',"res/import/28/2874f8dd-416c-4440-81b7-555975426e93.json":'{"__type__":"cc.EffectAsset","_name":"builtin-2d-sprite","techniques":[{"passes":[{"blendState":{"targets":[{"blend":true}]},"rasterizerState":{"cullMode":0},"properties":{"texture":{"value":"white","type":29},"alphaThreshold":{"value":[0.5],"type":13}},"program":"builtin-2d-sprite|vs|fs"}]}],"shaders":[{"hash":3278106612,"glsl3":{"vert":"\\nprecision highp float;\\nuniform CCGlobal {\\n  mat4 cc_matView;\\n  mat4 cc_matViewInv;\\n  mat4 cc_matProj;\\n  mat4 cc_matProjInv;\\n  mat4 cc_matViewProj;\\n  mat4 cc_matViewProjInv;\\n  vec4 cc_cameraPos;\\n  vec4 cc_time;\\n  mediump vec4 cc_screenSize;\\n  mediump vec4 cc_screenScale;\\n};\\nuniform CCLocal {\\n  mat4 cc_matWorld;\\n  mat4 cc_matWorldIT;\\n};\\nin vec3 a_position;\\nin vec4 a_color;\\nout vec4 v_color;\\n#if USE_TEXTURE\\nin vec2 a_uv0;\\nout vec2 v_uv0;\\n#endif\\nvoid main () {\\n  vec4 pos = vec4(a_position, 1);\\n  #if CC_USE_MODEL\\n  pos = cc_matViewProj * cc_matWorld * pos;\\n  #else\\n  pos = cc_matViewProj * pos;\\n  #endif\\n  #if USE_TEXTURE\\n  v_uv0 = a_uv0;\\n  #endif\\n  v_color = a_color;\\n  gl_Position = pos;\\n}","frag":"\\nprecision highp float;\\n#if USE_ALPHA_TEST\\n  uniform ALPHA_TEST {\\n    float alphaThreshold;\\n  };\\n#endif\\nvoid ALPHA_TEST (in vec4 color) {\\n  #if USE_ALPHA_TEST\\n      if (color.a < alphaThreshold) discard;\\n  #endif\\n}\\nvoid ALPHA_TEST (in float alpha) {\\n  #if USE_ALPHA_TEST\\n      if (alpha < alphaThreshold) discard;\\n  #endif\\n}\\nin vec4 v_color;\\n#if USE_TEXTURE\\nin vec2 v_uv0;\\nuniform sampler2D texture;\\n#endif\\nvoid main () {\\n  vec4 o = vec4(1, 1, 1, 1);\\n  #if USE_TEXTURE\\n  vec4 texture_tmp = texture(texture, v_uv0);\\n  #if CC_USE_ALPHA_ATLAS_texture\\n      texture_tmp.a *= texture(texture, v_uv0 + vec2(0, 0.5)).r;\\n  #endif\\n  #if INPUT_IS_GAMMA\\n    o.rgb *= (texture_tmp.rgb * texture_tmp.rgb);\\n    o.a *= texture_tmp.a;\\n  #else\\n    o *= texture_tmp;\\n  #endif\\n  #endif\\n  o *= v_color;\\n  ALPHA_TEST(o);\\n  gl_FragColor = o;\\n}"},"glsl1":{"vert":"\\nprecision highp float;\\nuniform mat4 cc_matViewProj;\\nuniform mat4 cc_matWorld;\\nattribute vec3 a_position;\\nattribute vec4 a_color;\\nvarying vec4 v_color;\\n#if USE_TEXTURE\\nattribute vec2 a_uv0;\\nvarying vec2 v_uv0;\\n#endif\\nvoid main () {\\n  vec4 pos = vec4(a_position, 1);\\n  #if CC_USE_MODEL\\n  pos = cc_matViewProj * cc_matWorld * pos;\\n  #else\\n  pos = cc_matViewProj * pos;\\n  #endif\\n  #if USE_TEXTURE\\n  v_uv0 = a_uv0;\\n  #endif\\n  v_color = a_color;\\n  gl_Position = pos;\\n}","frag":"\\nprecision highp float;\\n#if USE_ALPHA_TEST\\n  uniform float alphaThreshold;\\n#endif\\nvoid ALPHA_TEST (in vec4 color) {\\n  #if USE_ALPHA_TEST\\n      if (color.a < alphaThreshold) discard;\\n  #endif\\n}\\nvoid ALPHA_TEST (in float alpha) {\\n  #if USE_ALPHA_TEST\\n      if (alpha < alphaThreshold) discard;\\n  #endif\\n}\\nvarying vec4 v_color;\\n#if USE_TEXTURE\\nvarying vec2 v_uv0;\\nuniform sampler2D texture;\\n#endif\\nvoid main () {\\n  vec4 o = vec4(1, 1, 1, 1);\\n  #if USE_TEXTURE\\n  vec4 texture_tmp = texture2D(texture, v_uv0);\\n  #if CC_USE_ALPHA_ATLAS_texture\\n      texture_tmp.a *= texture2D(texture, v_uv0 + vec2(0, 0.5)).r;\\n  #endif\\n  #if INPUT_IS_GAMMA\\n    o.rgb *= (texture_tmp.rgb * texture_tmp.rgb);\\n    o.a *= texture_tmp.a;\\n  #else\\n    o *= texture_tmp;\\n  #endif\\n  #endif\\n  o *= v_color;\\n  ALPHA_TEST(o);\\n  gl_FragColor = o;\\n}"},"builtins":{"globals":{"blocks":[{"name":"CCGlobal","defines":[]}],"samplers":[]},"locals":{"blocks":[{"name":"CCLocal","defines":[]}],"samplers":[]}},"defines":[{"name":"USE_TEXTURE","type":"boolean","defines":[]},{"name":"CC_USE_MODEL","type":"boolean","defines":[]},{"name":"USE_ALPHA_TEST","type":"boolean","defines":[]},{"name":"CC_USE_ALPHA_ATLAS_texture","type":"boolean","defines":["USE_TEXTURE"]},{"name":"INPUT_IS_GAMMA","type":"boolean","defines":["USE_TEXTURE"]}],"blocks":[{"name":"ALPHA_TEST","members":[{"name":"alphaThreshold","type":13,"count":1}],"defines":["USE_ALPHA_TEST"],"binding":0}],"samplers":[{"name":"texture","type":29,"count":1,"defines":["USE_TEXTURE"],"binding":30}],"record":null,"name":"builtin-2d-sprite|vs|fs"}]}',"res/import/6f/6f801092-0c37-4f30-89ef-c8d960825b36.json":'{"__type__":"cc.Material","_name":"builtin-2d-base","_effectAsset":{"__uuid__":"28dPjdQWxEQIG3VVl1Qm6T"},"_techniqueData":{}}',"res/import/ec/eca5d2f2-8ef6-41c2-bbe6-f9c79d09c432.json":'{"__type__":"cc.Material","_name":"builtin-2d-sprite","_effectAsset":{"__uuid__":"28dPjdQWxEQIG3VVl1Qm6T"},"_techniqueData":{"0":{"defines":{"USE_TEXTURE":true}}}}',"res/raw-assets/02/0275e94c-56a7-410f-bd1a-fc7483f7d14a.png":"iVBORw0KGgoAAAANSUhEUgAAAAIAAAACAQMAAABIeJ9nAAAAA1BMVEX///+nxBvIAAAACklEQVQI12MAAgAABAABINItbwAAAABJRU5ErkJggg==","res/raw-assets/60/600301aa-3357-4a10-b086-84f011fa32ba.png":"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAASe0lEQVR42uSby47cOLKGPwYvkvJS1d1AzYGBWvTirHrrF/CjjZ9s6gHG296cXnhRgDEowNN2VmZKIhk8C0p5q7LbbrtnMwkQUt4oxc8/LowImVIK/80v4b/85eYTY8xffKlivoZsxpi/nJqllL+WAaUUcxyvDfDF4+9/L3L6/7/qHs1sA74XAy5u1pwd7zC8+oJJ7oBXzAy4PH43dnxXBpys1DxkPr6p58Kr6fjbb/Y3frPAYfz2G5bL313MM8/9PVnxzQw4uZHTo4E3Bl6ef3Z/b7i9vWTH2XTPHAvAmzeUly8P74/fGzD8OUZ8MwNKKeY1ry9XfRov5/PDKj/cNhZw79/j4b2bjPA0Tt8/uNP/AfLy5encRzZQnqjdf4YBF3Q/rPhb3oq7/9nc3j5VheeZAmxgs95QKOWKq9MV1um8Hu8ppLeFn3/WEyYcxtfahlLKnwCglPkqT/X9/l64vTU8INycrtRGYH34/ZatWbKE7QzGFpbLAltgeRBow6asP6yV6wMIyr8o/M+9wu05OCeq8aVAfDUA5/p+Nwn10lzQcjZmZgN2/YiwwuzY2cXeGLrOAKYH0/a96dt59ra0RyF0BywgVyDQ9cePytWVTgLnE+GfA+KLQPgqAC6MnTzV+arvHz8iV1cIbO2OpSxAenrb0gpghgFpGmDA0EzzDQMDTWmaSYBhgKaZBT0I/Qhl9ZHMFaff5QsA9EtB+GIj+ET4X399IviHasDs1RUO8LD0CwgwNC2tBwLj2JgqdktDC7RAQ9M0zfR+ZGwxJgwQgDAwNEDY72lW4KjzWz58ODWUcnFf5pmY5POh8CeFPzdaApi3vyykeYe8cAg39QauwbHdWkQcXXdiwRuZriMEYwMIREP0Bg8RjI+Ap8RICT4UAtpAZhzVhCYzDLnrmgwI+33eapeW19f5cF8PZG6AxaL8CvxyakALpvqKP7sZqipiuLs70P5nGnnhHuR3z7wKfrfDs1x6us4PDB7GANNqQxOJHfiWlDrwbfJ0CRae1CWfOlLqjKEDWuLEjhCaMDFkZAwMg6fr/HKJn0D1gGW6j3c/N/LLZGjv7upiFcqfd4PPRHZ1PGB/v/ndWX6w6wqAo8fTYmHwjI0jREfE4b07MCDhcAgkAWcSiEuQAEcqOKeApoTiyCSycyQgRUi+/jQCqafPLW0E0mZDXq/JPJC4mWzDG5SXR8P4nD34rBEsYKbVP6z8/T329hbh3zh+nAQ/rkQ9jqOPJnhP9HjvEjgHLiWcc9gM1oLkjFgLmWwslkwuFqs5o9aSJ+OWTkYkkkY/xkAYzz6fz/9N5kfSPejt0UjOhvGJUfw8AMfVPzN283gEvzoVfhwDBI/B4wkTICElvHMVqEz2FiuQLViTyVKny0zClyp8VrAxZ3IpREeKQMS5CHGEEqkgxBMQ5vN8MvTUVT4HgPvjKO/Npa8XwK24YEAIPkLwk/VOEFzOwRnrAV+Fx5Kn/1mMxRpVjIit7s/mAjaRbcbirSVlsssYV7DWkYRkBOdNjJjiRxMI0PfstGWxAPgAXJ8GRubEKzxhwbMMuFz9+3tsc/tgb7iZjZ6jCuor7WkIBEhNXXXXOJNDtjQWPFQQZsAi0XmsgBhUDSL1ZiOK1UzOGe9HIOZMtJYxZ8Zi0+hwA4kRFwfww8hBJSJbIkvitPrxj1jwbBxQSjG8Poa5b3krt7eYG25OIz3Xg2MYqmAGT6rCg2ucy022dBbbxGgXkbgkslJ0herS4xcKK0jrJLJKsAaWeBaILPC+AxZElqosMrmz5M7hDiCDD0AIBDfM4C5nFf0oZ/HBSdh+GRs8YcAT3b/H0jxYbm7cI49+xcr1EAx4A02INPjUJFxDonWOAHSQG7CNoq2oBISQoHFgj97gZAEUTZJUcElSysm5waEjyAj0wDCNHuhJDMkxOCoTpu8iMD7ymFasqk24J3N7xoQDCz4XCZo3bybUbjHYuvorjAC2BduMuAAOj0vJeZcIxuVQ/X5u6s+0E6StYT0LB53CCqdLlBWwVFihukJYCW4psFLnOgcLkMUUR3Sg7RRXNOTcQAou4aG62XGcYpI9bsXKfKwsEKZd6UGez8UBh9W/uxP+9jfhl19mKp0GHgGGAE1zEui0QJszC2tpphvuFGklscDRoNoiMv0fB2pBDNUTKEpBDq5vBMZEGlxyA44dsFd0KJS9xe6BPYkeR0+MPd4PDAw09b8XHqIy4A7l1ZEFT9zgM67v3NLv92HoutCAJ8YO7ysAKXUY02FtR2SBr6uWSEuHmwFpUGmBgEwR3KwCEyExJgGjQkTpRRiAfUoMzrEF9sAuQ2+poKRE79ykFuM4EMoIzQDEDxCvj/HCEzX4lAqc0sVM29pqSLrONGBGcHgvkCo4zjnsZOk9Tg/McA1oN6sAwqIIi5xZlcIKWJXCGsOqGLOcfreUUpYizP/rXDV8rSrNifcJ5BzmGAOwhGChOexZrjfnBvA5NZBj5HdIb/Hy5UnC43dkfWSFBaYNDTbhLCkdghzIAQiaaizgVFtUGtAGpMvkzsDCQmdgCXmFKStgVd9TQTDaAosqsDY41wBBpM57UCNrq0E93pswHHeIm/V5MnWSC15j5k2eOSmNmWOi45Xcc29vuZ1VwO/3hK4jjIyNiaH1fqK+c13OLK09rNhyMm5LORWK3GVsZ6u98JP9EAWRIzVn/e3J7LGV8sAWZYuwRXWHyCOZXYa9hS0l7aNzex/p8ewHhtjsm4Gu2oKHB9IwkG9vyXegr06SJ88A8An9n5EfxxYT2mTonKMls8jMAOgKWKCsVGQ1AbAosDSwoLDE0KC0oAEjtkzmRyGDjoJUfabsCmZnap6sgoA+KvKIsivCo815D3aLrfZgcpH7ySVeGsMndgAon9wOv3uHec97M2XsjjYhBAPRuFOwbK6ARbEgNSegFcACwZAbIBTwirYILSINhoUx1T4INIK0KG0pBDDBzMArHlWbECcpeRGszdlhrcGeBTtcBj5/tjhqXryAn/gJNhtZVmiPk3pvkksmJSRbxGYEVPATc1RFwKpiDdiCWMAbQ0BlNmIt0CgsFO0otNVWaDCGQMEf9vuCIGIdKjhnVBGsNZlsMwgpSUoXUV8/Z5w3nwXkC1Jia9hiau5yOGSHHA5cMuR5YjGASQmLiChIKdhSEIOZdoCIESwQFG2gtNSVDxg8iEOkGjNzEcqqCoikhBWp17RYLIBzONKJgINhSrZu1utvLI+vqxL2E6IjoyFCSphjRs2i9SbPELbVsphCMaXYqjLlAJioGivVGM7qYigY9Nw7kREVAVVzun/NFXwSmHTyxQBAb7Zszfpb+wM2wHJJaVsKAwRCJWe1jsVaCpYiUKZdXZ1YKBUXisEUU/NyOh0LqBpDVhigZFTVQCmGgqCZzAE/i4KCSHGkmt0ArK3bXUeiJo7qq6EpPbBkWaoEXwnAb+cEKAA9PUPTTALGApRUL1pynuM5Lc6RUWpoqxQzpa7LbIFVs6JJkMEUHYFBMWMRGVRJBc2A2iK5UCaLrQUVBVVwGSgKhXphJVGSO6sZQt9O5+vynFyfBeB/52TC+/eHQLWlLc0hyeDVuVQcTqdEhmZyiYhCKkmSImRED/l7U1EbVRgFqbs6YS+wE9gbaugrMFIYszHRYA6ZHRFSQjSRioBKzgVsvb5z6nAaiWUc62K07UWB9d1Brq9Ii//002GS/R46GcCYQjCAV0BzRrGozTZZqxkkOpWkQhYkAiOlDBhjKXgx0lcKqwomUYrBmKJKFmEE6aFEi6nsUKKIRFXUCQlc9evWJnJWstVZ1TwUwqFQcs6IF8+nh+XZ5oTz0nQd3V4HmkI4y7Bka8m2prAySARJCBGdAhHVWAwRGIyyL4VBYAeyA7OlmB2wrZ+xKzBgzCGYqaAwSt0d5pohjpVZ1iYsOU33E6M/BDn7/fHeHx6OYNzdfQIAY4DXr+fOjCN9fp+rA11pGhSCgq/UTFNpyp5FWxGIgkaFiEhv1ByiNGPYktnJHOGZ4zFndqaUbc7sC2VAtVeln3eIDjcQY/b4Y1Y4kV0FJntfV7+H0nXohk0BuLk5yvPqFYXXrw+5wee2w6epLwu4zQa/Xh/ygGGENjDv++eERd25EeMS6zuERSItHK6LxIXHz7mDQKaZIjhb85S5UEQxJkMZwIyo9uQ84P0uJfau5gR2kbj3+MPWGNI+4XoH+5FxCIT+M2HwoY44b4fdJ7o0zCn9dX2kVdehYa5l1BVIyaXkMDFjnXpGD6KKdTXowVe/Wb2DELGMc7HEGKBYiinFVJc+gkYVqfkApXekAVyP6ujF95Aj2Jjqfjy5ScAwhkx4tmRenus1+qQXuLuDX48/1msosNGuqxZ5GOaqbEw4koMIdrQ5R8EPqI4i2oPbkdIAaY9qj1S6K7oDfQQ2ZLZo3hotG1SrOmTZimqf0H1SepzbgQ5U7zHXAEaXUgSXYqwADOFJPeAEjF+fGoDPJEWfqAFgt2zDkuW0MxwDmIZK7YZEl11uLbbN1KMqrUhNjijaiNbNjQoWxIqqqIBQ0+KKZlSyCIPW+tkA9AqDQA+5BzsAOxJD4pANmpOlERi3W2JefoxXXH2S/p8tjFyqwQMPesONLFnmCZwMIY01OVJBcmksyQmuFjzmaFCVIoJK9Q4eZRRwqAoiUkMEiioqoqoiiZSyODcAo1ZvMiD0GTvYKuiIqzoeI8kXEmHI0GQgL8ujwpXy8KDcDAVun6X/H8UBh26NG27MSTOCTKhKqUdDxCTvBJem/UEGbJlLXRGyJ2bURurO0FLrhYIThITgNCWn4og4l4AYicmL78k55mxHa3OfKIPDjaQUiyuj934cBlJDk9nvM12XWa0SoNzc6JPOkT8CYLaOlyDAg1KLI3nLVpYsUzPP5xEHhuTAQao7nmItJdeaWAY/RonBU+kPIs6pAQF1qFCcoLOfF3z0WcZsibZSe0jJjs5NyY7iBg/jCKlpJmuvmk6onu+5L7d19Y/jK0tj5rnCKODZ7TyLxZQtGkOMIeCj95gm1WR9ADflCe1UG7R2Kowe+ogUNYIUlJILxVoSmYyt7msujSVSdImxFkgrCCPEACN9n2jbGht8+JC4vj7q/WfK5N9UHb6oFbhxJATwBDyJgEuehE+4Q3WYjM9grc0C1uSMWDLYWhzNUGzOCvY0uIpAShDdZOQYiWM4K5Nf1gC+rTp8CA0rOof6+v095vYW+DeGH0/2n7VIV1VmHEs0ofhYFO/nQsfcHzBW8OxJfwCmFsin/gDss/0B7rQ/IIQxEJ7rD1B+JE/9AU/0/7t1iDw8YL3H/fADckic9r2nbS3D4GkaF6fPfbUKDpyk6egm+qfaKVLvP7ni3HzTScGlSYBEjAl8wpNgSNDE8+aJTYZ1+tTKf65DRL6gZ7+Ou7tDX95Neqc//HDwr+mRx7TTtgYoTTMCg59G9c9uH4mDw+1dSj0p7RNpD+xcYgdu5xy76bM9uNMMb4/3w+jn4mgzAnG3m4TfbDKsq+Dv3h0Fv/uyDtI/7hM87ww96Q98Z+FFtQsfP1qurixsLSwPgdPAYBuMhWAZkRhqnq8mlKIQMXgPMYL3hUipaQOv+MNKpouewHnl5+/0gYd8w03mLYWfz/sGzVT++KZGyS9okrR8+GC5vj4Yyj1719HVSk1To8qRUcKI1NT6893iI5QAOjBoUwOb0tNruy+ZrqtgbDb6Qdf5+vqTlJ9SccBnVv+LGyVPKHTZkancTytzdD0RiIrWHVnD0PfVegdCTY7MNX7oGYaB2iraA31hGBiGsdCMPX0ERt21A1038Eji48fEep2ur2dm3D8R/jWv5xv/w3bZb+gVPitAPOkV/ghyxUYeWctq+s0epDvN27e13tD2PbQUaMt+X9NFXTcL9Vhgdd4S+/BwGuVVwe8oc+n7L+kV/gQIZ93i9/fI7S1Tt/h7gZ/mpum5wFrHFsMStlvMcrmdmsSXFw9JbMoGypr1GeP+xb9KvP8fvb3lP98t/vnnBZ48H3Dx/neBHwDMRzBXE4gbYL2ZEvDr9eXeXZ+q3Vvg+ecFMAYD5Stk+PNPjBxc5OvX5cII5YsxWe0f4sNDPb+CyPsaxKwhsia+X6/jRQbnuWyOws+XRu8Q5X2N8N/vmaFjR+nTJ0HOnxI5fv/uneHFi09Oec89F5sY3vCmvOTld39miFIK3+Px2ZNn/GQatvyjuFKKK//8py+l+FJKOBnN+fi/5uJ7X8r0//IPV0qxdd6/y/d6auy7AvAMEOdgnALyB+MfR4HtyRzf/SHKvwSALwDji8bfT1b6r3py9Ju8wNdfjK+zUV9p0b8ZgP/W1/8PANBu4nWyy/8EAAAAAElFTkSuQmCC","res/raw-assets/6a/6aa0aa6a-ebee-4155-a088-a687a6aadec4.png":"iVBORw0KGgoAAAANSUhEUgAAAMMAAAEOCAYAAAA0fqN0AAAKOWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAEjHnZZ3VFTXFofPvXd6oc0wAlKG3rvAANJ7k15FYZgZYCgDDjM0sSGiAhFFRJoiSFDEgNFQJFZEsRAUVLAHJAgoMRhFVCxvRtaLrqy89/Ly++Osb+2z97n77L3PWhcAkqcvl5cGSwGQyhPwgzyc6RGRUXTsAIABHmCAKQBMVka6X7B7CBDJy82FniFyAl8EAfB6WLwCcNPQM4BOB/+fpFnpfIHomAARm7M5GSwRF4g4JUuQLrbPipgalyxmGCVmvihBEcuJOWGRDT77LLKjmNmpPLaIxTmns1PZYu4V8bZMIUfEiK+ICzO5nCwR3xKxRoowlSviN+LYVA4zAwAUSWwXcFiJIjYRMYkfEuQi4uUA4EgJX3HcVyzgZAvEl3JJS8/hcxMSBXQdli7d1NqaQffkZKVwBALDACYrmcln013SUtOZvBwAFu/8WTLi2tJFRbY0tba0NDQzMv2qUP91829K3NtFehn4uWcQrf+L7a/80hoAYMyJarPziy2uCoDOLQDI3fti0zgAgKSobx3Xv7oPTTwviQJBuo2xcVZWlhGXwzISF/QP/U+Hv6GvvmckPu6P8tBdOfFMYYqALq4bKy0lTcinZ6QzWRy64Z+H+B8H/nUeBkGceA6fwxNFhImmjMtLELWbx+YKuGk8Opf3n5r4D8P+pMW5FonS+BFQY4yA1HUqQH7tBygKESDR+8Vd/6NvvvgwIH554SqTi3P/7zf9Z8Gl4iWDm/A5ziUohM4S8jMX98TPEqABAUgCKpAHykAd6ABDYAasgC1wBG7AG/iDEBAJVgMWSASpgA+yQB7YBApBMdgJ9oBqUAcaQTNoBcdBJzgFzoNL4Bq4AW6D+2AUTIBnYBa8BgsQBGEhMkSB5CEVSBPSh8wgBmQPuUG+UBAUCcVCCRAPEkJ50GaoGCqDqqF6qBn6HjoJnYeuQIPQXWgMmoZ+h97BCEyCqbASrAUbwwzYCfaBQ+BVcAK8Bs6FC+AdcCXcAB+FO+Dz8DX4NjwKP4PnEIAQERqiihgiDMQF8UeikHiEj6xHipAKpAFpRbqRPuQmMorMIG9RGBQFRUcZomxRnqhQFAu1BrUeVYKqRh1GdaB6UTdRY6hZ1Ec0Ga2I1kfboL3QEegEdBa6EF2BbkK3oy+ib6Mn0K8xGAwNo42xwnhiIjFJmLWYEsw+TBvmHGYQM46Zw2Kx8lh9rB3WH8vECrCF2CrsUexZ7BB2AvsGR8Sp4Mxw7rgoHA+Xj6vAHcGdwQ3hJnELeCm8Jt4G749n43PwpfhGfDf+On4Cv0CQJmgT7AghhCTCJkIloZVwkfCA8JJIJKoRrYmBRC5xI7GSeIx4mThGfEuSIemRXEjRJCFpB+kQ6RzpLuklmUzWIjuSo8gC8g5yM/kC+RH5jQRFwkjCS4ItsUGiRqJDYkjiuSReUlPSSXK1ZK5kheQJyeuSM1J4KS0pFymm1HqpGqmTUiNSc9IUaVNpf+lU6RLpI9JXpKdksDJaMm4ybJkCmYMyF2TGKQhFneJCYVE2UxopFykTVAxVm+pFTaIWU7+jDlBnZWVkl8mGyWbL1sielh2lITQtmhcthVZKO04bpr1borTEaQlnyfYlrUuGlszLLZVzlOPIFcm1yd2WeydPl3eTT5bfJd8p/1ABpaCnEKiQpbBf4aLCzFLqUtulrKVFS48vvacIK+opBimuVTyo2K84p6Ss5KGUrlSldEFpRpmm7KicpFyufEZ5WoWiYq/CVSlXOavylC5Ld6Kn0CvpvfRZVUVVT1Whar3qgOqCmrZaqFq+WpvaQ3WCOkM9Xr1cvUd9VkNFw08jT6NF454mXpOhmai5V7NPc15LWytca6tWp9aUtpy2l3audov2Ax2yjoPOGp0GnVu6GF2GbrLuPt0berCehV6iXo3edX1Y31Kfq79Pf9AAbWBtwDNoMBgxJBk6GWYathiOGdGMfI3yjTqNnhtrGEcZ7zLuM/5oYmGSYtJoct9UxtTbNN+02/R3Mz0zllmN2S1zsrm7+QbzLvMXy/SXcZbtX3bHgmLhZ7HVosfig6WVJd+y1XLaSsMq1qrWaoRBZQQwShiXrdHWztYbrE9Zv7WxtBHYHLf5zdbQNtn2iO3Ucu3lnOWNy8ft1OyYdvV2o/Z0+1j7A/ajDqoOTIcGh8eO6o5sxybHSSddpySno07PnU2c+c7tzvMuNi7rXM65Iq4erkWuA24ybqFu1W6P3NXcE9xb3Gc9LDzWepzzRHv6eO7yHPFS8mJ5NXvNelt5r/Pu9SH5BPtU+zz21fPl+3b7wX7efrv9HqzQXMFb0ekP/L38d/s/DNAOWBPwYyAmMCCwJvBJkGlQXlBfMCU4JvhI8OsQ55DSkPuhOqHC0J4wybDosOaw+XDX8LLw0QjjiHUR1yIVIrmRXVHYqLCopqi5lW4r96yciLaILoweXqW9KnvVldUKq1NWn46RjGHGnIhFx4bHHol9z/RnNjDn4rziauNmWS6svaxnbEd2OXuaY8cp40zG28WXxU8l2CXsTphOdEisSJzhunCruS+SPJPqkuaT/ZMPJX9KCU9pS8Wlxqae5Mnwknm9acpp2WmD6frphemja2zW7Fkzy/fhN2VAGasyugRU0c9Uv1BHuEU4lmmfWZP5Jiss60S2dDYvuz9HL2d7zmSue+63a1FrWWt78lTzNuWNrXNaV78eWh+3vmeD+oaCDRMbPTYe3kTYlLzpp3yT/LL8V5vDN3cXKBVsLBjf4rGlpVCikF84stV2a9021DbutoHt5turtn8sYhddLTYprih+X8IqufqN6TeV33zaEb9joNSydP9OzE7ezuFdDrsOl0mX5ZaN7/bb3VFOLy8qf7UnZs+VimUVdXsJe4V7Ryt9K7uqNKp2Vr2vTqy+XeNc01arWLu9dn4fe9/Qfsf9rXVKdcV17w5wD9yp96jvaNBqqDiIOZh58EljWGPft4xvm5sUmoqbPhziHRo9HHS4t9mqufmI4pHSFrhF2DJ9NProje9cv+tqNWytb6O1FR8Dx4THnn4f+/3wcZ/jPScYJ1p/0Pyhtp3SXtQBdeR0zHYmdo52RXYNnvQ+2dNt293+o9GPh06pnqo5LXu69AzhTMGZT2dzz86dSz83cz7h/HhPTM/9CxEXbvUG9g5c9Ll4+ZL7pQt9Tn1nL9tdPnXF5srJq4yrndcsr3X0W/S3/2TxU/uA5UDHdavrXTesb3QPLh88M+QwdP6m681Lt7xuXbu94vbgcOjwnZHokdE77DtTd1PuvriXeW/h/sYH6AdFD6UeVjxSfNTws+7PbaOWo6fHXMf6Hwc/vj/OGn/2S8Yv7ycKnpCfVEyqTDZPmU2dmnafvvF05dOJZ+nPFmYKf5X+tfa5zvMffnP8rX82YnbiBf/Fp99LXsq/PPRq2aueuYC5R69TXy/MF72Rf3P4LeNt37vwd5MLWe+x7ys/6H7o/ujz8cGn1E+f/gUDmPP8usTo0wAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB98HCAQGFv2vSq4AACAASURBVHja7L13mBzFnfj9qeqeuLtaSauMhJAQOQkMAkwyyQbMgeHsC5zDzz7br9NhjA+MD6ezfZwNThhzts9kk20wR85ZAiRAJkggCQUWhV1pc5rUXfX+0WF6ZrpnZ2cV8dY+9cxsT4eqrvrmBGOt3iaAl4AEYI69jl2/ybFXUHfTQB7IAuePvc+x9rfe/gmwXMDYCMx1KcZYG2t/c63JBQQN2O7nVe5vY6zTWPubYzN1WbcABZwQkC3G2lj7m2jL3c0fBAjv//vGqMRY+1tq/xqQG8p7wf381JiAPdb+FtrEEMoQ1t8AxgPG2Csba+/XZtQACDpAPb4/RiXG2vu5rauROnhap05gzhhA7HxYbayNvkngVGrTHAkcq/UF7v9PM6ZxGmvvozZ5BJShnEqsBmKMaZzG2vukmXUAQrkscfbYaxxr75e2OWrDSylrBYxbx4TrsfZ+aD+k6JJR0g8//HANaCHEcMBQALYAqTG2accIfmNt67TfRv0wZcoU/vjHP5JMpTCkHI7dmggMASeOvdKxtqu2WBTGNwxDa631Qw8/rE/4+Med48NTCQ1cPvZax9qu2oaiNrbWWucLBf2n227T37v1VkeWMIxahOuXxqj4GJu0K7bfuZu4oj333HOYhsGHTj2VfQsF7ly2jMkHHYSszjYZwGE4AURpxuxCY20XantFCdFnn322VkpppZR+5ZVX9J133qnve/VVfeoPflALu+TZMI4aQ2Dbro1ZPrfuu9RRlCGRSJDNZv3/7733XvKWhYzFeGHGDH52+OEIKdFKDfecL7sUaKyNsUk77XvUwMIoYMjn8yX/n3XWWeSzWVShwBFvvcVvtaahpQVpDqtR/S3w+7FXPgYMO2Mz3N4LHBFFbbXWvPrqqyXHzjzzTOxCAZlKMemmm/jd5s3sf9pptTzzc8BzY9R96y/kWBsda3Qo8B41+BcNDg5yzjnnIISzf+PxOJZl0d3dDbEY8Vdf5YhLL0VMmMDbjz02HBKbDnwB+OUYQIzJDDtD+wpwda0nNzQ0MDAwUHH8L3/5C7ZtO7s8n6f7hBNYsWYNVxx/PEIItNZRt7Rx1K9JF0DU2JKMAcOOEJRvBD49oguFQIUIyFprbrvtNuLxuA8QnQsWMNTSwgUTJw4nWCsXECYB3WMAMSYzbG9AeBX455FerLVm1apVoUBy4okn+oCi4nEmvvwyDVu2cK3WNO+2G9IwhlvDDmD22JqOAcP2elfaxb4HujLCiNtVV10VyvZMnz6diRMnFgHHNJmwdCli+XKubG1lzrHHIuSwy7XGlWHGKP4Ym7RNAWGCi31VFBIZhr8HoLGxkf7+/sjfb7vtNmKxAJzZNkP77Yd98MH87+c/z4vXXlvLeI8HnidCzTvWxijDaBDGfi4g6Kh3JqVESsncuXOr3mxoaKjq72eccUapXGEYpFeswPzrX/ncNddw9n//dy1jfhY4fQzZjQHD1gaEE4E3q1FSwzCYO3culmWxZs2aqjdUSrFx48bI38eNG8f06dPLSQ6pVatILl3Khy++mM/eckstY38AOGMMIMaAYWu1fwKeGO6kM888k1WrVoWqTYUQvl3Ba//zP/8TDX1CcNxxx1EoFCoB4p13aFy2jMP+4R+48Kmnahn//cBHx5ZxDBhG275CMQwzsn3nO9/hnnvuAeC+++6r8EJtaWnhi1/8ImbAzeJ3vxvetaiCXXIBIv3WWzStWMHsY47he6+95h+v0u4D/m5sOccE6HrbBTiW3artj3/8I+edd54PAEcddRSLFy8uEaLb2tqYOnUqH/nIR3jyySexLCvS3hBsWmuefvppOjs7w3gt+ufPp3/OHAbXr+c/5s51AKK68H4y8OTY0o4MGAyKasS/tWYBPwK+U42N0VqzcOFCjjjiCF/zo7WuoAoHHXQQS5cuxXBtBIcffjh//etfsW2b7u5uxo8fP+yAKrRL3jhsm94FC+ifNYv8pk1cvPvutQDEUcDLY0gQgaMVtKOAwXB/nIeTTj39N/aCtDv386M2iwcIK1euZPbs2b7FGCCTyZBOl74yy7J8QPDaXnvtxZo1a7jsssv41re+Neyg2tvbefbZZyvkDgBhWXQffzxDU6Zgd3dz4ZQptQDE1wPz/VttQziOjisD+95fdAOYhaOb3u1v+GVFqk49QOjo6KC5ublEBgB48MEHOeuss3wfo09/+tNcd911FcAAMHnyZBobG1m7du3wA9KaBx54oCQWomRchQIdH/4wufHjHYCYPHk4gBizPRT3/UYcm8xaQAkcT8tDgcUuhIx5skYAwuDgIIlEInSDn3jiiTzzzDO+vDCc8S0Wi1VqjKoAxO233x7KLgHIXI72s86ikE6jenr4xqRJtVCIsVbc78cCL0mXT17sYowxQIgABKUUyWQyFBAAnn76aR8Arr766mEF5EKhQCaTqXkcBx54YORvKpFg6r33YiqFbG7mp+++6wCCGNOPDNO8DOrPA5YAfgJcSJ2+Nn8LgOC7V0f4BuVyOZLJJODEKORyuZqwvRjhZr3jjjsigRFA5PNsOu88lGXRt3Yt39177zEKUVsrAL+WOGb7MYpQhSJUAwSAF154wd+kCxcuHJZF8u4/0vaRj3ykKsXRiQTT/vQnhGkybo89+I+lS8cAoXYKcbp0BeYxehoCCF4fJp0LV155JUopdtttNw477LC6Nnotrbm5mcbGxmrkBgyDqfffj4zFmLr//pz/+ONjC1qbQD1N4DigTRwDiFJAyGazxGKxYQEhiOV7enpobm7epuNTSnHnnXdWaLNKYEJKCpMn03XccVAo8NLNN3Pz5z43trhV0AjQNeaOEQIIPT09mKZZEyB4WS+OPvpoGhoatssY99hjj+rnKEW8vZ2m5csRsRgf/PSn+cill44t8DBtDBjKAGHdunU0NDRUFVSD7bXXXkNKyaJFi6pi6605zqOOOgrLsoY9t/GNN4i3t6MNg3N//GMOOeecsYUeA4Ya6KTWLFmyhOnTp49oU//qV7/i3/7t33yN0/Ya6wc+8IFhBXVtGLQ8/jhks1jABXffzYyDDhpb7CqCw5jMANxyyy18/OMfL3GxGAlF2RFtOFWrj/HyeTaedx4CaAK+2NxMrr9/TNNUJjNsHWAQwo3PFTvdHHUNGPuiiy7isssuGzGbk81mufbaa/nyl79ck3yxtVt7ezvPPPPM8M8WAm0YtH/sY6A1KSH4vBtnURWQhUAYxk7uwKGdzCGjA+ytAAxSglKIeJL0gfMRjeN2HmyjNcIw6H/mkaqnnXzyyTxep/px9erV7Lnnnjt0mnfddVdNlEkLQX633eg+6iiUbZNtb+dbu+1WFRBi03Yjudf+DizsjFRECNRAH9nlr6GyGX8/bndgEIaBSCTZ45p7aFhwHCqXBdvaaQBBjmvm7WP3pLBpQ+gLEkIwbdq0qiGYu0Lr6enh0UcfrY0yaU3v0UeTnTkTO59n+QMP8Ptzz616yf4vb0DE4iNz7dieriCGiUgkyLz6Ams/dzZqaLAegKgfGIRhYE6exr6L1lLY8C4inti5EEY8QdtPvk33X25B53ORfL7ewdhOKbVV2KtgRr5a5Ie2c89FJ5MIy+KWL32JRZEZNwQIOHBZN3Zfb00bXBgGqpBHyO3r1KDzeWIzd2fF8ftQ2NhaE3tcDgx1rYS2bfZ+cjmFtvU7HSAAZN98la47rgsFBE8bs3nz5mGd6ba1RujKK6/cKgB5yimn1DwXFY8z9S9/cdLumSafv+YaJs+bF7lHhGGy5lNnINMNtUwKmW5gy1WXbfd9IeJxCps2sPdjr48UEIqIoh45YcI//j9UXy/C2MkKUiqFiMdZ86nTq552++23M27cuB0i9AaB4cILL+Tyyy8fNUA0NTVFuneHPjseZ8qjj6Jwolx+5mb5C3Mj0VaBzF9fovfhexyevNp9LYuuO2+g89Y/IMzYdpczhGFg93Qx8V++CEJuB2BQignnfgZtF9jZmhzXzKrTP1CVRJ999tl84hOfIJHYsRTNM5pdcsklXH755aOmUiOhDmiN0ddH2k1r06MUl2/aFAmU2rZZf/Hn0YVC1Q0u0w103fYHEJLs26+zI9RQ2raZcM4nQavtAAxAfPpudUHeNsUKpknn9b/B6tyCVnaonDBp0iTuueeeHUoRvLZy5Ur/+yWXXMKf//znUQFEU1PTiFXD4198EZHNYkhJYsIEPvGrX1XV3Kw8+QBkU7TG0GhqJvfOCoSUtP3yP5ENTTtEwxSbOn07sUmeYLUzNa2x+/to+9l30YV8pMDc1taGUmqHd601f/7zn0vG+I//+I+88847o7rvCSecgG3bJR631bodizHlnnucfJmJBKd8/evMXrAg8h1r26LtsktC5QFtWwy89AzattC2xeCip1D5XF0YevT7ge0JDDsXIBiN41h12qGR2g6tNffee29N/jzbB3kJrr/++orj++yzD1LKumWIlpaWEbuPq1iMCc8/jwbywH++9FK0/JDP03nL7ylsbK2kDlLScc2vApQ6Rt9j98HOJle+n4FBxBO0X/kjhzWK2ESnnnoqp512GoZh7HCq4GHu1tbW0LHOnDmz7nHm83mOOOIILMuqnUpZFrH33kN2dmIDnUrxw9bWqgC56swFyDIDa6xlCkOvvugjJG1btP/kPzDSDWPAsL20R3ZvF1v+8At0Ppw9MgyDRx991I9a2xlYpL6+vopxeq2trY2f/vSndY0XYM6cOf5zau5CMOW++xx2SUoap0zhhPPPj0ZAsRgbvv0lRDLlr0OhbT12X08RQLTG6umksHlTvVbhMWAYmfZoPKvOXFCVPVqxYgWDg4Mj2xzbsAP85je/KRlnUC1q2zaXXHIJlmXVdf9sNsu+++47YoAopFJMevhhx/6QSPAvV15J07Rp4exSoUDPfXeQb13ryhI2HTdcHaLUiNF5w9VFoBkDhm2lUzbpvv1ahyJEkPRPfepTTJs2DcMw0MrBtN6nj6mVLjlWfl7w9/JrR0QR3GtN0+QnP/lJyTg3b97M/fffX0Il9t577wp2qdocvE+A+fPnj9ilXCiF2dVFfNMmNNCnNT98992q7NI7Zx2JbBqH0Tye3gf+XIGUtFWg48arEaa5S3jI1gkMO3hiLtbb+KNvRmqPkskkN910E1JIlK1CN3g5EIQBQtiGq6f712rtZ+uWUvLD//whMTPG8ccdz8aNG/2sGZs2beLNN990MHfE2EIB1VbksjkmT56MbdsjA1qtaXnwQWwcx74ccNYvflGFXYrT/vPvI5NpCm0bwje8EGRef+X9SxmU0gitdxi0y8YmWr/0CQfjRLBHr732Gj09PdjaRrt/CuV/et/Lfys/b7hjwb/yY2HP+r//+z8f++++++5c+p1L0WikIUmn0xQKBV9e+OAHP0gikai4X9i4S8alFUcffXRddgs7nWbSI484SbTicT78jW8wftasCHYpT8d1v6bjxquiAUZK2n71Q2Rj0/sTGIR2sAg7AiC0JrfqLQZfWYSOUJWeccbpzJgxo4Q9imJ9yn+rhTKUU5MK7B/yv+eUd/HFF/usx9q1axkcHPTvJ6VkYGAArTWGYZDP51myZInzmmtgkYJCeiwexzTNkbNzlkWsrQ2zsxMFDGjNpatXV2WXNv344ujlsm2GljyPygzt9IJ0fWySLrIqWmlnktsJKGRTM6v/4cRQoVkIgZSSBx540An4UHqn6VppEokEq1evBmD1qtX0dvdUnGcISU93N/lsDtu2Oe2004ibsRE/r5DLc9j8Qx3qoBlR11Iy5Z570O47tZTi5G9/u375zozR98g9YJrvP2DQSiM0zovXRa0FehsDhTToufd2twCtDmWPbrnlFjZv3oytFTvTn0b7RU1uvvlmJkycAJLQc5GCrt5ustksvb29dPV0oULYsmp/CJg9Zw+UsovsmnY7IZ/B37XCisdpWrLESU+dSHD2ZZeRGDeurpxQ2rbYdNklGA1N70fKoNHextfuxlTasbxvK9ZJa0QiwYZvf8lxGAuhCrNnz+YTH/848VgMvRPYFPxuKwwp+fKXv8x//fjHnHnmR0FQRfOkkAj6+/rYvLmdf/5nJ355ZM+1yWQyTJk6tUgdyvUfwc/y322bpldfReTzjnZJKS584436rONao4YGyK9/N9RvbGdpBnAxkGIEDkctn/qK46gnJQIdeJHa/xDe960U8STiCbb89nIyr78MES90+fLl5HN5B3uNkDXYph2wLBshBed/7XxsO4hIoq8Rribs4IMPZvq06e51I3vutKnTWLFiJQIx4mu1GSf9zjv0HXgAUggS6TRrFy6ku4ZU+mGsks7naPrQ6ds2IlI7bHvH9VeN9MpMXZFuez/yBpimE88gnGgoIURx4wsXCIRwD4nRAYVSYMZ464jomN1TTjmF22+/3QdKXWVCHuyKsmOi7Hstx0oWPOJZHldXZDF0xTh0lXso5aW41NH3DxkrCGIxk7vuuntU737zWWdRmDwZgAbgwlGs5QFvdKIGB7ZZWKi2bbAs3j5+r5FKwXVGuvksUlFOcLQmEayTGh3rJNJp2i7/DydgJKI9/NBDKF+v7mlwwrsO+V2HfK/lmI64X+V1QRamchzV7oHPIlW7f9hcFNlsjj3nzkXZNtplwUbUhWDK3Xej3B3Tm8/zkZ/+tM6FFAy9+hI7a7qN+mQGhW9AIiBIExSkVRFYNKPQOimFzmTo/tONaCs8oOhrX/sabW1tvn5eB3hvFVjYsGPlXQ3zuw65n67yjKC6M+pZKuT/sONhzxx2rFqz3377YStVH5enNSoeJ71iheO7FI/z4YsvJt7UNGJhWkhJ+5U/RDY2v4+AwaMKVaiB9inH6LROMt3Apsu+FUoVhBDE43F+/etfY5gmyr1/2GfUsWAvBPyBVA1dVzkW/NRVrtch50YdD3umrmGMCEEsFqvfp8q2aXnsMed+QLdt85mHH44UpqVhuHm0QmwOr76409oc6gYGETC6eVgvSA22CuukFDqboefe20OpgtaaSy+9lPfefbc+FiCIYS2LLVu2OPz3KO+1s/VCLsde8+Y51KFOgCikUjS7qlZpGMz+4AeZsOeeFdRBCMH4xkb22Gef8KKMpkn/E/eDYbw/gMHjSUsxPwHMv3VYJ5FK0X7VZYhYOFVIJpNc+h//gRmL1YTJozCnrRRdPT0ceuihCCl9P533S9dCMG/ePEe4DHoOjKAL22bcCy+A6wCYVYrPL1pUQR2kEOy5996c+YUvhFIOrRSbr7oMo3HcTgcMdZoE3c2vNIiyckwatH9MFM8VzncndNotrSQ02td76FKtkws8nTf/LoI4ab7/gx/wbmvriDJDlAt0Wiksy+IgNyHv0NAQUsptVnBkhzQhkIARi6FGkSBZNzQw/vnn6TrhBISUpFtamLFgARuXLCkiNCE48uijOeKAAyCVgmy2FNkpRX7Du9i93S70yF2bMhRZoSjMH8E6UTvrJGJxum77QyRVSCSTfOPrXydmmoGxjKxryyKdSpWkiGzbtMkd3/uoK5t8LsfsWbMcYFCqri4KBZpeeQVcnzBLSj7z9NMlm922bfbec0+yb77J7AULQlXFxZDQnYtVqttrdVihWY+GdbIRsQRtV3w31NqsteaCr59Pa+t7rgpx5Gtr25rGpnHss+++JdkyWt99D9tW9e6XnbaDYN68vbCVQjkKwbp6obGR5kWLfDdvaZrMOv74kvVpbGoiD5x60UURrJLNlv/9+U7nyVqn16onWHn8fnFj+5gfQfat19H5QlHrpEIAqEL2cI73P/toZJIywzD43ne/RyweQ7teOyPrmlg8xje/eSEDAwMlrs6t61tRWtV53525a5LJBHKU7J+wLJoXL0bbtuO1YZp88tFH/XU59thjUbaNaGhg/gEHIFOpSgObUuTXr0P19+1UWqX62SRVlBu0t8kDQCEbm2n9t38gNmV6cZNTA+ukNEZjExt/cIELVJXt7//+71m/YT1a2XVGndmsW7uOG2680S9D5bWVb7/tAuRO5Nu0VbpNNptlwoQJqDrfm6dYyDc0MG7pUhRgK8WGpUt9FunUU08lk806mqxnnmHGcceFs0qGwcDzj78PZAYvuEepgIwQkANQPl/53jc/g4iZNWudtG2Ra12L1dEemXPnV7/8FVIY2PWwDLYmlWrg2OOODb33WytWYCtd3713+q7Zc895KFuPytdK2IrxTz3tWKWV4pVATPf06W4CL1vB+g0c953vRNojOm/9w07FKpn1EQZX3eZRA0ddhBY42iUNuuAk/e1/+gEy//g54rPmIoPJpzytk69RcBZIphrY9NNvO45dZbYFIQSHHnoouVzWPX/kZv1YLMbPfnYFsViMQog8sn79ehLx2E6TY2lrtylTJqNsCyFGF1tgp5Kk1qxBz53LuiefxDRNTjrpJJRl+VyATMTZz6UMuqw4u7Zthl55oZiycifQ3o2KTfKpQdB122OdvHlLSevX/hFz8nSXnSrTOrnYBdfmoG2bvofuijSy/eLnPyeTybgku6z7pLyctBdzFlmWxc9/8YsSQAiqUbu6uojH48VULTqMVYh4ni77riLOibpvtfOjxqCHeX7gU7vdiMVcFDaKP61pue8+CsDgpk1YlsXpp32EXD7vn2Mnk/Duu0w+9NBIVXVuxZs7vDTAqNmkohCsSx33Ary/JyyhbNZfcB4iFvdDGKMMdgPPP+6UTgpRp7a0tLDffvsjpeHBTmnXFI/ryv/jiSRf/drX/Dpo3gIFC43ncjlisbijpQq7l67yPFX2XUecE3XfaudHjUEN8/zAp60gmyvQ0jLJTZKgq2jj9DD/K9TQECuuuQaAuXPnkko1oBHFcwDj5Zc56EtfCpX/RCxG9z23IVPpXdgC7fP8ZdQgqC0K8vtaM/DCk2ReX4zOZUNcNZwuG8ax+er/ClfHac3/98Uv0tbm2gFG2JVtMTjQzyOPPIJt237+1b/cdRf//s1v+kl7c7kcuVwWpeztytBrZTtxGtv6WVqx+6yZqBJ5LCKgYZj/jcZGXvn+9wH4/Oc/TyYzVHqObdPw3nvM/+IXw/eRZdFzz63IxM5R46M+xlG7Cyilw/MHeD7tyxCVVtD3Lvwk+y7cgN3T4VqnPbuzBltj93SSf3d15GO/+tWv0t3dU1fWh3giwQUXfB3DMPwUjw899BDTpk7j4EPm8/0f/KBoeGtrJ5lMjloNOZI2lBmksbEJZW9bVaPGycmqbLsYZxH4DSrjI8p/876k0w20d3Yyb948msc1k8/l0O74veuNwUFiQMP06Qy5nsVBJKkyg1jdXQ6V3sGapVGwSfhsUgk1UI4MUbFhtfN6Wv/tE4hEslT2UIBh0vvw3aHpX4QQHHLIIfT197vxvCPrtlYULIsHHnzQT651ww03MHXqVMyYSTaX5aqrrvLdOhYuWoit7O1mAYgl4px2+kd59rnntoO1QSMM6RQH1LrkfRbTz+iK96zLjlm2zTtrVpPL5fjKl79CJpupOF+hsU2DTEcHM084IVw2kJKhpS/uugK0LnPi0trN5hYQpIUOpyhDryxkcPFzTkHEgMFOptJ03nBlaAkirTUXX3QRmaGhGpjtMqZba2KmyfXXX+ezQl/+0pc4dP58x5VDaWzL4vTTTmPq1KkAPPXkkzU+R42A+Y8SBBRvvvEGXV2dfO9738PwKlbWJFjoKoJSxDlaY+ULNKTTowu4Ah566CH+6Z/+CSFFpICsEgni3d0c8qUvhd9HSvoevKu2Mlk7qzZJBQ1nKgAUQbtDhNPYhm//K+bEaWjbBSLbxurYjN3TVbFAQggSiQQf+tCH3HSLtaZ41L4GyTAMrrjiCizLYu+99uLCC78JiJJMewMDAzz+2GMAvPDii8QTyeE1PoGIsuHGUfq9eCyeSPAvn/wkWmva29sxTRM75Lxa5zvsObaiULCYNGmy45pRl9FS0Tx+PJs2beLYY46pnvVbCFKtrcw84YTwrWTb9D52X9Uoxp0cGEDgJcgqVav6rJPS0WpZKWn92rnIZNohDIZJ35P3RWbIW7BggVOQUGs/8UrxM6q7CVq05u0VK3wN0mOPP8bAYD9K22VkHTLZDPfffz8dHR00NKTd5+mQNC06InWLrvK/Dj329ooVZLNZf6533HlngB2JuoeqmGf0uMIz/02dOiXSwj88l6xZv349F190EUOZzLCIM9naigYaZ8+uDPrRGp3PYff27HDXjFHYGYruF7pcrTpcuhilyLy+hIGFj6FzGWQyTfcdfwhdHK0137jgAiftop+hLvgZ1Z3fE4kEV1xxBbZtc+2119K2qS0Qt1x5zayZM/n617/O6tWry+KGdch1OuR41P+q4pghJV8o8/u/7LLL/FQ30ffQFfOMHlflONGacU1NNYe3lne0pqmx0U1BM8w62DaxjRsZAmYcc0wkAGZWvrlrUgY/nDAgPHvxtr4H6nB+80Kw8QdfxRjfgurrodC+sQIzeCzSYYd9wGGRXPas5DOqKydox1aK5557jn322ZcFRyxwUi5GnK+UplCw+H+f+QwrVq6MfoYqvabkvGrjKztPa9iyZUvJnLPZLJlMNvpeqspYhhtDYKzSMNGuNq+eXnNMtdaIXA6dy7Hvpz4VvhVicQaeebioWNmVgEEoHXDDLnXb9rHPcO4MHrv0lXPIrVoGERU6DzrwILo6OwNRcar0s4o+XWjNsjcdjHP3XX8mm81E2ygC/v+FfJ4FRxzhbJWoc8tjHsJ+i7rOxajXXntthYZFa80VV1wekMci7l/tebrKua6MZ1sWMcOIsOBtZRuKkJjZLLNOOy1Sbuh/+hHkDq7jUCebFBCavboAPmvkLKJSNWgqlCK74g02/fSiUKc8rTWf/dxnHbVd0NNSR7gklPVYPM61113H3597Lr29vegwNwod7vJg21b079XcMVSEW0jgHFspDNPgd78Pj+K74847SSaTlQKujhi3rv68lrX+twAAIABJREFUSlcOm4JVIN2QdtNLsu261tjxGObgIHEgMWFCiEu3TW7NSrRt7dA6DnU66jkCNEq6E/OSdhWdscQIcuNYHZsjX8JJJ55Eb29vqTxenh6xCqw/9thjvLNyFR2dXZUAqoexTtX6mx7meOg5osJ9PMgeLlnyMvvvv7+T7bzW59T6jrST+6qpaRw9Pb3bXMWvDJNYWzuDM2Ywbq+96Hj55VCbg9WxGZlMgjB2LcqgFCWZMLwAHl+WUHpklKbCFiOZOXMmViHvO5iNpCtls2VLO2eddRYbN21Ea7uu+2yrvnDhwlAg8JUG37gAQ4qt8KzoeY9rHucGMm3jPwHxTRvJ2ja7nXxyhBAtyK5azo4sq1x3EjGhvGg3SmISSuwNo8EmSnHyySfT1d0dmXArOnGWU+tg0aJFXHH55ZimOaJEYarGBF2qSrIyFZHoy7PM//GPN5XM9/jjj2fevHk+QPT29TGUybiAHZ00rFqyNMANYQ25Xmsa0+m6/Lzq6fENG9CGwewzz4wQomMMvbIotMb0zi8zULRq+kAR1DCp0fN+H/vYxxzjWIisWlV+th1ME4vF2bKlA2XrcDlSDS8fDyOjR8qvUTKvVhAz4yx5+eWSuf7m11dx15/+TCqZ9GtBf+PCC504kTrlZzQ89dTTCGH4XqfF8zXJZMq1pXj8ve9NE/1Zy7llv2ulMLZ0oIHJH/xgBPazGXzpuR3qwSrrhQVdRg0ICtKjza3qlqzde6+9kFJUmJKGM7kpFPl8jhNOON6hUlVMWHoY09hoTG7hv9kgdInv1n/913/R3dtDT28PixYtYuLEiRiGwSuvvIIZM1HYoc/Xw4wpX8gzY8Z0HnvsYQzTcA2NxfOkIUtz5npbWVf51Gr4c8t+10ohhwYQQAIwGxoqiyEqxdAbr+xQH6X6KYNWldSgJAubGnbDV/tt5qxZJSWeonKmRrkLaK0pFApV2avh7h3FUqlh8qxWz8uq2bx5c8l8P/LhD/vvrqenh6eeeILDDjsMgIu/9S1XQTf8uFVIntWpU6eCkLzwwgsIKQJjcXJbeRqfbVm4SGuNyBfQlkUOSM+cWbn+2nHLUZnByHDfndcC7ZWyUmX5U4PRbBHtAx/4QFWZQinFUQsW0NvbV3d1zZ22a83y5cv9uX7rW9+iv7+/JB6ks7OL3179P3z9/PN5+umnnTypdTwLDePGjcMuWPT397Npw6aS6qG2bWN4GsBtXcYLgczmKFgW4+bNi1x/q6tjxxXOrNdrVfu1wlyLs78Aqui9GvZA6ZDmH/3oR76/UFg75dRTYYSlm3aFP601r7z6qj/Pj597bmjl0P6Bfs4++2zuvvtuzvvkvzhsTh2ls5w4Acdd+6+v/dWvBqpxM5YLN9P2tnZVNw3IZijYNpMWLIjcH4WN7+0wU0Pd2qSSjBgBZz2tA/UbqgDTR884g0mTJmFEWJ4PPPAAh4y/z1K2aK1ZtmwZ4BQv7+vvDz3PVk4AUkM6zZ2330E2mx3xs2xlk8/nSSWTaKWIxWIsWrgIIQS2srGVXfQk2MbaJFtK5NAQWmsmH3NMOHtsmmRXLgvNorjzAgOlMdBUxEBXZ/symSz9ff3ccN31zoKUyQvjmseRMBMuK/b+6hJJa2srAN/+1iXFOJCQ7jjzGfR29zoGzTqep2zFhAkTfFkul8vR29Pr3N92Suxqrbd9JS/DwOzpASmZMH9+lLRI7p23kbH4rsQmBTPpedSgXK1aBRqERkhBIpXgK1/5ih9047UZ02fQN9AXyj7s6n/CEPT19QEwc9bM2q4So6syOrGlpWTDL16yGCGFyy5tn7J2tmFguPNOt7REKmayK5fBDrI11BcDrTRKaqTyAmgDeZPcvNpCRt/ashwWIJ/P8y/nncctt9xCv8suaK054IADGBwcxDCNcNcGURvxGpExc7hCb2HHwoq6DVNMzmP99t9/f6cAuhcvHlUwTgwzn+EK0AFNjY3YyvYxnzQMNmzYwPTp0zGkJLc94giEwOjqQnkZwZMJ7Fy+NJeS1uTfW7fDtKv1B/cE1KjlMdC+ES4SGCyf7Pd093DTDTeW6N2PXHCkExhvU+xB8m/X0Gs9r/z+w91DRYxJ1fBczz4DfOZTn0LbuvQaVWU8aph5qohjCuKxOH5RNpc9WrZsuVuYRYdY1LZ+1wqMvgHQjjo3PqGlEra1xtrStqvZGXRZ7qRgakmXdRIyUnjOZbMIQzpsgxQkU0m+fv75GIaBEIJrr7vW8agUivffnwMMHzj8iO32REs5ZXeDBkjTNGhr3+yzUtsj9YHR34sWCktr4uObKw1sLgbVudwOUa/W57WqlFMD2i1WUvRR1QjtlrxFI1y3gvKJ5QsFpNZ+WhFLKc495xz+fNddtLW1sWLFCto2baKpqamq+nW0zaNspmlgGibC1Wxp7WXfK7hhF1svhYl24zyk0HWHXY602YUCiUSCbDbrZ8OTQvL222+RTqcdmU3juJfbNkorpNi6aVu0UojMENrWWIUMiYkt0Vy4lyxiO/NLZt2Uwd1IIlCdByHQQhf9lpJpyAxWXJ7L5ZDSKIkO7enp5do/XMNpZ5yOEIJLv/tdrvnfPzgLuJWQhOdsrjWkG9IMDQzQ+t57bFi/nu7uLjKZDCBIJOKMG9fM9OnTmbX77kyYMIFCoYBlWUghR1W41VaayZMmk8nktkvIrwBsbZNMJLEKTuB+d083XZ2d9Pb1ksvlUMrZ/IlkkubxzUyaNIkJ4yf4VvyoGtQj3TMyk3USumWypGfuFokM1EA/Mp3eNSiDzyaJYjVJIQKSm3ay1RnJBiw/y1qAMuTz2G5wiv+LFOTyOX52xRX8+0UXsW7dOt5Z/Q5TpkzBMM2tRQpIJpO8+cYbLFmymO6ubuLxGLFY3MWEGpAMDgzS1dXN6nfeIZfPE4/H2WvvvTn8iMNpbm4mm806znR1CFtKK447/jgs29r2mM/FIslkkkw2w/MLn6O3pxcpJIZpIoVL0d3zhjJDdHZsYcXbbyOEYMqUKeyz7740jRtHPpdHSDG6seTzTshwIU9y2rRohDHQh0ilt7szd93aJKQHECHBPW6qNtnQBD1bKpBKPp+nkM+jbFWxHw7c/wDOOP0MHn/icb77ve9xx2230d8/MCrMpJUmmU6xfNlynnryCaSQxGIxGtKNPgB7YCkCVeYM0yRtmgghaH33Xd5+6y2mTpvKSSedRHNzM4VCYWS137Sj9z/yiAWub9C244uVUqTTad54/XUWLXqBfD5PNpMnkUj6rhDae6eiqIAS0iAeM0A4yo3nnnmG5vHj+cDhh2MIWfcyaCEQhQLYFkIpUlWAQQ0OwORdRLXqxTCULKabYt6RFwCrgBw3ATaICj4doJB3nOjKN9NQJsM3LriAhYsWsmXLFhYuXMQ+++xTdxFDrTWxWIxbb76F3t5e4vGEr3P3vTYDYygWZiweFgKE0KQbUgwODHDnHXcwZ85cTjn1VJ9K1NpyuRxz584dVuM2mmYYBj093dxx2x0obbvUz6CzqxMhggm/RHE9/fqEqkSFG0skyGZzPPHYE+yz777MmTun7nT9YijjPMvWJCZPrU4ZdoB+dRReq+GFDf2qN5aF0TQxclJD2Ywbf1vqfKyFpqevh5v/+EcA/vunP2HylEkhuYSiHKsDXSuyuSz/+7vfk81kMU0TKWVJF9JASolheMcEhuHU3pNSuJU/JSARSLQWpFJpNm/ezPXXXUdPTw9a6LLxRedNsrXjOl3d8VvX+L3M4VwrYok4i15YxP333YdhGhiGCQikNBFCBroIALqT5tTpxXdTnLMmkYyzdu0aXn55MaZp1BV15xTusEHbJCZNjNiR0qEMuwwwKKILG3op5gsFjOZojUFnZ2dZ5cmih6NEkM1kufYP1zA0NMQtt9xGPpeLyL0enqNd24qhwSFuvfkWUukUCHzVrbfppfQ2PQghAxvfcDaC8M4TgU0ifEqQTCZ55OGHWfbGm2VpIYdJLamHSwupavxevKeyFIaU/PmOO1nfup5kMunP1TAMJ5VmYPM7FEJWAEhwDxYBxL2PlAwODLFw4UJMM1ZMihJig9RhOhdboyzH9d+MTCcp0NkhkLsIMGjK6rKFpZi3beT4lsi4hs2bt7ghiTokBaPzKpubm/n+d7/HNddew8SWSaV5ikrSO5Z221ZYtsWf7ryThoZ0GeYrxfbOxjdKMGKRSkikNHxAMQwDKYvnOoXZE6xauYKFzz2HrEh/qUPSUOrIVJPVU1Kq0HnbSvkW/TvvuAPQPoYvAr6TuME0y7C+kI6kFwAQ73goFZHu6ts2SxYvxjCkHzYa/Cz/Xuw2WDbYChmhFBFSYPX2eA/bFSiDHr6krWURGz85MmXgho0bylK7eMmuisdsZXPwIQfzhS98gR/9+EcUStK36ND0MLayMUyDP91+uwsIwY0fhu0FhuFtHBEACKNsQwUpiQgAhEQIg81bOnjumWeLyc788emQMYd96pDror6Xp4qx+cvdd7vyUJHKOb2IBIQwPDG5AjkU51JKJcKoiNaQy2ZZ/c5qhJQ1GaG18KiIwwobyWj/I7GDXLjrV626tgQtdEDodFkk4URUiaYJkbdY/956ODLAXpUaA/xPq1Dg9NNOY6CvH7tgIUyj1CBURk1Nw+TxRx8jmUq7wrr2hUatdYkMEy0sR+ELUXI/b6DevXt6enhh0SIWHHmkU+wkyC+UzasGg0jl97LfNRopDe67735SqZRjTPMMnR4NV0WjZSxmVgi/QVuPpygovlThaqaC76eI3DZu2MCUqVNI1pIJT3gcg3YpQ7yGye9KdgZDOTaFEuuz+x0wmsKFJCEEGzZuwDBMlyWqkhtIQy6b45xzz6G9vZ1JLZNKq87o0hfZ0dFOT0+Pj9FLN2xxswe/FxdBVCyMIx6IkmMe1tTaBQohcBVpdHd38fZbbzFvr72qz2sYFWwk8x04FovFePCBB0kmEwR9JoVn/0Egpfa3l2GYWFa5y3yYrCpKCLqUwYFIfwuYMclfl/6Vo4/5oF/3oiYW2xX5d7ZWpzuGBqkQShZpmvasz569AUQiFQkMHR0dmDGTXC4XvUMCmFQVFBPGj3cwboSHp2GaPPvMM8Tj8bLNW4ntixiwHNsHqUbld/9+5fAjvJ0lWffuOiZNnkRTU1Px2nLKEIUAo8rolMCkkzDhmWeexYyZrntF0PvVmbAmgPXRmKZJoZCvUKsWVbzKPy5lpftuORUBTTweZ33re8zYbUZ19xLPwKcUWPbwuXh3KcrgRbS5DhlF63PR3mDEU5G6/56eHhLxBNlMrjYsqYsLEoZlhRCsW7OWVCoRYBNEBVYvX+hg4i4A0zSJxWI+K6ZxBFTLKrhGqQAkuNfKIKDgyCAvL3mZk085peiNq2ukEDVk5dNa07puDflcznmix7KJUu2O0C5VcBUc8XiMQsFEBqILbdvyi6YHKWgRQPQwVESzfv17TJ8xfXiiF0hYnevurmob2vXYJNfSrH1NhOu4p4sbzGhuwe7rrgh96+vrc4uFbB0MYRgGb7zxOqYZC8gBoowNIqBfL8oQ6VSavv4+3m1tZdOmTfT195HP59FAIh6nqamJ6dOns/vuu9MycSLZbAZlO85uvhwiimgBIJFI8OILL7DgqCO3ep02pRTr1q3zo9Q8a7JA+IoNL7QzmUyitGbDxg2sXLGCLZ2d5LJZ5zwhSMYTNDY20tLSQsvEiQgEuUI+UF5NRFARXTLXTZs2MW3qtOiNLEDF4mjLdhw0bR1pwzLGNe86XqsojZYaEZCsfIcMLYqsk21jTp6J3d9Tyj5rJzNDJjuE1vZWsDYKOjs6iMXiNQvLAogl4rz86qu89vrrLrtGmQDqtPbNm1m5apVPOfbfdz+OPuooEomE63Qoi4AQYJtsZdPe1sakSZO2mg1JSoPFi5dgxhxPUyED5EAU321DQwNr1q7hpcVL2LhpYwi757RBBujs6mTdu+sAGD9+PHvNm8fkSZPIZnM+pXCuD3odiBIBe9PGTUybNs113gwneFoK3IAKCv29kXhWGMYuBAx+kRJZzPDvCs9a+F5K6HyW2Iy55NcuCyWhra3v0dLSMmo3bcOQvPXWWyX1nUsEZF3k6ZVSNDQ2snDRIl5+5ZWKDaIiCqYU2QqbN5cv4/U332DOHnP46Bmn+4DnfQbvuXr1aqZMmVqzgDmca8nmze0Vz9CBQKtUOsWaNWu48Y83kXUBdSTsR29vL0tefplkMslh8+fT2NTkGEdDAMDbC1JqhDAZHBggmUyHs0sSbDMOtmN8y3d2RVIGOW7CLuTC7bFIQqG9+IUgxnBZJ3SB2Iw5jrElpK1atYrx45tHSRkcQ9TQ0BCxWAyPABTlY+lqt4oY9Le//72vYhwpf+rbV4B3W9/lN//zPxx/7LEcdeSRZDJZZ6Mi/DQtMiZZtWoVe+wxm9Em1TUMybsee6R0kTUSGlvbxONxbr71Vtrb2/13OtIywd7ccrkci158kRnTZzB//nxyuZyLWHRAwxQEEEF7+2b2mLNHOEJBYsdNlLJA22TKirQESYPZPMFRzRvbNxt3nQkBKPNJCi9lpW0bY8qsSJK3/O23XLZkNFmmNV1dncSTcYThmJqlcCzHUhgYSAzh2CbaN2/m2huu9zPtbQ3eHeDZ55/nhptuIp1OO8AQNN5Jg15X1TvabNrr31tPzIw5bJkhkIZ0upR0dnTxq1//2s/WN1oh1Lu+rb2NJ596gmQijoCi9d7vwrcjDAwO+HHsYd1OJPz8WtlNm6I35Q6q/Fm3o56fWrKssKEOxkNrjdk8JYL3dVKmOC7FgYS9OuRTR/8mhGTTxk3Ohkcica2lntuFdDbNho0b+b/77t1m2ootHR389GdXON61Av/ZCDBMg3Xr1g07F60Crktl5fGEMNjSucXxHhFFhzrDNFi2bBm3/+mObTI3pRS5XJ6HHnmEeDzha5ykk5sMKYSDfIRjtc/n8hWlkT1kaKdSCNtCCMhubo/elI1NOyQpwChioIsYoHTlAlVAAZFMlyvJ/UXr6OggkYi72MR2EuO67gVK2cXP4Pfyc5Siv7/fT1bsbxJR/N7X28d9D9y/TV+kJy/87Je/IB4ACEMaGNJgwI3JKI49ZJ7adt6D9z5UsW/ZsgXTMF2q53bD4KXFi3nsySe2+dy01jz6+GMkEvESFw5wKQQS0zAYGBjwOenSrimkG9CWQhgmQxs3RsoEsqmZHVGnoc4s3AGfpCBQVLBODo9uTp1V4YWotSaTyZAZGiopUaX9jVIsw6R1eVY62z9mWQWf0gSpgYdBzZjJzbfdul1epoeVL//5z2lINzg2AOl0wzAcT11ll84zNHFy8H04WKWzowPDcxJ0g2xWrljBc88/v93mZts2Ly5eXBJ5WPRxcqj00NCgzz2U1xGwGtJgF5Axk3xXV6SsKFOpHVKzpG6ZwU8kFsjEHVoTOp8hvseBrrNciBD9zmrX67KMPQhhHYLneMey2ZyjZvQ8NQ3hb5hkIsn1N9ywQwJFfnHlL0k3NLgshIE0DLq6u31Ht/I5lcyvbK65XB7he886bui5fI57779/u85JKUVHRwddXV2+rBKABMDJ2BeaidtWWKk02taIeIJ8b28lS+cZMRPJXSieIZAfKUyQDrJOOp8nscf+kRqlpX9d6mPAEQeLoMlmMpimiSEMx/qLIzsY0mDturUMDA7uEIvm4OAQ9/zfPS61cvlrKZx61nUoCAxD+F6mDY0NXHX11TtEyNRa88KLL2JKp3Su7w/s+YIJ4VSLKaMMwrKw0mknAhJNwc2uVw4MZssUPwB3lwAG4W2uqOCeEnnCxpw2J1SjJIRg2fLlJJOOC0U9SXyzuSyyTGAWUhCPx7n7nnu2itao3vba66+Tz+cRUiJcOaant2dEcwRNIV8oasik5JrrrmNHNiklK1e/Q8w0Sty/cRUYlm27FYF0sf6DbWGnEmhlUxgaQuXzFXtCCEF89p41O61ql0XeocCgPMxfloC4JJmYDuTlrxLx1t7WTiKR9Mssjay7GyUoMBuOhuWd1e+MPudS0aG/Mj6y/HiAzAfbb66+mmQi6fP7uWwOrUXNc8znCohAMNHQ4JCfuLicvQgdc9hYq4y3Vnbp7bffdvJiuTYGx0vYiSv31atePSutkQUL24ihCxZD774XBWWk9jsYnctGPRhtWchUA+aESVgdmylsWr/VrNWjCO4JlLJCl+RSqoiLRmJO2q0ieklrTSaboa+vF9u2GGnOQu0G8wgpXKWGsyjxeJx777+/fqtv2MYJHo/agOXfgVw+z4qVKx3DpLuptbZrnKPNUGbQ580TySS//d/fR4+5PDFB2BxCxlgPUEgp2bRpkxsV6OtZnWAfr+qrX+/TTVAWj6GUTc+yNyL3VXKf/dG+Z612kq4JgTlxEsRiDLzwFK1f/Sfe2DvNO2cfTXLvA3YC1aof2RZmbyhjnXIZEvscXrlYbnt16VIsy6qr3gFQVDe6+u6hwaGRZ3CI2jhBlUn5hveOD7Ohbr39NlKppM/ze4m7hu/aSVwmHb3+li2b3URnVcZbIdQGAEUa4QBTJ3V4/Y03MA3TZY+c9AEC4XMIJSGfbgQgStFZVtzR31a2RWLe/qhcFtnQiDlhEoW2DWy5+ie8/aF9eevw3Vj/7//KwAtPIUyT3X70a+z+3q0mbI86iRiu96Pjten6kwTclRBOPHRiz0MYXPh/oXLDiy+9xCEHHVIUdKtlpS6TrQTCT+glcLxXX3n1VQwpsWuVF8KwZHCT+x655blBAwoFXaJqq9g4GzZsYMqUKUjhCNGmUSX1TcDnz1PPSiG54aabSscYRo28gKawDeJSad+xKGSsI2E5nAIqtuvAJ0tuqcvebyHlqJqNVAM9y5Y5LFbI+sR3n0P/kw/R+9BdDLzwtHN5wDvXARrHuXPCxz+L3de11YTt+r1WhXZzrQqfTdJuiSohAkDh7hlzyuzI27W2ttLQmKa/r58KD+EqkV7CZT2CUQtmLMbil5c4WGiklKEE6xvFgB3tsgFhwKBs59ygeTm4yK7D2a233ca/X/jvbkoXSqP1IuYHGmE4NgXTNJ26DuXj9Nkjd4xetKGQIen0XVnPlG4NjYCONzDWWgFCCEFndzctE1tK8y5ByUbXUmKNa0JbFmZTE5m2tnANnxC8few8FwBMfyxhgUC7XX4Ndm/nVk0cMOpcq74THMIPlnXdx0rQnIinkA3jUEP9FTn5BwcH6e3pRWkdncIwhFoILXzfpmJAmPatoCMGgHKhUxqlAmg5i6E1KMPPBuIFIJWgSHdBu3t6SCQTvsOb8qiJiJ6nlwNVo3nu+ef9VJ7+OPxxesDgZiwI/la2Zj5AYBOIFgocHxmVWL9+PdOmTPHlM6UlWpSXqhFkJ09C2xZWLkuhtzd6XwVYpqg1E4kk4//uH7B7unYGO0NpVc+omtC+MI1G57Ik9/tgpNyw6MUXULZVrX5q6af73TAcdwfhygzZTHbkgBDkqz0HNMOEWMzp8bhTTSYeh0TC6fFA984zTReAjIrNqLVm5coVbpYKWTmXsHmiMQxJPB7j8aeeqGSHhARpOt0bZyxeHF9wrP6Y4844Y7HKsYa9k2Ha5vZ2J3LOfW9COEiqZE62TX5CCzqbo2/Z8tEaOtj9yj9idW7ZWSzQng2BssKGpTWhHXuDo3XShSyJfY90MGgIuV28eImfBzQ8jYqqTC2jlJ8YzPEBkvS5fkojVI24C+9i1lgM4u7m9jZ8KgnJlJNZPJl2vqdSpYDhAYThbg6jVIh9/Kmn/GRc1VLkeMc9hUAykSSXzRXvZXgAa4Dp9nisuOn9saWKY00k3bG6gG0GAFjI6gqEKvtgcGioxHHPEG4AT6CIlSjkyU8cj7At2p5+ajQGDsyWyTR96LRt4t49ingG7bInooTfLJayqmSdzKmzI1/q+g3ricVjZHO5GoSG4nHpGrQQAikE3T09SCmrq1VD+W43p6RhuJgzXsT40ihuco+yaQ2W5QC3bUGhAJYBniHIQxayqCNft3YtiUSSfKEAbgK1avPzEm1t6ehwEE0QaD2NkWm63dvcMQc4pFkERo8Fsm13zO54C/niu7CK4xypMK0pyiie53JQJpD5AlYiiUim2PLii34gVB0qLGb98ibszi1FdnCHA0MgBtqrSVbMI1Ss71aagwcQBrHpe1JoWxtaDvTNN5cxc8YM11g2nDrJBQY3+ZeX7CqXzdShUg1sLI89SiSKLIe3yQx3g/nAYIOVdzZWPg/5XCmgWZbTXYWCcsvP2raFtkXRcBmmThLFENQ3ly2rlGli7qY3Yy7gxiGZDABErAgMyvEEcIAhD9lcgDUKMAcWpcJ0ra8Q7fthahmCwATYpkkylWJo/fr6siJJg/j0mTQsOAa7t2ebWNbrzMKtHZcMLwZaFAPSCcRAexl7hFfIJDtI8pAPUWhfW/m+hODxJ57gXz/3Wd8NYVh1UuBazy0gXyiMUGgOYFnDZTdiLiuRCrAXMee4MB33bG0rZ/MX8pDLuaxRICmTJ1R7qk6XtRwcHMA0TafaZmTuIEcOM00DpRSr3llVKdRLCYY7Vm+MqbTLssXAjCPicXc8Cl0oOFQrn3eoRtYVuoOUQ0pnNwezhtUAGJ5Gz+O7SzR5QmCn02ilGGxtddwwQtjkYSmFspn165uxujocTdO2cDOp3wIdUthQBQql62KiXP+4bZOYe2hoykmtNWvXrSWZTEfmUI3qhjRcc48kEY+PjCrIgBbGw/7xuAMIyRSk09DY5JiUmseTPuwDNBx5NOaUqc78m5oh3eBsxFSqVEgNslXu5uofGPABd7h5eTEaG9vaqMgI7Ms2LvVKuXJCQwM0NIFhkNhnXxo+eAyJvfd1rm9ocuaTSjnjTSSKbJafgVmOWHaQQjj5ut3rgtFtCshMnEissZG3f3NVUSUeuP/kyZM5/vjjSCTCU04KwyC5z0Gk9j9kmwHCKNgZOr3TAAAgAElEQVQkBVoWZYZgRgw3/reEdRIalEALgUw0IBsnoga7KzCObdu8/dZyvyRrzc0VooUUNDQ2jtzdQojiZojFiuxRKg0NjSAle/zqZzTut29JXrlcZxdrL7oUq72tWAHHVg4GtkwwLBfLSkeolJKOri4mtUxy5akqMoPWvst2JpstsyQHZIVY3AWIpCMsC8GkT32Saed9wqeh7tNpu+EWOm++BVINPrbFtp1Py3S+1yFIC2kUp+EqTYTrgpGKJ1jT2cWSk07075lIJJg1axZ7zpnLlMlTsGyLtRs2+BlKKi3TNrN+eT1Wd+c2jYuuH8wCWiSErhCko1gnlR0iffjpDDx7u5Orv4xcPvzoI3z+8//q5hoanrvUgKGFW4dA09LSMkJPVW+DBQTReALiSQeDxmIceO+fsTI2doADU4BsHM++1/2WFV+9gPzadUUhteDKEYZRZJWUm1LHVn7GCkW0kK9w8qbGYia5bLaUpTNclajpar0SrqYrFmP3y35E4yGHYOeL4pZyX9TUf/lnUvvsw/of/ABU0gVcV64xAuP13l8wD2cVNsbJxu3MxXLdzg3TJJfJc98D95PJZJgxfTq7z5rF7rNmkUqnyeVy2LZFNp8llUqxePFLoc8RpknqkCNIzJ6HPdDHtmx1AYNSGulhfI8auOggTJAuARZVILH34Qw8fUsoq/RuayvxWIKh/GDN2MlWNomE4wbeMnFibZoKb3N52NZwbQueDj4RByHZ67prsHIaYRqhvLJVgL2v/hVvnvJRh5oU8hALqFcrvEa9NVdVCxxqha8YkKaBbatSOcfTfBkuZUgmaTzqaBrnH+LgmMq0sWgkTYcfSurg+WReW+oArBkHM18q89RIGYQQpFIpR1XsusQo5aiKl73+GplMjpNOOokJ4ydg27ZTugynOpP7AlH5PIvb2rCjqIJlMevyP2D1dm/zbBl1xzNoN9YZXeq56ssMZVFvXopDkIhkE8b4yZEv/Pnnn8eyrJD8/uHdtm0npkFImprGjYS8lbFKAYAwYxgTJxKf1DxsYT/bhqaPfLgoK4Qas5x7pNJpR/VrDTMvrXyVsROIH3QVCco57rNsxcyLLigntiFTNtj9O99yvnsaKQ8Q5MjlhenTZ7jIXGC7dSK0Uhw6/zAOO/RQErEE2UyGgic4e3YnpVEazMlTeWvRovB9ZsYYd/KZmFNnbJe0MaPwWiXgsk1pjYYIQRr3uM4Okj7i7NCXLoTgmeeepaEx7ZaGqqXMuKZgWy5bEfOr1tTnjlH8P3Xggdg5VRNMTTj5pNL0KRVu0s77mjp5ClJI8oX88PNSGmUrxjU2BRKolruOuPKOZSGr1DwIjiPe3OTw+WFjHYmsIARz9pjt1I02JAWr4GgPpSCbzbjfi47cwT/QGNkMT/31VUSETUhbBXb78VXYfb1sj1a3BTroOqA9//Uyd27tu2p46jlXu2QrYnvOj9Qq9fX10bGlE9uyPbf+0q7KvmvIDmUc3lUrjjryyBEWMg+LRxDIVLLmOxgNDZWb1QMC77tSTJw4EWkYDqYMm5s7J6EFtu0UgJw7Z04gbWVEHAXUbHnXvtWdCNaotvsopZg+fbp7hUDZyg3oKQYneaEZOvDpKBYVPfvuT/vLL4dbWmJxWj79ZUQyvd2SiY1OtRpS2LAm1gknD1B8j0McEh+Cce65916EEG5y4rJul323Ffl8HsMwsG2bE044obbAHs+xTpd5brryT+ad1Uizto0x8PprAU1bwDVaB+csaEinMU1JPlcIn1tgfpmhQaQUHHLIwcX7BedVmlipekr4MmDQllWagUEFx1y7AiKVTDnGzpybzLgY7AmBMowEPwWYjQ0886c7IgFYF/JM+/cfoUdqRN0xbFJYKavaWSedHSS94O8ctV4IdVizdg2xmFkTm+RVuuzv7wcE06dNH5maWIjSWEvXbaGwdp1THne4l2hCxy23OcKz56Kh7FLNiNYk0ils5agva5rPwCCGYTD/kPmOsOu5ZJS4V7guFskEPU8+NyxS17ZF++13OSBhW0X1KqoEEQw7Zyk57NDDUFphGCaZbNZha/XwXff18ea4ZnKtraHKDmGa7PbDq1DZTKRj584FDAGMoityudTAOiEwWmYiYolIPvX+Bx8sskrDdIGgr7fPL1Ry4oc+VHsMtIclPd8dz1KrFasv+R6yWglqqem472HH5TgfAAavB/LaHPvBY7Es24lrRgw7p2wmgyFNmsc1F7V0tlMg0PeJ8saby7Hxip8hTTccNxQQFEbMoOP6G53r83kXmNx7BiuIDqORU0px8MEHo2yFlS8EOILhOuROOZm3/vf34esuBMKMM+ETn9numbjrTiKmoaKwoY6oCR3OOjnUofG48yIDNF5dupSGxsbaQiRtR6s0ODiIZRU452Mfq84qlS9ScAMHfI0yb75B6+VX4pR9cAJNtO0kATNj0P3Qo7T/5jcwlHHcM/J5Z3MGKQ2OU9+5H/sY0jDo7Oh0amUP250qRblclj333icgpwWpmDvWXA5Mk2VnfwKdHUTG8GshaMvGiIEa7GXZOZ9wVOK5HOTyzrXKCqR3GX4DCiGYMGEC6VQSM2bQ66aXHzbBgZCoRJIX77knEP9RuS5zbnoAu7uT7d0M4GIgxQhi5xL7HO8LnUVjW6ng5We9Dj1W5M/l5FlkX3kgUlBXymbqtKkIKUK1EiUaCgFDg4NMmTqVZCrJsuXLnaLlZb4yocE8hixVLwb07vmNG9l8258cLsUEu6+X/pdepvW/L6fv6aehYEF2CLJZZ5Pls6VAYdsIpfh/n/40WtmsWbPGAawa5pNMJEmlUuw1b08ef/zxgBrUKKpsg8KwadB5y21kWjcgUnF0Lktm9Tu0X3sjm372c+fcwUHIZZzxFlwAzheKyCCYuS3CN+lj53wMwzSxbIvB/oGgNBLZxUA/rccew7obb4xUpTYcfgwtnz3foXoj1G4FuZaO668aKSxkRuWO4RUtQQu/xlewlFWJcKQDtRtkwCPVskh94KNklj4cKj8sXPQCJx7/IQYGB2uU7RU93T00NjZy4QXf4Ctf+2qE4EzRIU25llgpHaogJWQzeOn1sSxIJOm6/XY6b8w5GDqZcFP6ZSCXdTZWNuMCQqGCOpx7zjlk3bJTylZlNdOi24YNG5k4eRJ777UXJRma7QIUAk6G0t04tg3xOIMvvcjAs886Y4+ZiFjMOa+vDzJDgfHmnDkrq4Kti6IKzc3NTJrQgm1bbG7bjF9erBoLYln0ffwfeP2C8yMt2toqMOvKm1F9PT7Qi8pKlDsXZYjtdVygEk4VzO9Cgajwvg7kTFM25rQ9yS59OJI65At5pk2d7r5DXbUD9Pf1MXPWTOLxOP39A7z33nulLhoV6sQyHbtfCUcVsaVVcDaOUg7QZrPupnIxbC5bZJPyrjtGwQWIXJb/vuwybNtmw/r1DPT3DzsPr+fzOWbPnk2uUGDChPEsXbq0GF/u2UW0KmrqlCv35HJFLF/IQ2awOFYPgD1A8GQkO4RVCtm0n/7kJ7GVYiiTYWiwBqogYHDOHF5/5BGGWt8NBzLDZPqlV5Cct6+PUINqXgG1UYpRUIb6LdC+hVlFC81Ku7rlKlonN4V8cr/jQtWsAC++9BJNTWlfTTdcB83aNWuwbYt//dxnw9PGlBgE7SIF8IJe8llHDshkYKDf6f390N/n9IF+GOyDwX4YGnQAI5dzuqdVcu/90b87i6HBIWKGyXvr36t5HhrHmLVh/XpMaXD2350duK8qyja5grPBBwdhYAAGB0rH2u+OfWAAhgYCwJAv+lEpFZ4AtsQHyeCoI48knkgQj8fp3LLFDdyKZPRQUlIQgo4ZM+j8/9t783hLqvpe9LtWVe199pl6Pt0tDTTQIDNKA8qkEceLqHkqoCbiBEhMnhfjkOc1VyPeKwTj06gB83KvIJr4QvAjN9rGIQI3yOTA3AxN0+Pp7tPdZx72ULXW+t0/1lCrag9nn326m0bP+nzqc/apYdWqqt88PvhAM9MUgkWLsfgdV2idTNX3Isgo6IeVNcmISmQD9VQOKRqFarSwOqm4itJZb20oJlnucOe//tCEMLShqBEwOjqGOBGoVKr4+te+1oZ8JVNrkkWImqH+lTJQLmtAKhtgm5k2+8qp2GERIUlSkSOO8ZGrr0YYBJicnNBi0hyrBm7dshVRGGJmpozrrrvOWH/89dY0la9VNfKWyxpB7XrL/loNd4hzayXVUoFmjKFYLOLcV54LIsLuwV0GDNIWBOlfuNpZrFLB5GWX44nPfrY5VVcKx3zn36FGh00kr1d3y1blQ4MWCIcNMngsifLFxFQLf0MjqxN08Fnx5Fc15Q4bn3oKQaDTOduxLjHG8OTjj6Orq4TFixbjT//kI/WsP18xgrzUSAvYVh+olFNAswhSyYtItZRyG/Hk61//OqZnphGEAR555NGOCqUxxjA0tAdBwHDqqafimKOP0rZXH3ltpp1FiGrFW28lFelq1ZQriMSsV87KFYgIH776KtTiGDMzM5gpl+v6L6R/dU43q9YwfMlbsPEL16WEsM7THGHFh/8CvK8vLbmjGuTHWKTw00oPMEIcGI+GVxGjU9GJkhpK65tzB8YYvvfP/4wwDOpr/zfYiBQYAx7+7a8RBAEuvPACvOWSS3QCSh4h8uTYUl0r/8e1rI5QKRvrkQWuWkphpQSUABMSf/i2t2H16tXGnDrc1rqbPcvjjz+OQkE3drn5ppvA4iR1nFnHmxV7ahUPYc1aLRJUq6k+k6SiXOb5G1iR/vQjH0ES6+p+u3ftMuWymqxZ6arbw2etx/5HHsak6ZTaSDxixRKWf/A/g+IkhZWcCG6D/xqKTgeQSxxY956j/B2ITqZ4QGn9WxtyByLC3n37sHNwF4SQfuxf481813K5guc2bYJUCu97//tw8Zvf3Fg59PUHaRxZFmhqtVTZrHmmSGvfT7xzRQKuCGecfhquvOpKcMZQjAr4zW9+UyfKNf3d4P8wCPHEY4+DM4bp6Wn84M4fALWaSb9NPP0ht54kSf0JcawRIIm1NUoZT3kjedxrHfwn11wDzjkKxQI2PbupddyXmWL62OMgVr8EW2wVwCbi0bH/dLf2KXhlc4hUVqpoJjo1aIEwn+J6B97XPR/RSSboOuU1LbnDnf/rTvT0dNd186nbTMkVArBr9y7sHhxEEif4wPvejw9ffXUa2FbXKcRXJGVqchQilbGtTuF0A2+TEutf/nLceP0NENUYAQtx//33IwiCbCkY1eJ3g/+lkti5cyfiWoyAcYhagu/f8X1QHIPbyn7Kcxpa5MisOTFIYJqS573k3jcMggBRFOHPP/YxRIUIhWIRG5/c6LzPTTcQakuXonbWWXj4Lz7VNPaIBQFWXnsdWKkHxHi9PpnnBo1EJ6oXnZjqHCEOXuDHbKKTaiQ6ASouo/e1H26obBERpFL4Xz/8oXkh9ey50W/OGJ59dhOGdu+BlBKvvei1+OZNNyEIwzRkIxNc54c9qCygWc6RQQJd0Q9C4I/e/R78t+u+gHKlDHCGXbt3Ymx0RBcQUE3WqVoc8xxgnDP8/Gc/RaFYQGjKyPzbhn/D8qVLPaC2TrPcmr21un0NuKN968cccww++YlPQgqFYtSFjU886RrENP3kjEOWujFx4QV4+sa/BiVJ09ij6MhjsfjtVxh/TJrzklWaG9Xoai06qUaVAQ+qB/qECztwhDDjb6DG/gZjjwYxBEtWId76MCiuNnz5o2NjOH7d8a6AmF/stuFvk4+9d+9ecA4MDAwgjCJc9aEPYXx8HM8++6zurZz3VLcK3zAbMyVheru78Y1vfAOvfMUrIGUCgGFmZgb33ftLVxjZrSm/zgbHmGn6Adt23pwfBAE2PbsJp55+GogUEpHgij9+L6ZmpvH0xo2uvAyadNxs5j+wXLJYLOJdl1+Oc1/5SlQqZRQKER599FFTZr5F6y1wEGcYftUfYP9Pf4rhX/+6pXh03L88ADljCr4xPyrB+KZyYhdcP58mPghiqUNYEUZu/cac/QyHDhmIfNdc61ANkaC47hzUNt7VVFx68qmNuOD885DEoomvh3J/TaHckRGMjY1h3fHrMD09jfVnrce7LrscY2Nj2Lx5s7Ono5EIRV6tJuhE9b6eHvzZn/0ZvnDddaaahW4qMj01hZ/95KeIwrDFmuqD2CxN2DO0B/19/Tnql5bpef75zTjt9NO1dY0Uxscn8KpXvxpjY6PYNzRkOAlvDr3Gu8vMt+nv68Ob3vgmvPOd70AYRYDhwo88/LBpqEjNaJwuK0kK+1/9GsSDO7H1//9eS1A4+u//FbyrW2fyUQYqssTP41SN91G2SLONl1MSI9+ec5uvCgMwDGDpXJCh782fTrO6OvLasZQiWA+wdQLbOBseovbMf6D6xM+13N5grFq1Cm97y1sghWi/MJVBCgbgdW94A4rFIqSUKBQK6Onuxv0PPoif/fxneOyxxzDRpEDuqlWrcPbZZ+Otb3kLTjrpJIyMjGgEIiAsRNixbTvu/Y//QKFYmPurATA9PYO9+/Zh3XHHNa3WzU0Fu7e//Z3Y+NRG10k0iiIEQYgnnnwSjz/2GHYM7kTcJL94YMUKHH/CCXj5GWdgxcAAJic1pS5EBQwO7sS2bdsQRVHKMVlOUbbVvoXA/te+FlxKPHbd55uGW7AgxNL3XIOl77oGZKsruFI6BiUcp/Bzxj0Y8eCGuX1eVIERBZ+96KQ5CfUARl8YZPBCIhhyD+MhCyt0YeL2z+gX14QyXXDe+TjuuOMaWDgaNXlIqQnjHLVqFSeedBLWn7UecRy7vnLd3d3o6emBEAITExNITGGyUqmERYsWIeABJqcmkcQJwjB0wNLV1YW777oLO3bsSLlLrhp5dm05WYB0uZwdO3egq6sLq1e/pOXzMACVchmLly3FwMAAarUYnDPTplahVOpCFIaIkwRl02KYiKGrq4iuUgkgQrlSgZJS906IAlTLVWzcuBFJEs+aOUeMg0mB/a97PaIowsOf/n+aI0IYIVpzDI7+/34ENTOVJYiZEBkD/Jk01Cb7mUdYzT5tiBHY9LpTXkTIkGezOWpgAYlJgYk7v9Byivdc9i5EUaCrQXcwRJLgjDPPxCmn6heYJIl7wdYiZgtf2ep9NtYpCAIUi0U888zTuP/eXyIqFDruLsoZw+YtW8A5x5IlS7Cov3VxA845Nm/ZAlIKfX19OOXUU9Hd0424FjtxkuDHOqVipo3zAhGiQgHl8gye27QZYyOjiArR7M/AOCAFhl/3OkSFIh677q90hYsmfRfAGI7fsBFqZjKNuM1zgwYEsQ5Z4CGFl1Jr95HhDJte/2JEhtlEJx4g2fIrVB79UUMrgS1NePUHP6SjQjuJbjQlGOM4xtFr1+KkE0/CqtWrTV1UCWkop3aUM/CAo1KpQCS66NnGjRt1Pb8g6NgBxDnHlm1b3UdYc8SalslJPAiwffs2h5SMMcRxjL6+Phy9di1WDKxAGEameojnmGJwtWyr1Sr27duLXYODmJmZQaFNRCajI4xcdBGiqICN/++XURtpnX9wzPfu141XeOClWpuCBsiJQtwXnecoOikFUgKb3nDanJHh4NXq68Rh56xOtiaTDkkunHA+apsfhJoeqfNBkKHat/3Td3HFe96LSq2SlUzytYsbSS5GcY2iAvbs3oNtW7eBiNDb24slS5agt6/XmTLL5QomJybw5FNPIQpDHHHEEbqhCBFUy8rfDSQd85czjp2Dg9YPCUVS+yWUarBeLVru3r0bUioP9whBEKFarWHjkxshhUSx1IXe3l5d28ikr8Zxgkq5jJmZGd1Oy5iXgyCClNQO+wIYw/CrLkLEQzxz002zIsKaG7+rdUGTb07E0sw9pZ+JmKm75VcazBejcxZI1qB4nfHb2gjeDoWUw4MzNHLVsxSKWNSFiX/5dMtLVixbjrddcglqcQygcxe9iaVNKRKZauNGcbW/t2zdgjBIEaKze+oy+pNT2Wpxa486qgmVZpiYnMD4xPisn4zlmqU4YPP3zZGDymIR4+eeiygMsPmWWzG9bVvLS5Zf8xn0X/S2lIh53CCrBLMDIjpZMem5/3T6nDkDx+E6fIcdAIqr6PtPn2h5yf6RYfz8rl+AB0Ea0kBz37SpWpsWpVQQUkFKgpQEISWk1PuXLV0OqQhbt23H+MQEwDik7Wfdxn2kIpQrVYyNj2d8b1FU0PM0uGZichKjY+NQavboV7tmKSmNNMnvazNylhShtmgJxl5xLkLGseW7/9QSEVgQoP+N78Si170dJITr2+A7WW2VFSJk62vBD9DL9hxPw3q8uSjXXZY6Yw2HLzLkY50AsK4+lM6+tOUl23fuxH0PPKD7EZPqKEo0fx1Ruvn7e3p6oJQE5wyj46PYsXOHLvzV7n2kwp69uw1xSysB9HR3Nzx/cnISI6MjhpCpQ7YxKVA+cg2mTjkZEWfYfOstmHxuU3NECCN0nXIWll/9GV3hwuW+q7SyImW9x40jEnLhO16xAocsyOc8KOe9nusIcbgPG6di/o2OOgNy3/OIdz7WNIZp8/ObwTnDK8462yT20EFaGsPqVaswNDQEBm0W3bZjG5YvW4a+vj4dft1U4uDYPri9zqFFxkTrUzfGOMYnJzAxPmGMbIemagQxBh7HmDzjDCSLFyOMImz6h39AZWhPc0SIIkSrj8bqz30TanrSlLZhpgOsL5eYJpiuaSPSZC+jD6SxCTa1OKtANarvS6rzz334I0NedEpidJ19KeT4bsip4aYOuU3PPQeRJDjvleciEeIg4QMhCEIwrouX2TLywyOjmJyawqqVq3QHU68NsP14O3buAMANESPvEQkB070bCATOA+zbvx/lctmYQ1kb/hRqobm38nlQznQqMXze+RpQCkU8/bWvIWlR6pGFEYJFy7Dmy/+i85htI0dmVWDmRZaSfhZmkELZl0MmsqIxsrhIBZb2us4ii/odFZOaiU61Mnpef62uudTCt7Bl2zb84p57nIm0I5GpDVFn1cqVkFJmymkmcYKt27ahPDPjqnwoE807tHevOzefHcYYgyQdpcoADO4aRKVcTqWBzHX5DLP6+RpnoTW63jsuFZJSN0bOvxCUSLAgxJM33ohkarIlIvDeRTjy734EOTHqRSyrbNmgTGjLPEUnaiA6qc4554sPGSxOVKfRd8lnZrVq7Rnag+/f+QMImQCMoCDnlIPcVs41KfT2ZHO0FekKGPtHhjG0d8iUulGYmBhHtVox4eX1W7EQ6QC8JMHW7dsgRNL03AO+MQJLapg5Zi0mTz8VqFUgamU89ZUvaytNs5TQMELQtwhH3fwTqIkxx4UyuS2Ksnqgy0mgbK+PBoo0+a2WqYki7WK3VOdOzxcrMoAxUK2Mvrf9VcrWm4xqtYo7f/hD7Ng5iEq5avKQaY65yC2sNgpYsmQppFJ18YJgDHGcYOu27ZiensHYxETTOhIA0NPTh5GRUezesycb7XoQN189Gz3nlYiXrwQnYPr557H5W99q2ayEhRHCZauw5hsbNEewtWu9LKVMAo5nssvmtqTcoG2rEzWwOlnbQgfjEIZwHxyE0AlBr0PtuftS1ttk7Nqt0xWFFOCMo1iI3Atlvvetg42IUIgilMvl+iQVInDGULFFdE3kKTU4b2Zm2oSDILPfv4a12J/fhwb/M/+eAFgco7J6NSZPOw1IEgTd3dj14w0Yfuih1q8/DBGtWYcjrv8nqKnx1H9g5PrUT+Q0cu89exjon5UL52a5skOgrK8ElIt8NjkgY7f/j7lCUyXEi30wBkqq6H/rZzH1o/8OErWmViYA2LR5M5aNjuGlxx+P4eFh9Pf3o7+3F0EYaiWYsY4zB4vFLvNxGhTIyu2jpi44lg3tb3BNO/ubnZP5TQQKQ4ytPxtUKIBVdLusZ2/+u6addPz33nXaKzDw0RshJ8cAznSWGVLlVutAZNqYAeBGaXZRBsajba2F7VidbLvlplYn6thYcvh6oDtQrFmxB9M//RJUeaIlQtgAtlNOOgW9Pd2I4wSFYgH9fX3oKXWbdkyGW/gigt/jzFK1jJGGQUmJoX17D299izFwIVA+ei1qRxwBVovBu0qYePopDN39i1l7uAFA/5vejSXvuAaqOp02PQFMtcT6GDOWjzmzUcsNAjRZPjIV3rlN50Da5ldKbLns3Dl7oF/8nCGjQ8yg902fRPmXt0IMPdsCb/SH3vjURixevBgnHHscZCIwOjKKYTWMri4T09PVZbpW5qpFZFIlswjJOUcURi7s+3B7RyxJkCxbjpnj14FJBVatgoURtt/xz6ju21f/fA3Gsis/i9LLz4csT2V7+IFrpZYRmMcNQMzoEpQJsbG+GsYoY+Ilm3yUsQ6TmcNwG88cnIl1WuAMecdPEbVn7kHtqX9vAz6082bNEUfgJatfApEkYFwnqCsiFAoFdJdKKJVKCE1HUeU1DW9osWcMu3btMsFphwcS8CRB0teH8rp1UFEBSATC3h6MPf449t137+zcgAeAklj9+W8j6FviAvYckvmJNi2jS3PcgHuU31J3ns1lYH4CDxpwg7qoVYkt7zr/95gz+E+W1FBYdz7CFcdh5n//vUbaJo4YyyUGd+3C3n37cOIJJ+jOodDdNqVIMDmZYHxiHJwxFIpFdBW7UCwWXXokmUR05lmQ+vp62y6WfLCRQPT2YvrEEyG7u8HiGAFnqFWmsf37t0OUy7NzAx4gXDqAVX/1bVB52pShtZHF3DjKXHij3k+pl7gRN9ARp+RaAus5DIFR5CFQGw47q0gz8x1+Z8MxOsYIBd63HH1/+AXM/OJvdfj3LOxfCIEnNm7EksWLcczRax2Q+4aPWrWGaqXqkCiMQhSiAorFIqIwRBiGYGDo7+vH5OTUvOr4dM7sddXrZNEiVE44EbLUBRbH4EJCSYnd//ZvKO8abNsa2Hv+xVjy7o9BTY3p6thKaQ7cPOAAACAASURBVMAlBsaVbRLnrGrZJH/uGhp2LDoRdLV3zC46MdNKa0FMaoIUrKsPtad/gdrGn7elHFrRaWDFChy5Zk3Lpif2O9rwCZtjzXmgOUs7veUOlD4gtDWstnIA1VWrQUEAliRgxQIoSbDv/vsxvXWrEwNbThcEICmx4qN/g8JRJ4BE0lbaZePw7AMgOuUSv5qKTqZ18NY/vvD3VEzKKLa2undauY+mhhEdeQail5yC8gPf0Vyi5XR6vv3Dw9i3fz9WLF+OI1a/RIdKKJXNCcgYRdNYex2qcbAZAAMz8fuirw/Vo1ZBLFpkCp4JhFEBcXkSw/fei/LgTqfDtNMIMVpzPJZ/+AtQM1NQUxMAD0ABB+NcW4xc21wOMr0hmHV+mfdwQEUneCbaVqLTPOomhS8ugM85nfymfD7wK8uWybM96wp53eddgWT3U6g9+TNnipsNKYZHRrB/eBiL+vuxetVqdJe6dPCfpVDNYuRa0aF24u38+fxEJ6HbW4nePsQrliNZvFhzpCRBAALCAFNbtmHsiSeQTE21jwScA0ph8ds+jOKJ65Hs2wUWhKZiiUYEMhvnfqOUwB1jgf6t/QeB9i1k3AGHQnT6ndEZvAQN626Hyu3LIYLtMZ3xrBrPsolXcckhSRVB3wr0vPoq1J7+BcS+55F1FjRHismpKUxMTiIMQ6xYvhzLli5DEAQQifA88jSbV60+DqIRQtgKGKTApAnzKJWQ9PUhWbIEsluX2GRCIIAWLWb2DmHyuU2oDO31rDFtIIERHQtHn4z+N70XVCtDju3VQGsAnpnNAr9y+wPAIgLnUGafzne2xwMgDBxCgStN5ck6kAnM4wa650OOGzRy2CkT5eo77OZRnfuFRwafmrtArDQZxA/MyjdJtPEtDLn6mxZpoLIhDW5OgJIKoqPXI1z5UtSevQcUl9tgTuQU7T1DQ9gzNIRioYjFAyuwaPkKHd5RrQIV3QaWeT3iKKfgpsWwctlZxEBRCIpCiFI3ZE8PZE83ZLFLA4gQ4EGgkbCWYGbXLkw//zyq+/c7fadOfJxl8J5F6PuDd4L3L4UY3QtugN0BP9OcQPEAjDOw3HHGOWA5iEEWyyWI6X55LAhd7zzOQiDkYDxM3w9vwCw7EZ2IXkzJPWml5Qzw55CA8vst4DfIciIPMRohUaP9PkJ1nfIGiOFtSHY+hrl6bOK4hr2Dg9g7OAhEBXQNDKB75Sp0L1uGQqmEgHSFQFRjHflpuwgZKoogAIUBKAhBYQgVhkYe13okZ7r4VkAEUZ5BZf9+lPfsQXXvUBoywTrLa2ZBhNLLX43CkS+FqpahpsYcdScWZLiB4gGI6y5LcKIQB3jouALx9JhGGMMhWAAeBilXCQLdj84gEAsCo5MEmqvYdHJm+cMcRKfDXkzKUPcsgGf2w6+3n7aNJa+ZCCFN7Uspf3auVFdQdTH1qejl/Z9UwUp9KJ58EcS+LZDDW+dkhnAjSVDbvQvVXYMYtVQ3DBH19SHs70fU24uorxe8UASPQvAo0tSNcRAJUKUGJQRkrQZRLkNMTSGZnkYyOQlZraZAbOupzpEDOEAKQnQd9zJER50IissQE/vBWAASzIk9jKUiTyomGQBn3CjT6THigQFqZhAkAAsYiIdAwCGF5gQsCAzShGA8BoLQXcsCDuKhntvnNNREdDLcICM6HbacwQGz1w9ZNUCCDED7CSDZ4wSVi2tXWZFIqVSBangPT7QyOc1ZpKiB9y5DsGgAcnQ35PjgHOVPqjtdSYna+DjifAveNs2ljSVLNfd5iMAKRURrTkS0cg0oiSEnRzSQCwHlKchW1vd1APL2kS8KWZ0gMJyDh6BAANwUdTO/YX4TD3R9KS40R5TSmHE1MrBAAtIcD0KjkIc6vjovOnlZb050OuyQwQFdE2C3AG0pu1I50Ujl5qBc+fkWXMaf2/udvycppV9iXVlzBUoUWKkfUc/pUDMjUFP7QCKel9mX5nFt57ZXU96mZzGigaPAexaDZAw5NeGorhVxGAscIlhA595vDcyGA/BU5IHhCpAayIlrYGZBABVwMBUYa1MAUgEQSCgVAoEEU/o8UiFgrkOoHHLp7ydBXIGT2cdZS6uTUpQL+34hkaEOEfIA3wi4G+gISmWofeNzPaRRntKd5z45xIBqrpNkEEbUwMICgqVHg0QVamYMVJt+UViiWaELQf9SBH3LXKtcVZkyVF9qxdZReg3EzJlJFcA4VKAtP1pEUhqYuQIC5c4jA7SMSygK03NJAioEAtJm00C/W0YhiBMYcdND3ORYBDzV7QK7j0AUgAUmzIKU4RLNRSdmCeILjgytCvi7Zqg2FalBup/fjAKNzaZNuYePCMhzjxbcpiFXynOgRId3dPcDpX5QUgXFM6BkfsXKDjgCREXwUh9Yd7+W34mgkqqm5EYrZUrL+7qMPIGIG79NkE0G4hxAYN6BrjDOiADtyTDXBnpfoPcDEmldRLj/PZXXeAVsRoJ0uTl6v/TOSL3YxBgYkwZ6pKk+yRs77A4v0yq13kftOKeozX0N/BPu1EbG/GxDjOzh+vPJ3+cjLA/Aiv1gRQJkAhIxSMY4uC7nxk4yFhbBiiWwqKQ9w7alFZFRPuHMz7BlO624TWT8MH72m3FcucQcZLPivLbF1sbPnGmY1/WRSE3dDCBuDBws0/4YzOqVDAxSi0K23S1jYMQdQXU9yLlKHXa+1WkeDQ8PLDKY4C3f9Z5uhkL459TBaXo+szTGnZ8rdeLuY6iHV6g2u/nnW4VLfxgwZc7hvtQJmxruVk0qjZeRytxPOcsM4wEYSsZAIEFKAFK4UocHhHtwY5cPQrCgABZFhjr6sT3Gps9S/4CucG5+u33M288ym4sb4k1KxNt3ylkuI40bmp6e5yqh6ngNpEIN04CMXBi8/43cN2euIEAaCqcRxzns/PIxhMNETHIufRs1nQIbvFdExiWfMkiplTTlNcVQ5vUxv5AsS9ksNy/MeDOZMgDKmHHQMOj+OkoDNDdh3FwZSqNMLAt3IhPz/BdkxCcGZUIFjNmWpf4OLY6FrioDA4G4AqMCECGb76tkY2tZxmDEU4B0Js4gLeFO8CpUW6DXgOsA3u5jHlJwH0GCFGEYN34AWx07G14Bpyg32McCgAVurcwhWtDgfxPLBOOFNshG8NYNE/MErrmBl0/NkCIx+emejWKdDjsPtK2ixpkBOMsmNRtjjHmIoswDa0B1AMpNaUOlATlVpnm633fAcQVmTavM81MYxcvpDEj1A9bQoQeAJFiAnK6R6i4s57izBQVYJh7KUi3zTJ4Mx5oU9NLwnkt1hN+phhsmxw215hp/DAA5oLcAaomABXqk51grkj4WOG6RAr09nkUCZh1rjDurD8sjS8AAFppj2u/A3LnMeKODDGJZEy0zjjyNRAYRjTPOimH1YeIs1UnU4RiOwZh+SEeFVSqaEIGxRtalFHDJXAcD2DqZxFN0mXe+9V8w7ZRzFJ574RckvUoR9eEe1unHqD7Uw30A5ApgwXIt8mRamLXBlU9nPgKwrPUzH6bB/VBm52tIRSFiXAt1ToTRiMBZCvj6siyHIBsXFBikCrj+a7iOdaqR+Z3GEfmI4CGEDbOoO5aaXV0/BmOWtYo8+Z7ngBvE4cZ0ap13XoiHlY9shiFjqaLuRG4tMuvknsM1atUiBQKnFPnWm5RqI2P9YXnTJyPnLMvHLhFB26kz4gtlRBKG+japzrudQRAf+FUWyMkrD2MVP6NoMhNbRCYAU38b8nQQSp1CLBWgeKacSrbcutOxvN8clhuY8GmW9ndLuYIRNazYxXkmTgqM62sCfYyQilE8yOkaOTGJ8RSxGnGMOoTw/wY5H0VgHXmBuzaDEJ6VMpsXnZpS82Hi2pmKwxQZMuITMya4wAE7WcCCJ7NTHpgNF0CjY5QiDurNsywH/I2PUxYRzH7HFeAH0nnnWh1IpVUymNUDiDxNiZDtdWqCyrz+D5m+A7BcgBm93U9oSRVdAnOIYOOZrNxtxSjGmaP2DoEs5TfiFLdJOcyLUGXcxCJpmT91zDHnibY6TRq+bUSegNdxC+fBzsQ1pUjAmBWvjMBpxGlnKGlUUiZXRMDVtH3RRa06jmF1acrGFvlyPXwfAJxoxfJBeVDOnEdWtPIjXOHnQpA3t68TWHs6XPogV0YPsS/Z76hDSgOOWZuOfFAp0JNTjVOkYEzTBYJ3kLk+2IwjRRaDBCyXBUbg4H75FCMuMdcjz4gTPNBiFYdDDgamxRIEmsv4uoaT1Q2ieToGTAYfvAA+shwln9dg/uecg4LAHXc6gMuK42l3HqtGsgbdeZQnTTZK7rGiE6kXcQi3LzMzY10A6sObKa29yZrlMXiAXw/oqXKbijwqE0PlKAx8JYyM0m91fVUfKqFMODYjY8onL7SInBWZPIGpLiXSNz44/LDcghtgZi6VhflWJb8vmgNqGJOvuc5EnVp9ghkxSc/N3fnwRCoy34Pl9QT48UssDdTzdA+WEa+YB/xp40jm3idzdsaMHuASfpA2oM+H1OdFJxeu/6JGhmYIAk2tMmpmaq1prBNQRqnNIoq2U7sG2rnjOvmNnMMpTSQBiEmXlOJ0B+d1QiqysZQr+J3uGXKlFK01FdxUksv5RiwnYNA6F6DFFK/ZolO0LXU3ugUz+oQFfOJWt+AuV5mxwJsnSE2aZi5mTLZkRanAN9/a4zodlDtfBfeKffn+UEP5MUs/BvL0AOUZHQzlZ84f4b1nX3R6ceUzHEAkAcu888ad422mm5XjVeqUoVzNVJ/yK4BbzmE+kC4E4Xlxvfzb1FFEnrLsHXMpnbmuitbs6pfWZ9xDAhuSoHUuZhVoz8qU+h6YEWWseGUbzGsLFOPcO5+7/ARNxeEofqo3MG294jmnnJ3XrisDe8qrWNEg7nC2fgzMpb+leoBH+Yn75mlPbXDJPR2HRf6ulorJekcZy/ZwyP6bT9M0nvIMq1XuJXNY1cKLn4ePGH44SHbeuqDS/DLqKj9wZ3hg4Mb3wXINxLnnI0BK9cGNg1pjFXGfavvWJ6Tiaa7RoBPnyG/0aPQk7gGjacSeodoczr/CvIYjbVXGY5Rx0WZEJ5UG6DUWndTcQ9znhQxEL0A9oIOIOBngZJ68b0euIUow2+PnO+U0gH5qtAxynMGVS7RAbvcjW0olBWbkOmNa55z9l2fwlLmSOSzlnpylgGutOsb7zhS35jIN/DZ2iTHrNzUmbpPk74lEZBvce9wAbA6trChnQqUWohM6Ly/ZETKomVHw3uW/QwhxkBCs1QtiLXZaJdBkeWkgMpXrOAGKp/KxAyLLECkVhUilSS/5Yl9Kt9xywXsmHIZYKtaDm9xjxrThgtsoAgPMxDTw+6YBZSU/SgMHkVqHGnGDAyk6kVKQI0OdWf47MYnGW38NBOECzB/sobyEJdurTKX5G1ZUSJt02KoguX65SNtrpW1kYeYgrwFI6lF3LaG81rNkc9dV6huCaS6SJkkhbUdrQyMUvE48yDYuaaeVlW1N5UXEEnn7VVo1hQUhpu/9144K3M39CiIkOx7RgvehDln+fRyuH1qDllDKAyKbx2EAxMnNrgUUpQjkEp2QdsVxRgXlAbOPLClgE3JI4QEj8p581aC7jvKRwkOWubSyUt5+SwiSBGAhZh76eUdNDjurD8k4pn98PVhXnw5TXhiHBikUedyAMs38HKX04vldQ0G/6Z/yAMgvr+NzD8oji9d0HLlG5MjlPOQblCPXtBze/G4OVdfBKPOcNsfCvxf83AsFEgmCviXY89l3t2x6OZtwO+daq878Rwrd57wL4ZrT9QI6bDm6MOYuqrZs9GH3c79ZiB8NC3eMsUaNRTxzrmd9ck4/nlXWtS/DJOUz7uKoWD4XgjETS1VfOzWTN2Fjt2wAYsbKZeawzxEEgFSoPPFLjN52vSudP1dSA2C0c2RwuGSSzruXAGFhAVAPpY5OaT+IhlbaujKWrIkC71nUnKWQNbiRVWpbGQRYC4MB82xtXtl5amDUs+eyxjOSiUOipAo56lUQ7Mz7fCAKD3vNvCvjWDAvLYyDapxrDYLzrCZyIJ1us3TaXBgL4wDQ3IM6+MKbXhgLYwEZFsbCWECGhbEwFpBhYSyMBWRYGAtjARkWxsI4NMgQBMEBWUQYzt3Cy1q0bT0Q8zG/i+UBeA7ODy+6wxqFLMxjjaxV4OYh6grL5gmP8/IzrFq1Cl/84hdx2mmntQ1wd9xxB66//nooW0yMCG9/+9vxwQ9+EAMDA7POoZTCb37zG3z84x9HHMdIkiQzPxHhqquuwqWXXorFixe3/SxnnXWWS+jhphnIV7/6VZx33nmzIj1jDMPDw7jtttvwne98pyHRWL58OW644QacccYZc3rHRITh4WG88Y1vbAhkx/3L3cAc2+uquIape36K4f/51dRryxjCZQNY+/d3mILKba4PgJqZwsRPfoCx22+ta0DPwgi8uwcvue5r6Fl/Llh0gKMUTCRubXAL9n7lOsw8+L87RyZ0GI7x3ve+F7fddhuSJGmb6kkp8eSTT2L9+vVu37333osLLrgAQoi2KbGUEoVCAeeeey5++9vfIkkShwi7d+/GwMBALu59dg63du1a7NixA0SEdcevw3ObnpvTsxERwjDEY489hpe97GWZYxdffDE2bNgwp/nyXCUMQyg/g4sxdK07Ecd896cg2xprLh8+DMG7e/HU+tWgJAbjHEvffRUGPvoZHf05R4jkxS6oagXPXLAubY4ShIiOOhYn3rUR8a4dabGBA4wNOhJXIViyDMP/8BXs/crnO0Gp0Tl/mSAIsGbNGtx2222QUjogbGfLiwuf/vSnceaZZ7rG4e3OwzlHkiR44IEHHGcgImzYsAGLFi1y95rLuiygcc7x3KbnHHLOZQ4pJU495VT84z/+o3vOUqmEDRs2zHk+f95mAERCgkURWBjOeQMAOTmOk+57Po1yFaLD+SKQlCCpcMy3f5zOJwWOv/M+xHsG9byBX7v1QG2mD1wYQU1PYcWHP4nSyWd0JDLNWUySUuK6667D9PQ0oihy+5M2qInMsfMvfvGLqFarEIayKVKQojXL9++plMJnPvMZfOlLX0KhUMDFF1+MWq3m7iOlzFLTJqO7u9uJRpdccgkqlUoGaWd7tsDWBTLj8ssvxx/90R8BAG688cY5z9dofc3kdEoSkEjaFwRYKt+zMATCENGqNRD7hxrJf0ZkatYa2FbT0IDHSyX0nn8Rgv7FUOVp9Kw/X9dIOkC6ZRvsGWJ4CMs/dC12fvwDh0ZneNnLXgYlJaRJSywUi7j33ntnFQE45/je976HIAhQKpVSimyooFQKDz30UEMZnTGGKIpwzjnnOOQhpZxIsmTJkgzCMQBTU1PYuHHjrM8jhMD27dsBAOedex6SOEEYBg7QH330UcRx3FSHOWv9WSgUUiQtFovu9yvOeQWUSpPUoyjCgw8+OCdxaWhoqB6piVDd/BTKj/3aqx00q9KGcPlKRKvWuOp0NDODwtrjkOzbDZerYBN9whCVJx5uAcwMhWOOR9DT56QNOTWJYMkyqEoZhWPWgeI4zcPwZHMrmzTKFKdZfrc8RkBh7bpDp0AzxpAI3QhcCIFf//a3eP3rXz8nq43tWm8Bu7e3F29961uxYcOGltdXazXEcQxuqrhZ4A+CAFLKzHwnHnEExsfH5/RsiUggpHDNPBQRLrzwwpbXHH300XjiiScyfaLtiJM4ow8N7d3b9rtqZ2y/+h1zvubk3+yBqpQ15Ze225FO0yQhQeadhkuXY/s1l7b+nsUiTnpwJ9T0lEZKKdP5pALsfOTKDXp9N7zfTv738sC9kGzyFH13HZhXvJmc6IhEHDpkUEpBSqmBUQj38tpVNJn3kErq9kR2vjAMM8BUR8XjWF9jMpyUp29IITRyEEEIgTAMnZze9vqUgvTk+3bErDAIoZSEMqmLvjiopHK6FQDUqtU5r+mASxMO4FkKqBYAhdAABYASCRaGzRV0xsCKJVAisvOlgKK/lZA5PsDASyWwQhfAA8jRfS3Mr+l7IikRLl1hrFUMcmLUK7xG7hwl5aFDBiGEo3ZCSs0lOhz2WiFEW4AnpEQiJbhSGhm9a4THGYQQHQGcJIKQ0lSEaM8iRSAIkeonPjILKTKcYT7v6oAigzDPKGVa4kkpowhLp1C3I6eT9ObzdD6iLKfxkWTopusxdvu3gCDAkV/5LkqnnIn6HmdZIGdRAc++5gTI8VHwvkV46b8/DTk1keUsUh7aukmOMzDWtpLadC7LGdoEXikElBAgzltyBtkhdchzhrmYe63+k+UMMsMZ5vOuDjgyACAlXcVBpgiUSFAi6gC7lW2eEpFFBmsFI6Xv5YstpoxNvG2z5gZKYedH343jf/Soq/DdiAMFi5dh85tf7sQxNTUBkqpujSQkIDr79h25BqWQkEJASJkCYIeIIIRwc7WDDEJKd18hJZR3jb+/U85gEV3adbVBHR0ieu/EvSuDXG6TL3wBBZIi1RWkSjmDraqhFCBl2+IvSTOPlCChUiqtoPdbA4Kdt1xF4ZiXpgUJOMfz73glgr7FjrK7801BgKH/9ucQw0PacmYchO4ZzPnk/T50yCAFhJCQQuq/HX5gYa4XQkImoq2HSIHUAqzRHwgQib9fzANBvXW1iQz++T4CyQ7mO+hDSEAIQ9GFVwlDAYlIKX0s2ssyEyLVNXwiZKpWUCLSeQ2XGPjIX4IVCqZ4mQbg3f/1I2BRUa/PnKvKZVQ3PoLxH34vI2YdccMtkMP70jntPYQ4xJxBKY0QUkBKAdVBuRgi0tcrPYdQor33bjmDNFTY3Zvceuw5HSEDEaSZR2+ybQLh1uRdI81a3fHDoLSOluOVETO8TjdE3v42OQORnsO/xuc09lhuS/buxtpv35VanpIYU/dswMwDd6frSwR47yLs/PgfZ6qNL/vAxxCtPEJXlsnPbe53SMWklApKSNHZzUWSQCSGaibt6R4iyXIGJdNiWf5+kXQuJvmUXLRBZfKcIfFkZJmbSwnlggBbbYFt6NH2l/Tb2jbZ7DMKA7hC5RRoSvcLBdXmd7U6CAlPhreFvcxc+U3Xr+VYcc1/ycy1+3N/oql9nID3LcG297/ONXhnYYTCmmOx5LJroKpxk7llx8gQdsYZJKQSYJJpitchtdOUXbNiIdtUoJWm+pwpKOKOK5GdTwpjqu1MHCHD9ZhtGt523JW2huXvTSD9jMZ+vnLVSnzqU5/S9YBa+GIGBwdxx/e/j0ql0haRKBy1Dr3nvAas1N3a6bZiNVS1rGV5pvWHtFGL0uKOWT+1KSIqaRVoZBTozHxZy6pTv/vfdDmm/uMnqD79iGs4v+2Dr8exd/wG+/72vyIZGnTnkkhw5N/eATGyL6toe/PSHHSdA4MMhgIzcKc7dMYZBEQi3ZzURtcVyxkU42BMNeQMMKbOzixl9lpbZr19zqBMTVL/3pue3YRjjznGUXkpJC6/7PJZqX4Yhrjhhr/GtR+7FrfffnvL97LqL/8OPWe/GnJybPZGHaSAWKRtDXgEMbRL/2coOSxHaOcdMqbPt36GwPczkD4mVENcIAByahJH/PV38fwfnmYq6EmoShm7//JKlH97b8aAveZvvgc5OaHDP6Rq7IEW6tDrDMpQYaU60xlgZHOlUtm8Pc4gnByulISklDOk8rnlEJ2ISdKtSan2uZ6vY/ic4YYbrkepVNJrdcdsndDmW5LEGBrag89//vM44YQTmgAix8qP3YCu406GHBsxliFqvVnHmBQgkYAVikj2DrpvYq1IJLUy3M539K+pc+Ipkd5PCvNXun2QEmLvbhz1tz9w+gOURPmR+9LHDAIsfvuHEK062r5s73qR/a1EOs+h0xm01SRJOrMmEQNEIpEYnSFJRFr8ttW9E3tvfU3KGYDEWJNEmybRZpwhXdPcdQbhuJMeY+PjuP7669Hd3YNqtYpaLUYct97sHEJITE1O4ZZv3dKUynef+SqjOBqLTiJAcTzrpmo18N7F2HH1G73pyJP/JVSbFFZ512Ts/tZv4ekhlDnX6g8crFDC0nf9acZiZBEhWLoSSy77E6hqxVm66udM/6pDyxkslZOa4nXEGQAhE0dRlWqPkguZ5QxWniZQjjrLjopPKTLP5HGt+XAGALjl1ltx6WWXYvPmzUiSGEqpppsUAlEUZSxQixcvaihWBctWQlarKXAkEiwqauRQ1HRT1QrKj9yPre8+B2J8OKXAKg+sbfoZkuw1LoQ+g1yp+TX97QE2MfS/5QoUjjgmE5pBUmLNl/4ZYmR/g7lEw7lwSBVoj/JqJ1OH1iSPiiZt+hnSUBCtM/gmVOHpDEnSqZ9BX2urSbcVjpHTGRrd+8knN+K9V1zR1ho+8P7348orr3TSRrOQb17oMiKCltdZoYjtV76m/ZDuXG1SZUMrrFdftscVSaaxSZCeb4JUA4W2rgCsJmVCQOwdRLxra3aJQYCRb38ZS97zUR0Bm6eoubkOvQLthRgowx06nUc564+EagtY7b11bJJFIDJhEJYqK9WhNYmU4Qz6ZTM2N2sSmliy5iJK7h8eTgP/gBYiH3meYqb7XgcB0C4y5HQ0pixgC11eWErMxl7teSSlrtztXUMOucSs6+B9izH4n9+SSUO1cU9Td9+J7vV/gOjI4+q7JtZT6kPtgZZpSEbHIQbkeYxNgF0bD6H1Au15Fkn23m6/0FaqTuJCpVLe/BJJnLQFU9J7jk4tWb6vI0mEm7OptY5sLI4JlRZyHnVJjVJvrT9CgmKJ2bOBCZSk1yBRGbk/XV+TTRJYsQdDn32fyZ82vZ0Lxcxd9v7NtWAsBMWi5Xz0QliThOdt7QgZjG9BOE92Ns6oqZhk9BVh/BsyxxnsXEKKjqoyk4lNEsYr3pY+RCrzHJ36OHzRw63BbK2QISMvz6dKr6JMaAWJpC09Lq8PpI1RyCBpCxm/FmPiX29BPLglDQshwpqv/gTRaGZnUgAACRJJREFUqqNcxQ4WBNj92SvAS70t5jOhGPKQB+qlVpuOrEnOZyAdlUebUas+Z1CeSdbO56xJ1BlVtvPLpD0fCuXuLefJGchfg5AtxSSbezwfWTlj/XGhDXpe1sbDZ9egMg3r02P1m4prkJNjmPxxtqLIij/9a8jRvVj56f+hpQUTai4nRzF+x80AC5vPOY8o6s4D9TyrTeceaJHZ2uEM0qP8PmeAiXXy1wV0HrVqOYNo15qkRJYrzQsms5yhGbEhoEGYw3w4kjJmUuVMlLO+QYY686ZbXItwDBISvGcxhq6/Ku0AFIToeeWbEB35UpBiEKP7MXDtVz1OIzF19/cR79gEikXzUA/xAuoMSnYam+TLxe35GUQiM5zBKdB5nUGIjgSGjjgDEURy4HQGUpThDE0LCGhlxSm9kMn8ehkoyjjH2ne6+Y61nNPNWx95c7OwgH1f/r/TOTgHK3Zh0f/1EajqjFbiGQNfMoCeC/8wa2D4+ieAIASJuOHcdEjFJEe15qMzEITy5WLZlnwqPZ0hQzXrdIZOo1Y74Qzps+iQ7WSenEG1xRm0zuApj8l8OYOvDBsqO1t0BzFzjaxTXkkpUFKvQKtajPLD9yAZfC7TeHHgz78JOTEGCPKUYYX+iz+AcNlqT38IMfI/PwsWlhoq0Ic0alVJ7Z20lKsTzkAMkHGS4wxt5DMkwuUxSCEhZcoZ0v0CKuncA+2eK2k3nwFQSXrv+eYskKLsMzabz6ZVZhToeXKGjNNNoK2kV9955kcLkz+fl/MAjsrD92QsVUv++L9oBVghqxQnAmp8FMs/+jVPfxCItz5lxLAXWoGWEolH1Tv1QCcZnaE9a1Li8hWMnuHdW3gcK1EdhnB7cyeqfQ6Tvo/OuZLPGYTMcs3WlhyZignzVNwzYkeboqbNgSYpcuEY3nxCZtbpOwZLp16AwlEnO59Eeq50IdlyfBTL3n9d1kkoDZJJWXdNJ6Njp5sSApIIUqqOqxFIz/Ii27QmKUMptQeapSHcRIZraMVZJp0p0GQ4g+thjPY80EoI4yQjyHkWzbKcwb6OZpyBrJikjD+Az09MYkQ6h8Fy27nkM1gPNPN0BgVPsffiVonQ/+arUXv+MfBCCcWTXqlL17TS0sHBl6zG0g/8d4ihLeB9y6Fmpl3jdOfoU4c6n8GkMupG7p1TQp0ymlazwBxikxhTxgOeXpMIHcujAylFR4xPkvIiS2d3ePrPoiNOgSCYpwIN5cJKrKGhKXv1P76cr+IOz5vcXjiG9TpbMyx5CEmUmmnrRlBAcZ2uuUvVcltkiwHgPYtROO5M88GT+uvmkQPdITKkAKOUQnerhJLZTLSGM9RYjCVLl82qjBNpwLMZYVkFOo1NiuMEy5YtxdTUZHtU0dZBlcohOkBtlbdfOTCAOI5NHBNByvk1UV29arVDaksAmuoMiXBNwIlqOlAvqXUktoJsoJsAgYEJ2brBOBFYsVuvQehrwLJONy3Hi1k4i2h7iVnkFQ0QunOdoaOvVi6X0d/fnyo/Sxbj1ltu1ax9Fhx//PHH8fVvfANCCFMXVRgAF3j35e/CZZde2jg4joCoEGFmZjqtyseYA5TEiCnpfDP4/Oc+h9hU6G71hqNChCuvugpJkhhrVcqlhJD4zre/jVqT8pIgIIxCVCsVh6whT+XhD7z//Tj//PPbF1WMKBGbMBDG0NRUS3HFiEk2GaeGZVd+BUrMARl4gPF//Bzk+L5UgTacRo6PYNlHbmoJnjwsZkQcxmy5UN2wHAfA/zFHCwiU+RaHBBkeefQRvOH1b8jsi+PJWcUcpQj9fX0gIiRJgpGREWNiZgbJ0ho+jUalkm0gUigU8Ktf/QpKKUxMTCDg3AMcwtTUVHvlZ0SE3t5ejI+P46GHHsJrL3ptBgDHxydaPhur8szxWKTi2cCKAZTL5TnV+9fBgamMvX/f/obPoabHAWKGsppMuumJuelKpMC7F0GO79Ph3UJkucEsZmKJWkaWZMUIcmoUIIXqMw+h59XvS9fXKNWN5ch+s0KsrIEKl7/GUKPapl/VReQeNGvShh//GH29vY6y+7kFrbfUYsQYw9/dfDO6ioXUk20iP1tdb+8XxzWUyzN4+JFHdO4xEb516y11OQ2zr0m54l8AsHvPHtRqVVSr1bafzXnFjfh20zdvdkhLpFNT211Hdj6BKCrg+htvaIY1qDxxlxcKIVqGPzTeyDW0J1v0yzdXznq9Z9pNEsz88naNTOZ91jY9qPMarJWogeXH/W50TOZ+i+bXqFoVxEJUn7i7o7i0jpCBc46PfuxaRFEEzgNTtKudTYCbkGgiwjPPPIPbvvtdlEolpwvMtkkpEUURarUaPvGpv8hwirvvuQf33ncfSl0lncvc5rpsFyE7Pv7JT6JSLiOKCnV1j5ptREBPTzd++KMf4fHHH3eUPAhCp8vMZQMYuksl3PzNmzE6OtpUZi/ffwfirY+BRd2NS6e02pSOHUqTaUwedCZGqY05FMCiEuItj6DyyE8yXGf6rlsRP/drsEIvwEOABQdlY1EJqlLG2C3Xdtw2q+POPZxzKKVw8kknYfXq1Q7IW1/D8NQzz2BwcDDTiIMxhrPWr8eiRYtm5fBSSWzfsQPPP/980wK+Pd09OP3009Db09u25/Xf7/pFnTK99uijsXbtWkRhNOtbnJiYxKOPPYokSTJrGlg5gJeddsacfB4MwPDoKB5+5GH3nmd9tz1LEB1xIlihe84gUN34CxM6zdF16kVzpqpUKyMe3AiqtDBWBBGilccetP5ucnIf1NRIR+KREbhGO0YGHyksQLVrtcl/XMZY2x+9nZqljDFwxqFIdbymuT6bXX/+3E7bNjWbr8VDdAgILNODDYzP3T9j79vq3rZaNsPBGbPd/1Agw8JYGL8Do7OebgtjYfyujgVkWBgLw0OG8sJrWBgLAzUO4FEAcuFdLIzf4yEBPMYAXADg3oX3sTB+z8drOIBfAvgRALHwPhbG7+FIAPwMwD2+OfVOAG8zSMGxYGpdGL+7gwAo6Ni8DQAuQQOAPxvAJwCcCaDoXcgO4CLYIZynYVeAedyLDiKRmOt95voO5vMtDuZzvxD3rRld+UYAv7Y7/w99eNBtd+fHzwAAAABJRU5ErkJggg==","res/raw-assets/71/71561142-4c83-4933-afca-cb7a17f67053.png":"iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCMTYyQzlBMjc0NTgxMUU4QjlDN0RGNDUxNzIyMzFDRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCMTYyQzlBMzc0NTgxMUU4QjlDN0RGNDUxNzIyMzFDRiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkIxNjJDOUEwNzQ1ODExRThCOUM3REY0NTE3MjIzMUNGIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkIxNjJDOUExNzQ1ODExRThCOUM3REY0NTE3MjIzMUNGIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Yp1vvAAAAI9JREFUeNrs0LEJw0AMheFncbhzkcznJmWadBnAKe0xso4ho6S96mwJrsgCARX/gx9Ufmh4LcsoafNm76oc+3pv71k67qFcu3RTLYd0a60pyjQzi+7FYVM2XKybJsuI+0Wakg8gQIAAAQIECBAgQIAAAQIECBAgQIB/BdbEvhrAT2LgHsA1jmSfrN20ngIMADZ5JjzjQN3VAAAAAElFTkSuQmCC","res/raw-assets/a8/a8027877-d8d6-4645-97a0-52d4a0123dba.png":"iVBORw0KGgoAAAANSUhEUgAAAAIAAAACAQMAAABIeJ9nAAAAA1BMVEX///+nxBvIAAAACklEQVQI12MAAgAABAABINItbwAAAABJRU5ErkJggg==","res/raw-assets/b4/b43ff3c2-02bb-4874-81f7-f2dea6970f18.png":"iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEN0M0OEU4Mzc0NTgxMUU4ODg1M0NDOTFGQTI5NTI3OSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEN0M0OEU4NDc0NTgxMUU4ODg1M0NDOTFGQTI5NTI3OSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkQ3QzQ4RTgxNzQ1ODExRTg4ODUzQ0M5MUZBMjk1Mjc5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkQ3QzQ4RTgyNzQ1ODExRTg4ODUzQ0M5MUZBMjk1Mjc5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+MFfc+AAAAM9JREFUeNrs2LENwjAQBdA7242rSKlTpaZghrAPG2S1FDR0FNBnhCgdNMTcD0JCLJBD+id92+XTd3fa930Ukc6ys2TxMQ/LzTIkOw7jOB6naeqWZcmquqmslCIhhHtd10Pbtk8A9/M8dzHGnFJyUZ8hM0z2PEGUTJwtsnV73y3iN2FbKwPOG/AzAQdgXnC/niDOh0ACCSSQQAIJJJBAAgkkkEACCSSQQAL/G6jYCbuDvU26NlhV1aCqbpCwwIQnVsDXpmlwny3Fi9EC0+UlwABUZzF+HgAAFAAAAABJRU5ErkJggg==","res/raw-assets/e8/e851e89b-faa2-4484-bea6-5c01dd9f06e2.png":"iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFRUY3RUI1Qzc0NTYxMUU4OTE5NUIwMjBCQUUxQjYzMSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFRUY3RUI1RDc0NTYxMUU4OTE5NUIwMjBCQUUxQjYzMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkVFRjdFQjVBNzQ1NjExRTg5MTk1QjAyMEJBRTFCNjMxIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkVFRjdFQjVCNzQ1NjExRTg5MTk1QjAyMEJBRTFCNjMxIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ajBtbwAAAK9JREFUeNrs0T0KAjEQBeDJsAgpkqDJ8byCdp5COxt7D7iSzQ82YScHsB/hPXhTf7wxpZQDEd2lZ+mJdGSVvqW3Rc5DeiFdOUqv0q/Ztq3lnG3vncYYKnTMTNZa8t73ZeJqrarmm0NNkzHG8lxOa1prxFre+mtJJuUBEEAAAQQQQAABBBBAAAEEEEAAAQQQwD8GSoZi3GDn3Ecr0Hu/ckrpFUKompaclmmKMT53AQYAfik393f8lHEAAAAASUVORK5CYII="};</script><script>!function(s,a,t){for(var e=0;e<t.length;e++)!function e(t){if(!(r=a[t])){var i=s[t];if(!i)return;var n={},r=a[t]={exports:n};i[0](function(t){return e(i[1][t]||t)},r,n)}return r.exports}(t[e])}({1:[function(t,e,i){"use strict";t("../core/platform/CCClass");var n=t("../core/utils/misc");cc.Action=cc.Class({name:"cc.Action",ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){cc.logID(1006)},update:function(t){cc.logID(1007)},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Class({name:"cc.FiniteTimeAction",extends:cc.Action,ctor:function(){this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.logID(1008),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Class({name:"cc.Speed",extends:cc.Action,ctor:function(t,e){this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(cc.errorID(1021),!1)},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Follow=cc.Class({name:"cc.Follow",extends:cc.Action,ctor:function(t,e){this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect,e=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,e),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)return cc.errorID(1022),!1;e=e||cc.rect(0,0,0,0),this._followedNode=t,this._worldRect=e,this._boundarySet=!(0===e.width&&0===e.height),this._boundaryFullyCovered=!1;t=cc.winSize;return this._fullScreenSize=cc.v2(t.width,t.height),this._halfScreenSize=this._fullScreenSize.mul(.5),this._boundarySet&&(this.leftBoundary=-(e.x+e.width-this._fullScreenSize.x),this.rightBoundary=-e.x,this.topBoundary=-e.y,this.bottomBoundary=-(e.y+e.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(t){var e=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),i=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),e=e.sub(i),i=this.target.parent.convertToNodeSpaceAR(e.add(this._halfScreenSize));this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(n.clampf(i.x,this.leftBoundary,this.rightBoundary),n.clampf(i.y,this.bottomBoundary,this.topBoundary)):this.target.setPosition(i.x,i.y)},isDone:function(){return!this._followedNode.activeInHierarchy},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)}},{"../core/platform/CCClass":230,"../core/utils/misc":315}],2:[function(t,e,i){"use strict";function c(t,e){return t[Math.min(t.length-1,Math.max(e,0))]}function s(t){for(var e=[],i=t.length-1;0<=i;i--)e.push(cc.v2(t[i].x,t[i].y));return e}function n(t){for(var e=[],i=0;i<t.length;i++)e.push(cc.v2(t[i].x,t[i].y));return e}cc.CardinalSplineTo=cc.Class({name:"cc.CardinalSplineTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._points=[],this._deltaT=0,this._tension=0,this._previousPosition=null,this._accumulatedDiff=null,void 0!==i&&cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return e&&0!==e.length?!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(e),this._tension=i,!0):(cc.errorID(1024),!1)},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,n(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.v2(this.target.x,this.target.y),this._accumulatedDiff=cc.v2(0,0)},update:function(t){t=this._computeEaseTime(t);var e=this._points;t=1===t?(n=e.length-1,1):(t-(i=this._deltaT)*(n=0|t/i))/i;i=c(e,n-1),o=c(e,+n),a=c(e,n+1),e=c(e,n+2),n=this._tension,h=(n=(1-n)/2)*(2*(s=(t=t)*t)-(r=s*t)-t),l=n*(s-r)+(2*r-3*s+1),t=n*(r-2*s+t)+(-2*r+3*s),n*=r-s,r=i.x*h+o.x*l+a.x*t+e.x*n,s=i.y*h+o.y*l+a.y*t+e.y*n;var i,n,r,s,a,o,l,h=cc.v2(r,s);cc.macro.ENABLE_STACKABLE_ACTIONS&&(o=this.target.x-this._previousPosition.x,l=this.target.y-this._previousPosition.y,0!==o||0!==l)&&(o=(a=this._accumulatedDiff).x+o,l=a.y+l,a.x=o,a.y=l,h.x+=o,h.y+=l),this.updatePosition(h)},reverse:function(){var t=s(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)},cc.CardinalSplineBy=cc.Class({name:"cc.CardinalSplineBy",extends:cc.CardinalSplineTo,ctor:function(t,e,i){this._startPosition=cc.v2(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.x,this._startPosition.y=t.y},reverse:function(){for(var t,e=this._points.slice(),i=e[0],n=1;n<e.length;++n)t=e[n],e[n]=t.sub(i),i=t;var r=s(e),i=r[r.length-1];for(r.pop(),i.x=-i.x,i.y=-i.y,r.unshift(i),n=1;n<r.length;++n)(t=r[n]).x=-t.x,t.y=-t.y,t.x+=i.x,t.y+=i.y,i=r[n]=t;return cc.cardinalSplineBy(this._duration,r,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x,t=t.y+e.y;this._previousPosition.x=i,this._previousPosition.y=t,this.target.setPosition(i,t)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,n(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)},cc.CatmullRomTo=cc.Class({name:"cc.CatmullRomTo",extends:cc.CardinalSplineTo,ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,n(this._points)),t}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)},cc.CatmullRomBy=cc.Class({name:"cc.CatmullRomBy",extends:cc.CardinalSplineBy,ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,n(this._points)),t}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)}},{}],3:[function(t,e,i){"use strict";cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.easeInOut=function(t){return{_rate:t,easing:function(t){return(t*=2)<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};var n={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return r}},r=(cc.easeExponentialIn=function(){return n},{easing:function(t){return 1===t?1:1-Math.pow(2,-10*t)},reverse:function(){return n}}),s=(cc.easeExponentialOut=function(){return r},{easing:function(t){return 1!==t&&0!==t?(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))):t},reverse:function(){return s}}),a=(cc.easeExponentialInOut=function(){return s},{easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return o}}),o=(cc.easeSineIn=function(){return a},{easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return a}}),l=(cc.easeSineOut=function(){return o},{easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return l}}),h=(cc.easeSineInOut=function(){return l},{easing:function(t){return 0===t||1===t?t:(--t,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return c}}),c=(cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(--t,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:h},{easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return h}});function u(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:c},cc.easeElasticInOut=function(t){return{_period:t=t||.3,easing:function(t){var e,i=this._period;return 0===t||1===t?t:(t*=2,e=(i=i||(this._period=.3*1.5))/4,--t<0?-.5*Math.pow(2,10*t)*Math.sin((t-e)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-e)*Math.PI*2/i)*.5+1)},reverse:function(){return cc.easeElasticInOut(this._period)}}};var _={easing:function(t){return 1-u(1-t)},reverse:function(){return d}},d=(cc.easeBounceIn=function(){return _},{easing:u,reverse:function(){return _}}),f=(cc.easeBounceOut=function(){return d},{easing:function(t){return t<.5?.5*(1-u(1-(t*=2))):.5*u(2*t-1)+.5},reverse:function(){return f}}),p=(cc.easeBounceInOut=function(){return f},{easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158)},reverse:function(){return m}}),m=(cc.easeBackIn=function(){return p},{easing:function(t){return--t*t*(2.70158*t+1.70158)+1},reverse:function(){return p}}),y=(cc.easeBackOut=function(){return m},{easing:function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)/2:(t-=2)*t*(3.5949095*t+2.5949095)/2+1},reverse:function(){return y}}),g=(cc.easeBackInOut=function(){return y},cc.easeBezierAction=function(e,i,n,r){return{easing:function(t){return Math.pow(1-t,3)*e+3*t*Math.pow(1-t,2)*i+3*Math.pow(t,2)*(1-t)*n+Math.pow(t,3)*r},reverse:function(){return cc.easeBezierAction(r,n,i,e)}}},{easing:function(t){return Math.pow(t,2)},reverse:function(){return g}}),v=(cc.easeQuadraticActionIn=function(){return g},{easing:function(t){return-t*(t-2)},reverse:function(){return v}}),b=(cc.easeQuadraticActionOut=function(){return v},{easing:function(t){return(t*=2)<1?t*t*.5:-.5*(--t*(t-2)-1)},reverse:function(){return b}}),x=(cc.easeQuadraticActionInOut=function(){return b},{easing:function(t){return t*t*t*t},reverse:function(){return x}}),A=(cc.easeQuarticActionIn=function(){return x},{easing:function(t){return-(--t*t*t*t-1)},reverse:function(){return A}}),C=(cc.easeQuarticActionOut=function(){return A},{easing:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},reverse:function(){return C}}),T=(cc.easeQuarticActionInOut=function(){return C},{easing:function(t){return t*t*t*t*t},reverse:function(){return T}}),S=(cc.easeQuinticActionIn=function(){return T},{easing:function(t){return--t*t*t*t*t+1},reverse:function(){return S}}),w=(cc.easeQuinticActionOut=function(){return S},{easing:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},reverse:function(){return w}}),E=(cc.easeQuinticActionInOut=function(){return w},{easing:function(t){return-1*(Math.sqrt(1-t*t)-1)},reverse:function(){return E}}),M=(cc.easeCircleActionIn=function(){return E},{easing:function(t){return--t,Math.sqrt(1-t*t)},reverse:function(){return M}}),D=(cc.easeCircleActionOut=function(){return M},{easing:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},reverse:function(){return D}}),B=(cc.easeCircleActionInOut=function(){return D},{easing:function(t){return t*t*t},reverse:function(){return B}}),I=(cc.easeCubicActionIn=function(){return B},{easing:function(t){return--t*t*t+1},reverse:function(){return I}}),P=(cc.easeCubicActionOut=function(){return I},{easing:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},reverse:function(){return P}});cc.easeCubicActionInOut=function(){return P}},{}],4:[function(t,e,i){"use strict";cc.ActionInstant=cc.Class({name:"cc.ActionInstant",extends:cc.FiniteTimeAction,isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.Class({name:"cc.Show",extends:cc.ActionInstant,update:function(t){for(var e=this.target.getComponentsInChildren(cc.RenderComponent),i=0;i<e.length;++i)e[i].enabled=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.Class({name:"cc.Hide",extends:cc.ActionInstant,update:function(t){for(var e=this.target.getComponentsInChildren(cc.RenderComponent),i=0;i<e.length;++i)e[i].enabled=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.Class({name:"cc.ToggleVisibility",extends:cc.ActionInstant,update:function(t){for(var e=this.target.getComponentsInChildren(cc.RenderComponent),i=0;i<e.length;++i){var n=e[i];n.enabled=!n.enabled}},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.Class({name:"cc.RemoveSelf",extends:cc.ActionInstant,ctor:function(t){this._isNeedCleanUp=!0,void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.DestroySelf=cc.Class({name:"cc.DestroySelf",extends:cc.ActionInstant,update:function(){this.target.destroy()},reverse:function(){return new cc.DestroySelf},clone:function(){return new cc.DestroySelf}}),cc.destroySelf=function(){return new cc.DestroySelf},cc.FlipX=cc.Class({name:"cc.FlipX",extends:cc.ActionInstant,ctor:function(t){this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipY=cc.Class({name:"cc.FlipY",extends:cc.ActionInstant,ctor:function(t){this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.Place=cc.Class({name:"cc.Place",extends:cc.ActionInstant,ctor:function(t,e){this._x=0,void(this._y=0)!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.CallFunc=cc.Class({name:"cc.CallFunc",extends:cc.ActionInstant,ctor:function(t,e,i){this._selectorTarget=null,this._function=null,this._data=null,this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)}},{}],5:[function(t,e,i){"use strict";function o(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n}cc.ActionInterval=cc.Class({name:"cc.ActionInterval",extends:cc.FiniteTimeAction,ctor:function(t){this.MAX_VALUE=2,this._elapsed=0,this._firstTick=!1,this._easeList=null,this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this._repeatMethod=!1,this._speedMethod=!1,void 0!==t&&cc.ActionInterval.prototype.initWithDuration.call(this,t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.macro.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(e&&0!==e.length)for(var i=0,n=e.length;i<n;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;t=(t=this._elapsed/(1.192092896e-7<this._duration?this._duration:1.192092896e-7))<1?t:1;this.update(0<t?t:0),this._repeatMethod&&1<this._timesForRepeat&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.logID(1010),null},setAmplitudeRate:function(t){cc.logID(1011)},getAmplitudeRate:function(){return cc.logID(1012),0},speed:function(t){return t<=0?cc.logID(1013):(this._speedMethod=!0,this._speed*=t),this},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?cc.logID(1014):(this._repeatMethod=!0,this._timesForRepeat*=t),this},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.Sequence=cc.Class({name:"cc.Sequence",extends:cc.ActionInterval,ctor:function(t){this._actions=[],this._split=null,this._last=0,this._reversed=!1;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(0<=i&&null==e[i]&&cc.logID(1015),0<=i){for(var n,r=e[0],s=1;s<i;s++)e[s]&&(n=r,r=cc.Sequence._actionOneTwo(n,e[s]));this.initWithTwoActions(r,e[i])}}else cc.errorID(1019)},initWithTwoActions:function(t,e){if(!t||!e)return cc.errorID(1025),!1;var i=t._duration,n=e._duration,i=(i*=t._repeatMethod?t._timesForRepeat:1)+(n*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(i),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e,i=0,n=this._split,r=this._actions,s=this._last;(t=this._computeEaseTime(t))<n?(e=0!==n?t/n:1,0===i&&1===s&&this._reversed&&(r[1].update(0),r[1].stop())):(e=(i=1)===n?1:(t-n)/(1-n),-1===s&&(r[0].startWithTarget(this.target),r[0].update(1),r[0].stop()),0===s&&(r[0].update(1),r[0].stop())),t=r[i],s===i&&t.isDone()||(s!==i&&t.startWithTarget(this.target),e*=t._timesForRepeat,t.update(1<e?e%1:e),this._last=i)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1019),null;var i=e.length-1,n=(0<=i&&null==e[i]&&cc.logID(1015),null);if(0<=i)for(var n=e[0],r=1;r<=i;r++)e[r]&&(n=cc.Sequence._actionOneTwo(n,e[r]));return n},cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.Class({name:"cc.Repeat",extends:cc.ActionInterval,ctor:function(t,e){this._times=0,this._total=0,this._nextDt=0,this._actionInstant=!1,this._innerAction=null,void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,(this._innerAction=t)instanceof cc.ActionInstant&&(this._actionInstant=!0,--this._times),!(this._total=0))},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(r<=t){for(;r<t&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=1<r?1:r;1<=t&&this._total<n&&(e.update(1),this._total++),this._actionInstant||(this._total===n?e.stop():e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.RepeatForever=cc.Class({name:"cc.RepeatForever",extends:cc.ActionInterval,ctor:function(t){this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){return t?(this._innerAction=t,!0):(cc.errorID(1026),!1)},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.Spawn=cc.Class({name:"cc.Spawn",extends:cc.ActionInterval,ctor:function(t){this._one=null,this._two=null;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(0<=i&&null==e[i]&&cc.logID(1015),0<=i){for(var n,r=e[0],s=1;s<i;s++)e[s]&&(n=r,r=cc.Spawn._actionOneTwo(n,e[s]));this.initWithTwoActions(r,e[i])}}else cc.errorID(1020)},initWithTwoActions:function(t,e){if(!t||!e)return cc.errorID(1027),!1;var i=!1,n=t._duration,r=e._duration;return this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,r<n?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r)):n<r&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))),i=!0),i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1020),null;0<e.length&&null==e[e.length-1]&&cc.logID(1015);for(var i=e[0],n=1;n<e.length;n++)null!=e[n]&&(i=cc.Spawn._actionOneTwo(i,e[n]));return i},cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.Class({name:"cc.RotateTo",extends:cc.ActionInterval,statics:{_reverse:!1},ctor:function(t,e){this._startAngle=0,this._dstAngle=0,void(this._angle=0)!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngle=e,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngle),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var t=t.angle%360,e=cc.RotateTo._reverse?this._dstAngle-t:this._dstAngle+t;180<e&&(e-=360),e<-180&&(e+=360),this._startAngle=t,this._angle=cc.RotateTo._reverse?e:-e},reverse:function(){cc.logID(1016)},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.angle=this._startAngle+this._angle*t)}}),cc.rotateTo=function(t,e){return new cc.RotateTo(t,e)},cc.RotateBy=cc.Class({name:"cc.RotateBy",extends:cc.ActionInterval,statics:{_reverse:!1},ctor:function(t,e){e*=cc.RotateBy._reverse?1:-1,this._deltaAngle=0,void(this._startAngle=0)!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaAngle=e,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaAngle),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngle=t.angle},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.angle=this._startAngle+this._deltaAngle*t)},reverse:function(){var t=new cc.RotateBy;return t.initWithDuration(this._duration,-this._deltaAngle),this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e){return new cc.RotateBy(t,e)},cc.MoveBy=cc.Class({name:"cc.MoveBy",extends:cc.ActionInterval,ctor:function(t,e,i){this._positionDelta=cc.v2(0,0),this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),void 0!==e&&cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,s;t=this._computeEaseTime(t),this.target&&(e=this._positionDelta.x*t,t=this._positionDelta.y*t,i=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(n=this.target.x,r=this.target.y,s=this._previousPosition,i.x=i.x+n-s.x,i.y=i.y+r-s.y,e+=i.x,t+=i.y,s.x=e,s.y=t,this.target.setPosition(e,t)):this.target.setPosition(i.x+e,i.y+t))},reverse:function(){var t=new cc.MoveBy(this._duration,cc.v2(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveTo=cc.Class({name:"cc.MoveTo",extends:cc.MoveBy,ctor:function(t,e,i){this._endPosition=cc.v2(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.x,this._positionDelta.y=this._endPosition.y-t.y}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.SkewTo=cc.Class({name:"cc.SkewTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._skewX=0,this._skewY=0,this._startSkewX=0,this._startSkewY=0,this._endSkewX=0,this._endSkewY=0,this._deltaX=0,void(this._deltaY=0)!==i&&cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,180<this._deltaX&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,180<this._deltaY&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewBy=cc.Class({name:"cc.SkewBy",extends:cc.SkewTo,ctor:function(t,e,i){void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.JumpBy=cc.Class({name:"cc.JumpBy",extends:cc.ActionInterval,ctor:function(t,e,i,n,r){this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),this._delta=cc.v2(0,0),this._height=0,void(this._jumps=0)!==n&&cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===r&&(r=n,n=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,s;t=this._computeEaseTime(t),this.target&&(e=t*this._jumps%1,e=4*this._height*e*(1-e),e+=this._delta.y*t,t=this._delta.x*t,i=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(n=this.target.x,r=this.target.y,s=this._previousPosition,i.x=i.x+n-s.x,i.y=i.y+r-s.y,t+=i.x,e+=i.y,s.x=t,s.y=e,this.target.setPosition(t,e)):this.target.setPosition(i.x+t,i.y+e))},reverse:function(){var t=new cc.JumpBy(this._duration,cc.v2(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpTo=cc.Class({name:"cc.JumpTo",extends:cc.JumpBy,ctor:function(t,e,i,n,r){this._endPosition=cc.v2(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)&&(void 0===r&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.BezierBy=cc.Class({name:"cc.BezierBy",extends:cc.ActionInterval,ctor:function(t,e){this._config=[],this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),e&&cc.BezierBy.prototype.initWithDuration.call(this,t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0)},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.v2(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,s,a;t=this._computeEaseTime(t),this.target&&(e=(a=this._config)[0].x,i=a[1].x,n=a[2].x,r=a[0].y,s=a[1].y,a=a[2].y,e=o(0,e,i,n,t),i=o(0,r,s,a,t),n=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(r=this.target.x,s=this.target.y,a=this._previousPosition,n.x=n.x+r-a.x,n.y=n.y+s-a.y,e+=n.x,i+=n.y,a.x=e,a.y=i,this.target.setPosition(e,i)):this.target.setPosition(n.x+e,n.y+i))},reverse:function(){var t=this._config,e=t[0].x,i=t[0].y,n=t[1].x,r=t[1].y,s=t[2].x,t=t[2].y,n=[cc.v2(n-s,r-t),cc.v2(e-s,i-t),cc.v2(-s,-t)],r=new cc.BezierBy(this._duration,n);return this._cloneDecoration(r),this._reverseEaseList(r),r}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierTo=cc.Class({name:"cc.BezierTo",extends:cc.BezierBy,ctor:function(t,e){this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var t=this._startPosition,e=this._toConfig,i=this._config;i[0]=e[0].sub(t),i[1]=e[1].sub(t),i[2]=e[2].sub(t)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.ScaleTo=cc.Class({name:"cc.ScaleTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._scaleX=1,this._scaleY=1,this._startScaleX=1,this._startScaleY=1,this._endScaleX=0,this._endScaleY=0,this._deltaX=0,void(this._deltaY=0)!==e&&cc.ScaleTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleBy=cc.Class({name:"cc.ScaleBy",extends:cc.ScaleTo,startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.Blink=cc.Class({name:"cc.Blink",extends:cc.ActionInterval,ctor:function(t,e){this._times=0,this._originalState=!1,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=e,!0)},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){var e;t=this._computeEaseTime(t),this.target&&!this.isDone()&&(e=1/this._times,this.target.opacity=e/2<t%e?255:0)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.FadeTo=cc.Class({name:"cc.FadeTo",extends:cc.ActionInterval,ctor:function(t,e){this._toOpacity=0,void(this._fromOpacity=0)!==e&&cc.FadeTo.prototype.initWithDuration.call(this,t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeIn=cc.Class({name:"cc.FadeIn",extends:cc.FadeTo,ctor:function(t){null==t&&(t=0),this._reverseAction=null,this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeOut=cc.Class({name:"cc.FadeOut",extends:cc.FadeTo,ctor:function(t){null==t&&(t=0),this._reverseAction=null,this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.TintTo=cc.Class({name:"cc.TintTo",extends:cc.ActionInterval,ctor:function(t,e,i,n){this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),e instanceof cc.Color&&(n=e.b,i=e.g,e=e.r),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,n),!0)},clone:function(){var t=new cc.TintTo,e=(this._cloneDecoration(t),this._to);return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&(this.target.color=cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintBy=cc.Class({name:"cc.TintBy",extends:cc.ActionInterval,ctor:function(t,e,i,n){this._deltaR=0,this._deltaG=0,this._deltaB=0,this._fromR=0,this._fromG=0,void(this._fromB=0)!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=n,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);t=t.color;this._fromR=t.r,this._fromG=t.g,this._fromB=t.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.DelayTime=cc.Class({name:"cc.DelayTime",extends:cc.ActionInterval,update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.ReverseTime=cc.Class({name:"cc.ReverseTime",extends:cc.ActionInterval,ctor:function(t){this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){return t?t===this._other?(cc.errorID(1029),!1):!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(cc.errorID(1028),!1)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.TargetedAction=cc.Class({name:"cc.TargetedAction",extends:cc.ActionInterval,ctor:function(t,e){this._action=null,this._forcedTarget=null,e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)}},{}],6:[function(t,e,i){"use strict";t("../core/platform/CCClass");function n(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1}var r=t("../core/platform/js");cc.ActionManager=function(){this._hashTargets=r.createMap(!0),this._arrayTargets=[],this._currentTarget=null,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},cc.ActionManager.prototype={constructor:cc.ActionManager,_elementPool:[],_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},_getElement:function(t,e){var i=this._elementPool.pop();return(i=i||new n).target=t,i.paused=!!e,i},_putElement:function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},addAction:function(t,e,i){var n;t&&e?((n=this._hashTargets[e._id])?n.actions||(n.actions=[]):(n=this._getElement(e,i),this._hashTargets[e._id]=n,this._arrayTargets.push(n)),n.actions.push(t),t.startWithTarget(e)):cc.errorID(1e3)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this._putElement(i)}this._arrayTargets.length=0,this._hashTargets=r.createMap(!0)},removeAllActionsFromTarget:function(t,e){null!=t&&(t=this._hashTargets[t._id])&&(t.actions.length=0,this._deleteHashElement(t))},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e._id];if(i){for(var n=0;n<i.actions.length;n++)if(i.actions[n]===t){i.actions.splice(n,1),i.actionIndex>=n&&i.actionIndex--;break}}else cc.logID(1001)}},_removeActionByTag:function(t,e,i){for(var n=0,r=e.actions.length;n<r;++n){var s=e.actions[n];if(s&&s.getTag()===t&&(!i||s.getOriginalTarget()===i)){this._removeActionAtIndex(n,e);break}}},removeActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1002);var i=this._hashTargets;if(e){var n=i[e._id];n&&this._removeActionByTag(t,n,e)}else for(var r in i){r=i[r];this._removeActionByTag(t,r)}},getActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1004);var i=this._hashTargets[e._id];if(i){if(null!=i.actions)for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}cc.logID(1005,t)}return null},getNumberOfRunningActionsInTarget:function(t){t=this._hashTargets[t._id];return t&&t.actions?t.actions.length:0},pauseTarget:function(t){t=this._hashTargets[t._id];t&&(t.paused=!0)},resumeTarget:function(t){t=this._hashTargets[t._id];t&&(t.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},pauseTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},_deleteHashElement:function(t){var e=!1;if(t&&!t.lock&&this._hashTargets[t.target._id]){delete this._hashTargets[t.target._id];for(var i=this._arrayTargets,n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}this._putElement(t),e=!0}return e},update:function(t){for(var e,i,n=this._arrayTargets,r=0;r<n.length;r++){if(this._currentTarget=n[r],!(e=this._currentTarget).paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)e.currentAction=e.actions[e.actionIndex],e.currentAction&&(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()&&(e.currentAction.stop(),i=e.currentAction,e.currentAction=null,this.removeAction(i)),e.currentAction=null);e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&r--}}}},{"../core/platform/CCClass":230,"../core/platform/js":250}],7:[function(t,e,i){"use strict";t("./CCActionManager"),t("./CCAction"),t("./CCActionInterval"),t("./CCActionInstant"),t("./CCActionEase"),t("./CCActionCatmullRom"),t("./tween")},{"./CCAction":1,"./CCActionCatmullRom":2,"./CCActionEase":3,"./CCActionInstant":4,"./CCActionInterval":5,"./CCActionManager":6,"./tween":8}],8:[function(t,e,i){"use strict";var h=t("../animation/bezier"),n=0,r=cc.Class({name:"cc.TweenAction",extends:cc.ActionInterval,ctor:function(t,e,i){this._opts=i=i||Object.create(null),this._props=Object.create(null),i.progress=i.progress||this.progress,i.easing&&"string"==typeof i.easing&&(n=i.easing,i.easing=cc.easing[n],i.easing||cc.warnID(1031,n));var n,r,s=this._opts.relative;for(r in e){var a,o=e[r],l=void 0,h=void 0;void 0!==o.value&&(o.easing||o.progress)&&("string"==typeof o.easing?(l=cc.easing[o.easing])||cc.warnID(1031,o.easing):l=o.easing,h=o.progress,o=o.value),"number"==typeof o||o.lerp&&(!s||o.add||o.mul)&&o.clone?((a=Object.create(null)).value=o,a.easing=l,a.progress=h,this._props[r]=a):cc.warn("Can not animate "+r+" property, because it do not have [lerp, (add|mul), clone] function.")}this._originProps=e,this.initWithDuration(t)},clone:function(){var t=new r(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e,i=!!this._opts.relative,n=this._props;for(e in n){var r=t[e],s=n[e];"number"==typeof r?(s.start=r,s.current=r,s.end=i?r+s.value:s.value):(s.start=r.clone(),s.current=r.clone(),s.end=i?(r.add||r.mul).call(r,s.value):s.value)}},update:function(t){var e=this._opts,i=t,n=(e.easing&&(i=e.easing(t)),this.target);if(n){var r,s=this._props,a=this._opts.progress;for(r in s){var o=s[r],l=o.easing?o.easing(t):i,o=o.current=(o.progress||a)(o.start,o.end,o.current,l);n[r]=o}}},progress:function(t,e,i,n){return"number"==typeof t?i=t+(e-t)*n:t.lerp(e,n,i),i}}),s=cc.Class({name:"cc.SetAction",extends:cc.ActionInstant,ctor:function(t){this._props={},void 0!==t&&this.init(t)},init:function(t){for(var e in t)this._props[e]=t[e];return!0},update:function(){var t,e=this._props,i=this.target;for(t in e)i[t]=e[t]},clone:function(){var t=new s;return t.init(this._props),t}});function a(t){this._actions=[],this._finalAction=null,this._target=t,this._tag=cc.Action.TAG_INVALID}a.stopAll=function(){cc.director.getActionManager().removeAllActions()},a.stopAllByTag=function(t){cc.director.getActionManager().removeActionByTag(t)},a.stopAllByTarget=function(t){cc.director.getActionManager().removeAllActionsFromTarget(t)},a.prototype.then=function(t){return t instanceof cc.Action?this._actions.push(t.clone()):this._actions.push(t._union()),this},a.prototype.target=function(t){return this._target=t,this},a.prototype.start=function(){var t=this._target;return t?t instanceof cc.Object&&!t.isValid?void 0:(this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this._finalAction=this._union(),void 0===t._id&&(t._id=++n),this._finalAction.setTag(this._tag),cc.director.getActionManager().addAction(this._finalAction,t,!1),this):(cc.warn("Please set target to tween first"),this)},a.prototype.stop=function(){return this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this},a.prototype.tag=function(t){return this._tag=t,this},a.prototype.clone=function(t){var e=this._union();return cc.tween(t).then(e.clone())},a.prototype.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},a.prototype._union=function(){var t=this._actions;return 1===t.length?t[0]:cc.sequence(t)},Object.assign(a.prototype,{bezierTo:function(t,e,i,n,r){var s=e.x,a=e.y,o=i.x,l=i.y;return(r=r||Object.create(null)).progress=function(t,e,i,n){return i.x=(0,h.bezier)(t.x,s,o,e.x,n),i.y=(0,h.bezier)(t.y,a,l,e.y,n),i},this.to(t,{position:n},r)},bezierBy:function(t,e,i,n,r){var s=e.x,a=e.y,o=i.x,l=i.y;return(r=r||Object.create(null)).progress=function(t,e,i,n){var r=t.x,t=t.y;return i.x=(0,h.bezier)(r,s+r,o+r,e.x,n),i.y=(0,h.bezier)(t,a+t,l+t,e.y,n),i},this.by(t,{position:n},r)},flipX:function(){var t=this;return this.call(function(){t._target.scaleX*=-1},this)},flipY:function(){var t=this;return this.call(function(){t._target.scaleY*=-1},this)},blink:function(t,e,i){var r=1/e;return(i=i||Object.create(null)).progress=function(t,e,i,n){return 1<=n?t:r/2<n%r?255:0},this.to(t,{opacity:1},i)}});var o=[];function l(n){return function(){o.length=0;for(var t=arguments.length,e=0;e<t;e++){var i=o[e]=arguments[e];i instanceof a&&(o[e]=i._union())}return n.apply(this,o)}}for(var c={to:function(t,e,i){return(i=i||Object.create(null)).relative=!1,new r(t,e,i)},by:function(t,e,i){return(i=i||Object.create(null)).relative=!0,new r(t,e,i)},set:function(t){return new s(t)},delay:cc.delayTime,call:cc.callFunc,hide:cc.hide,show:cc.show,removeSelf:cc.removeSelf,sequence:l(cc.sequence),parallel:l(cc.spawn)},u={repeat:cc.repeat,repeatForever:function(t){return cc.repeat(t,1e9)},reverseTime:cc.reverseTime},_=Object.keys(c),d=0;d<_.length;d++)!function(t){var e=_[t];a.prototype[e]=function(){var t=c[e].apply(this,arguments);return this._actions.push(t),this}}(d);for(var _=Object.keys(u),f=0;f<_.length;f++)!function(t){var s=_[t];a.prototype[s]=function(){var t=this._actions,e=arguments[arguments.length-1],i=arguments.length-1;e instanceof cc.Tween?e=e._union():e instanceof cc.Action||(e=t[t.length-1],--t.length,i+=1);for(var n=[e],r=0;r<i;r++)n.push(arguments[r]);return e=u[s].apply(this,n),t.push(e),this}}(f);cc.tween=function(t){return new a(t)},cc.Tween=a},{"../animation/bezier":14}],9:[function(t,e,i){"use strict";var n=cc.js,r=t("./playable"),s=t("./animation-curves"),_=s.EventAnimCurve,d=s.EventInfo,f=t("./types").WrapModeMask,p=t("../core/utils/binary-search").binarySearchEpsilon;function a(t,e){r.call(this),this.target=t,this.animation=e,this._anims=new n.array.MutableForwardIterator([])}n.extend(a,r);s=a.prototype;function o(t,e){var i=e.clip,n=(e.duration=i.duration,e.speed=i.speed,e.wrapMode=i.wrapMode,e.frameRate=i.sample,(e.wrapMode&f.Loop)===f.Loop?e.repeatCount=1/0:e.repeatCount=1,e.curves=i.createCurves(e,t)),r=i.events;if(r)for(var s,a=0,o=r.length;a<o;a++){s||((s=new _).target=t,n.push(s));var l=r[a],h=l.frame/e.duration,c=void 0,u=p(s.ratios,h);0<=u?c=s.events[u]:(c=new d,s.ratios.push(h),s.events.push(c)),c.add(l.func,l.params)}}s.playState=function(t,e){t.clip&&(t.curveLoaded||o(this.target,t),t.animator=this,t.play(),"number"==typeof e&&t.setTime(e),this.play())},s.stopStatesExcept=function(t){var e=this._anims,i=e.array;for(e.i=0;e.i<i.length;++e.i){var n=i[e.i];n!==t&&this.stopState(n)}},s.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t),t._setEventTarget(this.animation)},s.removeAnimation=function(t){var e=this._anims.array.indexOf(t);0<=e?(this._anims.fastRemoveAt(e),0===this._anims.array.length&&this.stop()):cc.errorID(3907),t.animator=null},s.sample=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].sample()},s.stopState=function(t){t&&t.stop()},s.pauseState=function(t){t&&t.pause()},s.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},s.setStateTime=function(t,e){if(void 0!==e)t&&(t.setTime(e),t.sample());else{e=t;for(var i=this._anims.array,n=0;n<i.length;++n){var r=i[n];r.setTime(e),r.sample()}}},s.onStop=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].stop()},s.onPause=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.pause(),i.animator=null}},s.onResume=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.animator=this,i.resume()}},s._reloadClip=function(t){o(this.target,t)},e.exports=a},{"../core/utils/binary-search":307,"./animation-curves":11,"./playable":18,"./types":19}],10:[function(t,e,i){"use strict";var n=t("./types").WrapMode,r=t("./animation-curves"),m=r.DynamicAnimCurve,y=r.quickFindIndex,g=t("./motion-path-helper").sampleMotionPaths,v=t("../core/utils/binary-search").binarySearchEpsilon,o=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:cc.Float},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:n.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return cc.errorID(3905),null;var i=new o;i.sample=e||i.sample,i._duration=t.length/i.sample;for(var n=[],r=1/i.sample,s=0,a=t.length;s<a;s++)n[s]={frame:s*r,value:t[s]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:n}}},i}},onLoad:function(){this._duration=Number.parseFloat(this.duration),this.speed=Number.parseFloat(this.speed),this.wrapMode=Number.parseInt(this.wrapMode),this.frameRate=Number.parseFloat(this.sample)},createPropCurve:function(t,e,i){var n=[],r=t instanceof cc.Node&&"position"===e,s=new m;s.target=t,s.prop=e;for(var a=0,o=i.length;a<o;a++){var l=i[a],h=l.frame/this.duration,h=(s.ratios.push(h),r&&n.push(l.motionPath),l.value),h=(s.values.push(h),l.curve);if(h){if("string"==typeof h){s.types.push(h);continue}if(Array.isArray(h)){h[0]===h[1]&&h[2]===h[3]?s.types.push(m.Linear):s.types.push(m.Bezier(h));continue}}s.types.push(m.Linear)}r&&g(n,s,this.duration,this.sample,t);for(var c,u,_=s.ratios,d=!0,f=1,p=_.length;f<p;f++)if(c=_[f]-_[f-1],1===f)u=c;else if(1e-6<Math.abs(c-u)){d=!1;break}s._findFrameIndex=d?y:v;e=s.values[0];return null==e||s._lerp||("number"==typeof e?s._lerp=m.prototype._lerpNumber:e instanceof cc.Quat?s._lerp=m.prototype._lerpQuat:e instanceof cc.Vec2||e instanceof cc.Vec3?s._lerp=m.prototype._lerpVector:e.lerp&&(s._lerp=m.prototype._lerpObject)),s},createTargetCurves:function(t,e,i){var n=e.props,r=e.comps;if(n)for(var s in n){var a=n[s],s=this.createPropCurve(t,s,a);i.push(s)}if(r)for(var o in r){var l=t.getComponent(o);if(l){var h,c=r[o];for(h in c){var u=c[h],u=this.createPropCurve(l,h,u);i.push(u)}}}},createCurves:function(t,e){var i,n=this.curveData,r=n.paths,s=[];for(i in this.createTargetCurves(e,n,s),r){var a,o=cc.find(i,e);o&&(a=r[i],this.createTargetCurves(o,a,s))}return s}});cc.AnimationClip=e.exports=o},{"../core/utils/binary-search":307,"./animation-curves":11,"./motion-path-helper":17,"./types":19}],11:[function(t,e,i){"use strict";var n=t("./bezier").bezierByTime,_=t("../core/utils/binary-search").binarySearchEpsilon,d=t("./types").WrapModeMask,f=t("./types").WrappedInfo;function h(t,e){var i;return"string"==typeof e?(i=cc.easing[e])?t=i(t):cc.errorID(3906,e):Array.isArray(e)&&(t=n(e,t)),t}t=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:void 0});function r(){this.events=[]}var s,a,o=cc.Class({name:"cc.DynamicAnimCurve",extends:t,ctor:function(){this._cachedIndex=0},properties:{target:null,prop:"",values:[],ratios:[],types:[]},_findFrameIndex:_,_lerp:void 0,_lerpNumber:function(t,e,i){return t+(e-t)*i},_lerpObject:function(t,e,i){return t.lerp(e,i)},_lerpQuat:(a=cc.quat(),function(t,e,i){return t.lerp(e,i,a)}),_lerpVector:(s=cc.v3(),function(t,e,i){return t.lerp(e,i,s)}),sample:function(t,e,i){var n,r,s,a=this.values,o=this.ratios,l=o.length;0!==l&&(s=!0,(r=this._cachedIndex)<0&&0<(r=~r)&&r<o.length&&(n=o[r-1],r=o[r],n<e&&e<r&&(s=!1)),s&&(this._cachedIndex=this._findFrameIndex(o,e)),s=(n=this._cachedIndex)<0?(n=~n)<=0?a[0]:l<=n?a[l-1]:(r=a[n-1],this._lerp?(l=(e-(s=o[n-1]))/(o[n]-s),(e=this.types[n-1])&&(l=h(l,e)),o=a[n],this._lerp(r,o,l)):r):a[n],this.target[this.prop]=s)}}),l=(o.Linear=null,o.Bezier=function(t){return t},r.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})},cc.Class({name:"cc.EventAnimCurve",extends:t,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new f}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)==0&&--t,0|t},sample:function(t,e,i){var n=this.ratios.length,r=i.getWrappedInfo(i.time,this._wrappedInfo),s=r.direction,a=_(this.ratios,r.ratio);if(a<0&&(a=~a-1,s<0&&(a+=1)),this._ignoreIndex!==a&&(this._ignoreIndex=NaN),r.frameIndex=a,!this._lastWrappedInfo)return this._fireEvent(a),void(this._lastWrappedInfo=new f(r));var o=i.wrapMode,l=this._wrapIterations(r.iterations),i=this._lastWrappedInfo,h=this._wrapIterations(i.iterations),c=i.frameIndex,i=i.direction,u=-1!==h&&l!==h;if(c===a&&u&&1===n)this._fireEvent(0);else if(c!==a||u){s=i;do{if(c!==a){if(-1===s&&0===c&&0<a?((o&d.PingPong)===d.PingPong?s*=-1:c=n,h++):1===s&&c===n-1&&a<n-1&&((o&d.PingPong)===d.PingPong?s*=-1:c=-1,h++),c===a)break;if(l<h)break}}while(c+=s,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[c]),c!==a&&-1<c&&c<n)}this._lastWrappedInfo.set(r)},_fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t)){var e=this.events[t].events;if(this.target.isValid)for(var i=this.target._components,n=0;n<e.length;n++)for(var r=e[n],s=r.func,a=0;a<i.length;a++){var o=i[a],l=o[s];l&&l.apply(o,r.params)}}},onTimeChangedManually:function(t,e){this._lastWrappedInfo=null,this._ignoreIndex=NaN;e=e.getWrappedInfo(t,this._wrappedInfo),t=e.direction,e=_(this.ratios,e.ratio);e<0&&(e=~e-1,t<0&&(e+=1),this._ignoreIndex=e)}}));e.exports={AnimCurve:t,DynamicAnimCurve:o,EventAnimCurve:l,EventInfo:r,computeRatioByType:h,quickFindIndex:function(t,e){var i=t.length-1;if(0==i)return 0;var n=t[0];if(e<n)return 0;var r=t[i];return r<e?~t.length:(t=(e=(e-n)/(r-n))/(1/i))-(r=0|t)<1e-6?r:1+r-t<1e-6?1+r:~(1+r)}}},{"../core/utils/binary-search":307,"./bezier":14,"./types":19}],12:[function(t,e,i){"use strict";var n=cc.js,r=cc.Class({ctor:function(){this._anims=new n.array.MutableForwardIterator([]),this._delayEvents=[],cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(t){var e=this._anims,i=e.array;for(e.i=0;e.i<i.length;++e.i){var n=i[e.i];n._isPlaying&&!n._isPaused&&n.update(t)}for(var r=this._delayEvents,s=0;s<r.length;s++){var a=r[s];a.target[a.func].apply(a.target,a.args)}r.length=0},destruct:function(){},addAnimation:function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},removeAnimation:function(t){t=this._anims.array.indexOf(t);0<=t?this._anims.fastRemoveAt(t):cc.errorID(3907)},pushDelayEvent:function(t,e,i){this._delayEvents.push({target:t,func:e,args:i})}});cc.AnimationManager=e.exports=r},{}],13:[function(t,e,i){"use strict";var n=cc.js,r=t("./playable"),t=t("./types"),l=t.WrappedInfo,s=t.WrapMode,h=t.WrapModeMask;function a(t,e){r.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new l,this._lastWrappedInfo=null,this._process=o,this._clip=t,this._name=e||t&&t.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=s.Normal,this.time=0,this._target=null,this._lastframeEventOn=!1,this.emit=function(){for(var t=new Array(arguments.length),e=0,i=t.length;e<i;e++)t[e]=arguments[e];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",t)}}n.extend(a,r);t=a.prototype;function o(){var t,e=this.sample();this._lastframeEventOn&&(t=this._lastWrappedInfo||(this._lastWrappedInfo=new l(e)),1<this.repeatCount&&(0|e.iterations)>(0|t.iterations)&&this.emit("lastframe",this),t.set(e)),e.stopped&&(this.stop(),this.emit("finished",this))}function c(){var t=this.time,e=this.duration;e<t?0==(t%=e)&&(t=e):t<0&&0!=(t%=e)&&(t+=e);for(var i=t/e,n=this.curves,r=0,s=n.length;r<s;r++)n[r].sample(t,i,this);this._lastframeEventOn&&(void 0===this._lastIterations&&(this._lastIterations=i),(0<this.time&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit("lastframe",this),this._lastIterations=i)}t._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},t.on=function(t,e,i){return this._target&&this._target.isValid?("lastframe"===t&&(this._lastframeEventOn=!0),this._target.on(t,e,i)):null},t.once=function(t,e,i){var n;return this._target&&this._target.isValid?("lastframe"===t&&(this._lastframeEventOn=!0),(n=this)._target.once(t,function(t){e.call(i,t),n._lastframeEventOn=!1})):null},t.off=function(t,e,i){this._target&&this._target.isValid&&("lastframe"!==t||this._target.hasEventListener(t)||(this._lastframeEventOn=!1),this._target.off(t,e,i))},t._setEventTarget=function(t){this._target=t},t.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this)},t.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this)},t.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this)},t.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this)},t.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;for(var e=this.curves,i=0,n=e.length;i<n;i++){var r=e[i];r.onTimeChangedManually&&r.onTimeChangedManually(t,this)}},t.update=function(t){0<this._delayTime&&(this._delayTime-=t,0<this._delayTime)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},t._needRevers=function(t){var e=this.wrapMode,i=!1;return(e&h.PingPong)===h.PingPong&&(t-(0|t)==0&&0<t&&--t,1&t&&(i=!i)),i=(e&h.Reverse)===h.Reverse?!i:i},t.getWrappedInfo=function(t,e){e=e||new l;var i=!1,n=this.duration,r=this.repeatCount,s=0<t?t/n:-t/n,r=(r<=s&&(i=!0,t=(r=0===(r=(s=r)-(0|r))?1:r)*n*(0<t?1:-1)),n<t?t=0==(r=t%n)?n:r:t<0&&0!=(t%=n)&&(t+=n),!1),a=this._wrapMode&h.ShouldWrap,o=(r=a?this._needRevers(s):r)?-1:1;return this.speed<0&&(o*=-1),e.ratio=(t=a&&r?n-t:t)/n,e.time=t,e.direction=o,e.stopped=i,e.iterations=s,e},t.sample=function(){for(var t=this.getWrappedInfo(this.time,this._wrappedInfo),e=this.curves,i=0,n=e.length;i<n;i++)e[i].sample(t.time,t.ratio,this);return t},n.get(t,"clip",function(){return this._clip}),n.get(t,"name",function(){return this._name}),n.obsolete(t,"AnimationState.length","duration"),n.getset(t,"curveLoaded",function(){return 0<this.curves.length},function(){this.curves.length=0}),n.getset(t,"wrapMode",function(){return this._wrapMode},function(t){this._wrapMode=t,this.time=0,t&h.Loop?this.repeatCount=1/0:this.repeatCount=1}),n.getset(t,"repeatCount",function(){return this._repeatCount},function(t){this._repeatCount=t;var e=this._wrapMode&h.ShouldWrap,i=(this.wrapMode&h.Reverse)===h.Reverse;this._process=t!==1/0||e||i?o:c}),n.getset(t,"delay",function(){return this._delay},function(t){this._delayTime=this._delay=t}),cc.AnimationState=e.exports=a},{"./playable":18,"./types":19}],14:[function(t,e,i){"use strict";var u=Math.cos,_=Math.acos,d=Math.max,f=2*Math.PI,p=Math.sqrt;function m(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}e.exports={bezier:function(t,e,i,n,r){var s=1-r;return s*(s*(t+(3*e-t)*r)+3*i*r*r)+n*r*r*r},bezierByTime:function(t,e){a=+(e=e),c=e-(i=t)[0],o=3*a,l=3*c,i=3*(e-i[2]),i=1/3*(c=(o-6*c+i)*(e=1/(l-a-i+(e-1)))),h=1/3*(o=1/3*(3*(l=(l-o)*e)-c*c));var i,n,r,s,a,o,l,h,c=(a=(l=(c=(2*c*c*c-9*c*l+a*e*27)/27)/2)*l+h*h*h)<0?(h=p((e=1/3*-o)*e*e),e=_((o=-c/(2*h))<-1?-1:1<o?1:o),r=(c=2*m(h))*u(e*(1/3))-i,s=c*u((e+f)*(1/3))-i,o=c*u((e+2*f)*(1/3))-i,0<=r&&r<=1?0<=s&&s<=1?0<=o&&o<=1?d(r,s,o):d(r,s):0<=o&&o<=1?d(r,o):r:0<=s&&s<=1?0<=o&&o<=1?d(s,o):s:o):0==a?(s=-(n=l<0?m(-l):-m(l))-i,0<=(r=2*n-i)&&r<=1?0<=s&&s<=1?d(r,s):r:s):(h=p(a),(n=m(-l+h))-m(l+h)-i),e=t[1];return((1-c)*(e+(t[3]-e)*c)*3+c*c)*c}}},{}],15:[function(t,e,i){"use strict";var n={constant:function(){return 0},linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4))},elasticOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)*.5:.5*((t-=2)*t*((1+e)*t+e)+2)},bounceIn:function(t){return 1-n.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*n.bounceIn(2*t):.5*n.bounceOut(2*t-1)+.5},smooth:function(t){return t<=0?0:1<=t?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:1<=t?1:t*t*t*(t*(6*t-15)+10)}};function r(e,i){return function(t){return t<.5?i(2*t)/2:e(2*t-1)/2+.5}}n.quadOutIn=r(n.quadIn,n.quadOut),n.cubicOutIn=r(n.cubicIn,n.cubicOut),n.quartOutIn=r(n.quartIn,n.quartOut),n.quintOutIn=r(n.quintIn,n.quintOut),n.sineOutIn=r(n.sineIn,n.sineOut),n.expoOutIn=r(n.expoIn,n.expoOut),n.circOutIn=r(n.circIn,n.circOut),n.backOutIn=r(n.backIn,n.backOut),n.bounceIn=function(t){return 1-n.bounceOut(1-t)},n.bounceInOut=function(t){return t<.5?.5*n.bounceIn(2*t):.5*n.bounceOut(2*t-1)+.5},n.bounceOutIn=r(n.bounceIn,n.bounceOut),cc.easing=e.exports=n},{}],16:[function(t,e,i){"use strict";t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":9,"./animation-clip":10,"./animation-curves":11,"./animation-manager":12,"./animation-state":13,"./bezier":14,"./easing":15,"./motion-path-helper":17,"./types":19}],17:[function(t,e,i){"use strict";var z=t("./animation-curves").DynamicAnimCurve,G=t("./animation-curves").computeRatioByType,n=t("./bezier").bezier,U=t("../core/utils/binary-search").binarySearchEpsilon,j=cc.v2;function W(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function s(){this.start=j(),this.end=j(),this.startCtrlPoint=j(),this.endCtrlPoint=j()}W.prototype.computeBeziers=function(){var t;this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var e=1;e<this.points.length;e++){var i=this.points[e-1],n=this.points[e];(t=new s).start=i.pos,t.startCtrlPoint=i.out,t.end=n.pos,t.endCtrlPoint=n.in,this.beziers.push(t),this.length+=t.getLength()}for(var r=0,e=0;e<this.beziers.length;e++)t=this.beziers[e],this.ratios[e]=t.getLength()/this.length,this.progresses[e]=r+=this.ratios[e];return this.beziers},s.prototype.getPointAt=function(t){t=this.getUtoTmapping(t);return this.getPoint(t)},s.prototype.getPoint=function(t){var e=n(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),t=n(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new j(e,t)},s.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},s.prototype.getLengths=function(t){if(t=t||this.__arcLengthDivisions||200,this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,n=[],r=this.getPoint(0),s=j(),a=0;for(n.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),s.x=r.x-e.x,s.y=r.y-e.y,a+=s.mag(),n.push(a),r=e;return this.cacheArcLengths=n},s.prototype.getUtoTmapping=function(t,e){for(var i,n=this.getLengths(),r=0,s=n.length,a=e||t*n[s-1],o=0,l=s-1;o<=l;)if((i=n[r=Math.floor(o+(l-o)/2)]-a)<0)o=r+1;else{if(!(0<i)){l=r;break}l=r-1}if(n[r=l]===a)return r/(s-1);e=n[r];return(r+(a-e)/(n[r+1]-e))/(s-1)},e.exports={sampleMotionPaths:function(t,e,i,n,r){function s(t){return t instanceof cc.Vec2?{in:t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{in:j(t[2],t[3]),pos:j(t[0],t[1]),out:j(t[4],t[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}var a=e.values=e.values.map(function(t){return t=Array.isArray(t)?2===t.length?cc.v2(t[0],t[1]):cc.v3(t[0],t[1],t[2]):t});if(0!==t.length&&0!==a.length){for(var o=!1,l=0;l<t.length;l++){var h=t[l];if(h&&!function(t){if(Array.isArray(t)){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)||6!==n.length)return}return 1}}(h)&&(cc.errorID(3904,r?r.name:"","position",l),h=null),h&&0<h.length){o=!0;break}}if(o&&1!==a.length){for(var c=e.types,u=e.ratios,F=e.values=[],V=e.types=[],_=e.ratios=[],d=0,f=z.Linear,p=0,N=t.length;p<N-1;p++){var m=t[p],y=u[p],g=u[p+1]-y,v=a[p],b=a[p+1],x=c[p],A=[],C=d/g,T=1/(g*i*n);if(m&&0<m.length){var S=[];S.push(s(v));for(var w=0,E=m.length;w<E;w++){var k=s(m[w]);S.push(k)}S.push(s(b));var M=new W(S);M.computeBeziers();for(var D,B,I,P,R,O=M.progresses;1e-6<1-C;)R=(P=G(P=C,x))<0?(I=(0-P)*(D=M.beziers[0]).getLength(),B=D.start.sub(D.endCtrlPoint).normalize(),D.start.add(B.mul(I))):1<P?(I=(P-1)*(D=M.beziers[M.beziers.length-1]).getLength(),B=D.end.sub(D.startCtrlPoint).normalize(),D.end.add(B.mul(I))):(P=(P-=0<(R=(R=U(O,P))<0?~R:R)?O[R-1]:0)/M.ratios[R],M.beziers[R].getPointAt(P)),A.push(R),C+=T}else for(;1e-6<1-C;)P=G(P=C,x),A.push(v.lerp(b,P)),C+=T;for(f="constant"===x?x:z.Linear,w=0,E=A.length;w<E;w++)L(A[w],f,y+d+T*w*g);d=1e-6<Math.abs(C-1)?(C-1)*g:0}u[u.length-1]!==_[_.length-1]&&L(a[a.length-1],f,u[u.length-1])}}function L(t,e,i){F.push(t),V.push(e),_.push(i)}},Curve:W,Bezier:s}},{"../core/utils/binary-search":307,"./animation-curves":11,"./bezier":14}],18:[function(t,e,i){"use strict";var n=cc.js,r=t("../core/CCDebug");function s(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}function a(){}t=s.prototype;n.get(t,"isPlaying",function(){return this._isPlaying},!0),n.get(t,"isPaused",function(){return this._isPaused},!0);t.onPlay=a,t.onPause=a,t.onResume=a,t.onStop=a,t.onError=a,t.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(r.getError(3912)):(this._isPlaying=!0,this.onPlay())},t.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},t.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},t.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},t.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=s},{"../core/CCDebug":69}],19:[function(t,e,i){"use strict";var n={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},r=cc.Enum({Default:0,Normal:1,Reverse:n.Reverse,Loop:n.Loop,LoopReverse:n.Loop|n.Reverse,PingPong:n.PingPong,PingPongReverse:n.PingPong|n.Reverse});function s(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}cc.WrapMode=r,s.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},e.exports={WrapModeMask:n,WrapMode:r,WrappedInfo:s}},{}],20:[function(t,e,i){"use strict";function n(t){s.call(this),this._shouldRecycleOnEnded=!1,this._src=t,this._element=null,this.id=0,this._volume=1,this._loop=!1,this._nextTime=0,this._state=n.State.INITIALZING,this._onended=function(){this._state=n.State.STOPPED,this.emit("ended")}.bind(this)}var r,s=t("../core/event/event-target"),a=t("../core/platform/CCSys"),o=t("../core/assets/CCAudioClip").LoadMode,l=!1,h=[],c=(cc.js.extend(n,s),n.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2,STOPPED:3},(t=n.prototype)._bindEnded=function(t){t=t||this._onended;var e=this._element;this._src&&e instanceof HTMLAudioElement?e.addEventListener("ended",t):e.onended=t},t._unbindEnded=function(){var t=this._element;t instanceof HTMLAudioElement?t.removeEventListener("ended",this._onended):t&&(t.onended=null)},t._onLoaded=function(){this._createElement(),this.setVolume(this._volume),this.setLoop(this._loop),0!==this._nextTime&&this.setCurrentTime(this._nextTime),this.getState(!1)===n.State.PLAYING?this.play():this._state=n.State.INITIALZING},t._createElement=function(){var t=this._src._nativeAsset;t instanceof HTMLAudioElement?(this._element||(this._element=document.createElement("audio")),this._element.src=t.src):this._element=new c(t,this)},t.play=function(){this._state=n.State.PLAYING,this._element&&(this._bindEnded(),this._element.play(),this._touchToPlay())},t._touchToPlay=function(){var t;this._src&&this._src.loadMode===o.DOM_AUDIO&&this._element.paused&&h.push({instance:this,offset:0,audio:this._element}),l||(l=!0,t="ontouchend"in window?"touchend":"mousedown",cc.game.canvas.addEventListener(t,function(){for(var t;t=h.pop();)t.audio.play(t.offset)}))},t.destroy=function(){this._element=null},t.pause=function(){this._element&&this.getState()===n.State.PLAYING&&(this._unbindEnded(),this._element.pause(),this._state=n.State.PAUSED)},t.resume=function(){this._element&&this.getState()===n.State.PAUSED&&(this._bindEnded(),this._element.play(),this._state=n.State.PLAYING)},t.stop=function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(t){}for(var t=0;t<h.length;t++)if(h[t].instance===this){h.splice(t,1);break}this._unbindEnded(),this.emit("stop"),this._state=n.State.STOPPED}},t.setLoop=function(t){this._loop=t,this._element&&(this._element.loop=t)},t.getLoop=function(){return this._loop},t.setVolume=function(t){this._volume=t,this._element&&(this._element.volume=t)},t.getVolume=function(){return this._volume},t.setCurrentTime=function(e){if(this._element){this._nextTime=0,this._unbindEnded(),this._bindEnded(function(){this._bindEnded()}.bind(this));try{this._element.currentTime=e}catch(t){var i=this._element;i.addEventListener&&i.addEventListener("loadedmetadata",function t(){i.removeEventListener("loadedmetadata",t),i.currentTime=e})}}else this._nextTime=e},t.getCurrentTime=function(){return this._element?this._element.currentTime:0},t.getDuration=function(){return this._element?this._element.duration:0},t.getState=function(t){return(t=void 0===t?!0:t)&&this._forceUpdatingState(),this._state},t._forceUpdatingState=function(){var t=this._element;t&&(n.State.PLAYING===this._state&&t.paused?this._state=n.State.STOPPED:n.State.STOPPED!==this._state||t.paused||(this._state=n.State.PLAYING))},Object.defineProperty(t,"src",{get:function(){return this._src},set:function(i){var t;return this._unbindEnded(),i?(this._src=i).loaded?this._onLoaded():(t=this,i.once("load",function(){i===t._src&&t._onLoaded()}),cc.loader.load({url:i.nativeUrl,skips:["Loader"]},function(t,e){t?cc.error(t):i.loaded||(i._nativeAsset=e)})):(this._src=null,this._element instanceof c?this._element=null:this._element&&(this._element.src=""),this._state=n.State.INITIALZING),i},enumerable:!0,configurable:!0}),Object.defineProperty(t,"paused",{get:function(){return!this._element||this._element.paused},enumerable:!0,configurable:!0}),r=cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE||cc.sys.browserType===cc.sys.BROWSER_TYPE_BAIDU||cc.sys.browserType===cc.sys.BROWSER_TYPE_UC?.01:0,function(t,e){this._audio=e,this._context=a.__audioSupport.context,this._buffer=t,this._gainObj=this._context.createGain(),this.volume=1,this._gainObj.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currentTimer=null,this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)});(t=c.prototype).play=function(t){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var e=this._context.createBufferSource();e.buffer=this._buffer,e.connect(this._gainObj),e.loop=this._loop,this._startTime=this._context.currentTime,(t=t||this.playedLength)&&(this._startTime-=t);var i,n=this._buffer.duration,r=t;this._loop?e.start?e.start(0,r):e.notoGrainOn?e.noteGrainOn(0,r):e.noteOn(0,r):(n=n-t,e.start?e.start(0,r,n):e.noteGrainOn?e.noteGrainOn(0,r,n):e.noteOn(0,r,n)),(this._currentSource=e).onended=this._endCallback,e.context.state&&"suspended"!==e.context.state||0!==this._context.currentTime||(i=this,clearTimeout(this._currentTimer),this._currentTimer=setTimeout(function(){0===i._context.currentTime&&h.push({instance:i._audio,offset:t,audio:i})},10)),cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&"interrupted"===e.context.state&&e.context.resume()},t.pause=function(){var t;clearTimeout(this._currentTimer),this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration,t=this._currentSource,this._currentSource=null,this._startTime=-1,t&&t.stop(0))},Object.defineProperty(t,"paused",{get:function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"loop",{get:function(){return this._loop},set:function(t){return this._currentSource&&(this._currentSource.loop=t),this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"volume",{get:function(){return this._volume},set:function(e){if(this._volume=e,this._gainObj.gain.setTargetAtTime)try{this._gainObj.gain.setTargetAtTime(e,this._context.currentTime,r)}catch(t){this._gainObj.gain.setTargetAtTime(e,this._context.currentTime,.01)}else this._gainObj.gain.value=e;a.os===a.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play())},enumerable:!0,configurable:!0}),Object.defineProperty(t,"currentTime",{get:function(){return this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration),this.playedLength},set:function(t){return this.paused?this.playedLength=t:(this.pause(),this.playedLength=t,this.play()),t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"duration",{get:function(){return this._buffer.duration},enumerable:!0,configurable:!0}),e.exports=cc.Audio=n},{"../core/assets/CCAudioClip":77,"../core/event/event-target":156,"../core/platform/CCSys":239}],21:[function(t,e,i){"use strict";function s(t){function e(){var t;r(this.id)&&(delete c[this.id],t=n.indexOf(this.id),cc.js.array.fastRemoveAt(n,t)),(t=this)._shouldRecycleOnEnded&&(t._finishCallback=null,t.off("ended"),t.off("stop"),t.src=null,_.includes(t)||(_.length<32?_.push(t):t.destroy()),t._shouldRecycleOnEnded=!1)}var i=h++,n=(n=u[t])||(u[t]=[]);return d._maxAudioInstance<=n.length&&(t=n.shift(),r(t).stop()),(t=_.pop()||new o).on("ended",function(){this._finishCallback&&this._finishCallback(),e.call(this)},t),t.on("stop",e,t),t.id=i,c[i]=t,n.push(i),t}function r(t){return c[t]}function a(t){return void 0===t?t=1:"string"==typeof t&&(t=Number.parseFloat(t)),t}var o=t("./CCAudio"),l=t("../core/assets/CCAudioClip"),n=cc.js,h=0,c=n.createMap(!0),u={},_=[],d={AudioState:o.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:c,play:function(t,e,i){var n,r=t;if("string"==typeof t)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),n=s(r=t),l._loadByUrl(r,function(t,e){e&&(n.src=e)});else{if(!t)return;r=t.nativeUrl,(n=s(r)).src=t}return n._shouldRecycleOnEnded=!0,n.setLoop(e||!1),i=a(i),n.setVolume(i),n.play(),n.id},setLoop:function(t,e){t=r(t);t&&t.setLoop&&t.setLoop(e)},isLoop:function(t){t=r(t);return!(!t||!t.getLoop)&&t.getLoop()},setVolume:function(t,e){t=r(t);t&&t.setVolume(e)},getVolume:function(t){t=r(t);return t?t.getVolume():1},setCurrentTime:function(t,e){t=r(t);return!!t&&(t.setCurrentTime(e),!0)},getCurrentTime:function(t){t=r(t);return t?t.getCurrentTime():0},getDuration:function(t){t=r(t);return t?t.getDuration():0},getState:function(t){t=r(t);return t?t.getState():this.AudioState.ERROR},setFinishCallback:function(t,e){t=r(t);t&&(t._finishCallback=e)},pause:function(t){t=r(t);return!!t&&(t.pause(),!0)},_pauseIDCache:[],pauseAll:function(){for(var t in c){var e=c[t];e.getState()===o.State.PLAYING&&(this._pauseIDCache.push(t),e.pause())}},resume:function(t){t=r(t);t&&t.resume()},resumeAll:function(){for(var t=0;t<this._pauseIDCache.length;++t){var e=this._pauseIDCache[t],e=r(e);e&&e.resume()}this._pauseIDCache.length=0},stop:function(t){t=r(t);return!!t&&(t.stop(),!0)},stopAll:function(){for(var t in c){t=c[t];t&&t.stop()}},setMaxAudioInstance:function(t){this._maxAudioInstance=t},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(t){var e=t;if("string"==typeof t)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),e=t;else{if(!t)return;e=t.nativeUrl}var i=u[e];if(i)for(;0<i.length;){var n=i.pop(),r=c[n];r&&(r.stop(),delete c[n])}},uncacheAll:function(){var t,e;for(e in this.stopAll(),c)(t=c[e])&&t.destroy();for(;t=_.pop();)t.destroy();c=n.createMap(!0),u={}},getProfile:function(t){},preload:function(t,e){cc.loader.load(t,e&&function(t){t||e()})},setMaxWebAudioSize:function(t){this._maxWebAudioSize=1024*t},_breakCache:null,_break:function(){for(var t in this._breakCache=[],c){var e=c[t];e.getState()===o.State.PLAYING&&(this._breakCache.push(t),e.pause())}},_restore:function(){if(this._breakCache){for(;0<this._breakCache.length;){var t=this._breakCache.pop(),t=r(t);t&&t.resume&&t.resume()}this._breakCache=null}},_music:{id:-1,loop:!1,volume:1},_effect:{volume:1,pauseCache:[]},playMusic:function(t,e){var i=this._music;return this.stop(i.id),i.id=this.play(t,e,i.volume),i.loop=e,i.id},stopMusic:function(){this.stop(this._music.id)},pauseMusic:function(){return this.pause(this._music.id),this._music.id},resumeMusic:function(){return this.resume(this._music.id),this._music.id},getMusicVolume:function(){return this._music.volume},setMusicVolume:function(t){t=a(t);var e=this._music;return e.volume=t,this.setVolume(e.id,e.volume),e.volume},isMusicPlaying:function(){return this.getState(this._music.id)===this.AudioState.PLAYING},playEffect:function(t,e){return this.play(t,e||!1,this._effect.volume)},setEffectsVolume:function(t){t=a(t);var e,i=this._music.id;for(e in this._effect.volume=t,c){var n=c[e];n&&n.id!==i&&d.setVolume(e,t)}},getEffectsVolume:function(){return this._effect.volume},pauseEffect:function(t){return this.pause(t)},pauseAllEffects:function(){var t,e=this._music.id,i=this._effect;for(t in i.pauseCache.length=0,c){var n=c[t];n&&n.id!==e&&n.getState()===this.AudioState.PLAYING&&(i.pauseCache.push(t),n.pause())}},resumeEffect:function(t){this.resume(t)},resumeAllEffects:function(){for(var t=this._effect.pauseCache,e=0;e<t.length;++e){var i=t[e],i=c[i];i&&i.resume()}},stopEffect:function(t){return this.stop(t)},stopAllEffects:function(){var t,e=this._music.id;for(t in c){var i=c[t];i&&i.id!==e&&i.getState()===d.AudioState.PLAYING&&i.stop()}}};e.exports=cc.audioEngine=d},{"../core/assets/CCAudioClip":77,"./CCAudio":20}],22:[function(t,e,i){"use strict";var n={name:"Jacob__Codec"};n.Base64=t("./base64"),n.GZip=t("./gzip"),n.unzip=function(){return n.GZip.gunzip.apply(n.GZip,arguments)},n.unzipBase64=function(){var e=n.Base64.decode.apply(n.Base64,arguments);try{return n.GZip.gunzip.call(n.GZip,e)}catch(t){return e.slice(7)}},n.unzipBase64AsArray=function(t,e){e=e||1;for(var i,n=this.unzipBase64(t),r=[],s=0,a=n.length/e;s<a;s++)for(r[s]=0,i=e-1;0<=i;--i)r[s]+=n.charCodeAt(s*e+i)<<8*i;return r},n.unzipAsArray=function(t,e){e=e||1;for(var i,n=this.unzip(t),r=[],s=0,a=n.length/e;s<a;s++)for(r[s]=0,i=e-1;0<=i;--i)r[s]+=n.charCodeAt(s*e+i)<<8*i;return r},cc.codec=e.exports=n},{"./base64":23,"./gzip":24}],23:[function(t,e,i){"use strict";var l=t("../core/utils/misc").BASE64_VALUES;e.exports={name:"Jacob__Codec__Base64",decode:function(t){var e,i,n,r,s,a=[],o=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");o<t.length;)e=l[t.charCodeAt(o++)]<<2|(r=l[t.charCodeAt(o++)])>>4,i=(15&r)<<4|(r=l[t.charCodeAt(o++)])>>2,n=(3&r)<<6|(s=l[t.charCodeAt(o++)]),a.push(String.fromCharCode(e)),64!==r&&a.push(String.fromCharCode(i)),64!==s&&a.push(String.fromCharCode(n));return a.join("")},decodeAsArray:function(t,e){for(var i,n=this.decode(t),r=[],s=0,a=n.length/e;s<a;s++)for(r[s]=0,i=e-1;0<=i;--i)r[s]+=n.charCodeAt(s*e+i)<<8*i;return r}}},{"../core/utils/misc":315}],24:[function(t,e,i){"use strict";function p(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(p.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0}p.gunzip=function(t){return t.constructor!==Array&&(t.constructor,String),new p(t).gunzip()[0][0]},p.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},p.LITERALS=288,p.NAMEMAX=256,p.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],p.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],p.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],p.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],p.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],p.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},p.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},p.prototype.byteAlign=function(){this.bb=1},p.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},p.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return e=t?p.bitReverse[e]>>8-t:e},p.prototype.flushBuffer=function(){this.bIdx=0},p.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},p.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},p.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,0<=(t=this.IsPat()))e.b0=t;else if(e.b0=32768,this.Rec())return-1;if(0<=(t=this.IsPat()))e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},p.prototype.CreateTree=function(t,e,i,n){var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},p.prototype.DecodeValue=function(t){for(var e,i,n=0,r=t[n];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,e=t.length,i=0;i<e;i++)if(t[i]===r){n=i;break}}else{if(!(32768&r.b0))return r.b0;r=t[++n]}return-1},p.prototype.DeflateLoop=function(){var t;do{var e,i=this.readBit();if(0===(t=this.readBits(2)))for(this.byteAlign(),e=this.readByte(),e|=this.readByte()<<8,l=this.readByte(),65535&(e^~(l|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");e--;)n=this.readByte(),this.addBuffer(n);else if(1===t)for(;;)if(23<(c=p.bitReverse[this.readBits(7)]>>1)?199<(c=c<<1|this.readBit())?c=(c-=128)<<1|this.readBit():143<(c-=48)&&(c+=136):c+=256,c<256)this.addBuffer(c);else{if(256===c)break;for(c-=257,u=this.readBits(p.cplext[c])+p.cplens[c],c=p.bitReverse[this.readBits(5)]>>3,8<p.cpdext[c]?(_=this.readBits(8),_|=this.readBits(p.cpdext[c]-8)<<8):_=this.readBits(p.cpdext[c]),_+=p.cpdist[c],c=0;c<u;c++){var n=this.buf32k[this.bIdx-_&32767];this.addBuffer(n)}}else if(2===t){for(var r,s,a=new Array(320),o=257+this.readBits(5),l=1+this.readBits(5),h=4+this.readBits(4),c=0;c<19;c++)a[c]=0;for(c=0;c<h;c++)a[p.border[c]]=this.readBits(3);for(u=this.distanceTree.length,f=0;f<u;f++)this.distanceTree[f]=new p.HufNode;if(this.CreateTree(this.distanceTree,19,a,0))return this.flushBuffer(),1;for(r=o+l,f=0;f<r;)if((c=this.DecodeValue(this.distanceTree))<16)a[f++]=c;else if(16===c){if(f+(c=3+this.readBits(2))>r)return this.flushBuffer(),1;for(s=f?a[f-1]:0;c--;)a[f++]=s}else{if(f+(c=17===c?3+this.readBits(3):11+this.readBits(7))>r)return this.flushBuffer(),1;for(;c--;)a[f++]=0}for(u=this.literalTree.length,f=0;f<u;f++)this.literalTree[f]=new p.HufNode;if(this.CreateTree(this.literalTree,o,a,0))return this.flushBuffer(),1;for(u=this.literalTree.length,f=0;f<u;f++)this.distanceTree[f]=new p.HufNode;for(var u,_,d=new Array,f=o;f<a.length;f++)d[f-o]=a[f];if(this.CreateTree(this.distanceTree,l,d,0))return this.flushBuffer(),1;for(;;)if(256<=(c=this.DecodeValue(this.literalTree))){if(0==(c-=256))break;for(c--,u=this.readBits(p.cplext[c])+p.cplens[c],c=this.DecodeValue(this.distanceTree),8<p.cpdext[c]?(_=this.readBits(8),_|=this.readBits(p.cpdext[c]-8)<<8):_=this.readBits(p.cpdext[c]),_+=p.cpdist[c];u--;)n=this.buf32k[this.bIdx-_&32767],this.addBuffer(n)}else this.addBuffer(c)}}while(!i);return this.flushBuffer(),this.byteAlign(),0},p.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},p.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var t=this.readByte(),e=(t|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),i=(e|=this.readByte()<<8,this.readByte());for(i|=this.readByte()<<8,r=0,this.nameBuf=[];e--;){var n=this.readByte();"/"===n|":"===n?r=0:r<p.NAMEMAX-1&&(this.nameBuf[r++]=String.fromCharCode(n))}this.fileout||(this.fileout=this.nameBuf);for(var r=0;r<i;)n=this.readByte(),r++;8==t&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},p.prototype.skipdir=function(){var t,e,i=[];if(8&this.gpflags&&(i[0]=this.readByte(),i[1]=this.readByte(),i[2]=this.readByte(),i[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),i[0]=this.readByte(),8!==i[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(i[0]=this.readByte(),i[2]=this.readByte(),this.len=i[0]+256*i[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)(t="7"!==e&&":"!==e?t:0)<p.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()},e.exports=p},{}],25:[function(t,e,i){"use strict";!function(){function Q(t){throw t}var $=void 0,tt=!0,E=this;function t(t,e){var i,n=t.split("."),r=E;n[0]in r||!r.execScript||r.execScript("var "+n[0]);for(;n.length&&(i=n.shift());)n.length||e===$?r=r[i]||(r[i]={}):r[i]=e}var et="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function M(t){if("string"==typeof t){for(var e=t.split(""),i=0,n=e.length;i<n;i++)e[i]=(255&e[i].charCodeAt(0))>>>0;t=e}for(var r,s=1,a=0,o=t.length,l=0;0<o;){for(o-=r=1024<o?1024:o;a+=s+=t[l++],--r;);s%=65521,a%=65521}return(a<<16|s)>>>0}function it(t,e){this.index="number"==typeof e?e:0,this.i=0,this.buffer=t instanceof(et?Uint8Array:Array)?t:new(et?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&Q(Error("invalid index")),this.buffer.length<=this.index&&this.f()}it.prototype.f=function(){var t,e=this.buffer,i=e.length,n=new(et?Uint8Array:Array)(i<<1);if(et)n.set(e);else for(t=0;t<i;++t)n[t]=e[t];return this.buffer=n},it.prototype.d=function(t,e,i){var n,r=this.buffer,s=this.index,a=this.i,o=r[s];if(i&&1<e&&(t=8<e?(l[255&t]<<24|l[t>>>8&255]<<16|l[t>>>16&255]<<8|l[t>>>24&255])>>32-e:l[t]>>8-e),e+a<8)o=o<<e|t,a+=e;else for(n=0;n<e;++n)o=o<<1|t>>e-n-1&1,8==++a&&(a=0,r[s++]=l[o],o=0,s===r.length&&(r=this.f()));r[s]=o,this.buffer=r,this.i=a,this.index=s},it.prototype.finish=function(){var t=this.buffer,e=this.index;return 0<this.i&&(t[e]<<=8-this.i,t[e]=l[t[e]],e++),et?t.subarray(0,e):(t.length=e,t)};for(var D=new(et?Uint8Array:Array)(256),e=0;e<256;++e){for(var i=n=e,B=7,n=n>>>1;n;n>>>=1)i=i<<1|1&n,--B;D[e]=(i<<B&255)>>>0}var l=D;function T(t){this.buffer=new(et?Uint16Array:Array)(2*t),this.length=0}function g(t){for(var e,i,n,r,s,a,o,l,h=t.length,c=0,u=Number.POSITIVE_INFINITY,_=0;_<h;++_)t[_]>c&&(c=t[_]),t[_]<u&&(u=t[_]);for(e=1<<c,i=new(et?Uint32Array:Array)(e),n=1,r=0,s=2;n<=c;){for(_=0;_<h;++_)if(t[_]===n){for(o=r,l=a=0;l<n;++l)a=a<<1|1&o,o>>=1;for(l=a;l<e;l+=s)i[l]=n<<16|_;++r}++n,r<<=1,s<<=1}return[i,c,u]}function I(t,e){this.h=nt,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=et&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(et?Uint8Array:Array)(32768))}et&&new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),T.prototype.getParent=function(t){return 2*((t-2)/4|0)},T.prototype.push=function(t,e){var i,n,r=this.buffer,s=this.length;for(r[this.length++]=e,r[this.length++]=t;0<s&&(i=this.getParent(s),r[s]>r[i]);)n=r[s],r[s]=r[i],r[i]=n,n=r[s+1],r[s+1]=r[i+1],r[i+1]=n,s=i;return this.length},T.prototype.pop=function(){var t,e,i,n=this.buffer,r=n[0],s=n[1];for(this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1],i=0;!((e=2*i+2)>=this.length)&&(e+2<this.length&&n[e+2]>n[e]&&(e+=2),n[e]>n[i]);)t=n[i],n[i]=n[e],n[e]=t,t=n[i+1],n[i+1]=n[e+1],n[e+1]=t,i=e;return{index:s,value:r,length:this.length}};for(var nt=2,r={NONE:0,r:1,j:nt,N:3},rt=[],s=0;s<288;s++)switch(tt){case s<=143:rt.push([s+48,8]);break;case s<=255:rt.push([s-144+400,9]);break;case s<=279:rt.push([s-256,7]);break;case s<=287:rt.push([s-280+192,8]);break;default:Q("invalid literal: "+s)}function P(t,e){this.length=t,this.G=e}I.prototype.n=function(){var t,e,F,i=this.input;switch(this.h){case 0:for(e=0,F=i.length;e<F;){var V,N,n=r=et?i.subarray(e,e+65535):i.slice(e,e+65535),r=(e+=r.length)===F,s=$,a=this.a,o=this.b;if(et){for(a=new Uint8Array(this.a.buffer);a.length<=o+n.length+5;)a=new Uint8Array(a.length<<1);a.set(this.a)}if(a[o++]=0|(r?1:0),V=65536+~(r=n.length)&65535,a[o++]=255&r,a[o++]=r>>>8&255,a[o++]=255&V,a[o++]=V>>>8&255,et)a.set(n,o),o+=n.length,a=a.subarray(0,o);else{for(s=0,N=n.length;s<N;++s)a[o++]=n[s];a.length=o}this.b=o,this.a=a}break;case 1:var l=new it(new Uint8Array(this.a.buffer),this.b);l.d(1,1,tt),l.d(1,2,tt);for(var h,c=ot(this,i),u=0,k=c.length;u<k;u++)if(h=c[u],it.prototype.d.apply(l,rt[h]),256<h)l.d(c[++u],c[++u],tt),l.d(c[++u],5),l.d(c[++u],c[++u],tt);else if(256===h)break;this.a=l.finish(),this.b=this.a.length;break;case nt:var _,d,f,p,m,y,g,z,v,b,x,G,A=new it(new Uint8Array(this.a),this.b),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=Array(19),C=nt;for(A.d(1,1,tt),A.d(C,2,tt),_=ot(this,i),C=at(m=st(this.L,15)),O=at(y=st(this.K,7)),d=286;257<d&&0===m[d-1];d--);for(f=30;1<f&&0===y[f-1];f--);for(var T,S,w,E,M,W=d,H=f,D=new(et?Uint32Array:Array)(W+H),B=new(et?Uint32Array:Array)(316),I=new(et?Uint8Array:Array)(19),P=T=0;P<W;P++)D[T++]=m[P];for(P=0;P<H;P++)D[T++]=y[P];if(!et)for(P=0,w=I.length;P<w;++P)I[P]=0;for(P=E=0,w=D.length;P<w;P+=T){for(T=1;P+T<w&&D[P+T]===D[P];++T);if(S=T,0===D[P])if(S<3)for(;0<S--;)I[B[E++]=0]++;else for(;0<S;)(M=(M=S<138?S:138)>S-3&&M<S?S-3:M)<=10?(B[E++]=17,B[E++]=M-3,I[17]++):(B[E++]=18,B[E++]=M-11,I[18]++),S-=M;else if(B[E++]=D[P],I[D[P]]++,--S<3)for(;0<S--;)B[E++]=D[P],I[D[P]]++;else for(;0<S;)(M=S<6?S:6)>S-3&&M<S&&(M=S-3),B[E++]=16,B[E++]=M-3,I[16]++,S-=M}for(t=et?B.subarray(0,E):B.slice(0,E),g=st(I,7),x=0;x<19;x++)j[x]=g[U[x]];for(p=19;4<p&&0===j[p-1];p--);for(z=at(g),A.d(d-257,5,tt),A.d(f-1,5,tt),A.d(p-4,4,tt),x=0;x<p;x++)A.d(j[x],3,tt);for(x=0,G=t.length;x<G;x++)if(v=t[x],A.d(z[v],g[v],tt),16<=v){switch(x++,v){case 16:b=2;break;case 17:b=3;break;case 18:b=7;break;default:Q("invalid code: "+v)}A.d(t[x],b,tt)}for(var R,X,C=[C,m],O=[O,y],Y=C[0],q=C[1],J=O[0],Z=O[1],L=0,K=_.length;L<K;++L)if(R=_[L],A.d(Y[R],q[R],tt),256<R)A.d(_[++L],_[++L],tt),X=_[++L],A.d(J[X],Z[X],tt),A.d(_[++L],_[++L],tt);else if(256===R)break;this.a=A.finish(),this.b=this.a.length;break;default:Q("invalid compression type")}return this.a};for(var a,o=[],h=3;h<=258;h++)a=function(){var t=h;switch(tt){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:Q("invalid length: "+t)}}(),o[h]=a[2]<<24|a[1]<<16|a[0];var R=et?new Uint32Array(o):o;function ot(t,e){function i(t,e){var i,n,r,s=t.G,a=[],o=0,l=R[t.length];switch(a[o++]=65535&l,a[o++]=l>>16&255,a[o++]=l>>24,tt){case 1===s:i=[0,s-1,0];break;case 2===s:i=[1,s-2,0];break;case 3===s:i=[2,s-3,0];break;case 4===s:i=[3,s-4,0];break;case s<=6:i=[4,s-5,1];break;case s<=8:i=[5,s-7,1];break;case s<=12:i=[6,s-9,2];break;case s<=16:i=[7,s-13,2];break;case s<=24:i=[8,s-17,3];break;case s<=32:i=[9,s-25,3];break;case s<=48:i=[10,s-33,4];break;case s<=64:i=[11,s-49,4];break;case s<=96:i=[12,s-65,5];break;case s<=128:i=[13,s-97,5];break;case s<=192:i=[14,s-129,6];break;case s<=256:i=[15,s-193,6];break;case s<=384:i=[16,s-257,7];break;case s<=512:i=[17,s-385,7];break;case s<=768:i=[18,s-513,8];break;case s<=1024:i=[19,s-769,8];break;case s<=1536:i=[20,s-1025,9];break;case s<=2048:i=[21,s-1537,9];break;case s<=3072:i=[22,s-2049,10];break;case s<=4096:i=[23,s-3073,10];break;case s<=6144:i=[24,s-4097,11];break;case s<=8192:i=[25,s-6145,11];break;case s<=12288:i=[26,s-8193,12];break;case s<=16384:i=[27,s-12289,12];break;case s<=24576:i=[28,s-16385,13];break;case s<=32768:i=[29,s-24577,13];break;default:Q("invalid distance")}for(l=i,a[o++]=l[0],a[+o]=l[1],a[5]=l[2],n=0,r=a.length;n<r;++n)d[f++]=a[n];m[a[0]]++,y[a[3]]++,p=t.length+e-1,c=null}var n,r,s,a,o,l,h,c,u,_={},d=et?new Uint16Array(2*e.length):[],f=0,p=0,m=new(et?Uint32Array:Array)(286),y=new(et?Uint32Array:Array)(30),g=t.w;if(!et){for(s=0;s<=285;)m[s++]=0;for(s=0;s<=29;)y[s++]=0}for(m[256]=1,n=0,r=e.length;n<r;++n){for(s=o=0,a=3;s<a&&n+s!==r;++s)o=o<<8|e[n+s];if(_[o]===$&&(_[o]=[]),l=_[o],!(0<p--)){for(;0<l.length&&32768<n-l[0];)l.shift();if(r<=n+3){for(c&&i(c,-1),s=0,a=r-n;s<a;++s)u=e[n+s],d[f++]=u,++m[u];break}if(0<l.length){var v,b=$,x=0,A=$,C=$,T=$,S=e.length,w=(C=0,l.length);t:for(;C<w;C++){if(v=l[w-C-1],(A=3)<x){for(T=x;3<T;T--)if(e[v+T-1]!==e[n+T-1])continue t;A=x}for(;A<258&&n+A<S&&e[v+A]===e[n+A];)++A;if(x<A&&(b=v,x=A),258===A)break}h=new P(x,n-b),c?c.length<h.length?(u=e[n-1],d[f++]=u,++m[u],i(h,0)):i(c,-1):h.length<g?c=h:i(h,0)}else c?i(c,-1):(u=e[n],d[f++]=u,++m[u])}l.push(n)}return d[f++]=256,m[256]++,t.L=m,t.K=y,et?d.subarray(0,f):d}function st(t,e){var i,n,r,s,a,o=t.length,l=new T(572),h=new(et?Uint8Array:Array)(o);if(!et)for(s=0;s<o;s++)h[s]=0;for(s=0;s<o;++s)0<t[s]&&l.push(s,t[s]);if(i=Array(l.length/2),n=new(et?Uint32Array:Array)(l.length/2),1===i.length)return h[l.pop().index]=1,h;for(s=0,a=l.length/2;s<a;++s)i[s]=l.pop(),n[s]=i[s].value;var c,u,_,d,f,p=n.length,m=new(et?Uint16Array:Array)(e),y=new(et?Uint8Array:Array)(e),g=new(et?Uint8Array:Array)(p),v=Array(e),b=Array(e),x=Array(e),A=(1<<e)-p,C=1<<e-1;for(m[e-1]=p,u=0;u<e;++u)A<C?y[u]=0:(y[u]=1,A-=C),A<<=1,m[e-2-u]=(m[e-1-u]/2|0)+p;for(m[0]=y[0],v[0]=Array(m[0]),b[0]=Array(m[0]),u=1;u<e;++u)m[u]>2*m[u-1]+y[u]&&(m[u]=2*m[u-1]+y[u]),v[u]=Array(m[u]),b[u]=Array(m[u]);for(c=0;c<p;++c)g[c]=e;for(_=0;_<m[e-1];++_)v[e-1][_]=n[_],b[e-1][_]=_;for(c=0;c<e;++c)x[c]=0;for(1===y[e-1]&&(--g[0],++x[e-1]),u=e-2;0<=u;--u){for(c=0,f=x[u+1],_=0;_<m[u];_++)(d=v[u+1][f]+v[u+1][f+1])>n[c]?(v[u][_]=d,b[u][_]=p,f+=2):(v[u][_]=n[c],b[u][_]=c,++c);x[u]=0,1===y[u]&&function t(e){var i=b[e][x[e]];i===p?(t(e+1),t(e+1)):--g[i],++x[e]}(u)}for(r=g,s=0,a=i.length;s<a;++s)h[i[s].index]=r[s];return h}function at(t){for(var e,i,n=new(et?Uint16Array:Array)(t.length),r=[],s=[],a=0,o=0,l=t.length;o<l;o++)r[t[o]]=1+(0|r[t[o]]);for(o=1,l=16;o<=l;o++)s[o]=a,(a+=0|r[o])>1<<o&&Q("overcommitted"),a<<=1;for(a<65536&&Q("undercommitted"),o=0,l=t.length;o<l;o++)for(a=s[t[o]],s[t[o]]+=1,e=n[o]=0,i=t[o];e<i;e++)n[o]=n[o]<<1|1&a,a>>>=1;return n}function c(t,e){this.input=t,this.a=new(et?Uint8Array:Array)(32768),this.h=u.j;var i,n={};for(i in(e?"number"!=typeof e.compressionType:e={})||(this.h=e.compressionType),e)n[i]=e[i];n.outputBuffer=this.a,this.z=new I(this.input,n)}var u=r;function _(t,e){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=et?new Uint8Array(t):t,this.s=!1,this.m=b,this.B=!1,e?(e.index&&(this.c=e.index),e.bufferSize&&(this.l=e.bufferSize),e.bufferType&&(this.m=e.bufferType),e.resize&&(this.B=e.resize)):e={},this.m){case v:this.b=32768,this.a=new(et?Uint8Array:Array)(32768+this.l+258);break;case b:this.b=0,this.a=new(et?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:Q(Error("invalid inflate mode"))}}c.prototype.n=function(){var t,e,i,n=0,r=this.a;if((t=w)===w?i=Math.LOG2E*Math.log(32768)-8:Q(Error("invalid compression method")),r[n++]=i=i<<4|t,t===w)switch(this.h){case u.NONE:e=0;break;case u.r:e=1;break;case u.j:e=2;break;default:Q(Error("unsupported compression type"))}else Q(Error("invalid compression method"));return r[n++]=(t=e<<6|0)|31-(256*i+t)%31,i=M(this.input),this.z.b=n,n=(r=this.z.n()).length,et&&((r=new Uint8Array(r.buffer)).length<=n+4&&(this.a=new Uint8Array(r.length+4),this.a.set(r),r=this.a),r=r.subarray(0,n+4)),r[n++]=i>>24&255,r[n++]=i>>16&255,r[n++]=i>>8&255,r[n++]=255&i,r},t("Zlib.Deflate",c),t("Zlib.Deflate.compress",function(t,e){return new c(t,e).n()}),t("Zlib.Deflate.CompressionType",u),t("Zlib.Deflate.CompressionType.NONE",u.NONE),t("Zlib.Deflate.CompressionType.FIXED",u.r),t("Zlib.Deflate.CompressionType.DYNAMIC",u.j);var v=0,b=1,r={D:v,C:b};_.prototype.p=function(){for(;!this.s;){var t=A(this,3);switch(1&t&&(this.s=tt),t>>>=1){case 0:var e=this.input,i=this.c,n=this.a,r=this.b,s=$,a=n.length,o=$;switch(this.e=this.g=0,(l=e[i++])===$&&Q(Error("invalid uncompressed block header: LEN (first byte)")),s=l,(l=e[i++])===$&&Q(Error("invalid uncompressed block header: LEN (second byte)")),s|=l<<8,(l=e[i++])===$&&Q(Error("invalid uncompressed block header: NLEN (first byte)")),h=l,(l=e[i++])===$&&Q(Error("invalid uncompressed block header: NLEN (second byte)")),s===~(h|=l<<8)&&Q(Error("invalid uncompressed block header: length verify")),i+s>e.length&&Q(Error("input buffer is broken")),this.m){case v:for(;r+s>n.length;){if(s-=o=a-r,et)n.set(e.subarray(i,i+o),r),r+=o,i+=o;else for(;o--;)n[r++]=e[i++];this.b=r,n=this.f(),r=this.b}break;case b:for(;r+s>n.length;)n=this.f({v:2});break;default:Q(Error("invalid inflate mode"))}if(et)n.set(e.subarray(i,i+s),r),r+=s,i+=s;else for(;s--;)n[r++]=e[i++];this.c=i,this.b=r,this.a=n;break;case 1:this.o(N,G);break;case 2:y=m=p=f=u=c=h=l=_=void 0;var l,h,c,u,_=this,d=function(t,e,i){for(var n,r,s,a=0;a<t;)switch(n=C(this,e)){case 16:for(s=3+A(this,2);s--;)i[a++]=r;break;case 17:for(s=3+A(this,3);s--;)i[a++]=0;r=0;break;case 18:for(s=11+A(this,7);s--;)i[a++]=0;r=0;break;default:r=i[a++]=n}return i},f=A(_,5)+257,p=A(_,5)+1,m=A(_,4)+4,y=new(et?Uint8Array:Array)(O.length);for(u=0;u<m;++u)y[O[u]]=A(_,3);l=g(y),h=new(et?Uint8Array:Array)(f),c=new(et?Uint8Array:Array)(p),_.o(g(d.call(_,f,l,h)),g(d.call(_,p,l,c)));break;default:Q(Error("unknown BTYPE: "+t))}}return this.t()};for(var d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=et?new Uint16Array(d):d,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],L=et?new Uint16Array(d):d,d=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],f=et?new Uint8Array(d):d,d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],F=et?new Uint16Array(d):d,d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],p=et?new Uint8Array(d):d,m=new(et?Uint8Array:Array)(288),y=0,V=m.length;y<V;++y)m[y]=y<=143?8:y<=255?9:y<=279?7:8;for(var N=g(m),x=new(et?Uint8Array:Array)(30),k=0,z=x.length;k<z;++k)x[k]=5;var G=g(x);function A(t,e){for(var i,n=t.g,r=t.e,s=t.input,a=t.c;r<e;)(i=s[a++])===$&&Q(Error("input buffer is broken")),n|=i<<r,r+=8;return i=n&(1<<e)-1,t.g=n>>>e,t.e=r-e,t.c=a,i}function C(t,e){for(var i,n=t.g,r=t.e,s=t.input,a=t.c,o=e[0],l=e[1];r<l;)(i=s[a++])===$&&Q(Error("input buffer is broken")),n|=i<<r,r+=8;return o=(e=o[n&(1<<l)-1])>>>16,t.g=n>>o,t.e=r-o,t.c=a,65535&e}function U(t,e){var i,n;this.input=t,this.c=0,e?(e.index&&(this.c=e.index),e.verify&&(this.M=e.verify)):e={},i=t[this.c++],n=t[this.c++],(15&i)===w?this.method=w:Q(Error("unsupported compression method")),0!=((i<<8)+n)%31&&Q(Error("invalid fcheck flag:"+((i<<8)+n)%31)),32&n&&Q(Error("fdict flag is not supported")),this.A=new _(t,{index:this.c,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}_.prototype.o=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,a,o,l=i.length-258;256!==(r=C(this,t));)if(r<256)l<=n&&(this.b=n,i=this.f(),n=this.b),i[n++]=r;else for(o=L[s=r-257],0<f[s]&&(o+=A(this,f[s])),r=C(this,e),a=F[r],0<p[r]&&(a+=A(this,p[r])),l<=n&&(this.b=n,i=this.f(),n=this.b);o--;)i[n]=i[n++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},_.prototype.I=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,a,o,l=i.length;256!==(r=C(this,t));)if(r<256)l<=n&&(l=(i=this.f()).length),i[n++]=r;else for(o=L[s=r-257],0<f[s]&&(o+=A(this,f[s])),r=C(this,e),a=F[r],0<p[r]&&(a+=A(this,p[r])),l<n+o&&(l=(i=this.f()).length);o--;)i[n]=i[n++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},_.prototype.f=function(){var t,e,i=new(et?Uint8Array:Array)(this.b-32768),n=this.b-32768,r=this.a;if(et)i.set(r.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=r[t+32768];if(this.k.push(i),this.q+=i.length,et)r.set(r.subarray(n,32768+n));else for(t=0;t<32768;++t)r[t]=r[n+t];return this.b=32768,r},_.prototype.J=function(t){var e,i=this.input.length/this.c+1|0,n=this.input,r=this.a;return t&&("number"==typeof t.v&&(i=t.v),"number"==typeof t.F&&(i+=t.F)),n=i<2?(t=(n.length-this.c)/this.u[2]/2*258|0)<r.length?r.length+t:r.length<<1:r.length*i,et?(e=new Uint8Array(n)).set(r):e=r,this.a=e},_.prototype.t=function(){var t,e,i,n,r,s=0,a=this.a,o=this.k,l=new(et?Uint8Array:Array)(this.q+(this.b-32768));if(0===o.length)return et?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=o.length;e<i;++e)for(n=0,r=(t=o[e]).length;n<r;++n)l[s++]=t[n];for(e=32768,i=this.b;e<i;++e)l[s++]=a[e];return this.k=[],this.buffer=l},_.prototype.H=function(){var t,e=this.b;return et?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},U.prototype.p=function(){var t=this.input,e=this.A.p();return this.c=this.A.c,this.M&&(t[this.c++]<<24|t[this.c++]<<16|t[this.c++]<<8|t[this.c++])>>>0!==M(e)&&Q(Error("invalid adler-32 checksum")),e},t("Zlib.Inflate",U),t("Zlib.Inflate.BufferType",r),r.ADAPTIVE=r.C,r.BLOCK=r.D,t("Zlib.Inflate.prototype.decompress",U.prototype.p),et&&new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),et&&new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),et&&new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),et&&new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),et&&new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);for(var j=new(et?Uint8Array:Array)(288),S=0,W=j.length;S<W;++S)j[S]=S<=143?8:S<=255?9:S<=279?7:8;g(j);for(var H=new(et?Uint8Array:Array)(30),X=0,Y=H.length;X<Y;++X)H[X]=5;g(H);var w=8}.call(window);var n=window.Zlib;n.Deflate=n.Deflate,n.Deflate.compress=n.Deflate.compress,n.Inflate=n.Inflate,n.Inflate.BufferType=n.Inflate.BufferType,n.Inflate.prototype.decompress=n.Inflate.prototype.decompress,e.exports=n},{}],26:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c,u,_,d,f,p,m,y,g,v=w(t("../../renderer/enums")),b=w(t("../value-types/color")),x=t("../value-types"),A=w(t("../renderer/index")),C=w(t("../platform/CCEnum")),T=w(t("../components/CCComponent")),S=t("../platform/CCClassDecorator");function w(t){return t&&t.__esModule?t:{default:t}}function E(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function M(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function D(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function B(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var I,P,F=null,F=t("../../renderer/scene/light"),R=(0,C.default)({DIRECTIONAL:0,POINT:1,SPOT:2,AMBIENT:3}),O=(0,C.default)({NONE:0,HARD:2,SOFT_PCF3X3:3,SOFT_PCF5X5:4}),t=(t=(0,S.ccclass)("cc.Light"),C=(0,S.menu)("i18n:MAIN_MENU.component.renderers/Light"),g=(0,S.inspector)("packages://inspector/inspectors/comps/light.js"),n=(0,S.property)({type:R}),r=(0,S.property)({type:O}),t(P=C(P=(0,S.executeInEditMode)(P=g((I=T.default,t=I,(C=L).prototype=Object.create(t.prototype),(C.prototype.constructor=C).__proto__=t,C=L,(t=[{key:"type",get:function(){return this._type},set:function(t){this._type=t;var e=v.default.LIGHT_DIRECTIONAL;t===R.POINT?e=v.default.LIGHT_POINT:t===R.SPOT?e=v.default.LIGHT_SPOT:t===R.AMBIENT&&(e=v.default.LIGHT_AMBIENT),this._light.setType(e)}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._light.setColor(t.r/255,t.g/255,t.b/255)}},{key:"intensity",get:function(){return this._intensity},set:function(t){this._intensity=t,this._light.setIntensity(t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light.setRange(t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light.setSpotAngle((0,x.toRadian)(t))}},{key:"spotExp",get:function(){return this._spotExp},set:function(t){this._spotExp=t,this._light.setSpotExp(t)}},{key:"shadowType",get:function(){return this._shadowType},set:function(t){this._shadowType=t,this._light.setShadowType(t)}},{key:"shadowResolution",get:function(){return this._shadowResolution},set:function(t){this._shadowResolution=t,this._light.setShadowResolution(t)}},{key:"shadowDarkness",get:function(){return this._shadowDarkness},set:function(t){this._shadowDarkness=t,this._light.setShadowDarkness(t)}},{key:"shadowMinDepth",get:function(){return this._shadowMinDepth},set:function(t){this._shadowMinDepth=t,this._light.setShadowMinDepth(t)}},{key:"shadowMaxDepth",get:function(){return this._shadowMaxDepth},set:function(t){this._shadowMaxDepth=t,this._light.setShadowMaxDepth(t)}},{key:"shadowFrustumSize",get:function(){return this._shadowFrustumSize},set:function(t){this._shadowFrustumSize=t,this._light.setShadowFrustumSize(t)}}])&&D(C.prototype,t),P&&D(C,P),(t=L.prototype).onLoad=function(){this._light.setNode(this.node),this.type=this._type,this.color=this._color,this.intensity=this._intensity,this.range=this._range,this.spotAngle=this._spotAngle,this.spotExp=this._spotExp,this.shadowType=this._shadowType,this.shadowResolution=this._shadowResolution,this.shadowDarkness=this._shadowDarkness,this.shadowMaxDepth=this._shadowMaxDepth,this.shadowFrustumSize=this._shadowFrustumSize,this.shadowBias=this._shadowBias},t.onEnable=function(){A.default.scene.addLight(this._light)},t.onDisable=function(){A.default.scene.removeLight(this._light)},T=g=L,g.Type=R,g.ShadowType=O,s=B((C=T).prototype,"_type",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return R.DIRECTIONAL}}),a=B(C.prototype,"_color",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return b.default.WHITE}}),o=B(C.prototype,"_intensity",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),l=B(C.prototype,"_range",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),h=B(C.prototype,"_spotAngle",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),c=B(C.prototype,"_spotExp",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),u=B(C.prototype,"_shadowType",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return O.NONE}}),_=B(C.prototype,"_shadowResolution",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),d=B(C.prototype,"_shadowDarkness",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),f=B(C.prototype,"_shadowMinDepth",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),p=B(C.prototype,"_shadowMaxDepth",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4096}}),m=B(C.prototype,"_shadowFrustumSize",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),y=B(C.prototype,"_shadowBias",[S.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5e-4}}),B(C.prototype,"type",[n],Object.getOwnPropertyDescriptor(C.prototype,"type"),C.prototype),B(C.prototype,"color",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"color"),C.prototype),B(C.prototype,"intensity",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"intensity"),C.prototype),B(C.prototype,"range",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"range"),C.prototype),B(C.prototype,"spotAngle",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"spotAngle"),C.prototype),B(C.prototype,"spotExp",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"spotExp"),C.prototype),B(C.prototype,"shadowType",[r],Object.getOwnPropertyDescriptor(C.prototype,"shadowType"),C.prototype),B(C.prototype,"shadowResolution",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"shadowResolution"),C.prototype),B(C.prototype,"shadowDarkness",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"shadowDarkness"),C.prototype),B(C.prototype,"shadowMinDepth",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"shadowMinDepth"),C.prototype),B(C.prototype,"shadowMaxDepth",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"shadowMaxDepth"),C.prototype),B(C.prototype,"shadowFrustumSize",[S.property],Object.getOwnPropertyDescriptor(C.prototype,"shadowFrustumSize"),C.prototype),P=C))||P)||P)||P)||P);function L(){var t;return E(t=I.call(this)||this,"_type",s,M(t)),E(t,"_color",a,M(t)),E(t,"_intensity",o,M(t)),E(t,"_range",l,M(t)),E(t,"_spotAngle",h,M(t)),E(t,"_spotExp",c,M(t)),E(t,"_shadowType",u,M(t)),E(t,"_shadowResolution",_,M(t)),E(t,"_shadowDarkness",d,M(t)),E(t,"_shadowMinDepth",f,M(t)),E(t,"_shadowMaxDepth",p,M(t)),E(t,"_shadowFrustumSize",m,M(t)),E(t,"_shadowBias",y,M(t)),t._light=new F,t}i.default=t,cc.Light=t,e.exports=i.default},{"../../renderer/enums":358,"../../renderer/scene/light":384,"../components/CCComponent":120,"../platform/CCClassDecorator":231,"../platform/CCEnum":232,"../renderer/index":262,"../value-types":330,"../value-types/color":329}],27:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Model",extends:cc.Asset,ctor:function(){this._rootNode=null},properties:{_nodes:{default:[]},_precomputeJointMatrix:!1,nodes:{get:function(){return this._nodes}},rootNode:{get:function(){return this._rootNode}},precomputeJointMatrix:{get:function(){return this._precomputeJointMatrix}}},onLoad:function(){var t=this._nodes;this._rootNode=t[0];for(var e=0;e<t.length;e++){var i=t[e],n=(i.position=cc.v3.apply(this,i.position),i.scale=cc.v3.apply(this,i.scale),i.quat=cc.quat.apply(this,i.quat),i.uniqueBindPose&&(i.uniqueBindPose=cc.mat4.apply(this,i.uniqueBindPose)),i.bindpose);if(n)for(var r in n)n[r]=cc.mat4.apply(this,n[r]);var s=i.children;if(s)for(var a=0;a<s.length;a++)s[a]=t[s[a]]}}});cc.Model=e.exports=n},{}],28:[function(t,e,i){"use strict";var r=n(t("../value-types/quat")),s=n(t("../value-types/vec3"));function n(t){return t&&t.__esModule?t:{default:t}}var a=cc.quat(),o=cc.v3();cc.Rotate3DTo=cc.Class({name:"cc.Rotate3DTo",extends:cc.ActionInterval,ctor:function(t,e,i,n){this._startQuat=cc.quat(),this._dstQuat=cc.quat(),void 0!==e&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(t=this._dstQuat,e instanceof cc.Quat?t.set(e):(e instanceof cc.Vec3?(i=e.y,n=e.z,e=e.x):(i=i||0,n=n||0),r.default.fromEuler(t,e,i,n)),!0)},clone:function(){var t=new cc.Rotate3DTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstQuat),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startQuat.set(t.quat)},reverse:function(){cc.logID(1016)},update:function(t){t=this._computeEaseTime(t),this.target&&(r.default.slerp(a,this._startQuat,this._dstQuat,t),this.target.setRotation(a))}}),cc.rotate3DTo=function(t,e,i,n){return new cc.Rotate3DTo(t,e,i,n)},cc.Rotate3DBy=cc.Class({name:"cc.Rotate3DBy",extends:cc.ActionInterval,ctor:function(t,e,i,n){this._startQuat=cc.quat(),this._dstQuat=cc.quat(),this._deltaAngle=cc.v3(),void 0!==e&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(e instanceof cc.Vec3?(i=e.y,n=e.z,e=e.x):(i=i||0,n=n||0),s.default.set(this._deltaAngle,e,i,n),!0)},clone:function(){var t=new cc.Rotate3DBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angle),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.eulerAngles,i=this._deltaAngle;r.default.fromEuler(this._dstQuat,e.x+i.x,e.y+i.y,e.z+i.z),this._startQuat.set(t.quat)},update:(Math.PI,function(t){t=this._computeEaseTime(t),this.target&&(r.default.slerp(a,this._startQuat,this._dstQuat,t),this.target.setRotation(a))}),reverse:function(){var t=this._angle,t=(o.x=-t.x,o.y=-t.y,o.z=-t.z,new cc.Rotate3DBy(this._duration,o));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotate3DBy=function(t,e,i,n){return new cc.Rotate3DBy(t,e,i,n)}},{"../value-types/quat":333,"../value-types/vec3":340}],29:[function(t,e,i){"use strict";t("./primitive"),t("./physics/exports/physics-builtin"),t("./physics/exports/physics-cannon"),t("./physics/exports/physics-framework"),t("./CCModel"),t("./skeleton/CCSkeleton"),t("./skeleton/CCSkeletonAnimationClip"),t("./actions"),t("./physics/framework/assets/physics-material"),t("./skeleton/CCSkeletonAnimation"),t("./skeleton/CCSkinnedMeshRenderer"),t("./skeleton/skinned-mesh-renderer"),t("./CCLightComponent"),t("./particle/particle-system-3d"),t("./particle/renderer/particle-system-3d-renderer")},{"./CCLightComponent":26,"./CCModel":27,"./actions":28,"./particle/particle-system-3d":45,"./particle/renderer/particle-system-3d-renderer":48,"./physics/exports/physics-builtin":void 0,"./physics/exports/physics-cannon":void 0,"./physics/exports/physics-framework":void 0,"./physics/framework/assets/physics-material":void 0,"./primitive":55,"./skeleton/CCSkeleton":64,"./skeleton/CCSkeletonAnimation":65,"./skeleton/CCSkeletonAnimationClip":66,"./skeleton/CCSkinnedMeshRenderer":67,"./skeleton/skinned-mesh-renderer":68}],30:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s=t("../../../platform/CCClassDecorator"),a=t("../../../value-types"),o=(t=t("./gradient-range"))&&t.__esModule?t:{default:t};function l(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function h(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}t=(0,s.ccclass)("cc.ColorOvertimeModule"),c=(0,s.property)({type:o.default});var c=t((n=h((u.prototype.animate=function(t){this.enable&&(t.color.set(t.startColor),t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,(0,a.pseudoRandom)(t.randomSeed+91041))))},t=u).prototype,"enable",[s.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),r=h(t.prototype,"color",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new o.default}}),s=t))||s;function u(){l(this,"enable",n,this),l(this,"color",r,this)}i.default=c,e.exports=i.default},{"../../../platform/CCClassDecorator":231,"../../../value-types":330,"./gradient-range":33}],31:[function(t,e,i){"use strict";i.__esModule=!0,i.default=i.Mode=void 0;var n,r,s,a,o,l,h,c,u,_,d=t("../../../platform/CCClassDecorator"),f=(f=t("../../../platform/CCEnum"))&&f.__esModule?f:{default:f},p=t("../../../value-types"),m=t("../curve");function y(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function g(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var v=(0,f.default)({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),b=(i.Mode=v,t=(0,d.ccclass)("cc.CurveRange"),f=(0,d.property)({type:v}),b=(0,d.property)({type:m.AnimationCurve}),n=(0,d.property)({type:m.AnimationCurve}),r=(0,d.property)({type:m.AnimationCurve}),t(((t=x.prototype).evaluate=function(t,e){switch(this.mode){case v.Constant:return this.constant;case v.Curve:return this.curve.evaluate(t)*this.multiplier;case v.TwoCurves:return(0,p.lerp)(this.curveMin.evaluate(t),this.curveMax.evaluate(t),e)*this.multiplier;case v.TwoConstants:return(0,p.lerp)(this.constantMin,this.constantMax,e)}},t.getMax=function(){switch(this.mode){case v.Constant:return this.constant;case v.Curve:return this.multiplier;case v.TwoConstants:return this.constantMax;case v.TwoCurves:return this.multiplier}return 0},x.Mode=v,s=g((t=x).prototype,"mode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return v.Constant}}),a=g(t.prototype,"curve",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m.AnimationCurve}}),o=g(t.prototype,"curveMin",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m.AnimationCurve}}),l=g(t.prototype,"curveMax",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m.AnimationCurve}}),h=g(t.prototype,"constant",[d.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c=g(t.prototype,"constantMin",[d.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u=g(t.prototype,"constantMax",[d.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_=g(t.prototype,"multiplier",[d.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),f=t))||f);function x(){y(this,"mode",s,this),y(this,"curve",a,this),y(this,"curveMin",o,this),y(this,"curveMax",l,this),y(this,"constant",h,this),y(this,"constantMin",c,this),y(this,"constantMax",u,this),y(this,"multiplier",_,this)}i.default=b,cc.CurveRange=b},{"../../../platform/CCClassDecorator":231,"../../../platform/CCEnum":232,"../../../value-types":330,"../curve":41}],32:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c,u=t("../../../platform/CCClassDecorator"),_=t("../../../value-types"),d=t("../enum"),f=t("../particle-general-function"),p=(t=t("./curve-range"))&&t.__esModule?t:{default:t};function m(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function y(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var g=cc.v3(),v=(t=(0,u.ccclass)("cc.ForceOvertimeModule"),v=(0,u.property)({type:d.Space}),n=(0,u.property)({type:p.default,range:[-1,1]}),r=(0,u.property)({type:p.default,range:[-1,1]}),s=(0,u.property)({type:p.default,range:[-1,1],displayOrder:4}),t((a=y(((t=b.prototype).update=function(t,e){this.needTransform=(0,f.calculateTransform)(t,this.space,e,this.rotation)},t.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,i=_.Vec3.set(g,this.x.evaluate(i,(0,_.pseudoRandom)(t.randomSeed+212165)),this.y.evaluate(i,(0,_.pseudoRandom)(t.randomSeed+212165)),this.z.evaluate(i,(0,_.pseudoRandom)(t.randomSeed+212165)));this.needTransform&&_.Vec3.transformQuat(i,i,this.rotation),_.Vec3.scaleAndAdd(t.velocity,t.velocity,i,e)},t=b).prototype,"enable",[u.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o=y(t.prototype,"space",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d.Space.Local}}),l=y(t.prototype,"x",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p.default}}),h=y(t.prototype,"y",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p.default}}),c=y(t.prototype,"z",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p.default}}),u=t))||u);function b(){m(this,"enable",a,this),m(this,"space",o,this),m(this,"x",l,this),m(this,"y",h,this),m(this,"z",c,this),this.randomized=!1,this.rotation=null,this.needTransform=!1,this.rotation=new _.Quat,this.needTransform=!1}i.default=v,e.exports=i.default},{"../../../platform/CCClassDecorator":231,"../../../value-types":330,"../enum":43,"../particle-general-function":44,"./curve-range":31}],33:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c,u,_,d,f=t("../../../platform/CCClassDecorator"),p=(p=t("../../../platform/CCEnum"))&&p.__esModule?p:{default:p},m=t("./gradient");function y(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function g(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var b,x=(0,p.default)({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),A=(t=(0,f.ccclass)("cc.GradientRange"),p=(0,f.property)({type:x}),n=(0,f.property)({type:m.Gradient}),r=(0,f.property)({type:m.Gradient}),s=(0,f.property)({type:m.Gradient}),t((C.prototype.evaluate=function(t,e){switch(this._mode){case x.Color:return this.color;case x.TwoColors:return this.colorMin.lerp(this.colorMax,e,this._color),this._color;case x.RandomColor:return this.gradient.randomColor();case x.Gradient:return this.gradient.evaluate(t);case x.TwoGradients:return this.gradientMin.evaluate(t).lerp(this.gradientMax.evaluate(t),e,this._color),this._color;default:return this.color}},t=C,(b=[{key:"mode",get:function(){return this._mode},set:function(t){this._mode=t}}])&&g(t.prototype,b),A&&g(t,A),C.Mode=x,a=v((b=C).prototype,"_mode",[f.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return x.Color}}),v(b.prototype,"mode",[p],Object.getOwnPropertyDescriptor(b.prototype,"mode"),b.prototype),o=v(b.prototype,"_color",[f.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cc.Color.WHITE.clone()}}),l=v(b.prototype,"color",[f.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cc.Color.WHITE.clone()}}),h=v(b.prototype,"colorMin",[f.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cc.Color.WHITE.clone()}}),c=v(b.prototype,"colorMax",[f.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cc.Color.WHITE.clone()}}),u=v(b.prototype,"gradient",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m.Gradient}}),_=v(b.prototype,"gradientMin",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m.Gradient}}),d=v(b.prototype,"gradientMax",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m.Gradient}}),t=b))||t);function C(){y(this,"_mode",a,this),y(this,"_color",o,this),y(this,"color",l,this),y(this,"colorMin",h,this),y(this,"colorMax",c,this),y(this,"gradient",u,this),y(this,"gradientMin",_,this),y(this,"gradientMax",d,this)}i.default=A,cc.GradientRange=A,e.exports=i.default},{"../../../platform/CCClassDecorator":231,"../../../platform/CCEnum":232,"./gradient":34}],34:[function(t,e,i){"use strict";i.__esModule=!0,i.Gradient=i.AlphaKey=i.ColorKey=void 0;var n,r,s,a,o,l,h,c,u=t("../../../platform/CCClassDecorator"),_=(_=t("../../../platform/CCEnum"))&&_.__esModule?_:{default:_},d=t("../../../value-types");function f(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function p(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var m,y=(0,_.default)({Blend:0,Fixed:1}),t=(0,u.ccclass)("cc.ColorKey")((n=p((t=function(){f(this,"color",n,this),f(this,"time",r,this)}).prototype,"color",[u.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cc.Color.WHITE.clone()}}),r=p(t.prototype,"time",[u.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_=t))||_,_=(i.ColorKey=t,(0,u.ccclass)("cc.AlphaKey")((s=p((_=function(){f(this,"alpha",s,this),f(this,"time",a,this)}).prototype,"alpha",[u.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),a=p(_.prototype,"time",[u.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_=_))||_),g=(i.AlphaKey=_,m=(0,u.ccclass)("cc.Gradient"),o=(0,u.property)({type:[t]}),g=(0,u.property)({type:[_]}),u=(0,u.property)({type:y}),m(((m=v.prototype).setKeys=function(t,e){this.colorKeys=t,this.alphaKeys=e},m.sortKeys=function(){1<this.colorKeys.length&&this.colorKeys.sort(function(t,e){return t.time-e.time}),1<this.alphaKeys.length&&this.alphaKeys.sort(function(t,e){return t.time-e.time})},m.evaluate=function(t){return this.getRGB(t),this._color._fastSetA(this.getAlpha(t)),this._color},m.randomColor=function(){var t=this.colorKeys[Math.trunc(Math.random()*this.colorKeys.length)],e=this.alphaKeys[Math.trunc(Math.random()*this.alphaKeys.length)];return this._color.set(t.color),this._color._fastSetA(e.alpha),this._color},m.getRGB=function(t){if(!(1<this.colorKeys.length))return 1===this.colorKeys.length?this._color.set(this.colorKeys[0].color):this._color.set(cc.Color.WHITE),this._color;t=(0,d.repeat)(t,1);for(var e=1;e<this.colorKeys.length;++e){var i=this.colorKeys[e-1].time,n=this.colorKeys[e].time;if(i<=t&&t<n)return this.mode===y.Fixed?this.colorKeys[e].color:(this.colorKeys[e-1].color.lerp(this.colorKeys[e].color,(t-i)/(n-i),this._color),this._color)}var r=this.colorKeys.length-1;t<this.colorKeys[0].time?cc.Color.BLACK.lerp(this.colorKeys[0].color,t/this.colorKeys[0].time,this._color):t>this.colorKeys[r].time&&this.colorKeys[r].color.lerp(cc.Color.BLACK,(t-this.colorKeys[r].time)/(1-this.colorKeys[r].time),this._color)},m.getAlpha=function(t){if(!(1<this.alphaKeys.length))return 1===this.alphaKeys.length?this.alphaKeys[0].alpha:255;t=(0,d.repeat)(t,1);for(var e=1;e<this.alphaKeys.length;++e){var i=this.alphaKeys[e-1].time,n=this.alphaKeys[e].time;if(i<=t&&t<n)return this.mode===y.Fixed?this.alphaKeys[e].alpha:(0,d.lerp)(this.alphaKeys[e-1].alpha,this.alphaKeys[e].alpha,(t-i)/(n-i))}var r=this.alphaKeys.length-1;return t<this.alphaKeys[0].time?(0,d.lerp)(255,this.alphaKeys[0].alpha,t/this.alphaKeys[0].time):t>this.alphaKeys[r].time?(0,d.lerp)(this.alphaKeys[r].alpha,255,(t-this.alphaKeys[r].time)/(1-this.alphaKeys[r].time)):void 0},v.Mode=y,l=p((m=v).prototype,"colorKeys",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),h=p(m.prototype,"alphaKeys",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),c=p(m.prototype,"mode",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return y.Blend}}),o=m))||o);function v(){f(this,"colorKeys",l,this),f(this,"alphaKeys",h,this),f(this,"mode",c,this),this._color=null,this._color=cc.Color.WHITE.clone()}i.Gradient=g,cc.ColorKey=t,cc.AlphaKey=_,cc.Gradient=g},{"../../../platform/CCClassDecorator":231,"../../../platform/CCEnum":232,"../../../value-types":330}],35:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c,u,_,d,f,p=t("../../../platform/CCClassDecorator"),m=t("../../../value-types"),y=t("../enum"),g=(t=t("./curve-range"))&&t.__esModule?t:{default:t};function v(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function b(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var x=cc.v3(),A=cc.v3();function C(t,e,i){var n=Math.sign(t),t=Math.abs(t);return(t=e<t?(0,m.lerp)(t,e,i):t)*n}t=(0,p.ccclass)("cc.LimitVelocityOvertimeModule"),a=(0,p.property)({type:y.Space}),T=(0,p.property)({type:g.default,range:[-1,1]}),n=(0,p.property)({type:g.default,range:[-1,1]}),r=(0,p.property)({type:g.default,range:[-1,1]}),s=(0,p.property)({type:g.default,range:[-1,1]});var T=t((o=b(((t=S.prototype).update=function(t,e){this.needTransform=calculateTransform(t,this.space,e,this.rotation)},t.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=x;this.separateAxes?(m.Vec3.set(A,this.limitX.evaluate(e,(0,m.pseudoRandom)(t.randomSeed+23541)),this.limitY.evaluate(e,(0,m.pseudoRandom)(t.randomSeed+23541)),this.limitZ.evaluate(e,(0,m.pseudoRandom)(t.randomSeed+23541))),this.needTransform&&m.Vec3.transformQuat(A,A,this.rotation),m.Vec3.set(i,C(t.ultimateVelocity.x,A.x,this.dampen),C(t.ultimateVelocity.y,A.y,this.dampen),C(t.ultimateVelocity.z,A.z,this.dampen))):(m.Vec3.normalize(i,t.ultimateVelocity),m.Vec3.scale(i,i,C(t.ultimateVelocity.len(),this.limit.evaluate(e,(0,m.pseudoRandom)(t.randomSeed+23541)),this.dampen))),m.Vec3.copy(t.ultimateVelocity,i)},t=S).prototype,"enable",[p.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l=b(t.prototype,"space",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return y.Space.Local}}),h=b(t.prototype,"separateAxes",[p.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),c=b(t.prototype,"limit",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new g.default}}),u=b(t.prototype,"limitX",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new g.default}}),_=b(t.prototype,"limitY",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new g.default}}),d=b(t.prototype,"limitZ",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new g.default}}),f=b(t.prototype,"dampen",[p.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),a=t))||a;function S(){v(this,"enable",o,this),v(this,"space",l,this),v(this,"separateAxes",h,this),v(this,"limit",c,this),v(this,"limitX",u,this),v(this,"limitY",_,this),v(this,"limitZ",d,this),v(this,"dampen",f,this),this.drag=null,this.multiplyDragByParticleSize=!1,this.multiplyDragByParticleVelocity=!1,this.rotation=null,this.needTransform=!1,this.rotation=new m.Quat,this.needTransform=!1}i.default=T,e.exports=i.default},{"../../../platform/CCClassDecorator":231,"../../../value-types":330,"../enum":43,"./curve-range":31}],36:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c,u=t("../../../platform/CCClassDecorator"),_=t("../../../value-types"),d=(t=t("./curve-range"))&&t.__esModule?t:{default:t};function f(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function p(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}t=(0,u.ccclass)("cc.RotationOvertimeModule"),n=(0,u.property)({type:d.default,range:[-1,1],radian:!0}),r=(0,u.property)({type:d.default,range:[-1,1],radian:!0}),s=(0,u.property)({type:d.default,range:[-1,1],radian:!0});var y,g=t((a=m((t=v,(y=[{key:"separateAxes",get:function(){return this._separateAxes},set:function(t){t?console.error("rotation overtime separateAxes is not supported!"):this._separateAxes=t}}])&&p(t.prototype,y),g&&p(t,g),v.prototype.animate=function(t,e){var i,n=1-t.remainingLifetime/t.startLifetime;this._separateAxes?(i=(0,_.pseudoRandom)(t.randomSeed+125292),t.rotation.x+=this.x.evaluate(n,i)*e,t.rotation.y+=this.y.evaluate(n,i)*e,t.rotation.z+=this.z.evaluate(n,i)*e):t.rotation.x+=this.z.evaluate(n,(0,_.pseudoRandom)(t.randomSeed+125292))*e},y=v).prototype,"enable",[u.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o=m(y.prototype,"_separateAxes",[u.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),m(y.prototype,"separateAxes",[u.property],Object.getOwnPropertyDescriptor(y.prototype,"separateAxes"),y.prototype),l=m(y.prototype,"x",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d.default}}),h=m(y.prototype,"y",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d.default}}),c=m(y.prototype,"z",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d.default}}),t=y))||t;function v(){f(this,"enable",a,this),f(this,"_separateAxes",o,this),f(this,"x",l,this),f(this,"y",h,this),f(this,"z",c,this)}i.default=g,e.exports=i.default},{"../../../platform/CCClassDecorator":231,"../../../value-types":330,"./curve-range":31}],37:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c,u,_=t("../../../platform/CCClassDecorator"),d=t("../../../value-types"),f=(t=t("./curve-range"))&&t.__esModule?t:{default:t};function p(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function m(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}t=(0,_.ccclass)("cc.SizeOvertimeModule"),y=(0,_.property)({type:f.default}),n=(0,_.property)({type:f.default}),r=(0,_.property)({type:f.default}),s=(0,_.property)({type:f.default});var y=t((a=m((g.prototype.animate=function(t){var e,i;this.separateAxes?(e=1-t.remainingLifetime/t.startLifetime,i=(0,d.pseudoRandom)(t.randomSeed+39825),t.size.x=t.startSize.x*this.x.evaluate(e,i),t.size.y=t.startSize.y*this.y.evaluate(e,i),t.size.z=t.startSize.z*this.z.evaluate(e,i)):d.Vec3.scale(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,(0,d.pseudoRandom)(t.randomSeed+39825)))},t=g).prototype,"enable",[_.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o=m(t.prototype,"separateAxes",[_.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l=m(t.prototype,"size",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f.default}}),h=m(t.prototype,"x",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f.default}}),c=m(t.prototype,"y",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f.default}}),u=m(t.prototype,"z",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f.default}}),_=t))||_;function g(){p(this,"enable",a,this),p(this,"separateAxes",o,this),p(this,"size",l,this),p(this,"x",h,this),p(this,"y",c,this),p(this,"z",u,this)}i.default=y,e.exports=i.default},{"../../../platform/CCClassDecorator":231,"../../../value-types":330,"./curve-range":31}],38:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c,u,_,d,f,p,m=t("../../../platform/CCClassDecorator"),y=b(t("../../../platform/CCEnum")),g=t("../../../value-types"),v=b(t("./curve-range"));function b(t){return t&&t.__esModule?t:{default:t}}function x(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function A(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function C(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var T,S=(0,y.default)({Grid:0}),w=(0,y.default)({WholeSheet:0,SingleRow:1}),E=(t=(0,m.ccclass)("cc.TextureAnimationModule"),y=(0,m.property)({type:S}),n=(0,m.property)({type:w}),r=(0,m.property)({type:v.default}),s=(0,m.property)({type:v.default}),t((a=C(((t=M.prototype).onInit=function(t){this.ps=t},t.init=function(t){t.startRow=Math.floor(Math.random()*this.numTilesY)},t.animate=function(t){var e,i,n,r=1-t.remainingLifetime/t.startLifetime,s=this.startFrame.evaluate(r,(0,g.pseudoRandom)(t.randomSeed+90794))/(this.numTilesX*this.numTilesY);this.animation===w.WholeSheet?t.frameIndex=(0,g.repeat)(this.cycleCount*(this.frameOverTime.evaluate(r,(0,g.pseudoRandom)(t.randomSeed+90794))+s),1):this.animation===w.SingleRow&&(e=1/this.numTilesY,this.randomRow?(i=(0,g.repeat)(this.cycleCount*(this.frameOverTime.evaluate(r,(0,g.pseudoRandom)(t.randomSeed+90794))+s),1),n=t.startRow*e,t.frameIndex=(0,g.lerp)(n,n+e,i)):(n=this.rowIndex*e,t.frameIndex=(0,g.lerp)(n,n+e,(0,g.repeat)(this.cycleCount*(this.frameOverTime.evaluate(r,(0,g.pseudoRandom)(t.randomSeed+90794))+s),1))))},t=M,(T=[{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t,this.ps._assembler._updateMaterialParams()}},{key:"mode",get:function(){return this._mode},set:function(t){t!==S.Grid&&console.error("particle texture animation's sprites is not supported!")}},{key:"flipU",get:function(){return this._flipU},set:function(t){console.error("particle texture animation's flipU is not supported!")}},{key:"flipV",get:function(){return this._flipV},set:function(t){console.error("particle texture animation's flipV is not supported!")}},{key:"uvChannelMask",get:function(){return this._uvChannelMask},set:function(t){console.error("particle texture animation's uvChannelMask is not supported!")}}])&&A(t.prototype,T),E&&A(t,E),T=M).prototype,"_enable",[m.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C(T.prototype,"enable",[m.property],Object.getOwnPropertyDescriptor(T.prototype,"enable"),T.prototype),o=C(T.prototype,"_mode",[m.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return S.Grid}}),C(T.prototype,"mode",[y],Object.getOwnPropertyDescriptor(T.prototype,"mode"),T.prototype),l=C(T.prototype,"numTilesX",[m.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h=C(T.prototype,"numTilesY",[m.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c=C(T.prototype,"animation",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return w.WholeSheet}}),u=C(T.prototype,"randomRow",[m.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_=C(T.prototype,"rowIndex",[m.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),d=C(T.prototype,"frameOverTime",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new v.default}}),f=C(T.prototype,"startFrame",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new v.default}}),p=C(T.prototype,"cycleCount",[m.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C(T.prototype,"flipU",[m.property],Object.getOwnPropertyDescriptor(T.prototype,"flipU"),T.prototype),C(T.prototype,"flipV",[m.property],Object.getOwnPropertyDescriptor(T.prototype,"flipV"),T.prototype),C(T.prototype,"uvChannelMask",[m.property],Object.getOwnPropertyDescriptor(T.prototype,"uvChannelMask"),T.prototype),t=T))||t);function M(){x(this,"_enable",a,this),x(this,"_mode",o,this),x(this,"numTilesX",l,this),x(this,"numTilesY",h,this),x(this,"animation",c,this),x(this,"randomRow",u,this),x(this,"rowIndex",_,this),x(this,"frameOverTime",d,this),x(this,"startFrame",f,this),x(this,"cycleCount",p,this),this._flipU=0,this._flipV=0,this._uvChannelMask=-1,this.ps=null}i.default=E,e.exports=i.default},{"../../../platform/CCClassDecorator":231,"../../../platform/CCEnum":232,"../../../value-types":330,"./curve-range":31}],39:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c,u,_,d=t("../../../platform/CCClassDecorator"),f=t("../../../value-types"),p=t("../enum"),m=t("../particle-general-function"),y=(t=t("./curve-range"))&&t.__esModule?t:{default:t};function g(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function v(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var b=cc.v3(),x=(t=(0,d.ccclass)("cc.VelocityOvertimeModule"),x=(0,d.property)({type:p.Space}),n=(0,d.property)({type:y.default,range:[-1,1]}),r=(0,d.property)({type:y.default,range:[-1,1]}),s=(0,d.property)({type:y.default,range:[-1,1]}),a=(0,d.property)({type:y.default,range:[-1,1]}),t((o=v(((t=A.prototype).update=function(t,e){this.needTransform=(0,m.calculateTransform)(t,this.space,e,this.rotation)},t.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,e=f.Vec3.set(b,this.x.evaluate(e,(0,f.pseudoRandom)(t.randomSeed+197866)),this.y.evaluate(e,(0,f.pseudoRandom)(t.randomSeed+197866)),this.z.evaluate(e,(0,f.pseudoRandom)(t.randomSeed+197866)));this.needTransform&&f.Vec3.transformQuat(e,e,this.rotation),f.Vec3.add(t.animatedVelocity,t.animatedVelocity,e),f.Vec3.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),f.Vec3.scale(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,(0,f.pseudoRandom)(t.randomSeed+197866)))},t=A).prototype,"enable",[d.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l=v(t.prototype,"space",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return p.Space.Local}}),h=v(t.prototype,"x",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y.default}}),c=v(t.prototype,"y",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y.default}}),u=v(t.prototype,"z",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y.default}}),_=v(t.prototype,"speedModifier",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y.default}}),d=t))||d);function A(){g(this,"enable",o,this),g(this,"space",l,this),g(this,"x",h,this),g(this,"y",c,this),g(this,"z",u,this),g(this,"speedModifier",_,this),this.rotation=null,this.needTransform=!1,this.rotation=new f.Quat,this.speedModifier.constant=1,this.needTransform=!1}i.default=x,e.exports=i.default},{"../../../platform/CCClassDecorator":231,"../../../value-types":330,"../enum":43,"../particle-general-function":44,"./curve-range":31}],40:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,s,a,o,l,h,c=t("../../platform/CCClassDecorator"),u=t("../../value-types"),_=(t=t("./animator/curve-range"))&&t.__esModule?t:{default:t};function d(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function f(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}t=(0,c.ccclass)("cc.Burst"),n=(0,c.property)({type:_.default});var m,y=t((r=p((t=g,(y=[{key:"time",get:function(){return this._time},set:function(t){this._time=t,this._curTime=t}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this._remainingCount=t}}])&&f(t.prototype,y),m&&f(t,m),(y=g.prototype).update=function(t,e){var i,n;0===this._remainingCount&&(this._remainingCount=this._repeatCount,this._curTime=this._time),0<this._remainingCount&&(i=0<(i=(0,u.repeat)(t._time-t.startDelay.evaluate(0,1),t.duration)-e)?i:0,n=(0,u.repeat)(t.time-t.startDelay.evaluate(0,1),t.duration),this._curTime>=i&&this._curTime<n&&(t.emit(this.count.evaluate(this._curTime/t.duration,1),e-(n-this._curTime)),this._curTime+=this.repeatInterval,--this._remainingCount))},y.getMaxCount=function(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)},t=g).prototype,"_time",[c.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),p(t.prototype,"time",[c.property],Object.getOwnPropertyDescriptor(t.prototype,"time"),t.prototype),s=p(t.prototype,"minCount",[c.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),a=p(t.prototype,"maxCount",[c.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),o=p(t.prototype,"_repeatCount",[c.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),p(t.prototype,"repeatCount",[c.property],Object.getOwnPropertyDescriptor(t.prototype,"repeatCount"),t.prototype),l=p(t.prototype,"repeatInterval",[c.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),h=p(t.prototype,"count",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _.default}}),m=t))||m;function g(){d(this,"_time",r,this),d(this,"minCount",s,this),d(this,"maxCount",a,this),d(this,"_repeatCount",o,this),d(this,"repeatInterval",l,this),d(this,"count",h,this),this._remainingCount=0,this._curTime=0,this._remainingCount=0,this._curTime=0}i.default=y,e.exports=i.default},{"../../platform/CCClassDecorator":231,"../../value-types":330,"./animator/curve-range":31}],41:[function(t,e,i){"use strict";i.__esModule=!0,i.evalOptCurve=g,i.AnimationCurve=i.OptimizedKey=i.Keyframe=void 0;var r,s,a,o,n,l,h,c,u=(u=t("../../platform/CCEnum"))&&u.__esModule?u:{default:u},d=t("../../value-types"),t=t("../../platform/CCClassDecorator");function _(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function f(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var p=(0,u.default)({Default:0,Once:1,Loop:2,PingPong:3,ClampForever:4}),u=(0,t.ccclass)("cc.Keyframe")((r=f((u=function(t,e,i,n){_(this,"time",r,this),_(this,"value",s,this),_(this,"inTangent",a,this),_(this,"outTangent",o,this),this.time=t||0,this.value=e||0,this.inTangent=i||0,this.outTangent=n||0}).prototype,"time",[t.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s=f(u.prototype,"value",[t.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a=f(u.prototype,"inTangent",[t.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),o=f(u.prototype,"outTangent",[t.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u=u))||u,m=(i.Keyframe=u,y.prototype.evaluate=function(t){return g(t-this.time,this.coefficient)},y);function y(){this.index=0,this.time=0,this.endTime=0,this.coefficient=null,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}function g(t,e){return t*(t*(t*e[0]+e[1])+e[2])+e[3]}i.OptimizedKey=m;var v,b=new u(0,1,0,0),x=new u(1,1,0,0),A=(v=(0,t.ccclass)("cc.AnimationCurve"),n=(0,t.property)({default:[],type:[u]}),A=(0,t.property)({type:cc.Enum(p),visible:!1}),t=(0,t.property)({type:cc.Enum(p),visible:!1}),v((l=f(((v=C.prototype).addKey=function(t){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(t)},v.evaluate_slow=function(t){var e=t,i=t<0?this.preWrapMode:this.postWrapMode,n=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(i){case p.Loop:e=(0,d.repeat)(t-n,r-n)+n;break;case p.PingPong:e=(0,d.pingPong)(t-n,r-n)+n;break;case p.ClampForever:e=(0,d.clamp)(t,n,r)}var s=0;if(e>this.keyFrames[0].time)if(e>=this.keyFrames[this.keyFrames.length-1].time)s=this.keyFrames.length-2;else for(var a=0;a<this.keyFrames.length-1;a++)if(e>=this.keyFrames[0].time&&e<=this.keyFrames[a+1].time){s=a;break}var i=this.keyFrames[s],o=this.keyFrames[s+1],l=(0,d.inverseLerp)(i.time,o.time,e),h=o.time-i.time,c=i.outTangent*h,h=o.inTangent*h,u=l*l,_=u*l;return(2*_-3*u+1)*i.value+(_-2*u+l)*c+(_-u)*h+(-2*_+3*u)*o.value},v.evaluate=function(t){var e=t,i=t<0?this.preWrapMode:this.postWrapMode,n=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(i){case p.Loop:e=(0,d.repeat)(t-n,r-n)+n;break;case p.PingPong:e=(0,d.pingPong)(t-n,r-n)+n;break;case p.ClampForever:e=(0,d.clamp)(t,n,r)}if(e>=this.cachedKey.time&&e<this.cachedKey.endTime)return this.cachedKey.evaluate(e);var i=this.findIndex(this.cachedKey,e),s=i+1;return s===this.keyFrames.length&&--s,this.calcOptimizedKey(this.cachedKey,i,s),this.cachedKey.evaluate(e)},v.calcOptimizedKey=function(t,e,i){var n=this.keyFrames[e],i=this.keyFrames[i],e=(t.index=e,t.time=n.time,t.endTime=i.time,i.time-n.time),r=i.value-n.value,s=1/(e*e),a=n.outTangent*e,i=i.inTangent*e;t.coefficient[0]=(a+i-r-r)*s/e,t.coefficient[1]=(r+r+r-a-a-i)*s,t.coefficient[2]=n.outTangent,t.coefficient[3]=n.value},v.findIndex=function(t,e){var i=t.index;if(-1!==i)if(e>this.keyFrames[i].time)for(var n=0;n<3;n++){var r=i+n;if(r+1<this.keyFrames.length&&this.keyFrames[r+1].time>e)return r}else for(var s=0;s<3;s++){var a=i-s;if(0<=a&&this.keyFrames[a-1].time<=e)return a-1}for(var o=0,l=this.keyFrames.length,h=Math.floor((o+l)/2);1<l-o;)this.keyFrames[h].time>=e?l=h:o=h+1,h=Math.floor((o+l)/2);return o},v=C).prototype,"keyFrames",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),h=f(v.prototype,"preWrapMode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return p.Loop}}),c=f(v.prototype,"postWrapMode",[t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return p.Loop}}),n=v))||n);function C(t){void 0===t&&(t=null),_(this,"keyFrames",l,this),_(this,"preWrapMode",h,this),_(this,"postWrapMode",c,this),this.cachedKey=null,t?this.keyFrames=t:(this.keyFrames.push(b),this.keyFrames.push(x)),this.cachedKey=new m}i.AnimationCurve=A,cc.Keyframe=u,cc.AnimationCurve=A},{"../../platform/CCClassDecorator":231,"../../platform/CCEnum":232,"../../value-types":330}],42:[function(t,F,e){"use strict";e.__esModule=!0,e.default=void 0;var i,n,r,s,a,o,l,h,c,u,_,d,f,p,m,y,g,v,b,x,A,C,T=t("../../../platform/CCClassDecorator"),M=t("../../../value-types"),S=(I=t("../animator/curve-range"))&&I.__esModule?I:{default:I},D=t("../particle-general-function"),B=t("../enum");function w(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function V(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function E(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var I,P,N=new M.Vec3(0,0,0),R=new Array,k=new M.Vec3(.5,.5,.5),O=(I=(0,T.ccclass)("cc.ShapeModule"),t=(0,T.property)({type:B.ShapeType}),i=(0,T.property)({type:B.EmitLocation}),n=(0,T.property)({type:B.ArcMode}),r=(0,T.property)({type:S.default}),I((s=E((I=L,(O=[{key:"shapeType",get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,this._shapeType){case B.ShapeType.Box:this.emitFrom===B.EmitLocation.Base&&(this.emitFrom=B.EmitLocation.Volume);break;case B.ShapeType.Cone:this.emitFrom===B.EmitLocation.Edge&&(this.emitFrom=B.EmitLocation.Base);break;case B.ShapeType.Sphere:case B.ShapeType.Hemisphere:this.emitFrom!==B.EmitLocation.Base&&this.emitFrom!==B.EmitLocation.Edge||(this.emitFrom=B.EmitLocation.Volume)}}},{key:"angle",get:function(){return Math.round(100*(0,M.toDegree)(this._angle))/100},set:function(t){this._angle=(0,M.toRadian)(t)}},{key:"arc",get:function(){return(0,M.toDegree)(this._arc)},set:function(t){this._arc=(0,M.toRadian)(t)}},{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.constructMat()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.constructMat()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this.constructMat()}}])&&V(I.prototype,O),P&&V(I,P),(O=L.prototype).onInit=function(t){this.particleSystem=t,this.constructMat(),this.lastTime=this.particleSystem._time},O.constructMat=function(){M.Quat.fromEuler(this.quat,this._rotation.x,this._rotation.y,this._rotation.z),M.Mat4.fromRTS(this.mat,this.quat,this._position,this._scale)},O.emit=function(t){switch(this.shapeType){case B.ShapeType.Box:var e=this.emitFrom,i=this.boxThickness,n=t.position,r=t.velocity;switch(e){case B.EmitLocation.Volume:(0,D.randomPointInCube)(n,k);break;case B.EmitLocation.Shell:R.splice(0,R.length),R.push((0,M.randomRange)(-.5,.5)),R.push((0,M.randomRange)(-.5,.5)),R.push(.5*(0,D.randomSign)()),(0,D.randomSortArray)(R),z(R,i),M.Vec3.set(n,R[0],R[1],R[2]);break;case B.EmitLocation.Edge:R.splice(0,R.length),R.push((0,M.randomRange)(-.5,.5)),R.push(.5*(0,D.randomSign)()),R.push(.5*(0,D.randomSign)()),(0,D.randomSortArray)(R),z(R,i),M.Vec3.set(n,R[0],R[1],R[2]);break;default:console.warn(e+" is not supported for box emitter.")}M.Vec3.copy(r,D.particleEmitZAxis);break;case B.ShapeType.Circle:r=this.radius,C=this.radiusThickness,T=this.generateArcAngle(),S=t.position,w=t.velocity,(0,D.randomPointBetweenCircleAtFixedAngle)(S,r*(1-C),r,T),M.Vec3.normalize(w,S);break;case B.ShapeType.Cone:var s=this.emitFrom,a=this.radius,o=this.radiusThickness,l=this.generateArcAngle(),h=this._angle,c=this.length,u=t.position,_=t.velocity;switch(s){case B.EmitLocation.Base:(0,D.randomPointBetweenCircleAtFixedAngle)(u,a*(1-o),a,l),M.Vec2.scale(_,u,Math.sin(h)),_.z=-Math.cos(h)*a,M.Vec3.normalize(_,_),u.z=0;break;case B.EmitLocation.Shell:(0,D.fixedAngleUnitVector2)(u,l),M.Vec2.scale(_,u,Math.sin(h)),_.z=-Math.cos(h),M.Vec3.normalize(_,_),M.Vec2.scale(u,u,a),u.z=0;break;case B.EmitLocation.Volume:(0,D.randomPointBetweenCircleAtFixedAngle)(u,a*(1-o),a,l),M.Vec2.scale(_,u,Math.sin(h)),_.z=-Math.cos(h)*a,M.Vec3.normalize(_,_),u.z=0,M.Vec3.add(u,u,M.Vec3.scale(N,_,c*(0,M.random)()/-_.z));break;default:console.warn(s+" is not supported for cone emitter.")}break;case B.ShapeType.Sphere:var d=this.emitFrom,f=this.radius,p=this.radiusThickness,m=t.position,y=t.velocity;switch(d){case B.EmitLocation.Volume:(0,D.randomPointBetweenSphere)(m,f*(1-p),f),M.Vec3.copy(y,m),M.Vec3.normalize(y,y);break;case B.EmitLocation.Shell:(0,D.randomUnitVector)(m),M.Vec3.scale(m,m,f),M.Vec3.copy(y,m);break;default:console.warn(d+" is not supported for sphere emitter.")}break;case B.ShapeType.Hemisphere:var g=this.emitFrom,v=this.radius,b=this.radiusThickness,x=t.position,A=t.velocity;switch(g){case B.EmitLocation.Volume:(0,D.randomPointBetweenSphere)(x,v*(1-b),v),0<x.z&&(x.z*=-1),M.Vec3.copy(A,x),M.Vec3.normalize(A,A);break;case B.EmitLocation.Shell:(0,D.randomUnitVector)(x),M.Vec3.scale(x,x,v),x.z<0&&(x.z*=-1),M.Vec3.copy(A,x);break;default:console.warn(g+" is not supported for hemisphere emitter.")}break;default:console.warn(this.shapeType+" shapeType is not supported by ShapeModule.")}var C,T,S,w,E;0<this.randomPositionAmount&&(t.position.x+=(0,M.randomRange)(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=(0,M.randomRange)(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=(0,M.randomRange)(-this.randomPositionAmount,this.randomPositionAmount)),M.Vec3.transformQuat(t.velocity,t.velocity,this.quat),M.Vec3.transformMat4(t.position,t.position,this.mat),0<this.sphericalDirectionAmount&&(E=M.Vec3.normalize(N,t.position),M.Vec3.lerp(t.velocity,t.velocity,E,this.sphericalDirectionAmount)),this.lastTime=this.particleSystem._time},O.generateArcAngle=function(){if(this.arcMode===B.ArcMode.Random)return(0,M.randomRange)(0,this._arc);var t=this.totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem._time,1)*(this.particleSystem._time-this.lastTime);switch(this.totalAngle=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case B.ArcMode.Loop:return(0,M.repeat)(t,this._arc);case B.ArcMode.PingPong:return(0,M.pingPong)(t,this._arc)}},I=L).prototype,"enable",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=E(I.prototype,"_shapeType",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return B.ShapeType.Cone}}),E(I.prototype,"shapeType",[t],Object.getOwnPropertyDescriptor(I.prototype,"shapeType"),I.prototype),o=E(I.prototype,"emitFrom",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return B.EmitLocation.Volume}}),l=E(I.prototype,"radius",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),h=E(I.prototype,"radiusThickness",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),c=E(I.prototype,"_angle",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return(0,M.toRadian)(25)}}),E(I.prototype,"angle",[T.property],Object.getOwnPropertyDescriptor(I.prototype,"angle"),I.prototype),u=E(I.prototype,"_arc",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return(0,M.toRadian)(360)}}),E(I.prototype,"arc",[T.property],Object.getOwnPropertyDescriptor(I.prototype,"arc"),I.prototype),_=E(I.prototype,"arcMode",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return B.ArcMode.Random}}),d=E(I.prototype,"arcSpread",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f=E(I.prototype,"arcSpeed",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new S.default}}),p=E(I.prototype,"length",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),m=E(I.prototype,"boxThickness",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new M.Vec3(0,0,0)}}),y=E(I.prototype,"_position",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new M.Vec3(0,0,0)}}),E(I.prototype,"position",[T.property],Object.getOwnPropertyDescriptor(I.prototype,"position"),I.prototype),g=E(I.prototype,"_rotation",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new M.Vec3(0,0,0)}}),E(I.prototype,"rotation",[T.property],Object.getOwnPropertyDescriptor(I.prototype,"rotation"),I.prototype),v=E(I.prototype,"_scale",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new M.Vec3(1,1,1)}}),E(I.prototype,"scale",[T.property],Object.getOwnPropertyDescriptor(I.prototype,"scale"),I.prototype),b=E(I.prototype,"alignToDirection",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),x=E(I.prototype,"randomDirectionAmount",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),A=E(I.prototype,"sphericalDirectionAmount",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=E(I.prototype,"randomPositionAmount",[T.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),P=I))||P);function L(){w(this,"enable",s,this),w(this,"_shapeType",a,this),w(this,"emitFrom",o,this),w(this,"radius",l,this),w(this,"radiusThickness",h,this),w(this,"_angle",c,this),w(this,"_arc",u,this),w(this,"arcMode",_,this),w(this,"arcSpread",d,this),w(this,"arcSpeed",f,this),w(this,"length",p,this),w(this,"boxThickness",m,this),w(this,"_position",y,this),w(this,"_rotation",g,this),w(this,"_scale",v,this),w(this,"alignToDirection",b,this),w(this,"randomDirectionAmount",x,this),w(this,"sphericalDirectionAmount",A,this),w(this,"randomPositionAmount",C,this),this.mat=null,this.Quat=null,this.particleSystem=null,this.lastTime=null,this.totalAngle=null,this.mat=new M.Mat4,this.quat=new M.Quat,this.particleSystem=null,this.lastTime=0,this.totalAngle=0}function z(t,e){0<e.x&&(t[0]+=.5*(0,M.randomRange)(-e.x,e.x),t[0]=(0,M.clamp)(t[0],-.5,.5)),0<e.y&&(t[1]+=.5*(0,M.randomRange)(-e.y,e.y),t[1]=(0,M.clamp)(t[1],-.5,.5)),0<e.z&&(t[2]+=.5*(0,M.randomRange)(-e.z,e.z),t[2]=(0,M.clamp)(t[2],-.5,.5))}e.default=O,F.exports=e.default},{"../../../platform/CCClassDecorator":231,"../../../value-types":330,"../animator/curve-range":31,"../enum":43,"../particle-general-function":44}],43:[function(t,e,i){"use strict";i.__esModule=!0,i.TextureMode=i.TrailMode=i.ArcMode=i.EmitLocation=i.ShapeType=i.RenderMode=i.Space=void 0;var t=(t=t("../../platform/CCEnum"))&&t.__esModule?t:{default:t},n=(0,t.default)({World:0,Local:1,Custom:2}),n=(i.Space=n,(0,t.default)({Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4})),n=(i.RenderMode=n,(0,t.default)({Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4})),n=(i.ShapeType=n,(0,t.default)({Base:0,Edge:1,Shell:2,Volume:3})),n=(i.EmitLocation=n,(0,t.default)({Random:0,Loop:1,PingPong:2})),n=(i.ArcMode=n,(0,t.default)({Particles:0,Ribbon:1})),n=(i.TrailMode=n,(0,t.default)({Stretch:0,Repeat:1}));i.TextureMode=n},{"../../platform/CCEnum":232}],44:[function(t,e,i){"use strict";i.__esModule=!0,i.calculateTransform=function(t,e,i,n){return e!==t?(t!==r.Space.World&&o.Mat4.invert(i,i),o.Mat4.getRotation(n,i),!0):(o.Quat.set(n,0,0,0,1),!1)},i.fixedAngleUnitVector2=s,i.randomUnitVector2=a,i.randomUnitVector=l,i.randomPointInUnitSphere=function(t){l(t),o.Vec3.scale(t,t,(0,o.random)())},i.randomPointBetweenSphere=function(t,e,i){l(t),o.Vec3.scale(t,t,e+(i-e)*(0,o.random)())},i.randomPointInUnitCircle=function(t){a(t),t.z=0,o.Vec3.scale(t,t,(0,o.random)())},i.randomPointBetweenCircle=function(t,e,i){a(t),t.z=0,o.Vec3.scale(t,t,e+(i-e)*(0,o.random)())},i.randomPointBetweenCircleAtFixedAngle=function(t,e,i,n){s(t,n),t.z=0,o.Vec3.scale(t,t,e+(i-e)*(0,o.random)())},i.randomPointInCube=function(t,e){o.Vec3.set(t,(0,o.randomRange)(-e.x,e.x),(0,o.randomRange)(-e.y,e.y),(0,o.randomRange)(-e.z,e.z))},i.randomPointBetweenCube=function(t,e,i){for(var n,r=["x","y","z"],s=(0,o.randomRangeInt)(0,3),a=0;a<3;a++)a!==s?(n=2*(0,o.random)()-1,t[r[a]]=n<0?-e[r[a]]+n*(i[r[a]]-e[r[a]]):e[r[a]]+n*(i[r[a]]-e[r[a]])):t[r[a]]=(0,o.randomRange)(-i[r[a]],i[r[a]])},i.randomSortArray=function(t){for(var e=0;e<t.length;e++){var i=e+(0,o.randomRangeInt)(0,t.length-e),n=t[i];t[i]=t[e],t[e]=n}},i.randomSign=function(){var t=(0,o.randomRange)(-1,1);return 0===t&&t++,(0,n.sign)(t)},i.particleEmitZAxis=void 0;var o=t("../../value-types"),n=t("../../value-types/utils"),r=t("./enum"),t=new o.Vec3(0,0,-1);function s(t,e){o.Vec2.set(t,Math.cos(e),Math.sin(e))}function a(t){var e=(0,o.randomRange)(0,2*Math.PI),i=Math.cos(e),e=Math.sin(e);o.Vec2.set(t,i,e)}function l(t){var e=(0,o.randomRange)(-1,1),i=(0,o.randomRange)(0,2*Math.PI),n=Math.sqrt(1-e*e),r=n*Math.cos(i),n=n*Math.sin(i);o.Vec3.set(t,r,n,e)}i.particleEmitZAxis=t},{"../../value-types":330,"../../value-types/utils":337,"./enum":43}],45:[function(t,F,e){"use strict";e.__esModule=!0,e.default=void 0;var i,n,r,s,a,o,l,h,c,u,_,d,f,p,m,y,g,V,N,k,z,G,U,j,W,H,X,Y,q,J,Z,K,Q,$,tt,et,it,nt,rt,st,at,ot,lt,ht,ct,ut,_t,dt,ft,pt,mt,yt,gt,vt,bt,xt,At,Ct,v=t("../../value-types"),Tt=t("../../value-types/utils"),b=S(t("../../assets/material/CCMaterial")),St=S(t("./animator/color-overtime")),x=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=Ft();if(e&&e.has(t))return e.get(t);var i,n,r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&((n=s?Object.getOwnPropertyDescriptor(t,i):null)&&(n.get||n.set)?Object.defineProperty(r,i,n):r[i]=t[i]);return r.default=t,e&&e.set(t,r),r}(t("./animator/curve-range")),wt=S(t("./animator/force-overtime")),Et=S(t("./animator/gradient-range")),Mt=S(t("./animator/limit-velocity-overtime")),Dt=S(t("./animator/rotation-overtime")),Bt=S(t("./animator/size-overtime")),It=S(t("./animator/texture-animation")),Pt=S(t("./animator/velocity-overtime")),A=S(t("./burst")),Rt=S(t("./emitter/shape-module")),C=t("./enum"),Ot=t("./particle-general-function"),Lt=S(t("./renderer/trail")),T=S(t("../../mesh/CCMesh"));function Ft(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return Ft=function(){return t},t}function S(t){return t&&t.__esModule?t:{default:t}}function Vt(t){var e=0;if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator])return(e=t[Symbol.iterator]()).next.bind(e);if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return Nt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Nt(t,e):void 0}}(t)))return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function w(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zt(t,e,i){e&&kt(t.prototype,e),i&&kt(t,i)}function M(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var D,B=t("../../platform/CCClassDecorator"),I=B.ccclass,P=B.menu,R=B.property,O=B.executeInEditMode,B=B.executionOrder,t=t("../../components/CCRenderComponent"),Gt=new v.Mat4,t=(I=I("cc.ParticleSystem3D"),P=P("i18n:MAIN_MENU.component.renderers/ParticleSystem3D"),B=B(99),i=R({animatable:!1}),n=R({animatable:!1}),r=R({type:C.Space,animatable:!1}),s=R({type:x.default}),a=R({type:x.default}),o=R({type:Et.default}),l=R({type:C.Space}),h=R({type:x.default}),c=R({type:x.default,range:[-1,1]}),u=R({type:x.default,range:[-1,1],radian:!0}),_=R({type:x.default,range:[-1,1]}),d=R({type:x.default}),f=R({type:x.default}),A=R({type:[A.default],animatable:!1}),p=R({type:[b.default],displayName:"Materials",visible:!1,override:!0}),m=R({type:Rt.default,animatable:!1}),y=R({type:St.default,animatable:!1}),g=R({type:Bt.default,animatable:!1}),V=R({type:Pt.default,animatable:!1}),N=R({type:wt.default,animatable:!1}),k=R({type:Mt.default,animatable:!1}),z=R({type:Dt.default,animatable:!1}),G=R({type:It.default,animatable:!1}),U=R({type:Lt.default,animatable:!1}),j=R({type:C.RenderMode,animatable:!1}),W=R({animatable:!1}),H=R({animatable:!1}),T=R({type:T.default,animatable:!1}),X=R({type:b.default,animatable:!1}),b=R({type:b.default,animatable:!1}),I(O=P(O=B(O=O((Y=M((I=D=t,(P=L).prototype=Object.create(I.prototype),(P.prototype.constructor=P).__proto__=I,zt(L,[{key:"capacity",get:function(){return this._capacity},set:function(t){this._capacity=t,this._assembler&&this._assembler.setCapacity(this._capacity)}},{key:"prewarm",get:function(){return this._prewarm},set:function(t){!0===t&&this.loop,this._prewarm=t}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(t){t!==this._simulationSpace&&(this._simulationSpace=t,this._assembler._updateMaterialParams(),this._assembler._updateTrailMaterial())}},{key:"materials",get:function(){return this._materials},set:function(t){this._materials=t,this._activateMaterial()}},{key:"shapeModule",get:function(){return this._shapeModule},set:function(t){this._shapeModule=t,this._shapeModule.onInit(this)}},{key:"colorOverLifetimeModule",get:function(){return this._colorOverLifetimeModule},set:function(t){this._colorOverLifetimeModule=t}},{key:"sizeOvertimeModule",get:function(){return this._sizeOvertimeModule},set:function(t){this._sizeOvertimeModule=t}},{key:"velocityOvertimeModule",get:function(){return this._velocityOvertimeModule},set:function(t){this._velocityOvertimeModule=t}},{key:"forceOvertimeModule",get:function(){return this._forceOvertimeModule},set:function(t){this._forceOvertimeModule=t}},{key:"limitVelocityOvertimeModule",get:function(){return this._limitVelocityOvertimeModule},set:function(t){this._limitVelocityOvertimeModule=t}},{key:"rotationOvertimeModule",get:function(){return this._rotationOvertimeModule},set:function(t){this._rotationOvertimeModule=t}},{key:"textureAnimationModule",get:function(){return this._textureAnimationModule},set:function(t){this._textureAnimationModule=t,this._textureAnimationModule.onInit(this)}},{key:"trailModule",get:function(){return this._trailModule},set:function(t){this._trailModule=t,this._trailModule.onInit(this)}},{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t,this._assembler._setVertexAttrib(),this._assembler._updateModel(),this._assembler._updateMaterialParams())}},{key:"velocityScale",get:function(){return this._velocityScale},set:function(t){this._velocityScale=t,this._assembler._updateMaterialParams()}},{key:"lengthScale",get:function(){return this._lengthScale},set:function(t){this._lengthScale=t,this._assembler._updateMaterialParams()}},{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this._assembler._updateModel()}},{key:"particleMaterial",get:function(){return this.getMaterial(0)},set:function(t){this.setMaterial(0,t),this._onMaterialModified(0,t)}},{key:"trailMaterial",get:function(){return this.getMaterial(1)},set:function(t){this.setMaterial(1,t),this._onMaterialModified(1,t)}}]),(P=L.prototype).onLoad=function(){this._assembler.onInit(this),this.shapeModule.onInit(this),this.trailModule.onInit(this),this.textureAnimationModule.onInit(this),this._resetPosition()},P._onMaterialModified=function(t,e){this._assembler._onMaterialModified(t,e)},P._onRebuildPSO=function(t,e){this._assembler._onRebuildPSO(t,e)},P.play=function(){this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this._isPlaying=!0,this._isEmitting=!0,this._resetPosition(),this._prewarm&&this._prewarmSystem()},P.pause=function(){this._isStopped?console.warn("pause(): particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0)},P.stop=function(){(this._isPlaying||this._isPaused)&&this.clear(),this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this._time=0,this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this._isStopped=!0},P.clear=function(){this.enabledInHierarchy&&(this._assembler.clear(),this.trailModule.clear())},P.getParticleCount=function(){return this._assembler.getParticleCount()},P.setCustomData1=function(t,e){v.Vec2.set(this._customData1,t,e)},P.setCustomData2=function(t,e){v.Vec2.set(this._customData2,t,e)},P.onDestroy=function(){this._assembler.onDestroy(),this.trailModule.destroy()},P.onEnable=function(){D.prototype.onEnable.call(this),this.playOnAwake&&this.play(),this._assembler.onEnable(),this.trailModule.onEnable()},P.onDisable=function(){D.prototype.onDisable.call(this),this._assembler.onDisable(),this.trailModule.onDisable()},P.update=function(t){t*=this.simulationSpeed;this._isPlaying&&(this._time+=t,this._emit(t),0!==this._assembler._updateParticles(t)||this._isEmitting||this.stop(),this._assembler.updateParticleBuffer(),this.trailModule.enable&&this.trailModule.updateTrailBuffer())},P.emit=function(t,e){this._simulationSpace===C.Space.World&&this.node.getWorldMatrix(Gt);for(var i=0;i<t;++i){var n=this._assembler._getFreeParticle();if(null===n)return;var r=(0,v.pseudoRandom)((0,v.randomRangeInt)(0,Tt.INT_MAX));switch(this.shapeModule.enable?this.shapeModule.emit(n):(v.Vec3.set(n.position,0,0,0),v.Vec3.copy(n.velocity,Ot.particleEmitZAxis)),this.textureAnimationModule.enable&&this.textureAnimationModule.init(n),v.Vec3.scale(n.velocity,n.velocity,this.startSpeed.evaluate(this._time/this.duration,r)),this._simulationSpace){case C.Space.Local:break;case C.Space.World:v.Vec3.transformMat4(n.position,n.position,Gt);var s=new v.Quat;this.node.getWorldRotation(s),v.Vec3.transformQuat(n.velocity,n.velocity,s);break;case C.Space.Custom:}v.Vec3.copy(n.ultimateVelocity,n.velocity),v.Vec3.set(n.rotation,0,0,this.startRotation.evaluate(this._time/this.duration,r)),v.Vec3.set(n.startSize,this.startSize.evaluate(this._time/this.duration,r),1,1),n.startSize.y=n.startSize.x,v.Vec3.copy(n.size,n.startSize),n.startColor.set(this.startColor.evaluate(this._time/this.duration,r)),n.color.set(n.startColor),n.startLifetime=this.startLifetime.evaluate(this._time/this.duration,r)+e,n.remainingLifetime=n.startLifetime,n.randomSeed=(0,v.randomRangeInt)(0,233280),this._assembler._setNewParticle(n)}},P._prewarmSystem=function(){this.startDelay.mode=x.Mode.Constant,this.startDelay.constant=0;for(var t=+this.duration,e=0;e<t;++e)this._time+=1,this._emit(1),this._assembler._updateParticles(1)},P._emit=function(t){var e=this.startDelay.evaluate(0,1);if(this._time>e)if(this._time>this.duration+e&&!this.loop)this._isEmitting=!1;else{this._emitRateTimeCounter+=this.rateOverTime.evaluate(this._time/this.duration,1)*t,1<this._emitRateTimeCounter&&this._isEmitting&&(e=Math.floor(this._emitRateTimeCounter),this._emitRateTimeCounter-=e,this.emit(e,t)),this.node.getWorldPosition(this._curWPos);var e=v.Vec3.distance(this._curWPos,this._oldWPos);v.Vec3.copy(this._oldWPos,this._curWPos),this._emitRateDistanceCounter+=e*this.rateOverDistance.evaluate(this._time/this.duration,1),1<this._emitRateDistanceCounter&&this._isEmitting&&(e=Math.floor(this._emitRateDistanceCounter),this._emitRateDistanceCounter-=e,this.emit(e,t));for(var i,n=Vt(this.bursts);!(i=n()).done;)i.value.update(this,t)}},P._activateMaterial=function(){},P._resetPosition=function(){this.node.getWorldPosition(this._oldWPos),v.Vec3.copy(this._curWPos,this._oldWPos)},P.addSubEmitter=function(t){this._subEmitters.push(t)},P.removeSubEmitter=function(t){this._subEmitters.splice(this._subEmitters.indexOf(t),1)},P.addBurst=function(t){this.bursts.push(t)},P.removeBurst=function(t){this.bursts.splice(this.bursts.indexOf(t),1)},P._checkBacth=function(){},zt(L,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isStopped",get:function(){return this._isStopped}},{key:"isEmitting",get:function(){return this._isEmitting}},{key:"time",get:function(){return this._time}}]),B=L).prototype,"duration",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),q=M(B.prototype,"_capacity",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),M(B.prototype,"capacity",[R],Object.getOwnPropertyDescriptor(B.prototype,"capacity"),B.prototype),J=M(B.prototype,"loop",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Z=M(B.prototype,"playOnAwake",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),K=M(B.prototype,"_prewarm",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),M(B.prototype,"prewarm",[n],Object.getOwnPropertyDescriptor(B.prototype,"prewarm"),B.prototype),Q=M(B.prototype,"_simulationSpace",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C.Space.Local}}),M(B.prototype,"simulationSpace",[r],Object.getOwnPropertyDescriptor(B.prototype,"simulationSpace"),B.prototype),$=M(B.prototype,"simulationSpeed",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tt=M(B.prototype,"startDelay",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x.default}}),et=M(B.prototype,"startLifetime",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x.default}}),it=M(B.prototype,"startColor",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Et.default}}),nt=M(B.prototype,"scaleSpace",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C.Space.Local}}),rt=M(B.prototype,"startSize",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x.default}}),st=M(B.prototype,"startSpeed",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x.default}}),at=M(B.prototype,"startRotation",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x.default}}),ot=M(B.prototype,"gravityModifier",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x.default}}),lt=M(B.prototype,"rateOverTime",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x.default}}),ht=M(B.prototype,"rateOverDistance",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x.default}}),ct=M(B.prototype,"bursts",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),M(B.prototype,"materials",[p],Object.getOwnPropertyDescriptor(B.prototype,"materials"),B.prototype),ut=M(B.prototype,"_shapeModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rt.default}}),M(B.prototype,"shapeModule",[m],Object.getOwnPropertyDescriptor(B.prototype,"shapeModule"),B.prototype),_t=M(B.prototype,"_colorOverLifetimeModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new St.default}}),M(B.prototype,"colorOverLifetimeModule",[y],Object.getOwnPropertyDescriptor(B.prototype,"colorOverLifetimeModule"),B.prototype),dt=M(B.prototype,"_sizeOvertimeModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Bt.default}}),M(B.prototype,"sizeOvertimeModule",[g],Object.getOwnPropertyDescriptor(B.prototype,"sizeOvertimeModule"),B.prototype),ft=M(B.prototype,"_velocityOvertimeModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pt.default}}),M(B.prototype,"velocityOvertimeModule",[V],Object.getOwnPropertyDescriptor(B.prototype,"velocityOvertimeModule"),B.prototype),pt=M(B.prototype,"_forceOvertimeModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wt.default}}),M(B.prototype,"forceOvertimeModule",[N],Object.getOwnPropertyDescriptor(B.prototype,"forceOvertimeModule"),B.prototype),mt=M(B.prototype,"_limitVelocityOvertimeModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mt.default}}),M(B.prototype,"limitVelocityOvertimeModule",[k],Object.getOwnPropertyDescriptor(B.prototype,"limitVelocityOvertimeModule"),B.prototype),yt=M(B.prototype,"_rotationOvertimeModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dt.default}}),M(B.prototype,"rotationOvertimeModule",[z],Object.getOwnPropertyDescriptor(B.prototype,"rotationOvertimeModule"),B.prototype),gt=M(B.prototype,"_textureAnimationModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new It.default}}),M(B.prototype,"textureAnimationModule",[G],Object.getOwnPropertyDescriptor(B.prototype,"textureAnimationModule"),B.prototype),vt=M(B.prototype,"_trailModule",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Lt.default}}),M(B.prototype,"trailModule",[U],Object.getOwnPropertyDescriptor(B.prototype,"trailModule"),B.prototype),bt=M(B.prototype,"_renderMode",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C.RenderMode.Billboard}}),M(B.prototype,"renderMode",[j],Object.getOwnPropertyDescriptor(B.prototype,"renderMode"),B.prototype),xt=M(B.prototype,"_velocityScale",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),M(B.prototype,"velocityScale",[W],Object.getOwnPropertyDescriptor(B.prototype,"velocityScale"),B.prototype),At=M(B.prototype,"_lengthScale",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),M(B.prototype,"lengthScale",[H],Object.getOwnPropertyDescriptor(B.prototype,"lengthScale"),B.prototype),Ct=M(B.prototype,"_mesh",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M(B.prototype,"mesh",[T],Object.getOwnPropertyDescriptor(B.prototype,"mesh"),B.prototype),M(B.prototype,"particleMaterial",[X],Object.getOwnPropertyDescriptor(B.prototype,"particleMaterial"),B.prototype),M(B.prototype,"trailMaterial",[b],Object.getOwnPropertyDescriptor(B.prototype,"trailMaterial"),B.prototype),O=B))||O)||O)||O)||O);function L(){var t;return w(t=D.call(this)||this,"duration",Y,E(t)),w(t,"_capacity",q,E(t)),w(t,"loop",J,E(t)),w(t,"playOnAwake",Z,E(t)),w(t,"_prewarm",K,E(t)),w(t,"_simulationSpace",Q,E(t)),w(t,"simulationSpeed",$,E(t)),w(t,"startDelay",tt,E(t)),w(t,"startLifetime",et,E(t)),w(t,"startColor",it,E(t)),w(t,"scaleSpace",nt,E(t)),w(t,"startSize",rt,E(t)),w(t,"startSpeed",st,E(t)),w(t,"startRotation",at,E(t)),w(t,"gravityModifier",ot,E(t)),w(t,"rateOverTime",lt,E(t)),w(t,"rateOverDistance",ht,E(t)),w(t,"bursts",ct,E(t)),w(t,"_shapeModule",ut,E(t)),w(t,"_colorOverLifetimeModule",_t,E(t)),w(t,"_sizeOvertimeModule",dt,E(t)),w(t,"_velocityOvertimeModule",ft,E(t)),w(t,"_forceOvertimeModule",pt,E(t)),w(t,"_limitVelocityOvertimeModule",mt,E(t)),w(t,"_rotationOvertimeModule",yt,E(t)),w(t,"_textureAnimationModule",gt,E(t)),w(t,"_trailModule",vt,E(t)),w(t,"_renderMode",bt,E(t)),w(t,"_velocityScale",xt,E(t)),w(t,"_lengthScale",At,E(t)),w(t,"_mesh",Ct,E(t)),t._isPlaying=void 0,t._isPaused=void 0,t._isStopped=void 0,t._isEmitting=void 0,t._time=void 0,t._emitRateTimeCounter=void 0,t._emitRateDistanceCounter=void 0,t._oldWPos=void 0,t._curWPos=void 0,t._customData1=void 0,t._customData2=void 0,t._subEmitters=void 0,t.rateOverTime.constant=10,t.startLifetime.constant=5,t.startSize.constant=1,t.startSpeed.constant=5,t._isPlaying=!1,t._isPaused=!1,t._isStopped=!0,t._isEmitting=!1,t._time=0,t._emitRateTimeCounter=0,t._emitRateDistanceCounter=0,t._oldWPos=new v.Vec3(0,0,0),t._curWPos=new v.Vec3(0,0,0),t._customData1=new v.Vec2(0,0),t._customData2=new v.Vec2(0,0),t._subEmitters=[],t}e.default=t,cc.ParticleSystem3D=t,F.exports=e.default},{"../../assets/material/CCMaterial":95,"../../components/CCRenderComponent":131,"../../mesh/CCMesh":197,"../../platform/CCClassDecorator":231,"../../value-types":330,"../../value-types/utils":337,"./animator/color-overtime":30,"./animator/curve-range":31,"./animator/force-overtime":32,"./animator/gradient-range":33,"./animator/limit-velocity-overtime":35,"./animator/rotation-overtime":36,"./animator/size-overtime":37,"./animator/texture-animation":38,"./animator/velocity-overtime":39,"./burst":40,"./emitter/shape-module":42,"./enum":43,"./particle-general-function":44,"./renderer/trail":49}],46:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../../value-types");i.default=function(t){this.particleSystem=null,this.position=null,this.velocity=null,this.animatedVelocity=null,this.ultimateVelocity=null,this.angularVelocity=null,this.axisOfRotation=null,this.rotation=null,this.startSize=null,this.size=null,this.startColor=null,this.color=cc.Color.WHITE,this.randomSeed=null,this.remainingLifetime=null,this.startLifetime=null,this.emitAccumulator0=null,this.emitAccumulator1=null,this.frameIndex=null,this.particleSystem=t,this.position=new n.Vec3(0,0,0),this.velocity=new n.Vec3(0,0,0),this.animatedVelocity=new n.Vec3(0,0,0),this.ultimateVelocity=new n.Vec3(0,0,0),this.angularVelocity=new n.Vec3(0,0,0),this.axisOfRotation=new n.Vec3(0,0,0),this.rotation=new n.Vec3(0,0,0),this.startSize=new n.Vec3(0,0,0),this.size=new n.Vec3(0,0,0),this.startColor=cc.Color.WHITE.clone(),this.color=cc.Color.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0},e.exports=i.default},{"../../value-types":330}],47:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var d=n(t("../../../../renderer/gfx")),f=n(t("../../../../renderer/core/input-assembler")),p=t("../../../mesh/mesh-data");function n(t){return t&&t.__esModule?t:{default:t}}var m=t("../../../renderer");function r(){this._capacity=0,this._vertFormat=null,this._vertAttrsFloatCount=0,this._mesh=null,this._vertCount=0,this._indexCount=0,this._material=null,this._capacity=0,this._vertFormat=null,this._vertAttrsFloatCount=0,this._mesh=null,this._subDatas=[],this._subMeshes=[]}(t=r.prototype).setCapacity=function(t){var e=this._capacity!==t;this._capacity=t,this._inited&&e&&this._recreateBuffer()},t.setVertexAttributes=function(t,e){this._mesh===t&&this._vertFormat===e||(this._mesh=t,this._vertFormat=e,this._vertAttrsFloatCount=this._vertFormat._bytes/4,this._createParticleData(),this._inited=!0)},t._recreateBuffer=function(){this._createParticleData()},t._createParticleData=function(){this.destroyIAData(),this._vertCount=4,this._indexCount=6;var t=null,e=null,i=this._vertFormat._bytes;if(this._mesh){var n=this._mesh._subDatas[0],n=(this._vertCount=n.vData.byteLength/n.vfm._bytes,this._indexCount=n.iData.byteLength/2,t=new Float32Array(i*this._capacity*this._vertCount/4),e=new Uint16Array(this._capacity*this._indexCount),this._vertFormat.element(d.default.ATTR_TEX_COORD3)),r=this._vertFormat.element(d.default.ATTR_NORMAL),s=this._vertFormat.element(d.default.ATTR_TEX_COORD),a=this._vertFormat.element(d.default.ATTR_COLOR1);if(this._mesh.copyAttribute(0,d.default.ATTR_POSITION,t.buffer,i,n.offset),this._mesh.copyAttribute(0,d.default.ATTR_NORMAL,t.buffer,i,r.offset),this._mesh.copyAttribute(0,d.default.ATTR_UV0,t.buffer,i,s.offset),!this._mesh.copyAttribute(0,d.default.ATTR_COLOR,t.buffer,i,a.offset))for(var o=new Uint32Array(t.buffer),l=0;l<this._vertCount;++l)o[l*this._vertAttrsFloatCount+a.offset/4]=cc.Color.WHITE._val;for(var h=new Float32Array(t.buffer),l=1;l<this._capacity;l++)h.copyWithin(l*i*this._vertCount/4,0,i*this._vertCount/4);for(this._mesh.copyIndices(0,e),l=1;l<this._capacity;l++)for(var c=0;c<this._indexCount;c++)e[l*this._indexCount+c]=e[c]+l*this._vertCount}else{var t=new Float32Array(i*this._capacity*this._vertCount/4),e=new Uint16Array(this._capacity*this._indexCount),u=0;for(l=0;l<this._capacity;++l){var _=4*l;e[u++]=_,e[u++]=1+_,e[u++]=2+_,e[u++]=3+_,e[u++]=2+_,e[u++]=1+_}}n=new p.MeshData,n.vData=t,n.iData=e,n.vfm=this._vertFormat,n.vDirty=!0,n.iDirty=!0,n.enable=!0,this._subDatas[0]=n,r=new d.default.VertexBuffer(m.device,this._vertFormat,d.default.USAGE_DYNAMIC,t),s=new d.default.IndexBuffer(m.device,d.default.INDEX_FMT_UINT16,d.default.USAGE_STATIC,e,e.length);this._subMeshes[0]=new f.default(r,s)},t.createTrailData=function(t,e){var i,n,r;this._subDatas[1]||(i=t._bytes,i=new ArrayBuffer(i*(e+1)*2),n=new Uint16Array(6*e),(r=new p.MeshData).vData=new Float32Array(i),r.iData=n,r.vfm=t,r.vDirty=!0,r.iDirty=!0,r.enable=!0,this._subDatas[1]=r,r=new d.default.VertexBuffer(m.device,t,d.default.USAGE_DYNAMIC,i),t=new d.default.IndexBuffer(m.device,d.default.INDEX_FMT_UINT16,d.default.USAGE_DYNAMIC,n,6*e),this._subMeshes[1]=new f.default(r,t))},t.setModelMaterial=function(t){this._material=t},t.addParticleVertexData=function(t,e){var i=this._subDatas[0],n=i.getVData(),r=i.getVData(Uint32Array);if(this._mesh)for(var s=0;s<this._vertCount;s++){var a=(t*this._vertCount+s)*this._vertAttrsFloatCount;n[a++]=e[0].x,n[a++]=e[0].y,n[a++]=e[0].z,a+=2,n[a++]=e[1].z,n[a++]=e[2].x,n[a++]=e[2].y,n[a++]=e[2].z,n[a++]=e[3].x,n[a++]=e[3].y,n[a++]=e[3].z,r[+a]=e[4]}else{i=t*this._vertAttrsFloatCount;n[i++]=e[0].x,n[i++]=e[0].y,n[i++]=e[0].z,n[i++]=e[1].x,n[i++]=e[1].y,n[i++]=e[1].z,n[i++]=e[2].x,n[i++]=e[2].y,n[i++]=e[2].z,n[i++]=e[3].x,n[i++]=e[3].y,n[i++]=e[3].z,r[i++]=e[4],e[5]&&(n[i++]=e[5].x,n[i++]=e[5].y,n[+i]=e[5].z)}},t._uploadData=function(){for(var t=this._subDatas,e=this._subMeshes,i=0,n=t.length;i<n;i++){var r,s,a=t[i],o=e[i];a.vDirty&&(r=o._vertexBuffer,s=a.vData,r.update(0,s),a.vDirty=!1),a.iDirty&&(r=o._indexBuffer,s=a.iData,r.update(0,s),a.iDirty=!1)}},t.updateIA=function(t,e,i,n){this._subMeshes[t]._count=e;e=this._subDatas[t];e.vDirty=i,e.iDirty=n},t.clear=function(){var t=this._subMeshes[0];t&&(t.indexCount=0)},t.destroy=function(){this._subDatas.length=0;for(var t=this._subMeshes,e=0,i=t.length;e<i;e++){var n=t[e]._vertexBuffer,n=(n&&n.destroy(),t[e]._indexBuffer);n&&n.destroy()}t.length=0},t.destroyIAData=function(){this._subMeshes[0]&&(this._subMeshes[0]._vertexBuffer.destroy(),this._subMeshes[0]._indexBuffer.destroy(),this._subMeshes[0]=null),this._subDatas[0]=null},i.default=r,e.exports=i.default},{"../../../../renderer/core/input-assembler":353,"../../../../renderer/gfx":363,"../../../mesh/mesh-data":200,"../../../renderer":262}],48:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../../../value-types"),r=_(t("../../../../renderer/gfx")),s=_(t("./particle-batch-model")),a=_(t("../../../assets/material/material-variant")),o=_(t("../../../../renderer/memop/recycle-pool")),l=t("../enum"),h=_(t("../particle")),c=_(t("../../../renderer/assembler")),u=_(t("../particle-system-3d"));function _(t){return t&&t.__esModule?t:{default:t}}var d,t=t("../../../platform/CCClassDecorator"),f=t.ccclass,p=(t.property,new n.Vec3),m=(new n.Vec2,new n.Vec4,new n.Mat4),y=[0,0,1,0,0,1,1,1],g=new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD1,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD2,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_COLOR,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]),v=(g.name="vfmtNormal",new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD1,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD2,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_COLOR,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:r.default.ATTR_COLOR1,type:r.default.ATTR_TYPE_FLOAT32,num:3}])),b=(v.name="vfmtStretch",new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD1,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_TEX_COORD2,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_COLOR,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:r.default.ATTR_TEX_COORD3,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_NORMAL,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_COLOR1,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0}])),t=(b.name="vfmtMesh",f("cc.ParticleSystem3DAssembler")((d=c.default,t=d,(r=x).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,(r=x.prototype).onInit=function(t){var e=this;this._particleSystem=t,this._particles=new o.default(function(){return new h.default(e)},16),this._setVertexAttrib(),this.onEnable(),this._updateModel(),this._updateMaterialParams(),this._updateTrailMaterial()},r.onEnable=function(){this._particleSystem&&(null==this._model&&(this._model=new s.default),this._model.inited||this._model.setCapacity(this._particleSystem.capacity),this._model.enabled=this._particleSystem.enabledInHierarchy)},r.onDisable=function(){this._model&&(this._model.enabled=this._particleSystem.enabledInHierarchy)},r.onDestroy=function(){this._model=null},r.clear=function(){this._particles.reset(),this.updateParticleBuffer()},r._getFreeParticle=function(){return this._particles.length>=this._particleSystem.capacity?null:this._particles.add()},r._setNewParticle=function(t){},r._updateParticles=function(t){switch(this._particleSystem.node.getWorldMatrix(m),this._particleSystem.scaleSpace){case l.Space.Local:this._particleSystem.node.getScale(this._node_scale);break;case l.Space.World:this._particleSystem.node.getWorldScale(this._node_scale)}(this._particleSystem.materials[0]?this._particleSystem.particleMaterial:this._defaultMat).setProperty("scale",this._node_scale),this._particleSystem.velocityOvertimeModule.enable&&this._particleSystem.velocityOvertimeModule.update(this._particleSystem._simulationSpace,m),this._particleSystem.forceOvertimeModule.enable&&this._particleSystem.forceOvertimeModule.update(this._particleSystem._simulationSpace,m),this._particleSystem.trailModule.enable&&this._particleSystem.trailModule.update();for(var e=0;e<this._particles.length;++e){var i=this._particles.data[e];i.remainingLifetime-=t,n.Vec3.set(i.animatedVelocity,0,0,0),i.remainingLifetime<0?(this._particleSystem.trailModule.enable&&this._particleSystem.trailModule.removeParticle(i),this._particles.remove(e),--e):(i.velocity.y-=9.8*this._particleSystem.gravityModifier.evaluate(1-i.remainingLifetime/i.startLifetime,i.randomSeed)*t,this._particleSystem.sizeOvertimeModule.enable&&this._particleSystem.sizeOvertimeModule.animate(i),this._particleSystem.colorOverLifetimeModule.enable&&this._particleSystem.colorOverLifetimeModule.animate(i),this._particleSystem.forceOvertimeModule.enable&&this._particleSystem.forceOvertimeModule.animate(i,t),this._particleSystem.velocityOvertimeModule.enable?this._particleSystem.velocityOvertimeModule.animate(i):n.Vec3.copy(i.ultimateVelocity,i.velocity),this._particleSystem.limitVelocityOvertimeModule.enable&&this._particleSystem.limitVelocityOvertimeModule.animate(i),this._particleSystem.rotationOvertimeModule.enable&&this._particleSystem.rotationOvertimeModule.animate(i,t),this._particleSystem.textureAnimationModule.enable&&this._particleSystem.textureAnimationModule.animate(i),n.Vec3.scaleAndAdd(i.position,i.position,i.ultimateVelocity,t),this._particleSystem.trailModule.enable&&this._particleSystem.trailModule.animate(i,t))}return this._particles.length},r.updateParticleBuffer=function(){for(var t=0,e=this._particleSystem.renderMode===l.RenderMode.StrecthedBillboard,i=0;i<this._particles.length;++i){var n=this._particles.data[i],r=0,s=(this._particleSystem.textureAnimationModule.enable&&(r=n.frameIndex),t=4*i,0);if(this._particleSystem.renderMode!==l.RenderMode.Mesh)for(var a=0;a<4;++a)s=0,this.attrs[s++]=n.position,p.x=y[2*a],p.y=y[2*a+1],p.z=r,this.attrs[s++]=p,this.attrs[s++]=n.size,this.attrs[s++]=n.rotation,this.attrs[s++]=n.color._val,this.attrs[s++]=e?n.ultimateVelocity:null,this._model.addParticleVertexData(t++,this.attrs);else s=0,this.attrs[s++]=n.position,p.z=r,this.attrs[s++]=p,this.attrs[s++]=n.size,this.attrs[s++]=n.rotation,this.attrs[s++]=n.color._val,this._model.addParticleVertexData(i,this.attrs)}this.updateIA(0,this._particles.length*this._model._indexCount,!0)},r.updateShaderUniform=function(){},r.updateIA=function(t,e,i,n){this._model&&this._model.updateIA(t,e,i,n)},r.getParticleCount=function(){return this._particles.data.length},r._onMaterialModified=function(t,e){0===t?(this._updateModel(),this._updateMaterialParams()):this._updateTrailMaterial()},r._onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setModelMaterial(e),this._particleSystem.trailModule._trailModel&&1===t&&this._particleSystem.trailModule._trailModel.setModelMaterial(e)},r._ensureLoadMesh=function(){this._particleSystem.mesh&&!this._particleSystem.mesh.loaded&&postLoadMesh(this._particleSystem.mesh)},r.setCapacity=function(t){this._model&&this._model.setCapacity(t)},r._setVertexAttrib=function(){switch(this._particleSystem.renderMode){case l.RenderMode.StrecthedBillboard:this._vertFormat=v;break;case l.RenderMode.Mesh:this._vertFormat=b;break;default:this._vertFormat=g}},r._updateMaterialParams=function(){var t;this._particleSystem&&(t=(t=null==(t=this._particleSystem.materials[0])&&null==this._defaultMat?this._defaultMat=a.default.createWithBuiltin("3d-particle",this):a.default.create(t,this._particleSystem))||this._defaultMat,this._particleSystem._simulationSpace===l.Space.World?t.define("CC_USE_WORLD_SPACE",!0):t.define("CC_USE_WORLD_SPACE",!1),this._particleSystem.renderMode===l.RenderMode.Billboard?(t.define("CC_USE_BILLBOARD",!0),t.define("CC_USE_STRETCHED_BILLBOARD",!1),t.define("CC_USE_HORIZONTAL_BILLBOARD",!1),t.define("CC_USE_VERTICAL_BILLBOARD",!1),t.define("CC_USE_MESH",!1)):this._particleSystem.renderMode===l.RenderMode.StrecthedBillboard?(t.define("CC_USE_BILLBOARD",!1),t.define("CC_USE_STRETCHED_BILLBOARD",!0),t.define("CC_USE_HORIZONTAL_BILLBOARD",!1),t.define("CC_USE_VERTICAL_BILLBOARD",!1),t.define("CC_USE_MESH",!1),this.frameTile_velLenScale.z=this._particleSystem.velocityScale,this.frameTile_velLenScale.w=this._particleSystem.lengthScale):this._particleSystem.renderMode===l.RenderMode.HorizontalBillboard?(t.define("CC_USE_BILLBOARD",!1),t.define("CC_USE_STRETCHED_BILLBOARD",!1),t.define("CC_USE_HORIZONTAL_BILLBOARD",!0),t.define("CC_USE_VERTICAL_BILLBOARD",!1),t.define("CC_USE_MESH",!1)):this._particleSystem.renderMode===l.RenderMode.VerticalBillboard?(t.define("CC_USE_BILLBOARD",!1),t.define("CC_USE_STRETCHED_BILLBOARD",!1),t.define("CC_USE_HORIZONTAL_BILLBOARD",!1),t.define("CC_USE_VERTICAL_BILLBOARD",!0),t.define("CC_USE_MESH",!1)):this._particleSystem.renderMode===l.RenderMode.Mesh?(t.define("CC_USE_BILLBOARD",!1),t.define("CC_USE_STRETCHED_BILLBOARD",!1),t.define("CC_USE_HORIZONTAL_BILLBOARD",!1),t.define("CC_USE_VERTICAL_BILLBOARD",!1),t.define("CC_USE_MESH",!0)):console.warn("particle system renderMode "+this._particleSystem.renderMode+" not support."),this._particleSystem.textureAnimationModule.enable&&n.Vec2.set(this.frameTile_velLenScale,this._particleSystem.textureAnimationModule.numTilesX,this._particleSystem.textureAnimationModule.numTilesY),t.setProperty("frameTile_velLenScale",this.frameTile_velLenScale),this._particleSystem.setMaterial(0,t))},r._updateTrailMaterial=function(){var t=this._particleSystem.trailMaterial;this._particleSystem.trailModule.enable&&(null===t&&null===this._defaultTrailMat&&(this._defaultTrailMat=a.default.createWithBuiltin("3d-trail",this)),null===t&&(t=this._defaultTrailMat,this._particleSystem.trailMaterial=t),this._particleSystem._simulationSpace===l.Space.World||this._particleSystem.trailModule.space===l.Space.World?t.define("CC_USE_WORLD_SPACE",!0):t.define("CC_USE_WORLD_SPACE",!1),this._particleSystem.trailModule._updateMaterial())},r._updateTrailEnable=function(t){var e;this._model&&(e=this._model._subDatas[1])&&(e.enable=t)},r._updateModel=function(){this._model&&this._model.setVertexAttributes(this._particleSystem.renderMode===l.RenderMode.Mesh?this._particleSystem.mesh:null,this._vertFormat)},r.setVertexAttributes=function(t,e){this._model&&this._model.setVertexAttributes(t,e)},r.fillBuffers=function(t,e){if(this._model){this._model._uploadData();var i=this._model._subMeshes,n=this._model._subDatas,r=t.materials;e._flush();for(var s=0,a=i.length;s<a;s++){var o=i[s],l=n[s],h=r[s];l.enable&&(e.material=h,e.cullingMask=t.node._cullingMask,e.node=t.node,e._flushIA(o))}}},f=x))||f);function x(){var t;return(t=d.call(this)||this)._defines=null,t._trailDefines=null,t._model=null,t.frameTile_velLenScale=null,t.attrs=[],t._vertFormat=[],t._particleSystem=null,t._particles=null,t._defaultMat=null,t._isAssetReady=!1,t._defaultTrailMat=null,t._customProperties=null,t._node_scale=null,t._model=null,t.frameTile_velLenScale=cc.v4(1,1,0,0),t._node_scale=cc.v4(),t.attrs=new Array(5),t._trailDefines={CC_USE_WORLD_SPACE:!0},t}i.default=t,Object.assign(t,{uv:y}),c.default.register(u.default,t),e.exports=i.default},{"../../../../renderer/gfx":363,"../../../../renderer/memop/recycle-pool":378,"../../../assets/material/material-variant":102,"../../../platform/CCClassDecorator":231,"../../../renderer/assembler":259,"../../../value-types":330,"../enum":43,"../particle":46,"../particle-system-3d":45,"./particle-batch-model":47}],49:[function(t,F,e){"use strict";e.__esModule=!0,e.default=void 0;var i,n,r,s,a,o,l,h,c,u,_,d,f,p,m,y,g,V,N,v=t("../../../platform/CCClassDecorator"),b=t("../../../value-types"),x=S(t("../../../../renderer/gfx")),k=S(t("../../../../renderer/memop/pool")),A=S(t("../animator/curve-range")),C=S(t("../animator/gradient-range")),T=t("../enum"),z=S(t("../utils"));function S(t){return t&&t.__esModule?t:{default:t}}function G(t){var e=0;if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator])return(e=t[Symbol.iterator]()).next.bind(e);if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return U(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?U(t,e):void 0}}(t)))return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function w(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function j(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function E(i,n,t,e,r){var s={};return Object.keys(e).forEach(function(t){s[t]=e[t]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(t,e){return e(i,n,t)||t},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,n,s),s=null),s}var M,W=Math.cos((0,b.toRadian)(100)),D={position:cc.v3(),velocity:cc.v3()},H=cc.quat(),B=cc.mat4(),I=cc.v3(),P=cc.v3(),R=cc.color(),X=((t=Y.prototype).getElement=function(t){return-1===this.start?null:((t=t<0?(t+this.trailElements.length)%this.trailElements.length:t)>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])},t.addElement=function(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:cc.v3(),lifetime:0,width:0,velocity:cc.v3(),direction:0,color:cc.color()}),this.start++,this.start%=this.trailElements.length);var t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]},t.iterateElement=function(t,e,i,n){for(var r=this.start>=this.end?this.end+this.trailElements.length:this.end,s=this.start;s<r;s++)e(t,this.trailElements[s%this.trailElements.length],i,n)&&(this.start++,this.start%=this.trailElements.length);this.start===r&&(this.start=-1,this.end=-1)},t.count=function(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start},t.clear=function(){this.start=-1,this.end=-1},Y),O=(t=(0,v.ccclass)("cc.TrailModule"),i=(0,v.property)({type:T.TrailMode}),n=(0,v.property)({type:A.default}),r=(0,v.property)({type:T.Space}),s=(0,v.property)({type:T.TextureMode}),a=(0,v.property)({type:A.default}),o=(0,v.property)({type:C.default}),l=(0,v.property)({type:C.default}),t((h=E((t=L,(O=[{key:"enable",get:function(){return this._enable},set:function(t){t&&this._createTrailData(),t&&!this._enable&&(this._enable=t,this._particleSystem._assembler._updateTrailMaterial()),this._enable=t,this._particleSystem._assembler._updateTrailEnable(this._enable)}},{key:"minParticleDistance",get:function(){return this._minParticleDistance},set:function(t){this._minParticleDistance=t,this._minSquaredDistance=t*t}},{key:"space",get:function(){return this._space},set:function(t){this._space=t,this._particleSystem&&this._particleSystem._assembler._updateTrailMaterial()}}])&&j(t.prototype,O),M&&j(t,M),(O=L.prototype).onInit=function(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;for(var e,i=0,n=G(t.bursts);!(e=n()).done;)i+=e.value.getMaxCount(t);this.lifeTime.constant=1,this._trailNum=Math.ceil(t.startLifetime.getMax()*this.lifeTime.getMax()*60*(t.rateOverTime.getMax()*t.duration+i)),this._trailSegments=new k.default(function(){return new X(10)},Math.ceil(t.rateOverTime.getMax()*t.duration)),this._enable&&(this.enable=this._enable,this._updateMaterial())},O.onEnable=function(){},O.onDisable=function(){},O.destroy=function(){this._trailSegments&&(this._trailSegments.clear(function(t){t.trailElements.length=0}),this._trailSegments=null)},O.clear=function(){if(this.enable){for(var t=this._particleTrail.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this._particleTrail.clear(),this.updateTrailBuffer()}},O._createTrailData=function(){var t=this._particleSystem._assembler._model;t&&(t.createTrailData(this._gfxVFmt,this._trailNum),t=t._subDatas[1],this._vbF32=t.getVData(),this._vbUint32=t.getVData(Uint32Array),this._iBuffer=t.iData)},O._updateMaterial=function(){var t;this._particleSystem&&(t=this._particleSystem.trailMaterial,this._material=t||this._particleSystem._assembler._defaultTrailMat)},O.update=function(){this._trailLifetime=this.lifeTime.evaluate(this._particleSystem._time,1),this.space===T.Space.World&&this._particleSystem._simulationSpace===T.Space.Local?(this._needTransform=!0,this._particleSystem.node.getWorldMatrix(B),this._particleSystem.node.getWorldRotation(H)):this._needTransform=!1},O.animate=function(t,e){if(this._trailSegments){var i=this._particleTrail.get(t);if(!i)return i=this._trailSegments.alloc(),void this._particleTrail.set(t,i);var n,r=i.getElement(i.end-1);this._needTransform?b.Vec3.transformMat4(I,t.position,B):b.Vec3.copy(I,t.position),r&&(i.iterateElement(this,this._updateTrailElement,t,e),b.Vec3.squaredDistance(r.position,I)<this._minSquaredDistance)||!(r=i.addElement())||(b.Vec3.copy(r.position,I),r.lifetime=0,this.widthFromParticle?r.width=t.size.x*this.widthRatio.evaluate(0,1):r.width=this.widthRatio.evaluate(0,1),2===(e=i.count())?(n=i.getElement(i.end-2),b.Vec3.subtract(n.velocity,r.position,n.position)):2<e&&(n=i.getElement(i.end-2),e=i.getElement(i.end-3),b.Vec3.subtract(I,e.position,n.position),b.Vec3.subtract(P,r.position,n.position),b.Vec3.subtract(n.velocity,P,I),b.Vec3.equals(cc.Vec3.ZERO,n.velocity)&&b.Vec3.copy(n.velocity,I)),this.colorFromParticle?r.color.set(t.color):r.color.set(this.colorOvertime.evaluate(0,1)))}},O._updateTrailElement=function(t,e,i,n){return e.lifetime+=n,t.colorFromParticle?(e.color.set(i.color),e.color.multiply(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1))):e.color.set(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1)),t.widthFromParticle?e.width=i.size.x*t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1):e.width=t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1),e.lifetime>t._trailLifetime},O.removeParticle=function(t){var e=this._particleTrail.get(t);e&&this._trailSegments&&(e.clear(),this._trailSegments.free(e),this._particleTrail.delete(t))},O.updateTrailBuffer=function(){this.vbOffset=0,this.ibOffset=0;for(var t=G(this._particleTrail.keys());!(e=t()).done;){var e=e.value,i=this._particleTrail.get(e);if(-1!==i.start){var n=4*this.vbOffset/this._vertSize,r=i.start>=i.end?i.end+i.trailElements.length:i.end,s=r-i.start,a=1/s,o=i.trailElements[i.start];this._fillVertexBuffer(o,this.colorOverTrail.evaluate(1,1),n,1,0,4);for(var l,h=i.start+1;h<r;h++){var c=i.trailElements[h%i.trailElements.length],u=h-i.start;this._fillVertexBuffer(c,this.colorOverTrail.evaluate(1-u/s,1),n,1-u*a,u,5)}this._needTransform?b.Vec3.transformMat4(D.position,e.position,B):b.Vec3.copy(D.position,e.position),1==s||2==s?(o=i.getElement(i.end-1),b.Vec3.subtract(o.velocity,D.position,o.position),this._vbF32[this.vbOffset-this._vertSize/4-4]=o.velocity.x,this._vbF32[this.vbOffset-this._vertSize/4-3]=o.velocity.y,this._vbF32[this.vbOffset-this._vertSize/4-2]=o.velocity.z,this._vbF32[this.vbOffset-4]=o.velocity.x,this._vbF32[this.vbOffset-3]=o.velocity.y,this._vbF32[this.vbOffset-2]=o.velocity.z,b.Vec3.subtract(D.velocity,D.position,o.position),this._checkDirectionReverse(D,o)):2<s&&(o=i.getElement(i.end-1),l=i.getElement(i.end-2),b.Vec3.subtract(I,l.position,o.position),b.Vec3.subtract(P,D.position,o.position),b.Vec3.normalize(I,I),b.Vec3.normalize(P,P),b.Vec3.subtract(o.velocity,P,I),b.Vec3.normalize(o.velocity,o.velocity),this._checkDirectionReverse(o,l),this.vbOffset-=this._vertSize/4*2,this.ibOffset-=6,this._fillVertexBuffer(o,this.colorOverTrail.evaluate(a,1),n,a,s-1,5),b.Vec3.subtract(D.velocity,D.position,o.position),b.Vec3.normalize(D.velocity,D.velocity),this._checkDirectionReverse(D,o)),this.widthFromParticle?D.width=e.size.x*this.widthRatio.evaluate(0,1):D.width=this.widthRatio.evaluate(0,1),D.color=e.color,b.Vec3.equals(D.velocity,cc.Vec3.ZERO)?this.ibOffset-=3:this._fillVertexBuffer(D,this.colorOverTrail.evaluate(0,1),n,0,s,1)}}this._updateIA(this.ibOffset)},O._fillVertexBuffer=function(t,e,i,n,r,s){this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=n,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,R.set(t.color),R.multiply(e),this._vbUint32[this.vbOffset++]=R._val,this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=n,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,this._vbUint32[this.vbOffset++]=R._val,1&s&&(this._iBuffer[this.ibOffset++]=i+2*r,this._iBuffer[this.ibOffset++]=i+2*r-1,this._iBuffer[this.ibOffset++]=i+2*r+1),4&s&&(this._iBuffer[this.ibOffset++]=i+2*r,this._iBuffer[this.ibOffset++]=i+2*r+1,this._iBuffer[this.ibOffset++]=i+2*r+2)},O._updateIA=function(t){this._particleSystem&&this._particleSystem._assembler&&this._particleSystem._assembler.updateIA(1,t,!0,!0)},O._checkDirectionReverse=function(t,e){b.Vec3.dot(t.velocity,e.velocity)<W?t.direction=1-e.direction:t.direction=e.direction},t=L).prototype,"_enable",[v.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),E(t.prototype,"enable",[v.property],Object.getOwnPropertyDescriptor(t.prototype,"enable"),t.prototype),c=E(t.prototype,"mode",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T.TrailMode.Particles}}),u=E(t.prototype,"lifeTime",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new A.default}}),_=E(t.prototype,"_minParticleDistance",[v.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),E(t.prototype,"minParticleDistance",[v.property],Object.getOwnPropertyDescriptor(t.prototype,"minParticleDistance"),t.prototype),d=E(t.prototype,"_space",[v.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T.Space.World}}),E(t.prototype,"space",[r],Object.getOwnPropertyDescriptor(t.prototype,"space"),t.prototype),f=E(t.prototype,"existWithParticles",[v.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),p=E(t.prototype,"textureMode",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T.TextureMode.Stretch}}),m=E(t.prototype,"widthFromParticle",[v.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),y=E(t.prototype,"widthRatio",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new A.default}}),g=E(t.prototype,"colorFromParticle",[v.property],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),V=E(t.prototype,"colorOverTrail",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C.default}}),N=E(t.prototype,"colorOvertime",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C.default}}),M=t))||M);function L(){w(this,"_enable",h,this),w(this,"mode",c,this),w(this,"lifeTime",u,this),w(this,"_minParticleDistance",_,this),w(this,"_space",d,this),w(this,"existWithParticles",f,this),w(this,"textureMode",p,this),w(this,"widthFromParticle",m,this),w(this,"widthRatio",y,this),w(this,"colorFromParticle",g,this),w(this,"colorOverTrail",V,this),w(this,"colorOvertime",N,this),this._particleSystem=null,this._minSquaredDistance=0,this._vertSize=0,this._trailNum=0,this._trailLifetime=0,this.vbOffset=0,this.ibOffset=0,this._trailSegments=null,this._particleTrail=null,this._ia=null,this._gfxVFmt=null,this._vbF32=null,this._vbUint32=null,this._iBuffer=null,this._needTransform=null,this._defaultMat=null,this._material=null,this._gfxVFmt=new x.default.VertexFormat([{name:x.default.ATTR_POSITION,type:x.default.ATTR_TYPE_FLOAT32,num:3},{name:x.default.ATTR_TEX_COORD,type:x.default.ATTR_TYPE_FLOAT32,num:4},{name:x.default.ATTR_TEX_COORD1,type:x.default.ATTR_TYPE_FLOAT32,num:3},{name:x.default.ATTR_COLOR,type:x.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]),this._vertSize=this._gfxVFmt._bytes,this._particleTrail=new z.default}function Y(t){for(this.start=void 0,this.end=void 0,this.trailElements=[],this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:cc.v3(),lifetime:0,width:0,velocity:cc.v3(),direction:0,color:cc.color()})}e.default=O,F.exports=e.default},{"../../../../renderer/gfx":363,"../../../../renderer/memop/pool":377,"../../../platform/CCClassDecorator":231,"../../../value-types":330,"../animator/curve-range":31,"../animator/gradient-range":33,"../enum":43,"../utils":50}],50:[function(t,e,i){"use strict";var n;function r(t){this.datas=[],t=t||[],this.datas=[];var e=this;t.forEach(function(t){e.has(t[0])||e.datas.push({key:t[0],value:t[1]})})}i.__esModule=!0,i.default=void 0,Object.is||(Object.is=function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}),(n=r.prototype).size=function(){return this.datas.length},n.set=function(t,e){this.delete(t),this.datas.push({key:t,value:e})},n.get=function(t){for(var e=void 0,i=this.datas,n=0,r=i.length;n<r;n++)if(Object.is(t,i[n].key)){e=i[n].value;break}return e},n.has=function(t){for(var e=!1,i=this.datas,n=0,r=i.length;n<r;n++)if(Object.is(t,i[n].key)){e=!0;break}return e},n.clear=function(){this.datas.length=0},n.delete=function(t){for(var e=!1,i=this.datas,n=0,r=i.length;n<r;n++)if(Object.is(t,i[n].key)){i.splice(n,1),e=!0;break}return e},n.keys=function(){for(var t=this.datas,e=[],i=0,n=t.length;i<n;i++)e.push(t[i].key);return e},n.values=function(){var t=0,e=this.datas;return{next:function(){return 0===e.length||void 0===e[t]?{value:void 0,done:!0}:{value:e[t++].value,done:!1}}}},i.default=r,e.exports=i.default},{}],51:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e,i,n){var r=(n=void 0===n?{widthSegments:1,heightSegments:1,lengthSegments:1,invWinding:!1}:n).widthSegments,s=n.heightSegments,a=n.lengthSegments,_=n.invWinding,n=.5*(t=void 0===t?1:t),t=.5*(e=void 0===e?1:e),e=.5*(i=void 0===i?1:i),d=[b.default.set(c,-n,-t,e),b.default.set(u,n,-t,e),b.default.set(S,n,t,e),b.default.set(w,-n,t,e),b.default.set(E,n,-t,-e),b.default.set(M,-n,-t,-e),b.default.set(D,-n,t,-e),b.default.set(B,n,t,-e)],f=[[2,3,1],[4,5,7],[7,6,2],[1,0,4],[1,4,2],[5,0,6]],p=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],m=[],y=[],g=[],v=[],i=new b.default(-n,-t,-e),o=new b.default(n,t,e),n=Math.sqrt(n*n+t*t+e*e);function l(t,e,i){for(var n,r=m.length/3,s=f[t],a=p[t],o=0;o<=i;o++)for(n=0;n<=e;n++){var l,h,c,u=o/i;b.default.lerp(x,d[s[0]],d[s[1]],c=n/e),b.default.lerp(A,d[s[0]],d[s[2]],u),b.default.subtract(C,A,d[s[0]]),b.default.add(T,x,C),m.push(T.x,T.y,T.z),y.push(a[0],a[1],a[2]),g.push(c,u),n<e&&o<i&&(u=n+o*(c=e+1),l=n+(o+1)*c,h=n+1+(o+1)*c,c=n+1+o*c,_?(v.push(r+u,r+l,r+c),v.push(r+c,r+l,r+h)):(v.push(r+u,r+c,r+l),v.push(r+l,r+c,r+h)))}}return l(0,r,s),l(4,a,s),l(1,r,s),l(5,a,s),l(3,r,a),l(2,r,a),new h.default(m,y,g,v,i,o,n)};var b=n(t("../../value-types/vec3")),h=n(t("./vertex-data"));function n(t){return t&&t.__esModule?t:{default:t}}var x=new b.default,A=new b.default,C=new b.default,T=new b.default,c=new b.default,u=new b.default,S=new b.default,w=new b.default,E=new b.default,M=new b.default,D=new b.default,B=new b.default;e.exports=i.default},{"../../value-types/vec3":340,"./vertex-data":62}],52:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e,i,n){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=2),void 0===n&&(n={sides:32,heightSegments:32,arc:2*Math.PI});for(var r=i-t-e,s=n.sides,a=n.heightSegments,o=e/i,F=r/i,V=t/i,l=Math.floor(a*o),h=Math.floor(a*V),c=Math.floor(a*F),N=r+e-i/2,k=e-i/2,z=e-i/2,G=n.arc,u=[],_=[],d=[],f=[],n=Math.max(t,e),U=cc.v3(-n,-i/2,-n),n=cc.v3(n,i/2,n),i=i/2,p=0,m=[],y=0;y<=l;++y)for(var j=y*Math.PI/l/2,W=Math.sin(j),H=-Math.cos(j),g=0;g<=s;++g){var v=2*g*Math.PI/s-Math.PI/2,b=Math.sin(v)*W,x=H,v=Math.cos(v)*W,A=g/s,X=y/a;u.push(b*e,x*e+z,v*e),_.push(b,x,v),d.push(A,X),y<l&&g<s&&(v=(x=(b=s+1)*(y+1)+g)+1,f.push(b*y+g,A=b*y+g+1,x),f.push(A,v,x)),++p}for(var Y=(t-e)/r,C=0;C<=c;C++){for(var q=[],T=C/c,J=T*(t-e)+e,S=0;S<=s;++S){var Z=S/s,K=T*F+o,w=Z*G-G/4,Q=Math.sin(w),w=Math.cos(w);u.push(J*Q),u.push(T*r+k),u.push(J*w),at.default.normalize(lt,at.default.set(ht,Q,-Y,w)),_.push(lt.x),_.push(lt.y),_.push(lt.z),d.push(Z,K),q.push(p),++p}m.push(q)}for(var E=0;E<c;++E)for(var M=0;M<s;++M){var $=m[E][M],tt=m[E+1][M],et=m[E+1][M+1],it=m[E][M+1];f.push($),f.push(it),f.push(tt),f.push(it),f.push(et),f.push(tt)}for(var D=0;D<=h;++D)for(var nt=D*Math.PI/h/2+Math.PI/2,rt=Math.sin(nt),st=-Math.cos(nt),B=0;B<=s;++B){var I=2*B*Math.PI/s-Math.PI/2,P=Math.sin(I)*rt,R=st,I=Math.cos(I)*rt,O=B/s,L=D/a+(1-V);u.push(P*t,R*t+N,I*t),_.push(P,R,I),d.push(O,L),D<h&&B<s&&(R=(P=s+1)*D+B+m[c][s]+1,I=P*(D+1)+B+m[c][s]+1,O=P*(D+1)+B+1+m[c][s]+1,L=P*D+B+1+m[c][s]+1,f.push(R,L,I),f.push(L,O,I))}return new ot.default(u,_,d,f,U,n,i)};var at=n(t("../../value-types/vec3")),ot=n(t("./vertex-data"));function n(t){return t&&t.__esModule?t:{default:t}}var lt=cc.v3(0,0,0),ht=cc.v3(0,0,0);e.exports=i.default},{"../../value-types/vec3":340,"./vertex-data":62}],53:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e,i){return void 0===t&&(t=.5),void 0===e&&(e=1),void 0===i&&(i={radialSegments:32,heightSegments:1,capped:!0,arc:2*Math.PI}),(0,n.default)(0,t,e,i)};var n=(t=t("./cylinder"))&&t.__esModule?t:{default:t};e.exports=i.default},{"./cylinder":54}],54:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(_,d,t,e){void 0===_&&(_=.5),void 0===d&&(d=.5),void 0===t&&(t=2),void 0===e&&(e={radialSegments:32,heightSegments:1,capped:!0,arc:2*Math.PI});for(var f=.5*t,p=e.radialSegments,i=e.heightSegments,n=e.capped,m=e.arc,e=0,r=(n||(0<_&&e++,0<d&&e++),(p+1)*(i+1)),s=(n&&(r+=(p+1)*e+p*e),p*i*2*3),y=(n&&(s+=p*e*3),new Array(s)),g=new Array(3*r),v=new Array(3*r),b=new Array(2*r),e=Math.max(_,d),s=new L.default(-e,-f,-e),r=new L.default(e,f,e),e=Math.sqrt(e*e+f*f),x=0,A=0,a=[],o=_-d,l=o*o/t*Math.sign(o),h=0;h<=i;h++){for(var c=[],u=h/i,C=u*o+d,T=0;T<=p;++T){var S=T/p,w=S*m,E=Math.sin(w),w=Math.cos(w);g[3*x]=C*E,g[3*x+1]=u*t-f,g[3*x+2]=C*w,L.default.normalize(V,L.default.set(N,E,-l,w)),v[3*x]=V.x,v[3*x+1]=V.y,v[3*x+2]=V.z,b[2*x]=2*(1-S)%1,b[2*x+1]=u,c.push(x),++x}a.push(c)}for(var M=0;M<i;++M)for(var D=0;D<p;++D){var B=a[M][D],I=a[M+1][D],P=a[M+1][D+1],R=a[M][D+1];y[A]=B,y[++A]=R,y[++A]=I,y[++A]=R,y[++A]=P,y[++A]=I,++A}return n&&(0<d&&O(!1),0<_&&O(!0)),new F.default(g,v,b,y,s,r,e);function O(t){for(var e=t?_:d,i=t?1:-1,n=x,r=1;r<=p;++r)g[3*x]=0,g[3*x+1]=f*i,g[3*x+2]=0,v[3*x]=0,v[3*x+1]=i,v[3*x+2]=0,b[2*x]=.5,b[2*x+1]=.5,++x;for(var s=x,a=0;a<=p;++a){var o=a/p*m,l=Math.cos(o),o=Math.sin(o);g[3*x]=e*o,g[3*x+1]=f*i,g[3*x+2]=e*l,v[3*x]=0,v[3*x+1]=i,v[3*x+2]=0,b[2*x]=.5-.5*o*i,b[2*x+1]=.5+.5*l,++x}for(var h=0;h<p;++h){var c=n+h,u=s+h;t?(y[A]=u+1,y[++A]=c):(y[A]=c,y[++A]=u+1),y[++A]=u,++A}}};var L=n(t("../../value-types/vec3")),F=n(t("./vertex-data"));function n(t){return t&&t.__esModule?t:{default:t}}var V=new L.default,N=new L.default;e.exports=i.default},{"../../value-types/vec3":340,"./vertex-data":62}],55:[function(t,e,i){"use strict";var n=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=f();if(e&&e.has(t))return e.get(t);var i,n,r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&((n=s?Object.getOwnPropertyDescriptor(t,i):null)&&(n.get||n.set)?Object.defineProperty(r,i,n):r[i]=t[i]);return r.default=t,e&&e.set(t,r),r}(t("./utils")),r=d(t("./box")),s=d(t("./cone")),a=d(t("./cylinder")),o=d(t("./plane")),l=d(t("./quad")),h=d(t("./sphere")),c=d(t("./torus")),u=d(t("./capsule")),_=t("./polyhedron"),t=d(t("./vertex-data"));function d(t){return t&&t.__esModule?t:{default:t}}function f(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return f=function(){return t},t}cc.primitive=Object.assign({box:r.default,cone:s.default,cylinder:a.default,plane:o.default,quad:l.default,sphere:h.default,torus:c.default,capsule:u.default,polyhedron:_.polyhedron,PolyhedronType:_.PolyhedronType,VertexData:t.default},n)},{"./box":51,"./capsule":52,"./cone":53,"./cylinder":54,"./plane":56,"./polyhedron":57,"./quad":58,"./sphere":59,"./torus":60,"./utils":61,"./vertex-data":62}],56:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e,i){var n=(i=void 0===i?{widthSegments:10,lengthSegments:10}:i).widthSegments,r=i.lengthSegments,i=.5*(t=void 0===t?10:t),s=.5*(e=void 0===e?10:e),a=[],o=[],l=[],h=[],c=new y.default(-i,0,-s),u=new y.default(i,0,s),t=Math.sqrt(t*t+e*e);y.default.set(C,-i,0,s),y.default.set(T,i,0,s),y.default.set(S,-i,0,-s);for(var _=0;_<=r;_++)for(var d=0;d<=n;d++){var f,p=d/n,m=_/r;y.default.lerp(v,C,T,p),y.default.lerp(b,C,S,m),y.default.sub(x,b,C),y.default.add(A,v,x),a.push(A.x,A.y,A.z),o.push(0,1,0),l.push(p,m),d<n&&_<r&&(m=d+1+(_+1)*(p=n+1),h.push(d+_*p,f=d+1+_*p,p=d+(_+1)*p),h.push(f,m,p))}return new g.default(a,o,l,h,c,u,t)};var y=n(t("../../value-types/vec3")),g=n(t("./vertex-data"));function n(t){return t&&t.__esModule?t:{default:t}}var v=new y.default,b=new y.default,x=new y.default,A=new y.default,C=new y.default,T=new y.default,S=new y.default;e.exports=i.default},{"../../value-types/vec3":340,"./vertex-data":62}],57:[function(t,e,i){"use strict";i.__esModule=!0,i.polyhedron=i.PolyhedronType=void 0;var v=t("./utils"),b=(n=t("./vertex-data"))&&n.__esModule?n:{default:n},x=t("../../value-types"),n=cc.Enum({Tetrahedron:0,Octahedron:1,Dodecahedron:2,Icosahedron:3,Rhombicuboctahedron:4,TriangularPrism:5,PentagonalPrism:6,HexagonalPrism:7,SquarePyramid:8,PentagonalPyramid:9,TriangularDipyramid:10,PentagonalDipyramid:11,ElongatedSquareDipyramid:12,ElongatedPentagonalDipyramid:13,ElongatedPentagonalCupola:14}),A=(i.PolyhedronType=n,[]);A[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},A[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},A[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},A[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},A[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},A[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},A[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},A[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},A[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},A[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},A[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},A[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},A[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},A[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},A[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]},i.polyhedron=function(t,e,i){void 0===e&&(e=1),t=(!t||!(t<0||t>=A.length))&&t||0;for(var n=(i=void 0===i?{sizeX:0,sizeY:0,sizeZ:0}:i).sizeX||e,r=i.sizeY||e,s=i.sizeZ||e,a=A[t],o=a.face.length,l=[],h=[],i=[],c=[],u=new x.Vec3(1/0,1/0,1/0),_=new x.Vec3(-1/0,-1/0,-1/0),d=0;d<a.vertex.length;d++){var f=a.vertex[d][0]*n,p=a.vertex[d][1]*r,m=a.vertex[d][2]*s;u.x=Math.min(u.x,f),u.y=Math.min(u.y,p),u.z=Math.min(u.z,m),_.x=Math.max(_.x,f),_.y=Math.max(_.y,p),_.z=Math.max(_.z,m),l.push(f,p,m),c.push(0,0)}for(var y=0;y<o;y++)for(var g=0;g<a.face[y].length-2;g++)h.push(a.face[y][0],a.face[y][g+2],a.face[y][g+1]);(0,v.calcNormals)(l,h,i);e=Math.sqrt(Math.pow(_.x-u.x,2),Math.pow(_.y-u.y,2),Math.pow(_.z-u.z,2));return new b.default(l,i,c,h,u,_,e)}},{"../../value-types":330,"./utils":61,"./vertex-data":62}],58:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(){return new n.default(s,a,o,l,h,c,u)};var n=(r=t("./vertex-data"))&&r.__esModule?r:{default:r},r=t("../../value-types"),s=[-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0],a=[0,0,1,0,0,1,0,0,1,0,0,1],o=[0,0,0,1,1,1,1,0],l=[0,3,1,3,2,1],h=new r.Vec3(-.5,-.5,0),c=new r.Vec3(.5,.5,0),u=Math.sqrt(.5);e.exports=i.default},{"../../value-types":330,"./vertex-data":62}],59:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e){for(var i=(e=void 0===e?{segments:32}:e).segments,n=[],r=[],s=[],a=[],e=new b.Vec3(-(t=void 0===t?.5:t),-t,-t),o=new b.Vec3(t,t,t),l=t,h=0;h<=i;++h)for(var c=h*Math.PI/i,u=Math.sin(c),_=-Math.cos(c),d=0;d<=i;++d){var f=2*d*Math.PI/i-Math.PI/2,p=Math.sin(f)*u,m=_,f=Math.cos(f)*u,y=d/i,g=h/i;n.push(p*t,m*t,f*t),r.push(p,m,f),s.push(y,g),h<i&&d<i&&(f=(m=(p=i+1)*(h+1)+d)+1,a.push(p*h+d,y=p*h+d+1,m),a.push(y,f,m))}return new v.default(n,r,s,a,e,o,l)};var n,v=(n=t("./vertex-data"))&&n.__esModule?n:{default:n},b=t("../../value-types");e.exports=i.default},{"../../value-types":330,"./vertex-data":62}],60:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e,i){void 0===t&&(t=.4),void 0===e&&(e=.1);for(var n=(i=void 0===i?{radialSegments:32,tubularSegments:32,arc:2*Math.PI}:i).radialSegments,r=i.tubularSegments,s=i.arc,a=[],o=[],l=[],h=[],i=new T.Vec3(-t-e,-e,-t-e),c=new T.Vec3(t+e,e,t+e),u=t+e,_=0;_<=n;_++)for(var d=0;d<=r;d++){var f=d/r,p=_/n,m=f*s,y=p*Math.PI*2,g=(t+e*Math.cos(y))*Math.sin(m),v=e*Math.sin(y),b=(t+e*Math.cos(y))*Math.cos(m),x=Math.sin(m)*Math.cos(y),A=Math.sin(y),m=Math.cos(m)*Math.cos(y);a.push(g,v,b),o.push(x,A,m),l.push(f,p),d<r&&_<n&&(v=(g=(y=r+1)*(_+1)+d)+1,h.push(y*_+d,b=y*_+d+1,g),h.push(b,v,g))}return new C.default(a,o,l,h,i,c,u)};var n,C=(n=t("./vertex-data"))&&n.__esModule?n:{default:n},T=t("../../value-types");e.exports=i.default},{"../../value-types":330,"./vertex-data":62}],61:[function(t,e,i){"use strict";i.__esModule=!0,i.wireframe=function(t){for(var e=[[0,1],[1,2],[2,0]],i=[],n={},r=0;r<t.length;r+=3)for(var s=0;s<3;++s){var a=t[r+e[s][0]],o=t[r+e[s][1]],l=o<a?o<<16|a:a<<16|o;void 0===n[l]&&(n[l]=0,i.push(a,o))}return i},i.invWinding=function(t){for(var e=[],i=0;i<t.length;i+=3)e.push(t[i],t[i+2],t[i+1]);return e},i.toWavefrontOBJ=function(t,e){void 0===e&&(e=1);for(var i=t.positions,n=t.uvs,r=t.normals,s=t.indices,a=function(t){return s[t]+1+"/"+(s[t]+1)+"/"+(s[t]+1)},o="",l=0;l<i.length;l+=3)o+="v "+i[l]*e+" "+i[l+1]*e+" "+i[l+2]*e+"\n";for(var h=0;h<n.length;h+=2)o+="vt "+n[h]+" "+n[h+1]+"\n";for(var c=0;c<r.length;c+=3)o+="vn "+r[c]+" "+r[c+1]+" "+r[c+2]+"\n";for(var u=0;u<s.length;u+=3)o+="f "+a(u)+" "+a(u+1)+" "+a(u+2)+"\n";return o},i.normals=function(t,e,i){void 0===i&&(i=1);for(var n=new Array(2*t.length),r=0;r<t.length/3;++r){var s=3*r,a=6*r;n[0+a]=t[0+s],n[1+a]=t[1+s],n[2+a]=t[2+s],n[3+a]=t[0+s]+e[0+s]*i,n[4+a]=t[1+s]+e[1+s]*i,n[5+a]=t[2+s]+e[2+s]*i}return n},i.calcNormals=function(t,e,i){for(var n=0,r=(i=i||new Array(t.length)).length;n<r;n++)i[n]=0;for(var s,a,o,l=cc.v3(),h=cc.v3(),c=cc.v3(),u=cc.v3(),_=cc.v3(),d=0,f=e.length;d<f;d+=3)s=3*e[d+0],a=3*e[d+1],o=3*e[d+2],v(l,t,s),v(h,t,a),v(c,t,o),g.default.subtract(u,c,h),g.default.subtract(_,l,h),g.default.cross(u,u,_),i[s]+=u.x,i[1+s]+=u.y,i[2+s]+=u.z,i[a]+=u.x,i[1+a]+=u.y,i[2+a]+=u.z,i[o]+=u.x,i[1+o]+=u.y,i[2+o]+=u.z;for(var p=cc.v3(),m=0,y=i.length;m<y;m+=3)p.x=i[m],p.y=i[m+1],p.z=i[m+2],p.normalizeSelf(),i[m]=p.x,i[m+1]=p.y,i[m+2]=p.z;return i};var g=(i=t("../../value-types/vec3"))&&i.__esModule?i:{default:i};function v(t,e,i){t.x=e[i],t.y=e[i+1],t.z=e[i+2]}},{"../../value-types/vec3":340}],62:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0,i.default=function(t,e,i,n,r,s,a){this.positions=void 0,this.normals=void 0,this.uvs=void 0,this.indices=void 0,this.minPos=void 0,this.maxPos=void 0,this.boundingRadius=void 0,this.positions=t,this.normals=e,this.uvs=i,this.indices=n,this.minPos=r,this.maxPos=s,this.boundingRadius=a},e.exports=i.default},{}],63:[function(t,e,i){"use strict";var t=t("../../../animation/animation-curves"),n=t.DynamicAnimCurve,t=t.quickFindIndex,n=cc.Class({name:"cc.JointMatrixCurve",extends:n,_findFrameIndex:t,sample:function(t,e){var i=this.ratios,n=this._findFrameIndex(i,e);n<-1&&(n=~n-1);for(var r=this.pairs,s=0;s<r.length;s++){var a=r[s];a.target._jointMatrix=a.values[n]}}});e.exports=n},{"../../../animation/animation-curves":11}],64:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Skeleton",extends:cc.Asset,ctor:function(){this._bindposes=[],this._uniqueBindPoses=[],this._jointPaths=[]},properties:{_model:cc.Model,_jointIndices:[],_skinIndex:-1,jointPaths:{get:function(){return this._jointPaths}},bindposes:{get:function(){return this._bindposes}},uniqueBindPoses:{get:function(){return this._uniqueBindPoses}},model:{get:function(){return this._model}}},onLoad:function(){for(var t=this._model.nodes,e=this._jointIndices,i=this._jointPaths,n=this._bindposes,r=this._uniqueBindPoses,s=0;s<e.length;s++){var a=t[e[s]];i[s]=a.path,a.uniqueBindPose?n[s]=r[s]=a.uniqueBindPose:n[s]=a.bindpose[this._skinIndex]}}});cc.Skeleton=e.exports=n},{}],65:[function(t,e,i){"use strict";var n=t("../../components/CCAnimation"),r=t("../CCModel"),t=t("./CCSkeletonAnimationClip"),t=cc.Class({name:"cc.SkeletonAnimation",extends:n,editor:!1,properties:{_model:{default:null,type:r},_defaultClip:{override:!0,default:null,type:t},_clips:{override:!0,default:[],type:[t],visible:!0},defaultClip:{override:!0,get:function(){return this._defaultClip},set:function(t){this._defaultClip=t},type:t},model:{get:function(){return this._model},set:function(t){this._model=t,this._updateClipModel()},type:r}},__preload:function(){this._updateClipModel()},_updateClipModel:function(){this._defaultClip&&(this._defaultClip._model=this._model);for(var t=this._clips,e=0;e<t.length;e++)t[e]._model=this._model},addClip:function(t,e){return t._model=this._model,n.prototype.addClip.call(this,t,e)},searchClips:!1});cc.SkeletonAnimation=e.exports=t},{"../../components/CCAnimation":115,"../CCModel":27,"./CCSkeletonAnimationClip":66,"fire-path":void 0}],66:[function(t,e,i){"use strict";var v=(r=t("../../value-types/mat4"))&&r.__esModule?r:{default:r},n=t("../../../animation/animation-clip"),a=t("./CCJointMatrixCurve");var r=cc.Class({name:"cc.SkeletonAnimationClip",extends:n,properties:{_nativeAsset:{override:!0,get:function(){return this._buffer},set:function(t){var e=ArrayBuffer.isView(t)?t.buffer:t;this._buffer=new Float32Array(e||t,0,e.byteLength/4)}},description:{default:null,type:Object},curveData:{visible:!1,override:!0,get:function(){return this._curveData||{}},set:function(){}}},statics:{preventDeferredLoadDependents:!0},_init:function(){return this._curveData||(this._curveData={},this._generateCommonCurve(),this._model.precomputeJointMatrix&&this._generateJointMatrixCurve(),this._curveData)},_generateCommonCurve:function(){var t=this._buffer,e=this.description,i=0;function n(){return t[i++]}this._curveData.paths||(this._curveData.paths={});var r,s=this._curveData.paths;for(r in e){var a,o=e[r],l={};for(a in s[r]={props:l},o){for(var h=[],c=o[a].frameCount,i=o[a].offset,u=0;u<c;u++){var _=n(),d=void 0;"position"===a||"scale"===a?d=cc.v3(n(),n(),n()):"quat"===a&&(d=cc.quat(n(),n(),n(),n())),h.push({frame:_,value:d})}l[a]=h}}},_generateJointMatrixCurve:function(){var p=this._model.rootNode,m=this._curveData.paths,t={ratios:[],jointMatrixMap:{}},y=t.jointMatrixMap;function g(t,e,i){var n,r=m[t.path];if(t!==p&&r){var s,a,o=r.props;for(a in o)for(var l=o[a],h=0;h<l.length;h++){var c=l[h];if(Math.abs(c.frame-e)<1e-4){t[a].set(c.value);break}if(c.frame>e){var u=l[h-1],_=(e-u.frame)/(c.frame-u.frame);u.value.lerp(c.value,_,t[a]);break}}n=cc.mat4(),v.default.fromRTS(n,t.quat,t.position,t.scale),i&&v.default.mul(n,i,n),o._jointMatrix||(o._jointMatrix=[]),t.uniqueBindPose&&(s=cc.mat4(),v.default.mul(s,n,t.uniqueBindPose)),y[t.path]||(y[t.path]=[]),s?y[t.path].push((r=s,(i=new Float32Array(16)).set(r.m),i)):y[t.path].push(n)}var d,f=t.children;for(d in f)g(f[d],e,n)}for(var e=0,i=this.duration,n=1/this.sample;e<i;)t.ratios.push(e/i),g(p,e),e+=n;this._curveData=t},_createJointMatrixCurve:function(t,e){var i,n=new a,r=(n.ratios=this.curveData.ratios,n.pairs=[],this.curveData.jointMatrixMap);for(i in r){var s=cc.find(i,e);s&&n.pairs.push({target:s,values:r[i]})}return[n]},createCurves:function(t,e){return this._model?(this._init(),this._model.precomputeJointMatrix?this._createJointMatrixCurve(t,e):n.prototype.createCurves.call(this,t,e)):(cc.warn("Skeleton Animation Clip ["+this.name+"] Can not find model"),[])}});cc.SkeletonAnimationClip=e.exports=r},{"../../../animation/animation-clip":10,"../../value-types/mat4":332,"./CCJointMatrixCurve":63}],67:[function(t,e,i){"use strict";var h=(n=t("../../value-types/mat4"))&&n.__esModule?n:{default:n},n=t("./CCSkeleton"),r=t("../../mesh/CCMeshRenderer"),c=t("../../renderer/render-flow"),u=(t("../../../renderer/enums"),cc.mat4()),a=cc.mat4(),t=cc.Class({name:"cc.SkinnedMeshRenderer",extends:r,editor:!1,ctor:function(){this._jointsData=this._jointsFloat32Data=null,this._jointsTexture=null,this._joints=[],this._dummyNode=new cc.Node,this._jointsTextureOptions=null,this._usingRGBA8Texture=!1},properties:{_skeleton:n,_rootBone:cc.Node,skeleton:{get:function(){return this._skeleton},set:function(t){this._skeleton=t,this._init()},type:n},rootBone:{get:function(){return this._rootBone},set:function(t){this._rootBone=t,this._init()},type:cc.Node},enableAutoBatch:{get:function(){return!1},visible:!1,override:!0}},__preload:function(){this._super(),this._init()},_init:function(){this._model=this._skeleton&&this._skeleton.model,this._calFunc=null,this._initJoints(),this._initJointsTexture(),this._initCalcFunc(),this._updateRenderNode()},_calcWorldMatrixToRoot:function(t){var e;t._worldMatrixToRoot||(t._worldMatrixToRoot=e=cc.mat4(),t.getLocalMatrix(e),(t=t.parent)!==this.rootBone&&(t._worldMatrixToRoot||this._calcWorldMatrixToRoot(t),h.default.mul(e,t._worldMatrixToRoot,e)))},_validateRender:function(){this._jointsData?this._super():this.disableRender()},_initJoints:function(){var t=this._joints;if(t.length=0,this.skeleton&&this.rootBone){for(var e=this._useJointMatrix(),i=this.skeleton.jointPaths,n=this.rootBone,r=0;r<i.length;r++){var s=cc.find(i[r],n);s||cc.warn("Can not find joint in root bone [%s] with path [%s]",n.name,i[r]),e&&(s._renderFlag&=~c.FLAG_CHILDREN,this._calcWorldMatrixToRoot(s)),t.push(s)}if(e)for(var a=this.skeleton.uniqueBindPoses,o=0;o<i.length;o++){var l=t[o];a[o]?(h.default.mul(u,l._worldMatrixToRoot,a[o]),l._jointMatrix=h.default.toArray([],u)):l._jointMatrix=l._worldMatrixToRoot}}},_initJointsTexture:function(){var t,e,i,n,r;this._skeleton&&(n=!1,(r=this._joints.length)<=cc.sys.getMaxJointMatrixSize()&&(n=!0,this._jointsData=this._jointsFloat32Data=new Float32Array(16*r)),n||(n=!!cc.sys.glExtension("OES_texture_float"),e=256<r?64:64<r?32:16<r?16:8,this._jointsData=this._jointsFloat32Data=new Float32Array(e*e*4),t=cc.Texture2D.PixelFormat.RGBA32F,i=e=e,n||(this._jointsData=new Uint8Array(this._jointsFloat32Data.buffer),t=cc.Texture2D.PixelFormat.RGBA8888,e*=4,this._usingRGBA8Texture=!0,cc.warn("SkinnedMeshRenderer ["+this.node.name+"] has too many joints ["+r+"] and device do not support float32 texture, fallback to use RGBA8888 texture, which is much slower.")),n=this._jointsTexture||new cc.Texture2D,r=cc.Texture2D.Filter.NEAREST,n.setFilters(r,r),n.initWithData(this._jointsData,t,e,i),this._jointsTexture=n,this._jointsTextureOptions={format:t,width:n.width,height:n.height,images:[]}),this._updateMaterial())},_updateMaterial:function(){r.prototype._updateMaterial.call(this);for(var t=this.getMaterials(),e=0;e<t.length;e++){var i=t[e];this._jointsTexture?(i.setProperty("jointsTexture",this._jointsTexture),i.setProperty("jointsTextureSize",new Float32Array([this._jointsTexture.width,this._jointsTexture.height])),i.define("CC_JOINTS_TEXTURE_FLOAT32",!!cc.sys.glExtension("OES_texture_float")),i.define("CC_USE_JOINTS_TEXTRUE",!0)):(this._jointsFloat32Data&&i.setProperty("jointMatrices",this._jointsFloat32Data,void 0,!0),i.define("CC_USE_JOINTS_TEXTRUE",!1)),i.define("CC_USE_SKINNING",!0)}},_setJointsDataWithArray:function(t,e){this._jointsFloat32Data.set(e,16*t)},_setJointsDataWithMatrix:function(t,e){this._jointsFloat32Data.set(e.m,16*t)},_commitJointsData:function(){this._jointsTexture&&(this._jointsTextureOptions.images[0]=this._jointsData,this._jointsTexture.update(this._jointsTextureOptions))},_useJointMatrix:function(){return this._model&&this._model.precomputeJointMatrix},_updateRenderNode:function(){this._useJointMatrix()||this._usingRGBA8Texture?this._assembler.setRenderNode(this.rootBone):this._assembler.setRenderNode(this._dummyNode)},_initCalcFunc:function(){this._useJointMatrix()?this._calFunc=this._calJointMatrix:this._usingRGBA8Texture?this._calFunc=this._calRGBA8WorldMatrix:this._calFunc=this._calWorldMatrix},_calJointMatrix:function(){for(var t=this._joints,e=this.skeleton.bindposes,i=this.skeleton.uniqueBindPoses,n=0;n<t.length;++n){var r=t[n]._jointMatrix;i[n]?this._setJointsDataWithArray(n,r):(h.default.multiply(u,r,e[n]),this._setJointsDataWithMatrix(n,u))}},_calRGBA8WorldMatrix:function(){var t=this._joints,e=this.skeleton.bindposes;this.rootBone._updateWorldMatrix();for(var i=this.rootBone._worldMatrix,n=h.default.invert(a,i),r=0;r<t.length;++r){var s=t[r];s._updateWorldMatrix(),h.default.multiply(u,n,s._worldMatrix),h.default.multiply(u,u,e[r]),this._setJointsDataWithMatrix(r,u)}},_calWorldMatrix:function(){for(var t=this._joints,e=this.skeleton.bindposes,i=0;i<t.length;++i){var n=t[i];n._updateWorldMatrix(),h.default.multiply(u,n._worldMatrix,e[i]),this._setJointsDataWithMatrix(i,u)}},calcJointMatrix:function(){this.skeleton&&this.rootBone&&(this._calFunc.call(this),this._commitJointsData())}});cc.SkinnedMeshRenderer=e.exports=t},{"../../../renderer/enums":358,"../../mesh/CCMeshRenderer":198,"../../renderer/render-flow":263,"../../value-types/mat4":332,"./CCSkeleton":64}],68:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r=t("./CCSkinnedMeshRenderer"),s=t("../../mesh/mesh-renderer"),s=(t("../../renderer/render-flow"),t=n=s,(s=a).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,a.prototype.fillBuffers=function(t,e){t.calcJointMatrix(),n.prototype.fillBuffers.call(this,t,e)},a);function a(){return n.apply(this,arguments)||this}i.default=s,cc.Assembler.register(r,s),e.exports=i.default},{"../../mesh/mesh-renderer":201,"../../renderer/render-flow":263,"./CCSkinnedMeshRenderer":67}],69:[function(t,e,i){"use strict";var n,r=t("./platform/utils");t("../../DebugInfos");function s(e){return function(){var t=arguments[0],t=e+" "+t+", please go to https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md#"+t+" to see details.";return 1===arguments.length?t:2===arguments.length?t+" Arguments: "+arguments[1]:t+" Arguments: "+cc.js.shiftArguments.apply(null,arguments).join(", ")}}cc.log=cc.warn=cc.error=cc.assert=console.log.bind?console.log.bind(console):console.log,cc._throw=function(t){r.callInNextTick(function(){throw t})};var a=s("Log"),o=(cc.logID=function(){cc.log(a.apply(null,arguments))},s("Warning")),l=(cc.warnID=function(){cc.warn(o.apply(null,arguments))},s("Error")),h=(cc.errorID=function(){cc.error(l.apply(null,arguments))},s("Assert")),c=(cc.assertID=function(t){t||cc.assert(!1,h.apply(null,cc.js.shiftArguments.apply(null,arguments)))},cc.Enum({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6}));e.exports=cc.debug={DebugMode:c,_resetDebugSetting:function(t){var i;cc.log=cc.warn=cc.error=cc.assert=function(){},t!==c.NONE&&(t>c.ERROR?(i=function(t){var e,i;cc.game.canvas&&(n||((e=document.createElement("Div")).setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",cc.game.canvas.height),(i=e.style).zIndex="99999",i.position="absolute",i.top=i.left="0",(n=document.createElement("textarea")).setAttribute("rows","20"),n.setAttribute("cols","30"),n.setAttribute("disabled","true"),(i=n.style).backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin=0,e.appendChild(n),cc.game.canvas.parentNode.appendChild(e)),n.value=n.value+t+"\r\n",n.scrollTop=n.scrollHeight)},cc.error=function(){i("ERROR :  "+cc.js.formatStr.apply(null,arguments))},cc.assert=function(t,e){!t&&e&&(e=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),i("ASSERT: "+e))},t!==c.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){i("WARN :  "+cc.js.formatStr.apply(null,arguments))}),t===c.INFO_FOR_WEB_PAGE&&(cc.log=function(){i(cc.js.formatStr.apply(null,arguments))})):console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t)throw e=e&&cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),new Error(e)}),t!==c.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),t===c.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)}))},getError:s("ERROR"),isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(t?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config.showFPS=!!t)}}},{"../../DebugInfos":void 0,"./platform/utils":254}],70:[function(t,e,i){"use strict";var n=t("./event/event-target"),c=t("./load-pipeline/auto-release-utils"),r=t("./component-scheduler"),s=t("./node-activator"),u=t("./platform/CCObject"),_=t("./CCGame"),a=t("./renderer"),o=t("./event-manager"),l=t("./CCScheduler");cc.Director=function(){n.call(this),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=null,this._loadingScene="",this._scene=null,this._totalFrames=0,this._lastUpdate=0,this._deltaTime=0,this._startTime=0,this._maxParticleDeltaTime=0,this._scheduler=null,this._compScheduler=null,this._nodeActivator=null,this._actionManager=null;var t=this;_.on(_.EVENT_SHOW,function(){t._lastUpdate=performance.now()}),_.once(_.EVENT_ENGINE_INITED,this.init,this)},cc.Director.prototype={constructor:cc.Director,init:function(){return this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._scheduler=new l,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,l.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new r,this._nodeActivator=new s,o&&o.setEnabled(!0),cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,l.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,l.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,l.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc.Physics3DManager?(this._physics3DManager=new cc.Physics3DManager,this._scheduler.scheduleUpdate(this._physics3DManager,l.PRIORITY_SYSTEM,!1)):this._physics3DManager=null,cc._widgetManager&&cc._widgetManager.init(this),cc.loader.init(this)},calculateDeltaTime:function(t){t=t||performance.now(),this._deltaTime=t>this._lastUpdate?(t-this._lastUpdate)/1e3:0,this._lastUpdate=t},convertToGL:function(t){var e=_.container,i=cc.view,n=e.getBoundingClientRect(),r=n.left+window.pageXOffset-e.clientLeft,e=n.top+window.pageYOffset-e.clientTop,r=i._devicePixelRatio*(t.x-r),e=i._devicePixelRatio*(e+n.height-t.y);return i._isRotated?cc.v2(i._viewportRect.width-e,r):cc.v2(r,e)},convertToUI:function(t){var e=_.container,i=cc.view,n=e.getBoundingClientRect(),r=n.left+window.pageXOffset-e.clientLeft,e=n.top+window.pageYOffset-e.clientTop,s=cc.v2(0,0);return i._isRotated?(s.x=r+t.y/i._devicePixelRatio,s.y=e+n.height-(i._viewportRect.width-t.x)/i._devicePixelRatio):(s.x=r+t.x*i._devicePixelRatio,s.y=e+n.height-t.y*i._devicePixelRatio),s},end:function(){this._purgeDirectorInNextLoop=!0},getWinSize:function(){return cc.size(cc.winSize)},getWinSizeInPixels:function(){return cc.size(cc.winSize)},pause:function(){this._paused||(this._paused=!0)},purgeCachedData:function(){cc.loader.releaseAll()},purgeDirector:function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),o&&o.setEnabled(!1),cc.isValid(this._scene)&&this._scene.destroy(),this._scene=null,cc.renderer.clear(),cc.AssetLibrary.resetBuiltins(),cc.game.pause(),cc.loader.releaseAll()},reset:function(){this.purgeDirector(),o&&o.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),cc.game.resume()},runSceneImmediate:function(t,e,i){cc.assertID(t instanceof cc.Scene,1216),t._load();for(var n=Object.keys(_._persistRootNodes).map(function(t){return _._persistRootNodes[t]}),r=0;r<n.length;r++){var s,a=n[r],o=t.getChildByUuid(a.uuid);o?(s=o.getSiblingIndex(),o._destroyImmediate(),t.insertChild(a,s)):a.parent=t}var l=this._scene,h=l&&l.autoReleaseAssets&&l.dependAssets;c.autoRelease(h,t.dependAssets,n),cc.isValid(l)&&l.destroy(),this._scene=null,u._deferredDestroy(),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t),(this._scene=t)._activate(),cc.game.resume(),i&&i(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,i){cc.assertID(t,1205),cc.assertID(t instanceof cc.Scene,1216),t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(t,e,i)},this)},_getSceneUuid:function(t){var e=_._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://")||(t="/"+t);for(var i=0;i<e.length;i++){var n=e[i];if(n.url.endsWith(t))return n}}else if("number"==typeof t){if(0<=t&&t<e.length)return e[t];cc.errorID(1206,t)}else cc.errorID(1207,t);return null},loadScene:function(t,e,i){if(this._loadingScene)return cc.warnID(1208,t,this._loadingScene),!1;var n=this._getSceneUuid(t);return n?(n=n.uuid,this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,this._loadSceneByUuid(n,e,i),!0):(cc.errorID(1209,t),!1)},preloadScene:function(i,t,n){void 0===n&&(n=t,t=null);var e=this._getSceneUuid(i);e?(this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,i),cc.loader.load({uuid:e.uuid,type:"uuid"},t,function(t,e){t&&cc.errorID(1210,i,t.message),n&&n(t,e)})):(e='Can not preload the scene "'+i+'" because it is not in the build settings.',n(new Error(e)),cc.error("preloadScene: "+e))},_loadSceneByUuid:function(r,s,a,t){console.time("LoadScene "+r),cc.AssetLibrary.loadAsset(r,function(t,e){console.timeEnd("LoadScene "+r);var i,n=cc.director;if(n._loadingScene="",t)t="Failed to load scene: "+t,cc.error(t);else{if(e instanceof cc.SceneAsset)return(i=e.scene)._id=e._uuid,i._name=e._name,void n.runSceneImmediate(i,a,s);t="The asset "+r+" is not a scene",cc.error(t)}s&&s(t)})},resume:function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setDepthTest:function(t){cc.Camera.main&&(cc.Camera.main.depth=!!t)},setClearColor:function(t){cc.Camera.main&&(cc.Camera.main.backgroundColor=t)},getRunningScene:function(){return this._scene},getScene:function(){return this._scene},getAnimationInterval:function(){return 1e3/_.getFrameRate()},setAnimationInterval:function(t){_.setFrameRate(Math.round(1e3/t))},getDeltaTime:function(){return this._deltaTime},getTotalTime:function(){return performance.now()-this._startTime},getTotalFrames:function(){return this._totalFrames},isPaused:function(){return this._paused},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=t,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getPhysics3DManager:function(){return this._physics3DManager},startAnimation:function(){cc.game.resume()},stopAnimation:function(){cc.game.pause()},_resetDeltaTime:function(){this._lastUpdate=performance.now(),this._deltaTime=0},mainLoop:function(t){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):(this.calculateDeltaTime(t),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this._compScheduler.clearup(),this.emit(cc.Director.EVENT_AFTER_UPDATE),u._deferredDestroy()),this.emit(cc.Director.EVENT_BEFORE_DRAW),a.render(this._scene,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_DRAW),o.frameUpdateListeners(),this._totalFrames++)},__fastOn:function(t,e,i){this.on(t,e,i)},__fastOff:function(t,e,i){this.off(t,e,i)}},cc.js.addon(cc.Director.prototype,n.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_draw",cc.Director.EVENT_AFTER_VISIT="director_before_draw",cc.Director.EVENT_BEFORE_DRAW="director_before_draw",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.Director.EVENT_BEFORE_PHYSICS="director_before_physics",cc.Director.EVENT_AFTER_PHYSICS="director_after_physics",cc.director=new cc.Director,e.exports=cc.director},{"./CCGame":71,"./CCScheduler":75,"./component-scheduler":114,"./event-manager":154,"./event/event-target":156,"./load-pipeline/auto-release-utils":181,"./node-activator":202,"./platform/CCObject":236,"./renderer":262}],71:[function(t,e,i){"use strict";var n=t("./event/event-target"),a=(t("../audio/CCAudioEngine"),t("./CCDebug")),s=t("./renderer/index.js"),o=t("../core/renderer/utils/dynamic-atlas/manager"),l={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESTART:"game_on_restart",EVENT_GAME_INITED:"game_inited",EVENT_ENGINE_INITED:"engine_inited",EVENT_RENDERER_INITED:"engine_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,renderType:-1,config:null,onStart:null,setFrameRate:function(t){this.config.frameRate=t,this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},getFrameRate:function(){return this.config.frameRate},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),cc.director._resetDeltaTime(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){for(var t in l._persistRootNodes)l.removePersistRootNode(l._persistRootNodes[t]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),l.pause(),cc.AssetLibrary._loadBuiltins(function(){l.onStart(),l.emit(l.EVENT_RESTART)})})},end:function(){close()},_initEngine:function(){this._rendererInitialized||(this._initRenderer(),this._initEvents(),this.emit(this.EVENT_ENGINE_INITED))},_loadPreviewScript:function(t){t()},_prepareFinished:function(t){var e=this;this._initEngine(),this._setAnimFrame(),cc.AssetLibrary._loadBuiltins(function(){console.log("Cocos Creator v"+cc.ENGINE_VERSION),e._prepared=!0,e._runMainLoop(),e.emit(e.EVENT_GAME_INITED),t&&t()})},eventTargetOn:n.prototype.on,eventTargetOnce:n.prototype.once,on:function(t,e,i,n){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(i):this.eventTargetOn(t,e,i,n)},once:function(t,e,i){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(i):this.eventTargetOnce(t,e,i)},prepare:function(e){var t,i=this;this._prepared?e&&e():(t=this.config.jsList)&&0<t.length?cc.loader.load(t,function(t){if(t)throw new Error(JSON.stringify(t));i._loadPreviewScript(function(){i._prepareFinished(e)})}):this._loadPreviewScript(function(){i._prepareFinished(e)})},run:function(t,e){this._initConfig(t),this.onStart=e,this.prepare(l.onStart&&l.onStart.bind(l))},addPersistRootNode:function(t){if(cc.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i))if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warnID(3801);if(t.parent!==i)return void cc.warnID(3802)}else t.parent=i;(this._persistRootNodes[e]=t)._persistNode=!0}}else cc.warnID(3800)},removePersistRootNode:function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1)},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){this._lastTime=performance.now();var t=l.config.frameRate;this._frameTime=1e3/t,cc.director._maxParticleDeltaTime=this._frameTime/1e3*2,60!==t&&30!==t?(window.requestAnimFrame=this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=performance.now(),i=Math.max(0,l._frameTime-(e-l._lastTime)),n=window.setTimeout(function(){t()},i);return l._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var e,i,t,n,r,s;this._prepared&&(t=(i=this).config,n=cc.director,r=!0,s=t.frameRate,a.setDisplayStats(t.showFPS),e=function(t){i._paused||(i._intervalId=window.requestAnimFrame(e),30===s&&(r=!r)||n.mainLoop(t))},i._intervalId=window.requestAnimFrame(e),i._paused=!1)},_initConfig:function(t){"number"!=typeof t.debugMode&&(t.debugMode=0),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||2<e||e<0)&&(t.renderMode=0),"boolean"!=typeof t.registerSystemEvent&&(t.registerSystemEvent=!0),t.showFPS=1!==e&&!!t.showFPS,this._sceneInfos=t.scenes||[],this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],a._resetDebugSetting(t.debugMode),this.config=t,this._configLoaded=!0},_determineRenderType:function(){var t=this.config,t=parseInt(t.renderMode)||0,e=(this.renderType=this.RENDER_TYPE_CANVAS,!1);if(0===t?cc.sys.capabilities.opengl?(this.renderType=this.RENDER_TYPE_WEBGL,e=!0):cc.sys.capabilities.canvas&&(this.renderType=this.RENDER_TYPE_CANVAS,e=!0):1===t&&cc.sys.capabilities.canvas?(this.renderType=this.RENDER_TYPE_CANVAS,e=!0):2===t&&cc.sys.capabilities.opengl&&(this.renderType=this.RENDER_TYPE_WEBGL,e=!0),!e)throw new Error(a.getError(3820,t))},_initRenderer:function(){var t,e,i,n,r;this._rendererInitialized||("CANVAS"===(r=(r=this.config.id)instanceof HTMLElement?r:document.querySelector(r)||document.querySelector("#"+r)).tagName?(t=r.width,e=r.height,this.canvas=i=r,this.container=n=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(n,i)):("DIV"!==r.tagName&&cc.warnID(3819),t=r.clientWidth,e=r.clientHeight,this.canvas=i=document.createElement("CANVAS"),this.container=n=document.createElement("DIV"),r.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,r="gameCanvas",-1<(" "+(n=i).className+" ").indexOf(" "+r+" ")||(n.className&&(n.className+=" "),n.className+=r),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),this._determineRenderType(),this.renderType===this.RENDER_TYPE_WEBGL&&(r={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS},s.initWebGL(i,r),this._renderContext=s.device._gl,!cc.macro.CLEANUP_IMAGE_CACHE&&o&&(o.enabled=!0)),this._renderContext||(this.renderType=this.RENDER_TYPE_CANVAS,s.initCanvas(i),this._renderContext=s.device._ctx),this.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this._rendererInitialized=!0)},_initEvents:function(){var e,t=window,s=(this.config.registerSystemEvent&&cc.internal.inputManager.registerSystemEvent(this.canvas),void 0!==document.hidden?e="hidden":void 0!==document.mozHidden?e="mozHidden":void 0!==document.msHidden?e="msHidden":void 0!==document.webkitHidden&&(e="webkitHidden"),!1);function i(){s||(s=!0,l.emit(l.EVENT_HIDE))}function n(t,e,i,n,r){s&&(s=!1,l.emit(l.EVENT_SHOW,t,e,i,n,r))}if(e)for(var r=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],a=0;a<r.length;a++)document.addEventListener(r[a],function(t){(document[e]||t.hidden?i:n)()});else t.addEventListener("blur",i),t.addEventListener("focus",n);-1<navigator.userAgent.indexOf("MicroMessenger")&&(t.onfocus=n),"onpageshow"in window&&"onpagehide"in window&&(t.addEventListener("pagehide",i),t.addEventListener("pageshow",n),document.addEventListener("pagehide",i),document.addEventListener("pageshow",n)),this.on(l.EVENT_HIDE,function(){l.pause()}),this.on(l.EVENT_SHOW,function(){l.resume()})}};n.call(l),cc.js.addon(l,n.prototype),cc.game=e.exports=l},{"../audio/CCAudioEngine":21,"../core/renderer/utils/dynamic-atlas/manager":265,"./CCDebug":69,"./event/event-target":156,"./renderer/index.js":262}],72:[function(t,F,V){"use strict";function e(){}function N(t,e){0!==t&&(at&&cc.warn("`cc.Node.skewX/Y` is deprecated since v2.2.1, please use 3D node instead.",""),at=!1)}function k(t,e){var i=t.getLocation(),n=this.owner;return!!n._hitTest(i,this)&&(e.type=E.TOUCH_START,e.touch=t,e.bubbles=!0,n.dispatchEvent(e),!0)}function z(t,e){var i=this.owner;e.type=E.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)}function G(t,e){var i=t.getLocation(),n=this.owner;n._hitTest(i,this)?e.type=E.TOUCH_END:e.type=E.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,n.dispatchEvent(e)}function U(t,e){t.getLocation();var i=this.owner;e.type=E.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)}function j(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=E.MOUSE_DOWN,t.bubbles=!0,i.dispatchEvent(t))}function W(t){var e=t.getLocation(),i=this.owner;if(i._hitTest(e,this))this._previousIn||(B&&B._mouseListener&&(t.type=E.MOUSE_LEAVE,B.dispatchEvent(t),B._mouseListener._previousIn=!1),B=this.owner,t.type=E.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0),t.type=E.MOUSE_MOVE,t.bubbles=!0,i.dispatchEvent(t);else{if(!this._previousIn)return;t.type=E.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,B=null}t.stopPropagation()}function H(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=E.MOUSE_UP,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())}function X(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=E.MOUSE_WHEEL,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())}var p=t("./value-types"),Y=t("./utils/base-node"),q=t("./utils/prefab-helper"),J=t("./utils/trans-pool").NodeMemPool,i=t("./utils/affine-transform"),o=t("./event-manager"),n=t("./platform/CCMacro"),r=t("./platform/js"),s=(t("./event/event"),t("./event/event-target")),a=t("./renderer/render-flow"),Z=cc.Object.Flags.Destroying,c=Math.PI/180,l=!!cc.ActionManager,h=new p.Vec3,K=new p.Quat,u=new p.Vec3,Q=new p.Vec3,$=new p.Quat,tt=new p.Quat,_=new p.Vec3,d=new p.Vec3,f=new p.Vec3,et=new p.Vec3,m=new p.Vec3,it=new p.Quat,y=new p.Quat,g=new p.Vec3,nt=new p.Quat,v=new p.Vec3,b=new p.Quat,rt=new p.Vec3,st=new p.Vec3,x=new p.Quat,A=new p.Quat,C=(new p.Quat,cc.mat4()),T=new p.Vec3,S=new Array(16),t=(S.length=0,cc.Enum({DEBUG:31})),w=cc.Enum({POSITION:1,SCALE:2,ROTATION:4,SKEW:8,TRS:7,RS:6,TRSS:15,PHYSICS_POSITION:16,PHYSICS_SCALE:32,PHYSICS_ROTATION:64,PHYSICS_TRS:112,PHYSICS_RS:96,ALL_POSITION:17,ALL_SCALE:34,ALL_ROTATION:68,ALL_TRS:119,ALL:65535}),E=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel",POSITION_CHANGED:"position-changed",ROTATION_CHANGED:"rotation-changed",SCALE_CHANGED:"scale-changed",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",CHILD_REORDER:"child-reorder",GROUP_CHANGED:"group-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"}),M=[E.TOUCH_START,E.TOUCH_MOVE,E.TOUCH_END,E.TOUCH_CANCEL],D=[E.MOUSE_DOWN,E.MOUSE_ENTER,E.MOUSE_MOVE,E.MOUSE_LEAVE,E.MOUSE_UP,E.MOUSE_WHEEL],at=!0,B=null;function I(t,e){if(e){for(var i,n=0,r=null,s=t;s&&cc.Node.isNode(s);s=s._parent,++n)s.getComponent(e)&&(i={index:n,node:s},r?r.push(i):r=[i]);return r}return null}function P(t,e){if(t._objFlags&Z)return 1;var i=0;if(t._bubblingListeners)for(;i<e.length;++i)if(t._bubblingListeners.hasEventListener(e[i]))return 1;if(t._capturingListeners)for(;i<e.length;++i)if(t._capturingListeners.hasEventListener(e[i]))return 1}function R(t){var e=t.groupIndex;return e=0===e&&t.parent?R(t.parent):e}function O(t){var e=R(t);t._cullingMask=1<<e;for(var i=0;i<t._children.length;i++)O(t._children[i])}function ot(){var t,e,i,n,r,s,a;this._localMatDirty&w.TRSS&&(t=(e=this._matrix).m,p.Trs.toMat4(e,this._trs),(this._skewX||this._skewY)&&(e=t[0],i=t[1],n=t[4],r=t[5],s=Math.tan(this._skewX*c),a=Math.tan(this._skewY*c),s===1/0&&(s=99999999),t[0]=e+n*(a=a===1/0?99999999:a),t[1]=i+r*a,t[4]=n+e*s,t[5]=r+i*s),this._localMatDirty&=~w.TRSS,this._worldMatDirty=!0)}function lt(){var t,e,i,n,r,s,a,o,l,h=this._localMatDirty;h&w.TRSS&&(t=this._matrix.m,e=this._trs,h&(w.RS|w.SKEW)&&(h=-this._eulerAngles.z,l=this._skewX||this._skewY,i=e[7],n=e[8],h||l?(a=s=0,o=r=1,h&&(h=h*c,a=Math.sin(h),r=o=Math.cos(h),s=-a),t[0]=r*=i,t[1]=s*=i,t[4]=a*=n,t[5]=o*=n,l&&(h=t[0],r=t[1],s=t[4],a=t[5],o=Math.tan(this._skewX*c),l=Math.tan(this._skewY*c),o===1/0&&(o=99999999),t[0]=h+s*(l=l===1/0?99999999:l),t[1]=r+a*l,t[4]=s+h*o,t[5]=a+r*o)):(t[0]=i,t[1]=0,t[4]=0,t[5]=n)),t[12]=e[0],t[13]=e[1],this._localMatDirty&=~w.TRSS,this._worldMatDirty=!0)}function ht(){var t;this._localMatDirty&w.TRSS&&this._updateLocalMatrix(),this._parent?(t=this._parent._worldMatrix,p.Mat4.mul(this._worldMatrix,t,this._matrix)):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1}function ct(){this._localMatDirty&w.TRSS&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1}function ut(t,e,i){var e=e.m,i=i.m,t=t.m,n=e[0],r=e[1],s=e[4],a=e[5],o=e[12],e=e[13],l=i[0],h=i[1],c=i[4],u=i[5],_=i[12],i=i[13];0!==r||0!==s?(t[0]=l*n+h*s,t[1]=l*r+h*a,t[4]=c*n+u*s,t[5]=c*r+u*a,t[12]=n*_+s*i+o,t[13]=r*_+a*i+e):(t[0]=l*n,t[1]=h*a,t[4]=c*n,t[5]=u*a,t[12]=n*_+o,t[13]=a*i+e)}var _t=p.Mat4.mul,Y={name:"cc.Node",extends:Y,properties:{_opacity:255,_color:cc.Color.WHITE,_contentSize:cc.Size,_anchorPoint:cc.v2(.5,.5),_position:void 0,_scale:void 0,_trs:null,_eulerAngles:cc.Vec3,_skewX:0,_skewY:0,_zIndex:{default:void 0,type:cc.Integer},_localZOrder:{default:0,serializable:!1},_is3DNode:!1,_groupIndex:{default:0,formerlySerializedAs:"groupIndex"},groupIndex:{get:function(){return this._groupIndex},set:function(t){this._groupIndex=t,O(this),this.emit(E.GROUP_CHANGED,this)}},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t)}},x:{get:function(){return this._trs[0]},set:function(t){var e=this._trs;t!==e[0]&&(e[0]=t,this.setLocalDirty(w.ALL_POSITION),1&this._eventMask&&this.emit(E.POSITION_CHANGED))}},y:{get:function(){return this._trs[1]},set:function(t){var e=this._trs;t!==e[1]&&(e[1]=t,this.setLocalDirty(w.ALL_POSITION),1&this._eventMask&&this.emit(E.POSITION_CHANGED))}},z:{get:function(){return this._trs[2]},set:function(t){var e=this._trs;t!==e[2]&&(e[2]=t,this.setLocalDirty(w.ALL_POSITION),this._renderFlag|=a.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(E.POSITION_CHANGED))}},rotation:{get:function(){return-this.angle},set:function(t){this.angle=-t}},angle:{get:function(){return this._eulerAngles.z},set:function(t){p.Vec3.set(this._eulerAngles,0,0,t),p.Trs.fromAngleZ(this._trs,t),this.setLocalDirty(w.ALL_ROTATION),4&this._eventMask&&this.emit(E.ROTATION_CHANGED)}},rotationX:{get:function(){return this._eulerAngles.x},set:function(t){this._eulerAngles.x!==t&&(this._eulerAngles.x=t,this._eulerAngles.x===this._eulerAngles.y?p.Trs.fromAngleZ(this._trs,-t):p.Trs.fromEulerNumber(this._trs,t,this._eulerAngles.y,0),this.setLocalDirty(w.ALL_ROTATION),4&this._eventMask&&this.emit(E.ROTATION_CHANGED))}},rotationY:{get:function(){return this._eulerAngles.y},set:function(t){this._eulerAngles.y!==t&&(this._eulerAngles.y=t,this._eulerAngles.x===this._eulerAngles.y?p.Trs.fromAngleZ(this._trs,-t):p.Trs.fromEulerNumber(this._trs,this._eulerAngles.x,t,0),this.setLocalDirty(w.ALL_ROTATION),4&this._eventMask&&this.emit(E.ROTATION_CHANGED))}},eulerAngles:{get:function(){return p.Trs.toEuler(this._eulerAngles,this._trs)},set:function(t){p.Trs.fromEuler(this._trs,t),this.setLocalDirty(w.ALL_ROTATION),this._renderFlag|=a.FLAG_TRANSFORM,4&this._eventMask&&this.emit(E.ROTATION_CHANGED)}},quat:{get:function(){var t=this._trs;return new p.Quat(t[3],t[4],t[5],t[6])},set:function(t){this.setRotation(t)}},scale:{get:function(){return this._trs[7]},set:function(t){this.setScale(t)}},scaleX:{get:function(){return this._trs[7]},set:function(t){this._trs[7]!==t&&(this._trs[7]=t,this.setLocalDirty(w.ALL_SCALE),2&this._eventMask&&this.emit(E.SCALE_CHANGED))}},scaleY:{get:function(){return this._trs[8]},set:function(t){this._trs[8]!==t&&(this._trs[8]=t,this.setLocalDirty(w.ALL_SCALE),2&this._eventMask&&this.emit(E.SCALE_CHANGED))}},scaleZ:{get:function(){return this._trs[9]},set:function(t){this._trs[9]!==t&&(this._trs[9]=t,this.setLocalDirty(w.ALL_SCALE),this._renderFlag|=a.FLAG_TRANSFORM,2&this._eventMask&&this.emit(E.SCALE_CHANGED))}},skewX:{get:function(){return this._skewX},set:function(t){N(t),this._skewX=t,this.setLocalDirty(w.SKEW)}},skewY:{get:function(){return this._skewY},set:function(t){N(t),this._skewY=t,this.setLocalDirty(w.SKEW)}},opacity:{get:function(){return this._opacity},set:function(t){t=cc.misc.clampf(t,0,255),this._opacity!==t&&(this._opacity=t,this._renderFlag|=a.FLAG_OPACITY_COLOR)},range:[0,255]},color:{get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||(this._color.set(t),this._renderFlag|=a.FLAG_COLOR,32&this._eventMask&&this.emit(E.COLOR_CHANGED,t))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var e=this._anchorPoint;e.x!==t&&(e.x=t,16&this._eventMask&&this.emit(E.ANCHOR_CHANGED))}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var e=this._anchorPoint;e.y!==t&&(e.y=t,16&this._eventMask&&this.emit(E.ANCHOR_CHANGED))}},width:{get:function(){return this._contentSize.width},set:function(t){t!==this._contentSize.width&&(this._contentSize.width=t,8&this._eventMask&&this.emit(E.SIZE_CHANGED))}},height:{get:function(){return this._contentSize.height},set:function(t){t!==this._contentSize.height&&(this._contentSize.height=t,8&this._eventMask&&this.emit(E.SIZE_CHANGED))}},zIndex:{get:function(){return this._localZOrder>>16},set:function(t){t>n.MAX_ZINDEX?(cc.warnID(1636),t=n.MAX_ZINDEX):t<n.MIN_ZINDEX&&(cc.warnID(1637),t=n.MIN_ZINDEX),this.zIndex!==t&&(this._localZOrder=65535&this._localZOrder|t<<16,this.emit(E.SIBLING_ORDER_CHANGED),this._onSiblingIndexChanged())}},is3DNode:{get:function(){return this._is3DNode},set:function(t){this._is3DNode=t,this._update3DFunction()}},up:{get:function(){return p.Vec3.transformQuat(v,p.Vec3.UP,this.getWorldRotation(b)).clone()}},right:{get:function(){return p.Vec3.transformQuat(v,p.Vec3.RIGHT,this.getWorldRotation(b)).clone()}},forward:{get:function(){return p.Vec3.transformQuat(v,p.Vec3.FORWARD,this.getWorldRotation(b)).clone()}}},ctor:function(){this._reorderChildDirty=!1,this._widget=null,this._renderComponent=null,this._capturingListeners=null,this._bubblingListeners=null,this._touchListener=null,this._mouseListener=null,this._initDataFromPool(),this._eventMask=0,this._cullingMask=1,this._childArrivalOrder=1,this._renderFlag=a.FLAG_TRANSFORM|a.FLAG_OPACITY_COLOR},statics:{EventType:E,_LocalDirtyFlag:w,isNode:function(t){return t instanceof L&&(t.constructor===L||!(t instanceof cc.Scene))},BuiltinGroupIndex:t},_onSiblingIndexChanged:function(){this._parent&&this._parent._delaySort()},_onPreDestroy:function(){this._onPreDestroyBase(),l&&cc.director.getActionManager().removeAllActionsFromTarget(this),B===this&&(B=null),(this._touchListener||this._mouseListener)&&(o.removeListeners(this),this._touchListener&&(this._touchListener.owner=null,this._touchListener.mask=null,this._touchListener=null),this._mouseListener&&(this._mouseListener.owner=null,this._mouseListener.mask=null,this._mouseListener=null)),this._backDataIntoPool(),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_onPostActivated:function(t){var e=l?cc.director.getActionManager():null;t?(this._renderFlag|=a.FLAG_WORLD_TRANSFORM,e&&e.resumeTarget(this),o.resumeTarget(this),this._checkListenerMask()):(e&&e.pauseTarget(this),o.pauseTarget(this))},_onHierarchyChanged:function(t){this._updateOrderOfArrival(),O(this),this._parent&&this._parent._delaySort(),this._renderFlag|=a.FLAG_WORLD_TRANSFORM,this._onHierarchyChangedBase(t),cc._widgetManager&&(cc._widgetManager._nodesOrderDirty=!0),t&&this._activeInHierarchy&&this._checkListenerMask()},_update3DFunction:function(){this._is3DNode?(this._updateLocalMatrix=ot,this._calculWorldMatrix=ht,this._mulMat=_t):(this._updateLocalMatrix=lt,this._calculWorldMatrix=ct,this._mulMat=ut),this._renderComponent&&this._renderComponent._on3DNodeChanged&&this._renderComponent._on3DNodeChanged(),this._renderFlag|=a.FLAG_TRANSFORM,this._localMatDirty=w.ALL},_initDataFromPool:function(){this._spaceInfo||(this._spaceInfo=J.pop());var t=this._spaceInfo,t=(this._matrix=cc.mat4(t.localMat),p.Mat4.identity(this._matrix),this._worldMatrix=cc.mat4(t.worldMat),p.Mat4.identity(this._worldMatrix),this._localMatDirty=w.ALL,this._worldMatDirty=!0,this._trs=this._spaceInfo.trs);t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=1,t[7]=1,t[8]=1,t[9]=1},_backDataIntoPool:function(){J.push(this._spaceInfo),this._matrix=null,this._worldMatrix=null,this._trs=null,this._spaceInfo=null},_toEuler:function(){var t;this.is3DNode?p.Trs.toEuler(this._eulerAngles,this._trs):(t=Math.asin(this._trs[5])/c*2,p.Vec3.set(this._eulerAngles,0,0,t))},_fromEuler:function(){this.is3DNode?p.Trs.fromEuler(this._trs,this._eulerAngles):p.Trs.fromAngleZ(this._trs,this._eulerAngles.z)},_upgrade_1x_to_2x:function(){this._is3DNode&&this._update3DFunction();var t,e=this._trs;e?(t=e,e=this._trs=this._spaceInfo.trs,11===t.length?e.set(t.subarray(1)):e.set(t)):e=this._trs=this._spaceInfo.trs,void 0!==this._zIndex&&(this._localZOrder=this._zIndex<<16,this._zIndex=void 0),this._fromEuler(),0!==this._localZOrder&&(this._zIndex=(4294901760&this._localZOrder)>>16),this._color.a<255&&255===this._opacity&&(this._opacity=this._color.a,this._color.a=255)},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&t.root===this&&q.syncWithPrefab(this),this._upgrade_1x_to_2x(),this._updateOrderOfArrival(),this._cullingMask=1<<R(this),this._activeInHierarchy||(l&&cc.director.getActionManager().pauseTarget(this),o.pauseTarget(this));for(var e=this._children,i=0,n=e.length;i<n;i++)e[i]._onBatchCreated();0<e.length&&(this._renderFlag|=a.FLAG_CHILDREN)},_onBatchRestored:function(){var t;this._upgrade_1x_to_2x(),this._cullingMask=1<<R(this),this._activeInHierarchy||((t=cc.director.getActionManager())&&t.pauseTarget(this),o.pauseTarget(this));for(var e=this._children,i=0,n=e.length;i<n;i++)e[i]._onBatchRestored();0<e.length&&(this._renderFlag|=a.FLAG_CHILDREN)},_checkListenerMask:function(){var t;this._touchListener?(t=this._touchListener.mask=I(this,cc.Mask),this._mouseListener&&(this._mouseListener.mask=t)):this._mouseListener&&(this._mouseListener.mask=I(this,cc.Mask))},_checknSetupSysEvent:function(t){var e=!1,i=!1;return-1!==M.indexOf(t)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:I(this,cc.Mask),onTouchBegan:k,onTouchMoved:z,onTouchEnded:G,onTouchCancelled:U}),o.addListener(this._touchListener,this),e=!0),i=!0):-1!==D.indexOf(t)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:I(this,cc.Mask),onMouseDown:j,onMouseMove:W,onMouseUp:H,onMouseScroll:X}),o.addListener(this._mouseListener,this),e=!0),i=!0),e&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||o.pauseTarget(this)},this,0,0,0,!1),i},on:function(t,e,i,n){if(this._checknSetupSysEvent(t))return this._onDispatch(t,e,i,n);switch(t){case E.POSITION_CHANGED:this._eventMask|=1;break;case E.SCALE_CHANGED:this._eventMask|=2;break;case E.ROTATION_CHANGED:this._eventMask|=4;break;case E.SIZE_CHANGED:this._eventMask|=8;break;case E.ANCHOR_CHANGED:this._eventMask|=16;break;case E.COLOR_CHANGED:this._eventMask|=32}return this._bubblingListeners||(this._bubblingListeners=new s),this._bubblingListeners.on(t,e,i)},once:function(t,e,i,n){(this._checknSetupSysEvent(t)&&n?this._capturingListeners=this._capturingListeners||new s:this._bubblingListeners=this._bubblingListeners||new s).once(t,e,i)},_onDispatch:function(t,e,i,n){var r;if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e)return r=null,(r=n?this._capturingListeners=this._capturingListeners||new s:this._bubblingListeners=this._bubblingListeners||new s).hasEventListener(t,e,i)||(r.on(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this)),e;cc.errorID(6800)},off:function(t,e,i,n){var r=-1!==M.indexOf(t),s=!r&&-1!==D.indexOf(t);if(r||s)this._offDispatch(t,e,i,n),r?this._touchListener&&!P(this,M)&&(o.removeListener(this._touchListener),this._touchListener=null):s&&this._mouseListener&&!P(this,D)&&(o.removeListener(this._mouseListener),this._mouseListener=null);else if(this._bubblingListeners&&(this._bubblingListeners.off(t,e,i),!this._bubblingListeners.hasEventListener(t)))switch(t){case E.POSITION_CHANGED:this._eventMask&=-2;break;case E.SCALE_CHANGED:this._eventMask&=-3;break;case E.ROTATION_CHANGED:this._eventMask&=-5;break;case E.SIZE_CHANGED:this._eventMask&=-9;break;case E.ANCHOR_CHANGED:this._eventMask&=-17;break;case E.COLOR_CHANGED:this._eventMask&=-33}},_offDispatch:function(t,e,i,n){"boolean"==typeof i?(n=i,i=void 0):n=!!n,e?(n=n?this._capturingListeners:this._bubblingListeners)&&(n.off(t,e,i),i&&i.__eventTargets&&r.array.fastRemove(i.__eventTargets,this)):(this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t))},targetOff:function(t){var e=this._bubblingListeners;e&&(e.targetOff(t),1&this._eventMask&&!e.hasEventListener(E.POSITION_CHANGED)&&(this._eventMask&=-2),2&this._eventMask&&!e.hasEventListener(E.SCALE_CHANGED)&&(this._eventMask&=-3),4&this._eventMask&&!e.hasEventListener(E.ROTATION_CHANGED)&&(this._eventMask&=-5),8&this._eventMask&&!e.hasEventListener(E.SIZE_CHANGED)&&(this._eventMask&=-9),16&this._eventMask&&!e.hasEventListener(E.ANCHOR_CHANGED)&&(this._eventMask&=-17),32&this._eventMask&&!e.hasEventListener(E.COLOR_CHANGED)&&(this._eventMask&=-33)),this._capturingListeners&&this._capturingListeners.targetOff(t),t&&t.__eventTargets&&r.array.fastRemove(t.__eventTargets,this),this._touchListener&&!P(this,M)&&(o.removeListener(this._touchListener),this._touchListener=null),this._mouseListener&&!P(this,D)&&(o.removeListener(this._mouseListener),this._mouseListener=null)},hasEventListener:function(t){var e=!1;return e=!(e=this._bubblingListeners?this._bubblingListeners.hasEventListener(t):e)&&this._capturingListeners?this._capturingListeners.hasEventListener(t):e},emit:function(t,e,i,n,r,s){this._bubblingListeners&&this._bubblingListeners.emit(t,e,i,n,r,s)},dispatchEvent:function(t){(function(t,e){var i,n;for(e.target=t,S.length=0,t._getCapturingTargets(e.type,S),e.eventPhase=1,n=S.length-1;0<=n;--n)if((i=S[n])._capturingListeners&&((e.currentTarget=i)._capturingListeners.emit(e.type,e,S),e._propagationStopped))return S.length=0;if(S.length=0,e.eventPhase=2,(e.currentTarget=t)._capturingListeners&&t._capturingListeners.emit(e.type,e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.emit(e.type,e),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,S),e.eventPhase=3,n=0;n<S.length;++n)if((i=S[n])._bubblingListeners&&((e.currentTarget=i)._bubblingListeners.emit(e.type,e),e._propagationStopped))return S.length=0;S.length=0})(this,t),S.length=0},pauseSystemEvents:function(t){o.pauseTarget(this,t)},resumeSystemEvents:function(t){o.resumeTarget(this,t)},_hitTest:function(t,e){var i=this._contentSize.width,n=this._contentSize.height,r=rt,s=st,a=cc.Camera.findCamera(this);if(a?a.getScreenToWorldPoint(t,r):r.set(t),this._updateWorldMatrix(),!p.Mat4.invert(C,this._worldMatrix))return!1;p.Vec2.transformMat4(s,r,C),s.x+=this._anchorPoint.x*i,s.y+=this._anchorPoint.y*n;var o=!1;if(0<=s.x&&0<=s.y&&s.x<=i&&s.y<=n&&(o=!0,e&&e.mask))for(var l=e.mask,h=this,c=l?l.length:0,u=0,_=0;h&&_<c;++u,h=h.parent){var d=l[_];if(u===d.index){if(h!==d.node){l.length=_;break}var f=h.getComponent(cc.Mask);if(f&&f._enabled&&!f._hitTest(r)){o=!1;break}_++}else if(u>d.index){l.length=_;break}}return o},_getCapturingTargets:function(t,e){for(var i=this.parent;i;)i._capturingListeners&&i._capturingListeners.hasEventListener(t)&&e.push(i),i=i.parent},_getBubblingTargets:function(t,e){for(var i=this.parent;i;)i._bubblingListeners&&i._bubblingListeners.hasEventListener(t)&&e.push(i),i=i.parent},runAction:l?function(t){var e;if(this.active)return cc.assertID(t,1618),(e=cc.director.getActionManager())._suppressDeprecation||(e._suppressDeprecation=!0,cc.warnID(1639)),e.addAction(t,this,!1),t}:e,pauseAllActions:l?function(){cc.director.getActionManager().pauseTarget(this)}:e,resumeAllActions:l?function(){cc.director.getActionManager().resumeTarget(this)}:e,stopAllActions:l?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:e,stopAction:l?function(t){cc.director.getActionManager().removeAction(t)}:e,stopActionByTag:l?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:e,getActionByTag:l?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:l?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},getPosition:function(t){return t=t||new p.Vec3,p.Trs.toPosition(t,this._trs)},setPosition:function(t,e,i){i=void 0===e?(n=t.x,e=t.y,t.z||0):(n=t,i||0);var n,t=this._trs;t[0]===n&&t[1]===e&&t[2]===i||(t[0]=n,t[1]=e,t[2]=i,this.setLocalDirty(w.ALL_POSITION),this._renderFlag|=a.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(E.POSITION_CHANGED))},getScale:function(t){return void 0!==t?p.Trs.toScale(t,this._trs):(cc.errorID(1400,"cc.Node.getScale","cc.Node.scale or cc.Node.getScale(cc.Vec3)"),this._trs[7])},setScale:function(t,e,i){t&&"number"!=typeof t?(e=t.y,i=void 0===t.z?1:t.z,t=t.x):void 0!==t&&void 0===e?i=e=t:void 0===i&&(i=1);var n=this._trs;n[7]===t&&n[8]===e&&n[9]===i||(n[7]=t,n[8]=e,n[9]=i,this.setLocalDirty(w.ALL_SCALE),this._renderFlag|=a.FLAG_TRANSFORM,2&this._eventMask&&this.emit(E.SCALE_CHANGED))},getRotation:function(t){return t instanceof p.Quat?p.Trs.toRotation(t,this._trs):-this.angle},setRotation:function(t,e,i,n){var r;"number"==typeof t&&void 0===e?this.angle=-t:(r=t,void 0===e&&(r=t.x,e=t.y,i=t.z,n=t.w),(t=this._trs)[3]===r&&t[4]===e&&t[5]===i&&t[6]===n||(t[3]=r,t[4]=e,t[5]=i,t[6]=n,this.setLocalDirty(w.ALL_ROTATION),4&this._eventMask&&this.emit(E.ROTATION_CHANGED)))},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}8&this._eventMask&&this.emit(E.SIZE_CHANGED)},getAnchorPoint:function(){return cc.v2(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.setLocalDirty(w.ALL_POSITION),16&this._eventMask&&this.emit(E.ANCHOR_CHANGED)},_invTransformPoint:function(t,e){this._parent?this._parent._invTransformPoint(t,e):p.Vec3.copy(t,e);e=this._trs;return p.Trs.toPosition(u,e),p.Vec3.sub(t,t,u),p.Trs.toRotation($,e),p.Quat.conjugate(tt,$),p.Vec3.transformQuat(t,t,tt),p.Trs.toScale(u,e),p.Vec3.inverseSafe(Q,u),p.Vec3.mul(t,t,Q),t},getWorldPosition:function(t){p.Trs.toPosition(t,this._trs);for(var e,i=this._parent;i;)e=i._trs,p.Trs.toScale(h,e),p.Vec3.mul(t,t,h),p.Trs.toRotation(K,e),p.Vec3.transformQuat(t,t,K),p.Trs.toPosition(h,e),p.Vec3.add(t,t,h),i=i._parent;return t},setWorldPosition:function(t){var e=this._trs;this._parent?this._parent._invTransformPoint(_,t):p.Vec3.copy(_,t),p.Trs.fromPosition(e,_),this.setLocalDirty(w.ALL_POSITION),1&this._eventMask&&this.emit(E.POSITION_CHANGED)},getWorldRotation:function(t){p.Trs.toRotation(x,this._trs),p.Quat.copy(t,x);for(var e=this._parent;e;)p.Trs.toRotation(x,e._trs),p.Quat.mul(t,x,t),e=e._parent;return t},setWorldRotation:function(t){this._parent?(this._parent.getWorldRotation(A),p.Quat.conjugate(A,A),p.Quat.mul(A,A,t)):p.Quat.copy(A,t),p.Trs.fromRotation(this._trs,A),this.setLocalDirty(w.ALL_ROTATION)},getWorldScale:function(t){p.Trs.toScale(d,this._trs),p.Vec3.copy(t,d);for(var e=this._parent;e;)p.Trs.toScale(d,e._trs),p.Vec3.mul(t,t,d),e=e._parent;return t},setWorldScale:function(t){this._parent?(this._parent.getWorldScale(f),p.Vec3.div(f,t,f)):p.Vec3.copy(f,t),p.Trs.fromScale(this._trs,f),this.setLocalDirty(w.ALL_SCALE)},getWorldRT:function(t){var e=et,i=it,n=this._trs;p.Trs.toPosition(e,n),p.Trs.toRotation(i,n);for(var r=this._parent;r;)n=r._trs,p.Trs.toScale(m,n),p.Vec3.mul(e,e,m),p.Trs.toRotation(y,n),p.Vec3.transformQuat(e,e,y),p.Trs.toPosition(m,n),p.Vec3.add(e,e,m),p.Quat.mul(i,y,i),r=r._parent;return p.Mat4.fromRT(t,i,e),t},lookAt:function(t,e){this.getWorldPosition(g),p.Vec3.sub(g,g,t),p.Vec3.normalize(g,g),p.Quat.fromViewUp(nt,g,e),this.setWorldRotation(nt)},_updateLocalMatrix:lt,_calculWorldMatrix:function(){this._localMatDirty&w.TRSS&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1},_mulMat:ut,_updateWorldMatrix:function(){if(this._parent&&this._parent._updateWorldMatrix(),this._worldMatDirty){this._calculWorldMatrix();for(var t=this._children,e=0,i=t.length;e<i;e++)t[e]._worldMatDirty=!0}},setLocalDirty:function(t){this._localMatDirty|=t,this._worldMatDirty=!0,t===w.ALL_POSITION||t===w.POSITION?this._renderFlag|=a.FLAG_WORLD_TRANSFORM:this._renderFlag|=a.FLAG_TRANSFORM},setWorldDirty:function(){this._worldMatDirty=!0},getLocalMatrix:function(t){return this._updateLocalMatrix(),p.Mat4.copy(t,this._matrix)},getWorldMatrix:function(t){return this._updateWorldMatrix(),p.Mat4.copy(t,this._worldMatrix)},convertToNodeSpaceAR:function(t,e){return this._updateWorldMatrix(),p.Mat4.invert(C,this._worldMatrix),t instanceof cc.Vec2?(e=e||new cc.Vec2,p.Vec2.transformMat4(e,t,C)):(e=e||new cc.Vec3,p.Vec3.transformMat4(e,t,C))},convertToWorldSpaceAR:function(t,e){return this._updateWorldMatrix(),t instanceof cc.Vec2?(e=e||new cc.Vec2,p.Vec2.transformMat4(e,t,this._worldMatrix)):(e=e||new cc.Vec3,p.Vec3.transformMat4(e,t,this._worldMatrix))},convertToNodeSpace:function(t){this._updateWorldMatrix(),p.Mat4.invert(C,this._worldMatrix);var e=new cc.Vec2;return p.Vec2.transformMat4(e,t,C),e.x+=this._anchorPoint.x*this._contentSize.width,e.y+=this._anchorPoint.y*this._contentSize.height,e},convertToWorldSpace:function(t){this._updateWorldMatrix();t=new cc.Vec2(t.x-this._anchorPoint.x*this._contentSize.width,t.y-this._anchorPoint.y*this._contentSize.height);return p.Vec2.transformMat4(t,t,this._worldMatrix)},getNodeToParentTransform:function(t){t=t||i.identity(),this._updateLocalMatrix();var e=this._contentSize;return T.x=-this._anchorPoint.x*e.width,T.y=-this._anchorPoint.y*e.height,p.Mat4.copy(C,this._matrix),p.Mat4.transform(C,C,T),i.fromMat4(t,C)},getNodeToParentTransformAR:function(t){return t=t||i.identity(),this._updateLocalMatrix(),i.fromMat4(t,this._matrix)},getNodeToWorldTransform:function(t){t=t||i.identity(),this._updateWorldMatrix();var e=this._contentSize;return T.x=-this._anchorPoint.x*e.width,T.y=-this._anchorPoint.y*e.height,p.Mat4.copy(C,this._worldMatrix),p.Mat4.transform(C,C,T),i.fromMat4(t,C)},getNodeToWorldTransformAR:function(t){return t=t||i.identity(),this._updateWorldMatrix(),i.fromMat4(t,this._worldMatrix)},getParentToNodeTransform:function(t){return t=t||i.identity(),this._updateLocalMatrix(),p.Mat4.invert(C,this._matrix),i.fromMat4(t,C)},getWorldToNodeTransform:function(t){return t=t||i.identity(),this._updateWorldMatrix(),p.Mat4.invert(C,this._worldMatrix),i.fromMat4(t,C)},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},getBoundingBox:function(){this._updateLocalMatrix();var t=this._contentSize.width,e=this._contentSize.height,t=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return t.transformMat4(t,this._matrix)},getBoundingBoxToWorld:function(){return this._parent?(this._parent._updateWorldMatrix(),this._getBoundingBoxTo()):this.getBoundingBox()},_getBoundingBoxTo:function(){var t=this._contentSize.width,e=this._contentSize.height,i=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);if(this._calculWorldMatrix(),i.transformMat4(i,this._worldMatrix),this._children)for(var n=this._children,r=0;r<n.length;r++){var s=n[r];s&&s.active&&((s=s._getBoundingBoxTo())&&i.union(i,s))}return i},_updateOrderOfArrival:function(){var t=this._parent?++this._parent._childArrivalOrder:0;this._localZOrder=4294901760&this._localZOrder|t,this.emit(E.SIBLING_ORDER_CHANGED)},addChild:function(t,e,i){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.parent=this,void 0!==e&&(t.zIndex=e),void 0!==i&&(t.name=i)},cleanup:function(){l&&cc.director.getActionManager().removeAllActionsFromTarget(this),o.removeListeners(this);for(var t,e=this._children.length,i=0;i<e;++i)(t=this._children[i])&&t.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;this._childArrivalOrder=1;for(var e=0,i=t.length;e<i;e++)(r=t[e])._updateOrderOfArrival();if(o._setDirtyForNode(this),1<t.length){for(var n,r,s=1,a=t.length;s<a;s++){for(r=t[s],n=s-1;0<=n&&r._localZOrder<t[n]._localZOrder;)t[n+1]=t[n],n--;t[n+1]=r}this.emit(E.CHILD_REORDER,this)}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_restoreProperties:!1,onRestore:!1},L=cc.Class(Y),t=L.prototype;r.getset(t,"position",t.getPosition,t.setPosition,!1,!0),cc.Node=F.exports=L},{"./event-manager":154,"./event/event":157,"./event/event-target":156,"./platform/CCMacro":235,"./platform/js":250,"./renderer/render-flow":263,"./utils/affine-transform":305,"./utils/base-node":306,"./utils/prefab-helper":318,"./utils/trans-pool":324,"./value-types":330}],73:[function(t,e,i){"use strict";var n=t("./CCNode"),r=t("./renderer/render-flow"),s=(cc.Object.Flags.HideInHierarchy,n._LocalDirtyFlag),t=cc.Class({name:"cc.PrivateNode",extends:n,properties:{x:{get:function(){return this._originPos.x},set:function(t){var e=this._originPos;t!==e.x&&(e.x=t,this._posDirty(!0))},override:!0},y:{get:function(){return this._originPos.y},set:function(t){var e=this._originPos;t!==e.y&&(e.y=t,this._posDirty(!0))},override:!0},zIndex:{get:function(){return cc.macro.MIN_ZINDEX},set:function(){cc.warnID(1638)},override:!0},showInEditor:{default:!1,editorOnly:!0,override:!0}},ctor:function(t){this._localZOrder=cc.macro.MIN_ZINDEX<<16,this._originPos=cc.v2()},_posDirty:function(t){this.setLocalDirty(s.POSITION),this._renderFlag|=r.FLAG_TRANSFORM,!0===t&&1&this._eventMask&&this.emit(n.EventType.POSITION_CHANGED)},_updateLocalMatrix:function(){var t;this._localMatDirty&&((t=this.parent)&&(this._trs[0]=this._originPos.x-(t._anchorPoint.x-.5)*t._contentSize.width,this._trs[1]=this._originPos.y-(t._anchorPoint.y-.5)*t._contentSize.height),this._super())},getPosition:function(){return new cc.Vec2(this._originPos)},setPosition:function(t,e){void 0===e&&(e=(t=t.x).y);var i=this._originPos;i.x===t&&i.y===e||(i.x=t,i.y=e,this._posDirty(!0))},setParent:function(t){var e=this._parent;this._super(t),e!==t&&(e&&e.off(n.EventType.ANCHOR_CHANGED,this._posDirty,this),t&&t.on(n.EventType.ANCHOR_CHANGED,this._posDirty,this))},_updateOrderOfArrival:function(){}});cc.js.getset(t.prototype,"parent",t.prototype.getParent,t.prototype.setParent),cc.js.getset(t.prototype,"position",t.prototype.getPosition,t.prototype.setPosition),cc.PrivateNode=e.exports=t},{"./CCNode":72,"./renderer/render-flow":263}],74:[function(t,e,i){"use strict";cc.Scene=cc.Class({name:"cc.Scene",extends:t("./CCNode"),properties:{_is3DNode:{default:!0,override:!0},autoReleaseAssets:{default:void 0,type:cc.Boolean}},ctor:function(){this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){if(cc.Object.prototype.destroy.call(this))for(var t=this._children,e=0;e<t.length;++e)t[e].active=!1;this._active=!1,this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(t){t=!1!==t,cc.director._nodeActivator.activateNode(this,t)}}),e.exports=cc.Scene},{"./CCNode":72}],75:[function(t,e,i){"use strict";function a(t,e,i,n){this.target=t,this.priority=e,this.paused=i,this.markedForDeletion=n}function o(t,e,i,n){this.list=t,this.entry=e,this.target=i,this.callback=n}function c(t,e,i,n,r,s){this.timers=t,this.target=e,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=s}var n=t("./platform/js"),r=new(t("./platform/id-generater"))("Scheduler"),s=[],l=(a.get=function(t,e,i,n){var r=s.pop();return r?(r.target=t,r.priority=e,r.paused=i,r.markedForDeletion=n):r=new a(t,e,i,n),r},a.put=function(t){s.length<20&&(t.target=null,s.push(t))},[]),h=(o.get=function(t,e,i,n){var r=l.pop();return r?(r.list=t,r.entry=e,r.target=i,r.callback=n):r=new o(t,e,i,n),r},o.put=function(t){l.length<20&&(t.list=t.entry=t.target=t.callback=null,l.push(t))},[]);function u(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}c.get=function(t,e,i,n,r,s){var a=h.pop();return a?(a.timers=t,a.target=e,a.timerIndex=i,a.currentTimer=n,a.currentTimerSalvaged=r,a.paused=s):a=new c(t,e,i,n,r,s),a},c.put=function(t){h.length<20&&(t.timers=t.target=t.currentTimer=null,h.push(t))};var t=u.prototype,_=(t.initWithCallback=function(t,e,i,n,r,s){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=n,this._delay=s,this._useDelay=0<this._delay,this._repeat=r,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(t){this._interval=t},t.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},[]);u.get=function(){return _.pop()||new u},u.put=function(t){_.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,_.push(t))},cc.Scheduler=function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=n.createMap(!0),this._hashForTimers=n.createMap(!0),this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},cc.Scheduler.prototype={constructor:cc.Scheduler,_removeHashElement:function(t){delete this._hashForTimers[t.target._id];for(var e=this._arrayForTimers,i=0,n=e.length;i<n;i++)if(e[i]===t){e.splice(i,1);break}c.put(t)},_removeUpdateFromHash:function(t){var t=t.target._id,e=this._hashForUpdates[t];if(e){for(var i=e.list,n=e.entry,r=0,s=i.length;r<s;r++)if(i[r]===n){i.splice(r,1);break}delete this._hashForUpdates[t],a.put(n),o.put(e)}},_priorityIn:function(t,e,i){for(var n=0;n<t.length;n++)if(i<t[n].priority)return void t.splice(n,0,e);t.push(e)},_appendIn:function(t,e){t.push(e)},enableForTarget:function(t){t._id||(t.__instanceId?cc.warnID(1513):t._id=r.getNewId())},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){var e,i,n;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),a=0,i=(e=this._updatesNegList).length;a<i;a++)(n=e[a]).paused||n.markedForDeletion||n.target.update(t);for(a=0,i=(e=this._updates0List).length;a<i;a++)(n=e[a]).paused||n.markedForDeletion||n.target.update(t);for(a=0,i=(e=this._updatesPosList).length;a<i;a++)(n=e[a]).paused||n.markedForDeletion||n.target.update(t);for(var r,s=this._arrayForTimers,a=0;a<s.length;a++){if(r=s[a],this._currentTarget=r,this._currentTargetSalvaged=!1,!r.paused)for(r.timerIndex=0;r.timerIndex<r.timers.length;++r.timerIndex)r.currentTimer=r.timers[r.timerIndex],r.currentTimerSalvaged=!1,r.currentTimer.update(t),r.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--a)}for(a=0,e=this._updatesNegList;a<e.length;)(n=e[a]).markedForDeletion?this._removeUpdateFromHash(n):a++;for(a=0,e=this._updates0List;a<e.length;)(n=e[a]).markedForDeletion?this._removeUpdateFromHash(n):a++;for(a=0,e=this._updatesPosList;a<e.length;)(n=e[a]).markedForDeletion?this._removeUpdateFromHash(n):a++;this._updateHashLocked=!1,this._currentTarget=null},schedule:function(t,e,i,n,r,s){"function"!=typeof t&&(a=t,t=e,e=a),4!==arguments.length&&5!==arguments.length||(s=!!n,n=cc.macro.REPEAT_FOREVER,r=0),cc.assertID(e,1502);var a=e._id;a||(e.__instanceId?(cc.warnID(1513),a=e._id=e.__instanceId):cc.errorID(1510));var o,l,h=this._hashForTimers[a];if(h?h.paused!==s&&cc.warnID(1511):(h=c.get(null,e,0,null,null,s),this._arrayForTimers.push(h),this._hashForTimers[a]=h),null==h.timers)h.timers=[];else for(l=0;l<h.timers.length;++l)if((o=h.timers[l])&&t===o._callback)return cc.logID(1507,o.getInterval(),i),void(o._interval=i);(o=u.get()).initWithCallback(this,t,e,i,n,r),h.timers.push(o),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(t,e,i){var n=t._id,r=(n||(t.__instanceId?(cc.warnID(1513),n=t._id=t.__instanceId):cc.errorID(1510)),this._hashForUpdates[n]);if(r&&r.entry){if(r.entry.priority===e)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return cc.logID(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(t)}var s,r=a.get(t,e,i,!1);0===e?(s=this._updates0List,this._appendIn(s,r)):(s=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,r,e)),this._hashForUpdates[n]=o.get(s,r,t,null)},unschedule:function(t,e){if(e&&t){var i=e._id,n=(i||(e.__instanceId?(cc.warnID(1513),i=e._id=e.__instanceId):cc.errorID(1510)),this._hashForTimers[i]);if(n)for(var r=n.timers,s=0,a=r.length;s<a;s++){var o=r[s];if(t===o._callback)return o!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(s,1),u.put(o),n.timerIndex>=s&&n.timerIndex--,void(0===r.length&&(this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)))}}},unscheduleUpdate:function(t){var e;t&&((e=t._id)||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),(t=this._hashForUpdates[e])&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry)))},unscheduleAllForTarget:function(t){if(t){var e=t._id,e=(e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),this._hashForTimers[e]);if(e){var i=e.timers;-1<i.indexOf(e.currentTimer)&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0);for(var n=0,r=i.length;n<r;n++)u.put(i[n]);i.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){for(var e,i,n=this._arrayForTimers,r=n.length-1;0<=r;r--)e=n[r],this.unscheduleAllForTarget(e.target);var s=0;if(t<0)for(r=0;r<this._updatesNegList.length;)s=this._updatesNegList.length,(i=this._updatesNegList[r])&&i.priority>=t&&this.unscheduleUpdate(i.target),s==this._updatesNegList.length&&r++;if(t<=0)for(r=0;r<this._updates0List.length;)s=this._updates0List.length,(i=this._updates0List[r])&&this.unscheduleUpdate(i.target),s==this._updates0List.length&&r++;for(r=0;r<this._updatesPosList.length;)s=this._updatesPosList.length,(i=this._updatesPosList[r])&&i.priority>=t&&this.unscheduleUpdate(i.target),s==this._updatesPosList.length&&r++},isScheduled:function(t,e){cc.assertID(t,1508),cc.assertID(e,1509);var i=e._id,e=(i||(e.__instanceId?(cc.warnID(1513),i=e._id=e.__instanceId):cc.errorID(1510)),this._hashForTimers[i]);if(e&&null!=e.timers)for(var n=e.timers,r=0;r<n.length;++r)if(t===n[r]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){for(var e,i,n=[],r=this._arrayForTimers,s=0,a=r.length;s<a;s++)(e=r[s])&&(e.paused=!0,n.push(e.target));if(t<0)for(s=0;s<this._updatesNegList.length;s++)(i=this._updatesNegList[s])&&i.priority>=t&&(i.paused=!0,n.push(i.target));if(t<=0)for(s=0;s<this._updates0List.length;s++)(i=this._updates0List[s])&&(i.paused=!0,n.push(i.target));for(s=0;s<this._updatesPosList.length;s++)(i=this._updatesPosList[s])&&i.priority>=t&&(i.paused=!0,n.push(i.target));return n},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assertID(t,1503);var e=t._id,t=(e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),this._hashForTimers[e]),t=(t&&(t.paused=!0),this._hashForUpdates[e]);t&&(t.entry.paused=!0)},resumeTarget:function(t){cc.assertID(t,1504);var e=t._id,t=(e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),this._hashForTimers[e]),t=(t&&(t.paused=!1),this._hashForUpdates[e]);t&&(t.entry.paused=!1)},isTargetPaused:function(t){cc.assertID(t,1505);var e=t._id,t=(e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),this._hashForTimers[e]);if(t)return t.paused;t=this._hashForUpdates[e];return!!t&&t.entry.paused}},cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1,e.exports=cc.Scheduler},{"./platform/id-generater":246,"./platform/js":250}],76:[function(t,e,i){"use strict";t=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset",extends:t,ctor:function(){this.loaded=!0,this.url=""},properties:{nativeUrl:{get:function(){if(this._native){var t,e=this._native;if(47===e.charCodeAt(0))return e.slice(1);if(cc.AssetLibrary)return t=cc.AssetLibrary.getLibUrlNoExt(this._uuid,!0),46===e.charCodeAt(0)?t+e:t+"/"+e;cc.errorID(6400)}return""},visible:!1},_native:"",_nativeAsset:{get:function(){return this._$nativeAsset},set:function(t){this._$nativeAsset=t}}},statics:{deserialize:!1,preventDeferredLoadDependents:!1,preventPreloadNativeObject:!1},toString:function(){return this.nativeUrl},serialize:!1,createNode:null,_setRawAsset:function(t,e){this._native=!1!==e?t||void 0:"/"+t}}),e.exports=cc.Asset},{"./CCRawAsset":84}],77:[function(t,e,i){"use strict";var n=t("./CCAsset"),t=t("../event/event-target"),r=cc.Enum({WEB_AUDIO:0,DOM_AUDIO:1}),s=cc.Class({name:"cc.AudioClip",extends:n,mixins:[t],ctor:function(){this.loaded=!1,this._audio=null},properties:{loadMode:{default:r.WEB_AUDIO,type:r},_nativeAsset:{get:function(){return this._audio},set:function(t){t instanceof cc.AudioClip?this._audio=t._nativeAsset:this._audio=t,this._audio&&(this.loaded=!0,this.emit("load"))},override:!0}},statics:{LoadMode:r,_loadByUrl:function(i,n){var r=cc.loader.getItem(i)||cc.loader.getItem(i+"?useDom=1");r&&r.complete?r._owner instanceof s?n(null,r._owner):n(null,r.content):cc.loader.load(i,function(t,e){if(t)return n(t);r=cc.loader.getItem(i)||cc.loader.getItem(i+"?useDom=1"),n(null,r.content)})}},destroy:function(){cc.audioEngine.uncache(this),this._super()}});cc.AudioClip=s,e.exports=s},{"../event/event-target":156,"./CCAsset":76}],78:[function(t,e,i){"use strict";function s(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0}function a(t){this._letterDefinitions={},this._texture=t}a.prototype={constructor:a,addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e},cloneLetterDefinition:function(){var t,e={};for(t in this._letterDefinitions){var i=new s;cc.js.mixin(i,this._letterDefinitions[t]),e[t]=i}return e},getTexture:function(){return this._texture},getLetter:function(t){return this._letterDefinitions[t]},getLetterDefinitionForChar:function(t){t=t.charCodeAt(0);return this._letterDefinitions.hasOwnProperty(t)?this._letterDefinitions[t]:null},clear:function(){this._letterDefinitions={}}};var n=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null,_fontDefDictionary:null},onLoad:function(){var t=this.spriteFrame,t=(!this._fontDefDictionary&&t&&(this._fontDefDictionary=new a(t._texture)),this._fntConfig);if(t){var e,i=t.fontDefDictionary;for(e in i){var n=new s,r=i[e].rect;n.offsetX=i[e].xOffset,n.offsetY=i[e].yOffset,n.w=r.width,n.h=r.height,n.u=r.x,n.v=r.y,n.textureID=0,n.valid=!0,n.xAdvance=i[e].xAdvance,this._fontDefDictionary.addLetterDefinitions(e,n)}}}});cc.BitmapFont=n,cc.BitmapFont.FontLetterDefinition=s,cc.BitmapFont.FontAtlas=a,e.exports=n},{}],79:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.BufferAsset",extends:cc.Asset,ctor:function(){this._buffer=null},properties:{_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t},override:!0},buffer:function(){return this._buffer}}});cc.BufferAsset=e.exports=n},{}],80:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=e.exports=n},{}],81:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.JsonAsset",extends:cc.Asset,properties:{json:null}});e.exports=cc.JsonAsset=n},{}],82:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont,onLoad:function(){this.spriteFrame?this._fntConfig?this._super():cc.warnID(9101,this.name):cc.warnID(9100,this.name)}});cc.LabelAtlas=n,e.exports=n},{}],83:[function(e,t,i){"use strict";var n=cc.Enum({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),r=cc.Class({name:"cc.Prefab",extends:cc.Asset,ctor:function(){this._createFunction=null,this._instantiatedTimes=0},properties:{data:null,optimizationPolicy:n.AUTO,asyncLoadAssets:!1,readonly:{default:!1,editorOnly:!0}},statics:{OptimizationPolicy:n,OptimizationPolicyThreshold:3},createNode:!1,compileCreateFunction:function(){var t=e("../platform/instantiate-jit");this._createFunction=t.compile(this.data)},_doInstantiate:function(t){return this.data._prefab?this.data._prefab._synced=!0:cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},_instantiate:function(){var t;return this.optimizationPolicy!==n.SINGLE_INSTANCE&&(this.optimizationPolicy===n.MULTI_INSTANCE||this._instantiatedTimes+1>=r.OptimizationPolicyThreshold)?(t=this._doInstantiate(),this.data._instantiate(t)):(this.data._prefab._synced=!0,t=this.data._instantiate()),++this._instantiatedTimes,t},destroy:function(){this.data&&this.data.destroy(),this._super()}});cc.Prefab=t.exports=r,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{"../platform/instantiate-jit":248}],84:[function(t,e,i){"use strict";var n=t("../platform/CCObject"),r=t("../platform/js");cc.RawAsset=cc.Class({name:"cc.RawAsset",extends:n,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})}}),r.value(cc.RawAsset,"isRawAssetType",function(t){return r.isChildClassOf(t,cc.RawAsset)&&!r.isChildClassOf(t,cc.Asset)}),r.value(cc.RawAsset,"wasRawAssetType",function(t){return t===cc.Texture2D||t===cc.AudioClip||t===cc.ParticleAsset||t===cc.Asset}),e.exports=cc.RawAsset},{"../platform/CCObject":236,"../platform/js":250}],85:[function(t,e,i){"use strict";var s=(n=t("../../renderer/gfx"))&&n.__esModule?n:{default:n},a=t("../renderer"),n=t("./CCTexture2D"),t=cc.Enum({RB_FMT_D24S8:s.default.RB_FMT_D24S8,RB_FMT_S8:s.default.RB_FMT_S8,RB_FMT_D16:s.default.RB_FMT_D16}),n=cc.Class({name:"cc.RenderTexture",extends:n,statics:{DepthStencilFormat:t},ctor:function(){this._framebuffer=null},initWithSize:function(t,e,i){this.width=Math.floor(t||cc.visibleRect.width),this.height=Math.floor(e||cc.visibleRect.height),this._resetUnderlyingMipmaps();var n,r={colors:[this._texture]};this._depthStencilBuffer&&this._depthStencilBuffer.destroy(),i&&(n=new s.default.RenderBuffer(a.device,i,t,e),i===s.default.RB_FMT_D24S8?r.depthStencil=n:i===s.default.RB_FMT_S8?r.stencil=n:i===s.default.RB_FMT_D16&&(r.depth=n)),this._depthStencilBuffer=n,this._framebuffer&&this._framebuffer.destroy(),this._framebuffer=new s.default.FrameBuffer(a.device,t,e,r),this._packable=!1,this.loaded=!0,this.emit("load")},updateSize:function(t,e){this.width=Math.floor(t||cc.visibleRect.width),this.height=Math.floor(e||cc.visibleRect.height),this._resetUnderlyingMipmaps();var i=this._depthStencilBuffer;i&&i.update(this.width,this.height),this._framebuffer._width=t,this._framebuffer._height=e},drawTextureAt:function(t,e,i){t._image&&0!==t._image.width&&this._texture.updateSubImage({x:e,y:i,image:t._image,width:t.width,height:t.height,level:0,flipY:!1,premultiplyAlpha:t._premultiplyAlpha})},readPixels:function(t,e,i,n,r){if(!this._framebuffer||!this._texture)return t;e=e||0,i=i||0;var n=n||this.width,r=r||this.height,s=(t=t||new Uint8Array(n*r*4),cc.game._renderContext),a=s.getParameter(s.FRAMEBUFFER_BINDING);return s.bindFramebuffer(s.FRAMEBUFFER,this._framebuffer.getHandle()),s.readPixels(e,i,n,r,s.RGBA,s.UNSIGNED_BYTE,t),s.bindFramebuffer(s.FRAMEBUFFER,a),t},destroy:function(){this._super(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null)}});cc.RenderTexture=e.exports=n},{"../../renderer/gfx":363,"../renderer":262,"./CCTexture2D":92}],86:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=n,e.exports=n},{}],87:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Script",extends:cc.Asset}),r=(cc._Script=n,cc.Class({name:"cc.JavaScript",extends:n})),r=(cc._JavaScript=r,cc.Class({name:"cc.CoffeeScript",extends:n})),r=(cc._CoffeeScript=r,cc.Class({name:"cc.TypeScript",extends:n}));cc._TypeScript=r},{}],88:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);return 0<t.length&&(t=this._spriteFrames[t[0]])?t.getTexture():null},getSpriteFrame:function(t){var e=this._spriteFrames[t];return e?(e.name||(e.name=t),e):null},getSpriteFrames:function(){var t,e=[];for(t in this._spriteFrames)e.push(this.getSpriteFrame(t));return e}});cc.SpriteAtlas=n,e.exports=n},{}],89:[function(t,e,i){"use strict";var s=t("../event/event-target"),n=t("../utils/texture-util"),y=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],r=cc.Class({name:"cc.SpriteFrame",extends:t("../assets/CCAsset"),mixins:[s],properties:{_textureSetter:{set:function(t){t&&(this._texture!==t&&this._refreshTexture(t),this._textureFilename=t.url)}},insetTop:{get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]=t,this._texture&&this._calculateSlicedUV()}},insetBottom:{get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]=t,this._texture&&this._calculateSlicedUV()}},insetLeft:{get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]=t,this._texture&&this._calculateSlicedUV()}},insetRight:{get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]=t,this._texture&&this._calculateSlicedUV()}}},ctor:function(){s.call(this);var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4];this._rect=null,this.uv=[],this._texture=null,this._original=null,this._offset=null,this._originalSize=null,this._rotated=!1,this._flipX=!1,this._flipY=!1,this.vertices=null,this._capInsets=[0,0,0,0],this.uvSliced=[],this._textureFilename="",void 0!==t&&this.setTexture(t,e,i,n,r)},textureLoaded:function(){return this._texture&&this._texture.loaded},onTextureLoaded:function(t,e){return this.textureLoaded()?(t.call(e),!0):(this.once("load",t,e),this.ensureLoadTexture(),!1)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t,this._texture&&this._calculateUV()},isFlipX:function(){return this._flipX},isFlipY:function(){return this._flipY},setFlipX:function(t){this._flipX=t,this._texture&&this._calculateUV()},setFlipY:function(t){this._flipY=t,this._texture&&this._calculateUV()},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t,this._texture&&this._calculateUV()},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_textureLoadedCallback:function(){var t,e=this._texture;e&&(t=e.width,e=e.height,this._rect?this._checkRect(this._texture):this._rect=cc.rect(0,0,t,e),this._originalSize||this.setOriginalSize(cc.size(t,e)),this._offset||this.setOffset(cc.v2(0,0)),this._calculateUV(),this.emit("load"))},_refreshTexture:function(t){(this._texture=t).loaded?this._textureLoadedCallback():t.once("load",this._textureLoadedCallback,this)},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new r(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(t,e,i,n,r){this._rect=e||null,n?this.setOffset(n):this._offset=null,r?this.setOriginalSize(r):this._originalSize=null,this._rotated=i||!1;e=t;return"string"==typeof e&&e&&(this._textureFilename=e,this._loadTexture()),e instanceof cc.Texture2D&&this._texture!==e&&this._refreshTexture(e),!0},_loadTexture:function(){var t;this._textureFilename&&(t=n.loadImage(this._textureFilename),this._refreshTexture(t))},ensureLoadTexture:function(){this._texture?this._texture.loaded||(this._refreshTexture(this._texture),n.postLoadTexture(this._texture)):this._textureFilename&&this._loadTexture()},_checkRect:function(t){var e=this._rect,i=e.x,n=e.y;this._rotated?(i+=e.height,n+=e.width):(i+=e.width,n+=e.height),i>t.width&&cc.errorID(3300,t.url+"/"+this.name,i,t.width),n>t.height&&cc.errorID(3400,t.url+"/"+this.name,n,t.height)},_flipXY:function(t){var e;this._flipX&&(e=t[0],t[0]=t[1],t[1]=e,e=t[2],t[2]=t[3],t[3]=e),this._flipY&&(e=t[0],t[0]=t[2],t[2]=e,e=t[1],t[1]=t[3],t[3]=e)},_calculateSlicedUV:function(){var t=this._rect,e=this._texture.width,i=this._texture.height,n=this._capInsets[0],r=this._capInsets[2],r=t.width-n-r,s=this._capInsets[1],a=this._capInsets[3],o=t.height-s-a,l=this.uvSliced;if(l.length=0,this._rotated){y[0].u=t.x/e,y[1].u=(t.x+a)/e,y[2].u=(t.x+a+o)/e,y[3].u=(t.x+t.height)/e,y[3].v=t.y/i,y[2].v=(t.y+n)/i,y[1].v=(t.y+n+r)/i,y[0].v=(t.y+t.width)/i,this._flipXY(y);for(var h=0;h<4;++h)for(var c=y[h],u=0;u<4;++u){var _=y[3-u];l.push({u:c.u,v:_.v})}}else{y[0].u=t.x/e,y[1].u=(t.x+n)/e,y[2].u=(t.x+n+r)/e,y[3].u=(t.x+t.width)/e,y[3].v=t.y/i,y[2].v=(t.y+s)/i,y[1].v=(t.y+s+o)/i,y[0].v=(t.y+t.height)/i,this._flipXY(y);for(var d=0;d<4;++d)for(var f=y[d],p=0;p<4;++p){var m=y[p];l.push({u:m.u,v:f.v})}}},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_calculateUV:function(){var t,e,i,n=this._rect,r=this._texture,s=this.uv,a=r.width,o=r.height,l=(this._rotated?(r=0===a?0:n.x/a,i=0===a?0:(n.x+n.height)/a,e=0===o?0:(n.y+n.width)/o,t=0===o?0:n.y/o,s[0]=r,s[1]=t,s[2]=r,s[3]=e,s[4]=i,s[5]=t,s[6]=i,s[7]=e):(r=0===a?0:n.x/a,t=0===a?0:(n.x+n.width)/a,i=0===o?0:(n.y+n.height)/o,e=0===o?0:n.y/o,s[0]=r,s[1]=i,s[2]=t,s[3]=i,s[4]=r,s[5]=e,s[6]=t,s[7]=e),this._flipX&&(n=s[0],s[0]=s[2],s[2]=n,n=s[1],s[1]=s[3],s[3]=n,n=s[4],s[4]=s[6],s[6]=n,n=s[5],s[5]=s[7],s[7]=n),this._flipY&&(i=s[0],s[0]=s[4],s[4]=i,i=s[1],s[1]=s[5],s[5]=i,i=s[2],s[2]=s[6],s[6]=i,i=s[3],s[3]=s[7],s[7]=i),this.vertices);if(l){l.nu.length=0;for(var h=l.nv.length=0;h<l.u.length;h++)l.nu[h]=l.u[h]/a,l.nv[h]=l.v[h]/o}this._calculateSlicedUV()},_serialize:!1,_deserialize:function(t,e){var i=t.rect,i=(i&&(this._rect=new cc.Rect(i[0],i[1],i[2],i[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name,t.capInsets),i=(i&&(this._capInsets[0]=i[0],this._capInsets[1]=i[1],this._capInsets[2]=i[2],this._capInsets[3]=i[3]),this.vertices=t.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[]),t.texture);i&&e.result.push(this,"_textureSetter",i)}}),t=r.prototype;t.copyWithZone=t.clone,t.copy=t.clone,t.initWithTexture=t.setTexture,cc.SpriteFrame=r,e.exports=r},{"../assets/CCAsset":76,"../event/event-target":156,"../utils/texture-util":323}],90:[function(t,e,i){"use strict";t=t("./CCFont"),t=cc.Class({name:"cc.TTFFont",extends:t,properties:{_fontFamily:null,_nativeAsset:{type:cc.String,get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"},override:!0}}});cc.TTFFont=e.exports=t},{"./CCFont":80}],91:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.TextAsset",extends:cc.Asset,properties:{text:""},toString:function(){return this.text}});e.exports=cc.TextAsset=n},{}],92:[function(t,e,i){"use strict";var n=(n=t("../../renderer/gfx"))&&n.__esModule?n:{default:n},r=t("../event/event-target"),s=t("../renderer"),a=(t("../platform/CCClass"),new(t("../platform/id-generater"))("Tex")),o=1024,f=cc.Enum({RGB565:n.default.TEXTURE_FMT_R5_G6_B5,RGB5A1:n.default.TEXTURE_FMT_R5_G5_B5_A1,RGBA4444:n.default.TEXTURE_FMT_R4_G4_B4_A4,RGB888:n.default.TEXTURE_FMT_RGB8,RGBA8888:n.default.TEXTURE_FMT_RGBA8,RGBA32F:n.default.TEXTURE_FMT_RGBA32F,A8:n.default.TEXTURE_FMT_A8,I8:n.default.TEXTURE_FMT_L8,AI8:n.default.TEXTURE_FMT_L8_A8,RGB_PVRTC_2BPPV1:n.default.TEXTURE_FMT_RGB_PVRTC_2BPPV1,RGBA_PVRTC_2BPPV1:n.default.TEXTURE_FMT_RGBA_PVRTC_2BPPV1,RGB_A_PVRTC_2BPPV1:o++,RGB_PVRTC_4BPPV1:n.default.TEXTURE_FMT_RGB_PVRTC_4BPPV1,RGBA_PVRTC_4BPPV1:n.default.TEXTURE_FMT_RGBA_PVRTC_4BPPV1,RGB_A_PVRTC_4BPPV1:+o,RGB_ETC1:n.default.TEXTURE_FMT_RGB_ETC1,RGBA_ETC1:1026,RGB_ETC2:n.default.TEXTURE_FMT_RGB_ETC2,RGBA_ETC2:n.default.TEXTURE_FMT_RGBA_ETC2}),l=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),h=cc.Enum({LINEAR:9729,NEAREST:9728}),c={9728:0,9729:1},u=[],_={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,genMipmaps:void 0,images:void 0,image:void 0,flipY:void 0,premultiplyAlpha:void 0};function d(){for(var t in _)_[t]=void 0;return u.length=0,_.images=u,_}var p=cc.Class({name:"cc.Texture2D",extends:t("../assets/CCAsset"),mixins:[r],properties:{_nativeAsset:{get:function(){return this._image},set:function(t){t._compressed&&t._data?this.initWithData(t._data,this._format,t.width,t.height):this.initWithElement(t)},override:!0},_format:f.RGBA8888,_premultiplyAlpha:!1,_flipY:!1,_minFilter:h.LINEAR,_magFilter:h.LINEAR,_mipFilter:h.LINEAR,_wrapS:l.CLAMP_TO_EDGE,_wrapT:l.CLAMP_TO_EDGE,_genMipmaps:!1,genMipmaps:{get:function(){return this._genMipmaps},set:function(t){var e;this._genMipmaps!==t&&((e=d()).genMipmaps=t,this.update(e))}},_packable:!0,packable:{get:function(){return this._packable},set:function(t){this._packable=t}}},statics:{PixelFormat:f,WrapMode:l,Filter:h,_FilterIndex:c,extnames:[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm"]},ctor:function(){this._id=a.getNewId(),this.loaded=!1,this.width=0,this.height=0,this._hashDirty=!0,this._hash=0,this._texture=null},getImpl:function(){return this._texture},getId:function(){return this._id},toString:function(){return this.url||""},update:function(t){var e;t&&(e=!1,void 0!==t.width&&(this.width=t.width),void 0!==t.height&&(this.height=t.height),void 0!==t.minFilter&&(this._minFilter=t.minFilter,t.minFilter=c[t.minFilter]),void 0!==t.magFilter&&(this._magFilter=t.magFilter,t.magFilter=c[t.magFilter]),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter,t.mipFilter=c[t.mipFilter]),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format),void 0!==t.flipY&&(this._flipY=t.flipY,e=!0),void 0!==t.premultiplyAlpha&&(this._premultiplyAlpha=t.premultiplyAlpha,e=!0),void 0!==t.genMipmaps&&(this._genMipmaps=t.genMipmaps),e&&this._image&&(t.image=this._image),t.images&&0<t.images.length?this._image=t.images[0]:void 0!==t.image&&(this._image=t.image,t.images||(u.length=0,t.images=u),t.images.push(t.image)),this._texture&&this._texture.update(t),this._hashDirty=!0)},initWithElement:function(t){var e;t&&((this._image=t).complete||t instanceof HTMLCanvasElement?this.handleLoadedTexture():(e=this,t.addEventListener("load",function(){e.handleLoadedTexture()}),t.addEventListener("error",function(t){cc.warnID(3119,t.message)})))},initWithData:function(t,e,i,n){var r=d();return r.image=t,r.images=[r.image],r.genMipmaps=this._genMipmaps,r.premultiplyAlpha=this._premultiplyAlpha,r.flipY=this._flipY,r.minFilter=c[this._minFilter],r.magFilter=c[this._magFilter],r.wrapS=this._wrapS,r.wrapT=this._wrapT,r.format=this._getGFXPixelFormat(e),r.width=i,r.height=n,this._texture?this._texture.update(r):this._texture=new s.Texture2D(s.device,r),this.width=i,this.height=n,this._checkPackable(),this.loaded=!0,this.emit("load"),!0},getHtmlElementObj:function(){return this._image},destroy:function(){this._packable&&cc.dynamicAtlasManager&&cc.dynamicAtlasManager.deleteAtlasTexture(this),this._image=null,this._texture&&this._texture.destroy(),this._super()},getPixelFormat:function(){return this._format},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1},handleLoadedTexture:function(){var t;this._image&&this._image.width&&this._image.height&&(this.width=this._image.width,this.height=this._image.height,(t=d()).image=this._image,t.images=[t.image],t.width=this.width,t.height=this.height,t.genMipmaps=this._genMipmaps,t.format=this._getGFXPixelFormat(this._format),t.premultiplyAlpha=this._premultiplyAlpha,t.flipY=this._flipY,t.minFilter=c[this._minFilter],t.magFilter=c[this._magFilter],t.wrapS=this._wrapS,t.wrapT=this._wrapT,this._texture?this._texture.update(t):this._texture=new s.Texture2D(s.device,t),this._checkPackable(),this.loaded=!0,this.emit("load"),cc.macro.CLEANUP_IMAGE_CACHE&&this._image instanceof HTMLImageElement&&this._clearImage())},description:function(){return"<cc.Texture2D | Name = "+this.url+" | Dimensions = "+this.width+" x "+this.height+">"},releaseTexture:function(){this._image=null,this._texture&&this._texture.destroy()},setWrapMode:function(t,e){var i;this._wrapS===t&&this._wrapT===e||((i=d()).wrapS=t,i.wrapT=e,this.update(i))},setFilters:function(t,e){var i;this._minFilter===t&&this._magFilter===e||((i=d()).minFilter=t,i.magFilter=e,this.update(i))},setFlipY:function(t){var e;this._flipY!==t&&((e=d()).flipY=t,this.update(e))},setPremultiplyAlpha:function(t){var e;this._premultiplyAlpha!==t&&((e=d()).premultiplyAlpha=t,this.update(e))},_checkPackable:function(){var t,e,i=cc.dynamicAtlasManager;i&&(this._isCompressed()?this._packable=!1:(t=this.width,e=this.height,!this._image||t>i.maxFrameSize||e>i.maxFrameSize||this._getHash()!==i.Atlas.DEFAULT_HASH?this._packable=!1:this._image&&this._image instanceof HTMLCanvasElement&&(this._packable=!0)))},_getOpts:function(){var t=d();return t.width=this.width,t.height=this.height,t.genMipmaps=this._genMipmaps,t.format=this._format,t.premultiplyAlpha=this._premultiplyAlpha,t.anisotropy=this._anisotropy,t.flipY=this._flipY,t.minFilter=c[this._minFilter],t.magFilter=c[this._magFilter],t.mipFilter=c[this._mipFilter],t.wrapS=this._wrapS,t.wrapT=this._wrapT,t},_getGFXPixelFormat:function(t){return t===f.RGBA_ETC1?t=f.RGB_ETC1:t===f.RGB_A_PVRTC_4BPPV1?t=f.RGB_PVRTC_4BPPV1:t===f.RGB_A_PVRTC_2BPPV1&&(t=f.RGB_PVRTC_2BPPV1),t},_resetUnderlyingMipmaps:function(t){var e=this._getOpts();e.images=t||[null],this._texture?this._texture.update(e):this._texture=new s.Texture2D(s.device,e)},_serialize:!1,_deserialize:function(t,e){var i=cc.renderer.device,t=t.split(","),n=t[0];if(n){for(var r=n.split("_"),s="",a="",o=999,l=this._format,h=cc.macro.SUPPORT_TEXTURE_FORMATS,c=0;c<r.length;c++){var u=r[c].split("@"),_=u[0],_=p.extnames[_.charCodeAt(0)-48]||_,d=h.indexOf(_);-1!==d&&d<o?(u=u[1]?parseInt(u[1]):this._format,".pvr"===_&&!i.ext("WEBGL_compressed_texture_pvrtc")||(u!==f.RGB_ETC1&&u!==f.RGBA_ETC1||i.ext("WEBGL_compressed_texture_etc1"))&&(u!==f.RGB_ETC2&&u!==f.RGBA_ETC2||i.ext("WEBGL_compressed_texture_etc"))&&(".webp"!==_||cc.sys.capabilities.webp)&&(o=d,a=_,l=u)):s=s||_}a?(this._setRawAsset(a),this._format=l):(this._setRawAsset(s),cc.warnID(3120,e.customEnv.url,s,s))}8===t.length&&(this._minFilter=parseInt(t[1]),this._magFilter=parseInt(t[2]),this._wrapS=parseInt(t[3]),this._wrapT=parseInt(t[4]),this._premultiplyAlpha=49===t[5].charCodeAt(0),this._genMipmaps=49===t[6].charCodeAt(0),this._packable=49===t[7].charCodeAt(0))},_getHash:function(){if(!this._hashDirty)return this._hash;var t=this._genMipmaps?1:0,e=this._premultiplyAlpha?1:0,i=this._flipY?1:0,n=this._minFilter===h.LINEAR?1:2,r=this._magFilter===h.LINEAR?1:2,s=this._wrapS===l.REPEAT?1:this._wrapS===l.CLAMP_TO_EDGE?2:3,a=this._wrapT===l.REPEAT?1:this._wrapT===l.CLAMP_TO_EDGE?2:3,o=this._format;return this._image,this._hash=Number(""+n+r+o+s+a+t+e+i),this._hashDirty=!1,this._hash},_isCompressed:function(){return this._format<f.A8||this._format>f.RGBA32F},_clearImage:function(){cc.loader.removeItem(this._image.id||this._image.src),this._image.src=""}});cc.Texture2D=e.exports=p},{"../../renderer/gfx":363,"../assets/CCAsset":76,"../event/event-target":156,"../platform/CCClass":230,"../platform/id-generater":246,"../renderer":262}],93:[function(t,e,i){"use strict";t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCScripts"),t("./CCSceneAsset"),t("./CCSpriteFrame"),t("./CCTexture2D"),t("./CCRenderTexture"),t("./CCTTFFont"),t("./CCSpriteAtlas"),t("./CCBitmapFont"),t("./CCLabelAtlas"),t("./CCTextAsset"),t("./CCJsonAsset"),t("./CCBufferAsset"),t("./material")},{"./CCAsset":76,"./CCAudioClip":77,"./CCBitmapFont":78,"./CCBufferAsset":79,"./CCFont":80,"./CCJsonAsset":81,"./CCLabelAtlas":82,"./CCPrefab":83,"./CCRawAsset":84,"./CCRenderTexture":85,"./CCSceneAsset":86,"./CCScripts":87,"./CCSpriteAtlas":88,"./CCSpriteFrame":89,"./CCTTFFont":90,"./CCTextAsset":91,"./CCTexture2D":92,"./material":100}],94:[function(t,e,i){"use strict";var n=(n=t("../CCAsset"))&&n.__esModule?n:{default:n},r=t("./effect-parser"),t=cc.Class({name:"cc.EffectAsset",extends:n.default,ctor:function(){this._effect=null},properties:{properties:Object,techniques:[],shaders:[]},onLoad:function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){for(var t=cc.renderer._forward._programLib,e=0;e<this.shaders.length;e++)t.define(this.shaders[e]);this._initEffect()}},_initEffect:function(){this._effect||(this._effect=(0,r.parseEffect)(this),Object.freeze(this._effect))},getInstantiatedEffect:function(){return this._initEffect(),this._effect.clone()},getEffect:function(){return this._initEffect(),this._effect}});e.exports=cc.EffectAsset=t},{"../CCAsset":76,"./effect-parser":97}],95:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../CCAsset"),o=t("../CCTexture2D"),l=o.PixelFormat,r=t("./CCEffectAsset"),h=t("../../utils/texture-util"),c=cc.gfx,t=cc.Enum({SPRITE:"2d-sprite",GRAY_SPRITE:"2d-gray-sprite",UNLIT:"unlit"}),s=cc.Class({name:"cc.Material",extends:n,ctor:function(){this._manualHash=!1,this._dirty=!0,this._effect=null},properties:{_defines:{default:void 0,type:Object},_props:{default:void 0,type:Object},_effectAsset:{type:r,default:null},_techniqueIndex:0,_techniqueData:Object,effectName:void 0,effectAsset:{get:function(){return this._effectAsset},set:function(t){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&((this._effectAsset=t)?this._effect=this._effectAsset.getInstantiatedEffect():cc.error("Can not set an empty effect asset."))}},effect:{get:function(){return this._effect}},techniqueIndex:{get:function(){return this._techniqueIndex},set:function(t){this._techniqueIndex=t,this._effect.switchTechnique(t)}}},statics:{getBuiltinMaterial:function(t){return cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Material:cc.AssetLibrary.getBuiltin("material","builtin-"+t)},BUILTIN_NAME:t,createWithBuiltin:function(t,e){void 0===e&&(e=0);t=cc.AssetLibrary.getBuiltin("effect","builtin-"+t);return s.create(t,e)},create:function(t,e){if(void 0===e&&(e=0),!t)return null;var i=new s;return i.effectAsset=t,i.techniqueIndex=e,i}},setProperty:function(t,e,i,n){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){if("string"==typeof i&&(i=parseInt(i)),e instanceof o){var r=e.getPixelFormat(),r=r===l.RGBA_ETC1||r===l.RGB_A_PVRTC_4BPPV1||r===l.RGB_A_PVRTC_2BPPV1,s="CC_USE_ALPHA_ATLAS_"+t,a=this.getDefine(s,i);if((r||a)&&this.define(s,r),!e.loaded)return e.once("load",function(){this._effect.setProperty(t,e,i)},this),void h.postLoadTexture(e)}this._effect.setProperty(t,e,i,n)}},getProperty:function(t,e){return"string"==typeof e&&(e=parseInt(e)),this._effect.getProperty(t,e)},define:function(t,e,i,n){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&("string"==typeof i&&(i=parseInt(i)),this._effect.define(t,e,i,n))},getDefine:function(t,e){return"string"==typeof e&&(e=parseInt(e)),this._effect.getDefine(t,e)},setCullMode:function(t,e){void 0===t&&(t=c.CULL_BACK),this._effect.setCullMode(t,e)},setDepth:function(t,e,i,n){void 0===i&&(i=c.DS_FUNC_LESS),this._effect.setDepth(t=void 0===t?!1:t,e=void 0===e?!1:e,i,n)},setBlend:function(t,e,i,n,r,s,a,o,l){void 0===e&&(e=c.BLEND_FUNC_ADD),void 0===i&&(i=c.BLEND_SRC_ALPHA),void 0===n&&(n=c.BLEND_ONE_MINUS_SRC_ALPHA),void 0===r&&(r=c.BLEND_FUNC_ADD),void 0===s&&(s=c.BLEND_SRC_ALPHA),void 0===a&&(a=c.BLEND_ONE_MINUS_SRC_ALPHA),this._effect.setBlend(t=void 0===t?!1:t,e,i,n,r,s,a,o=void 0===o?4294967295:o,l)},setStencilEnabled:function(t,e){void 0===t&&(t=c.STENCIL_INHERIT),this._effect.setStencilEnabled(t,e)},setStencil:function(t,e,i,n,r,s,a,o,l){void 0===t&&(t=c.STENCIL_INHERIT),void 0===e&&(e=c.DS_FUNC_ALWAYS),void 0===r&&(r=c.STENCIL_OP_KEEP),void 0===s&&(s=c.STENCIL_OP_KEEP),void 0===a&&(a=c.STENCIL_OP_KEEP),this._effect.setStencil(t,e,i=void 0===i?0:i,n=void 0===n?255:n,r,s,a,o=void 0===o?255:o,l)},updateHash:function(t){this._manualHash=t,this._effect&&this._effect.updateHash(t)},getHash:function(){return this._manualHash||this._effect&&this._effect.getHash()},onLoad:function(){if(this.effectAsset=this._effectAsset,this._effect){this._techniqueIndex&&this._effect.switchTechnique(this._techniqueIndex),this._techniqueData=this._techniqueData||{};var t,e=this._techniqueData;for(t in e){var i=e[t=parseInt(t)];if(i){for(var n in i.defines)this.define(n,i.defines[n],t);for(var r in i.props)this.setProperty(r,i.props[r],t)}}}}});i.default=s,cc.Material=s,e.exports=i.default},{"../../utils/texture-util":323,"../CCAsset":76,"../CCTexture2D":92,"./CCEffectAsset":94}],96:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=(t=t("../../../renderer/core/pass"))&&t.__esModule?t:{default:t};function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r,a=cc.gfx,o=((t=l.prototype)._createPassProp=function(t,e){var i,n=e._properties[t];if(n)return(i=Object.create(null)).name=t,i.type=n.type,n.value instanceof Float32Array?i.value=new Float32Array(n.value):i.value=n.value,e._properties[t]=i},t._setPassProperty=function(t,e,i,n){var r=i._properties.hasOwnProperty(t);if(r){if(r.value===e)return}else r=this._createPassProp(t,i);return this._dirty=!0,s.default.prototype.setProperty.call(i,t,e,n)},t.setProperty=function(t,e,i,n){var r=!1,s=this.passes,a=0,o=s.length;void 0!==i&&(o=(a=i)+1);for(var l=a;l<o;l++)this._setPassProperty(t,e,s[l],n)&&(r=!0);r||cc.warnID(9103,this.name,t)},t.getProperty=function(t,e){var i=this.passes;if(!(e>=i.length)){var n=0,r=i.length;void 0!==e&&(r=(n=e)+1);for(var s=n;s<r;s++){var a=i[s].getProperty(t);if(void 0!==a)return a}}},t.define=function(t,e,i,n){var r=!1,s=this.passes,a=0,o=s.length;void 0!==i&&(o=(a=i)+1);for(var l=a;l<o;l++)s[l].define(t,e,n)&&(r=!0);r||cc.warnID(9104,this.name,t)},t.getDefine=function(t,e){var i=this.passes;if(!(e>=i.length)){var n=0,r=i.length;void 0!==e&&(r=(n=e)+1);for(var s=n;s<r;s++){var a=i[s].getDefine(t);if(void 0!==a)return a}}},t.setCullMode=function(t,e){void 0===t&&(t=a.CULL_BACK);var i=this.passes,n=0,r=i.length;void 0!==e&&(r=(n=e)+1);for(var s=n;s<r;s++)i[s].setCullMode(t);this._dirty=!0},t.setDepth=function(t,e,i,n){var r=this.passes,s=0,a=r.length;void 0!==n&&(a=(s=n)+1);for(var o=s;o<a;o++)r[o].setDepth(t,e,i);this._dirty=!0},t.setBlend=function(t,e,i,n,r,s,a,o,l){var h=this.passes,c=0,u=h.length;void 0!==l&&(u=(c=l)+1);for(var _=c;_<u;_++)h[_].setBlend(t,e,i,n,r,s,a,o);this._dirty=!0},t.setStencilEnabled=function(t,e){void 0===t&&(t=a.STENCIL_INHERIT);var i=this.passes,n=0,r=i.length;void 0!==e&&(r=(n=e)+1);for(var s=n;s<r;s++)i[s].setStencilEnabled(t);this._dirty=!0},t.setStencil=function(t,e,i,n,r,s,a,o,l){var h=this.passes,c=0,u=h.length;void 0!==l&&(u=(c=l)+1);for(var _=c;_<u;_++){var d=h[_];d.setStencilFront(t,e,i,n,r,s,a,o),d.setStencilBack(t,e,i,n,r,s,a,o)}this._dirty=!0},t=l,(o=[{key:"name",get:function(){return this._name}},{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return[]}}])&&n(t.prototype,o),r&&n(t,r),l);function l(){this._dirty=!0,this._name="",this._technique=null}i.default=o,cc.EffectBase=o,e.exports=i.default},{"../../../renderer/core/pass":354}],97:[function(t,e,i){"use strict";i.__esModule=!0,i.parseEffect=function(t){var e=function(t){for(var e=t.techniques.length,i=new Array(e),n=0;n<e;++n){for(var r=t.techniques[n],s=r.name||n,a=r.passes.length,o=new Array(a),l=0;l<a;++l){var h=r.passes[l],c=h.name||l,u=t.name+"-"+s+"-"+c,_=h.stage||"opaque",d=function(t,e){var i,n=e.properties||{},r=v(e.program);for(i in n)!function(e){if(!r.uniforms.find(function(t){return t.name===e}))cc.warnID(9107,t.name,e)}(i);var s={};return r.uniforms.forEach(function(t){var e=t.name,i=s[e]=Object.assign({},t),e=n[e],e=(m.enums2default[t.type],e?e.type===y.default.PARAM_TEXTURE_2D?null:e.type===y.default.PARAM_INT||e.type===y.default.PARAM_FLOAT?Array.isArray(e.value)?e.value[0]:e.value:new Float32Array(e.value):m.enums2default[t.type]);i.value=e}),s}(t,h),f=function(t){var e={};return v(t.program).defines.forEach(function(t){e[t.name]=m.enums2default[t.type]}),e}(h),c=o[l]=new p.default(c,u,h.program,_,d,f),u=(h.rasterizerState&&c.setCullMode(h.rasterizerState.cullMode),h.blendState&&h.blendState.targets[0]),_=(u&&c.setBlend(u.blend,u.blendEq,u.blendSrc,u.blendDst,u.blendAlphaEq,u.blendSrcAlpha,u.blendDstAlpha,u.blendColor),h.depthStencilState);_&&(c.setDepth(_.depthTest,_.depthWrite,_.depthFunc),c.setStencilFront(_.stencilTest,_.stencilFuncFront,_.stencilRefFront,_.stencilMaskFront,_.stencilFailOpFront,_.stencilZFailOpFront,_.stencilZPassOpFront,_.stencilWriteMaskFront),c.setStencilBack(_.stencilTest,_.stencilFuncBack,_.stencilRefBack,_.stencilMaskBack,_.stencilFailOpBack,_.stencilZFailOpBack,_.stencilZPassOpBack,_.stencilWriteMaskBack))}i[n]=new g.default(s,o)}return i}(t);return new n.default(t.name,e,0,t)};var p=r(t("../../../renderer/core/pass")),m=t("../../../renderer/types"),y=r(t("../../../renderer/enums")),n=r(t("./effect")),g=r(t("../../../renderer/core/technique"));function r(t){return t&&t.__esModule?t:{default:t}}function v(t){return cc.renderer._forward._programLib.getTemplate(t)}},{"../../../renderer/core/pass":354,"../../../renderer/core/technique":356,"../../../renderer/enums":358,"../../../renderer/types":387,"./effect":99}],98:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=s(t("../../../renderer/murmurhash2_gc")),r=s(t("./utils")),t=s(t("./effect-base"));function s(t){return t&&t.__esModule?t:{default:t}}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}cc.gfx;o=t.default,t=o,(h=c).prototype=Object.create(t.prototype),(h.prototype.constructor=h).__proto__=t,h=c,(t=[{key:"effect",get:function(){return this._effect}},{key:"name",get:function(){return this._effect&&this._effect.name+" (variant)"}},{key:"passes",get:function(){return this._passes}},{key:"stagePasses",get:function(){return this._stagePasses}}])&&a(h.prototype,t),l&&a(h,l),(t=c.prototype)._onEffectChanged=function(){},t.init=function(t){if(t instanceof c&&(t=t.effect),this._effect=t,this._dirty=!0,t){var e=t.passes,i=this._passes;i.length=0;for(var n=this._stagePasses={},r=0;r<e.length;r++){var s=i[r]=Object.setPrototypeOf({},e[r]);s._properties=Object.setPrototypeOf({},e[r]._properties),s._defines=Object.setPrototypeOf({},e[r]._defines),n[s._stage]||(n[s._stage]=[]),n[s._stage].push(s)}}},t.updateHash=function(t){},t.getHash=function(){if(!this._dirty)return this._hash;this._dirty=!1;var t="",e=(t+=r.default.serializePasses(this._passes),this._effect);return e&&(t+=r.default.serializePasses(e.passes)),this._hash=(0,n.default)(t,666),this.updateHash(this._hash),this._hash};var o,l,h=c;function c(t){var e;return(e=o.call(this)||this)._effect=void 0,e._passes=[],e._stagePasses={},e._hash=0,e.init(t),e}i.default=h,cc.EffectVariant=h,e.exports=i.default},{"../../../renderer/murmurhash2_gc":381,"./effect-base":96,"./utils":103}],99:[function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.__esModule=!0,i.default=void 0;s=((t=t("./effect-base"))&&t.__esModule?t:{default:t}).default,t=s,(a=o).prototype=Object.create(t.prototype),(a.prototype.constructor=a).__proto__=t,a=o,(t=[{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return this._technique.passes}}])&&n(a.prototype,t),r&&n(a,r),(t=o.prototype).init=function(t,e,i,n,r){this._name=t,this._techniques=e,this._technique=e[i],this._asset=n},t.switchTechnique=function(t){t>=this._techniques.length?cc.warn("Can not switch to technique with index ["+t+"]"):this._technique=this._techniques[t]},t.clear=function(){this._techniques=[]},t.clone=function(){for(var t=[],e=0;e<this._techniques.length;e++)t.push(this._techniques[e].clone());var i=this._techniques.indexOf(this._technique);return new o(this._name,t,i,this._asset)};var s,r,a=o;function o(t,e,i,n){var r;return(r=s.call(this)||this)._techniques=[],r._asset=null,r.init(t,e,i,n,!0),r}i.default=a,cc.Effect=a,e.exports=i.default},{"./effect-base":96}],100:[function(t,e,i){"use strict";t("./CCEffectAsset"),t("./CCMaterial"),t("./material-variant")},{"./CCEffectAsset":94,"./CCMaterial":95,"./material-variant":102}],101:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=n(t("./utils")),t=n(t("../../utils/pool"));function n(t){return t&&t.__esModule?t:{default:t}}r=t.default,o=r,(a=l).prototype=Object.create(o.prototype),(a.prototype.constructor=a).__proto__=o,(a=l.prototype).get=function(t,e){var i,n,r=this._pool;if(t instanceof cc.MaterialVariant){if(!t._owner)return t._owner=e,t;if(t._owner===e)return t;t=t.material}return this.enabled&&r[i=t.effectAsset._uuid]&&(n=s.default.serializeDefines(t._effect._defines)+s.default.serializeTechniques(t._effect._techniques),n=r[i][n]&&r[i][n].pop()),n?this.count--:((n=new cc.MaterialVariant(t))._name=t._name+" (Instance)",n._uuid=t._uuid),n._owner=e,n},a.put=function(t){var e,i,n;this.enabled&&t._owner&&((e=this._pool)[i=t.effectAsset._uuid]||(e[i]={}),n=s.default.serializeDefines(t._effect._defines)+s.default.serializeTechniques(t._effect._techniques),e[i][n]||(e[i][n]=[]),this.count>this.maxSize||(this._clean(t),e[i][n].push(t),this.count++))},a.clear=function(){this._pool={},this.count=0},a._clean=function(t){t._owner=null};var r,a,o=new l;function l(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(t=r.call.apply(r,[this].concat(i))||this).enabled=!1,t._pool={},t}t.default.register("material",o),i.default=o,e.exports=i.default},{"../../utils/pool":317,"./utils":103}],102:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=a(t("./CCMaterial")),r=a(t("./effect-variant")),s=a(t("./material-pool"));function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l,h,c=(0,cc._decorator.ccclass)("cc.MaterialVariant")((l=n.default,t=l,(c=u).prototype=Object.create(t.prototype),(c.prototype.constructor=c).__proto__=t,u.createWithBuiltin=function(t,e){return u.create(n.default.getBuiltinMaterial(t),e)},u.create=function(t,e){return t?s.default.get(t,e):null},c=u,(t=[{key:"uuid",get:function(){return this._material.uuid}},{key:"owner",get:function(){return this._owner}},{key:"material",get:function(){return this._material}}])&&o(c.prototype,t),h&&o(c,h),u.prototype.init=function(t){this._effect=new r.default(t.effect),this._effectAsset=t._effectAsset,this._material=t},t=u))||t;function u(t){var e;return(e=l.call(this)||this)._owner=null,e._material=null,e.init(t),e}i.default=c,cc.MaterialVariant=c,e.exports=i.default},{"./CCMaterial":95,"./effect-variant":98,"./material-pool":101}],103:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=(t=t("../../../renderer/enums"))&&t.__esModule?t:{default:t};function a(t){var e,i="";for(e in t)i+=e+t[e];return i}function o(t){var e,i="";for(e in t){var n=t[e],r=n.value;r&&(n.type===s.default.PARAM_TEXTURE_2D||n.type===s.default.PARAM_TEXTURE_CUBE?i+=r._id+";":i+=r.toString()+";")}return i}i.default={serializeDefines:a,serializePasses:function(t){for(var e,i,n,r="",s=0;s<t.length;s++)r+=(e=t[s],n=i=void 0,n=e._programName+e._cullMode,e._blend&&(n+=e._blendEq+e._blendAlphaEq+e._blendSrc+e._blendDst+e._blendSrcAlpha+e._blendDstAlpha+e._blendColor),e._depthTest&&(n+=e._depthWrite+e._depthFunc),e._stencilTest&&(n+=e._stencilFuncFront+e._stencilRefFront+e._stencilMaskFront+e._stencilFailOpFront+e._stencilZFailOpFront+e._stencilZPassOpFront+e._stencilWriteMaskFront+e._stencilFuncBack+e._stencilRefBack+e._stencilMaskBack+e._stencilFailOpBack+e._stencilZFailOpBack+e._stencilZPassOpBack+e._stencilWriteMaskBack),i||(n+=o(e._properties)),n+a(e._defines));return r},serializeUniforms:o},e.exports=i.default},{"../../../renderer/enums":358}],104:[function(t,e,i){"use strict";t("../CCNode").EventType;var b=56,x=7,a=cc.Enum({ONCE:0,ON_WINDOW_RESIZE:1,ALWAYS:2});var A=cc.Vec2.ZERO,C=cc.Vec2.ONE;function o(t,e){var i,n,r,s,a,o,l,h,c,u,_,d=e._target,f=(d?function(t,e,i,n){for(var r=t._parent.scaleX,s=t._parent.scaleY,a=0,o=0,l=t._parent;;){if(a+=l.x,o+=l.y,!(l=l._parent))return i.x=i.y=0,n.x=n.y=1;if(l===e)break;var h=l.scaleX,c=l.scaleY;a*=h,o*=c,r*=h,s*=c}n.x=0!==r?1/r:1,n.y=0!==s?1/s:1,i.x=-a,i.y=-o}(t,i=d,n=A,r=C):i=t._parent,(f=i)instanceof cc.Scene?cc.visibleRect:f._contentSize),p=i._anchorPoint,m=i instanceof cc.Scene,y=t.x,g=t.y,v=t._anchorPoint;e._alignFlags&b&&(a=f.width,c=m?(h=cc.visibleRect.left.x,cc.visibleRect.right.x):(h=-p.x*a)+a,h+=e._isAbsLeft?e._left:e._left*a,c-=e._isAbsRight?e._right:e._right*a,d&&(h=(h+=n.x)*r.x,c=(c+=n.x)*r.x),u=v.x,(o=t.scaleX)<0&&(u=1-u,o=-o),y=e.isStretchWidth?(_=c-h,0!==o&&(t.width=_/o),h+u*_):(_=t.width*o,e.isAlignHorizontalCenter?(o=e._isAbsHorizontalCenter?e._horizontalCenter:e._horizontalCenter*a,a=(.5-p.x)*f.width,d&&(o*=r.x,a=(a+=n.x)*r.x),a+(u-.5)*_+o):e.isAlignLeft?h+u*_:c+(u-1)*_)),e._alignFlags&x&&(a=f.height,o=m?(s=cc.visibleRect.bottom.y,cc.visibleRect.top.y):(s=-p.y*a)+a,s+=e._isAbsBottom?e._bottom:e._bottom*a,o-=e._isAbsTop?e._top:e._top*a,d&&(s=(s+=n.y)*r.y,o=(o+=n.y)*r.y),h=v.y,(c=t.scaleY)<0&&(h=1-h,c=-c),g=e.isStretchHeight?(l=o-s,0!==c&&(t.height=l/c),s+h*l):(l=t.height*c,e.isAlignVerticalCenter?(u=e._isAbsVerticalCenter?e._verticalCenter:e._verticalCenter*a,_=(.5-p.y)*f.height,d&&(u*=r.y,_=(_+=n.y)*r.y),_+(h-.5)*l+u):e.isAlignBottom?s+h*l:o+(h-1)*l)),t.setPosition(y,g)}function n(){var t=cc.director.getScene();if(t){if(r.isAligning=!0,r._nodesOrderDirty)l.length=0,function t(e){var i=e._widget;i&&(o(e,i),i.alignMode!==a.ALWAYS?i.enabled=!1:l.push(i));for(var n=e._children,r=0;r<n.length;r++){var s=n[r];s._active&&t(s)}}(t),r._nodesOrderDirty=!1;else{var e,i=r._activeWidgetsIterator;for(i.i=0;i.i<l.length;++i.i)o((e=l[i.i]).node,e)}r.isAligning=!1}}var l=[],r=cc._widgetManager=e.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(l),init:function(t){t.on(cc.Director.EVENT_AFTER_UPDATE,n);t=this.onResized.bind(this);window.addEventListener("resize",t),window.addEventListener("orientationchange",t)},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0},remove:function(t){t.node._widget=null,this._activeWidgetsIterator.remove(t)},onResized:function(){var t=cc.director.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=cc.Node.isNode(t)&&t.getComponent(cc.Widget);e&&e.alignMode===a.ON_WINDOW_RESIZE&&(e.enabled=!0);for(var i=t._children,n=0;n<i.length;n++){var r=i[n];this.refreshWidgetOnResized(r)}},updateAlignment:function t(e){var i=e._parent,n=(cc.Node.isNode(i)&&t(i),e._widget||e.getComponent(cc.Widget));n&&i&&o(e,n)},AlignMode:a}},{"../CCNode":72}],105:[function(t,e,i){"use strict";var s=t("../value-types"),n=t("../geom-utils"),r=t("../utils/affine-transform"),a=t("../renderer/index"),o=t("../renderer/render-flow"),l=t("../CCGame"),h=null,h=t("../../renderer/scene/camera"),c=cc.mat4(),u=cc.mat4(),_=cc.v3(),d=cc.v3(),f=cc.v3(),p=[],m=null;function y(){var t,e;m&&(t=m.getNode(),e=cc.game.canvas,t.z=e.height/1.1566,t.x=e.width/2,t.y=e.height/2)}var t=cc.Enum({COLOR:1,DEPTH:2,STENCIL:4}),g=cc.Enum({OPAQUE:1,TRANSPARENT:2}),t=cc.Class({name:"cc.Camera",extends:cc.Component,ctor:function(){var t;l.renderType!==l.RENDER_TYPE_CANVAS?((t=new h).setStages(["opaque"]),t.dirty=!0,this._inited=!1,this._camera=t):this._inited=!0},editor:!1,properties:{_cullingMask:4294967295,_clearFlags:t.DEPTH|t.STENCIL,_backgroundColor:cc.color(0,0,0,255),_depth:0,_zoomRatio:1,_targetTexture:null,_fov:60,_orthoSize:10,_nearClip:1,_farClip:4096,_ortho:!0,_rect:cc.rect(0,0,1,1),_renderStages:1,_alignWithScreen:!0,zoomRatio:{get:function(){return this._zoomRatio},set:function(t){this._zoomRatio=t},tooltip:!1},fov:{get:function(){return this._fov},set:function(t){this._fov=t},tooltip:!1},orthoSize:{get:function(){return this._orthoSize},set:function(t){this._orthoSize=t},tooltip:!1},nearClip:{get:function(){return this._nearClip},set:function(t){this._nearClip=t,this._updateClippingpPlanes()},tooltip:!1},farClip:{get:function(){return this._farClip},set:function(t){this._farClip=t,this._updateClippingpPlanes()},tooltip:!1},ortho:{get:function(){return this._ortho},set:function(t){this._ortho=t,this._updateProjection()},tooltip:!1},rect:{get:function(){return this._rect},set:function(t){this._rect=t,this._updateRect()},tooltip:!1},cullingMask:{get:function(){return this._cullingMask},set:function(t){this._cullingMask=t,this._updateCameraMask()},tooltip:!1},clearFlags:{get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&this._camera.setClearFlags(t)},tooltip:!1},backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor.equals(t)||(this._backgroundColor.set(t),this._updateBackgroundColor())},tooltip:!1},depth:{get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&this._camera.setPriority(t)},tooltip:!1},targetTexture:{get:function(){return this._targetTexture},set:function(t){this._targetTexture=t,this._updateTargetTexture()},tooltip:!1},renderStages:{get:function(){return this._renderStages},set:function(t){this._renderStages=t,this._updateStages()},tooltip:!1},alignWithScreen:{get:function(){return this._alignWithScreen},set:function(t){this._alignWithScreen=t}},_is3D:{get:function(){return this.node&&this.node._is3DNode}}},statics:{main:null,cameras:p,ClearFlags:t,findCamera:function(t){for(var e=0,i=p.length;e<i;e++){var n=p[e];if(n.containsNode(t))return n}return null},_findRendererCamera:function(t){for(var e=a.scene._cameras,i=0;i<e._count;i++)if(e._data[i]._cullingMask&t._cullingMask)return e._data[i];return null},_setupDebugCamera:function(){var t,e;m||l.renderType===l.RENDER_TYPE_CANVAS||(t=new h,(m=t).setStages(["opaque"]),t.setFov(60*Math.PI/180),t.setNear(.1),t.setFar(4096),t.dirty=!0,t.cullingMask=1<<cc.Node.BuiltinGroupIndex.DEBUG,t.setPriority(cc.macro.MAX_ZINDEX),t.setClearFlags(0),t.setColor(0,0,0,0),e=new cc.Node,t.setNode(e),y(),cc.view.on("design-resolution-changed",y),a.scene.addCamera(t))}},_updateCameraMask:function(){var t;this._camera&&(t=this._cullingMask&~(1<<cc.Node.BuiltinGroupIndex.DEBUG),this._camera.cullingMask=t)},_updateBackgroundColor:function(){var t;this._camera&&(t=this._backgroundColor,this._camera.setColor(t.r/255,t.g/255,t.b/255,t.a/255))},_updateTargetTexture:function(){var t;this._camera&&(t=this._targetTexture,this._camera.setFrameBuffer(t?t._framebuffer:null))},_updateClippingpPlanes:function(){this._camera&&(this._camera.setNear(this._nearClip),this._camera.setFar(this._farClip))},_updateProjection:function(){var t;this._camera&&(t=this._ortho?1:0,this._camera.setType(t))},_updateRect:function(){var t;this._camera&&(t=this._rect,this._camera.setRect(t.x,t.y,t.width,t.height))},_updateStages:function(){var t=this._renderStages,e=[];t&g.OPAQUE&&e.push("opaque"),t&g.TRANSPARENT&&e.push("transparent"),this._camera.setStages(e)},_init:function(){var t;this._inited||(this._inited=!0,(t=this._camera)&&(t.setNode(this.node),t.setClearFlags(this._clearFlags),t.setPriority(this._depth),this._updateBackgroundColor(),this._updateCameraMask(),this._updateTargetTexture(),this._updateClippingpPlanes(),this._updateProjection(),this._updateStages(),this._updateRect(),this.beforeDraw()))},onLoad:function(){this._init()},onEnable:function(){l.renderType!==l.RENDER_TYPE_CANVAS&&(cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),a.scene.addCamera(this._camera)),p.push(this)},onDisable:function(){l.renderType!==l.RENDER_TYPE_CANVAS&&(cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),a.scene.removeCamera(this._camera)),cc.js.array.remove(p,this)},getScreenToWorldMatrix2D:function(t){return this.getWorldToScreenMatrix2D(t),s.Mat4.invert(t,t),t},getWorldToScreenMatrix2D:function(t){this.node.getWorldRT(c);var e=this.zoomRatio,i=c.m,e=(i[0]*=e,i[1]*=e,i[4]*=e,i[5]*=e,i[12]),n=i[13],r=cc.visibleRect.center;return i[12]=r.x-(i[0]*e+i[4]*n),i[13]=r.y-(i[1]*e+i[5]*n),t!==c&&s.Mat4.copy(t,c),t},getScreenToWorldPoint:function(t,e){return this.node.is3DNode?(e=e||new cc.Vec3,this._camera.screenToWorld(e,t,cc.visibleRect.width,cc.visibleRect.height)):(e=e||new cc.Vec2,this.getScreenToWorldMatrix2D(c),s.Vec2.transformMat4(e,t,c)),e},getWorldToScreenPoint:function(t,e){return this.node.is3DNode?(e=e||new cc.Vec3,this._camera.worldToScreen(e,t,cc.visibleRect.width,cc.visibleRect.height)):(e=e||new cc.Vec2,this.getWorldToScreenMatrix2D(c),s.Vec2.transformMat4(e,t,c)),e},getRay:function(t){return cc.geomUtils?(s.Vec3.set(f,t.x,t.y,1),this._camera.screenToWorld(d,f,cc.visibleRect.width,cc.visibleRect.height),this.ortho?(s.Vec3.set(f,t.x,t.y,-1),this._camera.screenToWorld(_,f,cc.visibleRect.width,cc.visibleRect.height)):this.node.getWorldPosition(_),n.Ray.fromPoints(new n.Ray,_,d)):t},containsNode:function(t){return t._cullingMask&this.cullingMask},render:function(t){if(!(t=t||cc.director.getScene()))return null;this.node.getWorldMatrix(c),this.beforeDraw(),o.render(t),a._forward.renderCamera(this._camera,a.scene)},_onAlignWithScreen:function(){var t=cc.game.canvas.height/cc.view._scaleY,e=(this._targetTexture&&(t=cc.visibleRect.height),this._fov*cc.macro.RAD);this.node.z=t/(2*Math.tan(e/2)),e=2*Math.atan(Math.tan(e/2)/this.zoomRatio),this._camera.setFov(e),this._camera.setOrthoHeight(t/2/this.zoomRatio),this.node.setRotation(0,0,0,1)},beforeDraw:function(){var t;this._camera&&(this._alignWithScreen?this._onAlignWithScreen():(t=this._fov*cc.macro.RAD,t=2*Math.atan(Math.tan(t/2)/this.zoomRatio),this._camera.setFov(t),this._camera.setOrthoHeight(this._orthoSize/this.zoomRatio)),this._camera.dirty=!0)}});cc.js.mixin(t.prototype,{getNodeToCameraTransform:function(t){var e=r.identity();return t.getWorldMatrix(u),this.containsNode(t)&&(this.getWorldToCameraMatrix(c),s.Mat4.mul(u,u,c)),r.fromMat4(e,u),e},getCameraToWorldPoint:function(t,e){return this.getScreenToWorldPoint(t,e)},getWorldToCameraPoint:function(t,e){return this.getWorldToScreenPoint(t,e)},getCameraToWorldMatrix:function(t){return this.getScreenToWorldMatrix2D(t)},getWorldToCameraMatrix:function(t){return this.getWorldToScreenMatrix2D(t)}}),e.exports=cc.Camera=t},{"../../renderer/scene/camera":383,"../CCGame":71,"../geom-utils":164,"../renderer/index":262,"../renderer/render-flow":263,"../utils/affine-transform":305,"../value-types":330}],106:[function(t,e,i){"use strict";cc.Collider.Box=cc.Class({properties:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},size:{tooltip:!1,get:function(){return this._size},set:function(t){this._size.width=t.width<0?0:t.width,this._size.height=t.height<0?0:t.height},type:cc.Size}},resetInEditor:!1});var n=cc.Class({name:"cc.BoxCollider",extends:cc.Collider,mixins:[cc.Collider.Box],editor:!1});cc.BoxCollider=e.exports=n},{}],107:[function(t,e,i){"use strict";cc.Collider.Circle=cc.Class({properties:{_offset:cc.v2(0,0),_radius:50,offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},radius:{tooltip:!1,get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}}},resetInEditor:!1});var n=cc.Class({name:"cc.CircleCollider",extends:cc.Collider,mixins:[cc.Collider.Circle],editor:!1});cc.CircleCollider=e.exports=n},{}],108:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Collider",extends:cc.Component,properties:{editing:{default:!1,serializable:!1,tooltip:!1},tag:{tooltip:!1,default:0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this)},onEnable:function(){cc.director.getCollisionManager().addCollider(this)}});cc.Collider=e.exports=n},{}],109:[function(t,e,i){"use strict";var R=(n=t("../value-types/vec2"))&&n.__esModule?n:{default:n},s=t("./CCContact"),c=s.CollisionType,a=t("../CCNode").EventType,O=new R.default;var n=cc.Class({mixins:[cc.EventTarget],properties:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this._contacts=[],this._colliders=[],this._debugDrawer=null,this._enabledDebugDraw=!1,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(t){if(this.enabled){for(var e=this._colliders,i=0,n=e.length;i<n;i++)this.updateCollider(e[i]);var r=this._contacts,s=[];for(i=0,n=r.length;i<n;i++){var a=r[i].updateState();a!==c.None&&s.push([a,r[i]])}for(i=0,n=s.length;i<n;i++){var o=s[i];this._doCollide(o[0],o[1])}this.drawColliders()}},_doCollide:function(t,e){var i;switch(t){case c.CollisionEnter:i="onCollisionEnter";break;case c.CollisionStay:i="onCollisionStay";break;case c.CollisionExit:i="onCollisionExit"}for(var n,r=e.collider1,s=e.collider2,a=r.node._components,o=s.node._components,l=0,h=a.length;l<h;l++)(n=a[l])[i]&&n[i](s,r);for(l=0,h=o.length;l<h;l++)(n=o[l])[i]&&n[i](r,s)},shouldCollide:function(t,e){var t=t.node,e=e.node,i=cc.game.collisionMatrix;return t!==e&&i[t.groupIndex][e.groupIndex]},initCollider:function(t){var e;t.world||((e=t.world={}).aabb=cc.rect(),e.preAabb=cc.rect(),e.matrix=cc.mat4(),e.radius=0,t instanceof cc.BoxCollider?(e.position=null,e.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):t instanceof cc.PolygonCollider?(e.position=null,e.points=t.points.map(function(t){return cc.v2(t.x,t.y)})):t instanceof cc.CircleCollider&&(e.position=cc.v2(),e.points=null))},updateCollider:function(t){var e,i,n,r,s,a,o=t.offset,l=t.world,h=l.aabb,c=l.matrix,u=(t.node.getWorldMatrix(c),l.preAabb);if(u.x=h.x,u.y=h.y,u.width=h.width,u.height=h.height,t instanceof cc.BoxCollider){var u=t.size,u=(h.x=o.x-u.width/2,h.y=o.y-u.height/2,h.width=u.width,h.height=u.height,l.points),_=u[0],d=u[1],f=u[2],u=u[3],p=(e=c,x=_,v=d,b=f,i=u,n=(g=h).x,A=g.y,p=g.width,g=g.height,r=(e=e.m)[0],s=e[1],m=e[4],y=e[5],a=r*n+m*A+e[12],n=s*n+y*A+e[13],A=r*p,e=s*p,r=m*g,s=y*g,v.x=a,v.y=n,b.x=A+a,b.y=e+n,x.x=r+a,x.y=s+n,i.x=A+r+a,i.y=e+s+n,Math.min(_.x,d.x,f.x,u.x)),m=Math.min(_.y,d.y,f.y,u.y),y=Math.max(_.x,d.x,f.x,u.x),g=Math.max(_.y,d.y,f.y,u.y);h.x=p,h.y=m,h.width=y-p,h.height=g-m}else if(t instanceof cc.CircleCollider){R.default.transformMat4(O,t.offset,c),l.position.x=O.x,l.position.y=O.y;var v=c.m,b=v[12],x=v[13],A=(v[12]=v[13]=0,O.x=t.radius,O.y=0,R.default.transformMat4(O,O,c),Math.sqrt(O.x*O.x+O.y*O.y));l.radius=A,h.x=l.position.x-A,h.y=l.position.y-A,h.width=2*A,h.height=2*A,v[12]=b,v[13]=x}else if(t instanceof cc.PolygonCollider){var C=t.points,T=l.points;T.length=C.length;for(var S=1e6,w=1e6,E=-1e6,M=-1e6,D=0,B=C.length;D<B;D++){T[D]||(T[D]=cc.v2()),O.x=C[D].x+o.x,O.y=C[D].y+o.y,R.default.transformMat4(O,O,c);var I=O.x,P=O.y;E<(T[D].x=I)&&(E=I),I<S&&(S=I),M<(T[D].y=P)&&(M=P),P<w&&(w=P)}h.x=S,h.y=w,h.width=E-S,h.height=M-w}},addCollider:function(t){var e=this._colliders;if(-1===e.indexOf(t)){for(var i=0,n=e.length;i<n;i++){var r=e[i];this.shouldCollide(t,r)&&(r=new s(t,r),this._contacts.push(r))}e.push(t),this.initCollider(t)}t.node.on(a.GROUP_CHANGED,this.onNodeGroupChanged,this)},removeCollider:function(t){var e=this._colliders,i=e.indexOf(t);if(0<=i){e.splice(i,1);for(var n=this._contacts,r=n.length-1;0<=r;r--){var s=n[r];s.collider1!==t&&s.collider2!==t||(s.touching&&this._doCollide(c.CollisionExit,s),n.splice(r,1))}t.node.off(a.GROUP_CHANGED,this.onNodeGroupChanged,this)}else cc.errorID(6600)},onNodeGroupChanged:function(t){for(var e=t.getComponents(cc.Collider),i=0,n=e.length;i<n;i++){var r=e[i];cc.PhysicsCollider&&r instanceof cc.PhysicsCollider||(this.removeCollider(r),this.addCollider(r))}},drawColliders:function(){if(this._enabledDebugDraw){this._checkDebugDrawValid();var t=this._debugDrawer;t.clear();for(var e=this._colliders,i=0,n=e.length;i<n;i++){var r=e[i];if(t.strokeColor=cc.Color.WHITE,r instanceof cc.BoxCollider||r instanceof cc.PolygonCollider){var s=r.world.points;if(0<s.length){t.moveTo(s[0].x,s[0].y);for(var a=1;a<s.length;a++)t.lineTo(s[a].x,s[a].y);t.close(),t.stroke()}}else r instanceof cc.CircleCollider&&(t.circle(r.world.position.x,r.world.position.y,r.world.radius),t.stroke());this.enabledDrawBoundingBox&&(r=r.world.aabb,t.strokeColor=cc.Color.BLUE,t.moveTo(r.xMin,r.yMin),t.lineTo(r.xMin,r.yMax),t.lineTo(r.xMax,r.yMax),t.lineTo(r.xMax,r.yMin),t.close(),t.stroke())}}},_checkDebugDrawValid:function(){var t;this._debugDrawer&&this._debugDrawer.isValid||((t=new cc.Node("COLLISION_MANAGER_DEBUG_DRAW")).zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(t),this._debugDrawer=t.addComponent(cc.Graphics))}});cc.js.getset(n.prototype,"enabledDebugDraw",function(){return this._enabledDebugDraw},function(t){t&&!this._enabledDebugDraw?(this._checkDebugDrawValid(),this._debugDrawer.node.active=!0):!t&&this._enabledDebugDraw&&(this._debugDrawer.clear(!0),this._debugDrawer.node.active=!1),this._enabledDebugDraw=t}),cc.CollisionManager=e.exports=n},{"../CCNode":72,"../value-types/vec2":339,"./CCContact":110}],110:[function(t,e,i){"use strict";var a=t("./CCIntersection"),n=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});function r(t,e){this.collider1=t,this.collider2=e,this.touching=!1;var i=t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider,n=e instanceof cc.BoxCollider||e instanceof cc.PolygonCollider,r=t instanceof cc.CircleCollider,s=e instanceof cc.CircleCollider;i&&n?this.testFunc=a.polygonPolygon:r&&s?this.testFunc=a.circleCircle:i&&s?this.testFunc=a.polygonCircle:r&&n?(this.testFunc=a.polygonCircle,this.collider1=e,this.collider2=t):cc.errorID(6601,cc.js.getClassName(t),cc.js.getClassName(e))}r.prototype.test=function(){var t=this.collider1.world,e=this.collider2.world;return!!t.aabb.intersects(e.aabb)&&(this.testFunc===a.polygonPolygon?this.testFunc(t.points,e.points):this.testFunc===a.circleCircle?this.testFunc(t,e):this.testFunc===a.polygonCircle&&this.testFunc(t.points,e))},r.prototype.updateState=function(){var t=this.test(),e=n.None;return t&&!this.touching?(this.touching=!0,e=n.CollisionEnter):t&&this.touching?e=n.CollisionStay:!t&&this.touching&&(this.touching=!1,e=n.CollisionExit),e},r.CollisionType=n,e.exports=r},{"./CCIntersection":111}],111:[function(t,e,i){"use strict";var n={};function a(t,e,i,n){var r=(n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),n=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y);if(0!=n){i=r/n,e=s/n;if(0<=i&&i<=1&&0<=e&&e<=1)return!0}return!1}function l(t,e,i){for(var n=i.length,r=0;r<n;++r)if(a(t,e,i[r],i[(r+1)%n]))return!0;return!1}function h(t,e){for(var i=!1,n=t.x,r=t.y,s=e.length,a=0,o=s-1;a<s;o=a++){var l=e[a].x,h=e[a].y,c=e[o].x,u=e[o].y;r<h!=r<u&&n<(c-l)*(r-h)/(u-h)+l&&(i=!i)}return i}function s(t,e,i,n){var r=(a=i.x-e.x)*a+(o=i.y-e.y)*o,s=((t.x-e.x)*a+(t.y-e.y)*o)/r,n=n?!r||s<0?e:1<s?i:cc.v2(e.x+s*a,e.y+s*o):cc.v2(e.x+s*a,e.y+s*o),a=t.x-n.x,o=t.y-n.y;return Math.sqrt(a*a+o*o)}n.lineLine=a,n.lineRect=function(t,e,i){var n=new cc.Vec2(i.x,i.y),r=new cc.Vec2(i.x,i.yMax),s=new cc.Vec2(i.xMax,i.yMax),i=new cc.Vec2(i.xMax,i.y);return!!(a(t,e,n,r)||a(t,e,r,s)||a(t,e,s,i)||a(t,e,i,n))},n.linePolygon=l,n.rectRect=function(t,e){var i=t.x,n=t.y,r=t.x+t.width,t=t.y+t.height,s=e.x,a=e.y,o=e.x+e.width,e=e.y+e.height;return i<=o&&s<=r&&n<=e&&a<=t},n.rectPolygon=function(t,e){var i,n,r=new cc.Vec2(t.x,t.y),s=new cc.Vec2(t.x,t.yMax),a=new cc.Vec2(t.xMax,t.yMax),o=new cc.Vec2(t.xMax,t.y);if(l(r,s,e))return!0;if(l(s,a,e))return!0;if(l(a,o,e))return!0;if(l(o,r,e))return!0;for(i=0,n=e.length;i<n;++i)if(h(e[i],t))return!0;return!!(h(r,e)||h(s,e)||h(a,e)||h(o,e))},n.polygonPolygon=function(t,e){for(var i=0,n=t.length;i<n;++i)if(l(t[i],t[(i+1)%n],e))return!0;for(i=0,n=e.length;i<n;++i)if(h(e[i],t))return!0;for(i=0,n=t.length;i<n;++i)if(h(t[i],e))return!0;return!1},n.circleCircle=function(t,e){return t.position.sub(e.position).mag()<t.radius+e.radius},n.polygonCircle=function(t,e){var i=e.position;if(h(i,t))return!0;for(var n=0,r=t.length;n<r;n++)if(s(i,0===n?t[t.length-1]:t[n-1],t[n],!0)<e.radius)return!0;return!1},n.pointInPolygon=h,n.pointLineDistance=s,cc.Intersection=e.exports=n},{}],112:[function(t,e,i){"use strict";cc.Collider.Polygon=cc.Class({properties:{threshold:{default:1,serializable:!1,visible:!1},_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},points:{tooltip:!1,default:function(){return[cc.v2(-50,-50),cc.v2(50,-50),cc.v2(50,50),cc.v2(-50,50)]},type:[cc.Vec2]}},resetPointsByContour:!1});var n=cc.Class({name:"cc.PolygonCollider",extends:cc.Collider,mixins:[cc.Collider.Polygon],editor:!1});cc.PolygonCollider=e.exports=n},{}],113:[function(t,e,i){"use strict";t("./CCCollisionManager"),t("./CCCollider"),t("./CCBoxCollider"),t("./CCCircleCollider"),t("./CCPolygonCollider")},{"./CCBoxCollider":106,"./CCCircleCollider":107,"./CCCollider":108,"./CCCollisionManager":109,"./CCPolygonCollider":112}],114:[function(t,e,i){"use strict";t("./platform/CCClass");var n=t("./platform/CCObject").Flags,r=t("./platform/js").array,s=n.IsStartCalled,a=n.IsOnEnableCalled;function o(t,e){for(var i=e.constructor._executionOrder,n=e._id,r=0,s=t.length-1,a=s>>>1;r<=s;a=r+s>>>1){var o=t[a],l=o.constructor._executionOrder;if(i<l)s=a-1;else if(l<i)r=a+1;else{l=o._id;if(n<l)s=a-1;else{if(!(l<n))return a;r=a+1}}}return~r}function l(t,e){for(var i=t.array,n=t.i+1;n<i.length;){var r=i[n];r._enabled&&r.node._activeInHierarchy?++n:(t.removeAt(n),e&&(r._objFlags&=~e))}}n.IsEditorOnEnableCalled;t=cc.Class({__ctor__:function(t){var e=r.MutableForwardIterator;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t},statics:{stableRemoveInactive:l},add:null,remove:null,invoke:null});function h(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}var c=cc.Class({extends:t,add:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},remove:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},cancelInactive:function(t){l(this._zero,t),l(this._neg,t),l(this._pos,t)},invoke:function(){var t=this._neg,t=(0<t.array.length&&(t.array.sort(h),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0,this._pos);0<t.array.length&&(t.array.sort(h),this._invoke(t),t.array.length=0)}}),u=cc.Class({extends:t,add:function(t){var e,i=t.constructor._executionOrder;0===i?this._zero.array.push(t):(e=o(i=(i<0?this._neg:this._pos).array,t))<0&&i.splice(~e,0,t)},remove:function(t){var e=t.constructor._executionOrder;0===e?this._zero.fastRemove(t):0<=(t=o((e=e<0?this._neg:this._pos).array,t))&&e.removeAt(t)},invoke:function(t){0<this._neg.array.length&&this._invoke(this._neg,t),this._invoke(this._zero,t),0<this._pos.array.length&&this._invoke(this._pos,t)}});function _(r,t,s,a){var e="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+r+"}";return a=t?Function("it","dt",e):Function("it",e),r=Function("c","dt",r),function(e,i){try{a(e,i)}catch(t){cc._throw(t);var n=e.array;for(s&&(n[e.i]._objFlags|=s),++e.i;e.i<n.length;++e.i)try{r(n[e.i],i)}catch(t){cc._throw(t),s&&(n[e.i]._objFlags|=s)}}}}var d=_("c.start();c._objFlags|="+s,!1,s),f=_("c.update(dt)",!0),p=_("c.lateUpdate(dt)",!0);function m(){this.startInvoker=new c(d),this.updateInvoker=new u(f),this.lateUpdateInvoker=new u(p),this.scheduleInNextFrame=[],this._updating=!1}n=cc.Class({ctor:m,unscheduleAll:m,statics:{LifeCycleInvoker:t,OneOffInvoker:c,createInvokeImpl:_,invokeOnEnable:function(t){var e=cc.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){var n=i[t.i];n._enabled&&(n.onEnable(),n.node._activeInHierarchy&&e._onEnabled(n))}}},_onEnabled:function(t){cc.director.getScheduler().resumeTarget(t),t._objFlags|=a,this._updating?this.scheduleInNextFrame.push(t):this._scheduleImmediate(t)},_onDisabled:function(t){cc.director.getScheduler().pauseTarget(t),t._objFlags&=~a;var e=this.scheduleInNextFrame.indexOf(t);0<=e?r.fastRemoveAt(this.scheduleInNextFrame,e):(!t.start||t._objFlags&s||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},enableComp:function(t,e){if(!(t._objFlags&a)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},disableComp:function(t){t._objFlags&a&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},_scheduleImmediate:function(t){!t.start||t._objFlags&s||this.startInvoker.add(t),t.update&&this.updateInvoker.add(t),t.lateUpdate&&this.lateUpdateInvoker.add(t)},_deferredSchedule:function(){for(var t=this.scheduleInNextFrame,e=0,i=t.length;e<i;e++){var n=t[e];this._scheduleImmediate(n)}t.length=0},_earlyStartForNewComps:function(){0<this.scheduleInNextFrame.length&&(this._deferredSchedule(),this.startInvoker.invoke())},startPhase:function(){this._updating=!0,0<this.scheduleInNextFrame.length&&this._deferredSchedule(),this.startInvoker.invoke(),this._earlyStartForNewComps()},updatePhase:function(t){this.updateInvoker.invoke(t)},lateUpdatePhase:function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1},clearup:function(){this._earlyStartForNewComps()}});e.exports=n},{"./platform/CCClass":230,"./platform/CCObject":236,"./platform/js":250,"./utils/misc":315}],115:[function(t,e,i){"use strict";var n=t("../../animation/animation-animator"),r=t("../../animation/animation-clip"),s=t("../event/event-target"),a=t("../platform/js"),o=cc.Enum({PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"}),t=cc.Class({name:"cc.Animation",extends:t("./CCComponent"),mixins:[s],editor:!1,statics:{EventType:o},ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState=a.createMap(!0),this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{default:null,type:r},defaultClip:{type:r,get:function(){return this._defaultClip},set:function(t){},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:r,visible:!1},_writableClips:{get:function(){return this._clips},set:function(t){this._didInit=!1,this._clips=t,this._init()},type:[r]},_clips:{default:[],type:[r],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){var t;!this.playOnLoad||!this._defaultClip||this._animator&&this._animator.isPlaying||(t=this.getAnimationState(this._defaultClip.name),this._animator.playState(t))},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,e){t=this.playAdditive(t,e);return this._animator.stopStatesExcept(t),t},playAdditive:function(t,e){this._init();var i,t=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);return t&&(this.enabled=!0,(i=this._animator).isPlaying&&t.isPlaying?t.isPaused?i.resumeState(t):(i.stopState(t),i.playState(t,e)):i.playState(t,e),this.enabledInHierarchy||i.pause(),this.currentClip=t.clip),t},stop:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.stopState(t):this._animator.stop())},pause:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.pauseState(t):this.enabled=!1)},resume:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.resumeState(t):this.enabled=!0)},setCurrentTime:function(t,e){this._init(),e?(e=this._nameToState[e])&&this._animator.setStateTime(e,t):this._animator.setStateTime(t)},getAnimationState:function(t){this._init();t=this._nameToState[t];return t&&!t.curveLoaded&&this._animator._reloadClip(t),t||null},addClip:function(t,e){if(t){this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;i=this._clips.indexOf(i.clip);-1!==i&&this._clips.splice(i,1)}i=new cc.AnimationState(t,e);return this._nameToState[e]=i}cc.warnID(3900)},removeClip:function(e,t){if(e){var i,n;for(n in this._init(),this._nameToState)if(i=this._nameToState[n],i.clip===e)break;if(e===this._defaultClip){if(!t)return void cc.warnID(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!t)return void cc.warnID(3903);this.stop(i.name)}this._clips=this._clips.filter(function(t){return!(t===e)}),i&&delete this._nameToState[i.name]}else cc.warnID(3901)},sample:function(t){this._init(),t?(t=this._nameToState[t])&&t.sample():this._animator.sample()},on:function(t,e,i,n){this._init();e=this._EventTargetOn(t,e,i,n);if("lastframe"===t){var r,s=this._nameToState;for(r in s)s[r]._lastframeEventOn=!0}return e},off:function(t,e,i,n){if(this._init(),"lastframe"===t){var r,s=this._nameToState;for(r in s)s[r]._lastframeEventOn=!1}this._EventTargetOff(t,e,i,n)},_init:function(){this._didInit||(this._didInit=!0,this._animator=new n(this.node,this),this._createStates())},_createStates:function(){this._nameToState=a.createMap(!0);for(var t=null,e=!1,i=0;i<this._clips.length;++i){var n=this._clips[i];n&&(t=new cc.AnimationState(n),this._nameToState[t.name]=t,this._defaultClip===n&&(e=t))}this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});t.prototype._EventTargetOn=s.prototype.on,t.prototype._EventTargetOff=s.prototype.off,cc.Animation=e.exports=t},{"../../animation/animation-animator":9,"../../animation/animation-clip":10,"../event/event-target":156,"../platform/js":250,"./CCComponent":120}],116:[function(t,e,i){"use strict";var n=t("../utils/misc"),r=t("./CCComponent"),s=t("../assets/CCAudioClip"),t=cc.Class({name:"cc.AudioSource",extends:r,editor:!1,ctor:function(){this.audio=new cc.Audio},properties:{_clip:{default:null,type:s},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},isPlaying:{get:function(){return this.audio.getState()===cc.Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(t){var i;"string"!=typeof t?t!==this._clip&&(this._clip=t,this.audio.stop(),this.preload&&(this.audio.src=this._clip)):(cc.warnID(8401,"cc.AudioSource","cc.AudioClip","AudioClip","cc.AudioClip","audio"),i=this,s._loadByUrl(t,function(t,e){e&&(i.clip=e)}))},type:s,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(t){return t=n.clamp01(t),this._volume=t,this._mute||this.audio.setVolume(t),t},tooltip:!1},mute:{get:function(){return this._mute},set:function(t){return this._mute=t,this.audio.setVolume(t?0:this._volume),t},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(t){return this._loop=t,this.audio.setLoop(t),t},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_ensureDataLoaded:function(){this.audio.src!==this._clip&&(this.audio.src=this._clip)},_pausedCallback:function(){this.audio.getState()===cc.Audio.State.PLAYING&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1},onLoad:function(){this.audio.setVolume(this._mute?0:this._volume),this.audio.setLoop(this._loop)},onEnable:function(){this.preload&&(this.audio.src=this._clip),this.playOnLoad&&this.play(),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.stop(),this.audio.destroy(),cc.audioEngine.uncache(this._clip)},play:function(){var t;this._clip&&(t=this.audio,this._clip.loaded&&t.stop(),this._ensureDataLoaded(),t.setCurrentTime(0),t.play())},stop:function(){this.audio.stop()},pause:function(){this.audio.pause()},resume:function(){this._ensureDataLoaded(),this.audio.resume()},rewind:function(){this.audio.setCurrentTime(0)},getCurrentTime:function(){return this.audio.getCurrentTime()},setCurrentTime:function(t){return this.audio.setCurrentTime(t),t},getDuration:function(){return this.audio.getDuration()}});cc.AudioSource=e.exports=t},{"../assets/CCAudioClip":77,"../utils/misc":315,"./CCComponent":120}],117:[function(t,e,i){"use strict";var n=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"];function r(t){t.stopPropagation()}t=cc.Class({name:"cc.BlockInputEvents",extends:t("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block_input_events"},onEnable:function(){for(var t=0;t<n.length;t++)this.node.on(n[t],r,this)},onDisable:function(){for(var t=0;t<n.length;t++)this.node.off(n[t],r,this)}});cc.BlockInputEvents=e.exports=t},{"./CCComponent":120}],118:[function(t,e,i){"use strict";var n=t("./CCComponent"),t=t("../utils/gray-sprite-state"),r=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),s=cc.Enum({NORMAL:0,HOVER:1,PRESSED:2,DISABLED:3}),n=cc.Class({name:"cc.Button",extends:n,mixins:[t],ctor:function(){this._pressed=!1,this._hovered=!1,this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=cc.Vec2.ZERO,this._toScale=cc.Vec2.ZERO,this._originalScale=null,this._graySpriteMaterial=null,this._spriteMaterial=null,this._sprite=null},editor:!1,properties:{interactable:{default:!0,tooltip:!1,notify:function(){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState()}},transition:{default:r.NONE,tooltip:!1,type:r,animatable:!1,notify:function(t){this._updateTransition(t)},formerlySerializedAs:"transition"},normalColor:{default:cc.Color.WHITE,displayName:"Normal",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===s.NORMAL&&(this._getTarget().opacity=this.normalColor.a),this._updateState()}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===s.PRESSED&&(this._getTarget().opacity=this.pressedColor.a),this._updateState()},formerlySerializedAs:"pressedColor"},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===s.HOVER&&(this._getTarget().opacity=this.hoverColor.a),this._updateState()},formerlySerializedAs:"hoverColor"},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===s.DISABLED&&(this._getTarget().opacity=this.disabledColor.a),this._updateState()}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{default:null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState()}},hoverSprite:{default:null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState()}},disabledSprite:{default:null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(t){this._applyTarget(),t&&this.target!==t&&this._unregisterTargetEvent(t)}},clickEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:r},__preload:function(){this._applyTarget(),this._resetState()},_resetState:function(){this._pressed=!1,this._hovered=!1;var t=this._getTarget(),e=this.transition,i=this._originalScale;e===r.COLOR&&this.interactable?this._setTargetColor(this.normalColor):e===r.SCALE&&i&&t.setScale(i.x,i.y),this._transitionFinished=!0},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerNodeEvent()},onDisable:function(){this._resetState(),this._unregisterNodeEvent()},_getTarget:function(){return this.target||this.node},_onTargetSpriteFrameChanged:function(t){this.transition===r.SPRITE&&this._setCurrentStateSprite(t.spriteFrame)},_onTargetColorChanged:function(t){this.transition===r.COLOR&&this._setCurrentStateColor(t)},_onTargetScaleChanged:function(){var t=this._getTarget();this._originalScale&&(this.transition!==r.SCALE||this._transitionFinished)&&(this._originalScale.x=t.scaleX,this._originalScale.y=t.scaleY)},_setTargetColor:function(t){var e=this._getTarget();e.color=t,e.opacity=t.a},_getStateColor:function(t){switch(t){case s.NORMAL:return this.normalColor;case s.HOVER:return this.hoverColor;case s.PRESSED:return this.pressedColor;case s.DISABLED:return this.disabledColor}},_getStateSprite:function(t){switch(t){case s.NORMAL:return this.normalSprite;case s.HOVER:return this.hoverSprite;case s.PRESSED:return this.pressedSprite;case s.DISABLED:return this.disabledSprite}},_setCurrentStateColor:function(t){switch(this._getButtonState()){case s.NORMAL:this.normalColor=t;break;case s.HOVER:this.hoverColor=t;break;case s.PRESSED:this.pressedColor=t;break;case s.DISABLED:this.disabledColor=t}},_setCurrentStateSprite:function(t){switch(this._getButtonState()){case s.NORMAL:this.normalSprite=t;break;case s.HOVER:this.hoverSprite=t;break;case s.PRESSED:this.pressedSprite=t;break;case s.DISABLED:this.disabledSprite=t}},update:function(t){var e,i=this._getTarget();this._transitionFinished||this.transition!==r.COLOR&&this.transition!==r.SCALE||(this.time+=t,(t=1)<=(t=0<this.duration?this.time/this.duration:t)&&(t=1),this.transition===r.COLOR?(e=this._fromColor.lerp(this._toColor,t),this._setTargetColor(e)):this.transition===r.SCALE&&this._originalScale&&(i.scale=this._fromScale.lerp(this._toScale,t)),1===t&&(this._transitionFinished=!0))},_registerNodeEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_unregisterNodeEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_registerTargetEvent:function(t){t.on(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_unregisterTargetEvent:function(t){t.off(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_getTargetSprite:function(t){var e=null;return e=t?t.getComponent(cc.Sprite):e},_applyTarget:function(){var t=this._getTarget();this._sprite=this._getTargetSprite(t),this._originalScale||(this._originalScale=cc.Vec2.ZERO),this._originalScale.x=t.scaleX,this._originalScale.y=t.scaleY,this._registerTargetEvent(t)},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t.stopPropagation())},_onTouchMove:function(t){var e,i,n;this.interactable&&this.enabledInHierarchy&&this._pressed&&(e=t.touch,e=this.node._hitTest(e.getLocation()),i=this._getTarget(),n=this._originalScale,this.transition===r.SCALE&&n?e?(this._fromScale.x=n.x,this._fromScale.y=n.y,this._toScale.x=n.x*this.zoomScale,this._toScale.y=n.y*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,i.setScale(n.x,n.y)):(i=e?s.PRESSED:s.NORMAL,this._applyTransition(i)),t.stopPropagation())},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation())},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){this._pressed||!this.interactable||!this.enabledInHierarchy||this.transition===r.SPRITE&&!this.hoverSprite||this._hovered||(this._hovered=!0,this._updateState())},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var t=this._getButtonState();this._applyTransition(t),this._updateDisabledState()},_getButtonState:function(){return this.interactable?this._pressed?s.PRESSED:this._hovered?s.HOVER:s.NORMAL:s.DISABLED},_updateColorTransitionImmediately:function(t){t=this._getStateColor(t);this._setTargetColor(t),this._fromColor=t.clone(),this._toColor=t},_updateColorTransition:function(t){var e;t===s.DISABLED?this._updateColorTransitionImmediately(t):(e=this._getTarget(),t=this._getStateColor(t),this._fromColor=e.color.clone(),this._toColor=t,this.time=0,this._transitionFinished=!1)},_updateSpriteTransition:function(t){t=this._getStateSprite(t);this._sprite&&t&&(this._sprite.spriteFrame=t)},_updateScaleTransition:function(t){t===s.PRESSED?this._zoomUp():this._zoomBack()},_zoomUp:function(){this._originalScale&&(this._fromScale.x=this._originalScale.x,this._fromScale.y=this._originalScale.y,this._toScale.x=this._originalScale.x*this.zoomScale,this._toScale.y=this._originalScale.y*this.zoomScale,this.time=0,this._transitionFinished=!1)},_zoomBack:function(){var t;this._originalScale&&(t=this._getTarget(),this._fromScale.x=t.scaleX,this._fromScale.y=t.scaleY,this._toScale.x=this._originalScale.x,this._toScale.y=this._originalScale.y,this.time=0,this._transitionFinished=!1)},_updateTransition:function(t){t===r.COLOR?this._updateColorTransitionImmediately(s.NORMAL):t===r.SPRITE&&this._updateSpriteTransition(s.NORMAL),this._updateState()},_applyTransition:function(t){var e=this.transition;e===r.COLOR?this._updateColorTransition(t):e===r.SPRITE?this._updateSpriteTransition(t):e===r.SCALE&&this._updateScaleTransition(t)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){var t;this._sprite&&(t=!1,!this.enableAutoGrayEffect||this.transition===r.SPRITE&&this.disabledSprite||this.interactable||(t=!0),this._switchGrayMaterial(t,this._sprite))}});cc.Button=e.exports=n},{"../utils/gray-sprite-state":311,"./CCComponent":120}],119:[function(t,e,i){"use strict";var n=t("../camera/CCCamera"),t=t("./CCComponent"),r=cc.Class({name:"cc.Canvas",extends:t,editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:!1}},_fitDesignResolution:!1,__preload:function(){if(r.instance)return cc.warnID(6700,this.node.name,r.instance.node.name);(r.instance=this).applySettings();var t=this.getComponent(cc.Widget),t=(t&&t.updateAlignment(),cc.find("Main Camera",this.node)),e=(t||((t=new cc.Node("Main Camera")).parent=this.node,t.setSiblingIndex(0)),t.getComponent(n));e||(e=t.addComponent(n),t=n.ClearFlags,e.clearFlags=t.COLOR|t.DEPTH|t.STENCIL,e.depth=-1),n.main=e},onDestroy:function(){r.instance===this&&(r.instance=null)},applySettings:function(){var t=cc.ResolutionPolicy,t=this.fitHeight&&this.fitWidth?t.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?t.FIXED_WIDTH:t.FIXED_HEIGHT:t.NO_BORDER,e=this._designResolution;cc.view.setDesignResolutionSize(e.width,e.height,t)}});cc.Canvas=e.exports=r},{"../camera/CCCamera":105,"./CCComponent":120}],120:[function(t,e,i){"use strict";var n=t("../platform/CCObject"),r=t("../platform/js"),s=new(t("../platform/id-generater"))("Comp"),a=(n.Flags.IsOnEnableCalled,n.Flags.IsOnLoadCalled),o=!!cc.ActionManager,t=cc.Class({name:"cc.Component",extends:n,ctor:function(){this._id=s.getNewId(),this.__eventTargets=[]},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),e=t.lastIndexOf(".");return 0<=e&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},uuid:{get:function(){return this._id},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){var e;this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy)&&(e=cc.director._compScheduler,t?e.enableComp(this):e.disableComp(this))},visible:!1,animatable:!0},enabledInHierarchy:{get:function(){return this._enabled&&this.node._activeInHierarchy},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&a}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){o&&cc.director.getActionManager().removeAllActionsFromTarget(this),this.unscheduleAllCallbacks();for(var t=this.__eventTargets,e=t.length-1;0<=e;--e){var i=t[e];i&&i.targetOff(this)}t.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(t){return(t=t||cc.instantiate._clone(this,this)).node=null,t},schedule:function(t,e,i,n){cc.assertID(t,1619),e=e||0,cc.assertID(0<=e,1620),i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,n=n||0;var r=cc.director.getScheduler(),s=r.isTargetPaused(this);r.schedule(t,this,e,i,n,s)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});t._requireComponent=null,t._executionOrder=0,r.value(t,"_registerEditorProps",function(t,e){var i=e.requireComponent,i=(i&&(t._requireComponent=i),e.executionOrder);i&&"number"==typeof i&&(t._executionOrder=i)}),t.prototype.__scriptUuid="",cc.Component=e.exports=t},{"../platform/CCObject":236,"../platform/id-generater":246,"../platform/js":250}],121:[function(t,e,i){"use strict";cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:"",_componentId:"",_componentName:{get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(t){var e;if(0<arguments.length)for(var i=0,n=(e=new Array(arguments.length-1)).length;i<n;i++)e[i]=arguments[i+1];for(var r=0,s=t.length;r<s;r++){var a=t[r];a instanceof cc.Component.EventHandler&&a.emit(e)}}},emit:function(t){var e,i=this.target;cc.isValid(i)&&(this._genCompIdIfNeeded(),e=cc.js._getClassById(this._componentId),i=i.getComponent(e),cc.isValid(i)&&"function"==typeof(e=i[this.handler])&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),e.apply(i,t)))},_compName2Id:function(t){t=cc.js.getClassByName(t);return cc.js._getClassId(t)},_compId2Name:function(t){t=cc.js._getClassById(t);return cc.js.getClassName(t)},_genCompIdIfNeeded:function(){this._componentId||(this._componentName=this.component,this.component="")}})},{}],122:[function(t,e,i){"use strict";var n=t("../platform/CCMacro"),r=t("./CCRenderComponent"),s=(t("../assets/material/CCMaterial"),t("../renderer/utils/label/label-frame")),t=n.TextAlignment,n=n.VerticalTextAlignment,a=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3}),o=cc.Enum({NONE:0,BITMAP:1,CHAR:2}),l=cc.Class({name:"cc.Label",extends:r,ctor:function(){this._actualFontSize=0,this._assemblerData=null,this._frame=null,this._ttfTexture=null,this._letterTexture=null,cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?this._updateMaterial=this._updateMaterialCanvas:this._updateMaterial=this._updateMaterialWebgl},editor:!1,properties:{_useOriginalSize:!0,_string:{default:"",formerlySerializedAs:"_N$string"},string:{get:function(){return this._string},set:function(t){var e=this._string;this._string=""+t,this.string!==e&&this.setVertsDirty(),this._checkStringEmpty()},multiline:!0,tooltip:!1},horizontalAlign:{default:t.LEFT,type:t,tooltip:!1,notify:function(t){this.horizontalAlign!==t&&this.setVertsDirty()},animatable:!1},verticalAlign:{default:n.TOP,type:n,tooltip:!1,notify:function(t){this.verticalAlign!==t&&this.setVertsDirty()},animatable:!1},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._actualFontSize},tooltip:!1},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.setVertsDirty())},range:[0,512],tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(t){this.fontFamily!==t&&this.setVertsDirty()},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.setVertsDirty())},tooltip:!1},overflow:{default:a.NONE,type:a,tooltip:!1,notify:function(t){this.overflow!==t&&this.setVertsDirty()},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.setVertsDirty())},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(t){this.font!==t&&(t||(this._isSystemFontUsed=!0),(this._N$file=t)&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),"string"==typeof t&&cc.warnID(4e3),this.enabledInHierarchy&&this._forceUpdateRenderData())},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){if(this._isSystemFontUsed!==t){if(this._isSystemFontUsed=!!t,t){if(this.font=null,!this.enabledInHierarchy)return;this._forceUpdateRenderData()}this.markForValidate()}},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",get:function(){return this._N$file instanceof cc.BitmapFont?this._N$file.fontSize:-1},visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(t){this._spacingX=t,this.setVertsDirty()},tooltip:!1},_batchAsBitmap:!1,cacheMode:{default:o.NONE,type:o,tooltip:!1,notify:function(t){this.cacheMode!==t&&(t!==o.BITMAP||this.font instanceof cc.BitmapFont||this._frame&&this._frame._resetDynamicAtlasFrame(),t===o.CHAR&&(this._ttfTexture=null),this.enabledInHierarchy&&this._forceUpdateRenderData())},animatable:!1},_styleFlags:0,enableBold:{get:function(){return!!(1&this._styleFlags)},set:function(t){t?this._styleFlags|=1:this._styleFlags&=-2,this.setVertsDirty()},animatable:!1,tooltip:!1},enableItalic:{get:function(){return!!(2&this._styleFlags)},set:function(t){t?this._styleFlags|=2:this._styleFlags&=-3,this.setVertsDirty()},animatable:!1,tooltip:!1},enableUnderline:{get:function(){return!!(4&this._styleFlags)},set:function(t){t?this._styleFlags|=4:this._styleFlags&=-5,this.setVertsDirty()},animatable:!1,tooltip:!1},_underlineHeight:0,underlineHeight:{get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.setVertsDirty())},tooltip:!1}},statics:{HorizontalAlign:t,VerticalAlign:n,Overflow:a,CacheMode:o,_shareAtlas:null,clearCharCache:function(){l._shareAtlas&&l._shareAtlas.clearAllCache()}},onLoad:function(){this._batchAsBitmap&&this.cacheMode===o.NONE&&(this.cacheMode=o.BITMAP,this._batchAsBitmap=!1),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(this.cacheMode=o.NONE)},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this),this._forceUpdateRenderData()},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onDestroy:function(){this._assembler&&this._assembler._resetAssemblerData&&this._assembler._resetAssemblerData(this._assemblerData),this._assemblerData=null,this._letterTexture=null,this._ttfTexture&&(this._ttfTexture.destroy(),this._ttfTexture=null),this._super()},_nodeSizeChanged:function(){this.overflow!==a.NONE&&this.setVertsDirty()},_updateColor:function(){this.font instanceof cc.BitmapFont||this.setVertsDirty(),r.prototype._updateColor.call(this)},_validateRender:function(){if(this.string){if(this._materials[0]){var t=this.font;if(!(t instanceof cc.BitmapFont))return;var e=t.spriteFrame;if(e&&e.textureLoaded()&&t._fntConfig)return}this.disableRender()}else this.disableRender()},_resetAssembler:function(){this._frame=null,r.prototype._resetAssembler.call(this)},_checkStringEmpty:function(){this.markForRender(!!this.string)},_on3DNodeChanged:function(){this._resetAssembler(),this._applyFontTexture()},_onBMFontTextureLoaded:function(){this._frame._texture=this.font.spriteFrame._texture,this.markForRender(!0),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this)},_applyFontTexture:function(){var t=this.font;t instanceof cc.BitmapFont?(t=t.spriteFrame,(this._frame=t)&&t.onTextureLoaded(this._onBMFontTextureLoaded,this)):(this._frame||(this._frame=new s),this.cacheMode===o.CHAR?(this._letterTexture=this._assembler._getAssemblerData(),this._frame._refreshTexture(this._letterTexture)):this._ttfTexture||(this._ttfTexture=new cc.Texture2D,this._assemblerData=this._assembler._getAssemblerData(),this._ttfTexture.initWithElement(this._assemblerData.canvas)),this.cacheMode!==o.CHAR&&(this._frame._resetDynamicAtlasFrame(),this._frame._refreshTexture(this._ttfTexture)),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this)),this.markForValidate()},_updateMaterialCanvas:function(){this._frame&&(this._frame._texture.url=this.uuid+"_texture")},_updateMaterialWebgl:function(){var t;this._frame&&(t=this.getMaterial(0))&&t.setProperty("texture",this._frame._texture)},_forceUpdateRenderData:function(){this.setVertsDirty(),this._resetAssembler(),this._applyFontTexture()},_enableBold:function(t){this.enableBold=!!t},_enableItalics:function(t){this.enableItalic=!!t},_enableUnderline:function(t){this.enableUnderline=!!t}});cc.Label=e.exports=l},{"../assets/material/CCMaterial":95,"../platform/CCMacro":235,"../renderer/utils/label/label-frame":267,"./CCRenderComponent":131}],123:[function(t,e,i){"use strict";t=cc.Class({name:"cc.LabelOutline",extends:t("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_width:1,color:{tooltip:!1,get:function(){return this._color},set:function(t){this._color=t,this._updateRenderData()}},width:{tooltip:!1,get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())},range:[0,512]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t.setVertsDirty()}});cc.LabelOutline=e.exports=t},{"./CCComponent":120}],124:[function(t,e,i){"use strict";t=cc.Class({name:"cc.LabelShadow",extends:t("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_offset:cc.v2(2,2),_blur:2,color:{tooltip:!1,get:function(){return this._color},set:function(t){this._color=t,this._updateRenderData()}},offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},blur:{tooltip:!1,get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()},range:[0,1024]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t.markForRender(!0)}});cc.LabelShadow=e.exports=t},{"./CCComponent":120}],125:[function(t,e,i){"use strict";var n=t("../CCNode").EventType,E=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),M=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),r=cc.Enum({HORIZONTAL:0,VERTICAL:1}),D=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),B=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),t=cc.Class({name:"cc.Layout",extends:t("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{default:!0,serializable:!1},_resize:M.NONE,_N$layoutType:E.NONE,type:{type:E,get:function(){return this._N$layoutType},set:function(t){this._N$layoutType=t,this._doLayoutDirty()},tooltip:!1,animatable:!1},resizeMode:{type:M,tooltip:!1,animatable:!1,get:function(){return this._resize},set:function(t){this.type===E.NONE&&t===M.CHILDREN||(this._resize=t,this._doLayoutDirty())}},cellSize:{default:cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty()}},startAxis:{default:r.HORIZONTAL,tooltip:!1,type:r,notify:function(){this._doLayoutDirty()},animatable:!1},paddingLeft:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingRight:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingTop:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingBottom:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},spacingX:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},spacingY:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},verticalDirection:{default:D.TOP_TO_BOTTOM,type:D,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},horizontalDirection:{default:B.LEFT_TO_RIGHT,type:B,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},affectedByScale:{default:!1,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:!1}},statics:{Type:E,VerticalDirection:D,HorizontalDirection:B,ResizeMode:M,AxisDirection:r},onEnable:function(){this._addEventListeners(),this.node.getContentSize().equals(cc.size(0,0))&&this.node.setContentSize(this._layoutSize),this._doLayoutDirty()},onDisable:function(){this._removeEventListeners()},_doLayoutDirty:function(){this._layoutDirty=!0},_doScaleDirty:function(){this._layoutDirty=this._layoutDirty||this.affectedByScale},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(n.SIZE_CHANGED,this._resized,this),this.node.on(n.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(n.CHILD_ADDED,this._childAdded,this),this.node.on(n.CHILD_REMOVED,this._childRemoved,this),this.node.on(n.CHILD_REORDER,this._doLayoutDirty,this),this._addChildrenEventListeners()},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(n.SIZE_CHANGED,this._resized,this),this.node.off(n.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(n.CHILD_ADDED,this._childAdded,this),this.node.off(n.CHILD_REMOVED,this._childRemoved,this),this.node.off(n.CHILD_REORDER,this._doLayoutDirty,this),this._removeChildrenEventListeners()},_addChildrenEventListeners:function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.on(n.SCALE_CHANGED,this._doScaleDirty,this),i.on(n.SIZE_CHANGED,this._doLayoutDirty,this),i.on(n.POSITION_CHANGED,this._doLayoutDirty,this),i.on(n.ANCHOR_CHANGED,this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}},_removeChildrenEventListeners:function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.off(n.SCALE_CHANGED,this._doScaleDirty,this),i.off(n.SIZE_CHANGED,this._doLayoutDirty,this),i.off(n.POSITION_CHANGED,this._doLayoutDirty,this),i.off(n.ANCHOR_CHANGED,this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._doLayoutDirty,this)}},_childAdded:function(t){t.on(n.SCALE_CHANGED,this._doScaleDirty,this),t.on(n.SIZE_CHANGED,this._doLayoutDirty,this),t.on(n.POSITION_CHANGED,this._doLayoutDirty,this),t.on(n.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_childRemoved:function(t){t.off(n.SCALE_CHANGED,this._doScaleDirty,this),t.off(n.SIZE_CHANGED,this._doLayoutDirty,this),t.off(n.POSITION_CHANGED,this._doLayoutDirty,this),t.off(n.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(t,e,i,n){var r=this.node.getAnchorPoint(),s=this.node.children,a=1,o=this.paddingLeft,l=-r.x*t;this.horizontalDirection===B.RIGHT_TO_LEFT&&(a=-1,l=(1-r.x)*t,o=this.paddingRight);for(var h=l+a*o-a*this.spacingX,c=0,u=0,_=0,d=0,f=0,p=0,m=0,y=0;y<s.length;++y)(T=s[y]).activeInHierarchy&&m++;var g=this.cellSize.width;for(this.type!==E.GRID&&this.resizeMode===M.CHILDREN&&(g=(t-(this.paddingLeft+this.paddingRight)-(m-1)*this.spacingX)/m),y=0;y<s.length;++y){var v,b,x,A,C,T=s[y],S=this._getUsedScaleValue(T.scaleX),w=this._getUsedScaleValue(T.scaleY);T.activeInHierarchy&&(this._resize===M.CHILDREN&&(T.width=g/S,this.type===E.GRID&&(T.height=this.cellSize.height/w)),C=T.anchorX,S=T.width*S,(u=u<_?_:u)<=(w=T.height*w)&&(_=u,u=w,p=T.getAnchorPoint().y),h=h+a*(C=this.horizontalDirection===B.RIGHT_TO_LEFT?1-T.anchorX:C)*S+a*this.spacingX,v=a*(1-C)*S,e&&(A=h+v+a*(0<a?this.paddingRight:this.paddingLeft),b=this.horizontalDirection===B.LEFT_TO_RIGHT&&A>(1-r.x)*t,A=this.horizontalDirection===B.RIGHT_TO_LEFT&&A<-r.x*t,(b||A)&&(u<=w?(c+=_=0===_?u:_,_=u):(c+=u,_=w,u=0),h=l+a*(o+C*S),d++)),b=i(T,c,d),t>=S+this.paddingLeft+this.paddingRight&&n&&T.setPosition(cc.v2(h,b)),A=1,C=0===u?w:u,this.verticalDirection===D.TOP_TO_BOTTOM?(f=f||this.node._contentSize.height,(x=b+(A=-1)*(C*p+this.paddingBottom))<f&&(f=x)):(f=f||-this.node._contentSize.height,(x=b+A*(C*p+this.paddingTop))>f&&(f=x)),h+=v)}return f},_getVerticalBaseHeight:function(t){var e=0,i=0;if(this.resizeMode===M.CONTAINER){for(var n=0;n<t.length;++n){var r=t[n];r.activeInHierarchy&&(i++,e+=r.height*this._getUsedScaleValue(r.scaleY))}e+=(i-1)*this.spacingY+this.paddingBottom+this.paddingTop}else e=this.node.getContentSize().height;return e},_doLayoutVertically:function(t,e,i,n){var r=this.node.getAnchorPoint(),s=this.node.children,a=1,o=this.paddingBottom,l=-r.y*t;this.verticalDirection===D.TOP_TO_BOTTOM&&(a=-1,l=(1-r.y)*t,o=this.paddingTop);for(var h=l+a*o-a*this.spacingY,c=0,u=0,_=0,d=0,f=0,p=0,m=0,y=0;y<s.length;++y)(T=s[y]).activeInHierarchy&&m++;var g=this.cellSize.height;for(this.type!==E.GRID&&this.resizeMode===M.CHILDREN&&(g=(t-(this.paddingTop+this.paddingBottom)-(m-1)*this.spacingY)/m),y=0;y<s.length;++y){var v,b,x,A,C,T=s[y],S=this._getUsedScaleValue(T.scaleX),w=this._getUsedScaleValue(T.scaleY);T.activeInHierarchy&&(this.resizeMode===M.CHILDREN&&(T.height=g/w,this.type===E.GRID&&(T.width=this.cellSize.width/S)),C=T.anchorY,S=T.width*S,w=T.height*w,(u=u<_?_:u)<=S&&(_=u,u=S,p=T.getAnchorPoint().x),h=h+a*(C=this.verticalDirection===D.TOP_TO_BOTTOM?1-T.anchorY:C)*w+a*this.spacingY,v=a*(1-C)*w,e&&(A=h+v+a*(0<a?this.paddingTop:this.paddingBottom),b=this.verticalDirection===D.BOTTOM_TO_TOP&&A>(1-r.y)*t,A=this.verticalDirection===D.TOP_TO_BOTTOM&&A<-r.y*t,(b||A)&&(u<=S?(c+=_=0===_?u:_,_=u):(c+=u,_=S,u=0),h=l+a*(o+C*w),d++)),b=i(T,c,d),t>=w+(this.paddingTop+this.paddingBottom)&&n&&T.setPosition(cc.v2(b,h)),A=1,C=0===u?S:u,this.horizontalDirection===B.RIGHT_TO_LEFT?(f=f||this.node._contentSize.width,(x=b+(A=-1)*(C*p+this.paddingLeft))<f&&(f=x)):(f=f||-this.node._contentSize.width,(x=b+A*(C*p+this.paddingRight))>f&&(f=x)),h+=v)}return f},_doLayoutBasic:function(){for(var t,e,i,n=this.node.children,r=null,s=0;s<n.length;++s){var a=n[s];a.activeInHierarchy&&(r?r.union(r,a.getBoundingBoxToWorld()):r=a.getBoundingBoxToWorld())}r&&(t=this.node.convertToNodeSpaceAR(cc.v2(r.x,r.y)),t=cc.v2(t.x-this.paddingLeft,t.y-this.paddingBottom),e=this.node.convertToNodeSpaceAR(cc.v2(r.xMax,r.yMax)),e=(e=cc.v2(e.x+this.paddingRight,e.y+this.paddingTop)).sub(t),0!==(e=cc.size(parseFloat(e.x.toFixed(2)),parseFloat(e.y.toFixed(2)))).width&&(i=-t.x/e.width,this.node.anchorX=parseFloat(i.toFixed(2))),0!==e.height&&(i=-t.y/e.height,this.node.anchorY=parseFloat(i.toFixed(2))),this.node.setContentSize(e))},_doLayoutGridAxisHorizontal:function(t,e){var i,n=e.width,r=1,s=-t.y*e.height,a=this.paddingBottom,e=(this.verticalDirection===D.TOP_TO_BOTTOM&&(r=-1,s=(1-t.y)*e.height,a=this.paddingTop),function(t,e,i){return s+r*(e+t.anchorY*t.height*this._getUsedScaleValue(t.scaleY)+a+i*this.spacingY)}.bind(this)),o=0;this.resizeMode===M.CONTAINER&&(i=this._doLayoutHorizontally(n,!0,e,!1),(o=s-i)<0&&(o*=-1),s=-t.y*o,this.verticalDirection===D.TOP_TO_BOTTOM&&(r=-1,s=(1-t.y)*o)),this._doLayoutHorizontally(n,!0,e,!0),this.resizeMode===M.CONTAINER&&this.node.setContentSize(n,o)},_doLayoutGridAxisVertical:function(t,e){var i,n=e.height,r=1,s=-t.x*e.width,a=this.paddingLeft,e=(this.horizontalDirection===B.RIGHT_TO_LEFT&&(r=-1,s=(1-t.x)*e.width,a=this.paddingRight),function(t,e,i){return s+r*(e+t.anchorX*t.width*this._getUsedScaleValue(t.scaleX)+a+i*this.spacingX)}.bind(this)),o=0;this.resizeMode===M.CONTAINER&&(i=this._doLayoutVertically(n,!0,e,!1),(o=s-i)<0&&(o*=-1),s=-t.x*o,this.horizontalDirection===B.RIGHT_TO_LEFT&&(r=-1,s=(1-t.x)*o)),this._doLayoutVertically(n,!0,e,!0),this.resizeMode===M.CONTAINER&&this.node.setContentSize(o,n)},_doLayoutGrid:function(){var t=this.node.getAnchorPoint(),e=this.node.getContentSize();this.startAxis===r.HORIZONTAL?this._doLayoutGridAxisHorizontal(t,e):this.startAxis===r.VERTICAL&&this._doLayoutGridAxisVertical(t,e)},_getHorizontalBaseWidth:function(t){var e=0,i=0;if(this.resizeMode===M.CONTAINER){for(var n=0;n<t.length;++n){var r=t[n];r.activeInHierarchy&&(i++,e+=r.width*this._getUsedScaleValue(r.scaleX))}e+=(i-1)*this.spacingX+this.paddingLeft+this.paddingRight}else e=this.node.getContentSize().width;return e},_doLayout:function(){var t;this.type===E.HORIZONTAL?(t=this._getHorizontalBaseWidth(this.node.children),this._doLayoutHorizontally(t,!1,function(t){return t.y},!0),this.node.width=t):this.type===E.VERTICAL?(t=this._getVerticalBaseHeight(this.node.children),this._doLayoutVertically(t,!1,function(t){return t.x},!0),this.node.height=t):this.type===E.NONE?this.resizeMode===M.CONTAINER&&this._doLayoutBasic():this.type===E.GRID&&this._doLayoutGrid()},_getUsedScaleValue:function(t){return this.affectedByScale?Math.abs(t):1},updateLayout:function(){this._layoutDirty&&0<this.node.children.length&&(this._doLayout(),this._layoutDirty=!1)}});cc.Layout=e.exports=t},{"../CCNode":72,"./CCComponent":120}],126:[function(t,e,i){"use strict";var n=o(t("../../renderer/gfx")),s=o(t("../value-types/mat4")),a=o(t("../value-types/vec2")),r=o(t("../assets/material/material-variant"));function o(t){return t&&t.__esModule?t:{default:t}}var l=t("../utils/misc"),h=t("./CCRenderComponent"),c=t("../renderer/render-flow"),u=t("../graphics/graphics"),_=new a.default,d=new s.default,f=[];var p=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),t=cc.Class({name:"cc.Mask",extends:h,editor:!1,ctor:function(){this._graphics=null,this._enableMaterial=null,this._exitMaterial=null,this._clearMaterial=null},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:p.RECT,type:{get:function(){return this._type},set:function(t){this._type!==t&&this._resetAssembler(),this._type=t,this._type!==p.IMAGE_STENCIL&&(this.spriteFrame=null,this.alphaThreshold=0,this._updateGraphics()),this._activateMaterial()},type:p,tooltip:!1},spriteFrame:{type:cc.SpriteFrame,tooltip:!1,get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t,this.setVertsDirty(),this._updateMaterial())}},alphaThreshold:{default:.1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS?this._updateMaterial():cc.warnID(4201)}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&cc.warnID(4202)}},_segments:64,segements:{get:function(){return this._segments},set:function(t){this._segments=l.clampf(t,3,1e4),this._updateGraphics()},type:cc.Integer,tooltip:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{Type:p},onRestore:function(){this._activateMaterial()},onEnable:function(){this._super(),this._type!==p.IMAGE_STENCIL&&this._updateGraphics(),this.node.on(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this),this.node._renderFlag&=~c.FLAG_POST_RENDER},onDestroy:function(){this._super(),this._removeGraphics()},_resizeNodeToTargetNode:!1,_validateRender:function(){var t;this._type!==p.IMAGE_STENCIL||(t=this._spriteFrame)&&t.textureLoaded()||this.disableRender()},_activateMaterial:function(){this._createGraphics();var t=this._materials[0];(t=t?r.default.create(t,this):r.default.createWithBuiltin("2d-sprite",this)).define("USE_ALPHA_TEST",!0),this._type===p.IMAGE_STENCIL?(t.define("CC_USE_MODEL",!1),t.define("USE_TEXTURE",!0)):(t.define("CC_USE_MODEL",!0),t.define("USE_TEXTURE",!1)),this._enableMaterial||(this._enableMaterial=r.default.createWithBuiltin("2d-sprite",this)),this._exitMaterial||(this._exitMaterial=r.default.createWithBuiltin("2d-sprite",this),this._exitMaterial.setStencilEnabled(n.default.STENCIL_DISABLE)),this._clearMaterial||(this._clearMaterial=r.default.createWithBuiltin("clear-stencil",this)),this.setMaterial(0,t),this._graphics._materials[0]=t,this._updateMaterial()},_updateMaterial:function(){var t,e=this._materials[0];e&&(this._type===p.IMAGE_STENCIL&&this.spriteFrame&&(t=this.spriteFrame.getTexture(),e.setProperty("texture",t)),e.setProperty("alphaThreshold",this.alphaThreshold))},_createGraphics:function(){this._graphics||(this._graphics=new u,cc.Assembler.init(this._graphics),this._graphics.node=this.node,this._graphics.lineWidth=0,this._graphics.strokeColor=cc.color(0,0,0,0))},_updateGraphics:function(){var t=this.node,e=this._graphics,i=(e.clear(!1),t._contentSize.width),n=t._contentSize.height,r=-i*t._anchorPoint.x,t=-n*t._anchorPoint.y;if(this._type===p.RECT)e.rect(r,t,i,n);else if(this._type===p.ELLIPSE){for(var s=function(t,e,i){f.length=0;for(var n=2*Math.PI/i,r=0;r<i;++r)f.push(cc.v2(e.x*Math.cos(n*r)+t.x,e.y*Math.sin(n*r)+t.y));return f}(cc.v2(r+i/2,t+n/2),{x:i/2,y:n/2},this._segments),a=0;a<s.length;++a){var o=s[a];0===a?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y)}e.close()}cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?e.stroke():e.fill()},_removeGraphics:function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},_hitTest:function(t){var e=this.node,i=e.getContentSize(),n=i.width,i=i.height,r=_;if(e._updateWorldMatrix(),!s.default.invert(d,e._worldMatrix))return!1;a.default.transformMat4(r,t,d),r.x+=e._anchorPoint.x*n,r.y+=e._anchorPoint.y*i;t=!1;return this.type===p.RECT||this.type===p.IMAGE_STENCIL?t=0<=r.x&&0<=r.y&&r.x<=n&&r.y<=i:this.type===p.ELLIPSE&&(t=(e=r.x-.5*n)*e/((e=n/2)*e)+(n=r.y-.5*i)*n/((e=i/2)*e)<1),t=this.inverted?!t:t},markForRender:function(t){var e=c.FLAG_RENDER|c.FLAG_UPDATE_RENDER_DATA|c.FLAG_POST_RENDER;t?(this.node._renderFlag|=e,this.markForValidate()):this.node._renderFlag&=~e},disableRender:function(){this.node._renderFlag&=~(c.FLAG_RENDER|c.FLAG_UPDATE_RENDER_DATA|c.FLAG_POST_RENDER)}});cc.Mask=e.exports=t},{"../../renderer/gfx":363,"../assets/material/material-variant":102,"../graphics/graphics":172,"../renderer/render-flow":263,"../utils/misc":315,"../value-types/mat4":332,"../value-types/vec2":339,"./CCRenderComponent":131}],127:[function(t,e,i){"use strict";var n=t("../components/CCRenderComponent"),r=t("../../core/utils/blend-func"),t=cc.Class({name:"cc.MotionStreak",extends:n,mixins:[r],editor:!1,ctor:function(){this._points=[]},properties:{preview:{default:!1,editorOnly:!0,notify:!1,animatable:!1},_fadeTime:1,fadeTime:{get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()},animatable:!1,tooltip:!1},_minSeg:1,minSeg:{get:function(){return this._minSeg},set:function(t){this._minSeg=t},animatable:!1,tooltip:!1},_stroke:64,stroke:{get:function(){return this._stroke},set:function(t){this._stroke=t},animatable:!1,tooltip:!1},_texture:{default:null,type:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this._updateMaterial())},type:cc.Texture2D,animatable:!1,tooltip:!1},_color:cc.Color.WHITE,color:{get:function(){return this._color},set:function(t){this._color=t},type:cc.Color,tooltip:!1},_fastMode:!1,fastMode:{get:function(){return this._fastMode},set:function(t){this._fastMode=t},animatable:!1,tooltip:!1}},onEnable:function(){this._super(),this.reset()},_updateMaterial:function(){var t=this.getMaterial(0);t&&t.setProperty("texture",this._texture),r.prototype._updateMaterial.call(this)},onFocusInEditor:!1,onLostFocusInEditor:!1,reset:function(){this._points.length=0,this._assembler&&this._assembler._renderData.clear()},lateUpdate:function(t){this._assembler&&this._assembler.update(this,t)}});cc.MotionStreak=e.exports=t},{"../../core/utils/blend-func":308,"../components/CCRenderComponent":131}],128:[function(t,e,i){"use strict";var s=cc.Enum({Unified:0,Free:1}),a=cc.Enum({Horizontal:0,Vertical:1}),n=cc.Enum({PAGE_TURNING:0}),r=cc.Class({name:"cc.PageView",extends:cc.ScrollView,editor:!1,ctor:function(){this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._initContentPos=cc.v2(),this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[]},properties:{sizeMode:{default:s.Unified,type:s,tooltip:!1,notify:function(){this._syncSizeMode()}},direction:{default:a.Horizontal,type:a,tooltip:!1,notify:function(){this._syncScrollDirection()}},scrollThreshold:{default:.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:!1},autoPageTurningThreshold:{default:100,type:cc.Float,tooltip:!1},pageTurningEventTiming:{default:.1,type:cc.Float,range:[0,1,.01],tooltip:!1},indicator:{default:null,type:cc.PageViewIndicator,tooltip:!1,notify:function(){this.indicator&&this.indicator.setPageView(this)}},pageTurningSpeed:{default:.3,type:cc.Float,tooltip:!1},pageEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{SizeMode:s,Direction:a,EventType:n},__preload:function(){this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this)},onEnable:function(){this._super(),this.node.on("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onDisable:function(){this._super(),this.node.off("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onLoad:function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},onDestroy:function(){this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this)},getCurrentPageIndex:function(){return this._curPageIdx},setCurrentPageIndex:function(t){this.scrollToPage(t,!0)},getPages:function(){return this._pages},addPage:function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(this.content.addChild(t),this._pages.push(t),this._updatePageView())},insertPage:function(t,e){e<0||!t||-1!==this._pages.indexOf(t)||!this.content||(e>=this._pages.length?this.addPage(t):(this._pages.splice(e,0,t),this.content.addChild(t),this._updatePageView()))},removePage:function(t){var e;t&&this.content&&(-1!==(e=this._pages.indexOf(t))?this.removePageAtIndex(e):cc.warnID(4300,t.name))},removePageAtIndex:function(t){var e,i=this._pages;t<0||t>=i.length||(e=i[t])&&(this.content.removeChild(e),i.splice(t,1),this._updatePageView())},removeAllPages:function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},scrollToPage:function(t,e){t<0||t>=this._pages.length||(e=void 0!==e?e:.3,this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming},_syncScrollDirection:function(){this.horizontal=this.direction===a.Horizontal,this.vertical=this.direction===a.Vertical},_syncSizeMode:function(){var t,e;this.content&&(t=this.content.getComponent(cc.Layout))&&(this.sizeMode===s.Free&&0<this._pages.length&&(e=this._pages[this._pages.length-1],this.direction===a.Horizontal?(t.paddingLeft=(this._view.width-this._pages[0].width)/2,t.paddingRight=(this._view.width-e.width)/2):this.direction===a.Vertical&&(t.paddingTop=(this._view.height-this._pages[0].height)/2,t.paddingBottom=(this._view.height-e.height)/2)),t.updateLayout())},_updatePageView:function(){var t=this.content.getComponent(cc.Layout),e=(t&&t.enabled&&t.updateLayout(),this._pages.length);this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var i=this._initContentPos,n=0;n<e;++n){var r=this._pages[n];r.setSiblingIndex(n),this.direction===a.Horizontal?this._scrollCenterOffsetX[n]=Math.abs(i.x+r.x):this._scrollCenterOffsetY[n]=Math.abs(i.y+r.y)}this.indicator&&this.indicator._refresh()},_updateAllPagesSize:function(){if(this.sizeMode===s.Unified)for(var t=this._pages,e=this._view.getContentSize(),i=0,n=t.length;i<n;i++)t[i].setContentSize(e)},_initPages:function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];0<=this._pages.indexOf(i)||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.Component.EventHandler.emitEvents(this.pageEvents,this,n.PAGE_TURNING),this.node.emit("page-turning",this))},_isScrollable:function(t,e,i){var n,r;return this.sizeMode===s.Free?this.direction===a.Horizontal?(n=this._scrollCenterOffsetX[e],r=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(n-r)*this.scrollThreshold):this.direction===a.Vertical?(n=this._scrollCenterOffsetY[e],r=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(n-r)*this.scrollThreshold):void 0:this.direction===a.Horizontal?Math.abs(t.x)>=this._view.width*this.scrollThreshold:this.direction===a.Vertical?Math.abs(t.y)>=this._view.height*this.scrollThreshold:void 0},_isQuicklyScrollable:function(t){if(this.direction===a.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===a.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},_moveOffsetValue:function(t){var e=cc.v2(0,0);return this.sizeMode===s.Free?this.direction===a.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===a.Vertical&&(e.y=this._scrollCenterOffsetY[t]):this.direction===a.Horizontal?e.x=t*this._view.width:this.direction===a.Vertical&&(e.y=t*this._view.height),e},_getDragDirection:function(t){return this.direction===a.Horizontal?0===t.x?0:0<t.x?1:-1:this.direction===a.Vertical?0===t.y?0:t.y<0?1:-1:void 0},_handleReleaseLogic:function(t){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_autoScrollToPage:function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();(0<(t=this._clampDelta(t)).x||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||0<t.y)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var t=this._touchBeganPosition.sub(this._touchEndPosition),e=this._curPageIdx,i=e+this._getDragDirection(t),n=this.pageTurningSpeed*Math.abs(e-i);if(i<this._pages.length){if(this._isScrollable(t,e,i))return void this.scrollToPage(i,n);t=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(t))return void this.scrollToPage(i,n)}this.scrollToPage(e,n)}},_onTouchBegan:function(t,e){this._touchBeganPosition=t.touch.getLocation(),this._super(t,e)},_onTouchMoved:function(t,e){this._super(t,e)},_onTouchEnded:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e)},_onTouchCancelled:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e)},_onMouseWheel:function(){}});cc.PageView=e.exports=r},{}],129:[function(t,e,i){"use strict";var n=cc.Enum({HORIZONTAL:0,VERTICAL:1}),t=cc.Class({name:"cc.PageViewIndicator",extends:t("./CCComponent"),editor:!1,properties:{_layout:null,_pageView:null,_indicators:[],spriteFrame:{default:null,type:cc.SpriteFrame,tooltip:!1},direction:{default:n.HORIZONTAL,type:n,tooltip:!1},cellSize:{default:cc.size(20,20),tooltip:!1},spacing:{default:0,tooltip:!1}},statics:{Direction:n},onLoad:function(){this._updateLayout()},setPageView:function(t){this._pageView=t,this._refresh()},_updateLayout:function(){this._layout=this.getComponent(cc.Layout),this._layout||(this._layout=this.addComponent(cc.Layout)),this.direction===n.HORIZONTAL?(this._layout.type=cc.Layout.Type.HORIZONTAL,this._layout.spacingX=this.spacing):this.direction===n.VERTICAL&&(this._layout.type=cc.Layout.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=cc.Layout.ResizeMode.CONTAINER},_createIndicator:function(){var t=new cc.Node,e=t.addComponent(cc.Sprite);return e.spriteFrame=this.spriteFrame,e.sizeMode=cc.Sprite.SizeMode.CUSTOM,t.parent=this.node,t.width=this.cellSize.width,t.height=this.cellSize.height,t},_changedState:function(){var t=this._indicators;if(0!==t.length){var e=this._pageView._curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i)t[i].opacity=127.5;t[e].opacity=255}}},_refresh:function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;0<i;--i){var n=t[i-1];this.node.removeChild(n),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}}});cc.PageViewIndicator=e.exports=t},{"./CCComponent":120}],130:[function(t,e,i){"use strict";var c=t("../utils/misc"),t=t("./CCComponent"),u=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),t=cc.Class({name:"cc.ProgressBar",extends:t,editor:!1,_initBarSprite:function(){var t,e,i,n;this.barSprite&&(t=this.barSprite.node)&&(e=this.node.getContentSize(),i=this.node.getAnchorPoint(),n=t.getContentSize(),t.parent===this.node&&this.node.setContentSize(n),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=u.FILLED),n=t.getContentSize(),this.mode===u.HORIZONTAL?this.totalLength=n.width:this.mode===u.VERTICAL?this.totalLength=n.height:this.totalLength=this.barSprite.fillRange,t.parent===this.node&&(n=-e.width*i.x,t.setPosition(cc.v2(n,0))))},_updateBarStatus:function(){if(this.barSprite){var t=this.barSprite.node;if(t){var e,i,n,r=t.getAnchorPoint(),s=t.getContentSize(),a=t.getPosition(),o=cc.v2(0,.5),l=c.clamp01(this.progress),h=this.totalLength*l;switch(this.mode){case u.HORIZONTAL:this.reverse&&(o=cc.v2(1,.5)),e=cc.size(h,s.height),i=this.totalLength,n=s.height;break;case u.VERTICAL:o=this.reverse?cc.v2(.5,1):cc.v2(.5,0),e=cc.size(s.width,h),i=s.width,n=this.totalLength}this.mode===u.FILLED?this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(h*=-1),this.barSprite.fillRange=h):this.barSprite.type!==cc.Sprite.Type.FILLED?(l=o.x-r.x,r=o.y-r.y,l=cc.v2(i*l,n*r),t.setPosition(a.x+l.x,a.y+l.y),t.setAnchorPoint(o),t.setContentSize(e)):cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}}},properties:{barSprite:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite()},animatable:!1},mode:{default:u.HORIZONTAL,type:u,tooltip:!1,notify:function(){var t;this.barSprite&&(t=this.barSprite.node)&&(t=t.getContentSize(),this.mode===u.HORIZONTAL?this.totalLength=t.width:this.mode===u.VERTICAL?this.totalLength=t.height:this.mode===u.FILLED&&(this.totalLength=this.barSprite.fillRange))},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength},set:function(t){this.mode===u.FILLED&&(t=c.clamp01(t)),this._N$totalLength=t,this._updateBarStatus()}},progress:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus()}},reverse:{default:!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus()},animatable:!1}},statics:{Mode:u}});cc.ProgressBar=e.exports=t},{"../utils/misc":315,"./CCComponent":120}],131:[function(t,e,i){"use strict";var n=s(t("../renderer/assembler")),r=s(t("../assets/material/material-variant"));function s(t){return t&&t.__esModule?t:{default:t}}var a=t("./CCComponent"),o=t("../renderer/render-flow"),l=t("../assets/material/CCMaterial"),t=cc.Class({name:"RenderComponent",extends:a,editor:!1,properties:{_materials:{default:[],type:l},materials:{get:function(){return this._materials},set:function(t){this._materials=t,this._activateMaterial()},type:[l],displayName:"Materials",animatable:!1}},ctor:function(){this._vertsDirty=!0,this._assembler=null},_resetAssembler:function(){n.default.init(this),this._updateColor(),this.setVertsDirty()},__preload:function(){this._resetAssembler(),this._activateMaterial()},onEnable:function(){this.node._renderComponent&&(this.node._renderComponent.enabled=!1),(this.node._renderComponent=this).node._renderFlag|=o.FLAG_OPACITY_COLOR,this.setVertsDirty()},onDisable:function(){this.node._renderComponent=null,this.disableRender()},onDestroy:function(){for(var t=this._materials,e=0;e<t.length;e++)cc.pool.material.put(t[e]);t.length=0,cc.pool.assembler.put(this._assembler)},setVertsDirty:function(){this._vertsDirty=!0,this.markForRender(!0)},_on3DNodeChanged:function(){this._resetAssembler()},_validateRender:function(){},markForValidate:function(){cc.RenderFlow.registerValidate(this)},markForRender:function(t){var e=o.FLAG_RENDER|o.FLAG_UPDATE_RENDER_DATA;t?(this.node._renderFlag|=e,this.markForValidate()):this.node._renderFlag&=~e},disableRender:function(){this.node._renderFlag&=~(o.FLAG_RENDER|o.FLAG_UPDATE_RENDER_DATA)},getMaterial:function(t){if(t<0||t>=this._materials.length)return null;var e=this._materials[t];if(!e)return null;var i=r.default.create(e,this);return i!==e&&this.setMaterial(t,i),i},getMaterials:function(){for(var t=this._materials,e=0;e<t.length;e++)t[e]=r.default.create(t[e],this);return t},setMaterial:function(t,e){return e!==this._materials[t]&&(e=r.default.create(e,this),this._materials[t]=e),this._updateMaterial(),this.markForRender(!0),e},_getDefaultMaterial:function(){return l.getBuiltinMaterial("2d-sprite")},_activateMaterial:function(){var t,e=this._materials;e[0]||(t=this._getDefaultMaterial(),e[0]=t);for(var i=0;i<e.length;i++)e[i]=r.default.create(e[i],this);this._updateMaterial()},_updateMaterial:function(){},_updateColor:function(){this._assembler.updateColor&&this._assembler.updateColor(this)},_checkBacth:function(t,e){var i=this._materials[0];(i&&i.getHash()!==t.material.getHash()||t.cullingMask!==e)&&(t._flush(),t.node=i.getDefine("CC_USE_MODEL")?this.node:t._dummyNode,t.material=i,t.cullingMask=e)}});cc.RenderComponent=e.exports=t},{"../assets/material/CCMaterial":95,"../assets/material/material-variant":102,"../renderer/assembler":259,"../renderer/render-flow":263,"./CCComponent":120}],132:[function(t,e,i){"use strict";var n=t("../platform/js"),r=t("../platform/CCMacro"),u=t("../utils/text-utils"),h=new(t("../utils/html-text-parser")),_=r.TextAlignment,s=r.VerticalTextAlignment,t=cc.Label.CacheMode,a=new n.Pool(function(t){if(!cc.isValid(t))return!1;t=t.getComponent(cc.LabelOutline);return t&&(t.width=0),!0},20),r=(a.get=function(t,e){var i=this._get(),n=((i=i||new cc.PrivateNode("RICHTEXT_CHILD")).setPosition(0,0),i.setAnchorPoint(.5,.5),i.skewX=0,i.getComponent(cc.Label));return(n=n||i.addComponent(cc.Label)).string="",n.horizontalAlign=_.LEFT,n.verticalAlign=s.CENTER,i},cc.Class({name:"cc.RichText",extends:cc.Component,ctor:function(){this._textArray=null,this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._updateRichTextStatus=this._updateRichText},editor:!1,properties:{string:{default:"<color=#00ff00>Rich</c><color=#0fffff>Text</color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus()}},horizontalAlign:{default:_.LEFT,type:_,tooltip:!1,animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{default:40,tooltip:!1,notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},_fontFamily:"Arial",fontFamily:{tooltip:!1,get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())},animatable:!1},font:{default:null,type:cc.TTFFont,tooltip:!1,notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())},animatable:!1,tooltip:!1},cacheMode:{default:t.NONE,type:t,tooltip:!1,notify:function(t){this.cacheMode!==t&&this._updateRichTextStatus()},animatable:!1},maxWidth:{default:0,tooltip:!1,notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{default:40,tooltip:!1,notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},handleTouchEvent:{default:!0,tooltip:!1,notify:function(t){this.handleTouchEvent!==t&&this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners())}}},statics:{HorizontalAlign:_,VerticalAlign:s},onEnable:function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},onDisable:function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},start:function(){this._onTTFLoaded()},_onColorChanged:function(e){this.node.children.forEach(function(t){t.color=e})},_addEventListeners:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},_removeEventListeners:function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t,null,!0)}.bind(this))},_createFontLabel:function(t){return a.get(t,this)},_onTTFLoaded:function(){var i;!(this.font instanceof cc.TTFFont)||this.font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):(i=this,cc.loader.load(this.font.nativeUrl,function(t,e){i._layoutDirty=!0,i._updateRichText()}))},_measureText:function(i,t){function e(t){var e;return 0===n._labelSegmentsCache.length?(e=n._createFontLabel(t),n._labelSegmentsCache.push(e)):e=n._labelSegmentsCache[0],e._styleIndex=i,n._applyTextAttribute(e,t,!0),e.getContentSize().width}var n=this;return t?e(t):e},_onTouchEnded:function(n){for(var r=this,s=this.node.getComponents(cc.Component),t=0;t<this._labelSegments.length;++t)!function(t){var t=r._labelSegments[t],e=t._clickHandler,i=t._clickParam;e&&r._containsTouchLocation(t,n.touch.getLocation())&&(s.forEach(function(t){t.enabledInHierarchy&&t[e]&&t[e](n,i)}),n.stopPropagation())}(t)},_containsTouchLocation:function(t,e){return t.getBoundingBoxToWorld().contains(e)},_resetState:function(){for(var t=this.node.children,e=t.length-1;0<=e;e--){var i=t[e];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.parent===this.node?i.parent=null:t.splice(e,1),"RICHTEXT_CHILD"===i.name&&a.put(i))}this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},onRestore:!1,_activateChildren:function(t){for(var e=this.node.children.length-1;0<=e;e--){var i=this.node.children[e];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.active=t)}},_addLabelSegment:function(t,e){var i;return(i=0===this._labelSegmentsCache.length?this._createFontLabel(t):this._labelSegmentsCache.pop())._styleIndex=e,i._lineCount=this._lineCount,i.active=this.node.active,i.setAnchorPoint(0,0),this._applyTextAttribute(i,t),this.node.addChild(i),this._labelSegments.push(i),i},_updateRichTextWithMaxWidth:function(t,e,i){var n=e;if(0<this._lineOffsetX&&n+this._lineOffsetX>this.maxWidth)for(var r=0;this._lineOffsetX<=this.maxWidth;){var s,a=this._getFirstWordLen(t,r,t.length),o=t.substr(r,a),o=this._measureText(i,o);if(!(this._lineOffsetX+o<=this.maxWidth)){0<r&&(s=t.substr(0,r),this._addLabelSegment(s,i),t=t.substr(r,t.length),n=this._measureText(i,t)),this._updateLineInfo();break}this._lineOffsetX+=o,r+=a}if(n>this.maxWidth)for(var l=u.fragmentText(t,n,this.maxWidth,this._measureText(i)),h=0;h<l.length;++h){var c=l[h],c=this._addLabelSegment(c,i).getContentSize();this._lineOffsetX+=c.width,1<l.length&&h<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf("\n")},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;i=i.style,n=n.style;if(i){if(n){if(!i.outline!=!n.outline)return!0;if(i.size!==n.size||!i.italic!=!n.italic||i.isImage!==n.isImage)return!0;if(i.src!==n.src||i.imageAlign!==n.imageAlign||i.imageHeight!==n.imageHeight||i.imageWidth!==n.imageWidth||i.imageOffset!==n.imageOffset)return!0}else if(i.size||i.italic||i.isImage||i.outline)return!0}else if(n&&(n.size||n.italic||n.isImage||n.outline))return!0}return!1},_addRichTextImageElement:function(t){var e=t.style.src,e=this.imageAtlas.getSpriteFrame(e);if(e){var i=new cc.PrivateNode("RICHTEXT_Image_CHILD"),n=i.addComponent(cc.Sprite);switch(t.style.imageAlign){case"top":i.setAnchorPoint(0,1);break;case"center":i.setAnchorPoint(0,.5);break;default:i.setAnchorPoint(0,0)}t.style.imageOffset&&(i._imageOffset=t.style.imageOffset),n.type=cc.Sprite.Type.SLICED,n.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.node.addChild(i),this._labelSegments.push(i);var r=e.getRect(),s=1,a=r.width,r=r.height,o=t.style.imageWidth,l=t.style.imageHeight;a*=s=0<l?l/r:this.lineHeight/r,r*=s,0<o&&(a=o),0<this.maxWidth?(this._lineOffsetX+a>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=a):(this._lineOffsetX+=a,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),n.spriteFrame=e,i.setContentSize(a,r),i._lineCount=this._lineCount,t.style.event?(t.style.event.click&&(i._clickHandler=t.style.event.click),t.style.event.param?i._clickParam=t.style.event.param:i._clickParam=""):i._clickHandler=null}else cc.warnID(4400)},_updateRichText:function(){if(this.enabledInHierarchy){var t=h.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t,this._resetState();for(var e=!1,i=0;i<this._textArray.length;++i){var n=this._textArray[i],r=n.text;if(""===r){if(n.style&&n.style.newline){this._updateLineInfo();continue}if(n.style&&n.style.isImage&&this.imageAtlas){this._addRichTextImageElement(n);continue}}for(var s=r.split("\n"),a=0;a<s.length;++a){var o,l=s[a];""!==l?(e=!1,0<this.maxWidth?(o=this._measureText(i,l),this._updateRichTextWithMaxWidth(l,o,i)):(o=this._addLabelSegment(l,i).getContentSize(),this._lineOffsetX+=o.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),1<s.length&&a<s.length-1&&this._updateLineInfo()):this._isLastComponentCR(r)&&a===s.length-1||(this._updateLineInfo(),e=!0)}}e||this._linesWidth.push(this._lineOffsetX),0<this.maxWidth&&(this._labelWidth=this.maxWidth),this._labelHeight=(this._lineCount+u.BASELINE_RATIO)*this.lineHeight,this.node.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(u.isUnicodeCJK(n)||u.isUnicodeSpace(n))return 1;for(var r=1,s=e+1;s<i&&(n=t.charAt(s),!u.isUnicodeSpace(n)&&!u.isUnicodeCJK(n));++s)r++;return r},_updateRichTextPosition:function(){for(var t=0,e=1,i=this._lineCount,n=0;n<this._labelSegments.length;++n){var r=this._labelSegments[n],s=r._lineCount,a=(e<s&&(t=0,e=s),0);switch(this.horizontalAlign){case _.LEFT:a=-this._labelWidth/2;break;case _.CENTER:a=-this._linesWidth[s-1]/2;break;case _.RIGHT:a=this._labelWidth/2-this._linesWidth[s-1]}r.x=t+a;var o=r.getContentSize();if(r.y=this.lineHeight*(i-s)-this._labelHeight/2,s===e&&(t+=o.width),r.getComponent(cc.Sprite)){var l,h=this.lineHeight,c=this.lineHeight*(1+u.BASELINE_RATIO);switch(r.anchorY){case 1:r.y+=h+(c-h)/2;break;case.5:r.y+=c/2;break;default:r.y+=(c-h)/2}r._imageOffset&&(1===(o=r._imageOffset.split(",")).length&&o[0]?(l=parseFloat(o[0]),Number.isInteger(l)&&(r.y+=l)):2===o.length&&(l=parseFloat(o[0]),o=parseFloat(o[1]),Number.isInteger(l)&&(r.x+=l),Number.isInteger(o)&&(r.y+=o)))}o=r.getComponent(cc.LabelOutline);o&&o.width&&(r.y=r.y-o.width)}},_convertLiteralColorValue:function(t){var e=t.toUpperCase();return cc.Color[e]||cc.color().fromHEX(t)},_applyTextAttribute:function(t,e,i){var n,r,s=t.getComponent(cc.Label);s&&(r=t._styleIndex,n=null,(n=this._textArray[r]?this._textArray[r].style:n)&&n.color?t.color=this._convertLiteralColorValue(n.color):t.color=this.node.color,s.cacheMode=this.cacheMode,this.font instanceof cc.Font&&!this._isSystemFontUsed?s.font=this.font:s.fontFamily=this.fontFamily,s.useSystemFont=this._isSystemFontUsed,s.lineHeight=this.lineHeight,s.enableBold=n&&n.bold,s.enableItalics=n&&n.italic,n&&n.italic&&(t.skewX=12),s.enableUnderline=n&&n.underline,n&&n.outline&&((r=(r=t.getComponent(cc.LabelOutline))||t.addComponent(cc.LabelOutline)).color=this._convertLiteralColorValue(n.outline.color),r.width=n.outline.width),n&&n.size?s.fontSize=n.size:s.fontSize=this.fontSize,null!==e&&(s.string=e="string"!=typeof e?""+e:e),i&&s._forceUpdateRenderData(),n&&n.event?(n.event.click&&(t._clickHandler=n.event.click),n.event.param?t._clickParam=n.event.param:t._clickParam=""):t._clickHandler=null)},onDestroy:function(){for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(),a.put(this._labelSegments[t])}}));cc.RichText=e.exports=r},{"../platform/CCMacro":235,"../platform/js":250,"../utils/html-text-parser":312,"../utils/text-utils":322}],133:[function(t,e,i){"use strict";var a=t("../utils/misc"),c=(t("./CCComponent"),cc.Enum({HORIZONTAL:0,VERTICAL:1})),t=cc.Class({name:"cc.Scrollbar",extends:t("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{default:0,serializable:!1},_opacity:255,handle:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},direction:{default:c.HORIZONTAL,type:c,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},enableAutoHide:{default:!0,animatable:!1,tooltip:!1},autoHideTime:{default:1,animatable:!1,tooltip:!1}},statics:{Direction:c},setTargetScrollView:function(t){this._scrollView=t},_convertToScrollViewSpace:function(t){var e=this._scrollView.node,t=t.convertToWorldSpaceAR(cc.v2(-t.anchorX*t.width,-t.anchorY*t.height)),t=e.convertToNodeSpaceAR(t);return t.x+=e.anchorX*e.width,t.y+=e.anchorY*e.height,t},_setOpacity:function(t){this.handle&&(this.node.opacity=t,this.handle.node.opacity=t)},_onScroll:function(t){var e,i,n,r,s,a,o,l,h;this._scrollView&&(e=this._scrollView.content)&&(l=e.getContentSize(),h=this._scrollView.node.getContentSize(),i=this.node.getContentSize(),this._conditionalDisableScrollBar(l,h)||(this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)),o=a=s=r=n=0,this.direction===c.HORIZONTAL?(n=l.width,r=h.width,o=i.width,s=t.x,a=-this._convertToScrollViewSpace(e).x):this.direction===c.VERTICAL&&(n=l.height,r=h.height,o=i.height,s=t.y,a=-this._convertToScrollViewSpace(e).y),l=this._calculateLength(n,r,o,s),h=this._calculatePosition(n,r,o,a,s,l),this._updateLength(l),this._updateHanlderPosition(h)))},_updateHanlderPosition:function(t){var e;this.handle&&(e=this._fixupHandlerPosition(),this.handle.node.setPosition(t.x+e.x,t.y+e.y))},_fixupHandlerPosition:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=this.handle.node.getContentSize(),n=this.handle.node.parent,e=this.node.convertToWorldSpaceAR(cc.v2(-t.width*e.x,-t.height*e.y)),n=n.convertToNodeSpaceAR(e);return this.direction===c.HORIZONTAL?n=cc.v2(n.x,n.y+(t.height-i.height)/2):this.direction===c.VERTICAL&&(n=cc.v2(n.x+(t.width-i.width)/2,n.y)),this.handle.node.setPosition(n),n},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(t,e){return t.width<=e.width&&this.direction===c.HORIZONTAL||t.height<=e.height&&this.direction===c.VERTICAL},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var t=t.getContentSize(),e=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(t,e))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(t,e,i,n){return n&&(t+=20*(0<n?n:-n)),i*(e/t)},_calculatePosition:function(t,e,i,n,r,s){t-=e,r&&(t+=Math.abs(r)),e=0,r=(i-s)*(e=t?a.clamp01(e=n/t):e);return this.direction===c.VERTICAL?cc.v2(0,r):cc.v2(r,0)},_updateLength:function(t){var e,i;this.handle&&(i=(e=this.handle.node).getContentSize(),e.setAnchorPoint(cc.v2(0,0)),this.direction===c.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t))},_processAutoHide:function(t){this.enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)&&(this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime),t=this._opacity*(this._autoHideRemainingTime/this.autoHideTime),this._setOpacity(t))},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},update:function(t){this._processAutoHide(t)}});cc.Scrollbar=e.exports=t},{"../utils/misc":315,"./CCComponent":120}],134:[function(t,e,i){"use strict";function n(){return(new Date).getMilliseconds()}var r=t("../CCNode").EventType,s=cc.v2(),a=cc.v2(),o=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12}),l={"scroll-to-top":o.SCROLL_TO_TOP,"scroll-to-bottom":o.SCROLL_TO_BOTTOM,"scroll-to-left":o.SCROLL_TO_LEFT,"scroll-to-right":o.SCROLL_TO_RIGHT,scrolling:o.SCROLLING,"bounce-bottom":o.BOUNCE_BOTTOM,"bounce-left":o.BOUNCE_LEFT,"bounce-right":o.BOUNCE_RIGHT,"bounce-top":o.BOUNCE_TOP,"scroll-ended":o.SCROLL_ENDED,"touch-up":o.TOUCH_UP,"scroll-ended-with-threshold":o.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":o.SCROLL_BEGAN},t=cc.Class({name:"cc.ScrollView",extends:t("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.v2(0,0),this._autoScrollTargetDelta=cc.v2(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._outOfBoundaryAmount=cc.v2(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._scrolling=!1},properties:{content:{default:void 0,type:cc.Node,tooltip:!1,formerlySerializedAs:"content",notify:function(t){this._calculateBoundary()}},horizontal:{default:!0,animatable:!1,tooltip:!1},vertical:{default:!0,animatable:!1,tooltip:!1},inertia:{default:!0,tooltip:!1},brake:{default:.5,type:cc.Float,range:[0,1,.1],tooltip:!1},elastic:{default:!0,animatable:!1,tooltip:!1},bounceDuration:{default:1,range:[0,10],tooltip:!1},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1},cancelInnerEvents:{default:!0,animatable:!1,tooltip:!1},_view:{get:function(){if(this.content)return this.content.parent}}},statics:{EventType:o},scrollToBottom:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0)},scrollToTop:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToTopLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToTopRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToBottomLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToBottomRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToOffset:function(t,e,i){var n=this.getMaxScrollOffset(),r=cc.v2(0,0);0===n.x?r.x=0:r.x=t.x/n.x,0===n.y?r.y=1:r.y=(n.y-t.y)/n.y,this.scrollTo(r,e,i)},getScrollOffset:function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return cc.v2(e,t)},getMaxScrollOffset:function(){var t=this._view.getContentSize(),e=this.content.getContentSize(),i=0<=(i=e.width-t.width)?i:0,e=0<=(e=e.height-t.height)?e:0;return cc.v2(i,e)},scrollToPercentHorizontal:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t)},scrollTo:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t)},scrollToPercentVertical:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(t){t.fuzzyEquals(this.getContentPosition(),1e-4)||(this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},isScrolling:function(){return this._scrolling},isAutoScrolling:function(){return this._autoScrolling},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(t,e){this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)&&(e=cc.v2(0,0),this.vertical?e=cc.v2(0,-.1*t.getScrollY()):this.horizontal&&(e=cc.v2(-.1*t.getScrollY(),0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(e),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t))},_checkMouseWheel:function(t){if(!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,.1<this._mouseWheelEventElapsedTime&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(t){var e=t.anchor,i=t.applyToHorizontal,t=t.applyToVertical,n=(this._calculateBoundary(),e=e.clampf(cc.v2(0,0),cc.v2(1,1)),this._view.getContentSize()),r=this.content.getContentSize(),s=-(this._getContentBottomBoundary()-this._bottomBoundary),a=-(this._getContentLeftBoundary()-this._leftBoundary),o=cc.v2(0,0),l=0;return i&&(l=r.width-n.width,o.x=a-l*e.x),t&&(l=r.height-n.height,o.y=s-l*e.y),o},_moveContentToTopLeft:function(t){var e=this.content.getContentSize(),i=-(this._getContentBottomBoundary()-this._bottomBoundary),n=cc.v2(0,0),r=0,s=-(this._getContentLeftBoundary()-this._leftBoundary);e.height<t.height&&(r=e.height-t.height,n.y=i-r),e.width<t.width&&(r=e.width-t.width,n.x=s),this._updateScrollBarState(),this._moveContent(n),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){var t,e,i;this.content&&((t=this.content.getComponent(cc.Layout))&&t.enabledInHierarchy&&t.updateLayout(),e=(t=this._view.getContentSize()).width*this._view.anchorX,i=t.height*this._view.anchorY,this._leftBoundary=-e,this._bottomBoundary=-i,this._rightBoundary=this._leftBoundary+t.width,this._topBoundary=this._bottomBoundary+t.height,this._moveContentToTopLeft(t))},_hasNestedViewGroup:function(t,e){if(t.eventPhase===cc.Event.CAPTURING_PHASE){if(e)for(var i=0;i<e.length;++i){var n=e[i];if(this.node===n)return!!t.target.getComponent(cc.ViewGroup);if(n.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(t){t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node&&t.stopPropagation()},_onTouchBegan:function(t,e){this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)&&(e=t.touch,this.content&&this._handlePressLogic(e),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t))},_onTouchMoved:function(t,e){this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)&&(e=t.touch,this.content&&this._handleMoveLogic(e),this.cancelInnerEvents&&(7<e.getLocation().sub(e.getStartLocation()).mag()&&!this._touchMoved&&t.target!==this.node&&((e=new cc.Event.EventTouch(t.getTouches(),t.bubbles)).type=cc.Node.EventType.TOUCH_CANCEL,e.touch=t.touch,e.simulate=!0,t.target.dispatchEvent(e),this._touchMoved=!0),this._stopPropagationIfTargetIsMe(t)))},_onTouchEnded:function(t,e){this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)&&(this._dispatchEvent("touch-up"),e=t.touch,this.content&&this._handleReleaseLogic(e),this._touchMoved?t.stopPropagation():this._stopPropagationIfTargetIsMe(t))},_onTouchCancelled:function(t,e){this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)&&(t.simulate||(e=t.touch,this.content&&this._handleReleaseLogic(e)),this._stopPropagationIfTargetIsMe(t))},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t)},_getLocalAxisAlignDelta:function(t){return this.node.convertToNodeSpaceAR(t.getLocation(),s),this.node.convertToNodeSpaceAR(t.getPreviousLocation(),a),s.sub(a)},_handleMoveLogic:function(t){t=this._getLocalAxisAlignDelta(t);this._processDeltaMove(t)},_scrollChildren:function(t){var t=t=this._clampDelta(t),e=(this.elastic&&(e=this._getHowMuchOutOfBoundary(),t.x*=0===e.x?1:.5,t.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(t),t=t.add(e)),-1);0<t.y?this.content.y-this.content.anchorY*this.content.height+t.y>=this._bottomBoundary&&(e="scroll-to-bottom"):t.y<0&&this.content.y-this.content.anchorY*this.content.height+this.content.height+t.y<=this._topBoundary&&(e="scroll-to-top"),t.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+t.x<=this._rightBoundary&&(e="scroll-to-right"):0<t.x&&this.content.x-this.content.anchorX*this.content.width+t.x>=this._leftBoundary&&(e="scroll-to-left"),this._moveContent(t,!1),0===t.x&&0===t.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling")),-1!==e&&this._dispatchEvent(e)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=n(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},_clampDelta:function(t){var e=this.content.getContentSize(),i=this._view.getContentSize();return e.width<i.width&&(t.x=0),e.height<i.height&&(t.y=0),t},_gatherTouchMove:function(t){for(t=this._clampDelta(t);5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);t=n();this._touchMoveTimeDeltas.push((t-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=t},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if((t=this._clampDelta(t)).fuzzyEquals(cc.v2(0,0),1e-4))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(0<t.y&&this._dispatchEvent("bounce-top"),t.y<0&&this._dispatchEvent("bounce-bottom"),0<t.x&&this._dispatchEvent("bounce-right"),t.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0},_processInertiaScroll:function(){var t;!this._startBounceBackIfNeeded()&&this.inertia&&!(t=this._calculateTouchMoveVelocity()).fuzzyEquals(cc.v2(0,0),1e-4)&&this.brake<1&&this._startInertiaScroll(t),this._onScrollBarTouchEnded()},_handleReleaseLogic:function(t){t=this._getLocalAxisAlignDelta(t);this._gatherTouchMove(t),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_isOutOfBoundary:function(){return!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return 1e-4},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?.05:1,t=(this._autoScrollAccumulatedTime+=t*(1/i),Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime)),n=(this._autoScrollAttenuate&&(n=t,t=--n*n*n*n*n+1),this._autoScrollStartPosition.add(this._autoScrollTargetDelta.mul(t))),r=Math.abs(t-1)<=1e-4,t=(Math.abs(t-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic?(t=n.sub(this._autoScrollBrakingStartPosition),e&&(t=t.mul(i)),n=this._autoScrollBrakingStartPosition.add(t)):(e=n.sub(this.getContentPosition()),(i=this._getHowMuchOutOfBoundary(e)).fuzzyEquals(cc.v2(0,0),1e-4)||(n=n.add(i),r=!0)),r&&(this._autoScrolling=!1),n.sub(this.getContentPosition()));this._moveContent(this._clampDelta(t),r),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(t){var e=t.mul(.7);this._startAttenuatingAutoScroll(e,t)},_calculateAttenuatedFactor:function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},_startAttenuatingAutoScroll:function(t,e){var e=this._calculateAutoScrollTimeByInitalSpeed(e.mag()),i=t.normalize(),n=this.content.getContentSize(),r=this._view.getContentSize(),s=n.width-r.width,n=n.height-r.height,r=this._calculateAttenuatedFactor(s),a=this._calculateAttenuatedFactor(n),i=cc.v2(i.x*s*(1-this.brake)*r,i.y*n*a*(1-this.brake)),s=t.mag(),r=i.mag()/s;i=i.add(t),0<this.brake&&7<r&&(r=Math.sqrt(r),i=t.mul(r).add(t)),0<this.brake&&3<r&&(e*=r=3),0===this.brake&&1<r&&(e*=r),this._startAutoScroll(i,e,!0)},_calculateAutoScrollTimeByInitalSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAutoScroll:function(t,e,i){t=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=t,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4)||(this._autoScrollCurrentlyOutOfBoundary=!0)},_calculateTouchMoveVelocity:function(){var t;if((t=this._touchMoveTimeDeltas.reduce(function(t,e){return t+e},0))<=0||.5<=t)return cc.v2(0,0);var e=cc.v2(0,0),e=this._touchMoveDisplacements.reduce(function(t,e){return t.add(e)},e);return cc.v2(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t)},_flattenVectorByDirection:function(t){return t.x=this.horizontal?t.x:0,t.y=this.vertical?t.y:0,t},_moveContent:function(t,e){t=this._flattenVectorByDirection(t),t=this.getContentPosition().add(t),this.setContentPosition(t),t=this._getHowMuchOutOfBoundary();this._updateScrollBar(t),this.elastic&&e&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(t){if((t=t||cc.v2(0,0)).fuzzyEquals(cc.v2(0,0),1e-4)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.v2(0,0);return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.fuzzyEquals(cc.v2(0,0),1e-4)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e)},_updateScrollBarState:function(){var t,e;this.content&&(t=this.content.getContentSize(),e=this._view.getContentSize(),this.verticalScrollBar&&(t.height<e.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(t.width<e.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show()))},_updateScrollBar:function(t){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(t),this.verticalScrollBar&&this.verticalScrollBar._onScroll(t)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var e=1<<l[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,l[t]),this.node.emit(t,this)},_adjustContentOutOfBoundary:function(){var t;this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()&&(t=this._getHowMuchOutOfBoundary(cc.v2(0,0)),t=this.getContentPosition().add(t),this.content&&(this.content.setPosition(t),this._updateScrollBar(0)))},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},onDisable:function(){this._unregisterEvent(),this.content&&(this.content.off(r.SIZE_CHANGED,this._calculateBoundary,this),this.content.off(r.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.off(r.POSITION_CHANGED,this._calculateBoundary,this),this._view.off(r.SCALE_CHANGED,this._calculateBoundary,this),this._view.off(r.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._registerEvent(),this.content&&(this.content.on(r.SIZE_CHANGED,this._calculateBoundary,this),this.content.on(r.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.on(r.POSITION_CHANGED,this._calculateBoundary,this),this._view.on(r.SCALE_CHANGED,this._calculateBoundary,this),this._view.on(r.SIZE_CHANGED,this._calculateBoundary,this))),this._updateScrollBarState()},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)}});cc.ScrollView=e.exports=t},{"../CCNode":72,"./CCViewGroup":141}],135:[function(t,e,i){"use strict";var n=t("../utils/misc"),t=t("./CCComponent"),r=cc.Enum({Horizontal:0,Vertical:1}),t=cc.Class({name:"cc.Slider",extends:t,editor:!1,ctor:function(){this._offset=cc.v2(),this._touchHandle=!1,this._dragging=!1},properties:{handle:{default:null,type:cc.Button,tooltip:!1,notify:function(){}},direction:{default:r.Horizontal,type:r,tooltip:!1},progress:{default:.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateHandlePosition()}},slideEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Direction:r},__preload:function(){this._updateHandlePosition()},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_onHandleDragStart:function(t){this._dragging=!0,this._touchHandle=!0,this._offset=this.handle.node.convertToNodeSpaceAR(t.touch.getLocation()),t.stopPropagation()},_onTouchBegan:function(t){this.handle&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchMoved:function(t){this._dragging&&(this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchEnded:function(t){this._dragging=!1,this._touchHandle=!1,this._offset=cc.v2(),t.stopPropagation()},_onTouchCancelled:function(t){this._dragging=!1,t.stopPropagation()},_handleSliderLogic:function(t){this._updateProgress(t),this._emitSlideEvent()},_emitSlideEvent:function(){cc.Component.EventHandler.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},_updateProgress:function(t){var e;this.handle&&(t=(e=this.node).convertToNodeSpaceAR(t.getLocation()),this.direction===r.Horizontal?this.progress=n.clamp01((t.x-this._offset.x+e.anchorX*e.width)/e.width):this.progress=n.clamp01((t.y-this._offset.y+e.anchorY*e.height)/e.height))},_updateHandlePosition:function(){var t;this.handle&&(t=this.direction===r.Horizontal?cc.v2(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.v2(0,-this.node.height*this.node.anchorY+this.progress*this.node.height),t=this.node.convertToWorldSpaceAR(t),this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(t))}});cc.Slider=e.exports=t},{"../utils/misc":315,"./CCComponent":120}],136:[function(t,e,i){"use strict";var n=t("../utils/misc"),r=(t("../CCNode").EventType,t("./CCRenderComponent")),s=t("../utils/blend-func"),a=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),t=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2}),o=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),l=cc.Enum({NORMAL:0,GRAY:1}),r=cc.Class({name:"cc.Sprite",extends:r,mixins:[s],editor:!1,properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:a.SIMPLE,_sizeMode:o.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){var i=this._spriteFrame;i!==t&&(this._spriteFrame=t,this._applySpriteFrame(i))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.setVertsDirty(),this._resetAssembler())},type:a,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(t){t!==this._fillType&&(this._fillType=t,this.setVertsDirty(),this._resetAssembler())},type:t,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===a.FILLED&&this.setVertsDirty()},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=n.clampf(t,-1,1),this._type===a.FILLED&&this.setVertsDirty()},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=n.clampf(t,-1,1),this._type===a.FILLED&&this.setVertsDirty()},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type!==a.SIMPLE&&this._type!==a.MESH||this.setVertsDirty())},animatable:!1,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(t){(this._sizeMode=t)!==o.CUSTOM&&this._applySpriteSize()},animatable:!1,type:o,tooltip:!1}},statics:{FillType:t,Type:a,SizeMode:o,State:l},setVisible:function(t){this.enabled=t},setState:function(){},getState:function(){},onEnable:function(){this._super(),this._applySpriteFrame(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},_updateMaterial:function(){var t=this._spriteFrame&&this._spriteFrame.getTexture(),e=this.getMaterial(0);e&&e.setProperty("texture",t),s.prototype._updateMaterial.call(this)},_applyAtlas:!1,_validateRender:function(){var t=this._spriteFrame;this._materials[0]&&t&&t.textureLoaded()||this.disableRender()},_applySpriteSize:function(){var t;this._spriteFrame&&this.isValid&&(o.RAW===this._sizeMode?(t=this._spriteFrame._originalSize,this.node.setContentSize(t)):o.TRIMMED===this._sizeMode&&(t=this._spriteFrame._rect,this.node.setContentSize(t.width,t.height)),this.setVertsDirty())},_applySpriteFrame:function(t){var e=t&&t.getTexture(),t=(e&&!e.loaded&&t.off("load",this._applySpriteSize,this),this._spriteFrame);t?(this._updateMaterial(),e===(e=t.getTexture())&&e&&e.loaded?this._applySpriteSize():(this.disableRender(),t.onTextureLoaded(this._applySpriteSize,this))):this.disableRender()}});cc.Sprite=e.exports=r},{"../CCNode":72,"../utils/blend-func":308,"../utils/misc":315,"./CCRenderComponent":131}],137:[function(t,e,i){"use strict";var n=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5}),r=cc.Enum({VERTICAL:0,HORIZONTAL:1}),s=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),a=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),n=cc.Class({name:"cc.StudioComponent",extends:cc.Component,editor:!1,properties:!1,statics:{ComponentType:n,ListDirection:r,VerticalAlign:s,HorizontalAlign:a}}),o=t("../utils/prefab-helper"),r=(n.PlaceHolder=cc.Class({name:"cc.StudioComponent.PlaceHolder",extends:cc.Component,properties:{_baseUrl:"",nestedPrefab:cc.Prefab},onLoad:function(){this.nestedPrefab&&this._replaceWithNestedPrefab()},_replaceWithNestedPrefab:function(){var t=this.node,e=t._prefab;e.root=t,e.asset=this.nestedPrefab,o.syncWithPrefab(t)}}),cc.StudioComponent=e.exports=n,cc.Class({name:"cc.StudioWidget",extends:cc.Widget,editor:!1,_validateTargetInDEV:function(){}}));cc.StudioWidget=e.exports=r},{"../utils/prefab-helper":318}],138:[function(t,e,i){"use strict";var n=t("../utils/gray-sprite-state"),n=cc.Class({name:"cc.Toggle",extends:t("./CCButton"),mixins:[n],editor:!1,properties:{_N$isChecked:!0,isChecked:{get:function(){return this._N$isChecked},set:function(t){var e;t===this._N$isChecked||(e=this.toggleGroup||this._toggleContainer)&&e.enabled&&this._N$isChecked&&!e.allowSwitchOff||(this._N$isChecked=t,this._updateCheckMark(),e&&e.enabled&&e.updateToggles(this),cc.Toggle._triggerEventInScript_isChecked&&this._emitToggleEvents())},tooltip:!1},toggleGroup:{default:null,tooltip:!1,type:t("./CCToggleGroup")},checkMark:{default:null,type:cc.Sprite,tooltip:!1},checkEvents:{default:[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{_triggerEventInScript_check:!1,_triggerEventInScript_isChecked:!1},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.removeToggle(this)},_hideCheckMark:function(){this._N$isChecked=!1,this._updateCheckMark()},toggle:function(t){this.isChecked=!this.isChecked,cc.Toggle._triggerEventInScript_isChecked||!cc.Toggle._triggerEventInScript_check&&!t||this._emitToggleEvents()},check:function(){this.isChecked=!0,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},uncheck:function(){this.isChecked=!1,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked)},_updateDisabledState:function(){var t;this._super(),this.enableAutoGrayEffect&&this.checkMark&&(t=!this.interactable,this._switchGrayMaterial(t,this.checkMark))},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this)}});cc.Toggle=e.exports=n,t("../platform/js").get(n.prototype,"_toggleContainer",function(){var t=this.node.parent;return cc.Node.isNode(t)?t.getComponent(cc.ToggleContainer):null})},{"../platform/js":250,"../utils/gray-sprite-state":311,"./CCButton":118,"./CCToggleGroup":140}],139:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.ToggleContainer",extends:cc.Component,editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},checkEvents:{default:[],type:cc.Component.EventHandler}},updateToggles:function(e){this.enabledInHierarchy&&e.isChecked&&(this.toggleItems.forEach(function(t){t!==e&&t.isChecked&&t.enabled&&t._hideCheckMark()}),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,e))},_allowOnlyOneToggleChecked:function(){var e=!1;return this.toggleItems.forEach(function(t){e?t._hideCheckMark():t.isChecked&&(e=!0)}),e},_makeAtLeastOneToggleChecked:function(){var t;this._allowOnlyOneToggleChecked()||this.allowSwitchOff||0<(t=this.toggleItems).length&&t[0].check()},onEnable:function(){this.node.on("child-added",this._allowOnlyOneToggleChecked,this),this.node.on("child-removed",this._makeAtLeastOneToggleChecked,this)},onDisable:function(){this.node.off("child-added",this._allowOnlyOneToggleChecked,this),this.node.off("child-removed",this._makeAtLeastOneToggleChecked,this)},start:function(){this._makeAtLeastOneToggleChecked()}});t("../platform/js").get(n.prototype,"toggleItems",function(){return this.node.getComponentsInChildren(cc.Toggle)}),cc.ToggleContainer=e.exports=n},{"../platform/js":250}],140:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.ToggleGroup",extends:cc.Component,ctor:function(){this._toggleItems=[]},editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},toggleItems:{get:function(){return this._toggleItems}}},updateToggles:function(e){this.enabledInHierarchy&&this._toggleItems.forEach(function(t){e.isChecked&&t!==e&&t.isChecked&&t.enabled&&t._hideCheckMark()})},addToggle:function(t){-1===this._toggleItems.indexOf(t)&&this._toggleItems.push(t),this._allowOnlyOneToggleChecked()},removeToggle:function(t){t=this._toggleItems.indexOf(t);-1<t&&this._toggleItems.splice(t,1),this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var e=!1;return this._toggleItems.forEach(function(t){e&&t.enabled&&t._hideCheckMark(),t.isChecked&&t.enabled&&(e=!0)}),e},_makeAtLeastOneToggleChecked:function(){this._allowOnlyOneToggleChecked()||this.allowSwitchOff||0<this._toggleItems.length&&(this._toggleItems[0].isChecked=!0)},start:function(){this._makeAtLeastOneToggleChecked()}}),r=!1;t("../platform/js").get(cc,"ToggleGroup",function(){return r||(cc.errorID(1405,"cc.ToggleGroup","cc.ToggleContainer"),r=!0),n}),e.exports=n},{"../platform/js":250}],141:[function(t,e,i){"use strict";t=cc.Class({name:"cc.ViewGroup",extends:t("./CCComponent")});cc.ViewGroup=e.exports=t},{"./CCComponent":120}],142:[function(t,e,i){"use strict";var n=t("../base-ui/CCWidgetManager"),r=n.AlignMode,s=n._AlignFlags,a=s.TOP,o=s.MID,l=s.BOT,h=s.LEFT,c=s.CENTER,u=s.RIGHT,_=a|l,d=h|u,s=cc.Class({name:"cc.Widget",extends:t("./CCComponent"),editor:!1,properties:{target:{get:function(){return this._target},set:function(t){this._target=t},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return 0<(this._alignFlags&a)},set:function(t){this._setAlign(a,t)},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return 0<(this._alignFlags&o)},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=o):this._alignFlags&=~o},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return 0<(this._alignFlags&l)},set:function(t){this._setAlign(l,t)},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return 0<(this._alignFlags&h)},set:function(t){this._setAlign(h,t)},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return 0<(this._alignFlags&c)},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=c):this._alignFlags&=~c},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return 0<(this._alignFlags&u)},set:function(t){this._setAlign(u,t)},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&d)==d},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&_)==_},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t},tooltip:!1},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t},tooltip:!1},left:{get:function(){return this._left},set:function(t){this._left=t},tooltip:!1},right:{get:function(){return this._right},set:function(t){this._right=t},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter=t},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter=t},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t},animatable:!1},alignMode:{default:r.ON_WINDOW_RESIZE,type:r,tooltip:!1},_wasAlignOnce:{default:void 0,formerlySerializedAs:"isAlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},statics:{AlignMode:r},onLoad:function(){void 0!==this._wasAlignOnce&&(this.alignMode=this._wasAlignOnce?r.ONCE:r.ALWAYS,this._wasAlignOnce=void 0)},onEnable:function(){n.add(this)},onDisable:function(){n.remove(this)},_validateTargetInDEV:!1,_setAlign:function(t,e){var i;e!==0<(this._alignFlags&t)&&(i=0<(t&d),e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(i?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t))},updateAlignment:function(){n.updateAlignment(this.node)}});Object.defineProperty(s.prototype,"isAlignOnce",{get:function(){return this.alignMode===r.ONCE},set:function(t){this.alignMode=t?r.ONCE:r.ALWAYS}}),cc.Widget=e.exports=s},{"../base-ui/CCWidgetManager":104,"./CCComponent":120}],143:[function(t,e,i){"use strict";var n=t("../../platform/CCMacro"),r=t("../editbox/EditBoxImplBase"),s=t("../CCLabel"),a=t("./types"),o=a.InputMode,l=a.InputFlag,a=a.KeyboardReturnType;var h=cc.Class({name:"cc.EditBox",extends:cc.Component,editor:!1,properties:{_useOriginalSize:!0,_string:"",string:{tooltip:!1,get:function(){return this._string},set:function(t){t=""+t,0<=this.maxLength&&t.length>=this.maxLength&&(t=t.slice(0,this.maxLength)),this._string=t,this._updateString(t)}},textLabel:{tooltip:!1,default:null,type:s,notify:function(t){this.textLabel&&this.textLabel!==t&&(this._updateTextLabel(),this._updateLabels())}},placeholderLabel:{tooltip:!1,default:null,type:s,notify:function(t){this.placeholderLabel&&this.placeholderLabel!==t&&(this._updatePlaceholderLabel(),this._updateLabels())}},background:{tooltip:!1,default:null,type:cc.Sprite,notify:function(t){this.background&&this.background!==t&&this._updateBackgroundSprite()}},_N$backgroundImage:{default:void 0,type:cc.SpriteFrame},backgroundImage:{get:function(){return this.background?this.background.spriteFrame:null},set:function(t){this.background&&(this.background.spriteFrame=t)}},returnType:{default:a.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:a},_N$returnType:{default:void 0,type:cc.Float},inputFlag:{tooltip:!1,default:l.DEFAULT,type:l,notify:function(){this._updateString(this._string)}},inputMode:{tooltip:!1,default:o.ANY,type:o,notify:function(t){this.inputMode!==t&&(this._updateTextLabel(),this._updatePlaceholderLabel())}},fontSize:{get:function(){return this.textLabel?this.textLabel.fontSize:0},set:function(t){this.textLabel&&(this.textLabel.fontSize=t)}},_N$fontSize:{default:void 0,type:cc.Float},lineHeight:{get:function(){return this.textLabel?this.textLabel.lineHeight:0},set:function(t){this.textLabel&&(this.textLabel.lineHeight=t)}},_N$lineHeight:{default:void 0,type:cc.Float},fontColor:{get:function(){return this.textLabel?this.textLabel.node.color:cc.Color.BLACK},set:function(t){this.textLabel&&(this.textLabel.node.color=t,this.textLabel.node.opacity=t.a)}},_N$fontColor:void 0,placeholder:{tooltip:!1,get:function(){return this.placeholderLabel?this.placeholderLabel.string:""},set:function(t){this.placeholderLabel&&(this.placeholderLabel.string=t)}},_N$placeholder:{default:void 0,type:cc.String},placeholderFontSize:{get:function(){return this.placeholderLabel?this.placeholderLabel.fontSize:0},set:function(t){this.placeholderLabel&&(this.placeholderLabel.fontSize=t)}},_N$placeholderFontSize:{default:void 0,type:cc.Float},placeholderFontColor:{get:function(){return this.placeholderLabel?this.placeholderLabel.node.color:cc.Color.BLACK},set:function(t){this.placeholderLabel&&(this.placeholderLabel.node.color=t,this.placeholderLabel.node.opacity=t.a)}},_N$placeholderFontColor:void 0,maxLength:{tooltip:!1,default:20},_N$maxLength:{default:void 0,type:cc.Float},stayOnTop:{default:!1,notify:function(){cc.warn("editBox.stayOnTop is removed since v2.1.")}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}},editingDidBegan:{default:[],type:cc.Component.EventHandler},textChanged:{default:[],type:cc.Component.EventHandler},editingDidEnded:{default:[],type:cc.Component.EventHandler},editingReturn:{default:[],type:cc.Component.EventHandler}},statics:{_ImplClass:r,KeyboardReturnType:a,InputFlag:l,InputMode:o},_init:function(){this._upgradeComp(),this._isLabelVisible=!0,this.node.on(cc.Node.EventType.SIZE_CHANGED,this._syncSize,this),(this._impl=new h._ImplClass).init(this),this._updateString(this._string),this._syncSize()},_updateBackgroundSprite:function(){var t,e=this.background;e||((e=(t=(t=this.node.getChildByName("BACKGROUND_SPRITE"))||new cc.Node("BACKGROUND_SPRITE")).getComponent(cc.Sprite))||(e=t.addComponent(cc.Sprite)),t.parent=this.node,this.background=e),e.type=cc.Sprite.Type.SLICED,void 0!==this._N$backgroundImage&&(e.spriteFrame=this._N$backgroundImage,this._N$backgroundImage=void 0)},_updateTextLabel:function(){var t,e=this.textLabel;e||((e=(t=(t=this.node.getChildByName("TEXT_LABEL"))||new cc.Node("TEXT_LABEL")).getComponent(s))||(e=t.addComponent(s)),t.parent=this.node,this.textLabel=e),e.node.setAnchorPoint(0,1),e.overflow=s.Overflow.CLAMP,this.inputMode===o.ANY?(e.verticalAlign=n.VerticalTextAlignment.TOP,e.enableWrapText=!0):(e.verticalAlign=n.VerticalTextAlignment.CENTER,e.enableWrapText=!1),e.string=this._updateLabelStringStyle(this._string),void 0!==this._N$fontColor&&(e.node.color=this._N$fontColor,e.node.opacity=this._N$fontColor.a,this._N$fontColor=void 0),void 0!==this._N$fontSize&&(e.fontSize=this._N$fontSize,this._N$fontSize=void 0),void 0!==this._N$lineHeight&&(e.lineHeight=this._N$lineHeight,this._N$lineHeight=void 0)},_updatePlaceholderLabel:function(){var t,e=this.placeholderLabel;e||((e=(t=(t=this.node.getChildByName("PLACEHOLDER_LABEL"))||new cc.Node("PLACEHOLDER_LABEL")).getComponent(s))||(e=t.addComponent(s)),t.parent=this.node,this.placeholderLabel=e),e.node.setAnchorPoint(0,1),e.overflow=s.Overflow.CLAMP,this.inputMode===o.ANY?(e.verticalAlign=n.VerticalTextAlignment.TOP,e.enableWrapText=!0):(e.verticalAlign=n.VerticalTextAlignment.CENTER,e.enableWrapText=!1),e.string=this.placeholder,void 0!==this._N$placeholderFontColor&&(e.node.color=this._N$placeholderFontColor,e.node.opacity=this._N$placeholderFontColor.a,this._N$placeholderFontColor=void 0),void 0!==this._N$placeholderFontSize&&(e.fontSize=this._N$placeholderFontSize,this._N$placeholderFontSize=void 0)},_upgradeComp:function(){void 0!==this._N$returnType&&(this.returnType=this._N$returnType,this._N$returnType=void 0),void 0!==this._N$maxLength&&(this.maxLength=this._N$maxLength,this._N$maxLength=void 0),void 0!==this._N$backgroundImage&&this._updateBackgroundSprite(),void 0===this._N$fontColor&&void 0===this._N$fontSize&&void 0===this._N$lineHeight||this._updateTextLabel(),void 0===this._N$placeholderFontColor&&void 0===this._N$placeholderFontSize||this._updatePlaceholderLabel(),void 0!==this._N$placeholder&&(this.placeholder=this._N$placeholder,this._N$placeholder=void 0)},_syncSize:function(){var t;this._impl&&(t=this.node.getContentSize(),this._impl.setSize(t.width,t.height))},_showLabels:function(){this._isLabelVisible=!0,this._updateLabels()},_hideLabels:function(){this._isLabelVisible=!1,this.textLabel&&(this.textLabel.node.active=!1),this.placeholderLabel&&(this.placeholderLabel.node.active=!1)},_updateLabels:function(){var t;this._isLabelVisible&&(t=this._string,this.textLabel&&(this.textLabel.node.active=""!==t),this.placeholderLabel&&(this.placeholderLabel.node.active=""===t))},_updateString:function(t){var e=this.textLabel;e&&(t=(t=t)&&this._updateLabelStringStyle(t),e.string=t,this._updateLabels())},_updateLabelStringStyle:function(t,e){var i=this.inputFlag;if(e||i!==l.PASSWORD)i===l.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===l.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()}):i===l.INITIAL_CAPS_SENTENCE&&(t=(e=t).charAt(0).toUpperCase()+e.slice(1));else{for(var n="",r=t.length,s=0;s<r;++s)n+="";t=n}return t},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,cc.Component.EventHandler.emitEvents(this.textChanged,t,this),this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this)},onEnable:function(){this._registerEvent(),this._impl&&this._impl.enable()},onDisable:function(){this._unregisterEvent(),this._impl&&this._impl.disable()},onDestroy:function(){this._impl&&this._impl.clear()},__preload:function(){this._init()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(t){t.stopPropagation()},_onTouchCancel:function(t){t.stopPropagation()},_onTouchEnded:function(t){this._impl&&this._impl.beginEditing(),t.stopPropagation()},setFocus:function(){cc.errorID(1400,"setFocus()","focus()"),this._impl&&this._impl.setFocus(!0)},focus:function(){this._impl&&this._impl.setFocus(!0)},blur:function(){this._impl&&this._impl.setFocus(!1)},isFocused:function(){return!!this._impl&&this._impl.isFocused()},update:function(){this._impl&&this._impl.update()}});cc.EditBox=e.exports=h,cc.sys.isBrowser&&t("./WebEditBoxImpl")},{"../../platform/CCMacro":235,"../CCLabel":122,"../editbox/EditBoxImplBase":144,"./WebEditBoxImpl":145,"./types":147}],144:[function(t,e,i){"use strict";var n=cc.Class({ctor:function(){this._delegate=null,this._editing=!1},init:function(t){},enable:function(){},disable:function(){this._editing&&this.endEditing()},clear:function(){},update:function(){},setTabIndex:function(t){},setSize:function(t,e){},setFocus:function(t){t?this.beginEditing():this.endEditing()},isFocused:function(){return this._editing},beginEditing:function(){},endEditing:function(){}});e.exports=n},{}],145:[function(t,e,i){"use strict";var _=(s=t("../../value-types/mat4"))&&s.__esModule?s:{default:s},n=t("../../platform/utils"),r=t("../../platform/CCMacro"),s=t("./types"),o=t("../CCLabel"),a=t("./tabIndexUtil"),t=cc.EditBox,l=cc.js,h=s.InputMode,c=s.InputFlag,u=s.KeyboardReturnType,d={zoomInvalid:!1},f=(cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(d.zoomInvalid=!0),0),p=cc.v3(),m=null,y=!1,g=!1,v=t._ImplClass;function b(){v.call(this),this._domId="EditBoxId_"+ ++f,this._placeholderStyleSheet=null,this._elem=null,this._isTextArea=!1,this._worldMat=new _.default,this._cameraMat=new _.default,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this._cacheViewportRect=cc.rect(0,0,0,0),this._inputMode=null,this._inputFlag=null,this._returnType=null,this._eventListeners={},this._textLabelFont=null,this._textLabelFontSize=null,this._textLabelFontColor=null,this._textLabelAlign=null,this._placeholderLabelFont=null,this._placeholderLabelFontSize=null,this._placeholderLabelFontColor=null,this._placeholderLabelAlign=null,this._placeholderLineHeight=null}l.extend(b,v),t._ImplClass=b,Object.assign(b.prototype,{init:function(t){t&&((this._delegate=t).inputMode===h.ANY?this._createTextArea():this._createInput(),a.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),y=cc.view.isAutoFullScreenEnabled(),g=cc.view._resizeWithBrowserSize)},clear:function(){this._removeEventListeners(),this._removeDomFromGameContainer(),a.remove(this),m===this&&(m=null)},update:function(){},setTabIndex:function(t){this._elem.tabIndex=t,a.resort()},setSize:function(t,e){var i=this._elem;i.style.width=t+"px",i.style.height=e+"px"},beginEditing:function(){m&&m!==this&&m.setFocus(!1),this._editing=!0,(m=this)._delegate.editBoxEditingDidBegan(),this._showDom(),this._elem.focus()},endEditing:function(){this._elem&&this._elem.blur()},_createInput:function(){this._isTextArea=!1,this._elem=document.createElement("input")},_createTextArea:function(){this._isTextArea=!0,this._elem=document.createElement("textarea")},_addDomToGameContainer:function(){cc.game.container.appendChild(this._elem),document.head.appendChild(this._placeholderStyleSheet)},_removeDomFromGameContainer:function(){n.contains(cc.game.container,this._elem)&&cc.game.container.removeChild(this._elem),n.contains(document.head,this._placeholderStyleSheet)&&document.head.removeChild(this._placeholderStyleSheet),delete this._elem,delete this._placeholderStyleSheet},_showDom:function(){this._updateMatrix(),this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._elem.style.display="",this._delegate._hideLabels(),cc.sys.isMobile&&this._showDomOnMobile()},_hideDom:function(){this._elem.style.display="none",this._delegate._showLabels(),cc.sys.isMobile&&this._hideDomOnMobile()},_showDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(y&&(cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()),g&&cc.view.resizeWithBrowserSize(!1),this._adjustWindowScroll())},_hideDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(g&&cc.view.resizeWithBrowserSize(!0),setTimeout(function(){m||y&&cc.view.enableAutoFullScreen(!0)},800)),this._scrollBackWindow()},_adjustWindowScroll:function(){var t=this;setTimeout(function(){window.scrollY<100&&t._elem.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})},800)},_scrollBackWindow:function(){setTimeout(function(){var t=cc.sys;t.browserType!==t.BROWSER_TYPE_WECHAT||t.os!==t.OS_IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)},800)},_updateMatrix:function(){var t,e,i,n,r,s,a,o,l=this._delegate.node,h=(l.getWorldMatrix(this._worldMat),this._worldMat),c=h.m,u=cc.view;this._m00===c[0]&&this._m01===c[1]&&this._m04===c[4]&&this._m05===c[5]&&this._m12===c[12]&&this._m13===c[13]&&this._w===l._contentSize.width&&this._h===l._contentSize.height&&this._cacheViewportRect.equals(u._viewportRect)||(this._m00=c[0],this._m01=c[1],this._m04=c[4],this._m05=c[5],this._m12=c[12],this._m13=c[13],this._w=l._contentSize.width,this._h=l._contentSize.height,this._cacheViewportRect.set(u._viewportRect),c=u._scaleX,t=u._scaleY,a=u._viewportRect,u=u._devicePixelRatio,p.x=-l._anchorPoint.x*this._w,p.y=-l._anchorPoint.y*this._h,_.default.transform(h,h,p),cc.Camera.findCamera(l).getWorldToScreenMatrix2D(this._cameraMat),e=this._cameraMat,_.default.mul(e,e,h),c/=u,t/=u,h=cc.game.container,i=(e=e.m)[0]*c,n=e[1],r=e[4],s=e[5]*t,o=h&&h.style.paddingLeft&&parseInt(h.style.paddingLeft),o+=a.x/u,h=h&&h.style.paddingBottom&&parseInt(h.style.paddingBottom),h+=a.y/u,a=e[12]*c+o,u=e[13]*t+h,d.zoomInvalid&&(this.setSize(l.width*i,l.height*s),s=i=1),(c=this._elem).style.transform=o="matrix("+i+","+-n+","+-r+","+s+","+a+","+-u+")",c.style["-webkit-transform"]=o,c.style["transform-origin"]="0px 100% 0px",c.style["-webkit-transform-origin"]="0px 100% 0px")},_updateInputType:function(){var t,e=this._delegate,i=e.inputMode,n=e.inputFlag,e=e.returnType,r=this._elem;if(this._inputMode!==i||this._inputFlag!==n||this._returnType!==e){if(this._inputMode=i,this._inputFlag=n,this._returnType=e,this._isTextArea)return t="none",n===c.INITIAL_CAPS_ALL_CHARACTERS?t="uppercase":n===c.INITIAL_CAPS_WORD&&(t="capitalize"),void(r.style.textTransform=t);n!==c.PASSWORD?(t=r.type,i===h.EMAIL_ADDR?t="email":i===h.NUMERIC||i===h.DECIMAL?t="number":i===h.PHONE_NUMBER?(t="number",r.pattern="[0-9]*"):i===h.URL?t="url":(t="text",e===u.SEARCH&&(t="search")),r.type=t,i="none",n===c.INITIAL_CAPS_ALL_CHARACTERS?i="uppercase":n===c.INITIAL_CAPS_WORD&&(i="capitalize"),r.style.textTransform=i):r.type="password"}},_updateMaxLength:function(){var t=this._delegate.maxLength;this._elem.maxLength=t=t<0?65535:t},_initStyleSheet:function(){var t=this._elem;t.style.display="none",t.style.border=0,t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.active=0,t.style.outline="medium",t.style.padding="0",t.style.textTransform="uppercase",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflow_y="scroll"):(t.type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")},_updateStyleSheet:function(){var t=this._delegate,e=this._elem;e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel)},_updateTextLabel:function(t){if(t){var e=!(e=t.font)||e instanceof cc.BitmapFont?t.fontFamily:e._fontFamily,i=t.fontSize*t.node.scaleY;if(this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign){this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign;var n=this._elem;switch(n.style.fontSize=i+"px",n.style.color=t.node.color.toCSS(),n.style.fontFamily=e,t.horizontalAlign){case o.HorizontalAlign.LEFT:n.style.textAlign="left";break;case o.HorizontalAlign.CENTER:n.style.textAlign="center";break;case o.HorizontalAlign.RIGHT:n.style.textAlign="right"}}}},_updatePlaceholderLabel:function(t){if(t){var e=!(e=t.font)||e instanceof cc.BitmapFont?t.fontFamily:t.font._fontFamily,i=t.fontSize*t.node.scaleY;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var n,r=this._placeholderStyleSheet,s=t.node.color.toCSS(),a=t.fontSize;switch(t.horizontalAlign){case o.HorizontalAlign.LEFT:n="left";break;case o.HorizontalAlign.CENTER:n="center";break;case o.HorizontalAlign.RIGHT:n="right"}r.innerHTML="#"+this._domId+"::-webkit-input-placeholder,#"+this._domId+"::-moz-placeholder,#"+this._domId+":-ms-input-placeholder{text-transform: initial; font-family: "+e+"; font-size: "+i+"px; color: "+s+"; line-height: "+a+"px; text-align: "+n+";}",cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE&&(r.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},_registerEventListeners:function(){var e=this,i=this._elem,t=!1,n=this._eventListeners;n.compositionStart=function(){t=!0},n.compositionEnd=function(){t=!1,e._delegate.editBoxTextChanged(i.value)},n.onInput=function(){t||e._delegate.editBoxTextChanged(i.value)},n.onClick=function(t){e._editing&&cc.sys.isMobile&&e._adjustWindowScroll()},n.onKeydown=function(t){t.keyCode===r.KEY.enter?(t.stopPropagation(),e._delegate.editBoxEditingReturn(),e._isTextArea||i.blur()):t.keyCode===r.KEY.tab&&(t.stopPropagation(),t.preventDefault(),a.next(e))},n.onBlur=function(){e._editing=!1,m=null,e._hideDom(),e._delegate.editBoxEditingDidEnded()},n.onResize=function(){e._updateMatrix()},i.addEventListener("compositionstart",n.compositionStart),i.addEventListener("compositionend",n.compositionEnd),i.addEventListener("input",n.onInput),i.addEventListener("keydown",n.onKeydown),i.addEventListener("blur",n.onBlur),i.addEventListener("touchstart",n.onClick),window.addEventListener("resize",n.onResize),window.addEventListener("orientationchange",n.onResize)},_removeEventListeners:function(){var t=this._elem,e=this._eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),window.removeEventListener("resize",e.onResize),window.removeEventListener("orientationchange",e.onResize),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null,e.onResize=null}})},{"../../platform/CCMacro":235,"../../platform/utils":254,"../../value-types/mat4":332,"../CCLabel":122,"./tabIndexUtil":146,"./types":147}],146:[function(t,e,i){"use strict";e.exports={_tabIndexList:[],add:function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},remove:function(t){var e=this._tabIndexList,t=e.indexOf(t);-1!==t&&e.splice(t,1)},resort:function(){this._tabIndexList.sort(function(t,e){return t._delegate._tabIndex-e._delegate._tabIndex})},next:function(t){var e=this._tabIndexList,i=e.indexOf(t);t.setFocus(!1),-1!==i&&(t=e[i+1])&&0<=t._delegate._tabIndex&&t.setFocus(!0)}}},{}],147:[function(t,e,i){"use strict";var n=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5}),r=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),s=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});e.exports={KeyboardReturnType:n,InputMode:r,InputFlag:s}},{}],148:[function(t,e,i){"use strict";t("./CCComponent"),t("./CCComponentEventHandler"),t("./missing-script");var n=t("./WXSubContextView"),r=t("./SwanSubContextView"),n=n||cc.Class({name:"cc.WXSubContextView",extends:cc.Component}),r=r||cc.Class({name:"cc.SwanSubContextView",extends:cc.Component}),t=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCPageViewIndicator"),t("./CCPageView"),t("./CCSlider"),t("./CCLayout"),t("./editbox/CCEditBox"),t("./CCLabelOutline"),t("./CCLabelShadow"),t("./CCRichText"),t("./CCToggleContainer"),t("./CCToggleGroup"),t("./CCToggle"),t("./CCBlockInputEvents"),t("./CCMotionStreak"),n,r];e.exports=t},{"./CCAnimation":115,"./CCAudioSource":116,"./CCBlockInputEvents":117,"./CCButton":118,"./CCCanvas":119,"./CCComponent":120,"./CCComponentEventHandler":121,"./CCLabel":122,"./CCLabelOutline":123,"./CCLabelShadow":124,"./CCLayout":125,"./CCMask":126,"./CCMotionStreak":127,"./CCPageView":128,"./CCPageViewIndicator":129,"./CCProgressBar":130,"./CCRichText":132,"./CCScrollBar":133,"./CCScrollView":134,"./CCSlider":135,"./CCSprite":136,"./CCToggle":138,"./CCToggleContainer":139,"./CCToggleGroup":140,"./CCWidget":142,"./SwanSubContextView":void 0,"./WXSubContextView":void 0,"./editbox/CCEditBox":143,"./missing-script":149}],149:[function(t,e,i){"use strict";var n=cc.js,r=t("../utils/misc").BUILTIN_CLASSID_RE,s=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{default:null,visible:!1,editorOnly:!0}}}),a=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t,e){return n._getClassById(t)||(t?(cc.deserialize.reportMissingClass(t),a.getMissingWrapper(t,e)):null)},getMissingWrapper:function(t,e){return e.node&&(/^[0-9a-zA-Z+/]{23}$/.test(t)||r.test(t))?a:s}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=e.exports=a},{"../utils/misc":315}],150:[function(t,e,i){"use strict";function n(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0}function r(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.touch=null,this.currentTouch=null}function s(t,e){cc.Event.call(this,cc.Event.ACCELERATION,e),this.acc=t}function a(t,e,i){cc.Event.call(this,cc.Event.KEYBOARD,i),this.keyCode=t,this.isPressed=e}var o=cc.js,t=(t("../event/event"),o.extend(n,cc.Event),n.prototype);t.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},t.getScrollX=function(){return this._scrollX},t.getScrollY=function(){return this._scrollY},t.setLocation=function(t,e){this._x=t,this._y=e},t.getLocation=function(){return cc.v2(this._x,this._y)},t.getLocationInView=function(){return cc.v2(this._x,cc.view._designResolutionSize.height-this._y)},t._setPrevCursor=function(t,e){this._prevX=t,this._prevY=e},t.getPreviousLocation=function(){return cc.v2(this._prevX,this._prevY)},t.getDelta=function(){return cc.v2(this._x-this._prevX,this._y-this._prevY)},t.getDeltaX=function(){return this._x-this._prevX},t.getDeltaY=function(){return this._y-this._prevY},t.setButton=function(t){this._button=t},t.getButton=function(){return this._button},t.getLocationX=function(){return this._x},t.getLocationY=function(){return this._y},n.NONE=0,n.DOWN=1,n.UP=2,n.MOVE=3,n.SCROLL=4,n.BUTTON_LEFT=0,n.BUTTON_RIGHT=2,n.BUTTON_MIDDLE=1,n.BUTTON_4=3,n.BUTTON_5=4,n.BUTTON_6=5,n.BUTTON_7=6,n.BUTTON_8=7,o.extend(r,cc.Event),(t=r.prototype).getEventCode=function(){return this._eventCode},t.getTouches=function(){return this._touches},t._setEventCode=function(t){this._eventCode=t},t._setTouches=function(t){this._touches=t},t.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},t.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},t.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},t.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},t.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},t.getID=function(){return this.touch?this.touch.getID():null},t.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},t.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},t.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},t.getLocationX=function(){return this.touch?this.touch.getLocationX():0},t.getLocationY=function(){return this.touch?this.touch.getLocationY():0},r.MAX_TOUCHES=5,r.BEGAN=0,r.MOVED=1,r.ENDED=2,r.CANCELED=3,o.extend(s,cc.Event);o.extend(a,cc.Event),cc.Event.EventMouse=n,cc.Event.EventTouch=r,cc.Event.EventAcceleration=s,cc.Event.EventKeyboard=a,e.exports=cc.Event},{"../event/event":157}],151:[function(t,e,i){"use strict";function r(t,e){this._onCustomEvent=e,cc.EventListener.call(this,cc.EventListener.CUSTOM,t,this._callback)}function s(){cc.EventListener.call(this,cc.EventListener.MOUSE,n.MOUSE,this._callback)}function a(){cc.EventListener.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,n.TOUCH_ONE_BY_ONE,null),this._claimedTouches=[]}function o(){cc.EventListener.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,n.TOUCH_ALL_AT_ONCE,null)}function l(t){this._onAccelerationEvent=t,cc.EventListener.call(this,cc.EventListener.ACCELERATION,n.ACCELERATION,this._callback)}function h(){cc.EventListener.call(this,cc.EventListener.KEYBOARD,n.KEYBOARD,this._callback)}var t=t("../platform/js"),n=(cc.EventListener=function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},cc.EventListener.prototype={constructor:cc.EventListener,_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}},cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8,cc.EventListener.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"});t.extend(r,cc.EventListener),t.mixin(r.prototype,{_onCustomEvent:null,_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent(t)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new r(this._listenerID,this._onCustomEvent)}}),t.extend(s,cc.EventListener),t.mixin(s.prototype,{onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,_callback:function(t){var e=cc.Event.EventMouse;switch(t._eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},clone:function(){var t=new s;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),t.extend(a,cc.EventListener),t.mixin(a.prototype,{constructor:a,_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new a;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}}),t.extend(o,cc.EventListener),t.mixin(o.prototype,{constructor:o,onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,clone:function(){var t=new o;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1)}}),t.extend(l,cc.EventListener),t.mixin(l.prototype,{constructor:l,_onAccelerationEvent:null,_callback:function(t){this._onAccelerationEvent(t.acc,t)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new l(this._onAccelerationEvent)}});t.extend(h,cc.EventListener),t.mixin(h.prototype,{constructor:h,onKeyPressed:null,onKeyReleased:null,_callback:function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},clone:function(){var t=new h;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1)}}),cc.EventListener.create=function(t){cc.assertID(t&&t.event,1900);var e,i=t.event,n=(delete t.event,null);for(e in i===cc.EventListener.TOUCH_ONE_BY_ONE?n=new a:i===cc.EventListener.TOUCH_ALL_AT_ONCE?n=new o:i===cc.EventListener.MOUSE?n=new s:i===cc.EventListener.CUSTOM?(n=new r(t.eventName,t.callback),delete t.eventName,delete t.callback):i===cc.EventListener.KEYBOARD?n=new h:i===cc.EventListener.ACCELERATION&&(n=new l(t.callback),delete t.callback),t)n[e]=t[e];return n},e.exports=cc.EventListener},{"../platform/js":250}],152:[function(t,e,i){"use strict";function n(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0}var r=t("../platform/js"),c=(t("./CCEventListener"),cc.EventListener.ListenerID),l={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyListeners:{},_inDispatch:0,_isEnabled:!(n.prototype={constructor:n,size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){(0===t._getFixedPriority()?this._sceneGraphListeners:this._fixedListeners).push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),_currentTouch:null,_currentTouchListener:null,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){var e=this._nodeListenersMap[t._id];if(void 0!==e)for(var i=0,n=e.length;i<n;i++){var r=e[i]._getListenerID();null==this._dirtyListeners[r]&&(this._dirtyListeners[r]=!0)}if(0<t.childrenCount)for(var s=t._children,a=0,o=s.length;a<o;a++)this._setDirtyForNode(s[a])},pauseTarget:function(t,e){if(t instanceof cc._BaseNode){var i=this._nodeListenersMap[t._id];if(i)for(r=0,s=i.length;r<s;r++)i[r]._setPaused(!0);if(!0===e)for(var n=t._children,r=0,s=n?n.length:0;r<s;r++)this.pauseTarget(n[r],!0)}else cc.warnID(3506)},resumeTarget:function(t,e){if(t instanceof cc._BaseNode){var i=this._nodeListenersMap[t._id];if(i)for(r=0,s=i.length;r<s;r++)i[r]._setPaused(!1);if(this._setDirtyForNode(t),!0===e)for(var n=t._children,r=0,s=n?n.length:0;r<s;r++)this.resumeTarget(n[r],!0)}else cc.warnID(3506)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];i||(i=new n,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()?(this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY),null===(i=t._getSceneGraphPriority())&&cc.logID(3507),this._associateNodeAndEventListener(i,t),i.activeInHierarchy&&this.resumeTarget(i)):this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){for(var t in this._dirtyListeners)this._setDirty(t,this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyListeners={}},_removeAllListenersInVector:function(t){if(t)for(var e,i=t.length-1;0<=i;i--)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.removeAt(t,i)},_removeListenersForListenerID:function(t){var e,i,n=this._listenersMap[t];n&&(e=n.getFixedPriorityListeners(),i=n.getSceneGraphPriorityListeners(),this._removeAllListenersInVector(i),this._removeAllListenersInVector(e),delete this._priorityDirtyFlagMap[t],this._inDispatch||(n.clear(),delete this._listenersMap[t]));for(var r,s=this._toAddedListeners,a=s.length-1;0<=a;a--)(r=s[a])&&r._getListenerID()===t&&cc.js.array.removeAt(s,a)},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;(e=i[t]?i[t]:e)!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY&&cc.director.getScene()&&this._sortListenersOfSceneGraphPriority(t))},_sortListenersOfSceneGraphPriority:function(t){var e,t=this._getListeners(t);t&&(e=t.getSceneGraphPriorityListeners())&&0!==e.length&&t.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes)},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=t._getSceneGraphPriority(),n=e._getSceneGraphPriority();if(!(e&&n&&n._activeInHierarchy&&null!==n._parent))return-1;if(!t||!i||!i._activeInHierarchy||null===i._parent)return 1;for(var r=i,s=n,a=!1;r._parent._id!==s._parent._id;)r=null===r._parent._parent?(a=!0,n):r._parent,s=null===s._parent._parent?(a=!0,i):s._parent;if(r._id===s._id){if(r._id===n._id)return-1;if(r._id===i._id)return 1}return a?r._localZOrder-s._localZOrder:s._localZOrder-r._localZOrder},_sortListenersOfFixedPriority:function(t){t=this._listenersMap[t];if(t){var e=t.getFixedPriorityListeners();if(e&&0!==e.length){e.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,n=e.length;i<n&&!(0<=e[i]._getFixedPriority());)++i;t.gt0Index=i}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e,i,n,r=t.getFixedPriorityListeners(),s=t.getSceneGraphPriorityListeners(),a=this._toRemovedListeners;if(s)for(e=s.length-1;0<=e;e--)(i=s[e])._isRegistered()||(cc.js.array.removeAt(s,e),-1!==(n=a.indexOf(i))&&a.splice(n,1));if(r)for(e=r.length-1;0<=e;e--)(i=r[e])._isRegistered()||(cc.js.array.removeAt(r,e),-1!==(n=a.indexOf(i))&&a.splice(n,1));s&&0===s.length&&t.clearSceneGraphListeners(),r&&0===r.length&&t.clearFixedListeners()},frameUpdateListeners:function(){var t,e=this._listenersMap,i=this._priorityDirtyFlagMap;for(t in e)e[t].empty()&&(delete i[t],delete e[t]);var n=this._toAddedListeners;if(0!==n.length){for(var r=0,s=n.length;r<s;r++)this._forceAddEventListener(n[r]);n.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(t){var e=this._inDispatch;if(cc.assertID(0<e,3508),!(1<e)){(i=this._listenersMap[c.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(i),(i=this._listenersMap[c.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(i),cc.assertID(1===e,3509);var i,n=this._toAddedListeners;if(0!==n.length){for(var r=0,s=n.length;r<s;r++)this._forceAddEventListener(n[r]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i,n,r=t[e],s=this._listenersMap[r._getListenerID()];s&&(n=s.getFixedPriorityListeners(),(s=s.getSceneGraphPriorityListeners())&&-1!==(i=s.indexOf(r))&&s.splice(i,1),n&&-1!==(i=n.indexOf(r))&&n.splice(i,1))}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered())return!1;var i=e.event,n=i.currentTouch;i.currentTarget=t._node;var r=!1,s=i.getEventCode(),a=cc.Event.EventTouch;if(s===a.BEGAN){if(!cc.macro.ENABLE_MULTI_TOUCH&&l._currentTouch){var o=l._currentTouchListener._node;if(o&&o.activeInHierarchy)return!1}t.onTouchBegan&&(r=t.onTouchBegan(n,i))&&t._registered&&(t._claimedTouches.push(n),l._currentTouchListener=t,l._currentTouch=n)}else if(0<t._claimedTouches.length&&-1!==(o=t._claimedTouches.indexOf(n))){if(r=!0,!cc.macro.ENABLE_MULTI_TOUCH&&l._currentTouch&&l._currentTouch!==n)return!1;s===a.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):s===a.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._registered&&t._claimedTouches.splice(o,1),l._clearCurTouch()):s===a.CANCELED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._registered&&t._claimedTouches.splice(o,1),l._clearCurTouch())}return i.isStopped()?(l._updateTouchListeners(i),!0):!(!r||!t.swallowTouches||(e.needsMutableSet&&e.touches.splice(n,1),0))},_dispatchTouchEvent:function(t){this._sortEventListeners(c.TOUCH_ONE_BY_ONE),this._sortEventListeners(c.TOUCH_ALL_AT_ONCE);var e=this._getListeners(c.TOUCH_ONE_BY_ONE),i=this._getListeners(c.TOUCH_ALL_AT_ONCE);if(null!==e||null!==i){var n=t.getTouches(),r=cc.js.array.copy(n),s={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var a=0;a<n.length;a++)t.currentTouch=n[a],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,s);i&&0<r.length&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())||this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,n=e.event,e=e.touches,r=n.getEventCode();return n.currentTarget=t._node,r===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(e,n):r===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(e,n):r===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(e,n):r===i.CANCELED&&t.onTouchesCancelled&&t.onTouchesCancelled(e,n),!!n.isStopped()&&(l._updateTouchListeners(n),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t._id];i||(this._nodeListenersMap[t._id]=i=[]),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t._id];i&&(cc.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t._id])},_dispatchEventToListeners:function(t,e,i){var n,r,s=!1,a=t.getFixedPriorityListeners(),o=t.getSceneGraphPriorityListeners(),l=0;if(a&&0!==a.length)for(;l<t.gt0Index;++l)if((r=a[l]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(o&&!s)for(n=0;n<o.length;n++)if((r=o[n]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(a&&!s)for(;l<a.length;++l)if((r=a[l]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_sortNumberAsc:function(t,e){return t-e},hasEventListener:function(t){return!!this._getListeners(t)},addListener:function(t,e){if(cc.assertID(t&&e,3503),cc.js.isNumber(e)||e instanceof cc._BaseNode){if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(e),3504),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.logID(3500);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}}else cc.warnID(3506)},addCustomListener:function(t,e){t=new cc.EventListener.create({event:cc.EventListener.CUSTOM,eventName:t,callback:e});return this.addListener(t,1),t},removeListener:function(t){if(null!=t){var e,i,n=this._listenersMap;for(i in n){var r=n[i],s=r.getFixedPriorityListeners(),a=r.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(a,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(s,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete n[i]),e)break}if(!e)for(var o=this._toAddedListeners,l=o.length-1;0<=l;l--){var h=o[l];if(h===t){cc.js.array.removeAt(o,l),h._setRegistered(!1);break}}this._currentTouchListener===t&&this._clearCurTouch()}},_clearCurTouch:function(){this._currentTouchListener=null,this._currentTouch=null},_removeListenerInCallback:function(t,e){if(null!=t)for(var i=t.length-1;0<=i;i--){var n=t[i];if(n._onCustomEvent===e||n._onEvent===e)return n._setRegistered(!1),null!=n._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(n._getSceneGraphPriority(),n),n._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,i):this._toRemovedListeners.push(n),!0}return!1},_removeListenerInVector:function(t,e){if(null!=t)for(var i=t.length-1;0<=i;i--){var n=t[i];if(n===e)return n._setRegistered(!1),null!=n._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(n._getSceneGraphPriority(),n),n._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,i):this._toRemovedListeners.push(n),!0}return!1},removeListeners:function(t,e){var i=this;if(cc.js.isNumber(t)||t instanceof cc._BaseNode)if(void 0!==t._id){var n=i._nodeListenersMap[t._id];if(n){for(var r=cc.js.array.copy(n),s=0;s<r.length;s++)i.removeListener(r[s]);delete i._nodeListenersMap[t._id]}var a=i._toAddedListeners;for(s=0;s<a.length;){var o=a[s];o._getSceneGraphPriority()===t?(o._setSceneGraphPriority(null),o._setRegistered(!1),a.splice(s,1)):++s}if(!0===e){var l,h=t.children;for(s=0,l=h.length;s<l;s++)i.removeListeners(h[s],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?i._removeListenersForListenerID(c.TOUCH_ONE_BY_ONE):t===cc.EventListener.TOUCH_ALL_AT_ONCE?i._removeListenersForListenerID(c.TOUCH_ALL_AT_ONCE):t===cc.EventListener.MOUSE?i._removeListenersForListenerID(c.MOUSE):t===cc.EventListener.ACCELERATION?i._removeListenersForListenerID(c.ACCELERATION):t===cc.EventListener.KEYBOARD?i._removeListenersForListenerID(c.KEYBOARD):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t,e=this._listenersMap,i=this._internalCustomListenerIDs;for(t in e)-1===i.indexOf(t)&&this._removeListenersForListenerID(t)},setPriority:function(t,e){if(null!=t){var i,n=this._listenersMap;for(i in n){var r=n[i].getFixedPriorityListeners();if(r&&-1!==r.indexOf(t))return null!=t._getSceneGraphPriority()&&cc.logID(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,t&&t.getType){if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;e=t,i=cc.Event;e=(e=e.type)===i.ACCELERATION?c.ACCELERATION:e===i.KEYBOARD?c.KEYBOARD:e.startsWith(i.MOUSE)?c.MOUSE:(e.startsWith(i.TOUCH)&&cc.logID(2e3),""),i=(this._sortEventListeners(e),this._listenersMap[e]);null!=i&&(this._dispatchEventToListeners(i,this._onListenerCallback,t),this._onUpdateListeners(i)),this._inDispatch--}else cc.errorID(3511);var e,i},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){t=new cc.Event.EventCustom(t);t.setUserData(e),this.dispatchEvent(t)}};r.get(cc,"eventManager",function(){return cc.errorID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),l}),e.exports=cc.internal.eventManager=l},{"../platform/js":250,"./CCEventListener":151}],153:[function(t,e,i){"use strict";cc.Touch=function(t,e,i){this._lastModified=0,this.setTouchInfo(i,t,e)},cc.Touch.prototype={constructor:cc.Touch,getLocation:function(){return cc.v2(this._point.x,this._point.y)},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return cc.v2(this._prevPoint.x,this._prevPoint.y)},getStartLocation:function(){return cc.v2(this._startPoint.x,this._startPoint.y)},getDelta:function(){return this._point.sub(this._prevPoint)},getLocationInView:function(){return cc.v2(this._point.x,cc.view._designResolutionSize.height-this._point.y)},getPreviousLocationInView:function(){return cc.v2(this._prevPoint.x,cc.view._designResolutionSize.height-this._prevPoint.y)},getStartLocationInView:function(){return cc.v2(this._startPoint.x,cc.view._designResolutionSize.height-this._startPoint.y)},getID:function(){return this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.v2(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.v2(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.v2(t.x,t.y):cc.v2(t||0,e||0)}}},{}],154:[function(t,e,i){"use strict";t("./CCEvent"),t("./CCTouch"),t("./CCEventListener");t=t("./CCEventManager");e.exports=t},{"./CCEvent":150,"./CCEventListener":151,"./CCEventManager":152,"./CCTouch":153}],155:[function(t,e,i){"use strict";var n=cc.js,r=t("../platform/callbacks-invoker");function s(){r.call(this)}n.extend(s,r),s.prototype.emit=function(t,e){var i=t.type,i=this._callbackTable[i];if(i){var n=!i.isInvoking;i.isInvoking=!0;for(var r=i.callbackInfos,s=0,a=r.length;s<a;++s){var o=r[s];if(o&&o.callback&&(o.callback.call(o.target,t,e),t._propagationImmediateStopped))break}n&&(i.isInvoking=!1,i.containCanceled&&i.purgeCanceled())}},e.exports=s},{"../platform/callbacks-invoker":243}],156:[function(t,e,i){"use strict";var n=t("../platform/js"),r=t("../platform/callbacks-invoker"),a=n.array.fastRemove;function s(){r.call(this)}n.extend(s,r);t=s.prototype;t.__on=t.on,t.on=function(t,e,i,n){if(e)return this.hasEventListener(t,e,i)||(this.__on(t,e,i,n),i&&i.__eventTargets&&i.__eventTargets.push(this)),e;cc.errorID(6800)},t.__off=t.off,t.off=function(t,e,i){if(e)this.__off(t,e,i),i&&i.__eventTargets&&a(i.__eventTargets,this);else{e=this._callbackTable[t];if(e){for(var n=e.callbackInfos,r=0;r<n.length;++r){var s=n[r]&&n[r].target;s&&s.__eventTargets&&a(s.__eventTargets,this)}this.removeAll(t)}}},t.targetOff=function(t){this.removeAll(t),t&&t.__eventTargets&&a(t.__eventTargets,this)},t.once=function(t,e,i){this.on(t,e,i,!0)},t.dispatchEvent=function(t){this.emit(t.type,t)},cc.EventTarget=e.exports=s},{"../platform/callbacks-invoker":243,"../platform/js":250}],157:[function(t,e,i){"use strict";function n(t,e){cc.Event.call(this,t,e),this.detail=null}var t=t("../platform/js"),r=(cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3,t.extend(n,cc.Event),(n.prototype.reset=n).prototype.setUserData=function(t){this.detail=t},n.prototype.getUserData=function(){return this.detail},n.prototype.getEventName=cc.Event.prototype.getType,new t.Pool(10));n.put=function(t){r.put(t)},n.get=function(t,e){var i=r._get();return i?i.reset(t,e):i=new n(t,e),i},cc.Event.EventCustom=n,e.exports=cc.Event},{"../platform/js":250}],158:[function(t,e,i){"use strict";t("./event"),t("./event-listeners"),t("./event-target"),t("./system-event")},{"./event":157,"./event-listeners":155,"./event-target":156,"./system-event":159}],159:[function(t,e,i){"use strict";var n=t("../event/event-target"),r=t("../event-manager"),s=t("../platform/CCInputManager"),a=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),o=null,l=null,t=cc.Class({name:"SystemEvent",extends:n,statics:{EventType:a},setAccelerometerEnabled:function(t){t&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(function(t){console.log("Device Motion Event request permission: "+t),s.setAccelerometerEnabled("granted"===t)}):s.setAccelerometerEnabled(t)},setAccelerometerInterval:function(t){s.setAccelerometerInterval(t)},on:function(t,e,i,n){this._super(t,e,i,n),t!==a.KEY_DOWN&&t!==a.KEY_UP||(o=o||cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,e){e.type=a.KEY_DOWN,cc.systemEvent.dispatchEvent(e)},onKeyReleased:function(t,e){e.type=a.KEY_UP,cc.systemEvent.dispatchEvent(e)}}),r.hasEventListener(cc.EventListener.ListenerID.KEYBOARD)||r.addListener(o,1)),t===a.DEVICEMOTION&&(l=l||cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,e){e.type=a.DEVICEMOTION,cc.systemEvent.dispatchEvent(e)}}),r.hasEventListener(cc.EventListener.ListenerID.ACCELERATION)||r.addListener(l,1))},off:function(t,e,i){this._super(t,e,i),!o||t!==a.KEY_DOWN&&t!==a.KEY_UP||(e=this.hasEventListener(a.KEY_DOWN),i=this.hasEventListener(a.KEY_UP),e||i||r.removeListener(o)),l&&t===a.DEVICEMOTION&&r.removeListener(l)}});cc.SystemEvent=e.exports=t,cc.systemEvent=new cc.SystemEvent},{"../event-manager":154,"../event/event-target":156,"../platform/CCInputManager":234}],160:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var o=r(t("../value-types/vec3")),n=r(t("../value-types/mat3")),a=r(t("./enums"));function r(t){return t&&t.__esModule?t:{default:t}}var s=new o.default,l=new o.default,h=new n.default;function c(t,e,i,n,r,s){this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=a.default.SHAPE_AABB,this.center=new o.default(t,e,i),this.halfExtents=new o.default(n,r,s)}c.create=function(t,e,i,n,r,s){return new c(t,e,i,n,r,s)},c.clone=function(t){return new c(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},c.copy=function(t,e){return o.default.copy(t.center,e.center),o.default.copy(t.halfExtents,e.halfExtents),t},c.fromPoints=function(t,e,i){return o.default.scale(t.center,o.default.add(s,e,i),.5),o.default.scale(t.halfExtents,o.default.sub(l,i,e),.5),t},c.set=function(t,e,i,n,r,s,a){return o.default.set(t.center,e,i,n),o.default.set(t.halfExtents,r,s,a),t},(t=c.prototype).getBoundary=function(t,e){o.default.sub(t,this.center,this.halfExtents),o.default.add(e,this.center,this.halfExtents)},t.transform=function(t,e,i,n,r){var s,a;o.default.transformMat4((r=r||this).center,this.center,t),r=r.halfExtents,s=this.halfExtents,t=t,a=h.m,t=t.m,a[0]=Math.abs(t[0]),a[1]=Math.abs(t[1]),a[2]=Math.abs(t[2]),a[3]=Math.abs(t[4]),a[4]=Math.abs(t[5]),a[5]=Math.abs(t[6]),a[6]=Math.abs(t[8]),a[7]=Math.abs(t[9]),a[8]=Math.abs(t[10]),o.default.transformMat3(r,s,h)},i.default=c,e.exports=i.default},{"../value-types/mat3":331,"../value-types/vec3":340,"./enums":162}],161:[function(t,e,i){"use strict";i.__esModule=!0,i.point_plane=s,i.pt_point_plane=function(t,e,i){var n=s(e,i);return a.Vec3.subtract(t,e,a.Vec3.multiplyScalar(t,i.n,n))},i.pt_point_aabb=function(t,e,i){return a.Vec3.copy(t,e),a.Vec3.subtract(n,i.center,i.halfExtents),a.Vec3.add(r,i.center,i.halfExtents),t.x=(t.x<n.x?n:t).x,t.y=(t.y<n.x?n:t).y,t.z=(t.z<n.x?n:t).z,t.x=(t.x>r.x?r:t).x,t.y=(t.y>r.x?r:t).y,t.z=(t.z>r.x?r:t).z,t},i.pt_point_obb=function(t,e,i){var n=i.orientation.m;a.Vec3.set(o,n[0],n[1],n[2]),a.Vec3.set(l,n[3],n[4],n[5]),a.Vec3.set(h,n[6],n[7],n[8]),u[0]=o,u[1]=l,u[2]=h,_[0]=i.halfExtents.x,_[1]=i.halfExtents.y,_[2]=i.halfExtents.z,a.Vec3.subtract(c,e,i.center),a.Vec3.set(t,i.center.x,i.center.y,i.center.z);for(var r=0;r<3;r++){var s=a.Vec3.dot(c,u[r]);(s=s>_[r]?_[r]:s)<-_[r]&&(s=-_[r]),t.x+=s*u[r].x,t.y+=s*u[r].y,t.z+=s*u[r].z}return t};var a=t("../value-types"),o=new a.Vec3,l=new a.Vec3,h=new a.Vec3,c=new a.Vec3,n=new a.Vec3,r=new a.Vec3,u=new Array(3),_=new Array(3);function s(t,e){return a.Vec3.dot(e.n,t)-e.d}},{"../value-types":330}],162:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0,i.default={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256},e.exports=i.default},{}],163:[function(t,e,i){"use strict";i.__esModule=!0,i.frustum=void 0;var a=t("../value-types"),o=n(t("./enums")),l=n(t("./plane"));function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s,h,c,u=new Array(8),t=(u[0]=new a.Vec3(1,1,1),u[1]=new a.Vec3(-1,1,1),u[2]=new a.Vec3(-1,-1,1),u[3]=new a.Vec3(1,-1,1),u[4]=new a.Vec3(1,1,-1),u[5]=new a.Vec3(-1,1,-1),u[6]=new a.Vec3(-1,-1,-1),u[7]=new a.Vec3(1,-1,-1),_.create=function(){return new _},_.clone=function(t){return _.copy(new _,t)},_.copy=function(t,e){t._type=e._type;for(var i=0;i<6;++i)l.default.copy(t.planes[i],e.planes[i]);for(var n=0;n<8;++n)a.Vec3.copy(t.vertices[n],e.vertices[n]);return t},t=_,(h=[{key:"accurate",set:function(t){this._type=t?o.default.SHAPE_FRUSTUM_ACCURATE:o.default.SHAPE_FRUSTUM}}])&&r(t.prototype,h),s&&r(t,s),(h=_.prototype).update=function(t,e){t=t.m;if(a.Vec3.set(this.planes[0].n,t[3]+t[0],t[7]+t[4],t[11]+t[8]),this.planes[0].d=-(t[15]+t[12]),a.Vec3.set(this.planes[1].n,t[3]-t[0],t[7]-t[4],t[11]-t[8]),this.planes[1].d=-(t[15]-t[12]),a.Vec3.set(this.planes[2].n,t[3]+t[1],t[7]+t[5],t[11]+t[9]),this.planes[2].d=-(t[15]+t[13]),a.Vec3.set(this.planes[3].n,t[3]-t[1],t[7]-t[5],t[11]-t[9]),this.planes[3].d=-(t[15]-t[13]),a.Vec3.set(this.planes[4].n,t[3]+t[2],t[7]+t[6],t[11]+t[10]),this.planes[4].d=-(t[15]+t[14]),a.Vec3.set(this.planes[5].n,t[3]-t[2],t[7]-t[6],t[11]-t[10]),this.planes[5].d=-(t[15]-t[14]),this._type===o.default.SHAPE_FRUSTUM_ACCURATE){for(var i=0;i<6;i++){var n=this.planes[i],r=1/n.n.length();a.Vec3.multiplyScalar(n.n,n.n,r),n.d*=r}for(var s=0;s<8;s++)a.Vec3.transformMat4(this.vertices[s],u[s],e)}},h.transform=function(t){if(this._type===o.default.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)a.Vec3.transformMat4(this.vertices[e],this.vertices[e],t);l.default.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),l.default.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),l.default.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),l.default.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),l.default.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),l.default.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},_);function _(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=o.default.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=l.default.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new a.Vec3}(i.frustum=t).createOrtho=(c=new a.Vec3,function(t,e,i,n,r,s){e/=2,i/=2;a.Vec3.set(c,e,i,n),a.Vec3.transformMat4(t.vertices[0],c,s),a.Vec3.set(c,-e,i,n),a.Vec3.transformMat4(t.vertices[1],c,s),a.Vec3.set(c,-e,-i,n),a.Vec3.transformMat4(t.vertices[2],c,s),a.Vec3.set(c,e,-i,n),a.Vec3.transformMat4(t.vertices[3],c,s),a.Vec3.set(c,e,i,r),a.Vec3.transformMat4(t.vertices[4],c,s),a.Vec3.set(c,-e,i,r),a.Vec3.transformMat4(t.vertices[5],c,s),a.Vec3.set(c,-e,-i,r),a.Vec3.transformMat4(t.vertices[6],c,s),a.Vec3.set(c,e,-i,r),a.Vec3.transformMat4(t.vertices[7],c,s),l.default.fromPoints(t.planes[0],t.vertices[1],t.vertices[6],t.vertices[5]),l.default.fromPoints(t.planes[1],t.vertices[3],t.vertices[4],t.vertices[7]),l.default.fromPoints(t.planes[2],t.vertices[6],t.vertices[3],t.vertices[7]),l.default.fromPoints(t.planes[3],t.vertices[0],t.vertices[5],t.vertices[4]),l.default.fromPoints(t.planes[4],t.vertices[2],t.vertices[0],t.vertices[3]),l.default.fromPoints(t.planes[0],t.vertices[7],t.vertices[5],t.vertices[6])})},{"../value-types":330,"./enums":162,"./plane":168}],164:[function(t,e,i){"use strict";var n={enums:i.__esModule=!0,Triangle:!0,Aabb:!0,Ray:!0,intersect:!0,Sphere:!0,Obb:!0,Frustum:!0,Line:!0,Plane:!0},r=(i.Plane=i.Line=i.Frustum=i.Obb=i.Sphere=i.intersect=i.Ray=i.Aabb=i.Triangle=i.enums=void 0,a(t("./enums"))),r=(i.enums=r.default,a(t("./triangle"))),r=(i.Triangle=r.default,a(t("./aabb"))),r=(i.Aabb=r.default,a(t("./ray"))),r=(i.Ray=r.default,a(t("./intersect"))),r=(i.intersect=r.default,a(t("./sphere"))),r=(i.Sphere=r.default,a(t("./obb"))),r=(i.Obb=r.default,a(t("./frustum"))),r=(i.Frustum=r.default,a(t("./line"))),r=(i.Line=r.default,a(t("./plane"))),s=(i.Plane=r.default,t("./distance"));function a(t){return t&&t.__esModule?t:{default:t}}Object.keys(s).forEach(function(t){"default"===t||"__esModule"===t||Object.prototype.hasOwnProperty.call(n,t)||(i[t]=s[t])}),cc.geomUtils=e.exports},{"./aabb":160,"./distance":161,"./enums":162,"./frustum":163,"./intersect":165,"./line":166,"./obb":167,"./plane":168,"./ray":169,"./sphere":170,"./triangle":171}],165:[function(t,F,e){"use strict";e.__esModule=!0,e.default=void 0;var V=r(t("../../renderer/gfx")),i=r(t("../../renderer/memop/recycle-pool")),p=t("../value-types"),N=r(t("./aabb")),k=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=G();if(e&&e.has(t))return e.get(t);var i,n,r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&((n=s?Object.getOwnPropertyDescriptor(t,i):null)&&(n.get||n.set)?Object.defineProperty(r,i,n):r[i]=t[i]);return r.default=t,e&&e.set(t,r),r}(t("./distance")),n=r(t("./enums")),z=r(t("./ray")),t=r(t("./triangle"));function G(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return G=function(){return t},t}function r(t){return t&&t.__esModule?t:{default:t}}function U(t,e){R=1/0;for(var i=e._subMeshes,n=0;n<i.length;n++)if(i[n]._primitiveType===V.default.PT_TRIANGLES)for(var r=e._subDatas[n]||e._subDatas[0],s=e._getAttrMeshData(n,V.default.ATTR_POSITION),a=r.getIData(Uint16Array),o=r.vfm.element(V.default.ATTR_POSITION).num,l=0;l<a.length;l+=3){At(P.a,s,a[l],o),At(P.b,s,a[l+1],o),At(P.c,s,a[l+2],o);var h=gt(t,P);0<h&&h<R&&(R=h)}return R}function j(t,n,r,s){return _t.reset(),D.length=0,function t(e,i){for(var n=e.children,r=n.length-1;0<=r;r--)t(n[r],i);i(e)}(t=t||cc.director.getScene(),function(t){var e,i;s&&!s(t)||(p.Mat4.invert(yt,t.getWorldMatrix(mt)),p.Vec3.transformMat4(B.o,n.o,yt),p.Vec3.normalize(B.d,bt(B.d,n.d,yt)),e=1/0,(i=t._renderComponent)instanceof cc.MeshRenderer?e=O(B,i._boundingBox):t.width&&t.height&&(p.Vec3.set(ft,-t.width*t.anchorX,-t.height*t.anchorY,t.z),p.Vec3.set(pt,t.width*(1-t.anchorX),t.height*(1-t.anchorY),t.z),N.default.fromPoints(dt,ft,pt),e=O(B,dt)),xt(e)&&xt(e=r?r(B,t,e):e)&&(p.Vec3.scale(I,B.d,e),bt(I,I,mt),(i=_t.add()).node=t,i.distance=p.Vec3.mag(I),D.push(i)))}),D.sort(vt),D}function W(t,e){var i=p.Vec3.dot(t.d,e.n);return Math.abs(i)<Number.EPSILON?0:(p.Vec3.multiplyScalar(ut,e.n,e.d),(t=p.Vec3.dot(p.Vec3.subtract(ut,ut,t.o),e.n)/i)<0?0:t)}function H(t,e){return p.Vec3.subtract(ct,t.e,t.s),(t=(e.d-p.Vec3.dot(t.s,e.n))/p.Vec3.dot(ct,e.n))<0||1<t?0:t}P=t.default.create(),R=1/0,_t=new i.default(function(){return{distance:0,node:null}},1),D=[],dt=N.default.create(),ft=new p.Vec3,pt=new p.Vec3,B=new z.default,mt=cc.mat4(),yt=cc.mat4(),I=new p.Vec3,ut=new p.Vec3(0,0,0),ct=new p.Vec3(0,0,0);function X(t,e,i){p.Vec3.subtract(E,e.b,e.a),p.Vec3.subtract(M,e.c,e.a),p.Vec3.subtract(et,t.s,t.e),p.Vec3.cross(nt,E,M);var n=p.Vec3.dot(et,nt);if(n<=0)return 0;if(p.Vec3.subtract(it,t.s,e.a),(t=p.Vec3.dot(it,nt))<0||n<t)return 0;if(p.Vec3.cross(rt,et,it),(t=p.Vec3.dot(M,rt))<0||n<t)return 0;var r=-p.Vec3.dot(E,rt);return r<0||n<t+r?0:(i&&(n=1-(t*=n=1/n)-(r*=n),p.Vec3.set(i,e.a.x*n+e.b.x*t+e.c.x*r,e.a.y*n+e.b.y*t+e.c.y*r,e.a.z*n+e.b.z*t+e.c.z*r)),1)}function Y(t,e,i,n,r,s,a){if(p.Vec3.subtract(A,e,t),p.Vec3.subtract(C,i,t),p.Vec3.subtract(T,n,t),p.Vec3.subtract($,r,t),p.Vec3.cross(w,$,A),0<=(e=p.Vec3.dot(C,w))){var o=-p.Vec3.dot(T,w);if(o<0)return 0;var l=p.Vec3.dot(p.Vec3.cross(tt,A,T),C);if(l<0)return 0;a&&p.Vec3.set(a,i.x*(o*=h=1/(o+e+l))+n.x*(e*=h)+r.x*(l*=h),i.y*o+n.y*e+r.y*l,i.z*o+n.z*e+r.z*l)}else{p.Vec3.subtract(S,s,t);var h=p.Vec3.dot(S,w);if(h<0)return 0;o=p.Vec3.dot(p.Vec3.cross(tt,A,C),S);if(o<0)return 0;a&&(n=1/(h+(e=-e)+o),p.Vec3.set(a,i.x*(h*=n)+s.x*(e*=n)+r.x*(o*=n),i.y*h+s.y*e+r.y*o,i.z*h+s.z*e+r.z*o))}return 1}function q(t,e){var i=e.radius,e=e.center,n=t.o,t=t.d,i=i*i,e=(p.Vec3.subtract(x,e,n),x.lengthSqr()),n=p.Vec3.dot(x,t);return(t=i-(e-n*n))<0?0:(t=Math.sqrt(t),(e=e<i?n+t:n-t)<0?0:e)}function J(t,e){f[0]=e.halfExtents.x,f[1]=e.halfExtents.y,f[2]=e.halfExtents.z,K=e.center,Q=t.o,h=t.d,t=e.orientation.m,p.Vec3.set(c,t[0],t[1],t[2]),p.Vec3.set(u,t[3],t[4],t[5]),p.Vec3.set(_,t[6],t[7],t[8]),p.Vec3.subtract(d,K,Q),m[0]=p.Vec3.dot(c,h),m[1]=p.Vec3.dot(u,h),m[2]=p.Vec3.dot(_,h),y[0]=p.Vec3.dot(c,d),y[1]=p.Vec3.dot(u,d),y[2]=p.Vec3.dot(_,d);for(var i=0;i<3;++i){if(0===m[i]){if(0<-y[i]-f[i]||-y[i]+f[i]<0)return 0;m[i]=1e-7}g[2*i+0]=(y[i]+f[i])/m[i],g[2*i+1]=(y[i]-f[i])/m[i]}return e=Math.max(Math.max(Math.min(g[0],g[1]),Math.min(g[2],g[3])),Math.min(g[4],g[5])),(t=Math.min(Math.min(Math.max(g[0],g[1]),Math.max(g[2],g[3])),Math.max(g[4],g[5])))<0||t<e||e<0?0:e}function Z(t,e){return p.Vec3.subtract(s,t.center,t.halfExtents),p.Vec3.add(a,t.center,t.halfExtents),p.Vec3.subtract(o,e.center,e.halfExtents),p.Vec3.add(l,e.center,e.halfExtents),s.x<=l.x&&a.x>=o.x&&s.y<=l.y&&a.y>=o.y&&s.z<=l.z&&a.z>=o.z}st=new p.Vec3(0,0,0),at=new p.Vec3(0,0,0),ot=new p.Vec3(0,0,0),lt=new p.Vec3(0,0,0),ht=new p.Vec3(0,0,0);var s,a,o,l,K,Q,h,c,u,_,d,f,m,y,g,v,b,x,A,C,T,$,S,w,tt,E,M,et,it,nt,rt,st,at,ot,lt,ht,ct,ut,_t,D,dt,ft,pt,B,mt,yt,I,P,R,gt=function(t,e,i){p.Vec3.subtract(st,e.b,e.a),p.Vec3.subtract(at,e.c,e.a),p.Vec3.cross(ot,t.d,at);var n=p.Vec3.dot(st,ot);if(n<Number.EPSILON&&(!i||n>-Number.EPSILON))return 0;i=1/n,p.Vec3.subtract(lt,t.o,e.a),n=p.Vec3.dot(lt,ot)*i;if(n<0||1<n)return 0;p.Vec3.cross(ht,lt,st);e=p.Vec3.dot(t.d,ht)*i;if(e<0||1<n+e)return 0;t=p.Vec3.dot(at,ht)*i;return t<0?0:t},t=gt,O=(E=new p.Vec3(0,0,0),M=new p.Vec3(0,0,0),et=new p.Vec3(0,0,0),it=new p.Vec3(0,0,0),nt=new p.Vec3(0,0,0),rt=new p.Vec3(0,0,0),A=new p.Vec3(0,0,0),C=new p.Vec3(0,0,0),T=new p.Vec3(0,0,0),$=new p.Vec3(0,0,0),S=new p.Vec3(0,0,0),w=new p.Vec3(0,0,0),tt=new p.Vec3(0,0,0),x=new p.Vec3(0,0,0),v=new p.Vec3,b=new p.Vec3,function(t,e){var i=t.o,t=t.d,n=1/t.x,r=1/t.y,t=1/t.z,e=(p.Vec3.subtract(v,e.center,e.halfExtents),p.Vec3.add(b,e.center,e.halfExtents),(v.x-i.x)*n),n=(b.x-i.x)*n,s=(v.y-i.y)*r,r=(b.y-i.y)*r,a=(v.z-i.z)*t,i=(b.z-i.z)*t,t=Math.max(Math.max(Math.min(e,n),Math.min(s,r)),Math.min(a,i)),e=Math.min(Math.min(Math.max(e,n),Math.max(s,r)),Math.max(a,i));return e<0||e<t?0:t}),i=O;new p.Vec3,new p.Vec3,new p.Vec3,c=new p.Vec3,u=new p.Vec3,_=new p.Vec3,d=new p.Vec3,f=new Array(3),m=new Array(3),y=new Array(3),g=new Array(6),s=new p.Vec3,a=new p.Vec3,o=new p.Vec3,l=new p.Vec3;function vt(t,e){return t.distance-e.distance}function bt(t,e,i){var i=i.m,n=e.x,r=e.y,e=e.z,s=(s=i[3]*n+i[7]*r+i[11]*e)?1/s:1;return t.x=(i[0]*n+i[4]*r+i[8]*e)*s,t.y=(i[1]*n+i[5]*r+i[9]*e)*s,t.z=(i[2]*n+i[6]*r+i[10]*e)*s,t}function xt(t){return 0<t&&t<1/0}function At(t,e,i,n){p.Vec3.set(t,e[i*n],e[i*n+1],e[i*n+2])}function Ct(t,e,i,n,r,s){p.Vec3.set(s[0],t.x+i.x*e.x+n.x*e.y+r.x*e.z,t.y+i.y*e.x+n.y*e.y+r.y*e.z,t.z+i.z*e.x+n.z*e.y+r.z*e.z),p.Vec3.set(s[1],t.x-i.x*e.x+n.x*e.y+r.x*e.z,t.y-i.y*e.x+n.y*e.y+r.y*e.z,t.z-i.z*e.x+n.z*e.y+r.z*e.z),p.Vec3.set(s[2],t.x+i.x*e.x-n.x*e.y+r.x*e.z,t.y+i.y*e.x-n.y*e.y+r.y*e.z,t.z+i.z*e.x-n.z*e.y+r.z*e.z),p.Vec3.set(s[3],t.x+i.x*e.x+n.x*e.y-r.x*e.z,t.y+i.y*e.x+n.y*e.y-r.y*e.z,t.z+i.z*e.x+n.z*e.y-r.z*e.z),p.Vec3.set(s[4],t.x-i.x*e.x-n.x*e.y-r.x*e.z,t.y-i.y*e.x-n.y*e.y-r.y*e.z,t.z-i.z*e.x-n.z*e.y-r.z*e.z),p.Vec3.set(s[5],t.x+i.x*e.x-n.x*e.y-r.x*e.z,t.y+i.y*e.x-n.y*e.y-r.y*e.z,t.z+i.z*e.x-n.z*e.y-r.z*e.z),p.Vec3.set(s[6],t.x-i.x*e.x+n.x*e.y-r.x*e.z,t.y-i.y*e.x+n.y*e.y-r.y*e.z,t.z-i.z*e.x+n.z*e.y-r.z*e.z),p.Vec3.set(s[7],t.x-i.x*e.x-n.x*e.y+r.x*e.z,t.y-i.y*e.x-n.y*e.y+r.y*e.z,t.z-i.z*e.x-n.z*e.y+r.z*e.z)}function Tt(t,e){for(var i=s=p.Vec3.dot(e,t[0]),n=1;n<8;++n)var r=p.Vec3.dot(e,t[n]),s=r<s?r:s,i=i<r?r:i;return[s,i]}function St(t,e){var i=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z);return(t=p.Vec3.dot(e.n,t.center))+i<e.d?-1:t-i>e.d?0:1}function wt(t,e){for(var i=0;i<e.planes.length;i++)if(-1===St(t,e.planes[i]))return 0;return 1}function Et(t,e){return p.Vec3.subtract(L,e,t.center),p.Vec3.transformMat3(L,L,p.Mat3.transpose(kt,t.orientation)),e=L,t=t.halfExtents,Math.abs(e.x)<t.x&&Math.abs(e.y)<t.y&&Math.abs(e.z)<t.z}function Mt(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Gt(t,e.planes[i]))return 0;return 1}function Dt(t,e){var i=p.Vec3.dot(e.n,t.center),t=t.radius*e.n.length();return i+t<e.d?-1:i-t>e.d?0:1}function Bt(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Dt(t,e.planes[i]))return 0;return 1}function It(t,e){for(var i=0;i<6;i++){var n=e.planes[i],r=t.radius,s=t.center,a=n.n,n=n.d,o=p.Vec3.dot(a,s);if(o+r<n)return 0;if(!(n<o-r)){p.Vec3.add(Vt,s,p.Vec3.multiplyScalar(Vt,a,r));for(var l=0;l<6;l++)if(l!==i&&l!==i+Nt[i]){var h=e.planes[l];if(p.Vec3.dot(h.n,Vt)<h.d)return 0}}}return 1}function Pt(t,e){var i=t.radius+e.radius;return p.Vec3.squaredDistance(t.center,e.center)<i*i}function Rt(t,e){return k.pt_point_aabb(Ft,t.center,e),p.Vec3.squaredDistance(t.center,Ft)<t.radius*t.radius}function Ot(t,e){return k.pt_point_obb(Lt,t.center,e),p.Vec3.squaredDistance(t.center,Lt)<t.radius*t.radius}var Lt,Ft,Vt,Nt,L,kt,z=function(){for(var l=new Array(15),t=0;t<15;t++)l[t]=new p.Vec3(0,0,0);for(var h=new Array(8),c=new Array(8),e=0;e<8;e++)h[e]=new p.Vec3(0,0,0),c[e]=new p.Vec3(0,0,0);var u=new p.Vec3,_=new p.Vec3;return function(t,e){var i=e.orientation.m;p.Vec3.set(l[0],1,0,0),p.Vec3.set(l[1],0,1,0),p.Vec3.set(l[2],0,0,1),p.Vec3.set(l[3],i[0],i[1],i[2]),p.Vec3.set(l[4],i[3],i[4],i[5]),p.Vec3.set(l[5],i[6],i[7],i[8]);for(var n,r=0;r<3;++r)p.Vec3.cross(l[6+3*r],l[r],l[0]),p.Vec3.cross(l[6+3*r+1],l[r],l[1]),p.Vec3.cross(l[6+3*r+1],l[r],l[2]);p.Vec3.subtract(u,t.center,t.halfExtents),p.Vec3.add(_,t.center,t.halfExtents),i=u,t=_,n=h,p.Vec3.set(n[0],i.x,t.y,t.z),p.Vec3.set(n[1],i.x,t.y,i.z),p.Vec3.set(n[2],i.x,i.y,t.z),p.Vec3.set(n[3],i.x,i.y,i.z),p.Vec3.set(n[4],t.x,t.y,t.z),p.Vec3.set(n[5],t.x,t.y,i.z),p.Vec3.set(n[6],t.x,i.y,t.z),p.Vec3.set(n[7],t.x,i.y,i.z),Ct(e.center,e.halfExtents,l[3],l[4],l[5],c);for(var s=0;s<15;++s){var a=Tt(h,l[s]),o=Tt(c,l[s]);if(o[0]>a[1]||a[0]>o[1])return 0}return 1}}(),zt=function(){for(var h=new Array(8),c=0,u=0,t=0;t<h.length;t++)h[t]=new p.Vec3(0,0,0);return function(t,e){for(var i,n=!1,r=0;r<e.planes.length;r++){if(-1===(i=St(t,e.planes[r])))return 0;1===i&&(n=!0)}if(!n)return 1;for(var s=0;s<e.vertices.length;s++)p.Vec3.subtract(h[s],e.vertices[s],t.center);for(var a=u=c=0;a<e.vertices.length;a++)h[a].x>t.halfExtents.x?c++:h[a].x<-t.halfExtents.x&&u++;if(c===e.vertices.length||u===e.vertices.length)return 0;for(var o=u=c=0;o<e.vertices.length;o++)h[o].y>t.halfExtents.y?c++:h[o].y<-t.halfExtents.y&&u++;if(c===e.vertices.length||u===e.vertices.length)return 0;for(var l=u=c=0;l<e.vertices.length;l++)h[l].z>t.halfExtents.z?c++:h[l].z<-t.halfExtents.z&&u++;return c===e.vertices.length||u===e.vertices.length?0:1}}(),Gt=(L=new p.Vec3(0,0,0),kt=new p.Mat3,function(t,e){var i=t.orientation.m,i=t.halfExtents.x*Wt(e.n,i[0],i[1],i[2])+t.halfExtents.y*Wt(e.n,i[3],i[4],i[5])+t.halfExtents.z*Wt(e.n,i[6],i[7],i[8]),t=p.Vec3.dot(e.n,t.center);return t+i<e.d?-1:t-i>e.d?0:1}),Ut=function(){for(var c=new Array(8),u=0,_=0,d=0,t=0;t<c.length;t++)c[t]=new p.Vec3(0,0,0);function f(t,e,i,n){return t.x*e+t.y*i+t.z*n}return function(t,e){for(var i,n=!1,r=0;r<e.planes.length;r++){if(-1===(i=Gt(t,e.planes[r])))return 0;1===i&&(n=!0)}if(!n)return 1;for(var s=0;s<e.vertices.length;s++)p.Vec3.subtract(c[s],e.vertices[s],t.center);d=_=0;for(var a=t.orientation.m,o=0;o<e.vertices.length;o++)(u=f(c[o],a[0],a[1],a[2]))>t.halfExtents.x?_++:u<-t.halfExtents.x&&d++;if(_===e.vertices.length||d===e.vertices.length)return 0;for(var l=d=_=0;l<e.vertices.length;l++)(u=f(c[l],a[3],a[4],a[5]))>t.halfExtents.y?_++:u<-t.halfExtents.y&&d++;if(_===e.vertices.length||d===e.vertices.length)return 0;for(var h=d=_=0;h<e.vertices.length;h++)(u=f(c[h],a[6],a[7],a[8]))>t.halfExtents.z?_++:u<-t.halfExtents.z&&d++;return _===e.vertices.length||d===e.vertices.length?0:1}}(),jt=function(){for(var l=new Array(15),t=0;t<15;t++)l[t]=new p.Vec3(0,0,0);for(var h=new Array(8),c=new Array(8),e=0;e<8;e++)h[e]=new p.Vec3(0,0,0),c[e]=new p.Vec3(0,0,0);return function(t,e){var i=t.orientation.m,n=e.orientation.m;p.Vec3.set(l[0],i[0],i[1],i[2]),p.Vec3.set(l[1],i[3],i[4],i[5]),p.Vec3.set(l[2],i[6],i[7],i[8]),p.Vec3.set(l[3],n[0],n[1],n[2]),p.Vec3.set(l[4],n[3],n[4],n[5]),p.Vec3.set(l[5],n[6],n[7],n[8]);for(var r=0;r<3;++r)p.Vec3.cross(l[6+3*r],l[r],l[0]),p.Vec3.cross(l[6+3*r+1],l[r],l[1]),p.Vec3.cross(l[6+3*r+1],l[r],l[2]);Ct(t.center,t.halfExtents,l[0],l[1],l[2],h),Ct(e.center,e.halfExtents,l[3],l[4],l[5],c);for(var s=0;s<15;++s){var a=Tt(h,l[s]),o=Tt(c,l[s]);if(o[0]>a[1]||a[0]>o[1])return 0}return 1}}(),i=(Vt=new p.Vec3(0,0,0),Nt=[1,-1,1,-1,1,-1],Ft=new p.Vec3,Lt=new p.Vec3,{rayAabb:i,rayMesh:U,raycast:j,rayTriangle:t,ray_sphere:q,ray_aabb:O,ray_obb:J,ray_plane:W,ray_triangle:gt,line_plane:H,line_triangle:X,line_quad:Y,sphere_sphere:Pt,sphere_aabb:Rt,sphere_obb:Ot,sphere_plane:Dt,sphere_frustum:Bt,sphere_frustum_accurate:It,aabb_aabb:Z,aabb_obb:z,aabb_plane:St,aabb_frustum:wt,aabb_frustum_accurate:zt,obb_obb:jt,obb_plane:Gt,obb_frustum:Mt,obb_frustum_accurate:Ut,obb_point:Et,resolve:function(t,e,i){void 0===i&&(i=null);var n=t._type,r=e._type,s=this[n|r];return n<r?s(t,e,i):s(e,t,i)}});function Wt(t,e,i,n){return Math.abs(t.x*e+t.y*i+t.z*n)}i[n.default.SHAPE_RAY|n.default.SHAPE_SPHERE]=q,i[n.default.SHAPE_RAY|n.default.SHAPE_AABB]=O,i[n.default.SHAPE_RAY|n.default.SHAPE_OBB]=J,i[n.default.SHAPE_RAY|n.default.SHAPE_PLANE]=W,i[n.default.SHAPE_RAY|n.default.SHAPE_TRIANGLE]=gt,i[n.default.SHAPE_LINE|n.default.SHAPE_PLANE]=H,i[n.default.SHAPE_LINE|n.default.SHAPE_TRIANGLE]=X,i[n.default.SHAPE_SPHERE]=Pt,i[n.default.SHAPE_SPHERE|n.default.SHAPE_AABB]=Rt,i[n.default.SHAPE_SPHERE|n.default.SHAPE_OBB]=Ot,i[n.default.SHAPE_SPHERE|n.default.SHAPE_PLANE]=Dt,i[n.default.SHAPE_SPHERE|n.default.SHAPE_FRUSTUM]=Bt,i[n.default.SHAPE_SPHERE|n.default.SHAPE_FRUSTUM_ACCURATE]=It,i[n.default.SHAPE_AABB]=Z,i[n.default.SHAPE_AABB|n.default.SHAPE_OBB]=z,i[n.default.SHAPE_AABB|n.default.SHAPE_PLANE]=St,i[n.default.SHAPE_AABB|n.default.SHAPE_FRUSTUM]=wt,i[n.default.SHAPE_AABB|n.default.SHAPE_FRUSTUM_ACCURATE]=zt,i[n.default.SHAPE_OBB]=jt,i[n.default.SHAPE_OBB|n.default.SHAPE_PLANE]=Gt,i[n.default.SHAPE_OBB|n.default.SHAPE_FRUSTUM]=Mt,i[n.default.SHAPE_OBB|n.default.SHAPE_FRUSTUM_ACCURATE]=Ut,e.default=i,F.exports=e.default},{"../../renderer/gfx":363,"../../renderer/memop/recycle-pool":378,"../value-types":330,"./aabb":160,"./distance":161,"./enums":162,"./ray":169,"./triangle":171}],166:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=t("../value-types"),o=(t=t("./enums"))&&t.__esModule?t:{default:t};function l(t,e,i,n,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=o.default.SHAPE_LINE,this.s=new a.Vec3(t,e,i),this.e=new a.Vec3(n,r,s)}l.create=function(t,e,i,n,r,s){return new l(t,e,i,n,r,s)},l.clone=function(t){return new l(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},l.copy=function(t,e){return a.Vec3.copy(t.s,e.s),a.Vec3.copy(t.e,e.e),t},l.fromPoints=function(t,e,i){return a.Vec3.copy(t.s,e),a.Vec3.copy(t.e,i),t},l.set=function(t,e,i,n,r,s,a){return t.s.x=e,t.s.y=i,t.s.z=n,t.e.x=r,t.e.y=s,t.e.z=a,t},l.len=function(t){return a.Vec3.distance(t.s,t.e)},l.prototype.length=function(){return a.Vec3.distance(this.s,this.e)},i.default=l,e.exports=i.default},{"../value-types":330,"./enums":162}],167:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var m=t("../value-types"),p=(t=t("./enums"))&&t.__esModule?t:{default:t};function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r,s,a=new m.Vec3,o=new m.Vec3,l=new m.Mat3,t=(y.create=function(t,e,i,n,r,s,a,o,l,h,c,u,_,d,f){return new y(t,e,i,n,r,s,a,o,l,h,c,u,_,d,f)},y.clone=function(t){var e=t.orientation.m;return new y(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},y.copy=function(t,e){return m.Vec3.copy(t.center,e.center),m.Vec3.copy(t.halfExtents,e.halfExtents),m.Mat3.copy(t.orientation,e.orientation),t},y.fromPoints=function(t,e,i){return m.Vec3.multiplyScalar(t.center,m.Vec3.add(a,e,i),.5),m.Vec3.multiplyScalar(t.halfExtents,m.Vec3.subtract(o,i,e),.5),m.Mat3.identity(t.orientation),t},y.set=function(t,e,i,n,r,s,a,o,l,h,c,u,_,d,f,p){return m.Vec3.set(t.center,e,i,n),m.Vec3.set(t.halfExtents,r,s,a),m.Mat3.set(t.orientation,o,l,h,c,u,_,d,f,p),t},t=y,(s=[{key:"type",get:function(){return this._type}}])&&n(t.prototype,s),r&&n(t,r),(s=y.prototype).getBoundary=function(t,e){var i,n,r,s;i=a,n=this.halfExtents,r=this.orientation,s=l.m,r=r.m,s[0]=Math.abs(r[0]),s[1]=Math.abs(r[1]),s[2]=Math.abs(r[2]),s[3]=Math.abs(r[3]),s[4]=Math.abs(r[4]),s[5]=Math.abs(r[5]),s[6]=Math.abs(r[6]),s[7]=Math.abs(r[7]),s[8]=Math.abs(r[8]),m.Vec3.transformMat3(i,n,l),m.Vec3.subtract(t,this.center,a),m.Vec3.add(e,this.center,a)},s.transform=function(t,e,i,n,r){m.Vec3.transformMat4(r.center,this.center,t),m.Mat3.fromQuat(r.orientation,i),m.Vec3.multiply(r.halfExtents,this.halfExtents,n)},s.translateAndRotate=function(t,e,i){m.Vec3.transformMat4(i.center,this.center,t),m.Mat3.fromQuat(i.orientation,e)},s.setScale=function(t,e){m.Vec3.multiply(e.halfExtents,this.halfExtents,t)},y);function y(t,e,i,n,r,s,a,o,l,h,c,u,_,d,f){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===s&&(s=1),void 0===a&&(a=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===c&&(c=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===f&&(f=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=p.default.SHAPE_OBB,this.center=new m.Vec3(t,e,i),this.halfExtents=new m.Vec3(n,r,s),this.orientation=new m.Mat3(a,o,l,h,c,u,_,d,f)}i.default=t,e.exports=i.default},{"../value-types":330,"./enums":162}],168:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("../value-types"),s=(t=t("./enums"))&&t.__esModule?t:{default:t},a=new r.Vec3(0,0,0),o=new r.Vec3(0,0,0),n=cc.mat4(),l=cc.v4();function h(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=s.default.SHAPE_PLANE,this.n=new r.Vec3(t,e,i),this.d=n}h.create=function(t,e,i,n){return new h(t,e,i,n)},h.clone=function(t){return new h(t.n.x,t.n.y,t.n.z,t.d)},h.copy=function(t,e){return r.Vec3.copy(t.n,e.n),t.d=e.d,t},h.fromPoints=function(t,e,i,n){return r.Vec3.subtract(a,i,e),r.Vec3.subtract(o,n,e),r.Vec3.normalize(t.n,r.Vec3.cross(t.n,a,o)),t.d=r.Vec3.dot(t.n,e),t},h.set=function(t,e,i,n,r){return t.n.x=e,t.n.y=i,t.n.z=n,t.d=r,t},h.fromNormalAndPoint=function(t,e,i){return r.Vec3.copy(t.n,e),t.d=r.Vec3.dot(e,i),t},h.normalize=function(t,e){var i=e.n.len();return r.Vec3.normalize(t.n,e.n),0<i&&(t.d=e.d/i),t},h.prototype.transform=function(t){r.Mat4.invert(n,t),r.Mat4.transpose(n,n),r.Vec4.set(l,this.n.x,this.n.y,this.n.z,this.d),r.Vec4.transformMat4(l,l,n),r.Vec3.set(this.n,l.x,l.y,l.z),this.d=l.w},i.default=h,e.exports=i.default},{"../value-types":330,"./enums":162}],169:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=t("../value-types"),o=(t=t("./enums"))&&t.__esModule?t:{default:t};function l(t,e,i,n,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=o.default.SHAPE_RAY,this.o=new a.Vec3(t,e,i),this.d=new a.Vec3(n,r,s)}l.create=function(t,e,i,n,r,s){return new l(t=void 0===t?0:t,e=void 0===e?0:e,i=void 0===i?0:i,n=void 0===n?0:n,r=void 0===r?0:r,s=void 0===s?1:s)},l.clone=function(t){return new l(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},l.copy=function(t,e){return a.Vec3.copy(t.o,e.o),a.Vec3.copy(t.d,e.d),t},l.fromPoints=function(t,e,i){return a.Vec3.copy(t.o,e),a.Vec3.normalize(t.d,a.Vec3.subtract(t.d,i,e)),t},l.set=function(t,e,i,n,r,s,a){return t.o.x=e,t.o.y=i,t.o.z=n,t.d.x=r,t.d.y=s,t.d.z=a,t},l.prototype.computeHit=function(t,e){a.Vec3.normalize(t,this.d),a.Vec3.scaleAndAdd(t,this.o,t,e)},i.default=l,e.exports=i.default},{"../value-types":330,"./enums":162}],170:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=t("../value-types"),r=(t=t("./enums"))&&t.__esModule?t:{default:t},n=new s.Vec3;function a(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.center=void 0,this.radius=void 0,this._type=void 0,this._type=r.default.SHAPE_SPHERE,this.center=new s.Vec3(t,e,i),this.radius=n}a.create=function(t,e,i,n){return new a(t,e,i,n)},a.clone=function(t){return new a(t.center.x,t.center.y,t.center.z,t.radius)},a.copy=function(t,e){return s.Vec3.copy(t.center,e.center),t.radius=e.radius,t},a.fromPoints=function(t,e,i){return s.Vec3.multiplyScalar(t.center,s.Vec3.add(n,e,i),.5),t.radius=.5*s.Vec3.subtract(n,i,e).len(),t},a.set=function(t,e,i,n,r){return t.center.x=e,t.center.y=i,t.center.z=n,t.radius=r,t},(t=a.prototype).clone=function(){return a.clone(this)},t.copy=function(t){return a.copy(this,t)},t.getBoundary=function(t,e){s.Vec3.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),s.Vec3.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},t.transform=function(t,e,i,n,r){s.Vec3.transformMat4(r.center,this.center,t),r.radius=this.radius*n.maxAxis()},t.translateAndRotate=function(t,e,i){s.Vec3.transformMat4(i.center,this.center,t)},t.setScale=function(t,e){e.radius=this.radius*t.maxAxis()},i.default=a,e.exports=i.default},{"../value-types":330,"./enums":162}],171:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var h=n(t("../value-types/vec3")),c=n(t("./enums"));function n(t){return t&&t.__esModule?t:{default:t}}function u(t,e,i,n,r,s,a,o,l){this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this.a=new h.default(t,e,i),this.b=new h.default(n,r,s),this.c=new h.default(a,o,l),this._type=c.default.SHAPE_TRIANGLE}u.create=function(t,e,i,n,r,s,a,o,l){return new u(t,e,i,n,r,s,a,o,l)},u.clone=function(t){return new u(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},u.copy=function(t,e){return h.default.copy(t.a,e.a),h.default.copy(t.b,e.b),h.default.copy(t.c,e.c),t},u.fromPoints=function(t,e,i,n){return h.default.copy(t.a,e),h.default.copy(t.b,i),h.default.copy(t.c,n),t},u.set=function(t,e,i,n,r,s,a,o,l,h){return t.a.x=e,t.a.y=i,t.a.z=n,t.b.x=r,t.b.y=s,t.b.z=a,t.c.x=o,t.c.y=l,t.c.z=h,t},i.default=u,e.exports=i.default},{"../value-types/vec3":340,"./enums":162}],172:[function(t,e,i){"use strict";var n=t("../components/CCRenderComponent"),r=t("../assets/material/CCMaterial"),s=t("./types"),a=s.LineCap,o=s.LineJoin,l=cc.Class({name:"cc.Graphics",extends:n,editor:!1,ctor:function(){this._impl=new l._Impl(this)},properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:o.MITER,_lineCap:a.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._impl.lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this._impl.lineJoin=t},type:o},lineCap:{get:function(){return this._lineCap},set:function(t){this._lineCap=t,this._impl.lineCap=t},type:a},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._impl.strokeColor=this._strokeColor=cc.color(t)}},fillColor:{get:function(){return this._fillColor},set:function(t){this._impl.fillColor=this._fillColor=cc.color(t)}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._miterLimit=t,this._impl.miterLimit=t}}},statics:{LineJoin:o,LineCap:a},onRestore:function(){this._impl||(this._impl=new l._Impl(this))},onDestroy:function(){this.clear(!0),this._super(),this._impl=null},_getDefaultMaterial:function(){return r.getBuiltinMaterial("2d-base")},_updateMaterial:function(){var t=this._materials[0];t&&t.define("CC_USE_MODEL",!0)},moveTo:function(t,e){this._impl.moveTo(t,e)},lineTo:function(t,e){this._impl.lineTo(t,e)},bezierCurveTo:function(t,e,i,n,r,s){this._impl.bezierCurveTo(t,e,i,n,r,s)},quadraticCurveTo:function(t,e,i,n){this._impl.quadraticCurveTo(t,e,i,n)},arc:function(t,e,i,n,r,s){this._impl.arc(t,e,i,n,r,s)},ellipse:function(t,e,i,n){this._impl.ellipse(t,e,i,n)},circle:function(t,e,i){this._impl.circle(t,e,i)},rect:function(t,e,i,n){this._impl.rect(t,e,i,n)},roundRect:function(t,e,i,n,r){this._impl.roundRect(t,e,i,n,r)},fillRect:function(t,e,i,n){this.rect(t,e,i,n),this.fill()},clear:function(t){this._impl.clear(t),this._assembler&&this._assembler.clear(t)},close:function(){this._impl.close()},stroke:function(){this._assembler||this._resetAssembler(),this._assembler.stroke(this)},fill:function(){this._assembler||this._resetAssembler(),this._assembler.fill(this)}});cc.Graphics=e.exports=l,cc.Graphics.Types=s,cc.Graphics.Helper=t("./helper")},{"../assets/material/CCMaterial":95,"../components/CCRenderComponent":131,"./helper":173,"./types":175}],173:[function(t,e,i){"use strict";var x=t("./types").PointFlags,v=Math.PI,b=Math.min,A=Math.max,C=Math.cos,T=Math.sin,S=Math.abs,o=Math.sign,l=.5522847493;e.exports={arc:function(t,e,i,n,r,s,a){var o,l,h,c,u,_,d=0,f=0,p=0,m=0,y=0,g=0,d=s-r;if(a=a||!1)if(S(d)>=2*v)d=2*v;else for(;d<0;)d+=2*v;else if(S(d)>=2*v)d=2*-v;else for(;0<d;)d-=2*v;for(l=0|A(1,b(S(d)/(.5*v)+.5,5)),f=S(4/3*(1-C(s=d/l/2))/T(s)),a||(f=-f),o=0;o<=l;o++)h=e+(_=C(u=r+d*(o/l)))*n,c=i+(u=T(u))*n,u=-u*n*f,_=_*n*f,0===o?t.moveTo(h,c):t.bezierCurveTo(p+y,m+g,h-u,c-_,h,c),p=h,m=c,y=u,g=_},ellipse:function(t,e,i,n,r){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+r*l,e-n*l,i+r,e,i+r),t.bezierCurveTo(e+n*l,i+r,e+n,i+r*l,e+n,i),t.bezierCurveTo(e+n,i-r*l,e+n*l,i-r,e,i-r),t.bezierCurveTo(e-n*l,i-r,e-n,i-r*l,e-n,i),t.close()},roundRect:function(t,e,i,n,r,s){var a;s<.1?t.rect(e,i,n,r):(a=b(s,.5*S(n))*o(n),s=b(s,.5*S(r))*o(r),t.moveTo(e,i+s),t.lineTo(e,i+r-s),t.bezierCurveTo(e,i+r-s*(1-l),e+a*(1-l),i+r,e+a,i+r),t.lineTo(e+n-a,i+r),t.bezierCurveTo(e+n-a*(1-l),i+r,e+n,i+r-s*(1-l),e+n,i+r-s),t.lineTo(e+n,i+s),t.bezierCurveTo(e+n,i+s*(1-l),e+n-a*(1-l),i,e+n-a,i),t.lineTo(e+a,i),t.bezierCurveTo(e+a*(1-l),i,e,i+s*(1-l),e,i+s),t.close())},tesselateBezier:function t(e,i,n,r,s,a,o,l,h,c,u){var _,d,f,p,m,y,g,v,b;10<c||(m=.5*(a+l),y=.5*(o+h),g=.5*((_=.5*(i+r))+(f=.5*(r+a))),v=.5*((d=.5*(n+s))+(p=.5*(s+o))),((b=S((r-l)*(r=h-n)-(s-h)*(s=l-i)))+(a=S((a-l)*r-(o-h)*s)))*(b+a)<e._tessTol*(s*s+r*r)?e._addPoint(l,h,0===u?u|x.PT_BEVEL:u):(t(e,i,n,_,d,g,v,b=.5*(g+(o=.5*(f+m))),s=.5*(v+(a=.5*(p+y))),c+1,0),t(e,b,s,o,a,m,y,l,h,c+1,u)))}}},{"./types":175}],174:[function(t,e,i){"use strict";t("./graphics")},{"./graphics":172}],175:[function(t,e,i){"use strict";var n=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),r=cc.Enum({BEVEL:0,ROUND:1,MITER:2}),s=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});e.exports={LineCap:n,LineJoin:r,PointFlags:s}},{}],176:[function(t,e,i){"use strict";t("./platform"),t("./assets"),t("./CCNode"),t("./CCPrivateNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./collider/CCIntersection"),t("./physics"),t("./camera/CCCamera"),t("./geom-utils"),t("./mesh"),t("./3d"),t("./base-ui/CCWidgetManager")},{"./3d":29,"./CCNode":72,"./CCPrivateNode":73,"./CCScene":74,"./assets":93,"./base-ui/CCWidgetManager":104,"./camera/CCCamera":105,"./collider":113,"./collider/CCIntersection":111,"./components":148,"./geom-utils":164,"./graphics":174,"./mesh":199,"./physics":214,"./platform":247}],177:[function(t,e,i){"use strict";var r=t("../platform/js"),n=t("./pipeline"),l=t("./loading-items"),s=t("./asset-loader"),a=t("./downloader"),o=t("./loader"),h=t("./asset-table"),u=t("../platform/utils").callInNextTick,c=t("./auto-release-utils"),_=Object.create(null),d=(_.assets=new h,_.internal=new h,{url:null,raw:!1});function f(t){var e,i;if("object"==typeof t){if((i=t).url)return i;e=t.uuid}else i={},e=t;return t=i.type?"uuid"===i.type:cc.AssetLibrary._uuidInSettings(e),cc.AssetLibrary._getAssetInfoInRuntime(e,d),i.url=t?d.url:e,d.url&&"uuid"===i.type&&d.raw?(i.type=null,i.isRawAsset=!0):t||(i.isRawAsset=!0),i}var p=[],m=[];function y(){var t=new s,e=new a,i=new o;n.call(this,[t,e,i]),this.assetLoader=t,this.md5Pipe=null,this.downloader=e,this.loader=i,this.onProgress=null,this._autoReleaseSetting=r.createMap(!0)}r.extend(y,n);t=y.prototype;t.init=function(t){},t.getXMLHttpRequest=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},t.addDownloadHandlers=function(t){this.downloader.addHandlers(t)},t.addLoadHandlers=function(t){this.loader.addHandlers(t)},t.load=function(t,e,n){void 0===n&&(n=e,e=this.onProgress||null);var r,s=this,a=!1;t instanceof Array||(t=t?(a=!0,[t]):[]);for(var i=p.length=0;i<t.length;++i){var o=t[i];o&&o.id&&(cc.warnID(4920,o.id),o.uuid||o.url||(o.url=o.id)),((r=f(o)).url||r.uuid)&&(o=this._cache[r.url],p.push(o||r))}e=l.create(this,e,function(e,i){u(function(){var t;n&&(a?(t=r.url,n.call(s,e,i.getContent(t))):n.call(s,e,i),n=null),i.destroy()})});l.initQueueDeps(e),e.append(p),p.length=0},t.flowInDeps=function(i,t,n){for(var e=m.length=0;e<t.length;++e){var r,s=f(t[e]);(s.url||s.uuid)&&((r=this._cache[s.url])?m.push(r):m.push(s))}var a=l.create(this,i?function(t,e,i){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(i)}:null,function(t,e){n(t,e),i&&i.deps&&(i.deps.length=0),e.destroy()}),o=(i&&(o=l.getQueue(i),a._ownerQueue=o._ownerQueue||o),a.append(m,i));return m.length=0,o},t._assetTables=_,t._getResUuid=function(t,e,i,n){i=_[i=i||"assets"];if(!t||!i)return null;var r,s=t.indexOf("?"),s=(-1!==s&&(t=t.substr(0,s)),i.getUuid(t,e));return s||(r=cc.path.extname(t))&&(t=t.slice(0,-r.length),(s=i.getUuid(t,e))&&!n&&cc.warnID(4901,t,r)),s},t._getReferenceKey=function(t){var e;return"object"==typeof t?e=t._uuid||null:"string"==typeof t&&(e=this._getResUuid(t,null,null,!0)||t),e?(cc.AssetLibrary._getAssetInfoInRuntime(e,d),this._cache[d.url]?d.url:e):(cc.warnID(4800,t),e)},t._urlNotFound=function(e,i,n){u(function(){e=cc.url.normalize(e);var t=(i?r.getClassName(i):"Asset")+' in "resources/'+e+'" does not exist.';n&&n(new Error(t),[])})},t._parseLoadResArgs=function(t,e,i){var n;return void 0===i&&(n=t instanceof Array||r.isChildClassOf(t,cc.RawAsset),e?(i=e,n&&(e=this.onProgress||null)):void 0!==e||n||(i=t,e=this.onProgress||null,t=null),void 0===e||n||(e=t,t=null)),{type:t,onProgress:e,onComplete:i}},t.loadRes=function(t,e,i,n,r){5!==arguments.length&&(r=n,n=i,i="assets");var s=this._parseLoadResArgs(e,n,r),a=(e=s.type,n=s.onProgress,r=s.onComplete,this),o=a._getResUuid(t,e,i);o?this.load({type:"uuid",uuid:o},n,function(t,e){e&&a.setAutoReleaseRecursively(o,!1),r&&r(t,e)}):a._urlNotFound(t,e,r)},t._loadResUuids=function(t,e,o,l){var h,c;0<t.length?(h=this,c=t.map(function(t){return{type:"uuid",uuid:t}}),this.load(c,e,function(t,e){if(o){for(var i=[],n=l&&[],r=0;r<c.length;++r){var s=c[r].uuid,a=this._getReferenceKey(s),a=e.getContent(a);a&&(h.setAutoReleaseRecursively(s,!1),i.push(a),n&&n.push(l[r]))}l?o(t,i,n):o(t,i)}})):o&&u(function(){l?o(null,[],[]):o(null,[])})},t.loadResArray=function(t,e,i,n,r){5!==arguments.length&&(r=n,n=i,i="assets");var s=this._parseLoadResArgs(e,n,r);e=s.type,n=s.onProgress,r=s.onComplete;for(var a=[],o=e instanceof Array,l=0;l<t.length;l++){var h=t[l],c=o?e[l]:e,u=this._getResUuid(h,c,i);if(!u)return void this._urlNotFound(h,c,r);a.push(u)}this._loadResUuids(a,n,r)},t.loadResDir=function(t,e,i,n,r){var s;5!==arguments.length&&(r=n,n=i,i="assets"),_[i]&&(e=(s=this._parseLoadResArgs(e,n,r)).type,n=s.onProgress,r=s.onComplete,i=_[i].getUuidArray(t,e,s=[]),this._loadResUuids(i,n,r,s))},t.getRes=function(t,e){if(!(i=this._cache[t])){t=this._getResUuid(t,e,null,!0);if(!t)return null;var e=this._getReferenceKey(t),i=this._cache[e]}return(i=i&&i.alias?i.alias:i)&&i.complete?i.content:null},t.getResCount=function(){return Object.keys(this._cache).length},t.getDependsRecursively=function(t){var e;return t?(t=this._getReferenceKey(t),(e=c.getDependsRecursively(t)).push(t),e):[]},t.release=function(t){var e,i;if(Array.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];this.release(r)}else!t||(i=this._getReferenceKey(t))&&i in cc.AssetLibrary.getBuiltinDeps()||((e=this.getItem(i))&&(this.removeItem(i),t=e.content),t instanceof cc.Asset&&((i=t.nativeUrl)&&this.release(i),t.destroy()))},t.releaseAsset=function(t){t=t._uuid;t&&this.release(t)},t.releaseRes=function(t,e,i){e=this._getResUuid(t,e,i);e?this.release(e):cc.errorID(4914,t)},t.releaseResDir=function(t,e,i){if(_[i=i||"assets"])for(var n=_[i].getUuidArray(t,e),r=0;r<n.length;r++){var s=n[r];this.release(s)}},t.releaseAll=function(){for(var t in this._cache)this.release(t)},t.removeItem=function(t){var e=n.prototype.removeItem.call(this,t);return delete this._autoReleaseSetting[t],e},t.setAutoRelease=function(t,e){t=this._getReferenceKey(t);t&&(this._autoReleaseSetting[t]=!!e)},t.setAutoReleaseRecursively=function(t,e){e=!!e;t=this._getReferenceKey(t);if(t){this._autoReleaseSetting[t]=e;for(var i=c.getDependsRecursively(t),n=0;n<i.length;n++){var r=i[n];this._autoReleaseSetting[r]=e}}},t.isAutoRelease=function(t){t=this._getReferenceKey(t);return!!t&&!!this._autoReleaseSetting[t]},cc.loader=new y,e.exports=cc.loader},{"../platform/js":250,"../platform/utils":254,"./asset-loader":178,"./asset-table":179,"./auto-release-utils":181,"./downloader":183,"./loader":186,"./loading-items":187,"./pipeline":190,"./released-asset-checker":191}],178:[function(t,e,i){"use strict";t("../utils/CCPath");function n(t){this.id=s,this.async=!0,this.pipeline=null}var a=t("../CCDebug"),r=t("./pipeline"),o=t("./loading-items"),s="AssetLoader",l=(n.ID=s,[]);n.prototype.handle=function(n,r){var s=n.uuid;if(!s)return n.content||null;cc.AssetLibrary.queryAssetInfo(s,function(t,e,i){t?r(t):(n.url=n.rawUrl=e,(n.isRawAsset=i)?(t=cc.path.extname(e).toLowerCase())?(t=t.substr(1),i=o.getQueue(n),l[0]={queueId:n.queueId,id:e,url:e,type:t,error:null,alias:n,complete:!0},i.append(l),n.type=t,r(null,n.content)):r(new Error(a.getError(4931,s,e))):(n.type="uuid",r(null,n.content)))})},r.AssetLoader=e.exports=n},{"../CCDebug":69,"../utils/CCPath":304,"./loading-items":187,"./pipeline":190}],179:[function(t,e,i){"use strict";var r=t("../utils/misc").pushToMap,_=t("../platform/js");function s(t,e){this.uuid=t,this.type=e}function n(){this._pathToUuid=_.createMap(!0)}t=n.prototype;t.getUuid=function(t,e){t=cc.url.normalize(t);var i=this._pathToUuid[t];if(i)if(Array.isArray(i)){if(!e)return i[0].uuid;for(var n=0;n<i.length;n++){var r=i[n];if(_.isChildClassOf(r.type,e))return r.uuid}}else if(!e||_.isChildClassOf(i.type,e))return i.uuid;return""},t.getUuidArray=function(t,e,i){"/"===(t=cc.url.normalize(t))[t.length-1]&&(t=t.slice(0,-1));var n,r,s,a=this._pathToUuid,o=[],l=_.isChildClassOf;for(n in a)if(n.startsWith(t)&&(r=n,s=t,!(r.length>s.length)||(46===(r=r.charCodeAt(s.length))||47===r))||!t){var h=a[n];if(Array.isArray(h))for(var c=0;c<h.length;c++){var u=h[c];e&&!l(u.type,e)||(o.push(u.uuid),i&&i.push(n))}else e&&!l(h.type,e)||(o.push(h.uuid),i&&i.push(n))}return o},t.add=function(t,e,i,n){t=t.substring(0,t.length-cc.path.extname(t).length);e=new s(e,i);r(this._pathToUuid,t,e,n)},t._getInfo_DEBUG=!1,t.reset=function(){this._pathToUuid=_.createMap(!0)},e.exports=n},{"../platform/js":250,"../utils/misc":315}],180:[function(t,e,i){"use strict";var n=t("../platform/CCSys"),r=t("../CCDebug"),o=n.__audioSupport,s=o.format,a=o.context;function l(e,i){function n(){clearTimeout(r),t.removeEventListener("canplaythrough",s,!1),t.removeEventListener("error",a,!1),o.USE_LOADER_EVENT&&t.removeEventListener(o.USE_LOADER_EVENT,s,!1)}var t=document.createElement("audio"),r=(t.src=e.url,setTimeout(function(){(0===t.readyState?a:s)()},8e3)),s=function(){n(),i(null,t)},a=function(){n();var t="load audio failure - "+e.url;cc.log(t),i(t)};t.addEventListener("canplaythrough",s,!1),t.addEventListener("error",a,!1),o.USE_LOADER_EVENT&&t.addEventListener(o.USE_LOADER_EVENT,s,!1)}function h(t,e){a||e(new Error(r.getError(4926)));var i=cc.loader.getXMLHttpRequest();i.open("GET",t.url,!0),i.responseType="arraybuffer",i.onload=function(){a.decodeAudioData(i.response,function(t){e(null,t)},function(){e("decode error - "+t.id,null)})},i.onerror=function(){e("request error - "+t.id,null)},i.send()}e.exports=function(t,e){if(0===s.length)return new Error(r.getError(4927));(o.WEB_AUDIO?t._owner instanceof cc.AudioClip?t._owner.loadMode===cc.AudioClip.LoadMode.WEB_AUDIO?h:l:t.urlParam&&t.urlParam.useDom?l:h:l)(t,e)}},{"../CCDebug":69,"../platform/CCSys":239}],181:[function(t,e,i){"use strict";var _=t("../platform/js");function s(t,e){t=cc.loader.getItem(t);if(t){var i=t.dependKeys;if(i)for(var n=0;n<i.length;n++){var r=i[n];e[r]||(e[r]=!0,s(r,e))}}}function f(t,e){t._uuid&&!e[t=cc.loader._getReferenceKey(t)]&&(e[t]=!0,s(t,e))}function p(t,e){for(var i=0;i<t._components.length;i++){n=void 0;r=void 0;s=void 0;a=void 0;o=void 0;l=void 0;h=void 0;c=void 0;u=void 0;_=void 0;var n=t._components[i];var r=e;for(var s=Object.getOwnPropertyNames(n),a=0;a<s.length;a++){var o=n[s[a]];if("object"==typeof o&&o)if(Array.isArray(o))for(var l=0;l<o.length;l++){var h=o[l];h instanceof cc.RawAsset&&f(h,r)}else if(o.constructor&&o.constructor!==Object)o instanceof cc.RawAsset&&f(o,r);else for(var c=Object.getOwnPropertyNames(o),u=0;u<c.length;u++){var _=o[c[u]];_ instanceof cc.RawAsset&&f(_,r)}}}for(var d=0;d<t._children.length;d++)p(t._children[d],e)}e.exports={autoRelease:function(t,e,i){var n=cc.loader._autoReleaseSetting,r=_.createMap();if(e)for(var s=0;s<e.length;s++)r[e[s]]=!0;for(var a=0;a<i.length;a++)p(i[a],r);if(t)for(var o=0;o<t.length;o++){var l=t[o];!1===n[l]||r[l]||cc.loader.release(l)}for(var h=Object.keys(n),c=0;c<h.length;c++){var u=h[c];!0!==n[u]||r[u]||cc.loader.release(u)}},getDependsRecursively:function(t){var e={};return s(t,e),Object.keys(e)}}},{"../platform/js":250}],182:[function(t,e,i){"use strict";e.exports=function(t,e){var t=t.url,i=cc.loader.getXMLHttpRequest(),n="Load binary data failed: "+t;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){var t=i.response;t?(t=new Uint8Array(t),e(null,t)):e({status:i.status,errorMessage:n+"(no response)"})},i.onerror=function(){e({status:i.status,errorMessage:n+"(error)"})},i.ontimeout=function(){e({status:i.status,errorMessage:n+"(time out)"})},i.send(null)}},{}],183:[function(t,e,i){"use strict";var n=t("../platform/js"),o=t("../CCDebug");t("../utils/CCPath");var r=t("./pipeline"),s=t("./pack-downloader"),a=t("./binary-downloader"),l=t("./text-downloader"),h=t("./utils").urlAppendTimestamp;function c(){return null}function u(t,e,i){var n=t.url,t=document,r=document.createElement("script");function s(){r.parentNode.removeChild(r),r.removeEventListener("load",s,!1),r.removeEventListener("error",a,!1),e(null,n)}function a(){r.parentNode.removeChild(r),r.removeEventListener("load",s,!1),r.removeEventListener("error",a,!1),e(new Error(o.getError(4928,n)))}"file:"!==window.location.protocol&&(r.crossOrigin="anonymous"),r.async=i,r.src=h(n),r.addEventListener("load",s,!1),r.addEventListener("error",a,!1),t.body.appendChild(r)}function _(e,i,t,n){void 0===t&&(t=!0);var r=h(e.url);if(n=n||new Image,t&&"file:"!==window.location.protocol?n.crossOrigin="anonymous":n.crossOrigin=null,n.complete&&0<n.naturalWidth&&n.src===r)return n;function s(){n.removeEventListener("load",a),n.removeEventListener("error",s),"https:"!==window.location.protocol&&n.crossOrigin&&"anonymous"===n.crossOrigin.toLowerCase()?_(e,i,!1,n):i(new Error(o.getError(4930,r)))}var a=function t(){n.removeEventListener("load",t),n.removeEventListener("error",s),n.id=e.id,i(null,n)};n.addEventListener("load",a),n.addEventListener("error",s),n.src=r}function d(t,e){e(null,t.url)}function f(t){this.id=m,this.async=!0,this.pipeline=null,this._curConcurrent=0,this._loadQueue=[],this._subpackages={},this.extMap=n.mixin(t,p)}var p={js:u,png:_,jpg:_,bmp:_,jpeg:_,gif:_,ico:_,tiff:_,webp:_,image:_,pvr:a,pkm:a,mp3:t=t("./audio-downloader"),ogg:t,wav:t,m4a:t,txt:l,xml:l,vsh:l,fsh:l,atlas:l,tmx:l,tsx:l,json:l,ExportJson:l,plist:l,fnt:l,font:c,eot:c,ttf:c,woff:c,svg:c,ttc:c,uuid:function(t,e){var i=s.load(t,e);return void 0===i?this.extMap.json(t,e):i||void 0},binary:a,bin:a,dbbin:a,skel:a,mp4:d,avi:d,mov:d,mpg:d,mpeg:d,rm:d,rmvb:d,default:l},m="Downloader";f.ID=m,f.PackDownloader=s,f.prototype.addHandlers=function(t){n.mixin(this.extMap,t)},f.prototype._handleLoadQueue=function(){for(;this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT;){var t=this._loadQueue.shift();if(!t)break;var e=this.handle(t.item,t.callback);void 0!==e&&(e instanceof Error?t.callback(e):t.callback(null,e))}},f.prototype.handle=function(t,i){var n=this,e=this.extMap[t.type]||this.extMap.default,r=void 0;if(this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT){if(this._curConcurrent++,void 0!==(r=e.call(this,t,function(t,e){n._curConcurrent=Math.max(0,n._curConcurrent-1),n._handleLoadQueue(),i&&i(t,e)})))return this._curConcurrent=Math.max(0,this._curConcurrent-1),this._handleLoadQueue(),r}else if(t.ignoreMaxConcurrency){if(void 0!==(r=e.call(this,t,i)))return r}else this._loadQueue.push({item:t,callback:i})},f.prototype.loadSubpackage=function(t,e,i){!i&&e&&(i=e,e=null);var n=this._subpackages[t];n?n.loaded?i&&i():u({url:n.path+"index.js"},function(t){t||(n.loaded=!0),i&&i(t)}):i&&i(new Error("Can't find subpackage "+t))},r.Downloader=e.exports=f},{"../CCDebug":69,"../platform/js":250,"../utils/CCPath":304,"./audio-downloader":180,"./binary-downloader":182,"./pack-downloader":189,"./pipeline":190,"./text-downloader":193,"./utils":195}],184:[function(t,e,i){"use strict";var n,c=t("../utils/text-utils"),u=null,_="BES bswy:->@123",d={},f=-1,p=[],m=(n=void 0,function(){var t,e;return n=void 0===n?!!window.FontFace&&(t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor),t?42<parseInt(t[1],10):!e):n});function y(){for(var t=!0,e=Date.now(),i=p.length-1;0<=i;i--){var n,r,s=p[i],a=s.fontFamilyName;3e3<e-s.startTime?(cc.warnID(4933,a),s.callback(null,a),p.splice(i,1)):(n=s.refWidth,u.font=r="40px "+a,n!==c.safeMeasureText(u,_,r)?(p.splice(i,1),s.callback(null,a)):t=!1)}t&&(clearInterval(f),f=-1)}var g={loadFont:function(t,e){var t=t.url,i=g._getFontFamily(t);if(d[i])return i;u||((o=document.createElement("canvas")).width=100,o.height=100,u=o.getContext("2d"));var n,r,s,a,o="40px "+i,o=(u.font=o,c.safeMeasureText(u,_,o)),l=document.createElement("style"),h=(l.type="text/css",""),t=(isNaN(+i)?h+="@font-face { font-family:"+i+"; src:":h+="@font-face { font-family:'"+i+"'; src:",l.textContent=(h+="url('"+t+"');")+"}",document.body.appendChild(l),document.createElement("div")),h=t.style;h.fontFamily=i,t.innerHTML=".",h.position="absolute",h.left="-100px",h.top="-100px",document.body.appendChild(t),m()?(n=Date.now(),r=i,s=e,h=new Promise(function(i,t){!function e(){3e3<=Date.now()-n?t():document.fonts.load("40px "+r).then(function(t){1<=t.length?i():setTimeout(e,100)},function(){t()})}()}),a=null,t=new Promise(function(t,e){a=setTimeout(e,3e3)}),Promise.race([t,h]).then(function(){a&&(clearTimeout(a),a=null),s(null,r)},function(){cc.warnID(4933,r),s(null,r)})):(t={fontFamilyName:i,refWidth:o,callback:e,startTime:Date.now()},p.push(t),-1===f&&(f=setInterval(y,100))),d[i]=l},_getFontFamily:function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i=t.lastIndexOf("/");return t=-1!==(t=-1===i?t.substring(0,e)+"_LABEL":t.substring(i+1,e)+"_LABEL").indexOf(" ")?'"'+t+'"':t}};e.exports=g},{"../utils/text-utils":322}],185:[function(t,e,i){"use strict";t("./downloader"),t("./loader"),t("./loading-items"),t("./pipeline"),t("./CCLoader")},{"./CCLoader":177,"./downloader":183,"./loader":186,"./loading-items":187,"./pipeline":190}],186:[function(t,e,i){"use strict";var n=t("../platform/js"),r=t("../platform/CCSAXParser").plistParser,s=t("./pipeline"),a=t("../assets/CCTexture2D"),o=t("./uuid-loader"),t=t("./font-loader");function l(e){if("string"!=typeof e.content)return new Error("JSON Loader: Input item doesn't contain string content");try{return JSON.parse(e.content)}catch(t){return new Error("JSON Loader: Parse json ["+e.id+"] failed : "+t)}}function h(t){if(t._owner instanceof cc.Asset)return null;var e=t.content;if(cc.sys.platform!==cc.sys.FB_PLAYABLE_ADS&&!(e instanceof Image))return new Error("Image Loader: Input item doesn't contain Image content");var i=t.texture||new a;return i._uuid=t.uuid,i.url=t.url,i._setRawAsset(t.rawUrl,!1),i._nativeAsset=e,i}function c(t,e){if(t._owner instanceof cc.Asset)return null;var i=new cc.AudioClip;return i._setRawAsset(t.rawUrl,!1),i._nativeAsset=t.content,i.url=t.url,i}function u(t){return t.load?t.load(t.content):null}function _(t,e){return t[e]<<8|t[e+1]}function d(t){this.id="Loader",this.async=!0,this.pipeline=null,this.extMap=n.mixin(t,f)}var f={png:h,jpg:h,bmp:h,jpeg:h,gif:h,ico:h,tiff:h,webp:h,image:h,pvr:function(t){var t=t.content instanceof ArrayBuffer?t.content:t.content.buffer,e=new Int32Array(t,0,13);if(55727696!=e[0])return new Error("Invalid magic number in PVR header");var i=e[7],n=e[6],e=e[12]+52;return{_data:new Uint8Array(t,e),_compressed:!0,width:i,height:n}},pkm:function(t){var t=t.content instanceof ArrayBuffer?t.content:t.content.buffer,e=new Uint8Array(t),i=_(e,6);if(0!==i&&1!==i&&3!==i)return new Error("Invalid magic number in ETC header");var i=_(e,12),n=_(e,14);return _(e,8),_(e,10),{_data:new Uint8Array(t,16),_compressed:!0,width:i,height:n}},mp3:c,ogg:c,wav:c,m4a:c,json:l,ExportJson:l,plist:function(t){return"string"!=typeof t.content?new Error("Plist Loader: Input item doesn't contain string content"):r.parse(t.content)||new Error("Plist Loader: Parse ["+t.id+"] failed")},uuid:o,prefab:o,fire:o,scene:o,binary:u,dbbin:u,bin:u,skel:u,font:t.loadFont,eot:t.loadFont,ttf:t.loadFont,woff:t.loadFont,svg:t.loadFont,ttc:t.loadFont,default:function(){return null}};d.ID="Loader",d.prototype.addHandlers=function(t){this.extMap=n.mixin(this.extMap,t)},d.prototype.handle=function(t,e){return(this.extMap[t.type]||this.extMap.default).call(this,t,e)},s.Loader=e.exports=d},{"../assets/CCTexture2D":92,"../platform/CCSAXParser":237,"../platform/js":250,"./font-loader":184,"./pipeline":190,"./uuid-loader":196}],187:[function(t,e,i){"use strict";var r=t("../platform/callbacks-invoker"),a=(t("../utils/CCPath"),t("../platform/js")),s=0|998*Math.random(),l=a.createMap(!0),o=[],h={WORKING:1,COMPLETE:2,ERROR:3},c=a.createMap(!0);function u(t,e){var i="object"==typeof t?t.url:t,n={queueId:e,id:i,url:i,rawUrl:void 0,urlParam:function(t){if(t){var e,t=t.split("?");if(t&&t[0]&&t[1])return e={},t[1].split("&").forEach(function(t){t=t.split("=");e[t[0]]=t[1]}),e}}(i),type:"",error:null,content:null,complete:!1,states:{},deps:null};if("object"==typeof t&&(a.mixin(n,t),t.skips))for(var r=0;r<t.skips.length;r++){var s=t.skips[r];n.states[s]=h.COMPLETE}return n.rawUrl=n.url,i&&!n.type&&(n.type=cc.path.extname(i).toLowerCase().substr(1)),n}var _=[];function d(t,e,i,n){r.call(this),this._id=++s,(l[this._id]=this)._pipeline=t,this._errorUrls=a.createMap(!0),this._appending=!1,this._ownerQueue=null,this.onProgress=i,this.onComplete=n,this.map=a.createMap(!0),this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,e&&(0<e.length?this.append(e):this.allComplete())}d.ItemState=new cc.Enum(h),d.create=function(t,e,i,n){void 0===i?"function"==typeof e&&(n=e,e=i=null):void 0===n&&("function"==typeof e?(n=i,i=e,e=null):(n=i,i=null));var r=o.pop();return r?(r._pipeline=t,r.onProgress=i,r.onComplete=n,(l[r._id]=r)._pipeline&&(r.active=!0),e&&r.append(e)):r=new d(t,e,i,n),r},d.getQueue=function(t){return t.queueId?l[t.queueId]:null},d.itemComplete=function(t){var e=l[t.queueId];e&&e.itemComplete(t.id)},d.initQueueDeps=function(t){var e=c[t._id];e?(e.completed.length=0,e.deps.length=0):c[t._id]={completed:[],deps:[]}},d.registerQueueDep=function(t,e){var i=t.queueId||t;if(!i)return!1;i=c[i];if(i)-1===i.deps.indexOf(e)&&i.deps.push(e);else if(t.id)for(var n in c){n=c[n];-1!==n.deps.indexOf(t.id)&&-1===n.deps.indexOf(e)&&n.deps.push(e)}},d.finishDep=function(t){for(var e in c){e=c[e];-1!==e.deps.indexOf(t)&&-1===e.completed.indexOf(t)&&e.completed.push(t)}};t=d.prototype;a.mixin(t,r.prototype),t.append=function(t,e){if(!this.active)return[];e&&!e.deps&&(e.deps=[]),this._appending=!0;for(var i,n,r=[],s=0;s<t.length;++s)if(!(i=t[s]).queueId||this.map[i.id])"string"==typeof((n=i).url||n)&&(o=(n=u(i,this._id)).id,this.map[o]||(this.map[o]=n,this.totalCount++,e&&e.deps.push(n),d.registerQueueDep(e||this._id,o),r.push(n)));else{if(this.map[i.id]=i,e&&e.deps.push(i),i.complete||function t(e,i,n){if(e&&i){var r=!1;if(_.push(i.id),i.deps)for(var s,a=i.deps,o=0;o<a.length;o++){if((s=a[o]).id===e.id){r=!0;break}if(!(0<=_.indexOf(s.id))&&s.deps&&t(e,s,!0)){r=!0;break}}return n||(_.length=0),r}}(e,i)){this.totalCount++,this.itemComplete(i.id);continue}var a=this,o=l[i.queueId];o&&(this.totalCount++,d.registerQueueDep(e||this._id,i.id),o.addListener(i.id,function(t){a.itemComplete(t.id)}))}return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(r),r},t._childOnProgress=function(t){var e;this.onProgress&&(e=c[this._id],this.onProgress(e?e.completed.length:this.completedCount,e?e.deps.length:this.totalCount,t))},t.allComplete=function(){var t=a.isEmptyObject(this._errorUrls)?null:this._errorUrls;this.onComplete&&this.onComplete(t,this)},t.isCompleted=function(){return this.completedCount>=this.totalCount},t.isItemCompleted=function(t){return!!this.completed[t]},t.exists=function(t){return!!this.map[t]},t.getContent=function(t){var t=this.map[t],e=null;return t&&(t.content?e=t.content:t.alias&&(e=t.alias.content)),e},t.getError=function(t){var t=this.map[t],e=null;return t&&(t.error?e=t.error:t.alias&&(e=t.alias.error)),e},t.addListener=r.prototype.on,t.hasListener=r.prototype.hasEventListener,t.removeListener=r.prototype.off,t.removeAllListeners=r.prototype.removeAll,t.removeItem=function(t){var e=this.map[t];e&&this.completed[e.alias||t]&&(delete this.completed[t],delete this.map[t],e.alias&&(delete this.completed[e.alias.id],delete this.map[e.alias.id]),this.completedCount--,this.totalCount--)},t.itemComplete=function(t){var e,i=this.map[t];i&&(e=t in this._errorUrls,i.error instanceof Error||a.isString(i.error)?this._errorUrls[t]=i.error:i.error?a.mixin(this._errorUrls,i.error):!i.error&&e&&delete this._errorUrls[t],this.completed[t]=i,this.completedCount++,d.finishDep(i.id),this.onProgress&&(e=c[this._id],this.onProgress(e?e.completed.length:this.completedCount,e?e.deps.length:this.totalCount,i)),this.emit(t,i),this.removeAll(t),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete())},t.destroy=function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,a.clear(this._errorUrls),this.onProgress=null,this.onComplete=null,this.map=a.createMap(!0),this.completed={},this.totalCount=0,this.completedCount=0,r.call(this),c[this._id]&&(c[this._id].completed.length=0,c[this._id].deps.length=0),delete l[this._id],delete c[this._id],-1===o.indexOf(this)&&o.length<10&&o.push(this)},cc.LoadingItems=e.exports=d},{"../platform/callbacks-invoker":243,"../platform/js":250,"../utils/CCPath":304}],188:[function(t,e,i){"use strict";function n(t,e,i){this.id="MD5Pipe",this.async=!1,this.pipeline=null,this.md5AssetsMap=t,this.md5NativeAssetsMap=e,this.libraryBase=i}var t=t("./pipeline"),r=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/;n.ID="MD5Pipe",n.prototype.handle=function(t){return t.url=this.transformURL(t.url),null},n.prototype.transformURL=function(t){var i=t.startsWith(this.libraryBase)?this.md5AssetsMap:this.md5NativeAssetsMap;return t.replace(r,function(t,e){e=i[e];return e?t+"."+e:t})},t.MD5Pipe=e.exports=n},{"./pipeline":190}],189:[function(t,e,i){"use strict";var s=t("./unpackers"),a=t("../utils/misc").pushToMap,o=0,r=2,l=3;function h(){this.unpacker=null,this.state=o,this.duration=0}var c={},u={},_={},d=[],f=null;function p(t,e){return new Error("Can not retrieve "+t+" from packer "+e)}e.exports={msToRelease:12e4,initPacks:function(t){for(var e in c={},u=t)for(var i=t[e],n=0;n<i.length;n++){var r=i[n],s=1===i.length;a(c,r,e,s)}},_loadNewPack:function(i,n,r){var s=this,a=cc.AssetLibrary.getLibUrlNoExt(n)+".json";cc.loader.load({url:a,ignoreMaxConcurrency:!0},function(t,e){if(t)return cc.errorID(4916,i),r(t);_[n].url=a;t=s._doLoadNewPack(i,n,e);t?r(null,t):r(p(i,n))})},_doPreload:function(t,e){var i=_[t];i||((i=_[t]=new h).state=r),i.state!==l&&(i.unpacker=new s.JsonUnpacker,i.unpacker.load(u[t],e),i.state=l)},_doLoadNewPack:function(t,e,i){var n,r=_[e];return r.state!==l&&("string"==typeof i&&(i=JSON.parse(i)),Array.isArray(i)?r.unpacker=new s.JsonUnpacker:i.type===s.TextureUnpacker.ID&&(r.unpacker=new s.TextureUnpacker),r.unpacker.load(u[e],i),r.state=l,r.duration=0,d.push(e),n=this,f=f||setInterval(function(){for(var t=n.msToRelease/5e3,e=d.length-1;0<=e;e--){var i=d[e];++_[i].duration>t&&n.release(i)}0===d.length&&(clearInterval(f),f=null)},5e3)),r.unpacker.retrieve(t)},_selectLoadedPack:function(t){for(var e=o,i="",n=0;n<t.length;n++){var r=t[n],s=_[r];if(s){s=s.state;if(s===l)return r;e<s&&(e=s,i=r)}}return e!==o?i:t[0]},load:function(t,e){var i,t=t.uuid,n=c[t];if(n)return Array.isArray(n)&&(n=this._selectLoadedPack(n)),(i=_[n])&&i.state===l?(i.duration=0,i.unpacker.retrieve(t)||p(t,n)):(i||(console.log("Create unpacker %s for %s",n,t),(i=_[n]=new h).state=r),this._loadNewPack(t,n,e),null)},release:function(t){var e=_[t];e&&(cc.loader.release(e.url),delete _[t],cc.js.array.fastRemove(d,t))}}},{"../utils/misc":315,"./unpackers":194}],190:[function(t,e,i){"use strict";var n=t("../platform/js"),r=t("./loading-items"),o=r.ItemState;function s(t){this._pipes=t,this._cache=n.createMap(!0);for(var e=0;e<t.length;++e){var i=t[e];i.handle&&i.id&&(i.pipeline=this,i.next=e<t.length-1?t[e+1]:null)}}s.ItemState=o;t=s.prototype;t.insertPipe=function(t,e){var i,n;!t.handle||!t.id||e>this._pipes.length?cc.warnID(4921):0<this._pipes.indexOf(t)?cc.warnID(4922):(i=null,e<(t.pipeline=this)._pipes.length&&(i=this._pipes[e]),n=null,(n=0<e?this._pipes[e-1]:n)&&(n.next=t),t.next=i,this._pipes.splice(e,0,t))},t.insertPipeAfter=function(t,e){t=this._pipes.indexOf(t);t<0||this.insertPipe(e,t+1)},t.appendPipe=function(t){t.handle&&t.id&&(t.pipeline=this,t.next=null,0<this._pipes.length&&(this._pipes[this._pipes.length-1].next=t),this._pipes.push(t))},t.flowIn=function(t){var e,i,n=this._pipes[0];if(n){for(e=0;e<t.length;e++)i=t[e],this._cache[i.id]=i;for(e=0;e<t.length;e++)!function i(t,n){var r=t.id,e=n.states[r],s=t.next,a=t.pipeline;n.error||e===o.WORKING||e===o.ERROR||(e===o.COMPLETE?s?i(s,n):a.flowOut(n):(n.states[r]=o.WORKING,(e=t.handle(n,function(t,e){t?(n.error=t,n.states[r]=o.ERROR,a.flowOut(n)):(e&&(n.content=e),n.states[r]=o.COMPLETE,s?i(s,n):a.flowOut(n))}))instanceof Error?(n.error=e,n.states[r]=o.ERROR,a.flowOut(n)):void 0!==e&&(null!==e&&(n.content=e),n.states[r]=o.COMPLETE,s?i(s,n):a.flowOut(n))))}(n,i=t[e])}else for(e=0;e<t.length;e++)this.flowOut(t[e])},t.flowInDeps=function(t,e,i){return r.create(this,function(t,e){i(t,e),e.destroy()}).append(e,t)},t.flowOut=function(t){t.error?delete this._cache[t.id]:this._cache[t.id]||(this._cache[t.id]=t),t.complete=!0,r.itemComplete(t)},t.copyItemStates=function(t,e){if(e instanceof Array)for(var i=0;i<e.length;++i)e[i].states=t.states;else e.states=t.states},t.getItem=function(t){t=this._cache[t];return t&&(t=t.alias?t.alias:t)},t.removeItem=function(t){var e=this._cache[t];return e&&e.complete&&delete this._cache[t],e},t.clear=function(){for(var t in this._cache){var e=this._cache[t];delete this._cache[t],e.complete||(e.error=new Error("Canceled manually"),this.flowOut(e))}},cc.Pipeline=e.exports=s},{"../platform/js":250,"./loading-items":187}],191:[function(t,e,i){},{"../platform/js":250}],192:[function(t,e,i){"use strict";var t=t("./pipeline"),n="SubPackPipe",r=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/;function s(t){for(var e in this.id=n,this.async=!1,this.pipeline=null,t){var i=t[e];i.uuids&&i.uuids.forEach(function(t){a[t]=i.path})}}var a=Object.create(null);s.ID=n,s.prototype.handle=function(t){return t.url=this.transformURL(t.url),null},s.prototype.transformURL=function(t){var e=(e=(e=t).match(r))?e[1]:"";if(e){e=a[e];if(e)return t.replace("res/raw-assets/",e+"raw-assets/")}return t},t.SubPackPipe=e.exports=s},{"./pipeline":190}],193:[function(t,e,i){"use strict";var r=t("./utils").urlAppendTimestamp;e.exports=function(t,e){var t=t.url,t=r(t),i=cc.loader.getXMLHttpRequest(),n="Load text file failed: "+t;i.open("GET",t,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=utf-8"),i.onload=function(){4===i.readyState?200===i.status||0===i.status?e(null,i.responseText):e({status:i.status,errorMessage:n+"(wrong status)"}):e({status:i.status,errorMessage:n+"(wrong readyState)"})},i.onerror=function(){e({status:i.status,errorMessage:n+"(error)"})},i.ontimeout=function(){e({status:i.status,errorMessage:n+"(time out)"})},i.send(null)}},{"./utils":195}],194:[function(t,e,i){"use strict";var n=t("../assets/CCTexture2D"),t=t("../platform/js");function r(){this.jsons={}}function s(){this.contents={}}r.prototype.load=function(t,e){e.length!==t.length&&cc.errorID(4915);for(var i=0;i<t.length;i++){var n=t[i],r=e[i];this.jsons[n]=r}},r.prototype.retrieve=function(t){return this.jsons[t]||null},s.ID=t._getClassId(n),s.prototype.load=function(t,e){var i=e.data.split("|");i.length!==t.length&&cc.errorID(4915);for(var n=0;n<t.length;n++)this.contents[t[n]]=i[n]},s.prototype.retrieve=function(t){t=this.contents[t];return t?{__type__:s.ID,content:t}:null},e.exports={JsonUnpacker:r,TextureUnpacker:s}},{"../assets/CCTexture2D":92,"../platform/js":250}],195:[function(t,e,i){"use strict";var n=/\?/;e.exports={urlAppendTimestamp:function(t){return cc.game.config.noCache&&"string"==typeof t&&(n.test(t)?t+="&_t="+ +new Date:t+="?_t="+ +new Date),t}}},{}],196:[function(t,e,i){"use strict";var o=t("../platform/js"),l=t("../CCDebug"),p=(t("../platform/deserialize"),t("./loading-items"));function h(t){return t&&(t[0]&&"cc.Scene"===t[0].__type__||t[1]&&"cc.Scene"===t[1].__type__||t[0]&&"cc.Prefab"===t[0].__type__)}function n(t,e){if("string"==typeof t.content)try{a=JSON.parse(t.content)}catch(e){return new Error(l.getError(4923,t.id,e.stack))}else{if("object"!=typeof t.content)return new Error(l.getError(4924));a=t.content}var i,n=h(a),r=n?cc._MissingScript.safeFindClass:function(t){return o._getClassById(t)||(cc.warnID(4903,t),Object)},s=cc.deserialize.Details.pool.get();try{i=cc.deserialize(a,s,{classFinder:r,target:t.existingAsset,customEnv:t})}catch(e){cc.deserialize.Details.pool.put(s);var a=e.stack;return new Error(l.getError(4925,t.id,a))}i._uuid=t.uuid,i.url=i.nativeUrl;var u,_,d,f,r=function(t,e,i,n){var r,s,a=i.uuidList,o=i.uuidObjList,l=i.uuidPropList,h=i._stillUseUrl,c=t.dependKeys=[];if(n)for(r=[],s=0;s<a.length;s++){var u=a[s],_=o[s],d=l[s],f=cc.AssetLibrary._getAssetInfoInRuntime(u);f.raw?(f=f.url,_[d]=f,c.push(f)):r.push({type:"uuid",uuid:u,deferredLoadRaw:!0,_owner:_,_ownerProp:d,_stillUseUrl:h[s]})}else{for(r=new Array(a.length),s=0;s<a.length;s++)u=a[s],r[s]={type:"uuid",uuid:u,_owner:o[s],_ownerProp:l[s],_stillUseUrl:h[s]};e._native&&!e.constructor.preventPreloadNativeObject&&r.push({url:e.nativeUrl,_owner:e,_ownerProp:"_nativeAsset"})}return r}(t,i,s,(r=i,a=n,(n=(n=t).deferredLoadRaw)?r instanceof cc.Asset&&r.constructor.preventDeferredLoadDependents&&(n=!1):a&&(r instanceof cc.SceneAsset||r instanceof cc.Prefab)&&(n=r.asyncLoadAssets),n));if(cc.deserialize.Details.pool.put(s),0===r.length)return i.onLoad&&i.onLoad(),e(null,i);n=this.pipeline,u=i,_=r,d=e,(s=t).content=u,f=s.dependKeys,n.flowInDeps(s,_,function(t,e){var i,n,r=e.map;for(n in r)(i=r[n]).uuid&&i.content&&(i.content._uuid=i.uuid);function s(t){var e=t.content;this._stillUseUrl&&(e=e&&cc.RawAsset.wasRawAssetType(e.constructor)?e.nativeUrl:t.rawUrl),"_nativeAsset"===this._ownerProp&&(this._owner.url=t.url),this._owner[this._ownerProp]=e,t.uuid!==u._uuid&&f.indexOf(t.id)<0&&f.push(t.id)}for(var a=0;a<_.length;a++){var o,l=_[a],h=l.uuid,c=l.url;l._owner,l._ownerProp,(i=r[c])&&(c=l,i.complete||i.content?i.error?cc._throw(i.error.message||i.error.errorMessage||i.error):s.call(c,i):(o=(l=p.getQueue(i))._callbackTable[h])?o.unshift(s,c):l.addListener(h,s,c))}if(!t&&u.onLoad)try{u.onLoad()}catch(t){cc._throw(t)}d(t,u)})}(e.exports=n).isSceneObj=h},{"../CCDebug":69,"../platform/deserialize":245,"../platform/js":250,"./loading-items":187}],197:[function(t,e,i){"use strict";var h=n(t("../../renderer/core/input-assembler")),g=n(t("../../renderer/gfx")),c=t("./mesh-data");function n(t){return t&&t.__esModule?t:{default:t}}var u=t("../renderer"),t=t("../event/event-target");function v(t,e,i){t[e]=i._val}function b(t,e,i){t[e]=i.x,t[e+1]=i.y}function x(t,e,i){t[e]=i.x,t[e+1]=i.y,t[e+2]=i.z}var y={5120:"getInt8",5121:"getUint8",5122:"getInt16",5123:"getUint16",5124:"getInt32",5125:"getUint32",5126:"getFloat32"},A={5120:"setInt8",5121:"setUint8",5122:"setInt16",5123:"setUint16",5124:"setInt32",5125:"setUint32",5126:"setFloat32"},C=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]),r=cc.Class({name:"cc.Mesh",extends:cc.Asset,mixins:[t],properties:{_nativeAsset:{override:!0,get:function(){return this._buffer},set:function(t){this._buffer=ArrayBuffer.isView(t)?t.buffer:t,this.initWithBuffer()}},_vertexBundles:{default:null,type:c.VertexBundle},_primitives:{default:null,Primitive:c.Primitive},_minPos:cc.v3(),_maxPos:cc.v3(),subMeshes:{get:function(){return this._subMeshes},set:function(t){this._subMeshes=t}},subDatas:{get:function(){return this._subDatas}}},ctor:function(){this._subMeshes=[],this.loaded=!1,this._subDatas=[]},initWithBuffer:function(){this._subMeshes.length=0;for(var t=this._primitives,e=0;e<t.length;e++){var i=t[e],n=i.data,n=new Uint8Array(this._buffer,n.offset,n.length),r=this._vertexBundles[i.vertexBundleIndices[0]],s=r.data,r=new g.default.VertexFormat(r.formats),a=new Uint8Array(this._buffer,s.offset,s.length),o=this._canVertexFormatBatch(r),l=new c.MeshData,s=(l.vData=a,l.iData=n,l.vfm=r,l.offset=s.offset,l.canBatch=o,this._subDatas.push(l),new g.default.VertexBuffer(u.device,r,g.default.USAGE_STATIC,a)),o=new g.default.IndexBuffer(u.device,i.indexUnit,g.default.USAGE_STATIC,n);this._subMeshes.push(new h.default(s,o))}this.loaded=!0,this.emit("load")},_canVertexFormatBatch:function(t){var e=t._attr2el[g.default.ATTR_POSITION];return!e||e.type===g.default.ATTR_TYPE_FLOAT32&&t._bytes%4==0},init:function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=0);var e=new Uint8Array(t._bytes*e),r=new c.MeshData,t=(r.vData=e,r.vfm=t,r.vDirty=!0,r.canBatch=this._canVertexFormatBatch(t),new g.default.VertexBuffer(u.device,t,i?g.default.USAGE_DYNAMIC:g.default.USAGE_STATIC,e)),i=(r.vb=t,this._subMeshes[n]=new h.default(r.vb),this._subDatas[n]);i&&(i.vb&&i.vb.destroy(),i.ib&&i.ib.destroy()),this._subDatas[n]=r,this.loaded=!0,this.emit("load"),this.emit("init-format")},setVertices:function(t,e,i){var i=this._subDatas[i=i||0],n=i.vfm.element(t);if(!n)return cc.warn("Cannot find "+t+" attribute in vertex defines.");var r,s="number"==typeof e[0],a=n.num,o=s?e.length/a|0:e.length,o=(i.vData.byteLength<o*n.stride&&i.setVData(new Uint8Array(o*i.vfm._bytes)),4),l=(t===g.default.ATTR_COLOR?s?(r=i.getVData(),o=1):r=i.getVData(Uint32Array):r=i.getVData(Float32Array),n.stride/o),h=n.offset/o;if(s)for(var c=0,u=e.length/a;c<u;c++)for(var _=c*a,d=c*l+h,f=0;f<a;f++)r[d+f]=e[_+f];else for(var p=t===g.default.ATTR_COLOR?v:2===a?b:x,m=0,y=e.length;m<y;m++)p(r,m*l+h,e[m]);i.vDirty=!0},setIndices:function(t,e,i){e=e||0;var n=t,t=(t instanceof Uint16Array?n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(n=new Uint16Array(t),n=new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),i?g.default.USAGE_DYNAMIC:g.default.USAGE_STATIC),i=this._subDatas[e];i.ib?(i.iData=n,i.iDirty=!0):(i.iData=n,t=new g.default.IndexBuffer(u.device,g.default.INDEX_FMT_UINT16,t,n,n.byteLength/g.default.IndexBuffer.BYTES_PER_INDEX[g.default.INDEX_FMT_UINT16]),i.ib=t,this._subMeshes[e]._indexBuffer=i.ib)},setPrimitiveType:function(t,e){this._subMeshes[e=e||0]?this._subMeshes[e]._primitiveType=t:cc.warn("Do not have sub mesh at index "+e)},clear:function(){this._subMeshes.length=0;for(var t=this._subDatas,e=0,i=t.length;e<i;e++){var n=t[e].vb,n=(n&&n.destroy(),t[e].ib);n&&n.destroy()}t.length=0},setBoundingBox:function(t,e){this._minPos=t,this._maxPos=e},destroy:function(){this.clear()},_uploadData:function(){for(var t=this._subDatas,e=0,i=t.length;e<i;e++){var n,r,s=t[e];s.vDirty&&(n=s.vb,r=s.vData,n.update(0,r),s.vDirty=!1),s.iDirty&&(n=s.ib,r=s.iData,n.update(0,r),s.iDirty=!1)}},_getAttrMeshData:function(t,e){t=this._subDatas[t];if(!t)return[];var i=t.vfm,n=i.element(e);if(!n)return[];t.attrDatas||(t.attrDatas={});var r=t.attrDatas,s=r[e];if(!s)for(var s=r[e]=[],r=t.vData,a=new DataView(r.buffer,r.byteOffset,r.byteLength),o=n.stride,l=n.offset,h=n.num,c=n.bytes/h,u=y[n.type],_=r.byteLength/i._bytes,d=0;d<_;d++)for(var f=d*o+l,p=0;p<h;p++){var m=a[u](f+p*c,C);s.push(m)}return s},copyAttribute:function(t,e,i,n,r){var s=!1,a=this._subDatas[t];if(a){var o=a.vfm,l=o.element(e);if(l){var h=A[l.type];if(h){var c=this._getAttrMeshData(t,e),u=a.vData.byteLength/o._bytes,_=l.bytes/l.num;if(0<c.length){for(var d=new DataView(i,r),f=n,p=l.num,m=0;m<u;++m)for(var y=m*p,g=0;g<p;++g)d[h](f*m+_*g,c[y+g],C);s=!0}}}}return s},copyIndices:function(t,e){t=this._subDatas[t];if(!t)return!1;for(var t=t.iData,i=t.length/2,n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=y[g.default.INDEX_FMT_UINT8],s=0;s<i;++s)e[s]=n[r](2*s);return!0}});cc.Mesh=e.exports=r},{"../../renderer/core/input-assembler":353,"../../renderer/gfx":363,"../event/event-target":156,"../renderer":262,"./mesh-data":200}],198:[function(t,e,i){"use strict";var s=o(t("../../renderer/gfx")),n=(o(t("../../renderer/core/input-assembler")),o(t("../geom-utils/aabb"))),r=t("../utils/mesh-util"),a=(o(t("../value-types/vec3")),o(t("../value-types/mat4")),o(t("../assets/material/material-variant")));function o(t){return t&&t.__esModule?t:{default:t}}var l=t("../components/CCRenderComponent"),h=t("./CCMesh"),c=t("../renderer/render-flow"),u=(t("../renderer"),t("../assets/material/CCMaterial")),_=cc.Enum({OFF:0,ON:1}),t=cc.Class({name:"cc.MeshRenderer",extends:l,editor:!1,properties:{_mesh:{default:null,type:h},_receiveShadows:!1,_shadowCastingMode:_.OFF,_enableAutoBatch:!1,mesh:{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._setMesh(t),t?(this.markForRender(!0),this.node._renderFlag|=c.FLAG_TRANSFORM):this.disableRender())},type:h,animatable:!1},textures:{default:[],type:cc.Texture2D,visible:!1},receiveShadows:{get:function(){return this._receiveShadows},set:function(t){this._receiveShadows=t,this._updateReceiveShadow()},animatable:!1},shadowCastingMode:{get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()},type:_,animatable:!1},enableAutoBatch:{get:function(){return this._enableAutoBatch},set:function(t){this._enableAutoBatch=t}}},statics:{ShadowCastingMode:_},ctor:function(){this._boundingBox=cc.geomUtils&&new n.default},onEnable:function(){var t=this;this._super(),this._mesh&&!this._mesh.loaded?(this.disableRender(),this._mesh.once("load",function(){t.isValid&&(t._setMesh(t._mesh),t.markForRender(!0))}),(0,r.postLoadMesh)(this._mesh)):this._setMesh(this._mesh),this._updateRenderNode(),this._updateMaterial()},onDestroy:function(){this._setMesh(null),cc.pool.assembler.put(this._assembler)},_updateRenderNode:function(){this._assembler.setRenderNode(this.node)},_setMesh:function(t){cc.geomUtils&&t&&n.default.fromPoints(this._boundingBox,t._minPos,t._maxPos),this._mesh&&this._mesh.off("init-format",this._updateMeshAttribute,this),t&&t.on("init-format",this._updateMeshAttribute,this),this._mesh=t,this._updateMeshAttribute()},_getDefaultMaterial:function(){return u.getBuiltinMaterial("unlit")},_validateRender:function(){var t=this._mesh;t&&0<t._subDatas.length||this.disableRender()},_updateMaterial:function(){var t=this.textures;if(t&&0<t.length)for(var e=this._getDefaultMaterial(),i=0;i<t.length;i++){var n=this._materials[i];n&&n._uuid!==e._uuid||(n||(n=a.default.create(e,this),this.setMaterial(i,n)),n.setProperty("diffuseTexture",t[i]))}this._updateReceiveShadow(),this._updateCastShadow(),this._updateMeshAttribute()},_updateReceiveShadow:function(){for(var t=this.getMaterials(),e=0;e<t.length;e++)t[e].define("CC_USE_SHADOW_MAP",this._receiveShadows,void 0,!0)},_updateCastShadow:function(){for(var t=this.getMaterials(),e=0;e<t.length;e++)t[e].define("CC_CASTING_SHADOW",this._shadowCastingMode===_.ON,void 0,!0)},_updateMeshAttribute:function(){var t=this._mesh&&this._mesh.subDatas;if(t)for(var e=this.getMaterials(),i=0;i<e.length&&t[i];i++){var n=t[i].vfm,r=e[i];r.define("CC_USE_ATTRIBUTE_COLOR",!!n.element(s.default.ATTR_COLOR),void 0,!0),r.define("CC_USE_ATTRIBUTE_UV0",!!n.element(s.default.ATTR_UV0),void 0,!0),r.define("CC_USE_ATTRIBUTE_NORMAL",!!n.element(s.default.ATTR_NORMAL),void 0,!0),r.define("CC_USE_ATTRIBUTE_TANGENT",!!n.element(s.default.ATTR_TANGENT),void 0,!0)}},_checkBacth:function(){}});cc.MeshRenderer=e.exports=t},{"../../renderer/core/input-assembler":353,"../../renderer/gfx":363,"../assets/material/CCMaterial":95,"../assets/material/material-variant":102,"../components/CCRenderComponent":131,"../geom-utils/aabb":160,"../renderer":262,"../renderer/render-flow":263,"../utils/mesh-util":314,"../value-types/mat4":332,"../value-types/vec3":340,"./CCMesh":197}],199:[function(t,e,i){"use strict";t("./CCMesh"),t("./CCMeshRenderer"),t("./mesh-renderer")},{"./CCMesh":197,"./CCMeshRenderer":198,"./mesh-renderer":201}],200:[function(t,e,i){"use strict";i.__esModule=!0,i.MeshData=s,i.Primitive=i.VertexBundle=i.VertexFormat=i.BufferRange=void 0;var t=(t=t("../../renderer/gfx"))&&t.__esModule?t:{default:t},n=cc.Class({name:"cc.BufferRange",properties:{offset:0,length:0}}),r=(i.BufferRange=n,cc.Class({name:"cc.mesh.VertexFormat",properties:{name:"",type:-1,num:-1,normalize:!1}})),r=(i.VertexFormat=r,cc.Class({name:"cc.mesh.VertexBundle",properties:{data:{default:null,type:n},formats:{default:[],type:r},verticesCount:0}})),r=(i.VertexBundle=r,cc.Class({name:"cc.mesh.Primitive",properties:{vertexBundleIndices:{default:[],type:cc.Float},data:{default:null,type:n},indexUnit:t.default.INDEX_FMT_UINT16,topology:t.default.PT_TRIANGLES}}));function s(){this.vData=null,this.float32VData=null,this.uint32VData=null,this.iData=null,this.uint16IData=null,this.vfm=null,this.offset=0,this.vb=null,this.ib=null,this.vDirty=!1,this.iDirty=!1,this.enable=!0}i.Primitive=r,s.prototype.setVData=function(t){this.vData=t,this.float32VData=null,this.uint32VData=null},s.prototype.getVData=function(t){return t===Float32Array?(this.float32VData||(this.float32VData=new Float32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.float32VData):t===Uint32Array?(this.uint32VData||(this.uint32VData=new Uint32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.uint32VData):this.vData},s.prototype.getIData=function(t){return t===Uint16Array?(this.uint16IData||(this.uint16IData=new Uint16Array(this.iData.buffer,this.iData.byteOffset,this.iData.byteLength/2)),this.uint16IData):this.iData}},{"../../renderer/gfx":363}],201:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=r(t("../renderer/assembler")),p=r(t("../../renderer/gfx")),m=r(t("../value-types/vec3"));function r(t){return t&&t.__esModule?t:{default:t}}var s,a,t=t("./CCMeshRenderer"),y=new m.default,o=(s=n.default,o=s,(a=l).prototype=Object.create(o.prototype),(a.prototype.constructor=a).__proto__=o,(a=l.prototype).init=function(t){s.prototype.init.call(this,t),this._worldDatas={},this._renderNode=null},a.setRenderNode=function(t){this._renderNode=t},a.fillBuffers=function(t,e){if(t.mesh){t.mesh._uploadData();for(var i=e.cullingMask===t.node._cullingMask,n=t.enableAutoBatch,r=t._materials,s=t.mesh._subMeshes,a=t.mesh.subDatas,o=0;o<s.length;o++){var l=s[o],h=a[o],c=r[o]||r[0];n&&h.canBatch&&l._primitiveType===p.default.PT_TRIANGLES?(i&&c.getHash()===e.material.getHash()||e._flush(),e.material=c,e.cullingMask=t.node._cullingMask,e.node=e._dummyNode,this._fillBuffer(t,h,e,o)):(e._flush(),e.material=c,e.cullingMask=t.node._cullingMask,e.node=this._renderNode,e._flushIA(l))}}},a._fillBuffer=function(t,e,i,n){var r=e.getVData(Float32Array),s=e.vfm,a=r.byteLength/s._bytes|0,o=e.getIData(Uint16Array),l=o.length,e=i.getBuffer("mesh",s),h=e.request(a,l),c=h.indiceOffset,u=h.byteOffset>>2,_=h.vertexOffset,h=e._vData,d=e._iData;!i.worldMatDirty&&this._worldDatas[n]||this._updateWorldVertices(n,a,r,s,t.node._worldMatrix),h.set(this._worldDatas[n],u);for(var f=0;f<l;f++)d[c+f]=_+o[f]},a._updateWorldVertices=function(t,e,i,n,r){var s=this._worldDatas[t];s||(s=this._worldDatas[t]=new Float32Array(i.length)).set(i);for(var a=n._bytes/4,o=n._elements,l=0,h=o.length;l<h;l++){var c=o[l],u=c.offset/4;if(c.name===p.default.ATTR_POSITION||c.name===p.default.ATTR_NORMAL)for(var _=c.name===p.default.ATTR_NORMAL?m.default.transformMat4Normal:m.default.transformMat4,d=0;d<e;d++){var f=d*a+u;y.x=i[f],y.y=i[1+f],y.z=i[2+f],_(y,y,r),s[f]=y.x,s[1+f]=y.y,s[2+f]=y.z}}},a._drawDebugDatas=function(t,e,i){var n=t._debugDatas[i];if(n)for(var r=0;r<n.length;r++){var s,a=n[r];a&&(s=a.material,e.material=s,e._flushIA(a.ia))}},l);function l(){return s.apply(this,arguments)||this}i.default=o,n.default.register(t,o),e.exports=i.default},{"../../renderer/gfx":363,"../renderer/assembler":259,"../value-types/vec3":340,"./CCMeshRenderer":198}],202:[function(t,e,i){"use strict";var n=t("./component-scheduler"),r=t("./platform/CCObject").Flags,_=t("./platform/js"),s=r.IsPreloadStarted,a=r.IsOnLoadStarted,o=r.IsOnLoadCalled,d=r.Deactivating,l=cc.Class({extends:n.LifeCycleInvoker,add:function(t){this._zero.array.push(t)},remove:function(t){this._zero.fastRemove(t)},cancelInactive:function(t){n.LifeCycleInvoker.stableRemoveInactive(this._zero,t)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),h=n.createInvokeImpl("c.__preload();"),c=n.createInvokeImpl("c.onLoad();c._objFlags|="+o,!1,o),u=new _.Pool(4);function f(){this._activatingStack=[]}u.get=function(){var t=this._get()||{preload:new l(h),onLoad:new n.OneOffInvoker(c),onEnable:new n.OneOffInvoker(n.invokeOnEnable)},e=(t.preload._zero.i=-1,t.onLoad);return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};t=cc.Class({ctor:f,reset:f,_activateNodeRecursively:function(t,e,i,n){if(t._objFlags&d)cc.errorID(3816,t.name);else{t._activeInHierarchy=!0;for(var r=t._components.length,s=0;s<r;++s){var a=t._components[s];a instanceof cc.Component?this.activateComp(a,e,i,n):(c=t,u=s,(a=a)?c._removeComponent(a):_.array.removeAt(c._components,u),--s,--r)}t._childArrivalOrder=t._children.length;for(var o=0,l=t._children.length;o<l;++o){var h=t._children[o];h._localZOrder=4294901760&h._localZOrder|o+1,h._active&&this._activateNodeRecursively(h,e,i,n)}t._onPostActivated(!0)}var c,u},_deactivateNodeRecursively:function(t){t._objFlags|=d,t._activeInHierarchy=!1;for(var e=t._components.length,i=0;i<e;++i){var n=t._components[i];if(n._enabled&&(cc.director._compScheduler.disableComp(n),t._activeInHierarchy))return void(t._objFlags&=~d)}for(var r=0,s=t._children.length;r<s;++r){var a=t._children[r];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),t._activeInHierarchy))return void(t._objFlags&=~d)}t._onPostActivated(!1),t._objFlags&=~d},activateNode:function(t,e){if(e){e=u.get();this._activatingStack.push(e),this._activateNodeRecursively(t,e.preload,e.onLoad,e.onEnable),e.preload.invoke(),e.onLoad.invoke(),e.onEnable.invoke(),this._activatingStack.pop(),u.put(e)}else{this._deactivateNodeRecursively(t);for(var i=this._activatingStack,n=0;n<i.length;n++){var r=i[n];r.preload.cancelInactive(s),r.onLoad.cancelInactive(a),r.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},activateComp:function(t,e,i,n){cc.isValid(t,!0)&&(t._objFlags&s||(t._objFlags|=s,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&a||(t._objFlags|=a,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=o):t._objFlags|=o),t._enabled)&&t.node._activeInHierarchy&&cc.director._compScheduler.enableComp(t,n)},destroyComp:function(t){cc.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&o&&t.onDestroy()},resetComp:!1});e.exports=t},{"./component-scheduler":114,"./platform/CCObject":236,"./platform/js":250,"./utils/misc":315}],203:[function(t,e,i){"use strict";var h=t("./CCPhysicsTypes").PTM_RATIO,c=t("./CCPhysicsTypes").ContactType,n=[],l=[cc.v2(),cc.v2()],u=new b2.WorldManifold,_={points:[],separations:[],normal:cc.v2()};function r(){this.localPoint=cc.v2(),this.normalImpulse=0,this.tangentImpulse=0}var d=[new r,new r],f=(new b2.Manifold,{type:0,localPoint:cc.v2(),localNormal:cc.v2(),points:[]}),s={normalImpulses:[],tangentImpulses:[]};function a(){}a.prototype.init=function(t){this.colliderA=t.GetFixtureA().collider,this.colliderB=t.GetFixtureB().collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,(this._b2contact=t)._contact=this},a.prototype.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact._contact=null,this._b2contact=null},a.prototype.getWorldManifold=function(){var t=_.points,e=_.separations,i=_.normal,n=(this._b2contact.GetWorldManifold(u),u.points),r=u.separations,s=this._b2contact.GetManifold().pointCount;t.length=e.length=s;for(var a=0;a<s;a++){var o=l[a];o.x=n[a].x*h,o.y=n[a].y*h,t[a]=o,e[a]=r[a]*h}return i.x=u.normal.x,i.y=u.normal.y,this._inverted&&(i.x*=-1,i.y*=-1),_},a.prototype.getManifold=function(){for(var t=f.points,e=f.localNormal,i=f.localPoint,n=this._b2contact.GetManifold(),r=n.points,s=t.length=n.pointCount,a=0;a<s;a++){var o=d[a],l=r[a];o.localPoint.x=l.localPoint.x*h,o.localPoint.Y=l.localPoint.Y*h,o.normalImpulse=l.normalImpulse*h,o.tangentImpulse=l.tangentImpulse,t[a]=o}return i.x=n.localPoint.x*h,i.y=n.localPoint.y*h,e.x=n.localNormal.x,e.y=n.localNormal.y,f.type=n.type,this._inverted&&(e.x*=-1,e.y*=-1),f},a.prototype.getImpulse=function(){var t=this._impulse;if(!t)return null;for(var e=s.normalImpulses,i=s.tangentImpulses,n=t.count,r=0;r<n;r++)e[r]=t.normalImpulses[r]*h,i[r]=t.tangentImpulses[r];return i.length=e.length=n,s},a.prototype.emit=function(t){var e;switch(t){case c.BEGIN_CONTACT:e="onBeginContact";break;case c.END_CONTACT:e="onEndContact";break;case c.PRE_SOLVE:e="onPreSolve";break;case c.POST_SOLVE:e="onPostSolve"}var i,n,r,s,a=this.colliderA,o=this.colliderB,t=a.body,l=o.body;if(t.enabledContactListener)for(i=t.node._components,this._inverted=!1,n=0,r=i.length;n<r;n++)(s=i[n])[e]&&s[e](this,a,o);if(l.enabledContactListener)for(i=l.node._components,this._inverted=!0,n=0,r=i.length;n<r;n++)(s=i[n])[e]&&s[e](this,o,a);(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},a.get=function(t){var e;return(e=0===n.length?new cc.PhysicsContact:n.pop()).init(t),e},a.put=function(t){t=t._contact;t&&(n.push(t),t.reset())};t=a.prototype;t.setEnabled=function(t){this._b2contact.SetEnabled(t)},t.isTouching=function(){return this._b2contact.IsTouching()},t.setTangentSpeed=function(t){this._b2contact.SetTangentSpeed(t/h)},t.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()*h},t.setFriction=function(t){this._b2contact.SetFriction(t)},t.getFriction=function(){return this._b2contact.GetFriction()},t.resetFriction=function(){return this._b2contact.ResetFriction()},t.setRestitution=function(t){this._b2contact.SetRestitution(t)},t.getRestitution=function(){return this._b2contact.GetRestitution()},t.resetRestitution=function(){return this._b2contact.ResetRestitution()},a.ContactType=c,cc.PhysicsContact=e.exports=a},{"./CCPhysicsTypes":205}],204:[function(t,e,i){"use strict";var n=t("./CCPhysicsTypes"),r=n.ContactType,o=n.BodyType,d=n.RayCastType,s=n.DrawBits,f=n.PTM_RATIO,l=(n.ANGLE_TO_PHYSICS_ANGLE,n.PHYSICS_ANGLE_TO_ANGLE),h=t("./utils").convertToNodeRotation,a=t("./platform/CCPhysicsDebugDraw"),c=new b2.AABB,p=new b2.Vec2,m=new b2.Vec2,u=cc.v2(),_=cc.Class({mixins:[cc.EventTarget],statics:{DrawBits:s,PTM_RATIO:f,VELOCITY_ITERATIONS:10,POSITION_ITERATIONS:10,FIXED_TIME_STEP:1/60,MAX_ACCUMULATOR:.2},ctor:function(){this._debugDrawFlags=0,this._debugDrawer=null,this._world=null,this._bodies=[],this._joints=[],this._contactMap={},this._contactID=0,this._delayEvents=[],this._accumulator=0,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.enabledAccumulator=!1},pushDelayEvent:function(t,e,i){this._steping?this._delayEvents.push({target:t,func:e,args:i}):t[e].apply(t,i)},update:function(t){var e=this._world;if(e&&this.enabled){this.emit("before-step"),this._steping=!0;var i=_.VELOCITY_ITERATIONS,n=_.POSITION_ITERATIONS;if(this.enabledAccumulator){this._accumulator+=t;var r=_.FIXED_TIME_STEP,t=_.MAX_ACCUMULATOR;for(this._accumulator>t&&(this._accumulator=t);this._accumulator>r;)e.Step(r,i,n),this._accumulator-=r}else{t=1/cc.game.config.frameRate;e.Step(t,i,n)}this.debugDrawFlags&&(this._checkDebugDrawValid(),this._debugDrawer.clear(),e.DrawDebugData()),this._steping=!1;for(var s=this._delayEvents,a=0,o=s.length;a<o;a++){var l=s[a];l.target[l.func].apply(l.target,l.args)}s.length=0,this._syncNode()}},testPoint:function(t){var e=p.x=t.x/f,t=p.y=t.y/f,i=.2/f,e=(c.lowerBound.x=e-i,c.lowerBound.y=t-i,c.upperBound.x=e+i,c.upperBound.y=t+i,this._aabbQueryCallback),t=(e.init(p),this._world.QueryAABB(e,c),e.getFixture());return t?t.collider:null},testAABB:function(t){c.lowerBound.x=t.xMin/f,c.lowerBound.y=t.yMin/f,c.upperBound.x=t.xMax/f,c.upperBound.y=t.yMax/f;t=this._aabbQueryCallback;return t.init(),this._world.QueryAABB(t,c),t.getFixtures().map(function(t){return t.collider})},rayCast:function(t,e,i){if(!t.equals(e)){i=i||d.Closest,p.x=t.x/f,p.y=t.y/f,m.x=e.x/f,m.y=e.y/f;var t=this._raycastQueryCallback,n=(t.init(i),this._world.RayCast(t,p,m),t.getFixtures());if(0<n.length){for(var r=t.getPoints(),s=t.getNormals(),a=t.getFractions(),o=[],l=0,h=n.length;l<h;l++){var c=n[l],u=c.collider;if(i===d.AllClosest){var _=o.find(function(t){return t.collider===u});if(_){a[l]<_.fraction&&(_.fixtureIndex=u._getFixtureIndex(c),_.point.x=r[l].x*f,_.point.y=r[l].y*f,_.normal.x=s[l].x,_.normal.y=s[l].y,_.fraction=a[l]);continue}}o.push({collider:u,fixtureIndex:u._getFixtureIndex(c),point:cc.v2(r[l].x*f,r[l].y*f),normal:cc.v2(s[l]),fraction:a[l]})}return o}}return[]},syncPosition:function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncPosition()},syncRotation:function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncRotation()},_registerContactFixture:function(t){this._contactListener.registerContactFixture(t)},_unregisterContactFixture:function(t){this._contactListener.unregisterContactFixture(t)},_addBody:function(t,e){var i=this._world,n=t.node;i&&n&&(t._b2Body=i.CreateBody(e),t._b2Body.body=t,this._bodies.push(t))},_removeBody:function(t){var e=this._world;e&&(t._b2Body.body=null,e.DestroyBody(t._b2Body),t._b2Body=null,cc.js.array.remove(this._bodies,t))},_addJoint:function(t,e){e=this._world.CreateJoint(e);e&&((e._joint=t)._joint=e,this._joints.push(t))},_removeJoint:function(t){t._isValid()&&this._world.DestroyJoint(t._joint),t._joint&&(t._joint._joint=null),cc.js.array.remove(this._joints,t)},_initCallback:function(){var t;this._world?this._contactListener||((t=new cc.PhysicsContactListener).setBeginContact(this._onBeginContact),t.setEndContact(this._onEndContact),t.setPreSolve(this._onPreSolve),t.setPostSolve(this._onPostSolve),this._world.SetContactListener(t),this._contactListener=t,this._aabbQueryCallback=new cc.PhysicsAABBQueryCallback,this._raycastQueryCallback=new cc.PhysicsRayCastCallback):cc.warn("Please init PhysicsManager first")},_init:function(){this.enabled=!0,this.debugDrawFlags=s.e_shapeBit},_getWorld:function(){return this._world},_syncNode:function(){for(var t=this._bodies,e=0,i=t.length;e<i;e++){var n=t[e],r=n.node,s=n._b2Body,a=s.GetPosition(),a=(u.x=a.x*f,u.y=a.y*f,s.GetAngle()*l),s=(null!==r.parent.parent&&(u=r.parent.convertToNodeSpaceAR(u),a=h(r.parent,a)),r._eventMask);r._eventMask=0,r.position=u,r.angle=-a,r._eventMask=s,n.type===o.Animated&&n.resetVelocity()}},_onBeginContact:function(t){cc.PhysicsContact.get(t).emit(r.BEGIN_CONTACT)},_onEndContact:function(t){var e=t._contact;e&&(e.emit(r.END_CONTACT),cc.PhysicsContact.put(t))},_onPreSolve:function(t){t=t._contact;t&&t.emit(r.PRE_SOLVE)},_onPostSolve:function(t,e){t=t._contact;t&&(t._impulse=e,t.emit(r.POST_SOLVE),t._impulse=null)},_checkDebugDrawValid:function(){var t;this._debugDrawer&&this._debugDrawer.isValid||((t=new cc.Node("PHYSICS_MANAGER_DEBUG_DRAW")).zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(t),this._debugDrawer=t.addComponent(cc.Graphics),(t=new a(this._debugDrawer)).SetFlags(this.debugDrawFlags),this._world.SetDebugDraw(t))}});cc.js.getset(_.prototype,"enabled",function(){return this._enabled},function(t){var e;t&&!this._world&&((e=new b2.World(new b2.Vec2(0,-10))).SetAllowSleeping(!0),this._world=e,this._initCallback()),this._enabled=t}),cc.js.getset(_.prototype,"debugDrawFlags",function(){return this._debugDrawFlags},function(t){t&&!this._debugDrawFlags?this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!0):!t&&this._debugDrawFlags&&this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!1),t&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(t)),(this._debugDrawFlags=t)&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(t))}),cc.js.getset(_.prototype,"gravity",function(){var t;return this._world?(t=this._world.GetGravity(),cc.v2(t.x*f,t.y*f)):cc.v2()},function(t){this._world&&this._world.SetGravity(new b2.Vec2(t.x/f,t.y/f))}),cc.PhysicsManager=e.exports=_},{"./CCPhysicsTypes":205,"./platform/CCPhysicsDebugDraw":226,"./utils":228}],205:[function(t,e,i){"use strict";var n=cc.Enum({Static:0,Kinematic:1,Dynamic:2,Animated:3}),r=(cc.RigidBodyType=n,cc.Enum({Closest:0,Any:1,AllClosest:2,All:3}));cc.RayCastType=r,e.exports={BodyType:n,ContactType:{BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"},RayCastType:r,DrawBits:b2.DrawFlags,PTM_RATIO:32,ANGLE_TO_PHYSICS_ANGLE:-Math.PI/180,PHYSICS_ANGLE_TO_ANGLE:-180/Math.PI}},{}],206:[function(t,e,i){"use strict";function v(t,e){var i=e.length;return e[t<0?i- -t%i:t%i]}function b(t,e,i){for(var n=[];e<t;)e+=i.length;for(;t<=e;++t)n.push(v(t,i));return n}function x(t,e,i){if(A(t,i)){if(S(v(t,i),v(t-1,i),v(e,i))&&w(v(t,i),v(t+1,i),v(e,i)))return}else if(w(v(t,i),v(t+1,i),v(e,i))||S(v(t,i),v(t-1,i),v(e,i)))return;if(A(e,i)){if(S(v(e,i),v(e-1,i),v(t,i))&&w(v(e,i),v(e+1,i),v(t,i)))return}else if(w(v(e,i),v(e+1,i),v(t,i))||S(v(e,i),v(e-1,i),v(t,i)))return;for(var n=0;n<i.length;++n)if((n+1)%i.length!=t&&n!=t&&(n+1)%i.length!=e&&n!=e){var r=cc.v2();if(function(t,e,i,n,r){if(t==i||t==n||e==i||e==n)return;var s=t.x,t=t.y,a=e.x,e=e.y,o=i.x,i=i.y,l=n.x,n=n.y;if(Math.max(s,a)<Math.min(o,l)||Math.max(o,l)<Math.min(s,a))return;if(Math.max(t,e)<Math.min(i,n)||Math.max(i,n)<Math.min(t,e))return;var h=(l-o)*(t-i)-(n-i)*(s-o),c=(a-s)*(t-i)-(e-t)*(s-o),n=(n-i)*(a-s)-(l-o)*(e-t);return!(Math.abs(n)<1e-6)&&(c/=n,0<(h/=n)&&h<1&&0<c&&c<1&&(r.x=s+h*(a-s),r.y=t+h*(e-t),1))}(v(t,i),v(e,i),v(n,i),v(n+1,i),r))return}return 1}function A(t,e){return C(t,e)}function C(t,e,i){var n,r;return void 0===i&&(t=v((n=t)-1,r=e),e=v(n,r),i=v(n+1,r)),s(t,e,i)<0}function T(t,e,i){return 0<s(t,e,i)}function S(t,e,i){return 0<=s(t,e,i)}function w(t,e,i){return s(t,e,i)<=0}function E(t,e){var i=e.x-t.x,e=e.y-t.y;return i*i+e*e}function M(t){n(t)||t.reverse()}function n(t){return t.length<3||0<function(t){var e,i=0;for(e=0;e<t.length;e++){var n=(e+1)%t.length;i=(i+=t[e].x*t[n].y)-t[e].y*t[n].x}return i/=2}(t)}function D(t,e,i,n){var r,s=cc.v2(),a=e.y-t.y,e=t.x-e.x,t=a*t.x+e*t.y,o=n.y-i.y,n=i.x-n.x,i=o*i.x+n*i.y,l=a*n-o*e;return r=0,Math.abs(l-r)<=1e-6||(s.x=(n*t-e*i)/l,s.y=(a*i-o*t)/l),s}function s(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)}e.exports={ConvexPartition:function t(e){M(e);for(var i,n,r,s,a,o=[],l=cc.v2(),h=cc.v2(),c=0,u=0,_=0;_<e.length;++_)if(A(_,e)){for(var d=n=1e8,f=0;f<e.length;++f)T(v(_-1,e),v(_,e),v(f,e))&&w(v(_-1,e),v(_,e),v(f-1,e))&&(r=D(v(_-1,e),v(_,e),v(f,e),v(f-1,e)),C(v(_+1,e),v(_,e),r)&&(i=E(v(_,e),r))<d&&(d=i,l=r,c=f)),T(v(_+1,e),v(_,e),v(f+1,e))&&w(v(_+1,e),v(_,e),v(f,e))&&(r=D(v(_+1,e),v(_,e),v(f,e),v(f+1,e)),T(v(_-1,e),v(_,e),r)&&(i=E(v(_,e),r))<n&&(n=i,u=f,h=r));if(c==(u+1)%e.length){var p=l.add(h).div(2);(s=b(_,u,e)).push(p),(a=b(c,_,e)).push(p)}else{for(var m,y=0,g=c;u<c;)u+=e.length;for(f=c;f<=u;++f)x(_,f,e)&&(m=1/(E(v(_,e),v(f,e))+1),A(f,e)?w(v(f-1,e),v(f,e),v(_,e))&&S(v(f+1,e),v(f,e),v(_,e))?m+=3:m+=2:m+=1,y<m&&(g=f,y=m));s=b(_,g,e),a=b(g,_,e)}return(o=o.concat(t(s))).concat(t(a))}for(o.push(e),_=o.length-1;0<=_;_--)0==o[_].length&&o.splice(_,0);return o},ForceCounterClockWise:M,IsCounterClockWise:n}},{}],207:[function(t,e,i){"use strict";var n=t("../CCNode").EventType,r=t("./CCPhysicsTypes").PTM_RATIO,s=t("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,a=t("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,o=t("./utils").getWorldRotation,l=t("./CCPhysicsTypes").BodyType,h=new b2.Vec2,c=new b2.Vec2,u=cc.Vec2.ZERO,t=cc.Class({name:"cc.RigidBody",extends:cc.Component,editor:!1,properties:{_type:l.Dynamic,_allowSleep:!0,_gravityScale:1,_linearDamping:0,_angularDamping:0,_linearVelocity:cc.v2(0,0),_angularVelocity:0,_fixedRotation:!1,enabled:{get:function(){return this._enabled},set:function(){cc.warnID(8200)},visible:!1,override:!0},enabledContactListener:{default:!1,tooltip:!1},bullet:{default:!1,tooltip:!1},type:{type:l,tooltip:!1,get:function(){return this._type},set:function(t){this._type=t,this._b2Body&&(t===l.Animated?this._b2Body.SetType(l.Kinematic):this._b2Body.SetType(t))}},allowSleep:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.IsSleepingAllowed():this._allowSleep},set:function(t){this._allowSleep=t,this._b2Body&&this._b2Body.SetSleepingAllowed(t)}},gravityScale:{tooltip:!1,get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._b2Body&&this._b2Body.SetGravityScale(t)}},linearDamping:{tooltip:!1,get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._b2Body&&this._b2Body.SetLinearDamping(this._linearDamping)}},angularDamping:{tooltip:!1,get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._b2Body&&this._b2Body.SetAngularDamping(t)}},linearVelocity:{tooltip:!1,type:cc.Vec2,get:function(){var t,e=this._linearVelocity;return this._b2Body&&(t=this._b2Body.GetLinearVelocity(),e.x=t.x*r,e.y=t.y*r),e},set:function(t){this._linearVelocity=t;var e,i=this._b2Body;i&&((e=i.m_linearVelocity).Set(t.x/r,t.y/r),i.SetLinearVelocity(e))}},angularVelocity:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.GetAngularVelocity()*a:this._angularVelocity},set:function(t){this._angularVelocity=t,this._b2Body&&this._b2Body.SetAngularVelocity(t*s)}},fixedRotation:{tooltip:!1,get:function(){return this._fixedRotation},set:function(t){this._fixedRotation=t,this._b2Body&&this._b2Body.SetFixedRotation(t)}},awake:{visible:!1,tooltip:!1,get:function(){return!!this._b2Body&&this._b2Body.IsAwake()},set:function(t){this._b2Body&&this._b2Body.SetAwake(t)}},awakeOnLoad:{default:!0,tooltip:!1,animatable:!1},active:{visible:!1,get:function(){return!!this._b2Body&&this._b2Body.IsActive()},set:function(t){this._b2Body&&this._b2Body.SetActive(t)}}},getLocalPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(h.Set(t.x/r,t.y/r),t=this._b2Body.GetLocalPoint(h,e),e.x=t.x*r,e.y=t.y*r),e},getWorldPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(h.Set(t.x/r,t.y/r),t=this._b2Body.GetWorldPoint(h,e),e.x=t.x*r,e.y=t.y*r),e},getWorldVector:function(t,e){return e=e||cc.v2(),this._b2Body&&(h.Set(t.x/r,t.y/r),t=this._b2Body.GetWorldVector(h,e),e.x=t.x*r,e.y=t.y*r),e},getLocalVector:function(t,e){return e=e||cc.v2(),this._b2Body&&(h.Set(t.x/r,t.y/r),t=this._b2Body.GetLocalVector(h,e),e.x=t.x*r,e.y=t.y*r),e},getWorldPosition:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetPosition(),t.x=e.x*r,t.y=e.y*r),t},getWorldRotation:function(){return this._b2Body?this._b2Body.GetAngle()*a:0},getLocalCenter:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetLocalCenter(),t.x=e.x*r,t.y=e.y*r),t},getWorldCenter:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetWorldCenter(),t.x=e.x*r,t.y=e.y*r),t},getLinearVelocityFromWorldPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(h.Set(t.x/r,t.y/r),t=this._b2Body.GetLinearVelocityFromWorldPoint(h,e),e.x=t.x*r,e.y=t.y*r),e},getMass:function(){return this._b2Body?this._b2Body.GetMass():0},getInertia:function(){return this._b2Body?this._b2Body.GetInertia()*r*r:0},getJointList:function(){if(!this._b2Body)return[];var t=[],e=this._b2Body.GetJointList();if(!e)return[];t.push(e.joint._joint);for(var i=e.prev;i;)t.push(i.joint._joint),i=i.prev;for(var n=e.next;n;)t.push(n.joint._joint),n=n.next;return t},applyForce:function(t,e,i){this._b2Body&&(h.Set(t.x/r,t.y/r),c.Set(e.x/r,e.y/r),this._b2Body.ApplyForce(h,c,i))},applyForceToCenter:function(t,e){this._b2Body&&(h.Set(t.x/r,t.y/r),this._b2Body.ApplyForceToCenter(h,e))},applyTorque:function(t,e){this._b2Body&&this._b2Body.ApplyTorque(t/r,e)},applyLinearImpulse:function(t,e,i){this._b2Body&&(h.Set(t.x/r,t.y/r),c.Set(e.x/r,e.y/r),this._b2Body.ApplyLinearImpulse(h,c,i))},applyAngularImpulse:function(t,e){this._b2Body&&this._b2Body.ApplyAngularImpulse(t/r/r,e)},syncPosition:function(t){var e,i,n=this._b2Body;n&&(i=this.node.convertToWorldSpaceAR(u),(e=this.type===l.Animated?n.GetLinearVelocity():n.GetPosition()).x=i.x/r,e.y=i.y/r,this.type===l.Animated&&t?(i=n.GetPosition(),t=cc.game.config.frameRate,e.x=(e.x-i.x)*t,e.y=(e.y-i.y)*t,n.SetAwake(!0),n.SetLinearVelocity(e)):n.SetTransformVec(e,n.GetAngle()))},syncRotation:function(t){var e,i,n=this._b2Body;n&&(e=s*o(this.node),this.type===l.Animated&&t?(t=n.GetAngle(),i=cc.game.config.frameRate,n.SetAwake(!0),n.SetAngularVelocity((e-t)*i)):n.SetTransformVec(n.GetPosition(),e))},resetVelocity:function(){var t,e=this._b2Body;e&&((t=e.m_linearVelocity).Set(0,0),e.SetLinearVelocity(t),e.SetAngularVelocity(0))},onEnable:function(){this._init()},onDisable:function(){this._destroy()},_registerNodeEvents:function(){var t=this.node;t.on(n.POSITION_CHANGED,this._onNodePositionChanged,this),t.on(n.ROTATION_CHANGED,this._onNodeRotationChanged,this),t.on(n.SCALE_CHANGED,this._onNodeScaleChanged,this)},_unregisterNodeEvents:function(){var t=this.node;t.off(n.POSITION_CHANGED,this._onNodePositionChanged,this),t.off(n.ROTATION_CHANGED,this._onNodeRotationChanged,this),t.off(n.SCALE_CHANGED,this._onNodeScaleChanged,this)},_onNodePositionChanged:function(){this.syncPosition(!0)},_onNodeRotationChanged:function(t){this.syncRotation(!0)},_onNodeScaleChanged:function(t){if(this._b2Body)for(var e=this.getComponents(cc.PhysicsCollider),i=0;i<e.length;i++)e[i].apply()},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){var t,e,i;this._inited||(this._registerNodeEvents(),t=new b2.BodyDef,this.type===l.Animated?t.type=l.Kinematic:t.type=this.type,t.allowSleep=this.allowSleep,t.gravityScale=this.gravityScale,t.linearDamping=this.linearDamping,t.angularDamping=this.angularDamping,e=this.linearVelocity,t.linearVelocity=new b2.Vec2(e.x/r,e.y/r),t.angularVelocity=this.angularVelocity*s,t.fixedRotation=this.fixedRotation,t.bullet=this.bullet,i=(e=this.node).convertToWorldSpaceAR(u),t.position=new b2.Vec2(i.x/r,i.y/r),t.angle=-Math.PI/180*o(e),t.awake=this.awakeOnLoad,cc.director.getPhysicsManager()._addBody(this,t),this._inited=!0)},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeBody(this),this._unregisterNodeEvents(),this._inited=!1)},_getBody:function(){return this._b2Body}});cc.RigidBody=e.exports=t},{"../CCNode":72,"./CCPhysicsTypes":205,"./utils":228}],208:[function(t,e,i){"use strict";var n,r,s=t("../../../external/box2d/box2d");for(n in window.b2={},s)-1===n.indexOf("b2_")&&(r=n.replace("b2",""),b2[r]=s[n]);b2.maxPolygonVertices=8},{"../../../external/box2d/box2d":426}],209:[function(t,e,i){"use strict";var s=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.PhysicsBoxCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Box],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x),t=Math.abs(t.y),i=this.size.width/2/s*e,n=this.size.height/2/s*t,e=this.offset.x/s*e,t=this.offset.y/s*t,r=new b2.PolygonShape;return r.SetAsBox(i,n,new b2.Vec2(e,t),0),r}});cc.PhysicsBoxCollider=e.exports=t},{"../CCPhysicsTypes":205}],210:[function(t,e,i){"use strict";var a=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.PhysicsChainCollider",extends:cc.PhysicsCollider,editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},properties:{loop:!1,points:{default:function(){return[cc.v2(-50,0),cc.v2(50,0)]},type:[cc.Vec2]},threshold:{default:1,serializable:!1,visible:!1}},_createShape:function(t){for(var e=new b2.ChainShape,i=this.points,n=[],r=0;r<i.length;r++){var s=i[r];n.push(new b2.Vec2(s.x/a*t.x,s.y/a*t.y))}return this.loop?e.CreateLoop(n,n.length):e.CreateChain(n,n.length),e},resetInEditor:!1,resetPointsByContour:!1});cc.PhysicsChainCollider=e.exports=t},{"../CCPhysicsTypes":205}],211:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.PhysicsCircleCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Circle],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x),t=Math.abs(t.y),i=this.offset.x/r*e,t=this.offset.y/r*t,n=new b2.CircleShape;return n.m_radius=this.radius/r*e,n.m_p=new b2.Vec2(i,t),n}});cc.PhysicsCircleCollider=e.exports=t},{"../CCPhysicsTypes":205}],212:[function(t,e,i){"use strict";var u=t("../CCPhysicsTypes").PTM_RATIO,d=t("../utils").getWorldScale,t=cc.Class({name:"cc.PhysicsCollider",extends:cc.Collider,ctor:function(){this._fixtures=[],this._shapes=[],this._inited=!1,this._rect=cc.rect()},properties:{_density:1,_sensor:!1,_friction:.2,_restitution:0,density:{tooltip:!1,get:function(){return this._density},set:function(t){this._density=t}},sensor:{tooltip:!1,get:function(){return this._sensor},set:function(t){this._sensor=t}},friction:{tooltip:!1,get:function(){return this._friction},set:function(t){this._friction=t}},restitution:{tooltip:!1,get:function(){return this._restitution},set:function(t){this._restitution=t}},body:{default:null,type:cc.RigidBody,visible:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},_getFixtureIndex:function(t){return this._fixtures.indexOf(t)},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited){var t=this.body||this.getComponent(cc.RigidBody);if(t){var e=t._getBody();if(e){var i=t.node,n=d(i),r=0===(this._scale=n).x&&0===n.y?[]:this._createShape(n);r instanceof Array||(r=[r]);for(var n=1<<i.groupIndex,s=0,a=cc.game.collisionMatrix[i.groupIndex],o=0;o<a.length;o++)a[o]&&(s|=1<<o);for(var l={categoryBits:n,maskBits:s,groupIndex:0},h=cc.director.getPhysicsManager(),c=0;c<r.length;c++){var u=r[c],_=new b2.FixtureDef,_=(_.density=this.density,_.isSensor=this.sensor,_.friction=this.friction,_.restitution=this.restitution,_.shape=u,_.filter=l,e.CreateFixture(_));_.collider=this,t.enabledContactListener&&h._registerContactFixture(_),this._shapes.push(u),this._fixtures.push(_)}this.body=t,this._inited=!0}}}},__destroy:function(){if(this._inited){for(var t=this._fixtures,e=this.body._getBody(),i=cc.director.getPhysicsManager(),n=t.length-1;0<=n;n--){var r=t[n];r.collider=null,i._unregisterContactFixture(r),e&&e.DestroyFixture(r)}this.body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},_createShape:function(){},apply:function(){this._destroy(),this._init()},getAABB:function(){for(var t=1e7,e=1e7,i=-1e7,n=-1e7,r=this._fixtures,s=0;s<r.length;s++)for(var a=r[s],o=a.GetShape().GetChildCount(),l=0;l<o;l++){var h=a.GetAABB(l);h.lowerBound.x<t&&(t=h.lowerBound.x),h.lowerBound.y<e&&(e=h.lowerBound.y),h.upperBound.x>i&&(i=h.upperBound.x),h.upperBound.y>n&&(n=h.upperBound.y)}e*=u,i*=u,n*=u;var c=this._rect;return c.x=t*=u,c.y=e,c.width=i-t,c.height=n-e,c}});cc.PhysicsCollider=e.exports=t},{"../CCPhysicsTypes":205,"../utils":228}],213:[function(t,e,i){"use strict";var f=t("../CCPhysicsTypes").PTM_RATIO,p=t("../CCPolygonSeparator"),t=cc.Class({name:"cc.PhysicsPolygonCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Polygon],editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=[],i=this.points;0<i.length&&i[0].equals(i[i.length-1])&&--i.length;for(var n=p.ConvexPartition(i),r=this.offset,s=0;s<n.length;s++){for(var a=n[s],o=null,l=[],h=null,c=0,u=a.length;c<u;c++){var o=o||new b2.PolygonShape,_=a[c],d=(_.x+r.x)/f*t.x,_=(_.y+r.y)/f*t.y,d=new b2.Vec2(d,_);l.push(d),h=h||d,l.length===b2.maxPolygonVertices&&(o.Set(l,l.length),e.push(o),o=null,c<u-1&&(l=[h,l[l.length-1]]))}o&&(o.Set(l,l.length),e.push(o))}return e}});cc.PhysicsPolygonCollider=e.exports=t},{"../CCPhysicsTypes":205,"../CCPolygonSeparator":206}],214:[function(t,e,i){"use strict";t("./box2d-adapter"),t("./CCPhysicsManager"),t("./CCRigidBody"),t("./CCPhysicsContact"),t("./collider/CCPhysicsCollider"),t("./collider/CCPhysicsChainCollider"),t("./collider/CCPhysicsCircleCollider"),t("./collider/CCPhysicsBoxCollider"),t("./collider/CCPhysicsPolygonCollider"),t("./joint/CCJoint"),t("./joint/CCDistanceJoint"),t("./joint/CCRevoluteJoint"),t("./joint/CCMouseJoint"),t("./joint/CCMotorJoint"),t("./joint/CCPrismaticJoint"),t("./joint/CCWeldJoint"),t("./joint/CCWheelJoint"),t("./joint/CCRopeJoint"),t("./platform/CCPhysicsContactListner"),t("./platform/CCPhysicsAABBQueryCallback"),t("./platform/CCPhysicsRayCastCallback")},{"./CCPhysicsContact":203,"./CCPhysicsManager":204,"./CCRigidBody":207,"./box2d-adapter":208,"./collider/CCPhysicsBoxCollider":209,"./collider/CCPhysicsChainCollider":210,"./collider/CCPhysicsCircleCollider":211,"./collider/CCPhysicsCollider":212,"./collider/CCPhysicsPolygonCollider":213,"./joint/CCDistanceJoint":215,"./joint/CCJoint":216,"./joint/CCMotorJoint":217,"./joint/CCMouseJoint":218,"./joint/CCPrismaticJoint":219,"./joint/CCRevoluteJoint":220,"./joint/CCRopeJoint":221,"./joint/CCWeldJoint":222,"./joint/CCWheelJoint":223,"./platform/CCPhysicsAABBQueryCallback":224,"./platform/CCPhysicsContactListner":225,"./platform/CCPhysicsRayCastCallback":227}],215:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.DistanceJoint",extends:cc.Joint,editor:!1,properties:{_distance:1,_frequency:0,_dampingRatio:0,distance:{tooltip:!1,get:function(){return this._distance},set:function(t){this._distance=t,this._joint&&this._joint.SetLength(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.DistanceJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.length=this.distance/n,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.DistanceJoint=e.exports=t},{"../CCPhysicsTypes":205}],216:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.Joint",extends:cc.Component,editor:{requireComponent:cc.RigidBody},properties:{anchor:{default:cc.v2(0,0),tooltip:!1},connectedAnchor:{default:cc.v2(0,0),tooltip:!1},connectedBody:{default:null,type:cc.RigidBody,tooltip:!1},collideConnected:{default:!1,tooltip:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},apply:function(){this._destroy(),this._init()},getWorldAnchor:function(){var t;return this._joint?(t=this._joint.GetAnchorA(),cc.v2(t.x*n,t.y*n)):cc.Vec2.ZERO},getWorldConnectedAnchor:function(){var t;return this._joint?(t=this._joint.GetAnchorB(),cc.v2(t.x*n,t.y*n)):cc.Vec2.ZERO},getReactionForce:function(t){var e=cc.v2();return this._joint?this._joint.GetReactionForce(t,e):e},getReactionTorque:function(t){return this._joint?this._joint.GetReactionTorque(t):0},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){var t;!this._inited&&(this.body=this.getComponent(cc.RigidBody),this._isValid())&&(t=this._createJointDef())&&(t.bodyA=this.body._getBody(),t.bodyB=this.connectedBody._getBody(),t.collideConnected=this.collideConnected,cc.director.getPhysicsManager()._addJoint(this,t),this._inited=!0)},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeJoint(this),this._joint=null,this._inited=!1)},_createJointDef:function(){return null},_isValid:function(){return this.body&&this.body._getBody()&&this.connectedBody&&this.connectedBody._getBody()}});cc.Joint=e.exports=t},{"../CCPhysicsTypes":205}],217:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t=cc.Class({name:"cc.MotorJoint",extends:cc.Joint,editor:!1,properties:{_linearOffset:cc.v2(0,0),_angularOffset:0,_maxForce:1,_maxTorque:1,_correctionFactor:.3,anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},linearOffset:{tooltip:!1,get:function(){return this._linearOffset},set:function(t){this._linearOffset=t,this._joint&&this._joint.SetLinearOffset(new b2.Vec2(t.x/n,t.y/n))}},angularOffset:{tooltip:!1,get:function(){return this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.SetAngularOffset(t)}},maxForce:{tooltip:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}},maxTorque:{tooltip:!1,get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.SetMaxTorque(t)}},correctionFactor:{tooltip:!1,get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.SetCorrectionFactor(t)}}},_createJointDef:function(){var t=new b2.MotorJointDef;return t.linearOffset=new b2.Vec2(this.linearOffset.x/n,this.linearOffset.y/n),t.angularOffset=this.angularOffset*r,t.maxForce=this.maxForce,t.maxTorque=this.maxTorque,t.correctionFactor=this.correctionFactor,t}});cc.MotorJoint=e.exports=t},{"../CCPhysicsTypes":205}],218:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=new b2.Vec2,t=cc.Class({name:"cc.MouseJoint",extends:cc.Joint,editor:!1,properties:{_target:1,_frequency:5,_dampingRatio:.7,_maxForce:0,connectedBody:{default:null,type:cc.RigidBody,visible:!1,override:!0},collideConnected:{default:!0,visible:!1,override:!0},anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},mouseRegion:{tooltip:!1,default:null,type:cc.Node},target:{tooltip:!1,visible:!1,get:function(){return this._target},set:function(t){this._target=t,this._joint&&(r.x=t.x/n,r.y=t.y/n,this._joint.SetTarget(r))}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}},maxForce:{tooltip:!1,visible:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}}},onLoad:function(){var t=this.mouseRegion||this.node;t.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),t.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},onEnable:function(){},start:function(){},onTouchBegan:function(t){var e=cc.director.getPhysicsManager(),t=this._pressPoint=t.touch.getLocation(),e=(cc.Camera&&cc.Camera.main&&(t=cc.Camera.main.getScreenToWorldPoint(t)),e.testPoint(t));e&&((this.connectedBody=e.body).awake=!0,this.maxForce=1e3*this.connectedBody.getMass(),this.target=t,this._init())},onTouchMove:function(t){this._pressPoint=t.touch.getLocation()},onTouchEnd:function(t){this._destroy(),this._pressPoint=null},_createJointDef:function(){var t=new b2.MouseJointDef;return r.x=this.target.x/n,r.y=this.target.y/n,t.target=r,t.maxForce=this.maxForce,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t},update:function(){var t;this._pressPoint&&this._isValid()&&(t=cc.Camera.findCamera(this.node),this.target=t?t.getScreenToWorldPoint(this._pressPoint):this._pressPoint)}});cc.MouseJoint=e.exports=t},{"../CCPhysicsTypes":205}],219:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t=cc.Class({name:"cc.PrismaticJoint",extends:cc.Joint,editor:!1,properties:{localAxisA:{default:cc.v2(1,0),tooltip:!1},referenceAngle:{default:0,tooltip:!1},enableLimit:{default:!1,tooltip:!1},enableMotor:{default:!1,tooltip:!1},lowerLimit:{default:0,tooltip:!1},upperLimit:{default:0,tooltip:!1},_maxMotorForce:0,_motorSpeed:0,maxMotorForce:{tooltip:!1,get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.SetMaxMotorForce(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t)}}},_createJointDef:function(){var t=new b2.PrismaticJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.referenceAngle=this.referenceAngle*r,t.enableLimit=this.enableLimit,t.lowerTranslation=this.lowerLimit/n,t.upperTranslation=this.upperLimit/n,t.enableMotor=this.enableMotor,t.maxMotorForce=this.maxMotorForce,t.motorSpeed=this.motorSpeed,t}});cc.PrismaticJoint=e.exports=t},{"../CCPhysicsTypes":205}],220:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=t("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,t=cc.Class({name:"cc.RevoluteJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableLimit:!1,_enableMotor:!1,referenceAngle:{default:0,tooltip:!1},lowerAngle:{default:0,tooltip:!1},upperAngle:{default:0,tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*r)}},enableLimit:{tooltip:!1,get:function(){return this._enableLimit},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}}},getJointAngle:function(){return this._joint?this._joint.GetJointAngle()*s:0},setLimits:function(t,e){if(this._joint)return this._joint.SetLimits(t*r,e*r)},_createJointDef:function(){var t=new b2.RevoluteJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.lowerAngle=this.upperAngle*r,t.upperAngle=this.lowerAngle*r,t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*r,t.enableLimit=this.enableLimit,t.enableMotor=this.enableMotor,t.referenceAngle=this.referenceAngle*r,t}});cc.RevoluteJoint=e.exports=t},{"../CCPhysicsTypes":205}],221:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.RopeJoint",extends:cc.Joint,editor:!1,properties:{_maxLength:1,maxLength:{tooltip:!1,get:function(){return this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.SetMaxLength(t)}}},_createJointDef:function(){var t=new b2.RopeJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.maxLength=this.maxLength/n,t}});cc.RopeJoint=e.exports=t},{"../CCPhysicsTypes":205}],222:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t=cc.Class({name:"cc.WeldJoint",extends:cc.Joint,editor:!1,properties:{referenceAngle:{default:0,tooltip:!1},_frequency:0,_dampingRatio:0,frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WeldJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.referenceAngle=this.referenceAngle*r,t.frequencyHz=this.frequency,t.dampingRatio=this.dampingRatio,t}});cc.WeldJoint=e.exports=t},{"../CCPhysicsTypes":205}],223:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t=cc.Class({name:"cc.WheelJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableMotor:!1,_frequency:2,_dampingRatio:.7,localAxisA:{default:cc.v2(1,0),tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*r)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetSpringFrequencyHz(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WheelJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*r,t.enableMotor=this.enableMotor,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.WheelJoint=e.exports=t},{"../CCPhysicsTypes":205}],224:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").BodyType;function r(){this._point=new b2.Vec2,this._isPoint=!1,this._fixtures=[]}r.prototype.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},r.prototype.ReportFixture=function(t){if(t.GetBody().GetType()===n.Dynamic)if(this._isPoint){if(t.TestPoint(this._point))return this._fixtures.push(t),!1}else this._fixtures.push(t);return!0},r.prototype.getFixture=function(){return this._fixtures[0]},r.prototype.getFixtures=function(){return this._fixtures},cc.PhysicsAABBQueryCallback=e.exports=r},{"../CCPhysicsTypes":205}],225:[function(t,e,i){"use strict";function n(){this._contactFixtures=[]}n.prototype.setBeginContact=function(t){this._BeginContact=t},n.prototype.setEndContact=function(t){this._EndContact=t},n.prototype.setPreSolve=function(t){this._PreSolve=t},n.prototype.setPostSolve=function(t){this._PostSolve=t},n.prototype.BeginContact=function(t){var e,i,n;this._BeginContact&&(e=t.GetFixtureA(),i=t.GetFixtureB(),n=this._contactFixtures,t._shouldReport=!1,-1===n.indexOf(e)&&-1===n.indexOf(i)||(t._shouldReport=!0,this._BeginContact(t)))},n.prototype.EndContact=function(t){this._EndContact&&t._shouldReport&&(t._shouldReport=!1,this._EndContact(t))},n.prototype.PreSolve=function(t,e){this._PreSolve&&t._shouldReport&&this._PreSolve(t,e)},n.prototype.PostSolve=function(t,e){this._PostSolve&&t._shouldReport&&this._PostSolve(t,e)},n.prototype.registerContactFixture=function(t){this._contactFixtures.push(t)},n.prototype.unregisterContactFixture=function(t){cc.js.array.remove(this._contactFixtures,t)},cc.PhysicsContactListener=e.exports=n},{}],226:[function(t,e,i){"use strict";var a=t("../CCPhysicsTypes").PTM_RATIO,o=cc.v2(),n=cc.Color.GREEN,r=cc.Color.RED;function s(t){b2.Draw.call(this),this._drawer=t,this._xf=this._dxf=new b2.Transform}cc.js.extend(s,b2.Draw),cc.js.mixin(s.prototype,{_DrawPolygon:function(t,e){for(var i=this._drawer,n=0;n<e;n++){b2.Transform.MulXV(this._xf,t[n],o);var r=o.x*a,s=o.y*a;0===n?i.moveTo(r,s):i.lineTo(r,s)}i.close()},DrawPolygon:function(t,e,i){this._applyStrokeColor(i),this._DrawPolygon(t,e),this._drawer.stroke()},DrawSolidPolygon:function(t,e,i){this._applyFillColor(i),this._DrawPolygon(t,e),this._drawer.fill(),this._drawer.stroke()},_DrawCircle:function(t,e){var i=this._xf.p;this._drawer.circle((t.x+i.x)*a,(t.y+i.y)*a,e*a)},DrawCircle:function(t,e,i){this._applyStrokeColor(i),this._DrawCircle(t,e),this._drawer.stroke()},DrawSolidCircle:function(t,e,i,n){this._applyFillColor(n),this._DrawCircle(t,e),this._drawer.fill()},DrawSegment:function(t,e,i){var n=this._drawer;if(t.x===e.x&&t.y===e.y)return this._applyFillColor(i),this._DrawCircle(t,2/a),void n.fill();this._applyStrokeColor(i),b2.Transform.MulXV(this._xf,t,o),n.moveTo(o.x*a,o.y*a),b2.Transform.MulXV(this._xf,e,o),n.lineTo(o.x*a,o.y*a),n.stroke()},DrawTransform:function(t){var e=this._drawer;e.strokeColor=r,o.x=o.y=0,b2.Transform.MulXV(t,o,o),e.moveTo(o.x*a,o.y*a),o.x=1,o.y=0,b2.Transform.MulXV(t,o,o),e.lineTo(o.x*a,o.y*a),e.stroke(),e.strokeColor=n,o.x=o.y=0,b2.Transform.MulXV(t,o,o),e.moveTo(o.x*a,o.y*a),o.x=0,o.y=1,b2.Transform.MulXV(t,o,o),e.lineTo(o.x*a,o.y*a),e.stroke()},DrawPoint:function(t,e,i){},_applyStrokeColor:function(t){var e=this._drawer.strokeColor;e.r=255*t.r,e.g=255*t.g,e.b=255*t.b,e.a=150,this._drawer.strokeColor=e},_applyFillColor:function(t){var e=this._drawer.fillColor;e.r=255*t.r,e.g=255*t.g,e.b=255*t.b,e.a=150,this._drawer.fillColor=e},PushTransform:function(t){this._xf=t},PopTransform:function(){this._xf=this._dxf}}),e.exports=s},{"../CCPhysicsTypes":205}],227:[function(t,e,i){"use strict";function n(){this._type=0,this._fixtures=[],this._points=[],this._normals=[],this._fractions=[]}n.prototype.init=function(t){this._type=t,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0},n.prototype.ReportFixture=function(t,e,i,n){return 0===this._type?(this._fixtures[0]=t,this._points[0]=e,this._normals[0]=i,this._fractions[0]=n):(this._fixtures.push(t),this._points.push(cc.v2(e)),this._normals.push(cc.v2(i)),this._fractions.push(n),1===this._type?0:2<=this._type?1:n)},n.prototype.getFixtures=function(){return this._fixtures},n.prototype.getPoints=function(){return this._points},n.prototype.getNormals=function(){return this._normals},n.prototype.getFractions=function(){return this._fractions},cc.PhysicsRayCastCallback=e.exports=n},{}],228:[function(t,e,i){"use strict";e.exports={getWorldRotation:function(t){for(var e=t.angle,i=t.parent;i.parent;)e+=i.angle,i=i.parent;return-e},getWorldScale:function(t){for(var e=t.scaleX,i=t.scaleY,n=t.parent;n.parent;)e*=n.scaleX,i*=n.scaleY,n=n.parent;return cc.v2(e,i)},convertToNodeRotation:function(t,e){e-=-t.angle;for(var i=t.parent;i.parent;)e-=-i.angle,i=i.parent;return e}}},{}],229:[function(t,e,i){"use strict";t("../assets/CCAsset");var s=t("./utils").callInNextTick,y=t("../load-pipeline/CCLoader"),g=t("../load-pipeline/asset-table"),v=t("../load-pipeline/pack-downloader"),a=t("../load-pipeline/auto-release-utils"),b=t("../utils/decode-uuid"),x=t("../load-pipeline/md5-pipe"),A=t("../load-pipeline/subpackage-pipe"),C=t("./js"),T="",S="",w=C.createMap(!0);function o(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)}function E(t,e){this.url=t,this.type=e}var n={loadAsset:function(n,r,t){if("string"!=typeof n)return s(r,new Error("[AssetLibrary] uuid must be string"),null);var e={uuid:n,type:"uuid"};t&&t.existingAsset&&(e.existingAsset=t.existingAsset),y.load(e,function(t,e){var i;t||!e?(i="string"==typeof t?t:t?t.message||t.errorMessage||JSON.stringify(t):"Unknown error",t=new Error("[AssetLibrary] loading JSON or dependencies failed:"+i)):(e.constructor===cc.SceneAsset&&(i=cc.loader._getReferenceKey(n),e.scene.dependAssets=a.getDependsRecursively(i)),o(e)&&(i=cc.loader._getReferenceKey(n),y.removeItem(i))),r&&r(t,e)})},getLibUrlNoExt:function(t,e){return t=b(t),(e?S+"assets/":T)+t.slice(0,2)+"/"+t},_queryAssetInfoInEditor:function(t,e){},_getAssetInfoInRuntime:function(t,e){e=e||{url:null,raw:!1};var i=w[t];return i&&!C.isChildClassOf(i.type,cc.Asset)?(e.url=S+i.url,e.raw=!0):(e.url=this.getLibUrlNoExt(t)+".json",e.raw=!1),e},_uuidInSettings:function(t){return t in w},queryAssetInfo:function(t,e){t=this._getAssetInfoInRuntime(t);e(null,t.url,t.raw)},parseUuidInEditor:function(t){},loadJson:function(t,n){var r=""+((new Date).getTime()+Math.random()),t={uuid:r,type:"uuid",content:t,skips:[y.assetLoader.id,y.downloader.id]};y.load(t,function(t,e){var i;t?t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message):(e.constructor===cc.SceneAsset&&(i=cc.loader._getReferenceKey(r),e.scene.dependAssets=a.getDependsRecursively(i)),o(e)&&(i=cc.loader._getReferenceKey(r),y.removeItem(i))),e._uuid="",n&&n(t,e)})},getAssetByUuid:function(t){return n._uuidToAsset[t]||null},init:function(t){var e=(e=t.libraryPath).replace(/\\/g,"/"),e=(T=cc.path.stripSep(e)+"/",S=t.rawAssetsBase,t.subpackages&&(e=new A(t.subpackages),cc.loader.insertPipeAfter(cc.loader.assetLoader,e),cc.loader.subPackPipe=e),t.md5AssetsMap);if(e&&e.import){for(var i=0,n=0,r=C.createMap(!0),s=e.import,i=0;i<s.length;i+=2)r[n=b(s[i])]=s[i+1];var a=C.createMap(!0),s=e["raw-assets"];for(i=0;i<s.length;i+=2)a[n=b(s[i])]=s[i+1];e=new x(r,a,T);cc.loader.insertPipeAfter(cc.loader.assetLoader,e),cc.loader.md5Pipe=e}var o,l=y._assetTables;for(o in l)l[o].reset();var h=t.rawAssets;if(h)for(var c in h){var u=h[c];for(n in u){var _,d=u[n],f=d[0],p=d[1],m=cc.js._getClassById(p);m?(w[n]=new E(c+"/"+f,m),(_=cc.path.extname(f))&&(f=f.slice(0,-_.length)),_=1===d[2],l[c]||(l[c]=new g),l[c].add(f,n,m,!_)):cc.error("Cannot get",p)}}t.packedAssets&&v.initPacks(t.packedAssets),cc.url._init(t.mountPaths&&t.mountPaths.assets||S+"assets")},_uuidToAsset:{}},l={effect:{},material:{}},h={};function r(t,e,r){var i=t+"s",s=l[t]={};cc.loader.loadResDir(i,e,"internal",function(){},function(t,e){if(t)cc.error(t);else for(var i=0;i<e.length;i++){var n=e[i];cc.loader.getDependsRecursively(n).forEach(function(t){return h[t]=!0}),s[""+n.name]=n}r()})}n._loadBuiltins=function(t){if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS)return t&&t();r("effect",cc.EffectAsset,function(){r("material",cc.Material,t)})},n.getBuiltin=function(t,e){return l[t][e]},n.getBuiltins=function(t){return t?l[t]:l},n.resetBuiltins=function(){l={effect:{},material:{}},h={}},n.getBuiltinDeps=function(){return h},e.exports=cc.AssetLibrary=n},{"../assets/CCAsset":76,"../load-pipeline/CCLoader":177,"../load-pipeline/asset-table":179,"../load-pipeline/auto-release-utils":181,"../load-pipeline/md5-pipe":188,"../load-pipeline/pack-downloader":189,"../load-pipeline/subpackage-pipe":192,"../utils/decode-uuid":309,"./js":250,"./utils":254}],230:[function(t,e,i){"use strict";var g=t("./js"),h=t("./CCEnum"),n=t("./utils"),v=(n.isPlainEmptyObj_DEV,n.cloneable_DEV,t("./attribute")),b=v.DELIMETER,x=t("./preprocess-class"),c=(t("./requiring-frame"),["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"]);function _(t,e){t.indexOf(e)<0&&t.push(e)}var u={datas:null,push:function(t){var e;this.datas?this.datas.push(t):(this.datas=[t],e=this,setTimeout(function(){e.init()},0))},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.cls,r=i.props,s=("function"==typeof r&&(r=r()),g.getClassName(n));r?T(n,s,r,n.$super,i.mixins):cc.errorID(3633,s)}this.datas=null}}};function A(t,e,i,n){var r=n.default;v.setClassAttr(t,i,"default",r),_(t.__props__,i),E(t,n,0,i)}function r(t){return"function"==typeof t?t():t}function d(t,e,i){for(var n in e)t.hasOwnProperty(n)||i&&!i(n)||Object.defineProperty(t,n,g.getPropertyDescriptor(e,n))}function f(t,e,i,n){var r,s,a=n.__ctor__,o=n.ctor,l=n.__ES6__,h=(l?(r=[o],s=o):(r=a?[a]:function(t,e,i){for(var n=[],r=[t].concat(e),s=0;s<r.length;s++){var a=r[s];if(a)for(var o=function(t){return S._isCCClass(t)?t.__ctors__||[]:[t]}(a),l=0;l<o.length;l++)_(n,o[l])}t=i.ctor;return t&&n.push(t),n}(e,i,n),s=y(r,e,0,n),g.value(s,"extend",function(t){return t.extends=this,S(t)},!0)),g.value(s,"__ctors__",0<r.length?r:null,!0),s.prototype);if(e&&(l||(g.extend(s,e),h=s.prototype),s.$super=e),i){for(var c=i.length-1;0<=c;c--){var u=i[c];d(h,u.prototype),d(s,u,function(t){return u.hasOwnProperty(t)&&!0}),S._isCCClass(u)&&d(v.getClassAttrs(s),v.getClassAttrs(u))}h.constructor=s}return l||(h.__initProps__=m),g.setClassName(t,s),s}function o(t){for(var e=g.getClassName(t),i=t.constructor,n="new "+e+"(",r=0;r<i.__props__.length;r++)n+=t[i.__props__[r]],r<i.__props__.length-1&&(n+=",");return n+")"}function l(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}var p=/^[A-Za-z_$][0-9A-Za-z_$]*$/;function m(t){var e=v.getClassAttrs(t),i=t.__props__,e=(null===i&&(u.init(),i=t.__props__),function(t,e){for(var i=[],n="",r=0;r<e.length;r++){var s=e[r],a=s+b+"default";a in t&&(n+=(p.test(s)?"this."+s+"=":"this["+l(s)+"]=")+("object"==typeof(s=t[a])&&s?s instanceof cc.ValueType?o(s):Array.isArray(s)?"[]":"{}":"function"==typeof s?(a=i.length,i.push(s),"F["+a+"]()"):"string"==typeof s?l(s):s)+";\n")}return 0===i.length?Function(n):Function("F","return (function(){\n"+n+"})")(i)}(e,i));(t.prototype.__initProps__=e).call(this)}function y(t,e,i,n){var r="return function CCClass(){\n",s=(e&&function(t,e){var i,n=!1;for(i in e)if(!(0<=c.indexOf(i))){var r=e[i];if("function"==typeof r){var s=g.getPropertyDescriptor(t.prototype,i);if(s){s=s.value;if("function"==typeof s){C.test(r)&&(n=!0,e[i]=function(i,n){return function(){var t=this._super,e=(this._super=i,n.apply(this,arguments));return this._super=t,e}}(s,r));continue}}}}return n}(e,n)&&(r+="this._super=null;\n"),r+="this.__initProps__(CCClass);\n",t.length);if(0<s){var a="].apply(this,arguments);\n";if(1===s)r+="CCClass.__ctors__[0"+a;else{r+="var cs=CCClass.__ctors__;\n";for(var o=0;o<s;o++)r+="cs["+o+a}}return r+="}",Function(r)()}var C=/xyz/.test(function(){xyz})?/\b\._super\b/:/.*/;function T(e,t,i,n,r,s){if(e.__props__=[],n&&n.__props__&&(e.__props__=n.__props__.slice()),r)for(var a=0;a<r.length;++a){var o=r[a];o.__props__&&(e.__props__=e.__props__.concat(o.__props__.filter(function(t){return e.__props__.indexOf(t)<0})))}if(i)for(var l in x.preprocessAttrs(i,t,e,s),i){var h=i[l];"default"in h?A(e,t,l,h):(c=e,u=t,l=l,_=s,m=p=f=d=void 0,d=(h=h).get,f=h.set,p=c.prototype,m=!Object.getOwnPropertyDescriptor(p,l),d&&(E(c,h,0,l),v.setClassAttr(c,l,"serializable",!1),_||g.get(p,l,d,m,m)),f&&!_&&g.set(p,l,f,m,m))}var c,u,_,d,f,p,m,y=v.getClassAttrs(e);e.__values__=e.__props__.filter(function(t){return!1!==y[t+b+"serializable"]})}function S(t){var e=(t=t||{}).name,i=t.extends,n=t.mixins,r=function(t,e,i,n){var r=cc.Component,s=cc._RF.peek();if(s&&g.isChildClassOf(e,r)){if(g.isChildClassOf(s.cls,r))return cc.errorID(3615),null;t=t||s.script}return t=f(t,e,i,n),s&&(g.isChildClassOf(e,r)?((i=s.uuid)&&g._setClassId(i,t),s.cls=t):g.isChildClassOf(s.cls,r)||(s.cls=t)),t}(e,i,n,t),e=e||cc.js.getClassName(r),s=(r._sealed=!0,i&&(i._sealed=!1),t.properties);"function"==typeof s||i&&null===i.__props__||n&&n.some(function(t){return null===t.__props__})?(u.push({cls:r,props:s,mixins:n}),r.__props__=r.__values__=null):T(r,e,s,i,t.mixins,t.__ES6__);var a,o,l,h=t.statics;if(h)for(a in h)r[a]=h[a];for(o in t)0<=c.indexOf(o)||(l=t[o],x.validateMethodWithProps(l,o,e,r,i)&&g.value(r.prototype,o,l,!0,!0));n=t.editor;return n&&g.isChildClassOf(i,cc.Component)&&cc.Component._registerEditorProps(r,n),r}/xyz/.test(function(){xyz}),S._isCCClass=function(t){return t&&t.hasOwnProperty("__ctors__")},S._fastDefine=function(t,e,i){g.setClassName(t,e);for(var n=e.__props__=e.__values__=Object.keys(i),r=v.getClassAttrs(e),s=0;s<n.length;s++){var a=n[s];r[a+b+"visible"]=!1,r[a+b+"default"]=i[a]}},S.Attr=v,S.attr=v.attr,S.getInheritanceChain=function(t){for(var e=[];t=g.getSuper(t);)t!==Object&&e.push(t);return e};var w={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function E(t,n,e,i){var r=null,s="";function a(){return s=i+b,r=v.getClassAttrs(t)}var o=n.type;function l(t,e){var i;t in n&&(typeof(i=n[t])===e&&((r||a())[s+t]=i))}o&&(w[o]?(r||a())[s+"type"]=o:"Object"!==o&&(o===v.ScriptUuid?((r||a())[s+"type"]="Script",r[s+"ctor"]=cc.ScriptAsset):"object"==typeof o?h.isEnum(o)&&((r||a())[s+"type"]="Enum",r[s+"enumList"]=h.getList(o)):"function"==typeof o&&((r||a())[s+"type"]="Object",r[s+"ctor"]=o))),n.editorOnly&&((r||a())[s+"editorOnly"]=!0),n.url&&((r||a())[s+"saveUrlAsAsset"]=!0),!1===n.serializable&&((r||a())[s+"serializable"]=!1),l("formerlySerializedAs","string");o=n.range;o&&Array.isArray(o)&&2<=o.length&&((r||a())[s+"min"]=o[0],r[s+"max"]=o[1],2<o.length&&(r[s+"step"]=o[2])),l("min","number"),l("max","number"),l("step","number")}cc.Class=S,e.exports={isArray:function(t){return t=r(t),Array.isArray(t)},fastDefine:S._fastDefine,getNewValueTypeCode:o,IDENTIFIER_RE:p,escapeForJS:l,getDefault:r}},{"./CCEnum":232,"./attribute":242,"./js":250,"./preprocess-class":251,"./requiring-frame":252,"./utils":254}],231:[function(t,e,i){"use strict";t("./CCClass");var h=t("./preprocess-class"),c=t("./js"),n="__ccclassCache__";function r(t){return t}function a(t,e){return t[e]||(t[e]={})}function s(i){return function(e){return"function"==typeof e?i(e):function(t){return i(t,e)}}}function o(t,i,e){return function(e){return function(t){return i(t,e)}}}t=o.bind(null,!1);function l(){return o.bind(null,!1)}var u=l(),_=l();function d(t){return a(t,n)}function f(t,e,i,n,r,s){var a,o=r&&(r.get||r.set),l=(n&&(a=h.getFullFormOfProperty(n,o)),e[i]),l=c.mixin(l||{},a||n||{});o?(r.get&&(l.get=r.get),r.set&&(l.set=r.set)):(a=void 0,r?r.initializer&&(a=function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}(r.initializer)):(n=s.default||(s.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(t))).hasOwnProperty(i)&&(a=n[i]),l.default=a),e[i]=l}var p=s(function(t,e){var i=c.getSuper(t),e={name:e,extends:i=i===Object?null:i,ctor:t,__ES6__:!0},i=t[n];return i&&((i=i.proto)&&c.mixin(e,i),t[n]=void 0),cc.Class(e)});function m(t,i,n){return t(function(t,e){t=d(t);t&&(e=void 0!==n?n:e,a(a(t,"proto"),"editor")[i]=e)},i)}function y(t){return t(r)}var g=y(s),t=m(t,"requireComponent"),v=y(u),_=m(_,"executionOrder"),b=y(s),x=y(s),A=y(u),C=y(u),u=y(u);cc._decorator=e.exports={ccclass:p,property:function(t,e,i){var s=null;function n(t,e,i){var n,r=d(t.constructor);r&&(n=a(a(r,"proto"),"properties"),f(t.constructor,n,e,s,i,r))}if(void 0===e)return s=t,n;n(t,e,i)},executeInEditMode:g,requireComponent:t,menu:v,executionOrder:_,disallowMultiple:b,playOnFocus:x,inspector:A,icon:C,help:u,mixins:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){t=d(t);t&&(a(t,"proto").mixins=e)}}}},{"./CCClass":230,"./js":250,"./preprocess-class":251,"./utils":254}],232:[function(t,e,i){"use strict";var a=t("./js");function n(t){if(!("__enums__"in t)){a.value(t,"__enums__",null,!0);for(var e=-1,i=Object.keys(t),n=0;n<i.length;n++){var r=i[n],s=t[r];if(-1===s)s=++e,t[r]=s;else if("number"==typeof s)e=s;else if("string"==typeof s&&Number.isInteger(parseFloat(r)))continue;s=""+s;r!==s&&a.value(t,s,r)}}return t}n.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},n.getList=function(t){if(t.__enums__)return t.__enums__;var e,i=t.__enums__=[];for(e in t){var n=t[e];Number.isInteger(n)&&i.push({name:e,value:n})}return i.sort(function(t,e){return t.value-e.value}),i},e.exports=cc.Enum=n},{"./js":250}],233:[function(t,e,i){"use strict";var n,r=t("../event-manager"),t=t("./CCInputManager");cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},t.setAccelerometerEnabled=function(t){var e=this;e._accelEnabled!==t&&(e._accelEnabled=t,(t=cc.director.getScheduler()).enableForTarget(e),e._accelEnabled?(e._registerAccelerometerEvent(),e._accelCurTime=0,t.scheduleUpdate(e)):(e._unregisterAccelerometerEvent(),e._accelCurTime=0,t.unscheduleUpdate(e)))},t.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},t._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){r.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){r.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},t._registerAccelerometerEvent=function(){var t=window,e=(this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent),this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation"),i=navigator.userAgent;(/Android/.test(i)||/Adr/.test(i)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),n=this.didAccelerate.bind(this),t.addEventListener(e,n,!1)},t._unregisterAccelerometerEvent=function(){var t=window,e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";n&&t.removeEventListener(e,n,!1)},t.didAccelerate=function(t){var e,i,n,r,s,a=window;this._accelEnabled&&(e=this._acceleration,r=this._accelDeviceEvent===window.DeviceMotionEvent?(r=t.accelerationIncludingGravity,i=this._accelMinus*r.x*.1,n=this._accelMinus*r.y*.1,.1*r.z):(i=t.gamma/90*.981,n=-t.beta/90*.981,t.alpha/90*.981),cc.view._isRotated&&(s=i,i=-n,n=s),e.x=i,e.y=n,e.z=r,e.timestamp=t.timeStamp||Date.now(),s=e.x,90===a.orientation?(e.x=-e.y,e.y=s):-90===a.orientation?(e.x=e.y,e.y=-s):180===a.orientation&&(e.x=-e.x,e.y=-e.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(e.x=-e.x,e.y=-e.y))}},{"../event-manager":154,"./CCInputManager":234}],234:[function(t,e,i){"use strict";var n=t("./CCMacro"),d=t("./CCSys"),f=t("../event-manager"),r=n.TOUCH_TIMEOUT,c=cc.v2(),t={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.v2(0,0),_prevMousePoint:cc.v2(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:8,_accelEnabled:!1,_accelInterval:.2,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_canvasBoundingRect:{left:0,top:0,adjustedLeft:0,adjustedTop:0,width:0,height:0},_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=cc.sys.now(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var n=this._touches[i];if(e-n._lastModified>r)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[n.getID()],i;t>>=1}return-1},_removeUsedIndexBit:function(t){t<0||t>=this._maxTouches||(this._indexBitsUsed&=~(1<<t))},_glView:null,_updateCanvasBoundingRect:function(){var t,e=cc.game.canvas,i=this._canvasBoundingRect,n=document.documentElement,r=window.pageXOffset-n.clientLeft,n=window.pageYOffset-n.clientTop;e.getBoundingClientRect?(t=e.getBoundingClientRect(),i.left=t.left+r,i.top=t.top+n,i.width=t.width,i.height=t.height):e instanceof HTMLCanvasElement?(i.left=r,i.top=n,i.width=e.width,i.height=e.height):(i.left=r,i.top=n,i.width=parseInt(e.style.width),i.height=parseInt(e.style.height))},handleTouchesBegin:function(t){for(var e,i,n,r,s=[],a=this._touchesIntegerDict,o=d.now(),l=0,h=t.length;l<h;l++)if(null==a[n=(e=t[l]).getID()]){var c=this._getUnUsedIndex();if(-1===c){cc.logID(2300,c);continue}(i=this._touches[c]=new cc.Touch(e._point.x,e._point.y,e.getID()))._lastModified=o,i._setPrevPoint(e._prevPoint),a[n]=c,s.push(i)}0<s.length&&(this._glView._convertTouchesWithScale(s),(r=new cc.Event.EventTouch(s))._eventCode=cc.Event.EventTouch.BEGAN,f.dispatchEvent(r))},handleTouchesMove:function(t){for(var e,i,n,r=[],s=this._touches,a=d.now(),o=0,l=t.length;o<l;o++)i=(e=t[o]).getID(),null!=(i=this._touchesIntegerDict[i])&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),s[i]._lastModified=a,r.push(s[i]));0<r.length&&(this._glView._convertTouchesWithScale(r),(n=new cc.Event.EventTouch(r))._eventCode=cc.Event.EventTouch.MOVED,f.dispatchEvent(n))},handleTouchesEnd:function(t){var t=this.getSetOfTouchesEndOrCancel(t);0<t.length&&(this._glView._convertTouchesWithScale(t),(t=new cc.Event.EventTouch(t))._eventCode=cc.Event.EventTouch.ENDED,f.dispatchEvent(t)),this._preTouchPool.length=0},handleTouchesCancel:function(t){var t=this.getSetOfTouchesEndOrCancel(t);0<t.length&&(this._glView._convertTouchesWithScale(t),(t=new cc.Event.EventTouch(t))._eventCode=cc.Event.EventTouch.CANCELED,f.dispatchEvent(t)),this._preTouchPool.length=0},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],s=this._touches,a=this._touchesIntegerDict,o=0,l=t.length;o<l;o++)null!=(i=a[n=(e=t[o]).getID()])&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),r.push(s[i]),this._removeUsedIndexBit(i),delete a[n]);return r},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){e=i[r];break}return e=e||t},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,t=this._glView.convertToLocationInView(t,e,i),e=new cc.Touch(t.x,t.y,0);return e._setPrevPoint(n.x,n.y),n.x=t.x,n.y=t.y,e},getMouseEvent:function(t,e,i){var n=this._prevMousePoint,i=new cc.Event.EventMouse(i);return i._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,this._glView._convertMouseToLocationInView(n,e),i.setLocation(n.x,n.y),i},getPointByEvent:function(t,e){return cc.sys.browserType!==cc.sys.BROWSER_TYPE_QQ&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_SAFARI||this._updateCanvasBoundingRect(),null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r,s=[],a=this._glView,o=this._preTouchPoint,l=t.changedTouches.length,h=0;h<l;h++)(n=t.changedTouches[h])&&(r=void 0,r=d.BROWSER_TYPE_FIREFOX===d.browserType?a.convertToLocationInView(n.pageX,n.pageY,e,c):a.convertToLocationInView(n.clientX,n.clientY,e,c),null!=n.identifier?(i=new cc.Touch(r.x,r.y,n.identifier),n=this.getPreTouch(i).getLocation(),i._setPrevPoint(n.x,n.y),this.setPreTouch(i)):(i=new cc.Touch(r.x,r.y))._setPrevPoint(o.x,o.y),o.x=r.x,o.y=r.y,s.push(i));return s},registerSystemEvent:function(s){if(!this._isRegisterEvent){this._glView=cc.view;var a=this,o=this._canvasBoundingRect,t=(window.addEventListener("resize",this._updateCanvasBoundingRect.bind(this)),d.isMobile),e="mouse"in d.capabilities,i="touches"in d.capabilities;if(e){t||(window.addEventListener("mousedown",function(){a._mousePressed=!0},!1),window.addEventListener("mouseup",function(t){var e;a._mousePressed&&(a._mousePressed=!1,e=a.getPointByEvent(t,o),cc.rect(o.left,o.top,o.width,o.height).contains(e)||(a.handleTouchesEnd([a.getTouchByXY(e.x,e.y,o)]),(e=a.getMouseEvent(e,o,cc.Event.EventMouse.UP)).setButton(t.button),f.dispatchEvent(e)))},!1));for(var e=cc.Event.EventMouse,n=[!t&&["mousedown",e.DOWN,function(t,e,i,n){a._mousePressed=!0,a.handleTouchesBegin([a.getTouchByXY(i.x,i.y,n)]),s.focus()}],!t&&["mouseup",e.UP,function(t,e,i,n){a._mousePressed=!1,a.handleTouchesEnd([a.getTouchByXY(i.x,i.y,n)])}],!t&&["mousemove",e.MOVE,function(t,e,i,n){a.handleTouchesMove([a.getTouchByXY(i.x,i.y,n)]),a._mousePressed||e.setButton(null)}],["mousewheel",e.SCROLL,function(t,e){e.setScrollData(0,t.wheelDelta)}],["DOMMouseScroll",e.SCROLL,function(t,e){e.setScrollData(0,-120*t.detail)}]],r=0;r<n.length;++r){var l=n[r];l&&function(){var t=l[0],n=l[1],r=l[2];s.addEventListener(t,function(t){var e=a.getPointByEvent(t,o),i=a.getMouseEvent(e,o,n);i.setButton(t.button),r(t,i,e,o),f.dispatchEvent(i),t.stopPropagation(),t.preventDefault()},!1)}()}}if(window.navigator.msPointerEnabled){var h,c={MSPointerDown:a.handleTouchesBegin,MSPointerMove:a.handleTouchesMove,MSPointerUp:a.handleTouchesEnd,MSPointerCancel:a.handleTouchesCancel};for(h in c)!function(t){var i=c[t];s.addEventListener(t,function(t){var e=document.documentElement;o.adjustedLeft=o.left-e.scrollLeft,o.adjustedTop=o.top-e.scrollTop,i.call(a,[a.getTouchByXY(t.clientX,t.clientY,o)]),t.stopPropagation()},!1)}(h)}if(i){var u,_={touchstart:function(t){a.handleTouchesBegin(t),s.focus()},touchmove:function(t){a.handleTouchesMove(t)},touchend:function(t){a.handleTouchesEnd(t)},touchcancel:function(t){a.handleTouchesCancel(t)}};for(u in _)!function(t){var i=_[t];s.addEventListener(t,function(t){var e;t.changedTouches&&(e=document.body,o.adjustedLeft=o.left-(e.scrollLeft||window.scrollX||0),o.adjustedTop=o.top-(e.scrollTop||window.scrollY||0),i(a.getTouchesByEvent(t,o)),t.stopPropagation(),t.preventDefault())},!1)}(u)}this._registerKeyboardEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,f.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};e.exports=cc.internal.inputManager=t},{"../event-manager":154,"./CCMacro":235,"./CCSys":239}],235:[function(t,e,i){"use strict";cc.macro={RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,MIN_ZINDEX:-Math.pow(2,15),MAX_ZINDEX:Math.pow(2,15)-1,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:!0,DIRECTOR_STATS_POSITION:cc.v2(0,0),ENABLE_STACKABLE_ACTIONS:!0,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1,ENABLE_CULLING:!1,CLEANUP_IMAGE_CACHE:!1,SHOW_MESH_WIREFRAME:!1,SHOW_MESH_NORMAL:!1,ENABLE_MULTI_TOUCH:!0},Object.defineProperty(cc.macro,"ROTATE_ACTION_CCW",{set:function(t){cc.RotateTo&&cc.RotateBy&&(cc.RotateTo._reverse=cc.RotateBy._reverse=t)}}),cc.macro.SUPPORT_TEXTURE_FORMATS=[".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],cc.macro.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.macro.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.macro.BlendFactor=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775}),cc.macro.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.macro.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),e.exports=cc.macro},{}],236:[function(t,e,i){"use strict";var n=t("./js"),d=t("./CCClass");function r(){this._name="",this._objFlags=0}d.fastDefine("cc.Object",r,{_name:"",_objFlags:0}),n.value(r,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var s=[];n.value(r,"_deferredDestroy",function(){for(var t=s.length,e=0;e<t;++e){var i=s[e];1&i._objFlags||i._destroyImmediate()}t===s.length?s.length=0:s.splice(0,t)});t=r.prototype;n.getset(t,"name",function(){return this._name},function(t){this._name=t},!0),n.get(t,"isValid",function(){return!(1&this._objFlags)},!0),t.destroy=function(){return 1&this._objFlags?(cc.warnID(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,s.push(this),0))},t._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var i,n=t instanceof cc._BaseNode||t instanceof cc.Component,r=n?"_id":null,s={};for(i in t)if(t.hasOwnProperty(i)){if(i===r)continue;switch(typeof t[i]){case"string":s[i]="";break;case"object":case"function":s[i]=null}}if(cc.Class._isCCClass(e))for(var a=cc.Class.Attr.getClassAttrs(e),o=e.__props__,l=0;l<o.length;l++){var h=(i=o[l])+cc.Class.Attr.DELIMETER+"default";if(h in a&&(!n||"_id"!==i))switch(typeof a[h]){case"string":s[i]="";break;case"object":case"function":s[i]=null;break;case"undefined":s[i]=void 0}}var c="";for(i in s){var u=d.IDENTIFIER_RE.test(i)?"o."+i+"=":"o["+d.escapeForJS(i)+"]=",_=s[i];c+=u+(_=""===_?'""':_)+";\n"}return Function("o",c)}(this,t),n.value(t,"__destruct__",e,!0)),e(this)},t._onPreDestroy=null,t._destroyImmediate=function(){1&this._objFlags?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},t._deserialize=null,cc.isValid=function(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t},cc.Object=e.exports=r},{"./CCClass":230,"./js":250}],237:[function(t,e,i){"use strict";t=t("../platform/js");cc.SAXParser=function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},cc.SAXParser.prototype={constructor:cc.SAXParser,parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e}},cc.PlistParser=function(){cc.SAXParser.call(this)},t.extend(cc.PlistParser,cc.SAXParser),t.mixin(cc.PlistParser.prototype,{parse:function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return cc.warnID(5100),{};for(var i=null,n=0,r=e.childNodes.length;n<r&&1!==(i=e.childNodes[n]).nodeType;n++);return this._parseNode(i)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else for(var e="",n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue;else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;n<r;n++){var s=t.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser,e.exports={saxParser:cc.saxParser,plistParser:cc.plistParser}},{"../platform/js":250}],238:[function(t,e,i){"use strict";cc.screen={_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenChange:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],init:function(){this._fn={};for(var t,e,i=this._fnMap,n=0,r=i.length;n<r;n++)if((t=i[n])&&void 0!==document[t[1]]){for(n=0,e=t.length;n<e;n++)this._fn[i[0][n]]=t[n];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchend"in window?"touchend":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&!!(document[this._fn.fullscreenElement]||document[this._fn.webkitFullscreenElement]||document[this._fn.mozFullScreenElement])},requestFullScreen:function(t,e,i){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser&&0<t.readyState)return void(t.webkitEnterFullscreen&&t.webkitEnterFullscreen());t.setAttribute("x5-video-player-fullscreen","true")}var n;this._supportsFullScreen&&(t=t||document.documentElement,e&&(n=this._fn.fullscreenchange,this._onfullscreenchange&&document.removeEventListener(n,this._onfullscreenchange),this._onfullscreenchange=e,document.addEventListener(n,e,!1)),i&&(n=this._fn.fullscreenerror,this._onfullscreenerror&&document.removeEventListener(n,this._onfullscreenerror),this._onfullscreenerror=i,document.addEventListener(n,i,{once:!0})),t[this._fn.requestFullscreen]())},exitFullScreen:function(t){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser)return void(t.webkitExitFullscreen&&t.webkitExitFullscreen());t.setAttribute("x5-video-player-fullscreen","false")}return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){t=t||document.body,this._ensureFullScreen(t,e),this.requestFullScreen(t,e)},disableAutoFullScreen:function(t){var t=cc.game.canvas||t,e=this._touchEvent;this._preOnTouch&&(t.removeEventListener(e,this._preOnTouch),this._preOnTouch=null)},_ensureFullScreen:function(t,e){var i,n=this,r=cc.game.canvas||t,s=this._fn.fullscreenerror;function a(){n._preOnFullScreenError=null,n._preOnTouch&&r.removeEventListener(i,n._preOnTouch),n._preOnTouch=function(){n._preOnTouch=null,n.requestFullScreen(t,e)},r.addEventListener(i,n._preOnTouch,{once:!0})}void 0!==document[s]&&(i=this._touchEvent,this._preOnFullScreenError&&t.removeEventListener(s,this._preOnFullScreenError),this._preOnFullScreenError=a,t.addEventListener(s,a,{once:!0}))}},cc.screen.init()},{}],239:[function(t,e,i){"use strict";window._CCSettings&&_CCSettings.platform;var d="undefined"==typeof window?global:window,n=cc&&cc.sys?cc.sys:function(){cc.sys={};var e=cc.sys;if(e.LANGUAGE_ENGLISH="en",e.LANGUAGE_CHINESE="zh",e.LANGUAGE_FRENCH="fr",e.LANGUAGE_ITALIAN="it",e.LANGUAGE_GERMAN="de",e.LANGUAGE_SPANISH="es",e.LANGUAGE_DUTCH="du",e.LANGUAGE_RUSSIAN="ru",e.LANGUAGE_KOREAN="ko",e.LANGUAGE_JAPANESE="ja",e.LANGUAGE_HUNGARIAN="hu",e.LANGUAGE_PORTUGUESE="pt",e.LANGUAGE_ARABIC="ar",e.LANGUAGE_NORWEGIAN="no",e.LANGUAGE_POLISH="pl",e.LANGUAGE_TURKISH="tr",e.LANGUAGE_UKRAINIAN="uk",e.LANGUAGE_ROMANIAN="ro",e.LANGUAGE_BULGARIAN="bg",e.LANGUAGE_UNKNOWN="unknown",e.OS_IOS="iOS",e.OS_ANDROID="Android",e.OS_WINDOWS="Windows",e.OS_MARMALADE="Marmalade",e.OS_LINUX="Linux",e.OS_BADA="Bada",e.OS_BLACKBERRY="Blackberry",e.OS_OSX="OS X",e.OS_WP8="WP8",e.OS_WINRT="WINRT",e.OS_UNKNOWN="Unknown",e.UNKNOWN=-1,e.WIN32=0,e.LINUX=1,e.MACOS=2,e.ANDROID=3,e.IPHONE=4,e.IPAD=5,e.BLACKBERRY=6,e.NACL=7,e.EMSCRIPTEN=8,e.TIZEN=9,e.WINRT=10,e.WP8=11,e.MOBILE_BROWSER=100,e.DESKTOP_BROWSER=101,e.EDITOR_PAGE=102,e.EDITOR_CORE=103,e.WECHAT_GAME=104,e.QQ_PLAY=105,e.FB_PLAYABLE_ADS=106,e.BAIDU_GAME=107,e.VIVO_GAME=108,e.OPPO_GAME=109,e.HUAWEI_GAME=110,e.XIAOMI_GAME=111,e.JKW_GAME=112,e.ALIPAY_GAME=113,e.WECHAT_GAME_SUB=114,e.BAIDU_GAME_SUB=115,e.QTT_GAME=116,e.BROWSER_TYPE_WECHAT="wechat",e.BROWSER_TYPE_WECHAT_GAME="wechatgame",e.BROWSER_TYPE_WECHAT_GAME_SUB="wechatgamesub",e.BROWSER_TYPE_BAIDU_GAME="baidugame",e.BROWSER_TYPE_BAIDU_GAME_SUB="baidugamesub",e.BROWSER_TYPE_XIAOMI_GAME="xiaomigame",e.BROWSER_TYPE_ALIPAY_GAME="alipaygame",e.BROWSER_TYPE_QQ_PLAY="qqplay",e.BROWSER_TYPE_ANDROID="androidbrowser",e.BROWSER_TYPE_IE="ie",e.BROWSER_TYPE_EDGE="edge",e.BROWSER_TYPE_QQ="qqbrowser",e.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",e.BROWSER_TYPE_UC="ucbrowser",e.BROWSER_TYPE_UCBS="ucbs",e.BROWSER_TYPE_360="360browser",e.BROWSER_TYPE_BAIDU_APP="baiduboxapp",e.BROWSER_TYPE_BAIDU="baidubrowser",e.BROWSER_TYPE_MAXTHON="maxthon",e.BROWSER_TYPE_OPERA="opera",e.BROWSER_TYPE_OUPENG="oupeng",e.BROWSER_TYPE_MIUI="miuibrowser",e.BROWSER_TYPE_FIREFOX="firefox",e.BROWSER_TYPE_SAFARI="safari",e.BROWSER_TYPE_CHROME="chrome",e.BROWSER_TYPE_LIEBAO="liebao",e.BROWSER_TYPE_QZONE="qzone",e.BROWSER_TYPE_SOUGOU="sogou",e.BROWSER_TYPE_UNKNOWN="unknown",e.isNative=!1,e.isBrowser="object"==typeof window&&"object"==typeof document&&!0,e.glExtension=function(t){return!!cc.renderer.device.ext(t)},e.getMaxJointMatrixSize=function(){var t;return e._maxJointMatrixSize||(t=cc.game._renderContext,t=Math.floor(t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)/4)-10,e._maxJointMatrixSize=t<50?0:50),e._maxJointMatrixSize},d.__globalAdapter&&d.__globalAdapter.adaptSys)d.__globalAdapter.adaptSys(e);else{var t=window,i=t.navigator,n=document,r=n.documentElement,s=i.userAgent.toLowerCase();e.isMobile=/mobile|android|iphone|ipad/.test(s),"undefined"!=typeof FbPlayableAd?e.platform=e.FB_PLAYABLE_ADS:e.platform=e.isMobile?e.MOBILE_BROWSER:e.DESKTOP_BROWSER;var a=(a=i.language)||i.browserLanguage,a=(e.languageCode=a.toLowerCase(),a=a?a.split("-")[0]:e.LANGUAGE_ENGLISH,e.language=a,!1),o=!1,l="",h=0,c=/android (\d+(?:\.\d+)*)/i.exec(s)||/android (\d+(?:\.\d+)*)/i.exec(i.platform),c=(c&&(a=!0,l=c[1]||"",h=parseInt(l)||0),(c=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(s))?(o=!0,l=c[2]||"",h=parseInt(l)||0):(/(iPhone|iPad|iPod)/.exec(i.platform)||"MacIntel"===i.platform&&i.maxTouchPoints&&1<i.maxTouchPoints)&&(o=!0,l="",h=0),e.OS_UNKNOWN),h=(-1!==i.appVersion.indexOf("Win")?c=e.OS_WINDOWS:o?c=e.OS_IOS:-1!==i.appVersion.indexOf("Mac")?c=e.OS_OSX:-1!==i.appVersion.indexOf("X11")&&-1===i.appVersion.indexOf("Linux")?c=e.OS_UNIX:a?c=e.OS_ANDROID:-1===i.appVersion.indexOf("Linux")&&-1===s.indexOf("ubuntu")||(c=e.OS_LINUX),e.os=c,e.osVersion=l,e.osMainVersion=h,e.browserType=e.BROWSER_TYPE_UNKNOWN,("safari"===(o=(o=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(s)||/qq|ucbrowser|ubrowser|edge/i.exec(s)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(s))?o[0].toLowerCase():e.BROWSER_TYPE_UNKNOWN)&&a||"qq"===o&&s.match(/android.*applewebkit/i))&&(o=e.BROWSER_TYPE_ANDROID),c={micromessenger:e.BROWSER_TYPE_WECHAT,trident:e.BROWSER_TYPE_IE,edge:e.BROWSER_TYPE_EDGE,"360 aphone":e.BROWSER_TYPE_360,mxbrowser:e.BROWSER_TYPE_MAXTHON,"opr/":e.BROWSER_TYPE_OPERA,ubrowser:e.BROWSER_TYPE_UC},e.browserType=c[o]||o,e.browserVersion="",l=(l=s.match(/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i))||s.match(/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i),e.browserVersion=l?l[4]:"",window.innerWidth||document.documentElement.clientWidth),a=window.innerHeight||document.documentElement.clientHeight,c=window.devicePixelRatio||1,o=(e.windowPixelResolution={width:c*h,height:c*a},e._checkWebGLRenderMode=function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")},document.createElement("canvas"));try{var u=e.localStorage=t.localStorage;u.setItem("storage",""),u.removeItem("storage"),u=null}catch(t){s=function(){cc.warnID(5200)};e.localStorage={getItem:s,setItem:s,removeItem:s,clear:s}}l=o.toDataURL("image/webp").startsWith("data:image/webp"),h=!!o.getContext("2d"),c=!1;t.WebGLRenderingContext&&(c=!0);var _,a=e.capabilities={canvas:h,opengl:c,webp:l};void 0===r.ontouchstart&&void 0===n.ontouchstart&&!i.msPointerEnabled||(a.touches=!0),void 0!==r.onmouseup&&(a.mouse=!0),void 0!==r.onkeyup&&(a.keyboard=!0),(t.DeviceMotionEvent||t.DeviceOrientationEvent)&&(a.accelerometer=!0),e.browserVersion,u=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),_={ONLY_ONE:!1,WEB_AUDIO:u,DELAY_CREATE_CTX:!1},e.os===e.OS_IOS&&(_.USE_LOADER_EVENT="loadedmetadata"),e.browserType===e.BROWSER_TYPE_FIREFOX&&(_.DELAY_CREATE_CTX=!0,_.USE_LOADER_EVENT="canplay"),e.os===e.OS_ANDROID&&e.browserType===e.BROWSER_TYPE_UC&&(_.ONE_SOURCE=!0);try{_.WEB_AUDIO&&(_.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),_.DELAY_CREATE_CTX&&setTimeout(function(){_.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(e){_.WEB_AUDIO=!1,cc.logID(5201)}s=[];(o=document.createElement("audio")).canPlayType&&(o.canPlayType('audio/ogg; codecs="vorbis"')&&s.push(".ogg"),o.canPlayType("audio/mpeg")&&s.push(".mp3"),o.canPlayType('audio/wav; codecs="1"')&&s.push(".wav"),o.canPlayType("audio/mp4")&&s.push(".mp4"),o.canPlayType("audio/x-m4a")&&s.push(".m4a")),_.format=s,e.__audioSupport=_}return e.NetworkType={NONE:0,LAN:1,WWAN:2},e.getNetworkType=function(){return e.NetworkType.LAN},e.getBatteryLevel=function(){return 1},e.garbageCollect=function(){},e.restartVM=function(){},e.getSafeAreaRect=function(){var t=cc.view.getVisibleSize();return cc.rect(0,0,t.width,t.height)},e.isObjectValid=function(t){return!!t},e.dump=function(){var t="",t=(t=(t=(t=(t=(t=(t=(t=(t+="isMobile : "+this.isMobile+"\r\n")+("language : "+this.language+"\r\n"))+("browserType : "+this.browserType+"\r\n"))+("browserVersion : "+this.browserVersion+"\r\n"))+("capabilities : "+JSON.stringify(this.capabilities)+"\r\n"))+("os : "+this.os+"\r\n"))+("osVersion : "+this.osVersion+"\r\n"))+("platform : "+this.platform+"\r\n"))+("Using "+(cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n");cc.log(t)},e.openURL=function(t){window.open(t)},e.now=function(){return Date.now?Date.now():+new Date},e}();e.exports=n},{}],240:[function(t,e,i){"use strict";var n=t("../event/event-target"),r=t("../platform/js"),s=t("../renderer"),a=(t("../platform/CCClass"),{init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType});switch(cc.sys.os===cc.sys.OS_IOS&&(a.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),a.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:a.meta["minimal-ui"]="true",a.availWidth=cc.sys.isMobile?function(t){return window.innerWidth}:function(t){return t.clientWidth},a.availHeight=cc.sys.isMobile?function(t){return window.innerHeight}:function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:a.meta["minimal-ui"]="true",a.availWidth=function(t){return t.clientWidth},a.availHeight=function(t){return t.clientHeight}}function o(){n.call(this);var t=this,e=cc.ContainerStrategy,i=cc.ContentStrategy;a.init(this),t._frameSize=cc.size(0,0),t._designResolutionSize=cc.size(0,0),t._originalDesignResolutionSize=cc.size(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=cc.rect(0,0,0,0),t._visibleRect=cc.rect(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=cc.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._antiAliasEnabled=!1,t._resolutionPolicy=null,t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),cc.game.once(cc.game.EVENT_ENGINE_INITED,this.init,this)}var l,h,c,u,_=null;cc.js.extend(o,n),cc.js.mixin(o.prototype,{init:function(){this._initFrameSize();var t=cc.game.canvas.width,e=cc.game.canvas.height;this._designResolutionSize.width=t,this._designResolutionSize.height=e,this._originalDesignResolutionSize.width=t,this._originalDesignResolutionSize.height=e,this._viewportRect.width=t,this._viewportRect.height=e,this._visibleRect.width=t,this._visibleRect.height=e,cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},_resizeEvent:function(t){var e,i,n,r,s=this.setDesignResolutionSize?this:cc.view,a=cc.sys;a.browserType!==a.BROWSER_TYPE_UC||a.os!==a.OS_IOS?(a=s._frameSize.width,e=s._frameSize.height,i=s._isRotated,cc.sys.isMobile?(n=(r=cc.game.container.style).margin,r.margin="0",r.display="none",s._initFrameSize(),r.margin=n,r.display="block"):s._initFrameSize(),!0!==t&&s._isRotated===i&&s._frameSize.width===a&&s._frameSize.height===e||(n=s._originalDesignResolutionSize.width,r=s._originalDesignResolutionSize.height,s._resizing=!0,0<n&&s.setDesignResolutionSize(n,r,s._resolutionPolicy),s._resizing=!1,s.emit("canvas-resize"),s._resizeCallback&&s._resizeCallback.call())):setTimeout(function(){s._resizeEvent(t)},0)},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent(),cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&setTimeout(function(){window.innerHeight>window.innerWidth&&window.scrollTo(0,1)},500)},resizeWithBrowserSize:function(t){t?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){var e;(t&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==t&&(this._orientation=t,t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height,this.setDesignResolutionSize(t,e,this._resolutionPolicy))},_initFrameSize:function(){var t=this._frameSize,e=a.availWidth(cc.game.frame),i=a.availHeight(cc.game.frame),n=i<=e;!cc.sys.isMobile||n&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!n&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.game.container.style["-webkit-transform"]="rotate(0deg)",cc.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.game.container.style["-webkit-transform"]="rotate(90deg)",cc.game.container.style.transform="rotate(90deg)",cc.game.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),this._orientationChanging&&setTimeout(function(){cc.view._orientationChanging=!1},1e3)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var n,r,s=document.getElementsByName("viewport"),s=s?s[0]:null,a=s?s.content:"";for(n in(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="",t)-1==a.indexOf(n)?a+=","+n+"="+t[n]:e&&(r=new RegExp(n+"s*=s*[^,]+"),a.replace(r,n+"="+t[n]));/^,/.test(a)&&(a=a.substr(1)),i.content=a,s&&(s.content=a),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewport&&(this._setViewportMeta(a.meta,!1),this._isAdjustViewport=!1)},adjustViewportMeta:function(t){this._isAdjustViewport=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(t){if(cc.warnID(9200),this._antiAliasEnabled!==t)if(this._antiAliasEnabled=t,cc.game.renderType===cc.game.RENDER_TYPE_WEBGL){var e,i=cc.loader._cache;for(e in i){var n,r=i[e],r=r&&r.content instanceof cc.Texture2D?r.content:null;r&&(n=cc.Texture2D.Filter,t?r.setFilters(n.LINEAR,n.LINEAR):r.setFilters(n.NEAREST,n.NEAREST))}}else{var s;cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&((s=cc.game.canvas.getContext("2d")).imageSmoothingEnabled=t,s.mozImageSmoothingEnabled=t)}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):(this._autoFullScreen=!1,cc.screen.disableAutoFullScreen(cc.game.frame))},isAutoFullScreenEnabled:function(){return this._autoFullScreen},setCanvasSize:function(t,e){var i=cc.game.canvas,n=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",n.style.width=t+"px",n.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(!0)},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.v2(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.v2(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e,i=this;t instanceof cc.ResolutionPolicy?i._resolutionPolicy=t:(t===(e=cc.ResolutionPolicy).EXACT_FIT&&(i._resolutionPolicy=i._rpExactFit),t===e.SHOW_ALL&&(i._resolutionPolicy=i._rpShowAll),t===e.NO_BORDER&&(i._resolutionPolicy=i._rpNoBorder),t===e.FIXED_HEIGHT&&(i._resolutionPolicy=i._rpFixedHeight),t===e.FIXED_WIDTH&&(i._resolutionPolicy=i._rpFixedWidth))},setDesignResolutionSize:function(t,e,i){var n;0<t||0<e?(this.setResolutionPolicy(i),(i=this._resolutionPolicy)&&i.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),i?(this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e,(t=i.apply(this,this._designResolutionSize)).scale&&2===t.scale.length&&(this._scaleX=t.scale[0],this._scaleY=t.scale[1]),t.viewport&&(e=this._viewportRect,n=this._visibleRect,t=t.viewport,e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,n.x=0,n.y=0,n.width=t.width/this._scaleX,n.height=t.height/this._scaleY),i.postApply(this),cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect),s.updateCameraViewport(),cc.internal.inputManager._updateCanvasBoundingRect(),this.emit("design-resolution-changed")):cc.logID(2201)):cc.logID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewportInPoints:function(t,e,i,n){var r=this._scaleX,s=this._scaleY;cc.game._renderContext.viewport(t*r+this._viewportRect.x,e*s+this._viewportRect.y,i*r,n*s)},setScissorInPoints:function(t,e,i,n){var r=this._scaleX,s=this._scaleY,t=Math.ceil(t*r+this._viewportRect.x),e=Math.ceil(e*s+this._viewportRect.y),i=Math.ceil(i*r),r=Math.ceil(n*s),n=cc.game._renderContext;_||(s=n.getParameter(n.SCISSOR_BOX),_=cc.rect(s[0],s[1],s[2],s[3])),_.x===t&&_.y===e&&_.width===i&&_.height===r||(_.x=t,_.y=e,_.width=i,_.height=r,n.scissor(t,e,i,r))},isScissorEnabled:function(){return cc.game._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){_||(t=gl.getParameter(gl.SCISSOR_BOX),_=cc.rect(t[0],t[1],t[2],t[3]));var t=1/this._scaleX,e=1/this._scaleY;return cc.rect((_.x-this._viewportRect.x)*t,(_.y-this._viewportRect.y)*e,_.width*t,_.height*e)},getViewportRect:function(){return this._viewportRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i,n){var n=n||cc.v2(),r=i.adjustedLeft||i.left,s=i.adjustedTop||i.top,t=this._devicePixelRatio*(t-r),r=this._devicePixelRatio*(s+i.height-e);return this._isRotated?(n.x=cc.game.canvas.width-r,n.y=t):(n.x=t,n.y=r),n},_convertMouseToLocationInView:function(t,e){var i=this._viewportRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY},_convertPointWithScale:function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n=this._viewportRect,r=this._scaleX,s=this._scaleY,a=0;a<t.length;a++)e=(i=t[a])._point,i=i._prevPoint,e.x=(e.x-n.x)/r,e.y=(e.y-n.y)/s,i.x=(i.x-n.x)/r,i.y=(i.y-n.y)/s}}),cc.ContainerStrategy=cc.Class({name:"ContainerStrategy",preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.canvas,r=(this._setupStyle(t,e,i),t._devicePixelRatio=1);t.isRetinaEnabled()&&(r=t._devicePixelRatio=Math.min(t._maxPixelRatio,window.devicePixelRatio||1)),n.width=e*r,n.height=i*r},_setupStyle:function(t,e,i){var n=cc.game.canvas,r=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px"},_fixContainer:function(){document.body.insertBefore(cc.game.container,document.body.firstChild);var t=document.body.style,t=(t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden",cc.game.container.style);t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class({name:"ContentStrategy",ctor:function(){this._result={scale:[1,1],viewport:null}},_buildResult:function(t,e,i,n,r,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);t=cc.rect((t-i)/2,(e-n)/2,i,n);return cc.game.renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[r,s],this._result.viewport=t,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),t=cc.Class({name:"EqualToFrame",extends:cc.ContainerStrategy,apply:function(t){var e=t._frameSize.height,i=cc.game.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.margin="0 0 0 "+e+"px":i.margin="0px",i.padding="0px"}}),l=cc.Class({name:"ProportionalToFrame",extends:cc.ContainerStrategy,apply:function(t,e){var i=t._frameSize.width,n=t._frameSize.height,r=cc.game.container.style,s=e.width,e=e.height,a=i/s,o=n/e,e=a<o?(l=i,e*a):(l=s*o,n),a=Math.round((i-l)/2),s=Math.round((n-e)/2),l=i-2*a;this._setupContainer(t,l,e=n-2*s),t._isRotated?r.margin="0 0 0 "+n+"px":r.margin="0px",r.paddingLeft=a+"px",r.paddingRight=a+"px",r.paddingTop=s+"px",r.paddingBottom=s+"px"}}),cc.Class({name:"EqualToWindow",extends:t,preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),cc.Class({name:"ProportionalToWindow",extends:l,preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),h=cc.Class({name:"OriginalContainer",extends:cc.ContainerStrategy,apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}),(c=("undefined"==typeof window?global:window).__globalAdapter)&&(c.adaptContainerStrategy&&c.adaptContainerStrategy(cc.ContainerStrategy.prototype),c.adaptView&&c.adaptView(o.prototype)),cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new l,cc.ContainerStrategy.ORIGINAL_CONTAINER=new h,c=cc.Class({name:"ExactFit",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=i/e.width,e=n/e.height;return this._buildResult(i,n,i,n,r,e)}}),t=cc.Class({name:"ShowAll",extends:cc.ContentStrategy,apply:function(t,e){var i,n=cc.game.canvas.width,r=cc.game.canvas.height,s=e.width,e=e.height,a=n/s,o=r/e,l=0,e=a<o?(i=n,e*(l=a)):(i=s*(l=o),r);return this._buildResult(n,r,i,e,l,l)}}),l=cc.Class({name:"NoBorder",extends:cc.ContentStrategy,apply:function(t,e){var i,n,r=cc.game.canvas.width,s=cc.game.canvas.height,a=e.width,e=e.height,o=r/a,l=s/e,a=o<l?(n=a*(i=l),s):(n=r,e*(i=o));return this._buildResult(r,s,n,a,i,i)}}),h=cc.Class({name:"FixedHeight",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,e=n/e.height;return this._buildResult(i,n,i,n,e,e)}}),u=cc.Class({name:"FixedWidth",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,e=i/e.width;return this._buildResult(i,n,i,n,e,e)}}),cc.ContentStrategy.EXACT_FIT=new c,cc.ContentStrategy.SHOW_ALL=new t,cc.ContentStrategy.NO_BORDER=new l,cc.ContentStrategy.FIXED_HEIGHT=new h,cc.ContentStrategy.FIXED_WIDTH=new u,cc.ResolutionPolicy=cc.Class({name:"cc.ResolutionPolicy",ctor:function(t,e){this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),r.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.view=new o,cc.winSize=cc.size(),e.exports=cc.view},{"../event/event-target":156,"../platform/CCClass":230,"../platform/js":250,"../renderer":262}],241:[function(t,e,i){"use strict";cc.visibleRect={topLeft:cc.v2(0,0),topRight:cc.v2(0,0),top:cc.v2(0,0),bottomLeft:cc.v2(0,0),bottomRight:cc.v2(0,0),bottom:cc.v2(0,0),center:cc.v2(0,0),left:cc.v2(0,0),right:cc.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,t=t.y,r=t+i,s=n+e;this.topLeft.x=n,this.topLeft.y=r,this.topRight.x=s,this.topRight.y=r,this.top.x=n+e/2,this.top.y=r,this.bottomLeft.x=n,this.bottomLeft.y=t,this.bottomRight.x=s,this.bottomRight.y=t,this.bottom.x=n+e/2,this.bottom.y=t,this.center.x=n+e/2,this.center.y=t+i/2,this.left.x=n,this.left.y=t+i/2,this.right.x=s,this.right.y=t+i/2}}},{}],242:[function(t,e,i){"use strict";var n=t("./js");t("./utils").isPlainEmptyObj_DEV;function s(t,e){e=e?Object.create(e):{};return n.value(t,"__attrs__",e),e}function o(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||function(t){if("function"!=typeof t)return s(t,o(t.constructor));for(var e,i=cc.Class.getInheritanceChain(t),n=i.length-1;0<=n;n--){var r=i[n];r.hasOwnProperty("__attrs__")&&r.__attrs__||s(r,(e=i[n+1])&&e.__attrs__)}return s(t,(e=i[0])&&e.__attrs__),t.__attrs__}(t)}function r(t,e){this.name=t,this.default=e}r.prototype.toString=function(){return this.name},cc.Integer=new r("Integer",0),cc.Float=new r("Float",0),cc.Boolean=new r("Boolean",!1),cc.String=new r("String",""),e.exports={PrimitiveType:r,attr:function(t,e,i){var n,r=o(t),s=e+"$_$",a={};for(n in r)n.startsWith(s)&&(a[n.slice(s.length)]=r[n]);return a},getClassAttrs:o,setClassAttr:function(t,e,i,n){o(t)[e+"$_$"+i]=n},DELIMETER:"$_$",getTypeChecker_ET:!1,getObjTypeChecker_ET:!1,ScriptUuid:{}}},{"./CCClass":230,"./js":250,"./utils":254}],243:[function(t,e,i){"use strict";var n=t("./js"),o=n.array.fastRemoveAt;function r(){}function s(){this.callback=r,this.target=void 0,this.once=!1}s.prototype.set=function(t,e,i){this.callback=t,this.target=e,this.once=!!i};var l=new n.Pool(function(t){return t.callback=r,t.target=void 0,!(t.once=!1)},32);function a(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}l.get=function(){return this._get()||new s};var t=a.prototype,h=(t.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.callback===t&&(l.put(i),o(this.callbackInfos,e),--e)}},t.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.target===t&&(l.put(i),o(this.callbackInfos,e),--e)}},t.cancel=function(t){var e=this.callbackInfos[t];e&&(l.put(e),this.callbackInfos[t]=null),this.containCanceled=!0},t.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(l.put(e),this.callbackInfos[t]=null)}this.containCanceled=!0},t.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;0<=t;--t)this.callbackInfos[t]||o(this.callbackInfos,t);this.containCanceled=!1},t.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},new n.Pool(function(t){return t.callbackInfos=[],t.isInvoking=!1,!(t.containCanceled=!1)},16));function c(){this._callbackTable=n.createMap(!0)}h.get=function(){return this._get()||new a},(t=c.prototype).on=function(t,e,i,n){var r=(r=this._callbackTable[t])||(this._callbackTable[t]=h.get()),t=l.get();t.set(e,i,n),r.callbackInfos.push(t)},t.hasEventListener=function(t,e,i){t=this._callbackTable[t];if(t){var n=t.callbackInfos;if(!e){if(t.isInvoking){for(var r=0;r<n.length;++r)if(n[r])return!0;return!1}return 0<n.length}for(var s=0;s<n.length;++s){var a=n[s];if(a&&a.callback===e&&a.target===i)return!0}}return!1},t.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(e.clear(),h.put(e),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var n=this._callbackTable[i];if(n.isInvoking)for(var r=n.callbackInfos,s=0;s<r.length;++s){var a=r[s];a&&a.target===t&&n.cancel(s)}else n.removeByTarget(t)}},t.off=function(t,e,i){var n=this._callbackTable[t];if(n)for(var r=n.callbackInfos,s=0;s<r.length;++s){var a=r[s];if(a&&a.callback===e&&a.target===i){n.isInvoking?n.cancel(s):(o(r,s),l.put(a));break}}},t.emit=function(t,e,i,n,r,s){var a=this._callbackTable[t];if(a){var o=!a.isInvoking;a.isInvoking=!0;for(var l=a.callbackInfos,h=0,c=l.length;h<c;++h){var u,_,d=l[h];d&&(u=d.target,_=d.callback,d.once&&this.off(t,_,u),u?_.call(u,e,i,n,r,s):_(e,i,n,r,s))}o&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled())}},e.exports=c},{"./js":250}],244:[function(t,e,i){"use strict";e.exports={flattenCodeArray:function(t){var e=[];return function t(e,i){for(var n=0;n<i.length;n++){var r=i[n];Array.isArray(r)?t(e,r):e.push(r)}}(e,t),e.join("")}}},{}],245:[function(t,e,i){"use strict";function o(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this._stillUseUrl=m.createMap(!0)}var f,m=t("./js"),y=t("./attribute"),g=t("./CCClass"),v=t("../utils/misc"),l=(o.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,m.clear(this._stillUseUrl)},o.prototype.push=function(t,e,i,n){n&&(this._stillUseUrl[this.uuidList.length]=!0),this.uuidList.push(i),this.uuidObjList.push(t),this.uuidPropList.push(e)},(o.pool=new m.Pool(function(t){t.reset()},10)).get=function(){return this._get()||new o},(t=a.prototype).deserialize=function(t){if(Array.isArray(t)){var e=t,i=e.length;this.deserializedList.length=i;for(var n=0;n<i;n++)e[n]&&(this.deserializedList[n]=this._deserializeObject(e[n],!1));this.deserializedData=0<i?this.deserializedList[0]:[]}else this.deserializedList.length=1,this.deserializedData=t?this._deserializeObject(t,!1):null,this.deserializedList[0]=this.deserializedData;var r,s,a,t=this,o=t.deserializedList,l=t._idPropList,h=t._idList,c=t._idObjList;for(t._classFinder&&t._classFinder.onDereferenced,r=0;r<h.length;r++)s=l[r],a=h[r],c[r][s]=o[a];return this.deserializedData},t._deserializeObject=function(t,e,i,n,r){var s,a,o,l=null,h=null,c=t.__type__;if("TypedArray"===c)for(var u=t.array,l=new window[t.ctor](u.length),_=0;_<u.length;++_)l[_]=u[_];else if(c){if(!(h=this._classFinder(c,t,n,r)))return this._classFinder===m._getClassById&&cc.deserialize.reportMissingClass(c),null;if((l=new h)._deserialize)return l._deserialize(t.content,this),l;cc.Class._isCCClass(h)?(n=this,r=l,c=t,i=i,(a=h).hasOwnProperty("__deserialize__")?o=a.__deserialize__:(o=f(n,a),m.value(a,"__deserialize__",o,!0)),o(n,r,c,a,i)):this._deserializeTypedObject(l,t,h)}else if(Array.isArray(t)){l=new Array(t.length);for(var d=0;d<t.length;d++)"object"==typeof(s=t[d])&&s?this._deserializeObjField(l,s,""+d,null,e):l[d]=s}else this._deserializePrimitiveObject(l={},t);return l},t._deserializeObjField=function(t,e,i,n,r){var s,a=e.__id__;void 0===a?(s=e.__uuid__)?this.result.push(t,i,s,r):t[i]=this._deserializeObject(e,r):(s=this.deserializedList[a])?t[i]=s:(this._idList.push(a),this._idObjList.push(t),this._idPropList.push(i))},t._deserializePrimitiveObject=function(t,e){for(var i in e){var n;e.hasOwnProperty(i)&&("object"!=typeof(n=e[i])?"__type__"!==i&&(t[i]=n):n?this._deserializeObjField(t,n,i):t[i]=null)}},t._deserializeTypedObject=function(t,e,i){if(i===cc.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i===cc.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(i!==cc.Color){if(i===cc.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var n=y.DELIMETER+"default",r=y.getClassAttrs(i),s=i.__props__||Object.keys(t),a=0;a<s.length;a++){var o=s[a],l=e[o];"object"!=typeof(l=void 0!==l&&e.hasOwnProperty(o)?l:g.getDefault(r[o+n]))?t[o]=l:l?this._deserializeObjField(t,l,o):t[o]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;i=e.a;t.a=void 0===i?255:i}},f=function(t,e){for(var i=y.DELIMETER+"type",n=(y.DELIMETER,y.DELIMETER+"default"),r=y.DELIMETER+"saveUrlAsAsset",s=y.DELIMETER+"formerlySerializedAs",a=y.getClassAttrs(e),o=e.__values__,l=["var prop;"],h=v.BUILTIN_CLASSID_RE.test(m._getClassId(e)),c=0;c<o.length;c++){var u,_=o[c],d=g.IDENTIFIER_RE.test(_)?(u='"'+_+'"',"."+_):"["+(u=g.escapeForJS(_))+"]",f=d,p=(a[_+s]&&(p=a[_+s],f=g.IDENTIFIER_RE.test(p)?"."+p:"["+g.escapeForJS(p)+"]"),l.push("prop=d"+f+";"),l.push('if(typeof prop!=="undefined"){'),a[_+r]),f=g.getDefault(a[_+n]);h?(_=a[_+i],(void 0===f&&_?_ instanceof y.PrimitiveType:"string"==(_=typeof f)&&!p||"number"==_||"boolean"==_)?l.push("o"+d+"=prop;"):b(l,f,d,u,!0,p)):(l.push('if(typeof prop!=="object"){o'+d+"=prop;}else{"),b(l,f,d,u,!1,p),l.push("}")),l.push("}")}return(cc.js.isChildClassOf(e,cc._BaseNode)||cc.js.isChildClassOf(e,cc.Component))&&l.push("d._id&&(o._id=d._id);"),"_$erialized"===o[o.length-1]&&(l.push("o._$erialized=JSON.parse(JSON.stringify(d));"),l.push("s._deserializePrimitiveObject(o._$erialized,d);")),Function("s","o","d","k","t",l.join(""))},(a.pool=new m.Pool(function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0},1)).get=function(t,e,i,n,r){var s=this._get();return s?(s.result=t,s.customEnv=n,s._classFinder=i,s):new a(t,0,i,n)},a);function a(t,e,i,n,r){this.result=t,this.customEnv=n,this.deserializedList=[],this.deserializedData=null,this._classFinder=i,this._idList=[],this._idObjList=[],this._idPropList=[]}function b(t,e,i,n,r,s){e instanceof cc.ValueType?(r||t.push("if(prop){"),e=m.getClassName(e),t.push("s._deserializeTypedObject(o"+i+",prop,"+e+");"),r||t.push("}else o"+i+"=null;")):(t.push("if(prop){"),t.push("s._deserializeObjField(o,prop,"+n+",null,"+!!s+");"),t.push("}else o"+i+"=null;"))}cc.deserialize=function(t,e,i){var n=(i=i||{}).classFinder||m._getClassById,r=i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,s=i.customEnv,i=i.ignoreEditorOnly,a=("string"==typeof t&&(t=JSON.parse(t)),!e),n=(e=e||o.pool.get(),l.pool.get(e,!1,n,s,i)),s=(cc.game._isCloning=!0,n.deserialize(t));return cc.game._isCloning=!1,l.pool.put(n),r&&e.assignAssetsBy(Editor.serialize.asAsset),a&&o.pool.put(e),s},cc.deserialize.Details=o,cc.deserialize.reportMissingClass=function(t){cc.warnID(5302,t)}},{"../utils/misc":315,"./CCClass":230,"./attribute":242,"./js":250}],246:[function(t,e,i){"use strict";function n(t){this.id=0|998*Math.random(),this.prefix=t?t+".":""}n.prototype.getNewId=function(){return this.prefix+ ++this.id},n.global=new n("global"),e.exports=n},{}],247:[function(t,e,i){"use strict";t("./js"),t("./CCClass"),t("./CCClassDecorator"),t("./CCEnum"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./instantiate-jit"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),t("./CCAssetLibrary"),t("./CCVisibleRect")},{"./CCAssetLibrary":229,"./CCClass":230,"./CCClassDecorator":231,"./CCEnum":232,"./CCMacro":235,"./CCObject":236,"./CCSys":239,"./CCVisibleRect":241,"./callbacks-invoker":243,"./deserialize":245,"./instantiate":249,"./instantiate-jit":248,"./js":250,"./requiring-frame":252,"./url":253}],248:[function(t,e,i){"use strict";var a=t("./CCObject"),n=a.Flags.Destroyed,o=a.Flags.PersistentMask,c=t("./attribute"),s=t("./js"),u=t("./CCClass"),l=t("./compiler"),_=c.DELIMETER+"default",r=u.IDENTIFIER_RE,h=u.escapeForJS,d={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};try{Float32Array.name||(Float32Array.name="Float32Array"),Float64Array.name||(Float64Array.name="Float64Array"),Int8Array.name||(Int8Array.name="Int8Array"),Int16Array.name||(Int16Array.name="Int16Array"),Int32Array.name||(Int32Array.name="Int32Array"),Uint8Array.name||(Uint8Array.name="Uint8Array"),Uint16Array.name||(Uint16Array.name="Uint16Array"),Uint32Array.name||(Uint32Array.name="Uint32Array")}catch(t){}function f(t,e){this.varName=t,this.expression=e}function p(t,e){return e instanceof f?new f(e.varName,t+e.expression):t+e}function m(t,e,i){Array.isArray(i)?(i[0]=p(e,i[0]),t.push(i)):t.push(p(e,i)+";")}function y(t){this._exps=[],this._targetExp=t}function g(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e){if(t instanceof cc.ValueType&&t.equals(e))return!0;if(Array.isArray(t)&&Array.isArray(e)||t.constructor===Object&&e.constructor===Object)try{return Array.isArray(t)&&Array.isArray(e)&&0===t.length&&0===e.length}catch(t){}}return!1}function v(t){return r.test(t)?"."+t:"["+h(t)+"]"}function b(t,e){this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=s.createMap(),s.mixin(this.funcModuleCache,d),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),s.value(t,"_iN$t",{globalVar:"R"},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),0<this.globalVariables.length&&(i="var "+this.globalVariables.join(",")+";");var i,e=l.flattenCodeArray(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",e)(this.objs,this.funcs);for(var n=0,r=this.objsToClear_iN$t.length;n<r;++n)this.objsToClear_iN$t[n]._iN$t=null;this.objsToClear_iN$t.length=0}f.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},y.prototype.append=function(t,e){this._exps.push([t,e])},y.prototype.writeCode=function(t){var e;if(1<this._exps.length)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var i=0;i<this._exps.length;i++){var n=this._exps[i];m(t,e+v(n[0])+"=",n[1])}},(y.pool=new s.Pool(function(t){t._exps.length=0,t._targetExp=null},1)).get=function(t){var e=this._get()||new y;return e._targetExp=t,e};var x=b.prototype;x.getFuncModule=function(t,e){var i=s.getClassName(t);if(i){var n=this.funcModuleCache[i];if(n)return n;if(void 0===n)if(-1!==i.indexOf("."))try{if(t===Function("return "+i)())return this.funcModuleCache[i]=i}catch(t){}}n=this.funcs.indexOf(t),n<0&&(n=this.funcs.length,this.funcs.push(t)),n="F["+n+"]";return this.funcModuleCache[i]=n=e?"("+n+")":n},x.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},x.setValueType=function(t,e,i,n){for(var r=y.pool.get(n),s=(s=e.constructor.__props__)||Object.keys(e),a=0;a<s.length;a++){var o=s[a],l=i[o];e[o]!==l&&(l=this.enumerateField(i,o,l),r.append(o,l))}r.writeCode(t),y.pool.put(r)},x.enumerateCCClass=function(t,e,i){for(var n=i.__values__,r=c.getClassAttrs(i),s=0;s<n.length;s++){var a,o=n[s],l=e[o],h=r[o+_];g(h,l)||("object"==typeof l&&l instanceof cc.ValueType&&(h=u.getDefault(h))&&h.constructor===l.constructor?(a="o"+v(o),this.setValueType(t,h,l,a)):this.setObjProp(t,e,o,l))}},x.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,i=[new f(e,"new Array("+t.length+")")];s.value(t,"_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(t);for(var n=0;n<t.length;++n)m(i,e+"["+n+"]=",this.enumerateField(t,n,t[n]));return i},x.instantiateTypedArray=function(t){var e=t.constructor.name||function(t){if(t===Float32Array)return"Float32Array";if(t===Float64Array)return"Float64Array";if(t===Int8Array)return"Int8Array";if(t===Int16Array)return"Int16Array";if(t===Int32Array)return"Int32Array";if(t===Uint8Array)return"Uint8Array";if(t===Uint16Array)return"Uint16Array";if(t===Uint32Array)return"Uint32Array";throw new Error("Unknown TypedArray could not be instantiated: "+t)}(t.constructor);if(0===t.length)return"new "+e;var i="a"+ ++this.localVariableId,n=[new f(i,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)0!==t[r]&&m(n,i+"["+r+"]=",t[r]);return n},x.enumerateField=function(t,e,i){var n,r,s;return"object"==typeof i&&i?(n=i._iN$t)?((r=n.globalVar)||(r=n.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r),s=n.source[0],n.source[0]=p(r+"=",s)),r):ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i):"function"==typeof i?this.getFuncModule(i):"string"==typeof i?h(i):("_objFlags"===e&&t instanceof a&&(i&=o),i)},x.setObjProp=function(t,e,i,n){m(t,"o"+v(i)+"=",this.enumerateField(e,i,n))},x.enumerateObject=function(t,e){var i,n=e.constructor;if(cc.Class._isCCClass(n))this.enumerateCCClass(t,e,n);else for(var r in e)!e.hasOwnProperty(r)||95===r.charCodeAt(0)&&95===r.charCodeAt(1)&&"__type__"!==r||("object"==typeof(i=e[r])&&i&&i===e._iN$t||this.setObjProp(t,e,r,i))},x.instantiateObj=function(t){if(t instanceof cc.ValueType)return u.getNewValueTypeCode(t);if(t instanceof cc.Asset)return this.getObjRef(t);if(t._objFlags&n)return null;var e,i=t.constructor;if(cc.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return this.getObjRef(t)}else if(this.parent instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof cc.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new f("o","new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)e=new f("o","{}");else{if(i)return this.getObjRef(t);e=new f("o","Object.create(null)")}i=[e];return s.value(t,"_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(i,t),["(function(){",i,"return o;})();"]},e.exports={compile:function(t){return new b(t,t instanceof cc._BaseNode&&t).result},equalsToDefault:g}},{"./CCClass":230,"./CCObject":236,"./attribute":242,"./compiler":244,"./js":250}],249:[function(t,e,i){"use strict";var f=t("./CCObject"),p=t("../value-types/value-type"),h=f.Flags.Destroyed,m=f.Flags.PersistentMask,s=t("./utils").isDomNode,y=t("./js");function n(t,e){if(!e){if("object"!=typeof t||Array.isArray(t))return null;if(!t)return null;if(!cc.isValid(t))return null}var i;if(t instanceof f){if(t._instantiate)return cc.game._isCloning=!0,i=t._instantiate(),cc.game._isCloning=!1,i;if(t instanceof cc.Asset)return null}return cc.game._isCloning=!0,i=r(t),cc.game._isCloning=!1,i}var g=[];function r(t,e){if(Array.isArray(t))return null;if(s&&s(t))return null;var i=t._iN$t||(t.constructor?new t.constructor:Object.create(null));c(t,i,e);for(var n=0,r=g.length;n<r;++n)g[n]._iN$t=null;return g.length=0,i}function c(t,e,i){y.value(t,"_iN$t",e,!0),g.push(t);var n=t.constructor;if(cc.Class._isCCClass(n)){var r=t;var s=e;var a=i;for(var o=n.__values__,l=0;l<o.length;l++){var h,c=o[l],u=r[c];"object"==typeof u&&u?(h=s[c])instanceof p&&h.constructor===u.constructor?h.set(u):s[c]=u._iN$t||v(u,a):s[c]=u}}else for(var _ in t)if(t.hasOwnProperty(_)&&(95!==_.charCodeAt(0)||95!==_.charCodeAt(1)||"__type__"===_)){var d=t[_];if("object"==typeof d&&d){if(d===e)continue;e[_]=d._iN$t||v(d,i)}else e[_]=d}t instanceof f&&(e._objFlags&=m)}function v(t,e){if(t instanceof p)return t.clone();if(t instanceof cc.Asset)return t;if(ArrayBuffer.isView(t)){var i=t.length,n=new t.constructor(i);t._iN$t=n,g.push(t);for(var r=0;r<i;++r)n[r]=t[r];return n}if(Array.isArray(t)){var s=t.length;n=new Array(s),y.value(t,"_iN$t",n,!0),g.push(t);for(var a=0;a<s;++a){var o=t[a];n[a]="object"==typeof o&&o?o._iN$t||v(o,e):o}return n}if(t._objFlags&h)return null;var l=t.constructor;if(cc.Class._isCCClass(l)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t;n=new l}else if(l===Object)n={};else{if(l)return t;n=Object.create(null)}return c(t,n,e),n}n._clone=r,cc.instantiate=n,e.exports=n},{"../value-types/value-type":338,"./CCObject":236,"./js":250,"./utils":254}],250:[function(t,e,i){"use strict";var n=new(t("./id-generater"))("TmpCId.");function r(t,e){for(;t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}return null}function s(t,e,i){e=r(e,t);Object.defineProperty(i,t,e)}var a,o,l,h={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n)if("object"!=typeof n)cc.errorID(5402,n);else for(var r in n)r in t||s(r,n,t)}return t},mixin:function(t){t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n)if("object"!=typeof n)cc.errorID(5403,n);else for(var r in n)s(r,n,t)}return t},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t},getSuper:function(t){t=t.prototype,t=t&&Object.getPrototypeOf(t);return t&&t.constructor},isChildClassOf:function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=h.getSuper(t)))return!1;if(t===e)return!0}}return!1},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},isEmptyObject:function(t){for(var e in t)return!1;return!0},getPropertyDescriptor:r},c={value:void 0,enumerable:!1,writable:!1,configurable:!0},u={get:null,set:null,enumerable:!(h.value=function(t,e,i,n,r){c.value=i,c.writable=n,c.enumerable=r,Object.defineProperty(t,e,c),c.value=void 0})},_={get:null,enumerable:!(h.getset=function(t,e,i,n,r,s){"function"!=typeof n&&(r=n,n=void 0),u.get=i,u.set=n,u.enumerable=r,u.configurable=s,Object.defineProperty(t,e,u),u.get=null,u.set=null}),configurable:!1},d={set:null,enumerable:!(h.get=function(t,e,i,n,r){_.get=i,_.enumerable=n,_.configurable=r,Object.defineProperty(t,e,_),_.get=null}),configurable:!1};function f(n,t,r){return h.getset(h,t,function(){return Object.assign({},r)},function(t){h.clear(r),Object.assign(r,t)}),function(t,e){var i;e.prototype.hasOwnProperty(n)&&delete r[e.prototype[n]],h.value(e.prototype,n,t),t&&((i=r[t])&&i!==e?cc.error("A Class already exists with the same "+n+' : "'+t+'".'):r[t]=e)}}h.set=function(t,e,i,n,r){d.set=i,d.enumerable=n,d.configurable=r,Object.defineProperty(t,e,d),d.set=null},h.getClassName=function(t){if("function"!=typeof t)return t&&t.constructor?h.getClassName(t.constructor):"";var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;e="";return t.name&&(e=t.name),"Object"!==(e=t.toString&&(t="["===(t=t.toString()).charAt(0)?t.match(/\[\w+\s*(\w+)\]/):t.match(/function\s*(\w+)/))&&2===t.length?t[1]:e)?e:""},a={},o={},h._setClassId=f("__cid__","_registeredClassIds",a),l=f("__classname__","_registeredClassNames",o),h.setClassName=function(t,e){l(t,e),e.prototype.hasOwnProperty("__cid__")||(t=t||n.getNewId())&&h._setClassId(t,e)},h.unregisterClass=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t].prototype,i=e.__cid__,i=(i&&delete a[i],e.__classname__);i&&delete o[i]}},h._getClassById=function(t){return a[t]},h.getClassByName=function(t){return o[t]},h._getClassId=function(t,e){if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return t.__cid__}return""},h.obsolete=function(t,e,i,n){var r=/([^.]+)$/,e=r.exec(e)[0],s=r.exec(i)[0];function a(){return this[s]}n?h.getset(t,e,a,function(t){this[s]=t}):h.get(t,e,a)},h.obsoletes=function(t,e,i,n){for(var r in i){var s=i[r];h.obsolete(t,e+"."+r,s,n)}};var p=/(%d)|(%s)/,m=/%s/;function y(t,e){t.splice(e,1)}function g(t,e){e=t.indexOf(e);return 0<=e&&(y(t,e),!0)}h.formatStr=function(){var t=arguments.length;if(0===t)return"";var e=arguments[0];if(1===t)return""+e;if("string"==typeof e&&p.test(e))for(var i=1;i<t;++i){var n=arguments[i],r="number"==typeof n?p:m;r.test(e)?e=e.replace(r,n):e+=" "+n}else for(var s=1;s<t;++s)e+=" "+arguments[s];return e},h.shiftArguments=function(){for(var t=arguments.length-1,e=new Array(t),i=0;i<t;++i)e[i]=arguments[i+1];return e},h.createMap=function(t){var e=Object.create(null);return t&&(e["."]=!0,e["/"]=!0,delete e["."],delete e["/"]),e};var v=Array.prototype.indexOf;function b(t,e){void 0===e&&(e=t,t=null),this.get=null,this.count=0,this._pool=new Array(e),this._cleanup=t}h.array={remove:g,fastRemove:function(t,e){e=t.indexOf(e);0<=e&&(t[e]=t[t.length-1],--t.length)},removeAt:y,fastRemoveAt:function(t,e){var i=t.length;e<0||i<=e||(t[e]=t[i-1],t.length=i-1)},contains:function(t,e){return 0<=t.indexOf(e)},verifyType:function(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.logID(1300),!1;return!0},removeArray:function(t,e){for(var i=0,n=e.length;i<n;i++)g(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},copy:function(t){for(var e=t.length,i=new Array(e),n=0;n<e;n+=1)i[n]=t[n];return i},indexOf:v,MutableForwardIterator:t("../utils/mutable-forward-iterator")},b.prototype._get=function(){var t;return 0<this.count?(--this.count,t=this._pool[this.count],this._pool[this.count]=null,t):null},b.prototype.put=function(t){var e=this._pool;this.count<e.length&&(this._cleanup&&!1===this._cleanup(t)||(e[this.count]=t,++this.count))},b.prototype.resize=function(t){0<=t&&(this._pool.length=t,this.count>t&&(this.count=t))},h.Pool=b,cc.js=h,e.exports=h},{"../utils/mutable-forward-iterator":316,"./id-generater":246}],251:[function(t,e,o){"use strict";var s=t("./js"),a=t("./attribute"),l={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function h(t,e,i,n){t=t?{_short:!0}:{_short:!0,default:e};return i&&(n?t.url=i:t.type=i),t}o.getFullFormOfProperty=function(t,e,i,n){return t&&t.constructor===Object?null:Array.isArray(t)&&0<t.length?(t[0],h(e,[],t)):"function"==typeof t?(r=t,cc.RawAsset.isRawAssetType(r)||cc.RawAsset.wasRawAssetType(r)?h(e,"",r,!0):h(e,s.isChildClassOf(r,cc.ValueType)?new r:null,r)):t instanceof a.PrimitiveType?h(e,t.default):h(e,t);var r},o.preprocessAttrs=function(t,e,i,n){for(var r in t){var s=t[r],a=o.getFullFormOfProperty(s,!1,r,e);(s=a?t[r]=a:s)&&((a=s.notify)&&function(t,e,i,n){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r,s="_N$"+e,a=(t.get=function(){return this[s]},t.set=function(t){var e=this[s];this[s]=t,i.call(this,e)},{});for(r in n[s]=a,l){var o=l[r];t.hasOwnProperty(r)&&(a[r]=t[r],o.canUsedInGet||delete t[r])}}}(s,r,a,t),"type"in s&&function(t,e,i,n){if(Array.isArray(e)){if(!(0<e.length))return cc.errorID(5508,i,n);if(cc.RawAsset.isRawAssetType(e[0]))return t.url=e[0],delete t.type;t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=cc.String:e===Boolean?t.type=cc.Boolean:e===Number&&(t.type=cc.Float))}(s,s.type,e,r),"url"in s&&(r=(a=s).url,Array.isArray(r)&&0<r.length&&(r=r[0]),a.type=r),"type"in s&&s.type)}},o.validateMethodWithProps=function(t,e,i,n,r){return"function"==typeof t||null===t}},{"./CCClass":230,"./attribute":242,"./js":250}],252:[function(t,e,i){"use strict";var r=[];cc._RF={push:function(t,e,i){void 0===i&&(i=e,e=""),r.push({uuid:e,script:i,module:t,exports:t.exports,beh:null})},pop:function(){var t=r.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var n in i)return;e.exports=t.cls}},peek:function(){return r[r.length-1]}}},{}],253:[function(t,e,i){"use strict";cc.url={_rawAssets:"",normalize:function(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t},raw:function(t){if((t=this.normalize(t)).startsWith("resources/")){var e=cc.loader._getResUuid(t.slice(10),cc.Asset,null,!0);if(e)return cc.AssetLibrary.getLibUrlNoExt(e,!0)+cc.path.extname(t)}else cc.errorID(7002,t);return this._rawAssets+t},_init:function(t){this._rawAssets=cc.path.stripSep(t)+"/"}},e.exports=cc.url},{}],254:[function(t,e,i){"use strict";t("./js"),e.exports={contains:function(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0}while(null!==(i=i.parentNode));return!1},isDomNode:"object"==typeof window&&("function"==typeof Node?function(t){return t instanceof Node}:function(t){return t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}),callInNextTick:function(t,e,i){t&&setTimeout(function(){t(e,i)},0)}}},{"./js":250}],255:[function(t,e,i){"use strict";t("./platform/js"),t("./value-types"),t("./utils"),t("./platform/CCInputManager"),t("./platform/CCInputExtension"),t("./event"),t("./platform/CCSys"),t("./platform/CCMacro"),t("./load-pipeline"),t("./CCDirector"),t("./renderer"),t("./platform/CCView"),t("./platform/CCScreen"),t("./CCScheduler"),t("./event-manager")},{"./CCDirector":70,"./CCScheduler":75,"./event":158,"./event-manager":154,"./load-pipeline":185,"./platform/CCInputExtension":233,"./platform/CCInputManager":234,"./platform/CCMacro":235,"./platform/CCScreen":238,"./platform/CCSys":239,"./platform/CCView":240,"./platform/js":250,"./renderer":262,"./utils":313,"./value-types":330}],256:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=a(t("./assembler")),r=a(t("./utils/dynamic-atlas/manager")),s=a(t("./webgl/render-data"));function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}l=n.default,t=l,(n=c).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=c.prototype).initData=function(){this._renderData.createQuadData(0,this.verticesFloats,this.indicesCount)},n.initLocal=function(){this._local=[],this._local.length=4},n.updateColor=function(t,e){var i=this._renderData.uintVDatas[0];if(i){e=e||t.node.color._val;for(var n=this.floatsPerVert,r=this.colorOffset,s=i.length;r<s;r+=n)i[r]=e}},n.getBuffer=function(){return cc.renderer._handle._meshBuffer},n.updateWorldVerts=function(t){var e,i,n,r=this._local,s=this._renderData.vDatas[0],t=t.node._worldMatrix.m,a=t[0],o=t[1],l=t[4],h=t[5],c=t[12],t=t[13],u=r[0],_=r[2],d=r[1],r=r[3];1===a&&0===o&&0===l&&1===h?(s[0]=u+c,s[1]=d+t,s[5]=_+c,s[6]=d+t,s[10]=u+c,s[11]=r+t,s[15]=_+c,s[16]=r+t):(e=a*_,i=o*u,o=o*_,_=l*r,n=h*d,h=h*r,s[0]=(r=a*u)+(a=l*d)+c,s[1]=i+n+t,s[5]=e+a+c,s[6]=o+n+t,s[10]=r+_+c,s[11]=i+h+t,s[15]=e+_+c,s[16]=o+h+t)},n.fillBuffers=function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);var t=this._renderData,i=t.vDatas[0],n=t.iDatas[0],t=this.getBuffer(e),e=t.request(this.verticesCount,this.indicesCount),r=e.byteOffset>>2,s=t._vData;i.length+r>s.length?s.set(i.subarray(0,s.length-r),r):s.set(i,r);for(var a=t._iData,o=e.indiceOffset,l=e.vertexOffset,h=0,c=n.length;h<c;h++)a[o++]=l+n[h]},n.packToDynamicAtlas=function(t,e){!e._original&&r.default&&e._texture.packable&&(i=r.default.insertSpriteFrame(e))&&e._setDynamicAtlasFrame(i);var i=t._materials[0];i&&i.getProperty("texture")!==e._texture&&(t._vertsDirty=!0,t._updateMaterial())},t=c,(n=[{key:"verticesFloats",get:function(){return this.verticesCount*this.floatsPerVert}}])&&o(t.prototype,n),h&&o(t,h);var l,h,n=c;function c(){var t;return(t=l.call(this)||this)._renderData=new s.default,t._renderData.init(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)),t.initData(),t.initLocal(),t}i.default=n,cc.js.addon(n.prototype,{floatsPerVert:5,verticesCount:4,indicesCount:6,uvOffset:2,colorOffset:4}),cc.Assembler2D=n,e.exports=i.default},{"./assembler":259,"./utils/dynamic-atlas/manager":265,"./webgl/render-data":301}],257:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;for(var n=t("./webgl/vertex-format"),o=(t=t("../value-types/vec3"))&&t.__esModule?t:{default:t},l=[],r=0;r<4;r++)l.push(cc.v3());t={floatsPerVert:6,uvOffset:3,colorOffset:5,getBuffer:function(t){return t._meshBuffer3D},getVfmt:function(){return n.vfmt3D},updateWorldVerts:function(t){var e=t.node._worldMatrix,t=this._local,i=this._renderData.vDatas[0];o.default.set(l[0],t[0],t[1],0),o.default.set(l[1],t[2],t[1],0),o.default.set(l[2],t[0],t[3],0),o.default.set(l[3],t[2],t[3],0);for(var n=this.floatsPerVert,r=0;r<4;r++){var s=l[r],a=(o.default.transformMat4(s,s,e),n*r);i[a]=s.x,i[1+a]=s.y,i[2+a]=s.z}}},t=cc.Assembler3D=t;i.default=t,e.exports=i.default},{"../value-types/vec3":340,"./webgl/vertex-format":303}],258:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../utils/pool"))&&t.__esModule?t:{default:t};var n=0;function r(t){return Object.getOwnPropertyDescriptor(t,"__assemblerId__")||(t.__assemblerId__=++n),t.__assemblerId__}s=t.default,o=s,(a=l).prototype=Object.create(o.prototype),(a.prototype.constructor=a).__proto__=o,(a=l.prototype).put=function(t){var e,i;t&&this.enabled&&(e=r(t.constructor),(i=this._pool)[e]||(i[e]=[]),this.count>this.maxSize||(this._clean(t),i[e].push(t),this.count++))},a.get=function(t){var e,i,n;return(n=this.enabled?(e=this._pool)[i=r(t)]&&e[i].pop():n)?this.count--:n=new t,n},a.clear=function(){this._pool={},this.count=0},a._clean=function(t){t._renderComp=null};var s,a,o=new l;function l(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(t=s.call.apply(s,[this].concat(i))||this)._pool={},t}t.default.register("assembler",o),i.default=o,e.exports=i.default},{"../utils/pool":317}],259:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("./webgl/vertex-format"),r=(t=t("./assembler-pool"))&&t.__esModule?t:{default:t},t=((t=s.prototype).init=function(t){this._renderComp=t},t.updateRenderData=function(t){},t.fillBuffers=function(t,e){},t.getVfmt=function(){return n.vfmtPosUvColor},s);function s(){this._extendNative&&this._extendNative()}(i.default=t).register=function(t,e){t.__assembler__=e},t.init=function(t){for(var e,i=t.constructor,n=i.__assembler__;!n;){if(!(i=i.$super))return void cc.warn("Can not find assembler for render component : ["+cc.js.getClassName(t)+"]");n=i.__assembler__}n.getConstructor&&(n=n.getConstructor(t)),t._assembler&&t._assembler.constructor===n||((e=r.default.get(n)).init(t),t._assembler=e)},cc.Assembler=t,e.exports=i.default},{"./assembler-pool":258,"./webgl/vertex-format":303}],260:[function(t,e,i){"use strict";function n(t){var e;try{e=t.getContext("2d")}catch(t){return void console.error(t)}this._canvas=t,this._ctx=e,this._caps={},this._stats={drawcalls:0},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0}n.prototype._restoreTexture=function(t){},n.prototype.setViewport=function(t,e,i,n){this._vx===t&&this._vy===e&&this._vw===i&&this._vh===n||(this._vx=t,this._vy=e,this._vw=i,this._vh=n)},n.prototype.setScissor=function(t,e,i,n){this._sx===t&&this._sy===e&&this._sw===i&&this._sh===n||(this._sx=t,this._sy=e,this._sw=i,this._sh=n)},n.prototype.clear=function(t){var e=this._ctx;e.clearRect(this._vx,this._vy,this._vw,this._vh),!t||0===t[0]&&0===t[1]&&0===t[2]||(e.fillStyle="rgb("+t[0]+","+t[1]+","+t[2]+")",e.globalAlpha=t[3],e.fillRect(this._vx,this._vy,this._vw,this._vh))},n.prototype.resetDrawCalls=function(){this._stats.drawcalls=0},n.prototype.getDrawCalls=function(){return this._stats.drawcalls},e.exports=n},{}],261:[function(t,e,i){"use strict";function n(t,e){this._device=t,this._width=4,this._height=4,this._image=null,e&&(void 0!==e.width&&(this._width=e.width),void 0!==e.height&&(this._height=e.height),this.updateImage(e))}n.prototype.update=function(t){this.updateImage(t)},n.prototype.updateImage=function(t){t.images&&t.images[0]&&((t=t.images[0])&&t!==this._image&&(this._image=t))},n.prototype.destroy=function(){this._image=null},e.exports=n},{}],262:[function(s,t,e){"use strict";e.__esModule=!0,e.default=void 0;var a=r(s("../../renderer/gfx")),i=r(s("../../renderer/core/input-assembler")),n=r(s("../../renderer/core/pass"));function r(t){return t&&t.__esModule?t:{default:t}}i=cc.renderer={Texture2D:null,InputAssembler:i.default,Pass:n.default,renderEngine:null,canvas:null,device:null,scene:null,drawCalls:0,_handle:null,_cameraNode:null,_camera:null,_forward:null,_flow:null,initWebGL:function(t,e){s("./webgl/assemblers");var i=s("./webgl/model-batcher"),n=(this.Texture2D=a.default.Texture2D,this.canvas=t,this._flow=cc.RenderFlow,s("../../renderer/scene/scene")),r=s("../../renderer/renderers/forward-renderer"),e=(this.device=new a.default.Device(t,e),this.scene=new n,t=this.device,{defaultTexture:new a.default.Texture2D(t,{images:[],width:128,height:128,wrapS:a.default.WRAP_REPEAT,wrapT:a.default.WRAP_REPEAT,format:a.default.TEXTURE_FMT_RGB8,mipmap:!1}),programTemplates:[],programChunks:{}});this._forward=new r(this.device,e),this._handle=new i(this.device,this.scene),this._flow.init(this._handle,this._forward)},initCanvas:function(t){var e=s("./canvas"),i=s("./canvas/Texture2D"),n=s("./canvas/Device");this.Device=n,this.Texture2D=i,this.canvas=t,this.device=new n(t),this._camera={a:1,b:0,c:0,d:1,tx:0,ty:0},this._handle=new e.RenderComponentHandle(this.device,this._camera),this._forward=new e.ForwardRenderer,this._flow=cc.RenderFlow,this._flow.init(this._handle,this._forward)},updateCameraViewport:function(){var t;cc.director&&(t=cc.director.getScene())&&t.setScale(1,1,1),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(t=cc.view.getViewportRect(),this.device.setViewport(t.x,t.y,t.width,t.height),this._camera.a=cc.view.getScaleX(),this._camera.d=cc.view.getScaleY(),this._camera.tx=t.x,this._camera.ty=t.y+t.height)},render:function(t,e){this.device.resetDrawCalls(),t&&(this._flow.render(t,e),this.drawCalls=this.device.getDrawCalls())},clear:function(){this._handle.reset(),this._forward.clear()}};e.default=i,t.exports=e.default},{"../../renderer/core/input-assembler":353,"../../renderer/core/pass":354,"../../renderer/gfx":363,"../../renderer/renderers/forward-renderer":382,"../../renderer/scene/scene":386,"./canvas":void 0,"./canvas/Device":260,"./canvas/Texture2D":261,"./webgl/assemblers":274,"./webgl/model-batcher":299}],263:[function(t,e,i){"use strict";var u,n,r=0,s=(r++,r++,r++,r++,r++,r++,r++,r++,r++,1024),_=0;function a(){this._func=h,this._next=null}var r=a.prototype,o=(r._doNothing=function(){},r._localTransform=function(t){t._updateLocalMatrix(),t._renderFlag&=-5,this._next._func(t)},r._worldTransform=function(t){u.worldMatDirty++;var e=t._matrix,i=t._trs,n=e.m;n[12]=i[0],n[13]=i[1],n[14]=i[2],t._mulMat(t._worldMatrix,t._parent._worldMatrix,e),t._renderFlag&=-9,this._next._func(t),u.worldMatDirty--},r._opacity=function(t){u.parentOpacityDirty++,t._renderFlag&=-33,this._next._func(t),u.parentOpacityDirty--},r._color=function(t){var e=t._renderComponent;e&&e._updateColor(),t._renderFlag&=-65,this._next._func(t)},r._updateRenderData=function(t){var e=t._renderComponent;e._assembler.updateRenderData(e),t._renderFlag&=-17,this._next._func(t)},r._render=function(t){var e=t._renderComponent;e._checkBacth(u,t._cullingMask),e._assembler.fillBuffers(e,u),this._next._func(t)},r._children=function(t){for(var e=_,i=u,n=i.parentOpacity,r=i.parentOpacity*=t._opacity/255,s=(i.worldMatDirty?8:0)|(i.parentOpacityDirty?96:0),a=t._children,o=0,l=a.length;o<l;o++){var h,c=a[o];c._renderFlag|=s,c._activeInHierarchy&&0!==c._opacity&&(_=c._cullingMask=0===c.groupIndex?e:1<<c.groupIndex,h=c._color._val,c._color._fastSetA(c._opacity*r),d[c._renderFlag]._func(c),c._color._val=h)}i.parentOpacity=n,this._next._func(t)},r._postRender=function(t){var e=t._renderComponent;e._checkBacth(u,t._cullingMask),e._assembler.postFillBuffers(e,u),this._next._func(t)},new a),d=(o._func=o._doNothing,o._next=o,{});function l(t,e){var i=new a;switch(i._next=e||o,t){case 1:case 2:i._func=i._doNothing;break;case 4:i._func=i._localTransform;break;case 8:i._func=i._worldTransform;break;case 32:i._func=i._opacity;break;case 64:i._func=i._color;break;case 16:i._func=i._updateRenderData;break;case 128:i._func=i._render;break;case 256:i._func=i._children;break;case 512:i._func=i._postRender}return i}function h(t){var e=t._renderFlag;(d[e]=function(t){for(var e=null,i=s;0<i;)i&t&&(e=l(i,e)),i>>=1;return e}(e))._func(t)}a.flows=d,a.createFlow=l;var c=[];a.registerValidate=function(t){t._inValidateList||(c.push(t),t._inValidateList=!0)},a.validateRenderers=function(){for(var t=0,e=c.length;t<e;t++){var i=c[t];i.isValid&&(i.enabledInHierarchy?i._validateRender():i.disableRender(),i._inValidateList=!1)}c.length=0},a.visitRootNode=function(t){a.validateRenderers(),_=1<<t.groupIndex,8&t._renderFlag?(u.worldMatDirty++,t._calculWorldMatrix(),t._renderFlag&=-9,d[t._renderFlag]._func(t),u.worldMatDirty--):d[t._renderFlag]._func(t)},a.render=function(t,e){u.reset(),u.walking=!0,a.visitRootNode(t),u.terminate(),u.walking=!1,n.render(u._renderScene,e)},a.init=function(t,e){u=t,n=e,d[0]=o;for(var i=1;i<s;i++)d[i]=new a},a.getBachther=function(){return u},a.FLAG_DONOTHING=1,a.FLAG_BREAK_FLOW=2,a.FLAG_LOCAL_TRANSFORM=4,a.FLAG_WORLD_TRANSFORM=8,a.FLAG_TRANSFORM=12,a.FLAG_OPACITY=32,a.FLAG_COLOR=64,a.FLAG_OPACITY_COLOR=96,a.FLAG_UPDATE_RENDER_DATA=16,a.FLAG_RENDER=128,a.FLAG_CHILDREN=256,a.FLAG_POST_RENDER=512,a.FLAG_FINAL=s,e.exports=cc.RenderFlow=a},{}],264:[function(t,e,i){"use strict";var n=t("../../../assets/CCRenderTexture");function r(t,e){var i=new n;i.initWithSize(t,e),i.update(),this._texture=i,this._x=2,this._y=2,this._nexty=2,this._width=t,this._height=e,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}r.DEFAULT_HASH=(new n)._getHash(),cc.js.mixin(r.prototype,{insertSpriteFrame:function(t){var e=t._rect,i=t._texture,n=this._innerTextureInfos[i._id],r=e.x,e=e.y;if(n)r+=n.x,e+=n.y;else{var n=i.width,s=i.height;if(this._x+n+2>this._width&&(this._x=2,this._y=this._nexty),this._y+s+2>this._nexty&&(this._nexty=this._y+s+2),this._nexty>this._height)return null;cc.dynamicAtlasManager.textureBleeding&&((n<=8||s<=8)&&(this._texture.drawTextureAt(i,this._x-1,this._y-1),this._texture.drawTextureAt(i,this._x-1,this._y+1),this._texture.drawTextureAt(i,this._x+1,this._y-1),this._texture.drawTextureAt(i,this._x+1,this._y+1)),this._texture.drawTextureAt(i,this._x-1,this._y),this._texture.drawTextureAt(i,this._x+1,this._y),this._texture.drawTextureAt(i,this._x,this._y-1),this._texture.drawTextureAt(i,this._x,this._y+1)),this._texture.drawTextureAt(i,this._x,this._y),this._innerTextureInfos[i._id]={x:this._x,y:this._y,texture:i},this._count++,r+=this._x,e+=this._y,this._x+=n+2,this._dirty=!0}s={x:r,y:e,texture:this._texture};return this._innerSpriteFrames.push(t),s},update:function(){this._dirty&&(this._texture.update(),this._dirty=!1)},deleteInnerTexture:function(t){t&&this._innerTextureInfos[t._id]&&(delete this._innerTextureInfos[t._id],this._count--)},isEmpty:function(){return this._count<=0},reset:function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,i=t.length;e<i;e++){var n=t[e];n.isValid&&n._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},destroy:function(){this.reset(),this._texture.destroy()}}),e.exports=r},{"../../../assets/CCRenderTexture":85}],265:[function(t,e,i){"use strict";var n=t("./atlas"),r=[],s=-1,a=5,o=2048,l=512,h=!0;function c(){var t=r[++s];return t||(t=new n(o,o),r.push(t)),t}function u(){d.reset()}var _=!1,d={Atlas:n,get enabled(){return _},set enabled(t){_!==t&&(t?(this.reset(),cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,u)):cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,u),_=t)},get maxAtlasCount(){return a},set maxAtlasCount(t){a=t},get textureBleeding(){return h},set textureBleeding(t){h=t},get textureSize(){return o},set textureSize(t){o=t},get maxFrameSize(){return l},set maxFrameSize(t){l=t},insertSpriteFrame:function(t){if(!_||s===a||!t||t._original)return null;if(!t._texture.packable)return null;var e=(r[s]||c()).insertSpriteFrame(t);return e||s===a?e:c().insertSpriteFrame(t)},reset:function(){for(var t=0,e=r.length;t<e;t++)r[t].destroy();r.length=0,s=-1},deleteAtlasSpriteFrame:function(t){t._original&&(t=t._original._texture,this.deleteAtlasTexture(t))},deleteAtlasTexture:function(t){if(t)for(var e=r.length-1;0<=e;e--)r[e].deleteInnerTexture(t),r[e].isEmpty()&&(r[e].destroy(),r.splice(e,1),s--)},showDebug:!1,update:function(){if(this.enabled)for(var t=0;t<=s;t++)r[t].update()}};e.exports=cc.dynamicAtlasManager=d},{"./atlas":264}],266:[function(t,c,e){"use strict";e.__esModule=!0,e.default=void 0;var i=(i=t("../../assembler-2d"))&&i.__esModule?i:{default:i};function s(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""}var n,A=t("../../../utils/text-utils"),a=t("../../../platform/CCMacro"),C=t("../../../components/CCLabel").Overflow,T=t("../utils").shareLabelInfo,d=cc.rect(),f=null,S=[],p=[],w=[],m=[],E=null,M=0,D=0,y=0,B=0,I=0,P=1,g=null,R=cc.size(),O="",o=0,l=0,u=0,h=0,L=0,F=0,V=0,N=!1,k=0,z=0,G=0,t=(n=i.default,t=n,(i=r).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,(i=r.prototype).updateRenderData=function(t){t._vertsDirty&&f!==t&&(f=t,this._reserveQuads(t,t.string.toString().length),this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),this.updateWorldVerts(t),f._actualFontSize=o,f.node.setContentSize(R),f._vertsDirty=!1,f=null,this._resetProperties())},i._updateFontScale=function(){P=o/l},i._updateFontFamily=function(t){var e=t.font;g=e.spriteFrame,E=e._fntConfig,T.fontAtlas=e._fontDefDictionary,this.packToDynamicAtlas(t,g)},i._updateLabelInfo=function(){T.hash="",T.margin=0},i._updateProperties=function(t){O=t.string.toString(),o=t.fontSize,l=(E||t).fontSize,u=t.horizontalAlign,h=t.verticalAlign,L=t.spacingX,V=t.overflow,F=t._lineHeight,R.width=t.node.width,R.height=t.node.height,V===C.NONE?(N=!1,R.width+=2*T.margin,R.height+=2*T.margin):V===C.RESIZE_HEIGHT?(N=!0,R.height+=2*T.margin):N=t.enableWrapText,T.lineHeight=F,T.fontSize=o,this._setupBMFontOverflowMetrics()},i._resetProperties=function(){g=E=null,T.hash="",T.margin=0},i._updateContent=function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},i._computeHorizontalKerningForText=function(){for(var t=O,e=t.length,i=E.kerningDict,n=S,r=-1,s=0;s<e;++s){var a=t.charCodeAt(s),o=i[r<<16|65535&a]||0;n[s]=s<e-1?o:0,r=a}},i._multilineTextWrap=function(t){for(var e,i=O.length,n=0,r=0,s=0,a=0,o=0,l=0,h=0,c=cc.v2(0,0),u=0;u<i;){var _=O.charAt(u);if("\n"!==_){for(var d=t(O,u,i),f=l,p=h,m=o,y=r,g=!1,v=0;v<d;++v){var b=u+v;if("\r"!==(_=O.charAt(b)))if(e=T.fontAtlas.getLetterDefinitionForChar(_,T)){var x=y+e.offsetX*P-T.margin;if(N&&0<G&&0<r&&x+e.w*P>G&&!A.isUnicodeSpace(_)){w.push(o),n++,r=o=0,s-=F*this._getFontScale()+0,g=!0;break}c.x=x,c.y=s-e.offsetY*P+T.margin,this._recordLetterInfo(c,_,b,n),b+1<S.length&&b<i-1&&(y+=S[b+1]),y+=e.xAdvance*P+L-2*T.margin,m=c.x+e.w*P-T.margin,f<c.y&&(f=c.y),p>c.y-e.h*P&&(p=c.y-e.h*P)}else this._recordPlaceholderInfo(b,_),console.log("Can't find letter definition in texture atlas "+E.atlasName+" for letter:"+_);else this._recordPlaceholderInfo(b,_)}g||(r=y,l<f&&(l=f),p<h&&(h=p),a<(o=m)&&(a=o),u+=d)}else w.push(o),n++,r=o=0,s-=F*this._getFontScale()+0,this._recordPlaceholderInfo(u,_),u++}return w.push(o),D=(M=n+1)*F*this._getFontScale(),1<M&&(D+=0*(M-1)),R.width=k,R.height=z,k<=0&&(R.width=parseFloat(a.toFixed(2))+2*T.margin),z<=0&&(R.height=parseFloat(D.toFixed(2))+2*T.margin),B=R.height,I=0,V!==C.CLAMP&&(0<l&&(B=R.height+l),h<-D&&(I=D+h)),!0},i._getFirstCharLen=function(){return 1},i._getFontScale=function(){return V===C.SHRINK?P:1},i._getFirstWordLen=function(t,e,i){var n=t.charAt(e);if(A.isUnicodeCJK(n)||"\n"===n||A.isUnicodeSpace(n))return 1;var r=1,s=T.fontAtlas.getLetterDefinitionForChar(n,T);if(s)for(var a=s.xAdvance*P+L,o=e+1;o<i&&(n=t.charAt(o),s=T.fontAtlas.getLetterDefinitionForChar(n,T));++o){if(a+s.offsetX*P+s.w*P>G&&!A.isUnicodeSpace(n)&&0<G)return r;if(a+=s.xAdvance*P+L,"\n"===n||A.isUnicodeSpace(n)||A.isUnicodeCJK(n))break;r++}return r},i._multilineTextWrapByWord=function(){return this._multilineTextWrap(this._getFirstWordLen)},i._multilineTextWrapByChar=function(){return this._multilineTextWrap(this._getFirstCharLen)},i._recordPlaceholderInfo=function(t,e){var i;t>=p.length&&(i=new s,p.push(i)),p[t].char=e,p[t].hash=e.charCodeAt(0)+T.hash,p[t].valid=!1},i._recordLetterInfo=function(t,e,i,n){i>=p.length&&(r=new s,p.push(r));var r=e.charCodeAt(0)+T.hash;p[i].line=n,p[i].char=e,p[i].hash=r,p[i].valid=T.fontAtlas.getLetter(r).valid,p[i].x=t.x,p[i].y=t.y},i._alignText=function(){D=0,w.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),V===C.SHRINK&&0<o&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||V===C.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},i._scaleFontSizeDown=function(t){var e=!0;t||(e=!(t=.1)),o=t,e&&this._updateContent()},i._shrinkLabelToContentSize=function(t){for(var e,i=0,n=0|o;i<n&&!((e=i+n+1>>1)<=0);)P=e/l,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?n=e-1:i=e;var r=i;0<=r&&this._scaleFontSizeDown(r)},i._isVerticalClamp=function(){return D>R.height},i._isHorizontalClamp=function(){for(var t=!1,e=0,i=O.length;e<i;++e){var n=p[e];if(n.valid){var r=T.fontAtlas.getLetter(n.hash),r=n.x+r.w*P,n=n.line;if(0<k)if(N){if(w[n]>R.width&&(r>R.width||r<0)){t=!0;break}}else if(r>R.width){t=!0;break}}}return t},i._isHorizontalClamped=function(t,e){e=w[e],t=t>R.width||t<0;return(!N||e>R.width)&&t},i._updateQuads=function(){var t=g?g._texture:T.fontAtlas.getTexture(),e=f.node;this.verticesCount=this.indicesCount=0,this._renderData&&(this._renderData.dataLength=0);for(var i=R,n=e._anchorPoint.x*i.width,r=e._anchorPoint.y*i.height,s=!0,a=0,o=O.length;a<o;++a){var l=p[a];if(l.valid){var h=T.fontAtlas.getLetter(l.hash),c=(d.height=h.h,d.width=h.w,d.x=h.u,d.y=h.v,l.y+y),u=(0<z&&(B<c&&(u=c-B,d.y+=u,d.height-=u,c-=u),c-h.h*P<I&&V===C.CLAMP&&(d.height=c<I?0:(c-I)/P)),l.line),_=l.x+h.w/2*P+m[u];if(0<k&&this._isHorizontalClamped(_,u))if(V===C.CLAMP)d.width=0;else if(V===C.SHRINK){if(R.width>h.w){s=!1;break}d.width=0}0<d.height&&0<d.width&&(_=this._determineRect(d),h=l.x+m[l.line],this.appendQuad(f,t,d,_,h-n,c-r,P))}}return this._quadsUpdated(f),s},i._determineRect=function(t){var e=g.isRotated(),i=g._originalSize,n=g._rect,r=g._offset,s=r.x+(i.width-n.width)/2,r=r.y-(i.height-n.height)/2;return e?(i=t.x,t.x=n.x+n.height-t.y-t.height-r,t.y=i+n.y-s,t.y<0&&(t.height=t.height+r)):(t.x+=n.x-s,t.y+=n.y+r),e},i._computeAlignmentOffset=function(){switch(m.length=0,u){case a.TextAlignment.LEFT:for(var t=0;t<M;++t)m.push(0);break;case a.TextAlignment.CENTER:for(var e=0,i=w.length;e<i;e++)m.push((R.width-w[e])/2);break;case a.TextAlignment.RIGHT:for(var n=0,r=w.length;n<r;n++)m.push(R.width-w[n])}var s;y=R.height,h!==a.VerticalTextAlignment.TOP&&(s=R.height-D+F*this._getFontScale()-l*P,h===a.VerticalTextAlignment.BOTTOM?y-=s:y-=s/2)},i._setupBMFontOverflowMetrics=function(){var t=R.width,e=R.height;V===C.RESIZE_HEIGHT&&(e=0),V===C.NONE&&(e=t=0),z=e,G=k=t},i.updateWorldVerts=function(){},i.appendQuad=function(t,e,i,n,r,s,a){},i._quadsUpdated=function(t){},i._reserveQuads=function(){},r);function r(){return n.apply(this,arguments)||this}e.default=t,c.exports=e.default},{"../../../components/CCLabel":122,"../../../platform/CCMacro":235,"../../../utils/text-utils":322,"../../assembler-2d":256,"../utils":270}],267:[function(t,e,i){"use strict";function n(){this._rect=null,this.uv=[],this._texture=null,this._original=null}n.prototype={constructor:n,getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t,this._texture&&this._calculateUV()},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_refreshTexture:function(t){this._texture=t,this._rect=cc.rect(0,0,t.width,t.height),this._calculateUV()},_calculateUV:function(){var t=this._rect,e=this._texture,i=this.uv,n=e.width,e=e.height,r=0===n?0:t.x/n,n=0===n?0:(t.x+t.width)/n,s=0===e?0:(t.y+t.height)/e,t=0===e?0:t.y/e;i[0]=r,i[1]=s,i[2]=n,i[3]=s,i[4]=r,i[5]=t,i[6]=n,i[7]=t}},e.exports=n},{}],268:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../../webgl/assemblers/label/2d/bmfont"))&&n.__esModule?n:{default:n};var r=t("../../../components/CCLabel"),s=t("../../../components/CCLabelOutline"),o=t("../../../utils/text-utils"),a=t("../../../components/CCComponent"),l=t("../../../assets/CCRenderTexture"),h=cc.js.isChildClassOf(s,a),c=t("../utils").getFontFamily,u=t("../utils").shareLabelInfo,_=cc.BitmapFont.FontLetterDefinition,d=cc.BitmapFont.FontAtlas,f=cc.Color.WHITE,p=(1/255).toFixed(3);function m(t,e){this._texture=null,this._labelInfo=e,this._char=t,this._hash=null,this._data=null,this._canvas=null,this._context=null,this._width=0,this._height=0,this._offsetY=0,this._hash=t.charCodeAt(0)+e.hash}function y(t,e){var i=new l;i.initWithSize(t,e),i.update(),this._fontDefDictionary=new d(i),this._x=0,this._y=0,this._nexty=0,this._width=t,this._height=e,cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}m.prototype={constructor:m,updateRenderData:function(){this._updateProperties(),this._updateTexture()},_updateProperties:function(){this._texture=new cc.Texture2D,this._data=r._canvasPool.get(),this._canvas=this._data.canvas,this._context=this._data.context,this._context.font=this._labelInfo.fontDesc;var t=o.safeMeasureText(this._context,this._char,this._labelInfo.fontDesc),e=2*this._labelInfo.margin+2;this._width=parseFloat(t.toFixed(2))+e,this._height=(1+o.BASELINE_RATIO)*this._labelInfo.fontSize+e,this._offsetY=-this._labelInfo.fontSize*o.BASELINE_RATIO/2,this._canvas.width!==this._width&&(this._canvas.width=this._width),this._canvas.height!==this._height&&(this._canvas.height=this._height),this._texture.initWithElement(this._canvas)},_updateTexture:function(){var t=this._context,e=this._labelInfo,i=this._canvas.width,n=this._canvas.height,r=i/2,s=n/2+this._labelInfo.fontSize*o.MIDDLE_RATIO,a=e.color;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,n),t.fillStyle="rgba("+a.r+", "+a.g+", "+a.b+", "+p+")",t.fillRect(0,0,i,n),t.font=e.fontDesc,t.lineJoin="round",t.fillStyle="rgba("+a.r+", "+a.g+", "+a.b+", 1)",e.isOutlined&&0<e.margin&&(i=e.out||f,t.strokeStyle="rgba("+i.r+", "+i.g+", "+i.b+", "+i.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this._char,r,s)),t.fillText(this._char,r,s),this._texture.handleLoadedTexture()},destroy:function(){this._texture.destroy(),this._texture=null,r._canvasPool.put(this._data)}},cc.js.mixin(y.prototype,{insertLetterTexture:function(t){var e=t._texture,i=e.width,n=e.height;if(this._x+i+0>this._width&&(this._x=0,this._y=this._nexty),this._y+n>this._nexty&&(this._nexty=this._y+n+0),this._nexty>this._height)return null;this._fontDefDictionary._texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;n=new _;return n.u=this._x+1,n.v=this._y+1,n.texture=this._fontDefDictionary._texture,n.valid=!0,n.w=t._width-2,n.h=t._height-2,n.xAdvance=n.w,n.offsetY=t._offsetY,this._x+=i+0,this._fontDefDictionary.addLetterDefinitions(t._hash,n),n},update:function(){this._dirty&&(this._fontDefDictionary._texture.update(),this._dirty=!1)},reset:function(){this._x=0,this._y=0,this._nexty=0;for(var t=this._fontDefDictionary._letterDefinitions,e=0,i=t.length;e<i;e++){var n=t[e];n.isValid&&n.destroy()}this._fontDefDictionary.clear()},destroy:function(){this.reset(),this._fontDefDictionary._texture.destroy(),this._fontDefDictionary._texture=null},beforeSceneLoad:function(){this.clearAllCache()},clearAllCache:function(){this.destroy();var t=new l;t.initWithSize(this._width,this._height),t.update(),this._fontDefDictionary._texture=t},getLetter:function(t){return this._fontDefDictionary._letterDefinitions[t]},getTexture:function(){return this._fontDefDictionary.getTexture()},getLetterDefinitionForChar:function(t,e){var i=t.charCodeAt(0)+e.hash,i=this._fontDefDictionary._letterDefinitions[i];return i||((t=new m(t,e)).updateRenderData(),i=this.insertLetterTexture(t),t.destroy()),i}});var g,v=null,n=(g=n.default,a=g,(t=b).prototype=Object.create(a.prototype),(t.prototype.constructor=t).__proto__=a,(t=b.prototype)._getAssemblerData=function(){return v||(v=new y(2048,2048),cc.Label._shareAtlas=v),v.getTexture()},t._updateFontFamily=function(t){u.fontAtlas=v,u.fontFamily=c(t);var e=h&&t.getComponent(s);e&&e.enabled?(u.isOutlined=!0,u.margin=e.width,u.out=e.color.clone(),u.out.a=e.color.a*t.node.color.a/255):(u.isOutlined=!1,u.margin=0)},t._updateLabelInfo=function(t){var e,i;u.fontDesc=this._getFontDesc(),u.color=t.node.color,u.hash=(e=(t=u).color.toHEX("#rrggbb"),i="",t.isOutlined&&0<t.margin&&(i=i+t.margin+t.out.toHEX("#rrggbb")),""+t.fontSize+t.fontFamily+e+i)},t._getFontDesc=function(){return u.fontSize.toString()+"px "+u.fontFamily},t._computeHorizontalKerningForText=function(){},t._determineRect=function(t){return!1},b);function b(){return g.apply(this,arguments)||this}i.default=n,e.exports=i.default},{"../../../assets/CCRenderTexture":85,"../../../components/CCComponent":120,"../../../components/CCLabel":122,"../../../components/CCLabelOutline":123,"../../../utils/text-utils":322,"../../webgl/assemblers/label/2d/bmfont":275,"../utils":270}],269:[function(t,F,e){"use strict";e.__esModule=!0,e.default=void 0;var i=(i=t("../../assembler-2d"))&&i.__esModule?i:{default:i};var n,r,p=t("../../../utils/text-utils"),h=t("../../../platform/CCMacro"),s=t("../../../components/CCLabel"),a=t("../../../components/CCLabelOutline"),V=t("../../../components/CCLabelShadow"),m=s.Overflow,N=t("../utils").deleteFromDynamicAtlas,k=t("../utils").getFontFamily,z=(1/255).toFixed(3),y=null,c=null,u=null,g="",v="",b=0,x=0,_=[],A=cc.Size.ZERO,G=0,d=0,o=0,f=null,U="",C=m.NONE,T=!1,S=null,w=cc.Color.WHITE,E=null,l=cc.Color.BLACK,M=cc.rect(),D=cc.Size.ZERO,B=cc.Size.ZERO,j=!1,I=!1,W=!1,P=0,R=cc.Vec2.ZERO,O=0,t=(r=i.default,t=r,(i=L).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,(i=L.prototype)._getAssemblerData=function(){return(n=s._canvasPool.get()).canvas.width=n.canvas.height=1,n},i._resetAssemblerData=function(t){t&&s._canvasPool.put(t)},i.updateRenderData=function(t){r.prototype.updateRenderData.call(this,t),t._vertsDirty&&(this._updateFontFamily(t),this._updateProperties(t),this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture(t),this._calDynamicAtlas(t),t._actualFontSize=b,t.node.setContentSize(B),this.updateVerts(t),t._vertsDirty=!1,u=c=y=null)},i.updateVerts=function(){},i._updatePaddingRect=function(){var t=0,e=0,i=0,n=0,r=0;D.width=D.height=0,S&&(t=e=i=n=r=S.width,D.width=D.height=2*r),E&&(r=E.blur+r,i=Math.max(i,-E._offset.x+r),n=Math.max(n,E._offset.x+r),t=Math.max(t,E._offset.y+r),e=Math.max(e,-E._offset.y+r)),I&&(n+=r=x*Math.tan(.20943951),D.width+=r),M.x=i,M.y=t,M.width=i+n,M.height=t+e},i._updateFontFamily=function(t){U=k(t)},i._updateProperties=function(t){var e=t._assemblerData;y=e.context,c=e.canvas,u=(t._frame._original||t._frame)._texture,v=t.string.toString(),b=t._fontSize,x=b,P=t.underlineHeight||x/8,C=t.overflow,A.width=t.node.width,A.height=t.node.height,B=t.node.getContentSize(),G=t._lineHeight,d=t.horizontalAlign,o=t.verticalAlign,f=t.node.color,j=t.enableBold,I=t.enableItalic,W=t.enableUnderline,T=C!==m.NONE&&(C===m.RESIZE_HEIGHT||t.enableWrapText),(S=(S=a&&t.getComponent(a))&&S.enabled&&0<S.width?S:null)&&w.set(S.color),(E=(E=V&&t.getComponent(V))&&E.enabled?E:null)&&(l.set(E.color),l.a=l.a*t.node.color.a/255),this._updatePaddingRect()},i._calculateFillTextStartPosition=function(){var t=0,e=(d===h.TextAlignment.RIGHT?t=A.width-M.width:d===h.TextAlignment.CENTER&&(t=(A.width-M.width)/2),this._getLineHeight()*(_.length-1)),i=b*(1-p.BASELINE_RATIO/2);return o!==h.VerticalTextAlignment.TOP&&(e=e+M.height+b-A.height,o===h.VerticalTextAlignment.BOTTOM?i-=e+=p.BASELINE_RATIO/2*b:i-=e/2),i+=p.BASELINE_OFFSET*b,cc.v2(t+M.x,i+M.y)},i._setupOutline=function(){y.strokeStyle="rgba("+w.r+", "+w.g+", "+w.b+", "+w.a/255+")",y.lineWidth=2*S.width},i._setupShadow=function(){y.shadowColor="rgba("+l.r+", "+l.g+", "+l.b+", "+l.a/255+")",y.shadowBlur=E.blur,y.shadowOffsetX=E.offset.x,y.shadowOffsetY=-E.offset.y},i._drawUnderline=function(t){S&&(this._setupOutline(),y.strokeRect(R.x,R.y,t,P)),y.lineWidth=P,y.fillStyle="rgba("+f.r+", "+f.g+", "+f.b+", "+f.a/255+")",y.fillRect(R.x,R.y,t,P)},i._updateTexture=function(){y.clearRect(0,0,c.width,c.height);var t=S?w:f,e=(y.fillStyle="rgba("+t.r+", "+t.g+", "+t.b+", "+z+")",y.fillRect(0,0,c.width,c.height),y.font=g,this._calculateFillTextStartPosition()),i=this._getLineHeight(),n=(y.lineJoin="round",y.fillStyle="rgba("+f.r+", "+f.g+", "+f.b+", 1)",1<_.length),r=this._measureText(y,g),s=0,a=0;E&&this._setupShadow(),S&&0<S.width&&this._setupOutline();for(var o=0;o<_.length;++o)s=e.x,a=e.y+o*i,E&&n&&(S&&0<S.width&&y.strokeText(_[o],s,a),y.fillText(_[o],s,a)),W&&(O=r(_[o]),d===h.TextAlignment.RIGHT?R.x=e.x-O:d===h.TextAlignment.CENTER?R.x=e.x-O/2:R.x=e.x,R.y=a+x/8,this._drawUnderline(O));E&&n&&(y.shadowColor="transparent");for(var l=0;l<_.length;++l)s=e.x,a=e.y+l*i,S&&0<S.width&&y.strokeText(_[l],s,a),y.fillText(_[l],s,a);E&&(y.shadowColor="transparent"),u.handleLoadedTexture()},i._calDynamicAtlas=function(t){var e;t.cacheMode===s.CacheMode.BITMAP&&(e=t._frame,N(t,e),e._original||e.setRect(cc.rect(0,0,c.width,c.height)),this.packToDynamicAtlas(t,e))},i._updateLabelDimensions=function(){var t=v.split("\n");if(C===m.RESIZE_HEIGHT){var e=(_.length+p.BASELINE_RATIO)*this._getLineHeight();A.height=e+M.height,B.height=e+D.height}else if(C===m.NONE){_=t;for(var i=0,e=0,n=0;n<t.length;++n)var r=p.safeMeasureText(y,t[n],g),i=r<i?i:r;var e=(_.length+p.BASELINE_RATIO)*this._getLineHeight(),s=parseFloat(i.toFixed(2)),e=parseFloat(e.toFixed(2));A.width=s+M.width,A.height=e+M.height,B.width=s+D.width,B.height=e+D.height}A.width=Math.min(A.width,2048),A.height=Math.min(A.height,2048),c.width!==A.width&&(c.width=A.width),c.height!==A.height&&(c.height=A.height)},i._calculateTextBaseline=function(){var t=d===h.TextAlignment.RIGHT?"right":d===h.TextAlignment.CENTER?"center":"left";y.textAlign=t,y.textBaseline="alphabetic"},i._calculateSplitedStrings=function(){var t=v.split("\n");if(T){_=[];for(var e=B.width,i=0;i<t.length;++i){var n=p.safeMeasureText(y,t[i],g),n=p.fragmentText(t[i],n,e,this._measureText(y,g));_=_.concat(n)}}else _=t},i._getFontDesc=function(){var t=b.toString()+"px ";return t+=U,j&&(t="bold "+t),t=I?"italic "+t:t},i._getLineHeight=function(){var t=G;return 0|(0===t?b:t*b/x)},i._calculateParagraphLength=function(t,e){for(var i=[],n=0;n<t.length;++n){var r=p.safeMeasureText(e,t[n],g);i.push(r)}return i},i._measureText=function(e,i){return function(t){return p.safeMeasureText(e,t,i)}},i._calculateLabelFont=function(){if(g=this._getFontDesc(),y.font=g,C===m.SHRINK){var t=v.split("\n"),e=this._calculateParagraphLength(t,y),i=0,n=0,r=0;if(T){var s=B.width,a=B.height;if(s<0||a<0)return g=this._getFontDesc(),void(y.font=g);for(var o,n=a+1,r=s+1,l=0,h=0|b+1;l<h;){if((o=l+h+1>>1)<=0){cc.logID(4003);break}for(b=o,g=this._getFontDesc(),y.font=g,i=n=0;i<t.length;++i)for(var c=0,u=p.safeMeasureText(y,t[i],g),_=p.fragmentText(t[i],u,s,this._measureText(y,g));c<_.length;)r=p.safeMeasureText(y,_[c],g),n+=this._getLineHeight(),++c;a<n?h=o-1:l=o}0===l?cc.logID(4003):(b=l,g=this._getFontDesc(),y.font=g)}else{for(n=t.length*this._getLineHeight(),i=0;i<t.length;++i)r<e[i]&&(r=e[i]);var d=(A.width-M.width)/r,f=A.height/n;b=x*Math.min(1,d,f)|0,g=this._getFontDesc(),y.font=g}}},L);function L(){return r.apply(this,arguments)||this}e.default=t,F.exports=e.default},{"../../../components/CCLabel":122,"../../../components/CCLabelOutline":123,"../../../components/CCLabelShadow":124,"../../../platform/CCMacro":235,"../../../utils/text-utils":322,"../../assembler-2d":256,"../utils":270}],270:[function(t,e,i){"use strict";var n=t("./dynamic-atlas/manager"),t=cc.Color.WHITE;e.exports={deleteFromDynamicAtlas:function(t,e){e&&e._original&&n&&(n.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame())},getFontFamily:function(i){return i.useSystemFont?i.fontFamily||"Arial":i.font?i.font._nativeAsset||(cc.loader.load(i.font.nativeUrl,function(t,e){i.font._nativeAsset=e,i.setVertsDirty()}),"Arial"):"Arial"},shareLabelInfo:{fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:t,isOutlined:!1,out:t,margin:0}}},{"./dynamic-atlas/manager":265}],271:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,r,s,a,o,l=e&&e.length,h=l?e[0]*i:t.length,c=p(t,0,h,i,!0),u=[];if(!c)return u;if(l&&(c=function(t,e,i,n){var r,s,a,o=[];for(r=0,s=e.length;r<s;r++)(a=p(t,e[r]*n,r<s-1?e[r+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),o.push(function(t){var e=t,i=t;for(;e.x<i.x&&(i=e),e=e.next,e!==t;);return i}(a));for(o.sort(g),r=0;r<o.length;r++)(function(t,e){(e=function(t,e){var i,n=e,r=t.x,s=t.y,a=-1/0;do{if(s<=n.y&&s>=n.next.y){var o=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&a<o){if((a=o)===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}}while(n=n.next,n!==e);if(!i)return null;if(r===a)return i.prev;var l,h=i,c=i.x,u=i.y,_=1/0;for(n=i.next;n!==h;)r>=n.x&&n.x>=c&&b(s<u?r:a,s,c,u,s<u?a:r,s,n.x,n.y)&&((l=Math.abs(s-n.y)/(r-n.x))<_||l===_&&n.x>i.x)&&T(n,t)&&(i=n,_=l),n=n.next;return i}(t,e))&&m(e=S(e,t),e.next)})(o[r],i),i=m(i,i.next);return i}(t,e,c,i)),t.length>80*i){for(var _=n=t[0],d=r=t[1],f=i;f<h;f+=i)(s=t[f])<_&&(_=s),(a=t[f+1])<d&&(d=a),n<s&&(n=s),r<a&&(r=a);o=Math.max(n-_,r-d)}return y(c,u,i,_,d,o),u}function p(t,e,i,n,r){var s,a;if(r===0<E(t,e,i,n))for(s=e;s<i;s+=n)a=o(s,t[s],t[s+1],a);else for(s=i-n;e<=s;s-=n)a=o(s,t[s],t[s+1],a);return a&&A(a,a.next)&&(w(a),a=a.next),a}function m(t,e){if(!t)return t;e=e||t;var i,n=t;do{if(i=!1,n.steiner||!A(n,n.next)&&0!==x(n.prev,n,n.next))n=n.next;else{if(w(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function y(t,e,i,n,r,s,a){if(t){if(!a&&s){var o=t;var l=n;var h=r;var c=s;var u=o;for(;null===u.z&&(u.z=v(u.x,u.y,l,h,c)),u.prevZ=u.prev,u.nextZ=u.next,u=u.next,u!==o;);u.prevZ.nextZ=null,u.prevZ=null,function(t){var e,i,n,r,s,a,o,l,h=1;do{for(i=t,s=t=null,a=0;i;){for(a++,n=i,e=o=0;e<h&&(o++,n=n.nextZ);e++);for(l=h;0<o||0<l&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(i=(r=i).nextZ,o--):(n=(r=n).nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}}while(s.nextZ=null,h*=2,1<a)}(u)}for(var _,d,f=t;t.prev!==t.next;)if(_=t.prev,d=t.next,s?function(t,e,i,n){var r=t.prev,s=t,a=t.next;if(0<=x(r,s,a))return;for(var o=(r.x<s.x?r.x<a.x?r:a:s.x<a.x?s:a).x,l=(r.y<s.y?r.y<a.y?r:a:s.y<a.y?s:a).y,h=(r.x>s.x?r.x>a.x?r:a:s.x>a.x?s:a).x,c=(r.y>s.y?r.y>a.y?r:a:s.y>a.y?s:a).y,u=v(o,l,e,i,n),_=v(h,c,e,i,n),d=t.nextZ;d&&d.z<=_;){if(d!==t.prev&&d!==t.next&&b(r.x,r.y,s.x,s.y,a.x,a.y,d.x,d.y)&&0<=x(d.prev,d,d.next))return;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&b(r.x,r.y,s.x,s.y,a.x,a.y,d.x,d.y)&&0<=x(d.prev,d,d.next))return;d=d.prevZ}return 1}(t,n,r,s):function(t){var e=t.prev,i=t,n=t.next;if(0<=x(e,i,n))return;for(var r=t.next.next;r!==t.prev;){if(b(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=x(r.prev,r,r.next))return;r=r.next}return 1}(t))e.push(_.i/i),e.push(t.i/i),e.push(d.i/i),w(t),t=d.next,f=d.next;else if((t=d)===f){a?1===a?y(t=function(t,e,i){var n=t;do{var r=n.prev,s=n.next.next}while(!A(r,s)&&C(r,n,n.next,s)&&T(r,s)&&T(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),w(n),w(n.next),n=t=s),n=n.next,n!==t);return n}(t,e,i),e,i,n,r,s,2):2===a&&function(t,e,i,n,r,s){var a=t;do{for(var o,l=a.next.next;l!==a.prev;){if(a.i!==l.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&C(i,i.next,t,e))return 1}while(i=i.next,i!==t);return}(t,e)&&T(t,e)&&T(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;for(;i.y>s!=i.next.y>s&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==t;);return n}(t,e)}(a,l))return o=S(a,l),a=m(a,a.next),o=m(o,o.next),y(a,e,i,n,r,s),y(o,e,i,n,r,s);l=l.next}}while(a=a.next,a!==t)}(t,e,i,n,r,s):y(m(t),e,i,n,r,s,1);break}}}function g(t,e){return t.x-e.x}function v(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function b(t,e,i,n,r,s,a,o){return 0<=(r-a)*(e-o)-(t-a)*(s-o)&&0<=(t-a)*(n-o)-(i-a)*(e-o)&&0<=(i-a)*(s-o)-(r-a)*(n-o)}function x(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function A(t,e){return t.x===e.x&&t.y===e.y}function C(t,e,i,n){return A(t,e)&&A(i,n)||A(t,n)&&A(i,e)||0<x(t,e,i)!=0<x(t,e,n)&&0<x(i,n,t)!=0<x(i,n,e)}function T(t,e){return x(t.prev,t,t.next)<0?0<=x(t,e,t.next)&&0<=x(t,t.prev,e):x(t,e,t.prev)<0||x(t,t.next,e)<0}function S(t,e){var i=new a(t.i,t.x,t.y),n=new a(e.i,e.x,e.y),r=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(s.next=n).prev=s,n}function o(t,e,i,n){t=new a(t,e,i);return n?(t.next=n.next,(t.prev=n).next.prev=t,n.next=t):(t.prev=t).next=t,t}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function a(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(t,e,i,n){for(var r=0,s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(cc.Graphics.earcut=e.exports=n).deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,a=Math.abs(E(t,0,s,i));if(r)for(var o=0,l=e.length;o<l;o++){var h=e[o]*i,c=o<l-1?e[o+1]*i:t.length;a-=Math.abs(E(t,h,c,i))}for(var u=0,o=0;o<n.length;o+=3){var _=n[o]*i,d=n[o+1]*i,f=n[o+2]*i;u+=Math.abs((t[_]-t[f])*(t[1+d]-t[1+_])-(t[_]-t[d])*(t[1+f]-t[1+_]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var a=0;a<e;a++)i.vertices.push(t[r][s][a]);0<r&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}],272:[function(t,e,i){"use strict";var o=t("../../../../graphics/helper"),l=t("../../../../graphics/types").PointFlags,a=cc.Graphics.Point=cc.Class({name:"cc.GraphicsPoint",extends:cc.Vec2,ctor:function(t,e){this.reset()},reset:function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0}});function n(){this.reset()}function r(t){this._tessTol=.25,this._distTol=.01,this._updatePathOffset=!1,this._paths=null,this._pathLength=0,this._pathOffset=0,this._points=null,this._pointsOffset=0,this._commandx=0,this._commandy=0,this._paths=[],this._points=[]}cc.js.mixin(n.prototype,{reset:function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]}}),cc.js.mixin(r.prototype,{moveTo:function(t,e){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,e,l.PT_CORNER),this._commandx=t,this._commandy=e},lineTo:function(t,e){this._addPoint(t,e,l.PT_CORNER),this._commandx=t,this._commandy=e},bezierCurveTo:function(t,e,i,n,r,s){var a=this._curPath,a=a.points[a.points.length-1];a.x!==t||a.y!==e||i!==r||n!==s?(o.tesselateBezier(this,a.x,a.y,t,e,i,n,r,s,0,l.PT_CORNER),this._commandx=r,this._commandy=s):this.lineTo(r,s)},quadraticCurveTo:function(t,e,i,n){var r=this._commandx,s=this._commandy;this.bezierCurveTo(r+2/3*(t-r),s+2/3*(e-s),i+2/3*(t-i),n+2/3*(e-n),i,n)},arc:function(t,e,i,n,r,s){o.arc(this,t,e,i,n,r,s)},ellipse:function(t,e,i,n){o.ellipse(this,t,e,i,n),this._curPath.complex=!1},circle:function(t,e,i){o.ellipse(this,t,e,i,i),this._curPath.complex=!1},rect:function(t,e,i,n){this.moveTo(t,e),this.lineTo(t,e+n),this.lineTo(t+i,e+n),this.lineTo(t+i,e),this.close(),this._curPath.complex=!1},roundRect:function(t,e,i,n,r){o.roundRect(this,t,e,i,n,r),this._curPath.complex=!1},clear:function(t){this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,t&&(this._paths.length=0,this._points.length=0)},close:function(){this._curPath.closed=!0},_addPath:function(){var t=this._pathLength,t=this._paths[t];return t?t.reset():(t=new n,this._paths.push(t)),this._pathLength++,this._curPath=t},_addPoint:function(t,e,i){var n,r,s=this._curPath;s&&(r=this._points,s=s.points,(n=r[this._pointsOffset++])?(n.x=t,n.y=e):(n=new a(t,e),r.push(n)),n.flags=i,s.push(n))}}),cc.Graphics._Impl=r,e.exports=r},{"../../../../graphics/helper":173,"../../../../graphics/types":175}],273:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=s(t("../../../assembler")),r=s(t("../../../../../renderer/core/input-assembler"));function s(t){return t&&t.__esModule?t:{default:t}}var a=t("../../mesh-buffer"),o=t("../../vertex-format").vfmtPosColor,l=t("../../../index"),h=t("../../../../graphics/graphics"),O=t("../../../../graphics/types").PointFlags,L=h.LineJoin,F=h.LineCap,E=t("./earcut"),V=(t("./impl"),Math.PI),g=Math.min,N=Math.max,k=Math.ceil,z=Math.acos,M=Math.cos,D=Math.sin,B=Math.atan2;function I(t,e,i){return t<e?e:i<t?i:t}c=n.default,h=c,(t=u).prototype=Object.create(h.prototype),(t.prototype.constructor=t).__proto__=h,(t=u.prototype).getVfmt=function(){return o},t.requestBuffer=function(){var t={indiceStart:0,vertexStart:0},e=new a(l._handle,o),e=(t.meshbuffer=e,new r.default(e._vb,e._ib));return t.ia=e,this._buffers.push(t),t},t.getBuffers=function(){return 0===this._buffers.length&&this.requestBuffer(),this._buffers},t.clear=function(t){this._bufferOffset=0;var e=this._buffers;if(t){for(var i=0,n=e.length;i<n;i++){var r=e[i];r.meshbuffer.destroy(),r.meshbuffer=null}e.length=0}else for(var s=0,a=e.length;s<a;s++){var o=e[s];o.indiceStart=0,o.vertexStart=0,o.meshbuffer.reset()}},t.fillBuffers=function(t,e){e._flush(),e.node=t.node,e.material=t._materials[0];for(var i=this.getBuffers(),n=0,r=i.length;n<r;n++){var s=i[n],a=s.meshbuffer;s.ia._count=s.indiceStart,e._flushIA(s.ia),a.uploadData()}},t.genBuffer=function(t,e){var i=this.getBuffers(),n=i[this._bufferOffset],r=n.meshbuffer,s=n.vertexStart+e;return(65535<s||131070<3*s)&&(++this._bufferOffset,s=e,this._bufferOffset<i.length?n=i[this._bufferOffset]:(n=this.requestBuffer(t),i[this._bufferOffset]=n),r=n.meshbuffer),s>r.vertexOffset&&r.requestStatic(e,3*e),this._buffer=n},t.stroke=function(t){this._curColor=t._strokeColor._val,this._flattenPaths(t._impl),this._expandStroke(t),t._impl._updatePathOffset=!0},t.fill=function(t){this._curColor=t._fillColor._val,this._expandFill(t),t._impl._updatePathOffset=!0},t._expandStroke=function(t){var e,i,n=.5*t.lineWidth,r=t.lineCap,s=t.lineJoin,a=t.miterLimit,o=t._impl,l=(e=n,i=V,m=o._tessTol,e=2*z(n/(n+m)),N(2,k(i/e)));this._calculateJoins(o,n,s,a);for(var h=o._paths,c=0,u=o._pathOffset,_=o._pathLength;u<_;u++){var d=h[u],f=d.points.length;s===L.ROUND?c+=2*(f+d.nbevel*(l+2)+1):c+=2*(f+5*d.nbevel+1),d.closed||(r===F.ROUND?c+=2*(2*l+2):c+=12)}for(var p=this.genBuffer(t,c),m=p.meshbuffer,y=m._vData,g=m._iData,v=o._pathOffset,b=o._pathLength;v<b;v++){var x=h[v],A=x.points,C=A.length,T=p.vertexStart,S=void 0,w=void 0,E=void 0,M=void 0,M=(x=x.closed)?(S=A[C-1],w=A[0],E=0,C):(S=A[0],w=A[1],C-(E=1)),w=w||S;x||((C=w.sub(S)).normalizeSelf(),D=C.x,C=C.y,r===F.BUTT?this._buttCapStart(S,D,C,n,0):r===F.SQUARE?this._buttCapStart(S,D,C,n,n):r===F.ROUND&&this._roundCapStart(S,D,C,n,l));for(var D,B=E;B<M;++B)s===L.ROUND?this._roundJoin(S,w,n,n,l):0!=(w.flags&(O.PT_BEVEL|O.PT_INNERBEVEL))?this._bevelJoin(S,w,n,n):(this._vset(w.x+w.dmx*n,w.y+w.dmy*n),this._vset(w.x-w.dmx*n,w.y-w.dmy*n)),S=w,w=A[B+1];x?(this._vset(y[D=3*T],y[1+D]),this._vset(y[3+D],y[4+D])):((C=w.sub(S)).normalizeSelf(),E=C.x,x=C.y,r===F.BUTT?this._buttCapEnd(w,E,x,n,0):r===F.SQUARE?this._buttCapEnd(w,E,x,n,n):r===F.ROUND&&this._roundCapEnd(w,E,x,n,l));for(var I=p.indiceStart,P=T+2,R=p.vertexStart;P<R;P++)g[I++]=P-2,g[I++]=P-1,g[I++]=P;p.indiceStart=I}},t._expandFill=function(t){for(var e=t._impl,i=e._paths,n=0,r=e._pathOffset,s=e._pathLength;r<s;r++)n+=i[r].points.length;for(var a=this.genBuffer(t,n),t=a.meshbuffer,o=t._vData,l=t._iData,h=e._pathOffset,c=e._pathLength;h<c;h++){var u=i[h],_=u.points,d=_.length;if(0!==d){for(var f=a.vertexStart,p=0;p<d;++p)this._vset(_[p].x,_[p].y);var m=a.indiceStart;if(u.complex){for(var y=[],g=f,v=a.vertexStart;g<v;g++){var b=3*g;y.push(o[b]),y.push(o[1+b])}var x=E(y,null,2);if(!x||0===x.length)continue;for(var A=0,C=x.length;A<C;A++)l[m++]=x[A]+f}else for(var T=f,S=f+2,w=a.vertexStart;S<w;S++)l[m++]=T,l[m++]=S-1,l[m++]=S;a.indiceStart=m}}},t._calculateJoins=function(t,e,i,n){var r=0;0<e&&(r=1/e);for(var s=t._paths,a=t._pathOffset,o=t._pathLength;a<o;a++)for(var l=s[a],h=l.points,c=h.length,u=h[c-1],_=h[0],d=l.nbevel=0;d<c;d++){var f=u.dy,p=-u.dx,m=_.dy,y=-_.dx;_.dmx=.5*(f+m),_.dmy=.5*(p+y),1e-6<(f=_.dmx*_.dmx+_.dmy*_.dmy)&&(600<(m=1/f)&&(m=600),_.dmx*=m,_.dmy*=m),0<_.dx*u.dy-u.dx*_.dy&&(_.flags|=O.PT_LEFT),f*(p=N(11,g(u.len,_.len)*r))*p<1&&(_.flags|=O.PT_INNERBEVEL),_.flags&O.PT_CORNER&&(f*n*n<1||i===L.BEVEL||i===L.ROUND)&&(_.flags|=O.PT_BEVEL),0!=(_.flags&(O.PT_BEVEL|O.PT_INNERBEVEL))&&l.nbevel++,u=_,_=h[d+1]}},t._flattenPaths=function(t){for(var e=t._paths,i=t._pathOffset,n=t._pathLength;i<n;i++){var r=e[i],s=r.points,a=s[s.length-1],o=s[0];2<s.length&&a.equals(o)&&(r.closed=!0,s.pop(),a=s[s.length-1]);for(var l=0,h=s.length;l<h;l++){var c=o.sub(a);a.len=c.mag(),(c.x||c.y)&&c.normalizeSelf(),a.dx=c.x,a.dy=c.y,a=o,o=s[l+1]}}},t._chooseBevel=function(t,e,i,n){var r,s,a,o,l=i.x,h=i.y;return 0!==t?(r=l+e.dy*n,s=h-e.dx*n,a=l+i.dy*n,o=h-i.dx*n):(r=a=l+i.dmx*n,s=o=h+i.dmy*n),[r,s,a,o]},t._buttCapStart=function(t,e,i,n,r){var s=t.x-e*r,t=t.y-i*r,r=i,i=-e;this._vset(s+r*n,t+i*n),this._vset(s-r*n,t-i*n)},t._buttCapEnd=function(t,e,i,n,r){var s=t.x+e*r,t=t.y+i*r,r=i,i=-e;this._vset(s+r*n,t+i*n),this._vset(s-r*n,t-i*n)},t._roundCapStart=function(t,e,i,n,r){for(var s=t.x,a=t.y,o=i,l=-e,h=0;h<r;h++){var c=h/(r-1)*V,u=M(c)*n,c=D(c)*n;this._vset(s-o*u-e*c,a-l*u-i*c),this._vset(s,a)}this._vset(s+o*n,a+l*n),this._vset(s-o*n,a-l*n)},t._roundCapEnd=function(t,e,i,n,r){var s=t.x,a=t.y,o=i,l=-e;this._vset(s+o*n,a+l*n),this._vset(s-o*n,a-l*n);for(var h=0;h<r;h++){var c=h/(r-1)*V,u=M(c)*n,c=D(c)*n;this._vset(s,a),this._vset(s-o*u+e*c,a-l*u+i*c)}},t._roundJoin=function(t,e,i,n,r){var s=t.dy,a=-t.dx,o=e.dy,l=-e.dx,h=e.x,c=e.y;if(0!=(e.flags&O.PT_LEFT)){var u=this._chooseBevel(e.flags&O.PT_INNERBEVEL,t,e,i),_=u[0],d=u[1],f=u[2],u=u[3],p=B(-a,-s),m=B(-l,-o);p<m&&(m-=2*V),this._vset(_,d),this._vset(h-s*n,e.y-a*n);for(var y=I(k((p-m)/V)*r,2,r),g=0;g<y;g++){var v=p+g/(y-1)*(m-p),b=h+M(v)*n,v=c+D(v)*n;this._vset(h,c),this._vset(b,v)}this._vset(f,u),this._vset(h-o*n,c-l*n)}else{var _=this._chooseBevel(e.flags&O.PT_INNERBEVEL,t,e,-n),d=_[0],f=_[1],u=_[2],t=_[3],x=B(a,s),A=B(l,o);A<x&&(A+=2*V),this._vset(h+s*n,c+a*n),this._vset(d,f);for(var C=I(k((A-x)/V)*r,2,r),T=0;T<C;T++){var S=x+T/(C-1)*(A-x),w=h+M(S)*i,S=c+D(S)*i;this._vset(w,S),this._vset(h,c)}this._vset(h+o*n,c+l*n),this._vset(u,t)}},t._bevelJoin=function(t,e,i,n){var r,s,a,o,l=t.dy,h=-t.dx,c=e.dy,u=-e.dx;e.flags&O.PT_LEFT?(r=(o=this._chooseBevel(e.flags&O.PT_INNERBEVEL,t,e,i))[0],s=o[1],a=o[2],o=o[3],this._vset(r,s),this._vset(e.x-l*n,e.y-h*n),this._vset(a,o),this._vset(e.x-c*n,e.y-u*n)):(s=(r=this._chooseBevel(e.flags&O.PT_INNERBEVEL,t,e,-n))[0],a=r[1],o=r[2],t=r[3],this._vset(e.x+l*i,e.y+h*i),this._vset(s,a),this._vset(e.x+c*i,e.y+u*i),this._vset(o,t))},t._vset=function(t,e){var i=this._buffer,n=i.meshbuffer,r=3*i.vertexStart,s=n._vData,a=n._uintVData;s[r]=t,s[1+r]=e,a[2+r]=this._curColor,i.vertexStart++,n._dirty=!0};var c,h=u;function u(t){return(t=c.call(this,t)||this)._buffer=null,t._buffers=[],t._bufferOffset=0,t}i.default=h,n.default.register(cc.Graphics,h),e.exports=i.default},{"../../../../../renderer/core/input-assembler":353,"../../../../graphics/graphics":172,"../../../../graphics/types":175,"../../../assembler":259,"../../../index":262,"../../mesh-buffer":298,"../../vertex-format":303,"./earcut":271,"./impl":272}],274:[function(t,e,i){"use strict";cc.assemblers={},t("./sprite"),t("./mask-assembler"),t("./graphics"),t("./label"),t("./motion-streak")},{"./graphics":273,"./label":281,"./mask-assembler":282,"./motion-streak":283,"./sprite":296}],275:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r,x=0,t=(n=((t=t("../../../../utils/label/bmfont"))&&t.__esModule?t:{default:t}).default,t=n,(r=s).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,(r=s.prototype).initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt())},r._reserveQuads=function(t,e){var i=4*e,e=6*e,n=this._renderData._flexBuffer;n.reserve(i,e),n.used(i,e);for(var r=this._renderData.iDatas[0],s=0,a=0,o=e;s<o;s+=6,a+=4)r[s]=a,r[s+1]=a+1,r[s+2]=a+2,r[s+3]=a+1,r[s+4]=a+3,r[s+5]=a+2;x=0},r._quadsUpdated=function(t){x=0,this._renderData._flexBuffer.used(this.verticesCount,this.indicesCount)},r._getColor=function(t){return t.node._color._val},r.appendQuad=function(t,e,i,n,r,s,a){var o=this._renderData,l=o.vDatas[0],h=o.uintVDatas[0];this.verticesCount+=4,this.indicesCount=this.verticesCount/2*3;var c,u,_,d,o=e.width,e=e.height,f=i.width,p=i.height,m=this._getColor(t),y=this.floatsPerVert,g=x+this.uvOffset;n?(c=i.x/o,_=(i.x+p)/o,u=(i.y+f)/e,d=i.y/e,l[g]=c,l[g+1]=d,l[g+=y]=c,l[g+1]=u,l[g+=y]=_,l[g+1]=d,l[g+=y]=_,l[g+1]=u):(c=i.x/o,_=(i.x+f)/o,u=(i.y+p)/e,d=i.y/e,l[g]=c,l[g+1]=u,l[g+=y]=_,l[g+1]=u,l[g+=y]=c,l[g+1]=d,l[g+=y]=_,l[g+1]=d),this.appendVerts(t,x,c=r,_=r+f*a,u=s-p*a,d=s);for(var v=x+this.colorOffset,b=0;b<4;b++)h[v]=m,v+=y;x+=4*this.floatsPerVert},r.appendVerts=function(t,e,i,n,r,s){var a=this._local,o=this.floatsPerVert;a[e]=i,a[e+1]=r,a[e+=o]=n,a[e+1]=r,a[e+=o]=i,a[e+1]=s,a[e+=o]=n,a[e+1]=s},r.updateWorldVerts=function(t){for(var t=t.node._worldMatrix.m,e=t[0],i=t[1],n=t[4],r=t[5],s=t[12],a=t[13],o=this._local,l=this._renderData.vDatas[0],h=this.floatsPerVert,c=0;c<o.length;c+=h){var u=o[c],_=o[c+1];l[c]=u*e+_*n+s,l[c+1]=u*i+_*r+a}},s);function s(){return n.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../utils/label/bmfont":266}],276:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0,t("../../../../../platform/js"),t("./bmfont");var n,r,t=t("../../../../utils/label/letter-font"),s=cc.color(255,255,255,255),t=(t=n=t,(r=a).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,(r=a.prototype).createData=function(t){return t.requestRenderData()},r._getColor=function(t){return s._fastSetA(t.node._color.a),s._val},r.updateColor=function(t){var e=this._getColor(t);n.prototype.updateColor.call(this,t,e)},a);function a(){return n.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../../platform/js":250,"../../../../utils/label/letter-font":268,"./bmfont":275}],277:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../../../../utils/label/ttf"))&&n.__esModule?n:{default:n};var r,h=t("../../../../../components/CCLabelShadow"),s=cc.color(255,255,255,255),t=(r=n.default,t=r,(n=a).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=a.prototype).updateUVs=function(t){for(var e=this._renderData.vDatas[0],i=t._frame.uv,n=this.uvOffset,r=this.floatsPerVert,s=0;s<4;s++){var a=2*s,o=r*s+n;e[o]=i[a],e[o+1]=i[1+a]}},n.updateColor=function(t){s._fastSetA(t.node._color.a);var e=s._val;r.prototype.updateColor.call(this,t,e)},n.updateVerts=function(t){var e,i=t.node,n=t._ttfTexture.width,r=t._ttfTexture.height,s=i.anchorX*i.width,a=i.anchorY*i.height,o=h&&t.getComponent(h),l=(o&&o._enabled&&(l=(n-i.width)/2,e=(r-i.height)/2,-(o=o.offset).x>l?s+=n-i.width:l>o.x&&(s+=l-o.x),-o.y>e?a+=r-i.height:e>o.y&&(a+=e-o.y)),this._local);l[0]=-s,l[1]=-a,l[2]=n-s,l[3]=r-a,this.updateUVs(t),this.updateWorldVerts(t)},a);function a(){return r.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../../components/CCLabelShadow":124,"../../../../utils/label/ttf":269}],278:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=(r=t("../../../../../value-types/vec3"))&&r.__esModule?r:{default:r};var n,r=t("../../../../assembler-3d"),t=t("../2d/bmfont"),o=new a.default,l=new a.default,s=(t=n=t,(s=h).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,h);function h(){return n.apply(this,arguments)||this}i.default=s,cc.js.mixin(s.prototype,r,{updateWorldVerts:function(t){for(var e=t.node._worldMatrix,i=this._local,n=this._renderData.vDatas[0],r=this.floatsPerVert,s=0;s<n.length;s+=r)a.default.set(o,i[s],i[s+1],0),a.default.transformMat4(l,o,e),n[s]=l.x,n[s+1]=l.y,n[s+2]=l.z}}),e.exports=i.default},{"../../../../../value-types/vec3":340,"../../../../assembler-3d":257,"../2d/bmfont":275}],279:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r=t("../../../../assembler-3d"),s=(n=t("../2d/letter"),t=n,(s=a).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,a);function a(){return n.apply(this,arguments)||this}i.default=s,cc.js.mixin(s.prototype,r),e.exports=i.default},{"../../../../assembler-3d":257,"../2d/letter":276}],280:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r=t("../../../../assembler-3d"),s=(n=t("../2d/ttf"),t=n,(s=a).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,a);function a(){return n.apply(this,arguments)||this}i.default=s,cc.js.mixin(s.prototype,r),e.exports=i.default},{"../../../../assembler-3d":257,"../2d/ttf":277}],281:[function(t,e,i){"use strict";var n=u(t("../../../assembler")),r=u(t("../../../../components/CCLabel")),s=u(t("./2d/ttf")),a=u(t("./2d/bmfont")),o=u(t("./2d/letter")),l=u(t("./3d/ttf")),h=u(t("./3d/bmfont")),c=u(t("./3d/letter"));function u(t){return t&&t.__esModule?t:{default:t}}r.default._canvasPool={pool:[],get:function(){var t,e=this.pool.pop();return e=e?e:{canvas:t=document.createElement("canvas"),context:t.getContext("2d")}},put:function(t){32<=this.pool.length||this.pool.push(t)}},n.default.register(cc.Label,{getConstructor:function(t){var e=t.node.is3DNode,i=(e?l:s).default;return t.font instanceof cc.BitmapFont?i=(e?h:a).default:t.cacheMode===r.default.CacheMode.CHAR&&(cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?cc.warn("sorry, subdomain does not support CHAR mode currently!"):i=(e?c:o).default),i},TTF:s.default,Bmfont:a.default,Letter:o.default,TTF3D:l.default,Bmfont3D:h.default,Letter3D:c.default})},{"../../../../components/CCLabel":122,"../../../assembler":259,"./2d/bmfont":275,"./2d/letter":276,"./2d/ttf":277,"./3d/bmfont":278,"./3d/letter":279,"./3d/ttf":280}],282:[function(t,e,i){"use strict";i.__esModule=!0,i.MaskAssembler=void 0;var n=(n=t("../../assembler"))&&n.__esModule?n:{default:n};var h=t("../../../components/CCMask"),c=t("../../render-flow"),u=t("./sprite/2d/simple"),_=t("./graphics"),d=t("../../../../renderer/gfx"),f=t("../vertex-format").vfmtPos,p=[];function m(){return 1<<p.length-1}function y(t,e,i,n,r,s){var t=t.effect,a=d.STENCIL_OP_KEEP,o=d.STENCIL_OP_KEEP;t.setStencil(d.STENCIL_ENABLE,e,n,r,i,a,o,s)}function g(t){var e=d.DS_FUNC_EQUAL,i=d.STENCIL_OP_KEEP,n=function(){for(var t=0,e=0;e<p.length;++e)t+=1<<e;return t}(),r=m(),s=p[p.length-1];y(s._enableMaterial,e,i,n,n,r),t._flushMaterial(s._enableMaterial)}t=r=u,(s=a).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,(s=a.prototype).updateRenderData=function(t){t._type===h.Type.IMAGE_STENCIL?t.spriteFrame?u.prototype.updateRenderData.call(this,t):t.setMaterial(0,null):(t._graphics.setMaterial(0,t._materials[0]),_.prototype.updateRenderData.call(t._graphics._assembler,t._graphics,t._graphics))},s.fillBuffers=function(t,e){var i,n,r,s,a,o,l;t._type===h.Type.IMAGE_STENCIL&&!t.spriteFrame||(l=t,8<p.length+1&&cc.errorID(9e3,8),p.push(l),l=t,i=e,n=d.DS_FUNC_NEVER,r=m(),s=l.inverted?d.STENCIL_OP_REPLACE:d.STENCIL_OP_ZERO,y(l._clearMaterial,n,s,r,r,r),n=i.getBuffer("mesh",f),r=(s=n.request(4,6)).indiceOffset,a=s.byteOffset>>2,s=s.vertexOffset,o=n._vData,n=n._iData,o[a++]=-1,o[a++]=-1,o[a++]=-1,o[a++]=1,o[a++]=1,o[a++]=1,o[a++]=1,o[+a]=-1,n[r++]=s,n[r++]=s+3,n[r++]=s+1,n[r++]=s+1,n[r++]=s+3,n[+r]=s+2,i.node=i._dummyNode,i.material=l._clearMaterial,i._flush(),o=t,a=e,n=d.DS_FUNC_NEVER,r=m(),s=o.inverted?d.STENCIL_OP_ZERO:d.STENCIL_OP_REPLACE,y(o._materials[0],n,s,r,r,r),a.material=o._materials[0],o._type===h.Type.IMAGE_STENCIL?(a.node=a._dummyNode,u.prototype.fillBuffers.call(o._assembler,o,a),a._flush()):(a.node=o.node,_.prototype.fillBuffers.call(o._graphics._assembler,o._graphics,a)),g(e)),t.node._renderFlag|=c.FLAG_UPDATE_RENDER_DATA},s.postFillBuffers=function(t,e){var i;t._type===h.Type.IMAGE_STENCIL&&!t.spriteFrame||(i=t,e=e,0===p.length&&cc.errorID(9001),p.pop(),0===p.length?e._flushMaterial(i._exitMaterial):g(e)),t.node._renderFlag|=c.FLAG_UPDATE_RENDER_DATA};var r,s,t=a;function a(){return r.apply(this,arguments)||this}i.MaskAssembler=t,n.default.register(h,t)},{"../../../../renderer/gfx":363,"../../../components/CCMask":126,"../../assembler":259,"../../render-flow":263,"../vertex-format":303,"./graphics":273,"./sprite/2d/simple":287}],283:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../../assembler-2d"))&&n.__esModule?n:{default:n};var r=t("../../../components/CCMotionStreak"),f=t("../../render-flow");function A(t,e){this.point=t||cc.v2(),this.dir=e||cc.v2(),this.distance=0,this.time=0}A.prototype.setPoint=function(t,e){this.point.x=t,this.point.y=e},A.prototype.setDir=function(t,e){this.dir.x=t,this.dir.y=e},cc.v2(),cc.v2();var C=cc.v2(),T=cc.v2();s=n.default,t=s,(n=a).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=a.prototype).initData=function(){this._renderData.createFlexData(0,16,42)},n.update=function(t,e){var i,n=t._stroke/2,r=t.node._worldMatrix.m,s=r[12],r=r[13],a=t._points;1<a.length&&((l=a[0].point.x-s)*l+(l=a[0].point.y-r)*l<t.minSeg&&(i=a[0])),i||(i=new A,a.splice(0,0,i)),i.setPoint(s,r),i.time=t._fadeTime+e;var o=0;if(!(a.length<2)){var l=t._color,h=l.r,c=l.g,u=l.b,_=l.a,s=a[1],r=(s.distance=i.point.sub(s.point,T).mag(),T.normalizeSelf(),s.setDir(T.x,T.y),i.setDir(T.x,T.y),this._renderData._flexBuffer);r.reserve(2*a.length,6*(a.length-1));for(var d=r.vData,f=r.uintVData,p=t._fadeTime,m=!1,y=a.length-1;0<=y;y--){var g=a[y],v=g.point,b=g.dir;if(g.time-=e,g.time<0)a.splice(y,1);else{var g=g.time/p,x=a[y-1];if(!m){if(!x){a.splice(y,1);continue}v.x=x.point.x-b.x*g,v.y=x.point.y-b.y*g}m=!0,x=b,(b=C).x=-x.y,b.y=x.x;b=(g*_<<24>>>0)+(u<<16)+(c<<8)+h,x=5*o;d[x]=v.x+C.x*n,d[1+x]=v.y+C.y*n,d[2+x]=1,d[3+x]=g,f[4+x]=b,d[x+=5]=v.x-C.x*n,d[1+x]=v.y-C.y*n,d[2+x]=0,d[3+x]=g,f[4+x]=b,o+=2}}r.used(o,o<=2?0:3*(o-2))}},n.fillBuffers=function(t,e){var i=this._renderData._flexBuffer,n=i.vData,r=i.usedVertices,s=i.usedIndices,i=i.usedVerticesFloats,e=e._meshBuffer,s=e.request(r,s),a=s.byteOffset>>2,o=e._vData;n.length+a>o.length?o.set(n.subarray(0,i),a):o.set(n,a);for(var l=e._iData,h=s.indiceOffset,c=s.vertexOffset,u=0,_=r;u<_;u+=2){var d=c+u;l[h++]=d,l[h++]=d+2,l[h++]=d+1,l[h++]=d+1,l[h++]=d+2,l[h++]=d+3}t.node._renderFlag|=f.FLAG_UPDATE_RENDER_DATA};var s,t=a;function a(){return s.apply(this,arguments)||this}(i.default=t).register(r,t),e.exports=i.default},{"../../../components/CCMotionStreak":127,"../../assembler-2d":256,"../../render-flow":263}],284:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../../../../assembler-2d"))&&n.__esModule?n:{default:n};var r,b=t("../../../../../components/CCSprite").FillType,t=(r=n.default,t=r,(n=s).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=s.prototype).updateRenderData=function(t){var e,i=t._spriteFrame;this.packToDynamicAtlas(t,i),t._vertsDirty&&(i=t._fillStart,(e=t._fillRange)<0&&(i+=e,e=-e),e=(e=1<(e=i+e)?1:e)<0?0:e,e=1<(e=(i=(i=1<i?1:i)<0?0:i)+(e=(e-=i)<0?0:e))?1:e,this.updateUVs(t,i,e),this.updateVerts(t,i,e),t._vertsDirty=!1)},n.updateUVs=function(t,e,i){var n,r,s,a,o,l,h,c,u,_,d=t._spriteFrame,f=d._texture.width,p=d._texture.height,m=d._rect,y=(d._rotated?(n=m.x/f,r=(m.y+m.width)/p,s=o=n,h=u=(m.x+m.height)/f,l=_=r,a=c=m.y/p):(n=m.x/f,r=(m.y+m.height)/p,s=h=n,o=u=(m.x+m.width)/f,a=l=r,c=_=m.y/p),this._renderData.vDatas[0]),g=this.uvOffset,v=this.floatsPerVert;switch(t._fillType){case b.HORIZONTAL:y[g]=s+(o-s)*e,y[g+1]=a+(l-a)*e,y[g+v]=s+(o-s)*i,y[g+v+1]=a+(l-a)*i,y[g+2*v]=h+(u-h)*e,y[g+2*v+1]=c+(_-c)*e,y[g+3*v]=h+(u-h)*i,y[g+3*v+1]=c+(_-c)*i;break;case b.VERTICAL:y[g]=s+(h-s)*e,y[g+1]=a+(c-a)*e,y[g+v]=o+(u-o)*e,y[g+v+1]=l+(_-l)*e,y[g+2*v]=s+(h-s)*i,y[g+2*v+1]=a+(c-a)*i,y[g+3*v]=o+(u-o)*i,y[g+3*v+1]=l+(_-l)*i;break;default:cc.errorID(2626)}},n.updateVerts=function(t,e,i){var n,r=t.node,s=r.width,a=r.height,o=r.anchorX*s,r=r.anchorY*a,l=-o,h=-r,c=s-o,u=a-r;switch(t._fillType){case b.HORIZONTAL:n=l+(c-l)*i,l+=(c-l)*e,c=n;break;case b.VERTICAL:n=h+(u-h)*i,h+=(u-h)*e,u=n;break;default:cc.errorID(2626)}s=this._local;s[0]=l,s[1]=h,s[2]=c,s[3]=u,this.updateWorldVerts(t)},s);function s(){return r.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../../components/CCSprite":136,"../../../../assembler-2d":256}],285:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;n=((t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t}).default,t=n,(r=s).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,(r=s.prototype).initData=function(t){this._renderData.createFlexData(0,4,6,this.getVfmt())},r.updateRenderData=function(t){this.packToDynamicAtlas(t,t._spriteFrame);var e,i=t.spriteFrame;i&&(i=i.vertices)&&(this.verticesCount=i.x.length,this.indicesCount=i.triangles.length,(e=this._renderData._flexBuffer).reserve(this.verticesCount,this.indicesCount)&&(this.updateColor(t),t._vertsDirty=!0),e.used(this.verticesCount,this.indicesCount),this.updateIndices(i.triangles),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),this.updateWorldVerts(t),t._vertsDirty=!1))},r.updateIndices=function(t){this._renderData.iDatas[0].set(t)},r.updateUVs=function(t){for(var t=t.spriteFrame.vertices,e=t.nu,i=t.nv,n=this.uvOffset,r=this.floatsPerVert,s=this._renderData.vDatas[0],a=0;a<e.length;a++){var o=r*a+n;s[o]=e[a],s[o+1]=i[a]}},r.updateVerts=function(t){var e=t.node,i=Math.abs(e.width),n=Math.abs(e.height),r=e.anchorX*i,s=e.anchorY*n,e=t.spriteFrame,a=e.vertices,o=a.x,l=a.y,a=e._originalSize.width,h=e._originalSize.height,c=e._rect.width,u=e._rect.height,_=e._offset.x+(a-c)/2,d=e._offset.y+(h-u)/2,f=i/(t.trim?c:a),p=n/(t.trim?u:h),m=this._local;if(t.trim)for(var y=0,g=o.length;y<g;y++){var v=2*y;m[v]=(o[y]-_)*f-r,m[1+v]=(h-l[y]-d)*p-s}else for(var b=0,x=o.length;b<x;b++){var A=2*b;m[A]=o[b]*f-r,m[1+A]=(h-l[b])*p-s}},r.updateWorldVerts=function(t){for(var t=t.node._worldMatrix.m,e=t[0],i=t[1],n=t[4],r=t[5],s=t[12],a=t[13],o=this._local,l=this._renderData.vDatas[0],h=this.floatsPerVert,c=0,u=this.verticesCount;c<u;c++){var _=o[2*c],d=o[2*c+1];l[h*c]=_*e+d*n+s,l[h*c+1]=_*i+d*r+a}};var n,r,t=s;function s(){return n.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../assembler-2d":256}],286:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t};var p=2*Math.PI,m=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],y=[0,0,0,0],g=[0,0,0,0,0,0,0,0],v=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],b=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],x=cc.v2(0,0),A=[];function C(t,e,i,n,r,s,a){var o,l,h=Math.sin(s),c=Math.cos(s);0!==Math.cos(s)&&(o=h/c,0<(t-r.x)*c&&(l=r.y+o*(t-r.x),a[0].x=t,a[0].y=l),0<(e-r.x)*c&&(t=r.y+o*(e-r.x),a[2].x=e,a[2].y=t)),0!==Math.sin(s)&&(l=c/h,0<(n-r.y)*h&&(o=r.x+l*(n-r.y),a[3].x=o,a[3].y=n),0<(i-r.y)*h&&(e=r.x+l*(i-r.y),a[1].x=e,a[1].y=i))}function _(t,e){var i=e.x-t.x,e=e.y-t.y;if(0!=i||0!=e){if(0==i)return 0<e?.5*Math.PI:1.5*Math.PI;t=Math.atan(e/i);return i<0&&(t+=Math.PI),t}}T=t.default,t=T,(n=r).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=r.prototype).initData=function(t){this._renderData.createFlexData(0,4,6,this.getVfmt()),this.updateIndices()},n.updateRenderData=function(t){T.prototype.updateRenderData.call(this,t);var e,i,n,r,s,a,o,l,h,c,u,_=t.spriteFrame;if(this.packToDynamicAtlas(t,_),t._vertsDirty){var d=t._fillStart,f=t._fillRange;for(f<0&&(d+=f,f=-f);1<=d;)--d;for(;d<0;)d+=1;d*=p,f*=p,a=(h=(s=t).node).width,o=h.height,l=h.anchorX*a,h=h.anchorY*o,c=-l,u=-h,a-=l,l=o-h,(o=y)[0]=c,o[1]=u,o[2]=a,o[3]=l,h=s._fillCenter,s=x.x=Math.min(Math.max(0,h.x),1)*(a-c)+c,h=x.y=Math.min(Math.max(0,h.y),1)*(l-u)+u,m[0].x=m[3].x=c,m[1].x=m[2].x=a,m[0].y=m[1].y=u,m[2].y=m[3].y=l,s!==o[A.length=0]&&(A[0]=[3,0]),s!==o[2]&&(A[2]=[1,2]),h!==o[1]&&(A[1]=[0,1]),h!==o[3]&&(A[3]=[2,3]),c=_._texture.width,a=_._texture.height,u=_._rect,l=g,_._rotated?(e=u.x/c,i=(u.x+u.height)/c,n=u.y/a,r=(u.y+u.width)/a,l[0]=l[2]=e,l[4]=l[6]=i,l[3]=l[7]=r,l[1]=l[5]=n):(e=u.x/c,i=(u.x+u.width)/c,n=u.y/a,r=(u.y+u.height)/a,l[0]=l[4]=e,l[2]=l[6]=i,l[1]=l[3]=r,l[5]=l[7]=n),C(y[0],y[2],y[1],y[3],x,d,v),C(y[0],y[2],y[1],y[3],x,d+f,b),this.updateVerts(t,d,f),t._vertsDirty=!1}},n.updateVerts=function(t,e,i){for(var n=e+i,r=this._local,s=r.length=0,a=3*this.floatsPerVert,o=0;o<4;++o){var l=A[o];if(l)if(p<=i)r.length=s+a,this._generateTriangle(r,s,x,m[l[0]],m[l[1]]),s+=a;else{var h=_(x,m[l[0]]),c=_(x,m[l[1]]);c<h&&(c+=p),h-=p,c-=p;for(var u=0;u<3;++u)n<=h||(e<=h?(r.length=s+a,n<=c?this._generateTriangle(r,s,x,m[l[0]],b[o]):this._generateTriangle(r,s,x,m[l[0]],m[l[1]]),s+=a):c<=e||(c<=n?(r.length=s+a,this._generateTriangle(r,s,x,v[o],m[l[1]])):(r.length=s+a,this._generateTriangle(r,s,x,v[o],b[o])),s+=a)),h+=p,c+=p}}this.allocWorldVerts(t),this.updateWorldVerts(t)},n.allocWorldVerts=function(t){var e=t.node._color._val,t=this._renderData,i=this.floatsPerVert,n=this._local,r=n.length/i,s=(this.verticesCount=this.indicesCount=r,t._flexBuffer);s.reserve(r,r)&&this.updateIndices(),s.used(this.verticesCount,this.indicesCount);for(var a=t.vDatas[0],o=t.uintVDatas[0],l=this.uvOffset,h=0;h<n.length;h+=i){var c=h+l;a[c]=n[c],a[c+1]=n[c+1],o[c+2]=e}},n.updateIndices=function(){for(var t=this._renderData.iDatas[0],e=0;e<t.length;e++)t[e]=e},n.updateWorldVerts=function(t){for(var t=t.node._worldMatrix.m,e=t[0],i=t[1],n=t[4],r=t[5],s=t[12],a=t[13],o=this._local,l=this._renderData.vDatas[0],h=this.floatsPerVert,c=0;c<o.length;c+=h){var u=o[c],_=o[c+1];l[c]=u*e+_*n+s,l[c+1]=u*i+_*r+a}},n._generateTriangle=function(t,e,i,n,r){var s=y[0],a=y[1],o=y[2],l=y[3],h=this.floatsPerVert;t[e]=i.x,t[e+1]=i.y,t[e+h]=n.x,t[e+h+1]=n.y,t[e+2*h]=r.x,t[e+2*h+1]=r.y;var c=this.uvOffset,u=(i.x-s)/(o-s),i=(i.y-a)/(l-a);this._generateUV(u,i,t,e+c),u=(n.x-s)/(o-s),i=(n.y-a)/(l-a),this._generateUV(u,i,t,e+h+c),u=(r.x-s)/(o-s),i=(r.y-a)/(l-a),this._generateUV(u,i,t,e+2*h+c)},n._generateUV=function(t,e,i,n){var r=g[0]+(g[2]-g[0])*t,s=g[1]+(g[3]-g[1])*t,a=g[5]+(g[7]-g[5])*t;i[n]=r+(g[4]+(g[6]-g[4])*t-r)*e,i[n+1]=s+(a-s)*e};var T,n,t=r;function r(){return T.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../assembler-2d":256}],287:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;n=((t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t}).default,t=n,(r=s).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,(r=s.prototype).updateRenderData=function(t){this.packToDynamicAtlas(t,t._spriteFrame),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},r.updateUVs=function(t){for(var e=t._spriteFrame.uv,i=this.uvOffset,n=this.floatsPerVert,r=this._renderData.vDatas[0],s=0;s<4;s++){var a=2*s,o=n*s+i;r[o]=e[a],r[o+1]=e[1+a]}},r.updateVerts=function(t){var e,i,n,r,s,a,o,l,h=t.node,c=h.width,u=h.height,_=h.anchorX*c,h=h.anchorY*u,d=(c=t.trim?(a=-_,o=-h,l=c-_,u-h):(r=(n=t.spriteFrame)._originalSize.width,e=n._originalSize.height,d=n._rect.width,i=n._rect.height,s=(n=n._offset).x+(r-d)/2,d=n.x-(r-d)/2,a=s*(s=c/r)-_,o=(n.y+(e-i)/2)*(r=u/e)-h,l=c+d*s-_,u+(n.y-(e-i)/2)*r-h),this._local);d[0]=a,d[1]=o,d[2]=l,d[3]=c,this.updateWorldVerts(t)};var n,r,t=s;function s(){return n.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../assembler-2d":256}],288:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;n=((t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t}).default,t=n,(r=s).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,(r=s.prototype).initData=function(t){if(!(0<this._renderData.meshCount)){this._renderData.createData(0,this.verticesFloats,this.indicesCount);for(var e=this._renderData.iDatas[0],i=0,n=0;n<3;++n)for(var r=0;r<3;++r){var s=4*n+r;e[i++]=s,e[i++]=s+1,e[i++]=s+4,e[i++]=s+1,e[i++]=s+5,e[i++]=s+4}}},r.initLocal=function(){this._local=[],this._local.length=8},r.updateRenderData=function(t){var e=t._spriteFrame;this.packToDynamicAtlas(t,e),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},r.updateVerts=function(t){var e=t.node,i=e.width,n=e.height,r=e.anchorX*i,e=e.anchorY*n,s=t.spriteFrame,a=s.insetLeft,o=s.insetRight,l=s.insetTop,s=s.insetBottom,h=i-a-o,c=n-l-s,o=i/(a+o),l=n/(l+s),o=isNaN(o)||1<o?1:o,l=isNaN(l)||1<l?1:l,h=h<0?0:h,c=c<0?0:c,u=this._local;u[0]=-r,u[1]=-e,u[2]=a*o-r,u[3]=s*l-e,u[4]=u[2]+h,u[5]=u[3]+c,u[6]=i-r,u[7]=n-e,this.updateWorldVerts(t)},r.updateUVs=function(t){for(var e=this._renderData.vDatas[0],i=t.spriteFrame.uvSliced,n=this.uvOffset,r=this.floatsPerVert,s=0;s<4;++s)for(var a=0;a<4;++a){var o=4*s+a,l=i[o],o=o*r;e[o+n]=l.u,e[o+n+1]=l.v}},r.updateWorldVerts=function(t){for(var t=t.node._worldMatrix.m,e=t[0],i=t[1],n=t[4],r=t[5],s=t[12],a=t[13],o=this._local,l=this._renderData.vDatas[0],h=this.floatsPerVert,c=0;c<4;++c)for(var u=o[2*c+1],_=0;_<4;++_){var d=o[2*_],f=(4*c+_)*h;l[f]=d*e+u*n+s,l[1+f]=d*i+u*r+a}};var n,r,t=s;function s(){return n.apply(this,arguments)||this}i.default=t,Object.assign(t.prototype,{verticesCount:16,indicesCount:54}),e.exports=i.default},{"../../../../assembler-2d":256}],289:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;n=((t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t}).default,t=n,(r=s).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,(r=s.prototype).initData=function(t){this.verticesCount=0,this.contentWidth=0,this.contentHeight=0,this.rectWidth=0,this.rectHeight=0,this.hRepeat=0,this.vRepeat=0,this.row=0,this.col=0,this._renderData.createFlexData(0,4,6,this.getVfmt()),this._updateIndices()},r.initLocal=function(){this._local={x:[],y:[]}},r._updateIndices=function(){for(var t=this._renderData.iDatas[0],e=0,i=0,n=t.length;e<n;e+=6,i+=4)t[e]=i,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+1,t[e+4]=i+3,t[e+5]=i+2},r.updateRenderData=function(t){var e=t._spriteFrame,i=(this.packToDynamicAtlas(t,e),t.node),n=this.contentWidth=Math.abs(i.width),i=this.contentHeight=Math.abs(i.height),r=e._rect,s=e.insetLeft,a=e.insetRight,o=r.width-s-a,l=e.insetTop,e=e.insetBottom,r=r.height-l-e,n=(this.sizableWidth=n-s-a,this.sizableHeight=i-l-e,this.sizableWidth=0<this.sizableWidth?this.sizableWidth:0,this.sizableHeight=0<this.sizableHeight?this.sizableHeight:0,this.hRepeat=0==o?this.sizableWidth:this.sizableWidth/o),s=this.vRepeat=0==r?this.sizableHeight:this.sizableHeight/r,a=(this.row=Math.ceil(s+2))*(this.col=Math.ceil(n+2)),i=(this.verticesCount=4*a,this.indicesCount=6*a,this._renderData._flexBuffer);i.reserve(this.verticesCount,this.indicesCount)&&(this._updateIndices(),this.updateColor(t)),i.used(this.verticesCount,this.indicesCount),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},r.updateVerts=function(t){for(var e=t._spriteFrame,i=e._rect,n=t.node,r=n.anchorX*n.width,s=n.anchorY*n.height,a=this.row,o=this.col,l=this.contentWidth,h=this.contentHeight,c=this._local,u=c.x,_=c.y,d=(u.length=_.length=0,e.insetLeft),f=e.insetRight,p=i.width-d-f,m=e.insetTop,y=e.insetBottom,g=i.height-m-y,v=1<n.width/(d+f)?1:n.width/(d+f),b=1<n.height/(m+y)?1:n.height/(m+y),x=0<p?Math.floor(1e3*this.sizableWidth)/1e3%p==0?p:this.sizableWidth%p:this.sizableWidth,A=0<g?Math.floor(1e3*this.sizableHeight)/1e3%g==0?g:this.sizableHeight%g:this.sizableHeight,C=0;C<=o;C++)0===C?u[C]=-r:0<C&&C<o?u[C]=1===C?d*v+Math.min(p,this.sizableWidth)-r:0<p?C===o-1?d+x+p*(C-2)-r:d+Math.min(p,this.sizableWidth)+p*(C-2)-r:d+this.sizableWidth-r:C===o&&(u[C]=Math.min(d+this.sizableWidth+f,l)-r);for(var T=0;T<=a;T++)0===T?_[T]=-s:0<T&&T<a?_[T]=1===T?y*b+Math.min(g,this.sizableHeight)-s:0<g?T===a-1?y+A+(T-2)*g-s:y+Math.min(g,this.sizableHeight)+(T-2)*g-s:y+this.sizableHeight-s:T===a&&(_[T]=Math.min(y+this.sizableHeight+m,h)-s);this.updateWorldVerts(t)},r.updateWorldVerts=function(t){for(var e,i,n=this._renderData,r=this._local,s=r.x,a=r.y,o=n.vDatas[0],r=this.row,l=this.col,n=t.node._worldMatrix.m,h=n[0],c=n[1],u=n[4],_=n[5],d=n[12],f=n[13],p=this.floatsPerVert,m=0,y=0,g=r;y<g;++y)for(var v=a[y],b=a[y+1],x=0,A=l;x<A;++x)e=s[x],i=s[x+1],o[m]=e*h+v*u+d,o[m+1]=e*c+v*_+f,o[m+=p]=i*h+v*u+d,o[m+1]=i*c+v*_+f,o[m+=p]=e*h+b*u+d,o[m+1]=e*c+b*_+f,o[m+=p]=i*h+b*u+d,o[m+1]=i*c+b*_+f,m+=p},r.updateUVs=function(t){var e=this._renderData.vDatas[0];if(e)for(var i,n=t._spriteFrame,r=n._rect,s=n.insetLeft,a=n.insetRight,o=r.width-s-a,s=n.insetTop,a=n.insetBottom,l=r.height-s-a,h=this.row,c=this.col,u=this.hRepeat,_=this.vRepeat,d=t.spriteFrame.uv,f=t.spriteFrame.uvSliced,p=t.spriteFrame._rotated,m=this.floatsPerVert,y=this.uvOffset,g=0,v=h;g<v;++g)for(var b=this.sizableHeight>l?this.sizableHeight>=g*l?1:_%1:_,x=0,A=c;x<A;++x)i=this.sizableWidth>o?this.sizableWidth>=x*o?1:u%1:u,p?(e[y]=d[0],e[y+1]=d[1],e[y+=m]=d[0],e[y+1]=d[1]+(d[7]-d[1])*i,e[y+=m]=d[0]+(d[6]-d[0])*b,e[y+1]=d[1],e[y+=m]=e[y-m],e[y+1]=e[y+1-2*m]):(0===x?e[y]=d[0]:0<x&&x<c-1?e[y]=f[1].u:x===c-1&&(e[y]=f[2].u),0===g?e[y+1]=f[0].v:0<g&&g<h-1?e[y+1]=f[4].v:g===h-1&&(e[y+1]=f[8].v),y+=m,0===x||0<x&&x<c-1?e[y]=f[1].u+(f[2].u-f[1].u)*i:x===c-1&&(e[y]=f[3].u),0===g?e[y+1]=f[0].v:0<g&&g<h-1?e[y+1]=f[4].v:g===h-1&&(e[y+1]=f[8].v),y+=m,0===x?e[y]=d[0]:0<x&&x<c-1?e[y]=f[1].u:x===c-1&&(e[y]=f[2].u),0===g||0<g&&g<h-1?e[y+1]=f[4].v+(f[8].v-f[4].v)*b:g===h-1&&(e[y+1]=f[12].v),e[y+=m]=e[y-2*m],e[y+1]=e[y+1-m]),y+=m};var n,r,t=s;function s(){return n.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../assembler-2d":256}],290:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r=t("../../../../assembler-3d"),s=(n=t("../2d/bar-filled"),t=n,(s=a).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,a);function a(){return n.apply(this,arguments)||this}i.default=s,cc.js.mixin(s.prototype,r),e.exports=i.default},{"../../../../assembler-3d":257,"../2d/bar-filled":284}],291:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var l=(r=t("../../../../../value-types/vec3"))&&r.__esModule?r:{default:r};var n,r=t("../../../../assembler-3d"),t=t("../2d/mesh"),h=new l.default,s=(t=n=t,(s=a).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,a);function a(){return n.apply(this,arguments)||this}i.default=s,cc.js.mixin(s.prototype,r,{updateWorldVerts:function(t){for(var e=t.node._worldMatrix,i=this._local,n=this._renderData.vDatas[0],r=this.floatsPerVert,s=0,a=i.length/2;s<a;s++){l.default.set(h,i[2*s],i[2*s+1],0),l.default.transformMat4(h,h,e);var o=r*s;n[o]=h.x,n[1+o]=h.y,n[2+o]=h.z}}}),e.exports=i.default},{"../../../../../value-types/vec3":340,"../../../../assembler-3d":257,"../2d/mesh":285}],292:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=(r=t("../../../../../value-types/vec3"))&&r.__esModule?r:{default:r};var n,r=t("../../../../assembler-3d"),t=t("../2d/radial-filled"),o=new a.default,l=new a.default,s=(t=n=t,(s=h).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,h);function h(){return n.apply(this,arguments)||this}i.default=s,cc.js.mixin(s.prototype,r,{updateWorldVerts:function(t){for(var e=t.node._worldMatrix,i=this._local,n=this._renderData.vDatas[0],r=this.floatsPerVert,s=0;s<n.length;s+=r)a.default.set(o,i[s],i[s+1],0),a.default.transformMat4(l,o,e),n[s]=l.x,n[s+1]=l.y,n[s+2]=l.z}}),e.exports=i.default},{"../../../../../value-types/vec3":340,"../../../../assembler-3d":257,"../2d/radial-filled":286}],293:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r=t("../../../../assembler-3d"),s=(n=t("../2d/simple"),t=n,(s=a).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,a);function a(){return n.apply(this,arguments)||this}i.default=s,cc.js.mixin(s.prototype,r),e.exports=i.default},{"../../../../assembler-3d":257,"../2d/simple":287}],294:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var h=(r=t("../../../../../value-types/vec3"))&&r.__esModule?r:{default:r};var n,r=t("../../../../assembler-3d"),t=t("../2d/sliced"),c=new h.default,u=new h.default,s=(t=n=t,(s=a).prototype=Object.create(t.prototype),(s.prototype.constructor=s).__proto__=t,a);function a(){return n.apply(this,arguments)||this}i.default=s,cc.js.mixin(s.prototype,r,{updateWorldVerts:function(t){for(var e=t.node._worldMatrix,i=this._local,n=this._renderData.vDatas[0],r=this.floatsPerVert,s=0;s<4;++s)for(var a=i[2*s+1],o=0;o<4;++o){var l=i[2*o],l=(h.default.set(c,l,a,0),h.default.transformMat4(u,c,e),(4*s+o)*r);n[l]=u.x,n[1+l]=u.y,n[2+l]=u.z}}}),e.exports=i.default},{"../../../../../value-types/vec3":340,"../../../../assembler-3d":257,"../2d/sliced":288}],295:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var v=(n=t("../../../../../value-types/vec3"))&&n.__esModule?n:{default:n};for(var n=t("../../../../assembler-3d"),t=t("../2d/tiled"),b=[],r=0;r<4;r++)b.push(new v.default);t=s=t,(a=o).prototype=Object.create(t.prototype),(a.prototype.constructor=a).__proto__=t;var s,a=o;function o(){return s.apply(this,arguments)||this}i.default=a,cc.js.mixin(a.prototype,n,{updateWorldVerts:function(t){for(var e,i,n=this._local,r=n.x,s=n.y,a=this._renderData.vDatas[0],n=this.row,o=this.col,l=t.node._worldMatrix,h=0,c=0,u=n;c<u;++c)for(var _=s[c],d=s[c+1],f=0,p=o;f<p;++f){e=r[f],i=r[f+1],v.default.set(b[0],e,_,0),v.default.set(b[1],i,_,0),v.default.set(b[2],e,d,0),v.default.set(b[3],i,d,0);for(var m=0;m<4;m++){var y=b[m],g=(v.default.transformMat4(y,y,l),6*m);a[h+g]=y.x,a[h+g+1]=y.y,a[h+g+2]=y.z}h+=24}}}),e.exports=i.default},{"../../../../../value-types/vec3":340,"../../../../assembler-3d":257,"../2d/tiled":289}],296:[function(t,e,i){"use strict";var n=y(t("../../../assembler")),r=t("../../../../components/CCSprite"),s=y(t("./2d/simple")),a=y(t("./2d/sliced")),o=y(t("./2d/tiled")),l=y(t("./2d/radial-filled")),h=y(t("./2d/bar-filled")),c=y(t("./2d/mesh")),u=y(t("./3d/simple")),_=y(t("./3d/sliced")),d=y(t("./3d/tiled")),f=y(t("./3d/radial-filled")),p=y(t("./3d/bar-filled")),m=y(t("./3d/mesh"));function y(t){return t&&t.__esModule?t:{default:t}}t={getConstructor:function(t){var e=t.node.is3DNode,i=(e?u:s).default;switch(t.type){case r.Type.SLICED:i=(e?_:a).default;break;case r.Type.TILED:i=(e?d:o).default;break;case r.Type.FILLED:i=(t._fillType===r.FillType.RADIAL?e?f:l:e?p:h).default;break;case r.Type.MESH:i=(e?m:c).default}return i},Simple:s.default,Sliced:a.default,Tiled:o.default,RadialFilled:l.default,BarFilled:h.default,Mesh:c.default,Simple3D:u.default,Sliced3D:_.default,Tiled3D:d.default,RadialFilled3D:f.default,BarFilled3D:p.default,Mesh3D:m.default};n.default.register(cc.Sprite,t)},{"../../../../components/CCSprite":136,"../../../assembler":259,"./2d/bar-filled":284,"./2d/mesh":285,"./2d/radial-filled":286,"./2d/simple":287,"./2d/sliced":288,"./2d/tiled":289,"./3d/bar-filled":290,"./3d/mesh":291,"./3d/radial-filled":292,"./3d/simple":293,"./3d/sliced":294,"./3d/tiled":295}],297:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;(n=r.prototype)._reallocVData=function(t,e){this.vData=new Float32Array(t),this.uintVData=new Uint32Array(this.vData.buffer),e&&this.vData.set(e),this._handler.updateMesh(this._index,this.vData,this.iData)},n._reallocIData=function(t,e){this.iData=new Uint16Array(t),e&&this.iData.set(e),this._handler.updateMesh(this._index,this.vData,this.iData)},n.reserve=function(t,e){var i=t*this._verticesBytes>>2,n=this.vData.length,t=!1;if(n<i){for(;n<i;)n*=2;this._reallocVData(n,this.vData),t=!0}var r=this.iData.length;if(r<e){for(;r<e;)r*=2;this._reallocIData(e,this.iData),t=!0}return t},n.used=function(t,e){this.usedVertices=t,this.usedIndices=e,this.usedVerticesFloats=t*this._verticesBytes>>2,this._handler.updateMeshRange(t,e)},n.reset=function(){var t=this._initVerticesCount*this._verticesBytes>>2;this._reallocVData(t),this._reallocIData(this._initIndicesCount),this.usedVertices=0,this.usedVerticesFloats=0,this.usedIndices=0};var n=r;function r(t,e,i,n,r){this._handler=t,this._index=e,this._vfmt=r,this._verticesBytes=r._bytes,this._initVerticesCount=i,this._initIndicesCount=n,this.reset()}i.default=n,cc.FlexBuffer=n,e.exports=i.default},{}],298:[function(t,e,i){"use strict";var n=(t=t("../../../renderer/gfx"))&&t.__esModule?t:{default:t},t=cc.Class({name:"cc.MeshBuffer",ctor:function(t,e){this.init(t,e)},init:function(t,e){this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1,this._vertexFormat=e,this._vertexBytes=this._vertexFormat._bytes,this._arrOffset=0,this._vbArr=[],this._vb=new n.default.VertexBuffer(t._device,e,n.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[0]=this._vb,this._ibArr=[],this._ib=new n.default.IndexBuffer(t._device,n.default.INDEX_FMT_UINT16,n.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[0]=this._ib,this._vData=null,this._uintVData=null,this._iData=null,this._batcher=t,this._initVDataCount=256*e._bytes,this._initIDataCount=1536,this._offsetInfo={byteOffset:0,vertexOffset:0,indiceOffset:0},this._reallocBuffer()},uploadData:function(){var t,e;0!==this.byteOffset&&this._dirty&&(t=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this._iData.buffer,0,this.indiceOffset),this._vb.update(0,t),this._ib.update(0,e),this._dirty=!1)},switchBuffer:function(){var t=++this._arrOffset;this.byteOffset=0,this.vertexOffset=0,this.indiceOffset=0,this.indiceStart=0,t<this._vbArr.length?(this._vb=this._vbArr[t],this._ib=this._ibArr[t]):(this._vb=new n.default.VertexBuffer(this._batcher._device,this._vertexFormat,n.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[t]=this._vb,this._ib=new n.default.IndexBuffer(this._batcher._device,n.default.INDEX_FMT_UINT16,n.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[t]=this._ib)},checkAndSwitchBuffer:function(t){65535<this.vertexOffset+t&&(this.uploadData(),this._batcher._flush(),this.switchBuffer())},requestStatic:function(t,e){this.checkAndSwitchBuffer(t);var i=this.byteOffset+t*this._vertexBytes,n=this.indiceOffset+e,r=this._vData.byteLength,s=this._iData.length;if(r<i||s<n){for(;r<i||s<n;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}this._updateOffset(t,e,i)},_updateOffset:function(t,e,i){var n=this._offsetInfo;n.vertexOffset=this.vertexOffset,this.vertexOffset+=t,n.indiceOffset=this.indiceOffset,this.indiceOffset+=e,n.byteOffset=this.byteOffset,this.byteOffset=i,this._dirty=!0},request:function(t,e){return this._batcher._buffer!==this&&(this._batcher._flush(),this._batcher._buffer=this),this.requestStatic(t,e),this._offsetInfo},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(!0)},_reallocVData:function(t){this._vData&&(e=new Uint8Array(this._vData.buffer)),this._vData=new Float32Array(this._initVDataCount),this._uintVData=new Uint32Array(this._vData.buffer);var e,i=new Uint8Array(this._uintVData.buffer);if(e&&t)for(var n=0,r=e.length;n<r;n++)i[n]=e[n]},_reallocIData:function(t){var e=this._iData;if(this._iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this._iData,n=0,r=e.length;n<r;n++)i[n]=e[n]},reset:function(){this._arrOffset=0,this._vb=this._vbArr[0],this._ib=this._ibArr[0],this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1},destroy:function(){this.reset();for(var t=0;t<this._vbArr.length;t++)this._vbArr[t].destroy();this._vbArr=null;for(var e=0;e<this._ibArr.length;e++)this._ibArr[e].destroy();this._ibArr=null,this._ib=null,this._vb=null},forwardIndiceStartToOffset:function(){this.indiceStart=this.indiceOffset}});cc.MeshBuffer=e.exports=t},{"../../../renderer/gfx":363}],299:[function(t,e,i){"use strict";var n=a(t("../../../renderer/core/input-assembler")),r=a(t("../../../renderer/memop/recycle-pool")),s=a(t("../../../renderer/scene/model"));function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e){this._renderScene=e,this._device=t,this.walking=!1,this.material=p,this.cullingMask=1,this._iaPool=new r.default(function(){return new n.default},16),this._modelPool=new r.default(function(){return new s.default},16),this._quadBuffer=this.getBuffer("quad",h),this._meshBuffer=this.getBuffer("mesh",h),this._quadBuffer3D=this.getBuffer("quad",c),this._meshBuffer3D=this.getBuffer("mesh",c),this._buffer=this._meshBuffer,this._batchedModels=[],this._dummyNode=new cc.Node,this._sortKey=0,this.node=this._dummyNode,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0}var l=t("./vertex-format"),h=l.vfmtPosUvColor,c=l.vfmt3D,u=t("./quad-buffer"),_=t("./mesh-buffer"),d=t("./spine-buffer"),l=t("../../assets/material/CCMaterial"),f=(new(t("../../platform/id-generater"))("VertextFormat"),{}),p=new l,m=new n.default;m._count=0;o.prototype={constructor:o,reset:function(){this._iaPool.reset();for(var t,e=this._renderScene,i=this._batchedModels,n=0;n<i.length;++n)i[n].setInputAssembler(null),i[n].setEffect(null),e.removeModel(i[n]);for(t in this._modelPool.reset(),i.length=0,this._sortKey=0,f)f[t].reset();this._buffer=this._meshBuffer,this.node=this._dummyNode,this.material=p,this.cullingMask=1,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0},_flushMaterial:function(t){var e;t&&(t=(this.material=t).effect)&&(e=this._modelPool.add(),this._batchedModels.push(e),e.sortKey=this._sortKey++,e._cullingMask=this.cullingMask,e.setNode(this.node),e.setEffect(t,null),e.setInputAssembler(m),this._renderScene.addModel(e))},_flush:function(){var t,e=this.material,i=this._buffer,n=i.indiceOffset-i.indiceStart;!this.walking||!e||n<=0||(e=e.effect)&&((t=this._iaPool.add())._vertexBuffer=i._vb,t._indexBuffer=i._ib,t._start=i.indiceStart,t._count=n,n=this._modelPool.add(),this._batchedModels.push(n),n.sortKey=this._sortKey++,n._cullingMask=this.cullingMask,n.setNode(this.node),n.setEffect(e),n.setInputAssembler(t),this._renderScene.addModel(n),i.forwardIndiceStartToOffset())},_flushIA:function(t){var e,i;t&&(e=this.material.effect)&&(i=this._modelPool.add(),this._batchedModels.push(i),i.sortKey=this._sortKey++,i._cullingMask=this.cullingMask,i.setNode(this.node),i.setEffect(e),i.setInputAssembler(t),this._renderScene.addModel(i))},terminate:function(){for(var t in cc.dynamicAtlasManager&&cc.dynamicAtlasManager.enabled&&cc.dynamicAtlasManager.update(),this._flush(),f)f[t].uploadData();this.walking=!1},getBuffer:function(t,e){var i=t+e.getHash(),n=f[i];if(!n){if("mesh"===t)n=new _(this,e);else if("quad"===t)n=new u(this,e);else{if("spine"!==t)return cc.error("Not support buffer type ["+t+"]"),null;n=new d(this,e)}f[i]=n}return n}},e.exports=o},{"../../../renderer/core/input-assembler":353,"../../../renderer/memop/recycle-pool":378,"../../../renderer/scene/model":385,"../../assets/material/CCMaterial":95,"../../platform/id-generater":246,"./mesh-buffer":298,"./quad-buffer":300,"./spine-buffer":302,"./vertex-format":303}],300:[function(t,e,i){"use strict";t=t("./mesh-buffer"),t=cc.Class({name:"cc.QuadBuffer",extends:t,_fillQuadBuffer:function(){for(var t=this._initIDataCount/6,e=this._iData,i=0,n=0;i<t;i++){var r=4*i;e[n++]=r,e[n++]=1+r,e[n++]=2+r,e[n++]=1+r,e[n++]=3+r,e[n++]=2+r}var s=new Uint16Array(this._iData.buffer,0,6*t);this._ib.update(0,s)},uploadData:function(){var t;0!==this.byteOffset&&this._dirty&&(t=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),this._vb.update(0,t),this._dirty=!1)},switchBuffer:function(){this._super();var t=new Uint16Array(this._iData.buffer,0,this._initIDataCount);this._ib.update(0,t)},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(),this._fillQuadBuffer()}});cc.QuadBuffer=e.exports=t},{"./mesh-buffer":298}],301:[function(t,e,i){"use strict";i.__esModule=!0,i.default=a;var n,r=(n=t("./flex-buffer"))&&n.__esModule?n:{default:n},s=t("./vertex-format");function a(){this.vDatas=[],this.uintVDatas=[],this.iDatas=[],this.meshCount=0,this._infos=null,this._flexBuffer=null}cc.js.mixin(a.prototype,{init:function(t){},clear:function(){this.vDatas.length=0,this.iDatas.length=0,this.uintVDatas.length=0,this.meshCount=0,this._infos=null,this._flexBuffer&&this._flexBuffer.reset()},updateMesh:function(t,e,i){this.vDatas[t]=e,this.uintVDatas[t]=new Uint32Array(e.buffer,0,e.length),this.iDatas[t]=i,this.meshCount=this.vDatas.length},updateMeshRange:function(t,e){},createData:function(t,e,i){e=new Float32Array(e),i=new Uint16Array(i);this.updateMesh(t,e,i)},createQuadData:function(t,e,i){this.createData(t,e,i),this.initQuadIndices(this.iDatas[t])},createFlexData:function(t,e,i,n){n=n||s.vfmtPosUvColor,this._flexBuffer=new r.default(this,t,e,i,n)},initQuadIndices:function(t){for(var e=t.length/6,i=0,n=0;i<e;i++){var r=4*i;t[n++]=r,t[n++]=1+r,t[n++]=2+r,t[n++]=1+r,t[n++]=3+r,t[n++]=2+r}}}),cc.RenderData=a,e.exports=i.default},{"./flex-buffer":297,"./vertex-format":303}],302:[function(t,e,i){"use strict";t=cc.Class({name:"cc.SpineBuffer",extends:t("./mesh-buffer"),requestStatic:function(t,e){this.checkAndSwitchBuffer(t);var i=this.byteOffset+t*this._vertexBytes,n=this.indiceOffset+e,r=this._vData.byteLength,s=this._iData.length;if(r<i||s<n){for(;r<i||s<n;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}t=this._offsetInfo;t.vertexOffset=this.vertexOffset,t.indiceOffset=this.indiceOffset,t.byteOffset=this.byteOffset},adjust:function(t,e){this.vertexOffset+=t,this.indiceOffset+=e,this.byteOffset=this.byteOffset+t*this._vertexBytes,this._dirty=!0}});cc.SpineBuffer=e.exports=t},{"./mesh-buffer":298}],303:[function(t,e,i){"use strict";var t=(t=t("../../../renderer/gfx"))&&t.__esModule?t:{default:t},n=new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:3},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]),r=(n.name="vfmt3D",t.default.VertexFormat.XYZ_UV_Color=n,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}])),s=(r.name="vfmtPosUvColor",t.default.VertexFormat.XY_UV_Color=r,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:t.default.ATTR_COLOR0,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}])),a=(s.name="vfmtPosUvTwoColor",t.default.VertexFormat.XY_UV_Two_Color=s,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2}])),o=(a.name="vfmtPosUv",t.default.VertexFormat.XY_UV=a,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}])),l=(o.name="vfmtPosColor",t.default.VertexFormat.XY_Color=o,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2}]));l.name="vfmtPos",t.default.VertexFormat.XY=l,e.exports={vfmt3D:n,vfmtPosUvColor:r,vfmtPosUvTwoColor:s,vfmtPosUv:a,vfmtPosColor:o,vfmtPos:l}},{"../../../renderer/gfx":363}],304:[function(t,e,i){"use strict";t("../platform/CCSys");var n=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,s=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){t=n.exec(t);return t?t[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?"),i=(0<i&&(t=t.substring(0,i)),/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,"")));if(!i)return null;i=i[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?i.substring(0,i.length-e.length):i},dirname:function(t){t=r.exec(t);return t?t[2]:""},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return 0<i&&(n=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="",i=i?this.extname(t):"";return 0<n&&(r=t.substring(n),t=t.substring(0,n)),n=(n=t.lastIndexOf("/"))<=0?0:n+1,t.substring(0,n)+e+i+r},_normalize:function(t){var e;for(t=String(t);t=(e=t).replace(s,""),e.length!==t.length;);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"")}},e.exports=cc.path},{"../platform/CCSys":239}],305:[function(t,e,i){"use strict";function n(t,e,i,n,r,s){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s}n.create=function(t,e,i,n,r,s){return{a:t,b:e,c:i,d:n,tx:r,ty:s}},n.identity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},n.clone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},n.concat=function(t,e,i){var n=e.a,r=e.b,s=e.c,a=e.d,o=e.tx,e=e.ty;return t.a=n*i.a+r*i.c,t.b=n*i.b+r*i.d,t.c=s*i.a+a*i.c,t.d=s*i.b+a*i.d,t.tx=o*i.a+e*i.c+i.tx,t.ty=o*i.b+e*i.d+i.ty,t},n.invert=function(t,e){var i=e.a,n=e.b,r=e.c,s=e.d,a=1/(i*s-n*r),o=e.tx,e=e.ty;return t.a=a*s,t.b=-a*n,t.c=-a*r,t.d=a*i,t.tx=a*(r*e-s*o),t.ty=a*(n*o-i*e),t},n.fromMat4=function(t,e){e=e.m;return t.a=e[0],t.b=e[1],t.c=e[4],t.d=e[5],t.tx=e[12],t.ty=e[13],t},n.transformVec2=function(t,e,i,n){var r,e=void 0===n?(n=i,r=e.x,e.y):(r=e,i);return t.x=n.a*r+n.c*e+n.tx,t.y=n.b*r+n.d*e+n.ty,t},n.transformSize=function(t,e,i){return t.width=i.a*e.width+i.c*e.height,t.height=i.b*e.width+i.d*e.height,t},n.transformRect=function(t,e,i){var n=e.x,r=e.y,s=n+e.width,e=r+e.height,a=i.a*n+i.c*r+i.tx,o=i.b*n+i.d*r+i.ty,l=i.a*s+i.c*r+i.tx,r=i.b*s+i.d*r+i.ty,h=i.a*n+i.c*e+i.tx,n=i.b*n+i.d*e+i.ty,c=i.a*s+i.c*e+i.tx,s=i.b*s+i.d*e+i.ty,e=Math.min(a,l,h,c),i=Math.max(a,l,h,c),a=Math.min(o,r,n,s),l=Math.max(o,r,n,s);return t.x=e,t.y=a,t.width=i-e,t.height=l-a,t},n.transformObb=function(t,e,i,n,r,s){var a=r.x,o=r.y,l=r.width,r=r.height,h=s.a*a+s.c*o+s.tx,a=s.b*a+s.d*o+s.ty,o=s.a*l,l=s.b*l,c=s.c*r,s=s.d*r;e.x=h,e.y=a,i.x=o+h,i.y=l+a,t.x=c+h,t.y=s+a,n.x=o+c+h,n.y=l+s+a},cc.AffineTransform=e.exports=n},{}],306:[function(t,e,i){"use strict";var n=t("../platform/CCObject").Flags,r=t("./misc"),s=t("../platform/js"),a=t("../platform/id-generater"),o=t("../event-manager"),l=t("../renderer/render-flow"),h=n.Destroying,c=n.DontDestroy,u=n.Deactivating,_=new a("Node");function d(t){return t?"string"==typeof t?s.getClassByName(t):t:(cc.errorID(3804),null)}function f(t,e){if(e._sealed)for(var i=0;i<t._components.length;++i){var n=t._components[i];if(n.constructor===e)return n}else for(var r=0;r<t._components.length;++r){var s=t._components[r];if(s instanceof e)return s}return null}function p(t,e,i){if(e._sealed)for(var n=0;n<t._components.length;++n){var r=t._components[n];r.constructor===e&&i.push(r)}else for(var s=0;s<t._components.length;++s){var a=t._components[s];a instanceof e&&i.push(a)}}t=cc.Class({name:"cc._BaseNode",extends:cc.Object,properties:{_parent:null,_children:[],_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return 0<(this._objFlags&c)},set:function(t){t?this._objFlags|=c:this._objFlags&=~c}},name:{get:function(){return this._name},set:function(t){this._name=t}},uuid:{get:function(){return this._id}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(t){var e;this._active!==(t=!!t)&&(this._active=t,(e=this._parent)&&e._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,t))}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(t){this._name=void 0!==t?t:"New Node",this._activeInHierarchy=!1,this._id=_.getNewId(),cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.__eventTargets=[]},getParent:function(){return this._parent},setParent:function(t){var e,i;this._parent!==t&&(e=this._parent,this._parent=t||null,this._onSetParent(t),t&&(o._setDirtyForNode(this),t._children.push(this),t.emit&&t.emit("child-added",this),t._renderFlag|=l.FLAG_CHILDREN),e?e._objFlags&h||(i=e._children.indexOf(this),e._children.splice(i,1),e.emit&&e.emit("child-removed",this),this._onHierarchyChanged(e),0===e._children.length&&(e._renderFlag&=~l.FLAG_CHILDREN)):t&&this._onHierarchyChanged(null))},attr:function(t){s.mixin(this,t)},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._id===t)return e[i];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.setParent(this)},insertChild:function(t,e){t.parent=this,t.setSiblingIndex(e)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){var e,i;this._parent&&(this._parent._objFlags&u?cc.errorID(3821):(e=this._parent._children,(t=-1!==t?t:e.length-1)!==(i=e.indexOf(this))&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))))},walk:function(t,e){for(var i,n,r,s=cc._BaseNode,a=1,o=s._stacks[s._stackId],l=(o||s._stacks.push(o=[]),s._stackId++,o.length=0,o[0]=this,null),h=!1;a;)if(n=o[--a])if(!h&&t?t(n):h&&e&&e(n),o[a]=null,h){if(h=!1,i)if(i[++r])o[a]=i[r],a++;else if(l&&(o[a]=l,a++,h=!0,l._parent?(r=(i=l._parent._children).indexOf(l),l=l._parent):i=l=null,r<0))break}else 0<n._children.length?(i=(l=n)._children,o[a]=i[r=0],a++):(o[a]=n,a++,h=!0);o.length=0,s._stackId--},cleanup:function(){},removeFromParent:function(t){this._parent&&this._parent.removeChild(this,t=void 0===t?!0:t)},removeChild:function(t,e){-1<this._children.indexOf(t)&&(!e&&void 0!==e||t.cleanup(),t.parent=null)},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=e.length-1;0<=i;i--){var n=e[i];n&&(t&&n.cleanup(),n.parent=null)}this._children.length=0},isChildOf:function(t){var e=this;do{if(e===t)return!0}while(e=e._parent);return!1},getComponent:function(t){t=d(t);return t?f(this,t):null},getComponents:function(t){var t=d(t),e=[];return t&&p(this,t,e),e},getComponentInChildren:function(t){t=d(t);return t?function t(e,i){for(var n=0;n<e.length;++n){var r=e[n],s=f(r,i);if(s)return s;if(0<r._children.length&&(s=t(r._children,i)))return s}return null}(this._children,t):null},getComponentsInChildren:function(t){var t=d(t),e=[];return t&&(p(this,t,e),function t(e,i,n){for(var r=0;r<e.length;++r){var s=e[r];p(s,i,n),0<s._children.length&&t(s._children,i,n)}}(this._children,t,e)),e},_checkMultipleComp:!1,addComponent:function(t){var e;if("string"==typeof t){if(!(e=s.getClassByName(t)))return cc.errorID(3807,t),cc._RFpeek()&&cc.errorID(3808,t),null}else{if(!t)return cc.errorID(3804),null;e=t}if("function"!=typeof e)return cc.errorID(3809),null;if(!s.isChildClassOf(e,cc.Component))return cc.errorID(3810),null;t=e._requireComponent;if(t&&!this.getComponent(t)&&!this.addComponent(t))return null;t=new e;return(t.node=this)._components.push(t),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(t),t},_addComponentAt:!1,removeComponent:function(t){t?(t=t instanceof cc.Component?t:this.getComponent(t))&&t.destroy():cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(t){var e;t?this._objFlags&h||(-1!==(e=this._components.indexOf(t))?this._components.splice(e,1):t.node!==this&&cc.errorID(3815)):cc.errorID(3814)},destroy:function(){cc.Object.prototype.destroy.call(this)&&(this.active=!1)},destroyAllChildren:function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},_onSetParent:function(t){},_onPostActivated:function(){},_onBatchRestored:function(){},_onBatchCreated:function(){},_onHierarchyChanged:function(t){var e=this._parent,e=(!this._persistNode||e instanceof cc.Scene||cc.game.removePersistRootNode(this),this._active&&!(!e||!e._activeInHierarchy));this._activeInHierarchy!==e&&cc.director._nodeActivator.activateNode(this,e)},_instantiate:function(t){t=t||cc.instantiate._clone(this,this);var e=this._prefab;return e&&this===e.root&&e.sync,t._parent=null,t._onBatchRestored(),t},_registerIfAttached:!1,_onPreDestroy:function(){this._objFlags|=h;for(var t=this._parent,e=t&&t._objFlags&h,i=this._children,n=0,r=i.length;n<r;++n)i[n]._destroyImmediate();for(n=0,r=this._components.length;n<r;++n)this._components[n]._destroyImmediate();var s,a=this.__eventTargets;for(n=0,r=a.length;n<r;++n){var o=a[n];o&&o.targetOff(this)}return a.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!e&&t&&(s=t._children.indexOf(this),t._children.splice(s,1),t.emit&&t.emit("child-removed",this)),e},onRestore:!1});t.idGenerater=_,t._stacks=[[]],t._stackId=0,t.prototype._onPreDestroyBase=t.prototype._onPreDestroy,t.prototype._onHierarchyChangedBase=t.prototype._onHierarchyChanged,r.propertyDefine(t,["parent","name","children","childrenCount"],{}),cc._BaseNode=e.exports=t},{"../event-manager":154,"../platform/CCObject":236,"../platform/id-generater":246,"../platform/js":250,"../renderer/render-flow":263,"./misc":315}],307:[function(t,e,i){"use strict";e.exports={binarySearchEpsilon:function(t,e){for(var i=0,n=t.length-1,r=n>>>1;i<=n;r=i+n>>>1){var s=t[r];if(e+1e-6<s)n=r-1;else{if(!(s<e-1e-6))return r;i=r+1}}return~i}}},{}],308:[function(t,e,i){"use strict";var n=t("../components/CCRenderComponent"),r=t("../platform/CCMacro").BlendFactor,s=t("../../renderer/gfx"),t=cc.Class({properties:{_srcBlendFactor:r.SRC_ALPHA,_dstBlendFactor:r.ONE_MINUS_SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())},animatable:!1,type:r,tooltip:!1,visible:!0},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())},animatable:!1,type:r,tooltip:!1,visible:!0}},setMaterial:function(t,e){t=n.prototype.setMaterial.call(this,t,e);return this._srcBlendFactor===r.SRC_ALPHA&&this._dstBlendFactor===r.ONE_MINUS_SRC_ALPHA||this._updateMaterialBlendFunc(t),t},_updateMaterial:function(){this._updateBlendFunc()},_updateBlendFunc:function(){if(this._srcBlendFactor!==r.SRC_ALPHA||this._dstBlendFactor!==r.ONE_MINUS_SRC_ALPHA)for(var t=this.getMaterials(),e=0;e<t.length;e++){var i=t[e];this._updateMaterialBlendFunc(i)}},_updateMaterialBlendFunc:function(t){t.setBlend(!0,s.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor,s.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor)}});e.exports=cc.BlendFunc=t},{"../../renderer/gfx":363,"../components/CCRenderComponent":131,"../platform/CCMacro":235}],309:[function(t,e,i){"use strict";var s=t("./misc").BASE64_VALUES,a="0123456789abcdef".split(""),t=["","","",""],o=t.concat(t,"-",t,"-",t,"-",t,"-",t,t,t),l=o.map(function(t,e){return"-"===t?NaN:e}).filter(isFinite);e.exports=function(t){if(22!==t.length)return t;o[0]=t[0],o[1]=t[1];for(var e=2,i=2;e<22;e+=2){var n=s[t.charCodeAt(e)],r=s[t.charCodeAt(e+1)];o[l[i++]]=a[n>>2],o[l[i++]]=a[(3&n)<<2|r>>4],o[l[i++]]=a[15&r]}return o.join("")}},{"./misc":315}],310:[function(t,e,i){"use strict";cc.find=e.exports=function(t,e){if(null==t)return cc.errorID(3814),null;if(!e){var i=cc.director.getScene();if(!i)return null;e=i}for(var n=e,i="/"!==t[0]?0:1,r=t.split("/"),s=i;s<r.length;s++){for(var a=r[s],o=n._children,n=null,l=0,h=o.length;l<h;++l){var c=o[l];if(c.name===a){n=c;break}}if(!n)return null}return n}},{}],311:[function(t,e,i){"use strict";var n=(s=t("../assets/material/material-variant"))&&s.__esModule?s:{default:s},r=t("../assets/material/CCMaterial"),s=cc.Class({properties:{_normalMaterial:null,normalMaterial:{get:function(){return this._normalMaterial},set:function(t){this._normalMaterial=t,this._updateDisabledState&&this._updateDisabledState()},type:r,tooltip:!1,animatable:!1},_grayMaterial:null,grayMaterial:{get:function(){return this._grayMaterial},set:function(t){this._grayMaterial=t,this._updateDisabledState&&this._updateDisabledState()},type:r,tooltip:!1,animatable:!1}},_switchGrayMaterial:function(t,e){var i=t?((i=this._grayMaterial)||(i=r.getBuiltinMaterial("2d-gray-sprite")),this._grayMaterial=n.default.create(i,e)):((i=this._normalMaterial)||(i=r.getBuiltinMaterial("2d-sprite",e)),this._normalMaterial=n.default.create(i,e));e.setMaterial(0,i)}});e.exports=s},{"../assets/material/CCMaterial":95,"../assets/material/material-variant":102}],312:[function(t,e,i){"use strict";function n(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"]),this._specialSymbolArray.push([/&nbsp;/g," "])}var l=/^(click)(\s)*=|(param)(\s)*=/,u=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;n.prototype={constructor:n,parse:function(t){this._resultObjectArray=[],this._stack=[];for(var e=0,i=t.length;e<i;){var n,r,s=t.indexOf(">",e),a=-1;0<=s&&(a=t.lastIndexOf("<",s))<e-1&&(a=t.indexOf("<",s+1),s=t.indexOf(">",a+1)),e=a<0?(this._stack.pop(),this._processResult(t.substring(e)),i):(n=t.substring(e,a),""===(r=t.substring(a+1,s))&&(n=t.substring(e,s+1)),this._processResult(n),-1===s?s=a:"/"===t.charAt(a+1)?this._stack.pop():this._addToStack(r),s+1)}return this._resultObjectArray},_attributeToObject:function(t){var e,i,n,r={};if(a=(t=t.trim()).match(/^(color|size)(\s)*=/)){if(e=a[0],""===(t=t.substring(e.length).trim()))return r;switch(i=t.indexOf(" "),e[0]){case"c":r.color=-1<i?t.substring(0,i).trim():t;break;case"s":r.size=parseInt(t)}return-1<i&&(n=t.substring(i+1).trim(),n=this._processEventHandler(n),r.event=n),r}if((a=t.match(/^(br(\s)*\/)/))&&0<a[0].length&&(e=a[0].trim()).startsWith("br")&&"/"===e[e.length-1])return r.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),r;if((a=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&0<a[0].length&&(e=a[0].trim()).startsWith("img")&&"/"===e[e.length-1]){for(var s,a=t.match(u),o=!1;a;){if(e=(t=t.substring(t.indexOf(a[0]))).substr(0,a[0].length),h=-1<(i=(s=t.substring(e.length).trim()).indexOf(" "))?s.substr(0,i):s,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=s.substring(i).trim(),h.endsWith("/")&&(h=h.slice(0,-1)),"src"===e){switch(h.charCodeAt(0)){case 34:case 39:o=!0,h=h.slice(1,-1)}r.isImage=!0,r.src=h}else if("height"===e)r.imageHeight=parseInt(h);else if("width"===e)r.imageWidth=parseInt(h);else if("align"===e){switch(h.charCodeAt(0)){case 34:case 39:h=h.slice(1,-1)}r.imageAlign=h.toLocaleLowerCase()}else"offset"===e?r.imageOffset=h:"click"===e&&(r.event=this._processEventHandler(e+"="+h));r.event&&"param"===e&&(r.event.param=h.replace(/^\"|\"$/g,"")),a=t.match(u)}return o&&r.isImage&&this._resultObjectArray.push({text:"",style:r}),{}}if(a=t.match(/^(outline(\s)*[^>]*)/)){var l={color:"#ffffff",width:1};if(t=a[0].substring("outline".length).trim()){var h,c=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(a=t.match(c);a;)e=(t=t.substring(t.indexOf(a[0]))).substr(0,a[0].length),h=-1<(i=(s=t.substring(e.length).trim()).indexOf(" "))?s.substr(0,i):s,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=s.substring(i).trim(),"click"===e?r.event=this._processEventHandler(e+"="+h):"color"===e?l.color=h:"width"===e&&(l.width=parseInt(h)),r.event&&"param"===e&&(r.event.param=h.replace(/^\"|\"$/g,"")),a=t.match(c)}r.outline=l}if((a=t.match(/^(on|u|b|i)(\s)*/))&&0<a[0].length){switch(e=a[0],t=t.substring(e.length).trim(),e[0]){case"u":r.underline=!0;break;case"i":r.italic=!0;break;case"b":r.bold=!0}if(""===t)return r;n=this._processEventHandler(t),r.event=n}return r},_processEventHandler:function(t){for(var e=0,i={},n=t.match(l),r=!1;n;){var s,a=n[0],o="",r=!1;'"'===(t=t.substring(a.length).trim()).charAt(0)?(-1<(e=t.indexOf('"',1))&&(o=t.substring(1,e).trim(),r=!0),e++):"'"===t.charAt(0)?(-1<(e=t.indexOf("'",1))&&(o=t.substring(1,e).trim(),r=!0),e++):e=(o=(s=t.match(/(\S)+/))?s[0]:"").length,r&&(i[a=a.substring(0,a.length-1).trim()]=o),n=(t=t.substring(e).trim()).match(l)}return i},_addToStack:function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else if(!e.isNewLine&&!e.isImage){var i,n=this._stack[this._stack.length-1];for(i in n)e[i]||(e[i]=n[i]);this._stack.push(e)}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),0<this._stack.length?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},_escapeSpecialSymbol:function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var i=this._specialSymbolArray[e][0],n=this._specialSymbolArray[e][1];t=t.replace(i,n)}return t}},e.exports=n},{}],313:[function(t,e,i){"use strict";t("./CCPath"),t("./profiler/CCProfiler"),t("./find"),t("./mutable-forward-iterator")},{"./CCPath":304,"./find":310,"./mutable-forward-iterator":316,"./profiler/CCProfiler":319}],314:[function(t,e,i){"use strict";i.__esModule=!0,i.postLoadMesh=function(i,n){i.loaded||!i.nativeUrl?n&&n():cc.loader.load(i.nativeUrl,function(t,e){e&&(i._nativeAsset=e),n&&n(t)})}},{}],315:[function(t,e,i){"use strict";for(var h=t("../platform/js"),t={propertyDefine:function(t,e,i){function n(t,e,i,n){var r=Object.getOwnPropertyDescriptor(t,e);r?(r.get&&(t[i]=r.get),r.set&&n&&(t[n]=r.set)):(r=t[i],h.getset(t,e,r,t[n]))}for(var r,s=t.prototype,a=0;a<e.length;a++){var o=(r=e[a])[0].toUpperCase()+r.slice(1);n(s,r,"get"+o,"set"+o)}for(r in i){var l=i[r];n(s,r,l[0],l[1])}},NextPOT:function(t){return--t,1+((t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)},BUILTIN_CLASSID_RE:/^(?:cc|dragonBones|sp|ccsg)\..+/},n=new Array(123),r=0;r<123;++r)n[r]=64;for(var s=0;s<64;++s)n["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(s)]=s;t.BASE64_VALUES=n,t.pushToMap=function(t,e,i,n){var r=t[e];r?Array.isArray(r)?n?(r.push(r[0]),r[0]=i):r.push(i):t[e]=n?[i,r]:[r,i]:t[e]=i},t.clampf=function(t,e,i){var n;return i<e&&(n=e,e=i,i=n),t<e?e:t<i?t:i},t.clamp01=function(t){return t<0?0:t<1?t:1},t.lerp=function(t,e,i){return t+(e-t)*i},t.degreesToRadians=function(t){return t*cc.macro.RAD},t.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.misc=e.exports=t},{"../platform/js":250}],316:[function(t,e,i){"use strict";function n(t){this.i=0,this.array=t}var r=n.prototype;r.remove=function(t){t=this.array.indexOf(t);0<=t&&this.removeAt(t)},r.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},r.fastRemove=function(t){t=this.array.indexOf(t);0<=t&&this.fastRemoveAt(t)},r.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},r.push=function(t){this.array.push(t)},e.exports=n},{}],317:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;(n=r.prototype).get=function(){},n.put=function(){},n.clear=function(){};var n=r;function r(){this.enabled=!1,this.count=0,this.maxSize=1024}i.default=n,cc.pool={},n.register=function(t,e){cc.pool[t]=e},e.exports=i.default},{}],318:[function(t,e,i){"use strict";cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),e.exports={syncWithPrefab:function(t){var e=t._prefab;if(e._synced=!0,!e.asset)return cc.errorID(3701,t.name),void(t._prefab=null);var i=t._objFlags,n=t._parent,r=t._id,s=t._name,a=t._active,o=t._eulerAngles.x,l=t._eulerAngles.y,h=t._eulerAngles.z,c=t._localZOrder,u=t._globalZOrder,_=t._trs,d=_[0],f=_[1],p=_[2];cc.game._isCloning=!0,e.asset._doInstantiate(t),cc.game._isCloning=!1,t._objFlags=i,t._parent=n,t._id=r,t._prefab=e,t._name=s,t._active=a,t._localZOrder=c,t._globalZOrder=u,(_=t._trs)[0]=d,_[1]=f,_[2]=p,t._eulerAngles.x=o,t._eulerAngles.y=l,t._eulerAngles.z=h}}},{}],319:[function(t,e,i){"use strict";var n=t("../../platform/CCMacro"),r=t("./perf-counter"),s=!1,a=15,o=null,l=null,h=null;function c(){l&&l.isValid||((l=new cc.Node("PROFILER-NODE")).x=l.y=10,l.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG,cc.Camera._setupDebugCamera(),l.zIndex=n.MAX_ZINDEX,cc.game.addPersistRootNode(l),(i=new cc.Node("LEFT-PANEL")).anchorX=i.anchorY=0,(t=i.addComponent(cc.Label)).fontSize=a,t.lineHeight=a,i.parent=l,(i=new cc.Node("RIGHT-PANEL")).anchorX=1,i.anchorY=0,i.x=200,(e=i.addComponent(cc.Label)).horizontalAlign=cc.Label.HorizontalAlign.RIGHT,e.fontSize=a,e.lineHeight=a,i.parent=l,cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_GAME_SUB&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&(t.cacheMode=cc.Label.CacheMode.CHAR,e.cacheMode=cc.Label.CacheMode.CHAR),h={left:t,right:e});var t,e,i=cc.director._lastUpdate;o.frame._counter.start(i),o.logic._counter.start(i)}function u(){var t=performance.now();cc.director.isPaused()?o.frame._counter.start(t):o.logic._counter.end(t),o.render._counter.start(t)}function _(){var t,e=performance.now(),i=(o.render._counter.end(e),o.draws._counter.value=cc.renderer.drawCalls,o.frame._counter.end(e),o.fps._counter.frame(e),""),n="";for(t in o){var r=o[t];r._counter.sample(e),i+=r.desc+"\n",n+=r._counter.human()+"\n"}h&&(h.left.string=i,h.right.string=n)}cc.profiler=e.exports={isShowingStats:function(){return s},hideStats:function(){s&&(l&&(l.active=!1),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,c),cc.director.off(cc.Director.EVENT_AFTER_UPDATE,u),cc.director.off(cc.Director.EVENT_AFTER_DRAW,_),s=!1)},showStats:function(){if(!s){if(!o){o={frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}};var t,e=performance.now();for(t in o)o[t]._counter=new r(t,o[t],e)}l&&(l.active=!0),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,c),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,u),cc.director.on(cc.Director.EVENT_AFTER_DRAW,_),s=!0}}}},{"../../platform/CCMacro":235,"./perf-counter":321}],320:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Counter",ctor:function(t,e,i){this._id=t,this._opts=e||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=i},properties:{value:{get:function(){return this._value},set:function(t){this._value=t}}},_average:function(t,e){this._opts.average&&(this._accumValue+=t,++this._accumSamples,(t=e)-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=t,this._accumSamples=0))},sample:function(t){this._average(this._value,t)},human:function(){var t=this._opts.average?this._averageValue:this._value;return Math.round(100*t)/100},alarm:function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}});e.exports=n},{}],321:[function(t,e,i){"use strict";t=t("./counter"),t=cc.Class({name:"cc.PerfCounter",extends:t,ctor:function(t,e,i){this._time=i},start:function(t){this._time=t},end:function(t){this._value=t-this._time,this._average(this._value)},tick:function(){this.end(),this.start()},frame:function(t){var e=t-this._time;this._total++,e>(this._opts.average||1e3)&&(this._value=1e3*this._total/e,this._total=0,this._time=t,this._average(this._value))}});e.exports=t},{"./counter":320}],322:[function(t,e,i){"use strict";var n=new((t=t("../platform/js"))&&t.__esModule?t:{default:t}).default.Pool(2);function r(t){this.count=0,this.limit=t,this.datas={},this.head=null,this.tail=null}n.get=function(){return this._get()||{key:null,value:null,prev:null,next:null}},r.prototype.moveToHead=function(t){t.next=this.head,(t.prev=null)!==this.head&&(this.head.prev=t),this.head=t,null===this.tail&&(this.tail=t),this.count++,this.datas[t.key]=t},r.prototype.put=function(t,e){var i=n.get();i.key=t,i.value=e,this.count>=this.limit&&(t=this.tail,delete this.datas[t.key],this.count--,this.tail=t.prev,this.tail.next=null,t.prev=null,t.next=null,n.put(t)),this.moveToHead(i)},r.prototype.remove=function(t){null!==t.prev?t.prev.next=t.next:this.head=t.next,null!==t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},r.prototype.get=function(t){t=this.datas[t];return t?(this.remove(t),this.moveToHead(t),t.value):null},r.prototype.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},r.prototype.has=function(t){return!!this.datas[t]},r.prototype.delete=function(t){t=this.datas[t];this.remove(t)};var s=new r(100);cc.textUtils=e.exports={BASELINE_RATIO:.26,MIDDLE_RATIO:.37,BASELINE_OFFSET:0,label_wordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430-\u044f\u0410-\u042f\u0401\u0451]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/,label_lastWordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+$/,label_firstEnglish:/^[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]/,highSurrogateRex:/[\uD800-\uDBFF]/,lowSurrogateRex:/[\uDC00-\uDFFF]/,label_wrapinspection:!0,__CHINESE_REG:/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,__JAPANESE_REG:/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,__KOREAN_REG:/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,isUnicodeCJK:function(t){return this.__CHINESE_REG.test(t)||this.__JAPANESE_REG.test(t)||this.__KOREAN_REG.test(t)},isUnicodeSpace:function(t){return 9<=(t=t.charCodeAt(0))&&t<=13||32===t||133===t||160===t||5760===t||8192<=t&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},safeMeasureText:function(t,e,i){var i=(i||t.font)+""+e,n=s.get(i);if(null!==n)return n;n=t.measureText(e),t=n&&n.width||0;return s.put(i,t),t},_safeSubstring:function(t,e,i){var n=e,r=i,s=t[e];return this.lowSurrogateRex.test(s)&&n--,void 0!==i&&(i-1!==e?(e=t[i-1],this.highSurrogateRex.test(e)&&r--):this.highSurrogateRex.test(s)&&r++),t.substring(n,r)},fragmentText:function(t,e,i,n){var r=[];if(0===t.length||i<0)return r.push(""),r;for(var s=t;i<e&&1<s.length;){for(var a,o=s.length*(i/e)|0,l=this._safeSubstring(s,o),h=e-n(l),c=l,u=0,_=0;i<h&&_++<10;)h=e-n(l=this._safeSubstring(s,o=o*(i/h)|0));for(_=0;h<=i&&_++<10;)l&&(u=(a=this.label_wordRex.exec(l))?a[0].length:1,c=l),o+=u,h=e-n(l=this._safeSubstring(s,o));0==(o-=u)?c=this._safeSubstring(s,o=1):1===o&&this.highSurrogateRex.test(s[0])&&(c=this._safeSubstring(s,o=2));var d,f=this._safeSubstring(s,0,o);this.label_wrapinspection&&this.label_symbolRex.test(c||l)&&(0==(o-=(d=this.label_lastWordRex.exec(f))?d[0].length:0)&&(o=1),c=this._safeSubstring(s,o),f=this._safeSubstring(s,0,o)),this.label_firstEnglish.test(c)&&(d=this.label_lastEnglish.exec(f))&&f!==d[0]&&(o-=d[0].length,c=this._safeSubstring(s,o),f=this._safeSubstring(s,0,o)),(0===r.length||0<(f=f.trimLeft()).length)&&r.push(f),e=n(s=c||l)}return(0===r.length||0<(s=s.trimLeft()).length)&&r.push(s),r}}},{"../platform/js":250}],323:[function(t,e,i){"use strict";var r=t("../assets/CCTexture2D");cc.textureUtil=e.exports={loadImage:function(t,i,n){cc.assertID(t,3103);var e=cc.loader.getRes(t);return e?e.loaded?i&&i.call(n,null,e):e.once("load",function(){i&&i.call(n,null,e)},n):((e=new r).url=t,cc.loader.load({url:t,texture:e},function(t,e){if(t)return i&&i.call(n,t||new Error("Unknown error"));e.handleLoadedTexture(),i&&i.call(n,null,e)})),e},cacheImage:function(t,e){var i;if(t&&e)return(i=new r).initWithElement(e),cc.loader.flowOut({id:t,url:t,error:null,content:i,complete:!1}),i},postLoadTexture:function(i,n){!i.loaded&&i.url?cc.loader.load({url:i.url,skips:i._isCompressed()?void 0:["Loader"]},function(t,e){e&&!i.loaded&&(i._nativeAsset=e),n&&n(t)}):n&&n()}}},{"../assets/CCTexture2D":92}],324:[function(t,e,i){"use strict";var n=t("./node-unit"),t=t("./node-mem-pool");e.exports={NodeMemPool:new t(n)}},{"./node-mem-pool":326,"./node-unit":327}],325:[function(t,e,i){"use strict";function n(t){this._unitClass=t,this._pool=[],this._findOrder=[]}var r=n.prototype;r._initNative=function(){this._nativeMemPool=new renderer.MemPool},r._buildUnit=function(t){return new this._unitClass(t,this)},r._destroyUnit=function(t){this._pool[t]=null;for(var e=0,i=this._findOrder.length;e<i;e++){var n=this._findOrder[e];if(n&&n.unitID==t){this._findOrder.splice(e,1);break}}},r._findUnitID=function(){for(var t=0,e=this._pool;e[t];)t++;return t},r.pop=function(){for(var t,e=null,i=0,n=this._findOrder,r=this._pool,s=n.length;i<s;i++){var a=n[i];if(a&&a.hasSpace()){e=a;break}}e||(t=this._findUnitID(),e=this._buildUnit(t),r[t]=e,n.push(e),i=n.length-1);r=n[0];return r!==e&&(n[0]=e,n[i]=r),e.pop()},r.push=function(t){var e=this._pool[t.unitID];return e.push(t.index),1<this._findOrder.length&&e.isAllFree()&&this._destroyUnit(t.unitID),e},e.exports=n},{}],326:[function(t,e,i){"use strict";function n(t){r.call(this,t)}var r=t("./mem-pool");function s(){}s.prototype=r.prototype;t=n.prototype=new s;t._initNative=function(){this._nativeMemPool=new renderer.NodeMemPool},t._destroyUnit=function(t){r.prototype._destroyUnit.call(this,t)},e.exports=n},{"./mem-pool":325}],327:[function(t,e,i){"use strict";function n(t,e){h.call(this,t,e);var i=this._contentNum;this.trsList=new s.FLOAT_ARRAY_TYPE(10*i),this.localMatList=new s.FLOAT_ARRAY_TYPE(16*i),this.worldMatList=new s.FLOAT_ARRAY_TYPE(16*i);for(var n=0;n<i;n++){var r=this._spacesData[n];r.trs=new s.FLOAT_ARRAY_TYPE(this.trsList.buffer,n*a,10),r.localMat=new s.FLOAT_ARRAY_TYPE(this.localMatList.buffer,n*o,16),r.worldMat=new s.FLOAT_ARRAY_TYPE(this.worldMatList.buffer,n*l,16)}}var s=t("../../value-types/utils"),a=(Uint32Array,10*s.FLOAT_BYTES),o=16*s.FLOAT_BYTES,l=16*s.FLOAT_BYTES,h=(Uint32Array,Uint32Array,Int32Array,Uint8Array,Uint8Array,Uint32Array,s.FLOAT_BYTES,t("./unit-base"));function r(){}r.prototype=h.prototype,n.prototype=new r,e.exports=n},{"../../value-types/utils":337,"./unit-base":328}],328:[function(t,e,i){"use strict";function n(t,e,i){i=i||128,this.unitID=t,this._memPool=e,this._data=new Uint16Array(2),this._data[0]=0,this._data[1]=0,this._contentNum=i,this._signData=new Uint16Array(2*this._contentNum),this._spacesData=[];for(var n=0;n<i;n++){var r=2*n;this._signData[0+r]=n+1,this._signData[1+r]=0,this._spacesData[n]={index:n,unitID:t}}this._signData[2*(i-1)]=65535}var r=n.prototype;r.hasSpace=function(){return 65535!==this._data[0]},r.isAllFree=function(){return 0==this._data[1]},r.pop=function(){var t=this._data[0];if(65535===t)return null;var e=2*t,t=this._spacesData[t];return this._signData[1+e]=1,this._data[0]=this._signData[0+e],this._data[1]++,t},r.push=function(t){var e=2*t;this._signData[1+e]=0,this._signData[0+e]=this._data[0],this._data[0]=t,this._data[1]--},r.dump=function(){for(var t=0,e=this._data[0],i="";65535!=e;)t++,i+=e+"->",e=this._signData[2*e+0];for(var n=0,r="",s=this._contentNum,a=0;a<s;a++)1==this._signData[2*a+1]&&(n++,r+=a+"->");var o=t+n;console.log("unitID:",this.unitID,"spaceNum:",t,"calc using num:",n,"store using num:",this._data[1],"calc total num:",o,"actually total num:",this._contentNum),console.log("free info:",i),console.log("using info:",r),n!=this._data[1]&&cc.error("using num error","calc using num:",n,"store using num:",this._data[1]),t+n!=this._contentNum&&cc.error("total num error","calc total num:",o,"actually total num:",this._contentNum)},e.exports=n},{}],329:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=a(t("./value-type")),r=a(t("../platform/CCClass")),s=a(t("../utils/misc"));function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,i){e&&o(t.prototype,e),i&&o(t,i)}h=n.default,t=h,(n=u).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,u.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},u.clone=function(t){return new u(t.r,t.g,t.b,t.a)},u.set=function(t,e,i,n,r){return void 0===i&&(i=255),void 0===n&&(n=255),void 0===r&&(r=255),t.r=e=void 0===e?255:e,t.g=i,t.b=n,t.a=r,t},u.fromHex=function(t,e){var i=(e>>16&255)/255,n=(e>>8&255)/255,r=(255&e)/255;return t.r=(e>>24)/255,t.g=i,t.b=n,t.a=r,t},u.add=function(t,e,i){return t.r=e.r+i.r,t.g=e.g+i.g,t.b=e.b+i.b,t.a=e.a+i.a,t},u.subtract=function(t,e,i){return t.r=e.r-i.r,t.g=e.g-i.g,t.b=e.b-i.b,t.a=e.a-i.a,t},u.multiply=function(t,e,i){return t.r=e.r*i.r,t.g=e.g*i.g,t.b=e.b*i.b,t.a=e.a*i.a,t},u.divide=function(t,e,i){return t.r=e.r/i.r,t.g=e.g/i.g,t.b=e.b/i.b,t.a=e.a/i.a,t},u.scale=function(t,e,i){return t.r=e.r*i,t.g=e.g*i,t.b=e.b*i,t.a=e.a*i,t},u.lerp=function(t,e,i,n){var r=e.r,s=e.g,a=e.b,e=e.a;return t.r=r+n*(i.r-r),t.g=s+n*(i.g-s),t.b=a+n*(i.b-a),t.a=e+n*(i.a-e),t},u.toArray=function(t,e,i){var n=e instanceof u||1<e.a?1/255:1;return t[(i=void 0===i?0:i)+0]=e.r*n,t[i+1]=e.g*n,t[i+2]=e.b*n,t[i+3]=e.a*n,t},u.fromArray=function(t,e,i){return e.r=255*t[(i=void 0===i?0:i)+0],e.g=255*t[i+1],e.b=255*t[i+2],e.a=255*t[i+3],e},l(u,null,[{key:"WHITE",get:function(){return new u(255,255,255,255)}},{key:"BLACK",get:function(){return new u(0,0,0,255)}},{key:"TRANSPARENT",get:function(){return new u(0,0,0,0)}},{key:"GRAY",get:function(){return new u(127.5,127.5,127.5)}},{key:"RED",get:function(){return new u(255,0,0)}},{key:"GREEN",get:function(){return new u(0,255,0)}},{key:"BLUE",get:function(){return new u(0,0,255)}},{key:"YELLOW",get:function(){return new u(255,235,4)}},{key:"ORANGE",get:function(){return new u(255,127,0)}},{key:"CYAN",get:function(){return new u(0,255,255)}},{key:"MAGENTA",get:function(){return new u(255,0,255)}}]),(n=u.prototype).clone=function(){var t=new u;return t._val=this._val,t},n.equals=function(t){return t&&this._val===t._val},n.lerp=function(t,e,i){i=i||new u;var n=this.r,r=this.g,s=this.b,a=this.a;return i.r=n+(t.r-n)*e,i.g=r+(t.g-r)*e,i.b=s+(t.b-s)*e,i.a=a+(t.a-a)*e,i},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.getR=function(){return 255&this._val},n.setR=function(t){return t=~~s.default.clampf(t,0,255),this._val=(4294967040&this._val|t)>>>0,this},n.getG=function(){return(65280&this._val)>>8},n.setG=function(t){return t=~~s.default.clampf(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0,this},n.getB=function(){return(16711680&this._val)>>16},n.setB=function(t){return t=~~s.default.clampf(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0,this},n.getA=function(){return(4278190080&this._val)>>>24},n.setA=function(t){return t=~~s.default.clampf(t,0,255),this._val=(16777215&this._val|t<<24)>>>0,this},n.toCSS=function(t){return t&&"rgba"!==t?"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t):"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")"},n.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,i=parseInt(t.substr(2,2),16)||0,n=parseInt(t.substr(4,2),16)||0,t=parseInt(t.substr(6,2),16)||255;return this._val=(t<<24>>>0)+(n<<16)+(i<<8)+e,this},n.toHEX=function(t){var e=[(this.r<16?"0":"")+(0|this.r).toString(16),(this.g<16?"0":"")+(0|this.g).toString(16),(this.b<16?"0":"")+(0|this.b).toString(16)],i=-1;if("#rgb"===t)for(i=0;i<e.length;++i)1<e[i].length&&(e[i]=e[i][0]);else if("#rrggbb"===t)for(i=0;i<e.length;++i)1===e[i].length&&(e[i]="0"+e[i]);else"#rrggbbaa"===t&&e.push((this.a<16?"0":"")+(0|this.a).toString(16));return e.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(t,e,i){var n,r,s;if(0===e)n=r=s=i;else if(0===i)n=r=s=0;else{1===t&&(t=0),t*=6;var a=Math.floor(t),t=t-a,o=i*(1-e),l=i*(1-e*t),h=i*(1-e*(1-t));switch(a){case 0:n=i,r=h,s=o;break;case 1:n=l,r=i,s=o;break;case 2:n=o,r=i,s=h;break;case 3:n=o,r=l,s=i;break;case 4:n=h,r=o,s=i;break;case 5:n=i,r=o,s=l}}return this._val=(this.a<<24>>>0)+((s*=255)<<16)+((r*=255)<<8)+(n*=255),this},n.toHSV=function(){var t=this.r/255,e=this.g/255,i=this.b/255,n={h:0,s:0,v:0},r=Math.max(t,e,i),s=Math.min(t,e,i);return n.v=r,n.s=r?(r-s)/r:0,n.s?(s=r-s,n.h=t===r?(e-i)/s:e===r?2+(i-t)/s:4+(t-e)/s,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},n.set=function(t){return t._val?this._val=t._val:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a),this},n._fastSetA=function(t){this._val=(16777215&this._val|t<<24)>>>0},n.multiply=function(t){var e=(255&this._val)*t.r>>8,i=(65280&this._val)*t.g>>8,n=(16711680&this._val)*t.b>>8,t=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&t|16711680&n|65280&i|255&e,this},l(u,[{key:"r",get:function(){return this.getR()},set:function(t){this.setR(t)}},{key:"g",get:function(){return this.getG()},set:function(t){this.setG(t)}},{key:"b",get:function(){return this.getB()},set:function(t){this.setB(t)}},{key:"a",get:function(){return this.getA()},set:function(t){this.setA(t)}}]);var h,c=u;function u(t,e,i,n){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=255),(r=h.call(this)||this)._val=0,"object"==typeof t&&(e=t.g,i=t.b,n=t.a,t=t.r),r._val=(n<<24>>>0)+(i<<16)+(e<<8)+t,r}(i.default=c).div=c.divide,c.sub=c.subtract,c.mul=c.multiply,c.WHITE_R=c.WHITE,c.BLACK_R=c.BLACK,c.TRANSPARENT_R=c.TRANSPARENT,c.GRAY_R=c.GRAY,c.RED_R=c.RED,c.GREEN_R=c.GREEN,c.BLUE_R=c.BLUE,c.YELLOW_R=c.YELLOW,c.ORANGE_R=c.ORANGE,c.CYAN_R=c.CYAN,c.MAGENTA_R=c.MAGENTA,r.default.fastDefine("cc.Color",c,{r:0,g:0,b:0,a:255}),cc.Color=c,cc.color=function(t,e,i,n){return"string"==typeof t?(new c).fromHEX(t):"object"==typeof t?new c(t.r,t.g,t.b,t.a):new c(t,e,i,n)},e.exports=i.default},{"../platform/CCClass":230,"../utils/misc":315,"./value-type":338}],330:[function(t,e,i){"use strict";var n={Vec2:i.__esModule=!0,Vec3:!0,Vec4:!0,Mat4:!0,Mat3:!0,Rect:!0,Size:!0,Color:!0,Quat:!0,Trs:!0},r=(i.Trs=i.Quat=i.Color=i.Size=i.Rect=i.Mat3=i.Mat4=i.Vec4=i.Vec3=i.Vec2=void 0,a(t("./vec2"))),r=(i.Vec2=r.default,a(t("./vec3"))),r=(i.Vec3=r.default,a(t("./vec4"))),r=(i.Vec4=r.default,a(t("./mat4"))),r=(i.Mat4=r.default,a(t("./mat3"))),r=(i.Mat3=r.default,a(t("./rect"))),r=(i.Rect=r.default,a(t("./size"))),r=(i.Size=r.default,a(t("./color"))),r=(i.Color=r.default,a(t("./quat"))),r=(i.Quat=r.default,a(t("./trs"))),s=(i.Trs=r.default,t("./utils"));function a(t){return t&&t.__esModule?t:{default:t}}Object.keys(s).forEach(function(t){"default"===t||"__esModule"===t||Object.prototype.hasOwnProperty.call(n,t)||(i[t]=s[t])}),cc.math=e.exports},{"./color":329,"./mat3":331,"./mat4":332,"./quat":333,"./rect":334,"./size":335,"./trs":336,"./utils":337,"./vec2":339,"./vec3":340,"./vec4":341}],331:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var g=t("../value-types/utils"),a=(t=t("./vec3"))&&t.__esModule?t:{default:t},t=(h.create=function(t,e,i,n,r,s,a,o,l){return new h(t=void 0===t?1:t,e=void 0===e?0:e,i=void 0===i?0:i,n=void 0===n?0:n,r=void 0===r?1:r,s=void 0===s?0:s,a=void 0===a?0:a,o=void 0===o?0:o,l=void 0===l?1:l)},h.clone=function(t){t=t.m;return new h(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},h.copy=function(t,e){return t.m.set(e.m),t},h.set=function(t,e,i,n,r,s,a,o,l,h){var c=t.m;return c[0]=e,c[1]=i,c[2]=n,c[3]=r,c[4]=s,c[5]=a,c[6]=o,c[7]=l,c[8]=h,t},h.identity=function(t){var e=t.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,t},h.transpose=function(t,e){var i,n,r=e.m,s=t.m;return t===e?(e=r[1],i=r[2],n=r[5],s[1]=r[3],s[2]=r[6],s[3]=e,s[5]=r[7],s[6]=i,s[7]=n):(s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8]),t},h.invert=function(t,e){var e=e.m,i=t.m,n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=e[7],e=e[8],u=e*o-l*c,_=-e*a+l*h,d=c*a-o*h,f=n*u+r*_+s*d;return f&&(i[0]=u*(f=1/f),i[1]=(-e*r+s*c)*f,i[2]=(l*r-s*o)*f,i[3]=_*f,i[4]=(e*n-s*h)*f,i[5]=(-l*n+s*a)*f,i[6]=d*f,i[7]=(-c*n+r*h)*f,i[8]=(o*n-r*a)*f),t},h.adjoint=function(t,e){var e=e.m,i=t.m,n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=e[7],e=e[8];return i[0]=o*e-l*c,i[1]=s*c-r*e,i[2]=r*l-s*o,i[3]=l*h-a*e,i[4]=n*e-s*h,i[5]=s*a-n*l,i[6]=a*c-o*h,i[7]=r*h-n*c,i[8]=n*o-r*a,t},h.determinant=function(t){var t=t.m,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],t=t[8];return e*(t*s-a*l)+i*(-t*r+a*o)+n*(l*r-s*o)},h.multiply=function(t,e,i){var e=e.m,i=i.m,n=t.m,r=e[0],s=e[1],a=e[2],o=e[3],l=e[4],h=e[5],c=e[6],u=e[7],e=e[8],_=i[0],d=i[1],f=i[2],p=i[3],m=i[4],y=i[5],g=i[6],v=i[7],i=i[8];return n[0]=_*r+d*o+f*c,n[1]=_*s+d*l+f*u,n[2]=_*a+d*h+f*e,n[3]=p*r+m*o+y*c,n[4]=p*s+m*l+y*u,n[5]=p*a+m*h+y*e,n[6]=g*r+v*o+i*c,n[7]=g*s+v*l+i*u,n[8]=g*a+v*h+i*e,t},h.multiplyMat4=function(t,e,i){var e=e.m,i=i.m,n=t.m,r=e[0],s=e[1],a=e[2],o=e[3],l=e[4],h=e[5],c=e[6],u=e[7],e=e[8],_=i[0],d=i[1],f=i[2],p=i[4],m=i[5],y=i[6],g=i[8],v=i[9],i=i[10];return n[0]=_*r+d*o+f*c,n[1]=_*s+d*l+f*u,n[2]=_*a+d*h+f*e,n[3]=p*r+m*o+y*c,n[4]=p*s+m*l+y*u,n[5]=p*a+m*h+y*e,n[6]=g*r+v*o+i*c,n[7]=g*s+v*l+i*u,n[8]=g*a+v*h+i*e,t},h.translate=function(t,e,i){var e=e.m,n=t.m,r=e[0],s=e[1],a=e[2],o=e[3],l=e[4],h=e[5],c=e[6],u=e[7],e=e[8],_=i.x,i=i.y;return n[0]=r,n[1]=s,n[2]=a,n[3]=o,n[4]=l,n[5]=h,n[6]=_*r+i*o+c,n[7]=_*s+i*l+u,n[8]=_*a+i*h+e,t},h.rotate=function(t,e,i){var e=e.m,n=t.m,r=e[0],s=e[1],a=e[2],o=e[3],l=e[4],h=e[5],c=e[6],u=e[7],e=e[8],_=Math.sin(i),i=Math.cos(i);return n[0]=i*r+_*o,n[1]=i*s+_*l,n[2]=i*a+_*h,n[3]=i*o-_*r,n[4]=i*l-_*s,n[5]=i*h-_*a,n[6]=c,n[7]=u,n[8]=e,t},h.scale=function(t,e,i){var n=i.x,i=i.y,e=e.m,r=t.m;return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],t},h.fromMat4=function(t,e){var e=e.m,i=t.m;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t},h.fromTranslation=function(t,e){var i=t.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=e.x,i[7]=e.y,i[8]=1,t},h.fromRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e),n=t.m;return n[0]=e,n[1]=i,n[2]=0,n[3]=-i,n[4]=e,n[5]=0,n[6]=0,n[7]=0,n[8]=1,t},h.fromScaling=function(t,e){var i=t.m;return i[0]=e.x,i[1]=0,i[2]=0,i[3]=0,i[4]=e.y,i[5]=0,i[6]=0,i[7]=0,i[8]=1,t},h.fromQuat=function(t,e){var i=t.m,n=e.x,r=e.y,s=e.z,e=e.w,a=n+n,o=r+r,l=s+s,n=n*a,h=r*a,r=r*o,c=s*a,u=s*o,s=s*l,a=e*a,o=e*o,e=e*l;return i[0]=1-r-s,i[3]=h-e,i[6]=c+o,i[1]=h+e,i[4]=1-n-s,i[7]=u-a,i[2]=c-o,i[5]=u+a,i[8]=1-n-r,t},h.fromViewUp=function(t,e,i){n=new a.default(0,1,0),r=new a.default,s=new a.default;var n,r,s;return a.default.lengthSqr(e)<g.EPSILON*g.EPSILON?h.identity(t):(a.default.normalize(r,a.default.cross(r,i=i||n,e)),a.default.lengthSqr(r)<g.EPSILON*g.EPSILON?h.identity(t):(a.default.cross(s,e,r),h.set(t,r.x,r.y,r.z,s.x,s.y,s.z,e.x,e.y,e.z))),t},h.normalFromMat4=function(t,e){var e=e.m,i=t.m,n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=e[7],u=e[8],_=e[9],d=e[10],f=e[11],p=e[12],m=e[13],y=e[14],e=e[15],g=n*l-r*o,v=n*h-s*o,b=n*c-a*o,x=r*h-s*l,A=r*c-a*l,C=s*c-a*h,T=u*m-_*p,S=u*y-d*p,u=u*e-f*p,w=_*y-d*m,_=_*e-f*m,d=d*e-f*y,f=g*d-v*_+b*w+x*u-A*S+C*T;return f&&(i[0]=(l*d-h*_+c*w)*(f=1/f),i[1]=(h*u-o*d-c*S)*f,i[2]=(o*_-l*u+c*T)*f,i[3]=(s*_-r*d-a*w)*f,i[4]=(n*d-s*u+a*S)*f,i[5]=(r*u-n*_-a*T)*f,i[6]=(m*C-y*A+e*x)*f,i[7]=(y*b-p*C-e*v)*f,i[8]=(p*A-m*b+e*g)*f),t},h.frob=function(t){t=t.m;return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},h.add=function(t,e,i){var e=e.m,i=i.m,n=t.m;return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n[3]=e[3]+i[3],n[4]=e[4]+i[4],n[5]=e[5]+i[5],n[6]=e[6]+i[6],n[7]=e[7]+i[7],n[8]=e[8]+i[8],t},h.subtract=function(t,e,i){var e=e.m,i=i.m,n=t.m;return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n[3]=e[3]-i[3],n[4]=e[4]-i[4],n[5]=e[5]-i[5],n[6]=e[6]-i[6],n[7]=e[7]-i[7],n[8]=e[8]-i[8],t},h.multiplyScalar=function(t,e,i){var e=e.m,n=t.m;return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*i,t},h.multiplyScalarAndAdd=function(t,e,i,n){var e=e.m,i=i.m,r=t.m;return r[0]=e[0]+i[0]*n,r[1]=e[1]+i[1]*n,r[2]=e[2]+i[2]*n,r[3]=e[3]+i[3]*n,r[4]=e[4]+i[4]*n,r[5]=e[5]+i[5]*n,r[6]=e[6]+i[6]*n,r[7]=e[7]+i[7]*n,r[8]=e[8]+i[8]*n,t},h.exactEquals=function(t,e){t=t.m,e=e.m;return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},h.equals=function(t,e){var t=t.m,e=e.m,i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],t=t[8],c=e[0],u=e[1],_=e[2],d=e[3],f=e[4],p=e[5],m=e[6],y=e[7],e=e[8];return Math.abs(i-c)<=g.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=g.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-_)<=g.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(s-d)<=g.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-f)<=g.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-p)<=g.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-m)<=g.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-y)<=g.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(t-e)<=g.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},h.toArray=function(t,e,i){void 0===i&&(i=0);for(var n=e.m,r=0;r<9;r++)t[i+r]=n[r];return t},h.fromArray=function(t,e,i){void 0===i&&(i=0);for(var n=t.m,r=0;r<9;r++)n[r]=e[i+r];return t},h.prototype.toString=function(){var t=this.m;return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},h);function h(t,e,i,n,r,s,a,o,l){var h;void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===l&&(l=1),this.m=void 0,t instanceof g.FLOAT_ARRAY_TYPE?this.m=t:(this.m=new g.FLOAT_ARRAY_TYPE(9),(h=this.m)[0]=t,h[1]=e,h[2]=i,h[3]=n,h[4]=r,h[5]=s,h[6]=a,h[7]=o,h[8]=l)}(i.default=t).sub=t.subtract,t.mul=t.multiply,t.IDENTITY=Object.freeze(new t),cc.Mat3=t,e.exports=i.default},{"../value-types/utils":337,"./vec3":340}],332:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=o(t("./value-type")),r=o(t("../platform/CCClass")),s=o(t("./vec3")),a=o(t("./quat")),g=t("./utils"),u=o(t("./mat3"));function o(t){return t&&t.__esModule?t:{default:t}}var v,m=0,y=0,b=0,x=0,A=0,C=0,T=0,S=0,w=0,E=0,M=0,D=0,p=0,B=0,I=0,P=0,R=(v=n.default,t=v,(n=l).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=l.prototype).mul=function(t,e){return l.multiply(e||new l,this,t)},n.mulScalar=function(t,e){l.multiplyScalar(e||new l,this,t)},n.sub=function(t,e){l.subtract(e||new l,this,t)},l.clone=function(t){t=t.m;return new l(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},l.copy=function(t,e){var i=t.m,e=e.m;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],t},l.set=function(t,e,i,n,r,s,a,o,l,h,c,u,_,d,f,p,m){var y=t.m;return y[0]=e,y[1]=i,y[2]=n,y[3]=r,y[4]=s,y[5]=a,y[6]=o,y[7]=l,y[8]=h,y[9]=c,y[10]=u,y[11]=_,y[12]=d,y[13]=f,y[14]=p,y[15]=m,t},l.identity=function(t){var e=t.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t},l.transpose=function(t,e){var i,n,r,s,a,o=t.m,l=e.m;return t===e?(e=l[1],i=l[2],n=l[3],r=l[6],s=l[7],a=l[11],o[1]=l[4],o[2]=l[8],o[3]=l[12],o[4]=e,o[6]=l[9],o[7]=l[13],o[8]=i,o[9]=r,o[11]=l[14],o[12]=n,o[13]=s,o[14]=a):(o[0]=l[0],o[1]=l[4],o[2]=l[8],o[3]=l[12],o[4]=l[1],o[5]=l[5],o[6]=l[9],o[7]=l[13],o[8]=l[2],o[9]=l[6],o[10]=l[10],o[11]=l[14],o[12]=l[3],o[13]=l[7],o[14]=l[11],o[15]=l[15]),t},l.invert=function(t,e){var e=e.m,e=(m=e[0],y=e[1],b=e[2],x=e[3],A=e[4],C=e[5],T=e[6],S=e[7],w=e[8],E=e[9],M=e[10],D=e[11],p=e[12],B=e[13],I=e[14],P=e[15],m*C-y*A),i=m*T-b*A,n=m*S-x*A,r=y*T-b*C,s=y*S-x*C,a=b*S-x*T,o=w*B-E*p,l=w*I-M*p,h=w*P-D*p,c=E*I-M*B,u=E*P-D*B,_=M*P-D*I,d=e*_-i*u+n*c+r*h-s*l+a*o;if(0==d)return null;var f=t.m;return f[0]=(C*_-T*u+S*c)*(d=1/d),f[1]=(b*u-y*_-x*c)*d,f[2]=(B*a-I*s+P*r)*d,f[3]=(M*s-E*a-D*r)*d,f[4]=(T*h-A*_-S*l)*d,f[5]=(m*_-b*h+x*l)*d,f[6]=(I*n-p*a-P*i)*d,f[7]=(w*a-M*n+D*i)*d,f[8]=(A*u-C*h+S*o)*d,f[9]=(y*h-m*u-x*o)*d,f[10]=(p*s-B*n+P*e)*d,f[11]=(E*n-w*s-D*e)*d,f[12]=(C*l-A*c-T*o)*d,f[13]=(m*c-y*l+b*o)*d,f[14]=(B*i-p*r-I*e)*d,f[15]=(w*r-E*i+M*e)*d,t},l.determinant=function(t){t=t.m;return m=t[0],y=t[1],b=t[2],x=t[3],A=t[4],C=t[5],T=t[6],S=t[7],w=t[8],E=t[9],M=t[10],D=t[11],p=t[12],B=t[13],I=t[14],P=t[15],(m*C-y*A)*(M*P-D*I)-(m*T-b*A)*(E*P-D*B)+(m*S-x*A)*(E*I-M*B)+(y*T-b*C)*(w*P-D*p)-(y*S-x*C)*(w*I-M*p)+(b*S-x*T)*(w*B-E*p)},l.multiply=function(t,e,i){var n=t.m,e=e.m,i=i.m,e=(m=e[0],y=e[1],b=e[2],x=e[3],A=e[4],C=e[5],T=e[6],S=e[7],w=e[8],E=e[9],M=e[10],D=e[11],p=e[12],B=e[13],I=e[14],P=e[15],i[0]),r=i[1],s=i[2],a=i[3];return n[0]=e*m+r*A+s*w+a*p,n[1]=e*y+r*C+s*E+a*B,n[2]=e*b+r*T+s*M+a*I,n[3]=e*x+r*S+s*D+a*P,e=i[4],r=i[5],s=i[6],a=i[7],n[4]=e*m+r*A+s*w+a*p,n[5]=e*y+r*C+s*E+a*B,n[6]=e*b+r*T+s*M+a*I,n[7]=e*x+r*S+s*D+a*P,e=i[8],r=i[9],s=i[10],a=i[11],n[8]=e*m+r*A+s*w+a*p,n[9]=e*y+r*C+s*E+a*B,n[10]=e*b+r*T+s*M+a*I,n[11]=e*x+r*S+s*D+a*P,e=i[12],r=i[13],s=i[14],a=i[15],n[12]=e*m+r*A+s*w+a*p,n[13]=e*y+r*C+s*E+a*B,n[14]=e*b+r*T+s*M+a*I,n[15]=e*x+r*S+s*D+a*P,t},l.transform=function(t,e,i){var n=i.x,r=i.y,i=i.z,s=t.m,a=e.m;return e===t?(s[12]=a[0]*n+a[4]*r+a[8]*i+a[12],s[13]=a[1]*n+a[5]*r+a[9]*i+a[13],s[14]=a[2]*n+a[6]*r+a[10]*i+a[14],s[15]=a[3]*n+a[7]*r+a[11]*i+a[15]):(m=a[0],y=a[1],b=a[2],x=a[3],A=a[4],C=a[5],T=a[6],S=a[7],w=a[8],E=a[9],M=a[10],D=a[11],p=a[12],B=a[13],I=a[14],P=a[15],s[0]=m,s[1]=y,s[2]=b,s[3]=x,s[4]=A,s[5]=C,s[6]=T,s[7]=S,s[8]=w,s[9]=E,s[10]=M,s[11]=D,s[12]=m*n+A*r+w*i+a[12],s[13]=y*n+C*r+E*i+a[13],s[14]=b*n+T*r+M*i+a[14],s[15]=x*n+S*r+D*i+a[15]),t},l.translate=function(t,e,i){var n=t.m,r=e.m;return e===t?(n[12]+=i.x,n[13]+=i.y,n[14]+=i.z):(n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]+=i.x,n[13]+=i.y,n[14]+=i.z,n[15]=r[15]),t},l.scale=function(t,e,i){var n=i.x,r=i.y,i=i.z,s=t.m,e=e.m;return s[0]=e[0]*n,s[1]=e[1]*n,s[2]=e[2]*n,s[3]=e[3]*n,s[4]=e[4]*r,s[5]=e[5]*r,s[6]=e[6]*r,s[7]=e[7]*r,s[8]=e[8]*i,s[9]=e[9]*i,s[10]=e[10]*i,s[11]=e[11]*i,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],t},l.rotate=function(t,e,i,n){var r=n.x,s=n.y,n=n.z,a=Math.sqrt(r*r+s*s+n*n);if(Math.abs(a)<g.EPSILON)return null;r*=a=1/a,s*=a,n*=a;var a=Math.sin(i),i=Math.cos(i),o=1-i,l=e.m,h=(m=l[0],y=l[1],b=l[2],x=l[3],A=l[4],C=l[5],T=l[6],S=l[7],w=l[8],E=l[9],M=l[10],D=l[11],r*r*o+i),c=s*r*o+n*a,u=n*r*o-s*a,_=r*s*o-n*a,d=s*s*o+i,f=n*s*o+r*a,p=r*n*o+s*a,s=s*n*o-r*a,r=n*n*o+i,a=t.m;return a[0]=m*h+A*c+w*u,a[1]=y*h+C*c+E*u,a[2]=b*h+T*c+M*u,a[3]=x*h+S*c+D*u,a[4]=m*_+A*d+w*f,a[5]=y*_+C*d+E*f,a[6]=b*_+T*d+M*f,a[7]=x*_+S*d+D*f,a[8]=m*p+A*s+w*r,a[9]=y*p+C*s+E*r,a[10]=b*p+T*s+M*r,a[11]=x*p+S*s+D*r,e!==t&&(a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15]),t},l.rotateX=function(t,e,i){var n=t.m,r=e.m,s=Math.sin(i),i=Math.cos(i),a=r[4],o=r[5],l=r[6],h=r[7],c=r[8],u=r[9],_=r[10],d=r[11];return e!==t&&(n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[4]=a*i+c*s,n[5]=o*i+u*s,n[6]=l*i+_*s,n[7]=h*i+d*s,n[8]=c*i-a*s,n[9]=u*i-o*s,n[10]=_*i-l*s,n[11]=d*i-h*s,t},l.rotateY=function(t,e,i){var n=t.m,r=e.m,s=Math.sin(i),i=Math.cos(i),a=r[0],o=r[1],l=r[2],h=r[3],c=r[8],u=r[9],_=r[10],d=r[11];return e!==t&&(n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=a*i-c*s,n[1]=o*i-u*s,n[2]=l*i-_*s,n[3]=h*i-d*s,n[8]=a*s+c*i,n[9]=o*s+u*i,n[10]=l*s+_*i,n[11]=h*s+d*i,t},l.rotateZ=function(t,e,i){var n=e.m,r=t.m,s=Math.sin(i),i=Math.cos(i),a=e.m[0],o=e.m[1],l=e.m[2],h=e.m[3],c=e.m[4],u=e.m[5],_=e.m[6],d=e.m[7];return e!==t&&(r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=a*i+c*s,r[1]=o*i+u*s,r[2]=l*i+_*s,r[3]=h*i+d*s,r[4]=c*i-a*s,r[5]=u*i-o*s,r[6]=_*i-l*s,r[7]=d*i-h*s,t},l.fromTranslation=function(t,e){var i=t.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,t},l.fromScaling=function(t,e){var i=t.m;return i[0]=e.x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e.y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e.z,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,t},l.fromRotation=function(t,e,i){var n=i.x,r=i.y,i=i.z,s=Math.sqrt(n*n+r*r+i*i);if(Math.abs(s)<g.EPSILON)return null;n*=s=1/s,r*=s,i*=s;var s=Math.sin(e),e=Math.cos(e),a=1-e,o=t.m;return o[0]=n*n*a+e,o[1]=r*n*a+i*s,o[2]=i*n*a-r*s,o[3]=0,o[4]=n*r*a-i*s,o[5]=r*r*a+e,o[6]=i*r*a+n*s,o[7]=0,o[8]=n*i*a+r*s,o[9]=r*i*a-n*s,o[10]=i*i*a+e,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,t},l.fromXRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e),n=t.m;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=i,n[7]=0,n[8]=0,n[9]=-i,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},l.fromYRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e),n=t.m;return n[0]=e,n[1]=0,n[2]=-i,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=i,n[9]=0,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},l.fromZRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e),n=t.m;return n[0]=e,n[1]=i,n[2]=0,n[3]=0,n[4]=-i,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},l.fromRT=function(t,e,i){var n=e.x,r=e.y,s=e.z,e=e.w,a=n+n,o=r+r,l=s+s,h=n*a,c=n*o,n=n*l,u=r*o,r=r*l,s=s*l,a=e*a,o=e*o,e=e*l,l=t.m;return l[0]=1-(u+s),l[1]=c+e,l[2]=n-o,l[3]=0,l[4]=c-e,l[5]=1-(h+s),l[6]=r+a,l[7]=0,l[8]=n+o,l[9]=r-a,l[10]=1-(h+u),l[11]=0,l[12]=i.x,l[13]=i.y,l[14]=i.z,l[15]=1,t},l.getTranslation=function(t,e){e=e.m;return t.x=e[12],t.y=e[13],t.z=e[14],t},l.getScaling=function(t,e){var e=e.m,i=_.m,n=i[0]=e[0],r=i[1]=e[1],s=i[2]=e[2],a=i[3]=e[4],o=i[4]=e[5],l=i[5]=e[6],h=i[6]=e[8],c=i[7]=e[9],i=i[8]=e[10];return t.x=Math.sqrt(n*n+r*r+s*s),t.y=Math.sqrt(a*a+o*o+l*l),t.z=Math.sqrt(h*h+c*c+i*i),u.default.determinant(_)<0&&(t.x*=-1),t},l.getRotation=function(t,e){var e=e.m,i=e[0]+e[5]+e[10],n=0;return 0<i?(n=2*Math.sqrt(i+1),t.w=.25*n,t.x=(e[6]-e[9])/n,t.y=(e[8]-e[2])/n,t.z=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t.w=(e[6]-e[9])/n,t.x=.25*n,t.y=(e[1]+e[4])/n,t.z=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t.w=(e[8]-e[2])/n,t.x=(e[1]+e[4])/n,t.y=.25*n,t.z=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t.w=(e[1]-e[4])/n,t.x=(e[8]+e[2])/n,t.y=(e[6]+e[9])/n,t.z=.25*n),t},l.toRTS=function(t,e,i,n){var t=t.m,r=_.m;n.x=s.default.set(h,t[0],t[1],t[2]).mag(),r[0]=t[0]/n.x,r[1]=t[1]/n.x,r[2]=t[2]/n.x,n.y=s.default.set(h,t[4],t[5],t[6]).mag(),r[3]=t[4]/n.y,r[4]=t[5]/n.y,r[5]=t[6]/n.y,n.z=s.default.set(h,t[8],t[9],t[10]).mag(),r[6]=t[8]/n.z,r[7]=t[9]/n.z,r[8]=t[10]/n.z,u.default.determinant(_)<0&&(n.x*=-1,r[0]*=-1,r[1]*=-1,r[2]*=-1),a.default.fromMat3(e,_),s.default.set(i,t[12],t[13],t[14])},l.fromRTS=function(t,e,i,n){var r=e.x,s=e.y,a=e.z,e=e.w,o=r+r,l=s+s,h=a+a,c=r*o,u=r*l,r=r*h,_=s*l,s=s*h,a=a*h,o=e*o,l=e*l,e=e*h,h=n.x,d=n.y,n=n.z,f=t.m;return f[0]=(1-(_+a))*h,f[1]=(u+e)*h,f[2]=(r-l)*h,f[3]=0,f[4]=(u-e)*d,f[5]=(1-(c+a))*d,f[6]=(s+o)*d,f[7]=0,f[8]=(r+l)*n,f[9]=(s-o)*n,f[10]=(1-(c+_))*n,f[11]=0,f[12]=i.x,f[13]=i.y,f[14]=i.z,f[15]=1,t},l.fromRTSOrigin=function(t,e,i,n,r){var s=e.x,a=e.y,o=e.z,e=e.w,l=s+s,h=a+a,c=o+o,u=s*l,_=s*h,s=s*c,d=a*h,a=a*c,o=o*c,l=e*l,h=e*h,e=e*c,c=n.x,f=n.y,n=n.z,p=r.x,m=r.y,r=r.z,y=t.m;return y[0]=(1-(d+o))*c,y[1]=(_+e)*c,y[2]=(s-h)*c,y[3]=0,y[4]=(_-e)*f,y[5]=(1-(u+o))*f,y[6]=(a+l)*f,y[7]=0,y[8]=(s+h)*n,y[9]=(a-l)*n,y[10]=(1-(u+d))*n,y[11]=0,y[12]=i.x+p-(y[0]*p+y[4]*m+y[8]*r),y[13]=i.y+m-(y[1]*p+y[5]*m+y[9]*r),y[14]=i.z+r-(y[2]*p+y[6]*m+y[10]*r),y[15]=1,t},l.fromQuat=function(t,e){var i=e.x,n=e.y,r=e.z,e=e.w,s=i+i,a=n+n,o=r+r,i=i*s,l=n*s,n=n*a,h=r*s,c=r*a,r=r*o,s=e*s,a=e*a,e=e*o,o=t.m;return o[0]=1-n-r,o[1]=l+e,o[2]=h-a,o[3]=0,o[4]=l-e,o[5]=1-i-r,o[6]=c+s,o[7]=0,o[8]=h+a,o[9]=c-s,o[10]=1-i-n,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,t},l.frustum=function(t,e,i,n,r,s,a){var o=1/(i-e),l=1/(r-n),h=1/(s-a),c=t.m;return c[0]=2*s*o,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*s*l,c[6]=0,c[7]=0,c[8]=(i+e)*o,c[9]=(r+n)*l,c[10]=(a+s)*h,c[11]=-1,c[12]=0,c[13]=0,c[14]=a*s*2*h,c[15]=0,t},l.perspective=function(t,e,i,n,r){var e=1/Math.tan(e/2),s=1/(n-r),a=t.m;return a[0]=e/i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=e,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(r+n)*s,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*r*n*s,a[15]=0,t},l.ortho=function(t,e,i,n,r,s,a){var o=1/(e-i),l=1/(n-r),h=1/(s-a),c=t.m;return c[0]=-2*o,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*l,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*h,c[11]=0,c[12]=(e+i)*o,c[13]=(r+n)*l,c[14]=(a+s)*h,c[15]=1,t},l.lookAt=function(t,e,i,n){var r=e.x,s=e.y,e=e.z,a=n.x,o=n.y,n=n.z,l=r-i.x,h=s-i.y,i=e-i.z,c=1/Math.sqrt(l*l+h*h+i*i),u=o*(i*=c)-n*(h*=c),n=n*(l*=c)-a*i,a=a*h-o*l,o=h*(a*=c=1/Math.sqrt(u*u+n*n+a*a))-i*(n*=c),c=i*(u*=c)-l*a,_=l*n-h*u,d=t.m;return d[0]=u,d[1]=o,d[2]=l,d[3]=0,d[4]=n,d[5]=c,d[6]=h,d[7]=0,d[8]=a,d[9]=_,d[10]=i,d[11]=0,d[12]=-(u*r+n*s+a*e),d[13]=-(o*r+c*s+_*e),d[14]=-(l*r+h*s+i*e),d[15]=1,t},l.inverseTranspose=function(t,e){var e=e.m,i=(m=e[0],y=e[1],b=e[2],x=e[3],A=e[4],C=e[5],T=e[6],S=e[7],w=e[8],E=e[9],M=e[10],D=e[11],p=e[12],B=e[13],I=e[14],P=e[15],m*C-y*A),n=m*T-b*A,r=m*S-x*A,s=y*T-b*C,a=y*S-x*C,o=b*S-x*T,l=w*B-E*p,h=w*I-M*p,c=w*P-D*p,u=E*I-M*B,_=E*P-D*B,d=M*P-D*I,f=i*d-n*_+r*u+s*c-a*h+o*l;return f?((e=t.m)[0]=(C*d-T*_+S*u)*(f=1/f),e[1]=(T*c-A*d-S*h)*f,e[2]=(A*_-C*c+S*l)*f,e[3]=0,e[4]=(b*_-y*d-x*u)*f,e[5]=(m*d-b*c+x*h)*f,e[6]=(y*c-m*_-x*l)*f,e[7]=0,e[8]=(B*o-I*a+P*s)*f,e[9]=(I*r-p*o-P*n)*f,e[10]=(p*a-B*r+P*i)*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t):null},l.add=function(t,e,i){var n=t.m,e=e.m,i=i.m;return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n[3]=e[3]+i[3],n[4]=e[4]+i[4],n[5]=e[5]+i[5],n[6]=e[6]+i[6],n[7]=e[7]+i[7],n[8]=e[8]+i[8],n[9]=e[9]+i[9],n[10]=e[10]+i[10],n[11]=e[11]+i[11],n[12]=e[12]+i[12],n[13]=e[13]+i[13],n[14]=e[14]+i[14],n[15]=e[15]+i[15],t},l.subtract=function(t,e,i){var n=t.m,e=e.m,i=i.m;return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n[3]=e[3]-i[3],n[4]=e[4]-i[4],n[5]=e[5]-i[5],n[6]=e[6]-i[6],n[7]=e[7]-i[7],n[8]=e[8]-i[8],n[9]=e[9]-i[9],n[10]=e[10]-i[10],n[11]=e[11]-i[11],n[12]=e[12]-i[12],n[13]=e[13]-i[13],n[14]=e[14]-i[14],n[15]=e[15]-i[15],t},l.multiplyScalar=function(t,e,i){var n=t.m,e=e.m;return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*i,n[9]=e[9]*i,n[10]=e[10]*i,n[11]=e[11]*i,n[12]=e[12]*i,n[13]=e[13]*i,n[14]=e[14]*i,n[15]=e[15]*i,t},l.multiplyScalarAndAdd=function(t,e,i,n){var r=t.m,e=e.m,i=i.m;return r[0]=e[0]+i[0]*n,r[1]=e[1]+i[1]*n,r[2]=e[2]+i[2]*n,r[3]=e[3]+i[3]*n,r[4]=e[4]+i[4]*n,r[5]=e[5]+i[5]*n,r[6]=e[6]+i[6]*n,r[7]=e[7]+i[7]*n,r[8]=e[8]+i[8]*n,r[9]=e[9]+i[9]*n,r[10]=e[10]+i[10]*n,r[11]=e[11]+i[11]*n,r[12]=e[12]+i[12]*n,r[13]=e[13]+i[13]*n,r[14]=e[14]+i[14]*n,r[15]=e[15]+i[15]*n,t},l.strictEquals=function(t,e){t=t.m,e=e.m;return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},l.equals=function(t,e,i){void 0===i&&(i=g.EPSILON);t=t.m,e=e.m;return Math.abs(t[0]-e[0])<=i*Math.max(1,Math.abs(t[0]),Math.abs(e[0]))&&Math.abs(t[1]-e[1])<=i*Math.max(1,Math.abs(t[1]),Math.abs(e[1]))&&Math.abs(t[2]-e[2])<=i*Math.max(1,Math.abs(t[2]),Math.abs(e[2]))&&Math.abs(t[3]-e[3])<=i*Math.max(1,Math.abs(t[3]),Math.abs(e[3]))&&Math.abs(t[4]-e[4])<=i*Math.max(1,Math.abs(t[4]),Math.abs(e[4]))&&Math.abs(t[5]-e[5])<=i*Math.max(1,Math.abs(t[5]),Math.abs(e[5]))&&Math.abs(t[6]-e[6])<=i*Math.max(1,Math.abs(t[6]),Math.abs(e[6]))&&Math.abs(t[7]-e[7])<=i*Math.max(1,Math.abs(t[7]),Math.abs(e[7]))&&Math.abs(t[8]-e[8])<=i*Math.max(1,Math.abs(t[8]),Math.abs(e[8]))&&Math.abs(t[9]-e[9])<=i*Math.max(1,Math.abs(t[9]),Math.abs(e[9]))&&Math.abs(t[10]-e[10])<=i*Math.max(1,Math.abs(t[10]),Math.abs(e[10]))&&Math.abs(t[11]-e[11])<=i*Math.max(1,Math.abs(t[11]),Math.abs(e[11]))&&Math.abs(t[12]-e[12])<=i*Math.max(1,Math.abs(t[12]),Math.abs(e[12]))&&Math.abs(t[13]-e[13])<=i*Math.max(1,Math.abs(t[13]),Math.abs(e[13]))&&Math.abs(t[14]-e[14])<=i*Math.max(1,Math.abs(t[14]),Math.abs(e[14]))&&Math.abs(t[15]-e[15])<=i*Math.max(1,Math.abs(t[15]),Math.abs(e[15]))},l.adjoint=function(t,e){var e=e.m,i=t.m,n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=e[7],u=e[8],_=e[9],d=e[10],f=e[11],p=e[12],m=e[13],y=e[14],e=e[15];return i[0]=l*(d*e-f*y)-_*(h*e-c*y)+m*(h*f-c*d),i[1]=-(r*(d*e-f*y)-_*(s*e-a*y)+m*(s*f-a*d)),i[2]=r*(h*e-c*y)-l*(s*e-a*y)+m*(s*c-a*h),i[3]=-(r*(h*f-c*d)-l*(s*f-a*d)+_*(s*c-a*h)),i[4]=-(o*(d*e-f*y)-u*(h*e-c*y)+p*(h*f-c*d)),i[5]=n*(d*e-f*y)-u*(s*e-a*y)+p*(s*f-a*d),i[6]=-(n*(h*e-c*y)-o*(s*e-a*y)+p*(s*c-a*h)),i[7]=n*(h*f-c*d)-o*(s*f-a*d)+u*(s*c-a*h),i[8]=o*(_*e-f*m)-u*(l*e-c*m)+p*(l*f-c*_),i[9]=-(n*(_*e-f*m)-u*(r*e-a*m)+p*(r*f-a*_)),i[10]=n*(l*e-c*m)-o*(r*e-a*m)+p*(r*c-a*l),i[11]=-(n*(l*f-c*_)-o*(r*f-a*_)+u*(r*c-a*l)),i[12]=-(o*(_*y-d*m)-u*(l*y-h*m)+p*(l*d-h*_)),i[13]=n*(_*y-d*m)-u*(r*y-s*m)+p*(r*d-s*_),i[14]=-(n*(l*y-h*m)-o*(r*y-s*m)+p*(r*h-s*l)),i[15]=n*(l*d-h*_)-o*(r*d-s*_)+u*(r*h-s*l),t},l.toArray=function(t,e,i){void 0===i&&(i=0);for(var n=e.m,r=0;r<16;r++)t[i+r]=n[r];return t},l.fromArray=function(t,e,i){void 0===i&&(i=0);for(var n=t.m,r=0;r<16;r++)n[r]=e[i+r];return t},n.clone=function(){var t=this.m;return new l(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},n.set=function(t){var e=this.m,t=t.m;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},n.equals=function(t){return l.strictEquals(this,t)},n.fuzzyEquals=function(t){return l.equals(this,t)},n.toString=function(){var t=this.m;return t?"[\n"+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+",\n"+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+",\n"+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+",\n"+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"\n]":"[\n1, 0, 0, 0\n0, 1, 0, 0\n0, 0, 1, 0\n0, 0, 0, 1\n]"},n.identity=function(){return l.identity(this)},n.transpose=function(t){return t=t||new l,l.transpose(t,this)},n.invert=function(t){return t=t||new l,l.invert(t,this)},n.adjoint=function(t){return t=t||new l,l.adjoint(t,this)},n.determinant=function(){return l.determinant(this)},n.add=function(t,e){return e=e||new l,l.add(e,this,t)},n.subtract=function(t){return l.subtract(this,this,t)},n.multiply=function(t){return l.multiply(this,this,t)},n.multiplyScalar=function(t){return l.multiplyScalar(this,this,t)},n.translate=function(t,e){return e=e||new l,l.translate(e,this,t)},n.scale=function(t,e){return e=e||new l,l.scale(e,this,t)},n.rotate=function(t,e,i){return i=i||new l,l.rotate(i,this,t,e)},n.getTranslation=function(t){return t=t||new s.default,l.getTranslation(t,this)},n.getScale=function(t){return t=t||new s.default,l.getScaling(t,this)},n.getRotation=function(t){return t=t||new a.default,l.getRotation(t,this)},n.fromRTS=function(t,e,i){return l.fromRTS(this,t,e,i)},n.fromQuat=function(t){return l.fromQuat(this,t)},l);function l(t,e,i,n,r,s,a,o,l,h,c,u,_,d,f,p){var m,y;return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===c&&(c=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===f&&(f=0),void 0===p&&(p=1),(m=v.call(this)||this).m=void 0,t instanceof g.FLOAT_ARRAY_TYPE?m.m=t:(m.m=new g.FLOAT_ARRAY_TYPE(16),(y=m.m)[0]=t,y[1]=e,y[2]=i,y[3]=n,y[4]=r,y[5]=s,y[6]=a,y[7]=o,y[8]=l,y[9]=h,y[10]=c,y[11]=u,y[12]=_,y[13]=d,y[14]=f,y[15]=p),m}(i.default=R).mul=R.multiply,R.sub=R.subtract,R.IDENTITY=Object.freeze(new R);var h=new s.default,_=new u.default;r.default.fastDefine("cc.Mat4",R,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1});for(var c=0;c<16;c++)!function(e){Object.defineProperty(R.prototype,"m"+e,{get:function(){return this.m[e]},set:function(t){this.m[e]=t}})}(c);cc.mat4=function(t,e,i,n,r,s,a,o,l,h,c,u,_,d,f,p){e=new R(t,e,i,n,r,s,a,o,l,h,c,u,_,d,f,p);return void 0===t&&R.identity(e),e},cc.Mat4=R,e.exports=i.default},{"../platform/CCClass":230,"./mat3":331,"./quat":333,"./utils":337,"./value-type":338,"./vec3":340}],333:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=o(t("./value-type")),r=o(t("../platform/CCClass")),s=o(t("./vec3")),a=o(t("./mat3")),_=t("./utils");function o(t){return t&&t.__esModule?t:{default:t}}d=n.default,t=d,(n=p).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=p.prototype).mul=function(t,e){return p.multiply(e||new p,this,t)},p.clone=function(t){return new p(t.x,t.y,t.z,t.w)},p.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},p.set=function(t,e,i,n,r){return t.x=e,t.y=i,t.z=n,t.w=r,t},p.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},p.rotationTo=function(t,e,i){var n=s.default.dot(e,i);return n<-.999999?(s.default.cross(g,s.default.RIGHT,e),g.mag()<1e-6&&s.default.cross(g,s.default.UP,e),s.default.normalize(g,g),p.fromAxisAngle(t,g,Math.PI),t):.999999<n?(t.x=0,t.y=0,t.z=0,t.w=1,t):(s.default.cross(g,e,i),t.x=g.x,t.y=g.y,t.z=g.z,t.w=1+n,p.normalize(t,t))},p.getAxisAngle=function(t,e){var i=2*Math.acos(e.w),n=Math.sin(i/2);return 0!==n?(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n):(t.x=1,t.y=0,t.z=0),i},p.multiply=function(t,e,i){return l=e.x*i.w+e.w*i.x+e.y*i.z-e.z*i.y,h=e.y*i.w+e.w*i.y+e.z*i.x-e.x*i.z,c=e.z*i.w+e.w*i.z+e.x*i.y-e.y*i.x,u=e.w*i.w-e.x*i.x-e.y*i.y-e.z*i.z,t.x=l,t.y=h,t.z=c,t.w=u,t},p.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},p.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t.w=e.w+i.w*n,t},p.rotateX=function(t,e,i){i*=.5;var n=Math.sin(i),i=Math.cos(i);return t.x=e.x*i+e.w*n,t.y=e.y*i+e.z*n,t.z=e.z*i-e.y*n,t.w=e.w*i-e.x*n,t},p.rotateY=function(t,e,i){i*=.5;var n=Math.sin(i),i=Math.cos(i);return t.x=e.x*i-e.z*n,t.y=e.y*i+e.w*n,t.z=e.z*i+e.x*n,t.w=e.w*i-e.y*n,t},p.rotateZ=function(t,e,i){i*=.5;var n=Math.sin(i),i=Math.cos(i);return t.x=e.x*i+e.y*n,t.y=e.y*i-e.x*n,t.z=e.z*i+e.w*n,t.w=e.w*i-e.z*n,t},p.rotateAround=function(t,e,i,n){return p.invert(m,e),s.default.transformQuat(g,i,m),p.fromAxisAngle(m,g,n),p.multiply(t,e,m),t},p.rotateAroundLocal=function(t,e,i,n){return p.fromAxisAngle(m,i,n),p.multiply(t,e,m),t},p.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t},p.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},p.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t.w=e.w+n*(i.w-e.w),t},p.slerp=function(t,e,i,n){var r,s=0,a=0,o=e.x*i.x+e.y*i.y+e.z*i.z+e.w*i.w;return o<0&&(o=-o,i.x=-i.x,i.y=-i.y,i.z=-i.z,i.w=-i.w),a=1e-6<1-o?(o=Math.acos(o),r=Math.sin(o),s=Math.sin((1-n)*o)/r,Math.sin(n*o)/r):(s=1-n,n),t.x=s*e.x+a*i.x,t.y=s*e.y+a*i.y,t.z=s*e.z+a*i.z,t.w=s*e.w+a*i.w,t},p.sqlerp=function(t,e,i,n,r,s){return p.slerp(m,e,r,s),p.slerp(y,i,n,s),p.slerp(t,m,y,2*s*(1-s)),t},p.invert=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,i=i?1/i:0;return t.x=-e.x*i,t.y=-e.y*i,t.z=-e.z*i,t.w=e.w*i,t},p.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},p.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},p.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},p.normalize=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return 0<i&&(i=1/Math.sqrt(i),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i),t},p.fromAxes=function(t,e,i,n){return a.default.set(v,e.x,e.y,e.z,i.x,i.y,i.z,n.x,n.y,n.z),p.normalize(t,p.fromMat3(t,v))},p.fromViewUp=function(t,e,i){return a.default.fromViewUp(v,e,i),p.normalize(t,p.fromMat3(t,v))},p.fromAxisAngle=function(t,e,i){i*=.5;var n=Math.sin(i);return t.x=n*e.x,t.y=n*e.y,t.z=n*e.z,t.w=Math.cos(i),t},p.fromAngleZ=function(t,e){return e*=b,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t},p.fromMat3=function(t,e){var e=e.m,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],e=e[8],c=i+a+e;return 0<c?(c=.5/Math.sqrt(c+1),t.w=.25/c,t.x=(o-h)*c,t.y=(l-r)*c,t.z=(n-s)*c):a<i&&e<i?(c=2*Math.sqrt(1+i-a-e),t.w=(o-h)/c,t.x=.25*c,t.y=(s+n)/c,t.z=(l+r)/c):e<a?(c=2*Math.sqrt(1+a-i-e),t.w=(l-r)/c,t.x=(s+n)/c,t.y=.25*c,t.z=(h+o)/c):(c=2*Math.sqrt(1+e-i-a),t.w=(n-s)/c,t.x=(l+r)/c,t.y=(h+o)/c,t.z=.25*c),t},p.fromEuler=function(t,e,i,n){e*=b,i*=b,n*=b;var r=Math.sin(e),e=Math.cos(e),s=Math.sin(i),i=Math.cos(i),a=Math.sin(n),n=Math.cos(n);return t.x=r*i*n+e*s*a,t.y=e*s*n+r*i*a,t.z=e*i*a-r*s*n,t.w=e*i*n-r*s*a,t},p.toAxisX=function(t,e){var i=2*e.y,n=2*e.z;return t.x=1-i*e.y-n*e.z,t.y=i*e.x+n*e.w,t.z=n*e.x+i*e.w,t},p.toAxisY=function(t,e){var i=2*e.x,n=2*e.y,r=2*e.z;return t.x=n*e.x-r*e.w,t.y=1-i*e.x-r*e.z,t.z=r*e.y+i*e.w,t},p.toAxisZ=function(t,e){var i=2*e.x,n=2*e.y,r=2*e.z;return t.x=r*e.x-n*e.w,t.y=r*e.y-i*e.w,t.z=1-i*e.x-n*e.y,t},p.toEuler=function(t,e,i){var n,r,s=e.x,a=e.y,o=e.z,e=e.w,l=0,h=0,c=0,u=s*a+o*e;return.499999<u?(h=(l=0,_.toDegree)(2*Math.atan2(s,e)),c=90):u<-.499999?(h=-(l=0,_.toDegree)(2*Math.atan2(s,e)),c=-90):(n=a*a,r=o*o,l=(0,_.toDegree)(Math.atan2(2*s*e-2*a*o,1-2*(s*s)-2*r)),h=(0,_.toDegree)(Math.atan2(2*a*e-2*s*o,1-2*n-2*r)),c=(0,_.toDegree)(Math.asin(2*u)),i&&(l=-180*Math.sign(l+1e-6)+l,h=-180*Math.sign(h+1e-6)+h,c=180*Math.sign(c+1e-6)-c)),t.x=l,t.y=h,t.z=c,t},p.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},p.equals=function(t,e,i){return void 0===i&&(i=_.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))},p.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},p.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},n.clone=function(){return new p(this.x,this.y,this.z,this.w)},n.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.toEuler=function(t){return p.toEuler(t,this)},n.fromEuler=function(t){return p.fromEuler(this,t.x,t.y,t.z)},n.lerp=function(t,e,i){return i=i||new p,p.slerp(i,this,t,e),i},n.multiply=function(t){return p.multiply(this,this,t)},n.rotateAround=function(t,e,i,n){return n=n||new p,p.rotateAround(n,t,e,i)};var l,h,c,u,d,f=p;function p(t,e,i,n){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),(r=d.call(this)||this).x=void 0,r.y=void 0,r.z=void 0,r.w=void 0,t&&"object"==typeof t?(r.z=t.z,r.y=t.y,r.w=t.w,r.x=t.x):(r.x=t,r.y=e,r.z=i,r.w=n),r}(i.default=f).mul=f.multiply,f.scale=f.multiplyScalar,f.mag=f.len,f.IDENTITY=Object.freeze(new f);var m=new f,y=new f,g=new s.default,v=new a.default,b=.5*Math.PI/180;r.default.fastDefine("cc.Quat",f,{x:0,y:0,z:0,w:1}),cc.quat=function(t,e,i,n){return new f(t,e,i,n)},cc.Quat=f,e.exports=i.default},{"../platform/CCClass":230,"./mat3":331,"./utils":337,"./value-type":338,"./vec3":340}],334:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=o(t("./value-type")),r=o(t("../platform/CCClass")),s=o(t("./vec2")),a=o(t("./size"));function o(t){return t&&t.__esModule?t:{default:t}}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}h=n.default,t=h,(n=_).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,_.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),n=Math.min(t.y,e.y);return new _(i,n,Math.max(t.x,e.x)-i,Math.max(t.y,e.y)-n)},(n=_.prototype).clone=function(){return new _(this.x,this.y,this.width,this.height)},n.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},n.lerp=function(t,e,i){i=i||new _;var n=this.x,r=this.y,s=this.width,a=this.height;return i.x=n+(t.x-n)*e,i.y=r+(t.y-r)*e,i.width=s+(t.width-s)*e,i.height=a+(t.height-a)*e,i},n.set=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},n.intersects=function(t){var e=this.x+this.width,i=this.y+this.height,n=t.x+t.width,r=t.y+t.height;return!(e<t.x||n<this.x||i<t.y||r<this.y)},n.intersection=function(t,e){var i=this.x,n=this.y,r=this.x+this.width,s=this.y+this.height,a=e.x,o=e.y,l=e.x+e.width,e=e.y+e.height;return t.x=Math.max(i,a),t.y=Math.max(n,o),t.width=Math.min(r,l)-t.x,t.height=Math.min(s,e)-t.y,t},n.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},n.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},n.union=function(t,e){var i=this.x,n=this.y,r=this.width,s=this.height,a=e.x,o=e.y,l=e.width,e=e.height;return t.x=Math.min(i,a),t.y=Math.min(n,o),t.width=Math.max(i+r,a+l)-t.x,t.height=Math.max(n+s,o+e)-t.y,t},n.transformMat4=function(t,e){var i=this.x,n=this.y,r=i+this.width,s=n+this.height,e=e.m,a=e[0]*i+e[4]*n+e[12],o=e[1]*i+e[5]*n+e[13],l=e[0]*r+e[4]*n+e[12],n=e[1]*r+e[5]*n+e[13],h=e[0]*i+e[4]*s+e[12],i=e[1]*i+e[5]*s+e[13],c=e[0]*r+e[4]*s+e[12],r=e[1]*r+e[5]*s+e[13],s=Math.min(a,l,h,c),e=Math.max(a,l,h,c),a=Math.min(o,n,i,r),l=Math.max(o,n,i,r);return t.x=s,t.y=a,t.width=e-s,t.height=l-a,t},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},t=_,(n=[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new s.default(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new s.default(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new a.default(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}}])&&l(t.prototype,n),c&&l(t,c);var h,c,u=_;function _(t,e,i,n){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),(r=h.call(this)||this).x=void 0,r.y=void 0,r.width=void 0,r.height=void 0,t&&"object"==typeof t&&(e=t.y,i=t.width,n=t.height,t=t.x),r.x=t||0,r.y=e||0,r.width=i||0,r.height=n||0,r}i.default=u,r.default.fastDefine("cc.Rect",u,{x:0,y:0,width:0,height:0}),cc.Rect=u,cc.rect=function(t,e,i,n){return new u(t,e,i,n)},e.exports=i.default},{"../platform/CCClass":230,"./size":335,"./value-type":338,"./vec2":339}],335:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=r(t("./value-type")),t=r(t("../platform/CCClass"));function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}a=n.default,n=a,(o=c).prototype=Object.create(n.prototype),(o.prototype.constructor=o).__proto__=n,o=c,n=[{key:"ZERO",get:function(){return new c}}],(l=null)&&s(o.prototype,l),n&&s(o,n),(l=c.prototype).clone=function(){return new c(this.width,this.height)},l.equals=function(t){return t&&this.width===t.width&&this.height===t.height},l.lerp=function(t,e,i){i=i||new c;var n=this.width,r=this.height;return i.width=n+(t.width-n)*e,i.height=r+(t.height-r)*e,i},l.set=function(t){return this.width=t.width,this.height=t.height,this},l.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"};var a,o,l,h=c;function c(t,e){var i;return void 0===t&&(t=0),void 0===e&&(e=0),(i=a.call(this)||this).width=void 0,i.height=void 0,t&&"object"==typeof t?(i.height=t.height,i.width=t.width):(i.width=t||0,i.height=e||0),i}(i.default=h).ZERO_R=h.ZERO,t.default.fastDefine("cc.Size",h,{width:0,height:0}),cc.size=function(t,e){return new h(t,e)},cc.Size=h,e.exports=i.default},{"../platform/CCClass":230,"./value-type":338}],336:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=(t=t("./quat"))&&t.__esModule?t:{default:t},s=new r.default,t=(a.toRotation=function(t,e){return t.x=e[3],t.y=e[4],t.z=e[5],t.w=e[6],t},a.fromRotation=function(t,e){return t[3]=e.x,t[4]=e.y,t[5]=e.z,t[6]=e.w,t},a.toEuler=function(t,e){return a.toRotation(s,e),r.default.toEuler(t,s),t},a.fromEuler=function(t,e){return r.default.fromEuler(s,e.x,e.y,e.z),a.fromRotation(t,s),t},a.fromEulerNumber=function(t,e,i,n){return r.default.fromEuler(s,e,i,n),a.fromRotation(t,s),t},a.toScale=function(t,e){return t.x=e[7],t.y=e[8],t.z=e[9],t},a.fromScale=function(t,e){return t[7]=e.x,t[8]=e.y,t[9]=e.z,t},a.toPosition=function(t,e){return t.x=e[0],t.y=e[1],t.z=e[2],t},a.fromPosition=function(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t},a.fromAngleZ=function(t,e){return r.default.fromAngleZ(s,e),a.fromRotation(t,s),t},a.toMat4=function(t,e){var i=e[3],n=e[4],r=e[5],s=e[6],a=i+i,o=n+n,l=r+r,h=i*a,c=i*o,i=i*l,u=n*o,n=n*l,r=r*l,a=s*a,o=s*o,s=s*l,l=e[7],_=e[8],d=e[9],f=t.m;return f[0]=(1-(u+r))*l,f[1]=(c+s)*l,f[2]=(i-o)*l,f[3]=0,f[4]=(c-s)*_,f[5]=(1-(h+r))*_,f[6]=(n+a)*_,f[7]=0,f[8]=(i+o)*d,f[9]=(n-a)*d,f[10]=(1-(h+u))*d,f[11]=0,f[12]=e[0],f[13]=e[1],f[14]=e[2],f[15]=1,t},a);function a(){}i.default=t,cc.Trs=t,e.exports=i.default},{"./quat":333}],337:[function(t,e,i){"use strict";i.__esModule=!0,i.equals=function(t,e){return Math.abs(t-e)<=s*Math.max(1,Math.abs(t),Math.abs(e))},i.approx=function(t,e,i){return i=i||s,Math.abs(t-e)<=i},i.clamp=function(t,e,i){return t<e?e:i<t?i:t},i.clamp01=function(t){return t<0?0:1<t?1:t},i.lerp=function(t,e,i){return t+(e-t)*i},i.toRadian=function(t){return t*n},i.toDegree=function(t){return t*r},i.randomRange=o,i.randomRangeInt=function(t,e){return Math.floor(o(t,e))},i.pseudoRandom=l,i.pseudoRandomRange=h,i.pseudoRandomRangeInt=function(t,e,i){return Math.floor(h(t,e,i))},i.nextPow2=function(t){return--t,t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16,++t},i.repeat=c,i.pingPong=function(t,e){return t=c(t,2*e),e-Math.abs(t-e)},i.inverseLerp=function(t,e,i){return(i-t)/(e-t)},i.sign=function(t){return(0<t)-(t<0)},i.random=i.FLOAT_BYTES=i.FLOAT_ARRAY_TYPE=i.INT_MIN=i.INT_MAX=i.INT_BITS=i.EPSILON=void 0;var n=Math.PI/180,r=180/Math.PI,s=1e-6,a=(i.EPSILON=s,i.INT_BITS=32,i.INT_MAX=2147483647,i.INT_MIN=-1<<31,Float64Array),a=(i.FLOAT_ARRAY_TYPE=a,i.FLOAT_BYTES=8,Math.random);function o(t,e){return Math.random()*(e-t)+t}function l(t){return(9301*t+49297)%233280/233280}function h(t,e,i){return l(t)*(i-e)+e}function c(t,e){return t-Math.floor(t/e)*e}i.random=a},{}],338:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("../platform/js"))&&t.__esModule?t:{default:t},t=((t=r.prototype).clone=function(){return cc.errorID("0100",n.default.getClassName(this)+".clone"),null},t.equals=function(t){return cc.errorID("0100",n.default.getClassName(this)+".equals"),!1},t.lerp=function(t,e){return cc.errorID("0100",n.default.getClassName(this)+".lerp"),this.clone()},t.set=function(t){cc.errorID("0100",n.default.getClassName(this)+".set")},t.toString=function(){return""+{}},r);function r(){}i.default=t,n.default.setClassName("cc.ValueType",t),cc.ValueType=t,e.exports=i.default},{"../platform/js":250}],339:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=o(t("./value-type")),r=o(t("../platform/CCClass")),s=o(t("../utils/misc")),a=t("./utils");function o(t){return t&&t.__esModule?t:{default:t}}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h,c,u,_=0,d=0,f=(h=n.default,t=h,(n=p).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=p.prototype).sub=function(t,e){return p.subtract(e||new p,this,t)},n.mul=function(t,e){return p.multiplyScalar(e||new p,this,t)},n.div=function(t,e){return p.multiplyScalar(e||new p,this,1/t)},n.scale=function(t,e){return p.multiply(e||new p,this,t)},n.neg=function(t){return p.negate(t||new p,this)},p.clone=function(t){return new p(t.x,t.y)},p.copy=function(t,e){return t.x=e.x,t.y=e.y,t},p.set=function(t,e,i){return t.x=e,t.y=i,t},p.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},p.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},p.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t},p.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t},p.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t},p.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t},p.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t},p.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t},p.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t},p.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},p.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t},p.distance=function(t,e){return _=e.x-t.x,d=e.y-t.y,Math.sqrt(_*_+d*d)},p.squaredDistance=function(t,e){return _=e.x-t.x,d=e.y-t.y,_*_+d*d},p.len=function(t){return _=t.x,d=t.y,Math.sqrt(_*_+d*d)},p.lengthSqr=function(t){return _=t.x,d=t.y,_*_+d*d},p.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t},p.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t},p.inverseSafe=function(t,e){return _=e.x,d=e.y,Math.abs(_)<a.EPSILON?t.x=0:t.x=1/_,Math.abs(d)<a.EPSILON?t.y=0:t.y=1/d,t},p.normalize=function(t,e){_=e.x,d=e.y;e=_*_+d*d;return 0<e&&(e=1/Math.sqrt(e),t.x=_*e,t.y=d*e),t},p.dot=function(t,e){return t.x*e.x+t.y*e.y},p.cross=function(t,e,i){return t.x=t.y=0,t.z=e.x*i.y-e.y*i.x,t},p.lerp=function(t,e,i,n){return _=e.x,d=e.y,t.x=_+n*(i.x-_),t.y=d+n*(i.y-d),t},p.random=function(t,e){e=e||1;var i=2*(0,a.random)()*Math.PI;return t.x=Math.cos(i)*e,t.y=Math.sin(i)*e,t},p.transformMat3=function(t,e,i){_=e.x,d=e.y;e=i.m;return t.x=e[0]*_+e[3]*d+e[6],t.y=e[1]*_+e[4]*d+e[7],t},p.transformMat4=function(t,e,i){_=e.x,d=e.y;e=i.m;return t.x=e[0]*_+e[4]*d+e[12],t.y=e[1]*_+e[5]*d+e[13],t},p.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y},p.equals=function(t,e,i){return void 0===i&&(i=a.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))},p.angle=function(t,e){p.normalize(m,t),p.normalize(y,e);t=p.dot(m,y);return 1<t?0:t<-1?Math.PI:Math.acos(t)},p.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t},p.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t},t=p,u=[{key:"ONE",get:function(){return new p(1,1)}},{key:"ZERO",get:function(){return new p(0,0)}},{key:"UP",get:function(){return new p(0,1)}},{key:"RIGHT",get:function(){return new p(1,0)}}],(c=null)&&l(t.prototype,c),u&&l(t,u),n.clone=function(){return new p(this.x,this.y)},n.set=function(t){return this.x=t.x,this.y=t.y,this},n.equals=function(t){return t&&this.x===t.x&&this.y===t.y},n.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(t,e,i){i=i||new p;var n=this.x,r=this.y;return i.x=n+(t.x-n)*e,i.y=r+(t.y-r)*e,i},n.clampf=function(t,e){return this.x=s.default.clampf(this.x,t.x,e.x),this.y=s.default.clampf(this.y,t.y,e.y),this},n.add=function(t,e){return(e=e||new p).x=this.x+t.x,e.y=this.y+t.y,e},n.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},n.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},n.divide=function(t){return this.x/=t,this.y/=t,this},n.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},n.cross=function(t){return this.x*t.y-this.y*t.x},n.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalizeSelf=function(){var t=this.x*this.x+this.y*this.y;if(1==t)return this;if(0==t)return this;t=1/Math.sqrt(t);return this.x*=t,this.y*=t,this},n.normalize=function(t){return(t=t||new p).x=this.x,t.y=this.y,t.normalizeSelf(),t},n.angle=function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;t=this.dot(t)/Math.sqrt(e*i),t=s.default.clampf(t,-1,1);return Math.acos(t)},n.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},n.rotate=function(t,e){return(e=e||new p).x=this.x,e.y=this.y,e.rotateSelf(t)},n.rotateSelf=function(t){var e=Math.sin(t),t=Math.cos(t),i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this},n.project=function(t){return t.multiplyScalar(this.dot(t)/t.dot(t))},n.transformMat4=function(t,e){return e=e||new p,p.transformMat4(e,this,t),e},n.maxAxis=function(){return Math.max(this.x,this.y)},p);function p(t,e){var i;return void 0===t&&(t=0),void 0===e&&(e=0),(i=h.call(this)||this).mag=p.prototype.len,i.magSqr=p.prototype.lengthSqr,i.subSelf=p.prototype.subtract,i.mulSelf=p.prototype.multiplyScalar,i.divSelf=p.prototype.divide,i.scaleSelf=p.prototype.multiply,i.negSelf=p.prototype.negate,i.x=void 0,i.y=void 0,i.z=0,t&&"object"==typeof t?(i.y=t.y||0,i.x=t.x||0):(i.x=t||0,i.y=e||0),i}(i.default=f).sub=f.subtract,f.mul=f.multiply,f.scale=f.multiplyScalar,f.mag=f.len,f.squaredMagnitude=f.lengthSqr,f.div=f.divide,f.ONE_R=f.ONE,f.ZERO_R=f.ZERO,f.UP_R=f.UP,f.RIGHT_R=f.RIGHT;var m=new f,y=new f;r.default.fastDefine("cc.Vec2",f,{x:0,y:0}),cc.v2=function(t,e){return new f(t,e)},cc.Vec2=f,e.exports=i.default},{"../platform/CCClass":230,"../utils/misc":315,"./utils":337,"./value-type":338}],340:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=l(t("./value-type")),r=l(t("../platform/CCClass")),s=l(t("../utils/misc")),a=l(t("./vec2")),o=t("./utils");function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c,u,_,d=0,f=0,p=0,m=(c=n.default,t=c,(n=y).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=y.prototype).sub=function(t,e){return y.subtract(e||new y,this,t)},n.mul=function(t,e){return y.multiplyScalar(e||new y,this,t)},n.div=function(t,e){return y.multiplyScalar(e||new y,this,1/t)},n.scale=function(t,e){return y.multiply(e||new y,this,t)},n.neg=function(t){return y.negate(t||new y,this)},y.zero=function(t){return t.x=0,t.y=0,t.z=0,t},y.clone=function(t){return new y(t.x,t.y,t.z)},y.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t},y.set=function(t,e,i,n){return t.x=e,t.y=i,t.z=n,t},y.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t},y.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t},y.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t},y.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t},y.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t},y.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t},y.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t},y.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t},y.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t},y.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t},y.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t},y.distance=function(t,e){return d=e.x-t.x,f=e.y-t.y,p=e.z-t.z,Math.sqrt(d*d+f*f+p*p)},y.squaredDistance=function(t,e){return d=e.x-t.x,f=e.y-t.y,p=e.z-t.z,d*d+f*f+p*p},y.len=function(t){return d=t.x,f=t.y,p=t.z,Math.sqrt(d*d+f*f+p*p)},y.lengthSqr=function(t){return d=t.x,f=t.y,p=t.z,d*d+f*f+p*p},y.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},y.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t},y.inverseSafe=function(t,e){return d=e.x,f=e.y,p=e.z,Math.abs(d)<o.EPSILON?t.x=0:t.x=1/d,Math.abs(f)<o.EPSILON?t.y=0:t.y=1/f,Math.abs(p)<o.EPSILON?t.z=0:t.z=1/p,t},y.normalize=function(t,e){d=e.x,f=e.y,p=e.z;e=d*d+f*f+p*p;return 0<e&&(e=1/Math.sqrt(e),t.x=d*e,t.y=f*e,t.z=p*e),t},y.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},y.cross=function(t,e,i){var n=e.x,r=e.y,e=e.z,s=i.x,a=i.y,i=i.z;return t.x=r*i-e*a,t.y=e*s-n*i,t.z=n*a-r*s,t},y.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t},y.random=function(t,e){e=e||1;var i=2*(0,o.random)()*Math.PI,n=2*(0,o.random)()-1,r=Math.sqrt(1-n*n);return t.x=r*Math.cos(i)*e,t.y=r*Math.sin(i)*e,t.z=n*e,t},y.transformMat4=function(t,e,i){d=e.x,f=e.y,p=e.z;e=i.m,i=(i=e[3]*d+e[7]*f+e[11]*p+e[15])?1/i:1;return t.x=(e[0]*d+e[4]*f+e[8]*p+e[12])*i,t.y=(e[1]*d+e[5]*f+e[9]*p+e[13])*i,t.z=(e[2]*d+e[6]*f+e[10]*p+e[14])*i,t},y.transformMat4Normal=function(t,e,i){d=e.x,f=e.y,p=e.z;e=i.m,i=(i=e[3]*d+e[7]*f+e[11]*p)?1/i:1;return t.x=(e[0]*d+e[4]*f+e[8]*p)*i,t.y=(e[1]*d+e[5]*f+e[9]*p)*i,t.z=(e[2]*d+e[6]*f+e[10]*p)*i,t},y.transformMat3=function(t,e,i){d=e.x,f=e.y,p=e.z;e=i.m;return t.x=d*e[0]+f*e[3]+p*e[6],t.y=d*e[1]+f*e[4]+p*e[7],t.z=d*e[2]+f*e[5]+p*e[8],t},y.transformAffine=function(t,e,i){d=e.x,f=e.y,p=e.z;e=i.m;return t.x=e[0]*d+e[1]*f+e[2]*p+e[3],t.y=e[4]*d+e[5]*f+e[6]*p+e[7],t.x=e[8]*d+e[9]*f+e[10]*p+e[11],t},y.transformQuat=function(t,e,i){var n=i.w*e.x+i.y*e.z-i.z*e.y,r=i.w*e.y+i.z*e.x-i.x*e.z,s=i.w*e.z+i.x*e.y-i.y*e.x,e=-i.x*e.x-i.y*e.y-i.z*e.z;return t.x=n*i.w+e*-i.x+r*-i.z-s*-i.y,t.y=r*i.w+e*-i.y+s*-i.x-n*-i.z,t.z=s*i.w+e*-i.z+n*-i.y-r*-i.x,t},y.transformRTS=function(t,e,i,n,r){var s=e.x*r.x,a=e.y*r.y,e=e.z*r.z,r=i.w*s+i.y*e-i.z*a,o=i.w*a+i.z*s-i.x*e,l=i.w*e+i.x*a-i.y*s,s=-i.x*s-i.y*a-i.z*e;return t.x=r*i.w+s*-i.x+o*-i.z-l*-i.y+n.x,t.y=o*i.w+s*-i.y+l*-i.x-r*-i.z+n.y,t.z=l*i.w+s*-i.z+r*-i.y-o*-i.x+n.z,t},y.transformInverseRTS=function(t,e,i,n,r){var s=e.x-n.x,a=e.y-n.y,e=e.z-n.z,n=i.w*s-i.y*e+i.z*a,o=i.w*a-i.z*s+i.x*e,l=i.w*e-i.x*a+i.y*s,s=i.x*s+i.y*a+i.z*e;return t.x=(n*i.w+s*i.x+o*i.z-l*i.y)/r.x,t.y=(o*i.w+s*i.y+l*i.x-n*i.z)/r.y,t.z=(l*i.w+s*i.z+n*i.y-o*i.x)/r.z,t},y.rotateX=function(t,e,i,n){d=e.x-i.x,f=e.y-i.y,p=e.z-i.z;var e=Math.cos(n),n=Math.sin(n),r=d,s=f*e-p*n,n=f*n+p*e;return t.x=r+i.x,t.y=s+i.y,t.z=n+i.z,t},y.rotateY=function(t,e,i,n){d=e.x-i.x,f=e.y-i.y,p=e.z-i.z;var e=Math.cos(n),n=Math.sin(n),r=p*n+d*e,s=f,e=p*e-d*n;return t.x=r+i.x,t.y=s+i.y,t.z=e+i.z,t},y.rotateZ=function(t,e,i,n){d=e.x-i.x,f=e.y-i.y,p=e.z-i.z;var e=Math.cos(n),n=Math.sin(n),r=d*e-f*n,n=d*n+f*e,e=p;return t.x=r+i.x,t.y=n+i.y,t.z=e+i.z,t},y.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},y.equals=function(t,e,i){void 0===i&&(i=o.EPSILON);var n=t.x,r=t.y,t=t.z,s=e.x,a=e.y,e=e.z;return Math.abs(n-s)<=i*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=i*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(t-e)<=i*Math.max(1,Math.abs(t),Math.abs(e))},y.angle=function(t,e){y.normalize(g,t),y.normalize(v,e);t=y.dot(g,v);return 1<t?0:t<-1?Math.PI:Math.acos(t)},y.projectOnPlane=function(t,e,i){return y.subtract(t,e,y.project(t,e,i))},y.project=function(t,e,i){var n=y.lengthSqr(i);return n<1e-6?y.set(t,0,0,0):y.multiplyScalar(t,i,y.dot(e,i)/n)},y.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t},y.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t},t=y,_=[{key:"ONE",get:function(){return new y(1,1,1)}},{key:"ZERO",get:function(){return new y}},{key:"UP",get:function(){return new y(0,1,0)}},{key:"RIGHT",get:function(){return new y(1,0,0)}},{key:"FORWARD",get:function(){return new y(0,0,1)}}],(u=null)&&h(t.prototype,u),_&&h(t,_),n.clone=function(){return new y(this.x,this.y,this.z)},n.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},n.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e&&this.z-e<=t.z&&t.z<=this.z+e},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(t,e,i){return i=i||new y,y.lerp(i,this,t,e),i},n.clampf=function(t,e){return this.x=s.default.clampf(this.x,t.x,e.x),this.y=s.default.clampf(this.y,t.y,e.y),this.z=s.default.clampf(this.z,t.z,e.z),this},n.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.add=function(t,e){return(e=e||new y).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},n.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.cross=function(t,e){return e=e||new y,y.cross(e,this,t),e},n.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalizeSelf=function(){return y.normalize(this,this),this},n.normalize=function(t){return t=t||new y,y.normalize(t,this),t},n.transformMat4=function(t,e){return e=e||new y,y.transformMat4(e,this,t),e},n.maxAxis=function(){return Math.max(this.x,this.y,this.z)},n.signAngle=function(t){cc.warnID(1408,"vec3.signAngle","v2.1","cc.v2(selfVector).signAngle(vector)");var e=new a.default(this.x,this.y),t=new a.default(t.x,t.y);return e.signAngle(t)},n.rotate=function(t,e){return cc.warnID(1408,"vec3.rotate","v2.1","cc.v2(selfVector).rotate(radians, out)"),a.default.prototype.rotate.call(this,t,e)},n.rotateSelf=function(t){return cc.warnID(1408,"vec3.rotateSelf","v2.1","cc.v2(selfVector).rotateSelf(radians)"),a.default.prototype.rotateSelf.call(this,t)},y);function y(t,e,i){var n;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),(n=c.call(this)||this).mag=y.prototype.len,n.magSqr=y.prototype.lengthSqr,n.subSelf=y.prototype.subtract,n.mulSelf=y.prototype.multiplyScalar,n.divSelf=y.prototype.divide,n.scaleSelf=y.prototype.multiply,n.negSelf=y.prototype.negate,n.x=void 0,n.y=void 0,n.z=void 0,n.angle=a.default.prototype.angle,n.project=a.default.prototype.project,t&&"object"==typeof t?(n.z=t.z,n.y=t.y,n.x=t.x):(n.x=t,n.y=e,n.z=i),n}(i.default=m).sub=m.subtract,m.mul=m.multiply,m.scale=m.multiplyScalar,m.mag=m.len,m.squaredMagnitude=m.lengthSqr,m.div=m.divide,m.ONE_R=m.ONE,m.ZERO_R=m.ZERO,m.UP_R=m.UP,m.RIGHT_R=m.RIGHT,m.FRONT_R=m.FORWARD;var g=new m,v=new m;r.default.fastDefine("cc.Vec3",m,{x:0,y:0,z:0}),cc.v3=function(t,e,i){return new m(t,e,i)},cc.Vec3=m,e.exports=i.default},{"../platform/CCClass":230,"../utils/misc":315,"./utils":337,"./value-type":338,"./vec2":339}],341:[function(t,e,i){"use strict";i.__esModule=!0,i.v4=y,i.default=void 0;var n=a(t("../platform/CCClass")),r=a(t("./value-type")),s=t("./utils");function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l,h,c,u=0,_=0,d=0,f=0,p=(l=r.default,t=l,(r=m).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,(r=m.prototype).sub=function(t,e){return m.subtract(e||new m,this,t)},r.mul=function(t,e){return m.multiplyScalar(e||new m,this,t)},r.div=function(t,e){return m.multiplyScalar(e||new m,this,1/t)},r.scale=function(t,e){return m.multiply(e||new m,this,t)},r.neg=function(t){return m.negate(t||new m,this)},m.clone=function(t){return new m(t.x,t.y,t.z,t.w)},m.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},m.set=function(t,e,i,n,r){return t.x=e,t.y=i,t.z=n,t.w=r,t},m.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t.w=e.w+i.w,t},m.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t.w=e.w-i.w,t},m.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t.w=e.w*i.w,t},m.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t.w=e.w/i.w,t},m.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t},m.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t},m.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t.w=Math.min(e.w,i.w),t},m.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t.w=Math.max(e.w,i.w),t},m.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t},m.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},m.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t.w=e.w+i.w*n,t},m.distance=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,e=e.w-t.w;return Math.sqrt(i*i+n*n+r*r+e*e)},m.squaredDistance=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,e=e.w-t.w;return i*i+n*n+r*r+e*e},m.len=function(t){return u=t.x,_=t.y,d=t.z,f=t.w,Math.sqrt(u*u+_*_+d*d+f*f)},m.lengthSqr=function(t){return u=t.x,_=t.y,d=t.z,f=t.w,u*u+_*_+d*d+f*f},m.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},m.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t},m.inverseSafe=function(t,e){return u=e.x,_=e.y,d=e.z,f=e.w,Math.abs(u)<s.EPSILON?t.x=0:t.x=1/u,Math.abs(_)<s.EPSILON?t.y=0:t.y=1/_,Math.abs(d)<s.EPSILON?t.z=0:t.z=1/d,Math.abs(f)<s.EPSILON?t.w=0:t.w=1/f,t},m.normalize=function(t,e){u=e.x,_=e.y,d=e.z,f=e.w;e=u*u+_*_+d*d+f*f;return 0<e&&(e=1/Math.sqrt(e),t.x=u*e,t.y=_*e,t.z=d*e,t.w=f*e),t},m.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},m.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t.w=e.w+n*(i.w-e.w),t},m.random=function(t,e){e=e||1;var i=2*(0,s.random)()*Math.PI,n=2*(0,s.random)()-1,r=Math.sqrt(1-n*n);return t.x=r*Math.cos(i)*e,t.y=r*Math.sin(i)*e,t.z=n*e,t.w=0,t},m.transformMat4=function(t,e,i){u=e.x,_=e.y,d=e.z,f=e.w;e=i.m;return t.x=e[0]*u+e[4]*_+e[8]*d+e[12]*f,t.y=e[1]*u+e[5]*_+e[9]*d+e[13]*f,t.z=e[2]*u+e[6]*_+e[10]*d+e[14]*f,t.w=e[3]*u+e[7]*_+e[11]*d+e[15]*f,t},m.transformAffine=function(t,e,i){u=e.x,_=e.y,d=e.z,f=e.w;i=i.m;return t.x=i[0]*u+i[1]*_+i[2]*d+i[3]*f,t.y=i[4]*u+i[5]*_+i[6]*d+i[7]*f,t.x=i[8]*u+i[9]*_+i[10]*d+i[11]*f,t.w=e.w,t},m.transformQuat=function(t,e,i){var n=e.x,r=e.y,s=e.z,i=(u=i.x,_=i.y,d=i.z,(f=i.w)*n+_*s-d*r),a=f*r+d*n-u*s,o=f*s+u*r-_*n,n=-u*n-_*r-d*s;return t.x=i*f+n*-u+a*-d-o*-_,t.y=a*f+n*-_+o*-u-i*-d,t.z=o*f+n*-d+i*-_-a*-u,t.w=e.w,t},m.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},m.equals=function(t,e,i){return void 0===i&&(i=s.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))},m.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},m.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},t=m,c=[{key:"ZERO",get:function(){return new m(0,0,0,0)}},{key:"ONE",get:function(){return new m(1,1,1,1)}},{key:"NEG_ONE",get:function(){return new m(-1,-1,-1,-1)}}],(h=null)&&o(t.prototype,h),c&&o(t,c),r.clone=function(){return new m(this.x,this.y,this.z,this.w)},r.set=function(t,e,i,n){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0),this},r.equals=function(t,e){return void 0===e&&(e=s.EPSILON),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},r.equals4f=function(t,e,i,n,r){return void 0===r&&(r=s.EPSILON),Math.abs(this.x-t)<=r*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=r*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-i)<=r*Math.max(1,Math.abs(this.z),Math.abs(i))&&Math.abs(this.w-n)<=r*Math.max(1,Math.abs(this.w),Math.abs(n))},r.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},r.strictEquals4f=function(t,e,i,n){return this.x===t&&this.y===e&&this.z===i&&this.w===n},r.lerp=function(t,e){return u=this.x,_=this.y,d=this.z,f=this.w,this.x=u+e*(t.x-u),this.y=_+e*(t.y-_),this.z=d+e*(t.z-d),this.w=f+e*(t.w-f),this},r.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},r.clampf=function(t,e){return this.x=(0,s.clamp)(this.x,t.x,e.x),this.y=(0,s.clamp)(this.y,t.y,e.y),this.z=(0,s.clamp)(this.z,t.z,e.z),this.w=(0,s.clamp)(this.w,t.w,e.w),this},r.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},r.add=function(t,e){return(e=e||new m).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e.w=this.w+t.w,e},r.subtract=function(t,e){return(e=e||new m).x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e.w=this.w-t.w,e},r.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},r.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},r.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},r.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},r.cross=function(t,e){e=e||new m;var i=this.x,n=this.y,r=this.z,s=t.x,a=t.y,t=t.z;return e.x=n*t-r*a,e.y=r*s-i*t,e.z=i*a-n*s,e},r.len=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return Math.sqrt(t*t+e*e+i*i+n*n)},r.lengthSqr=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return t*t+e*e+i*i+n*n},r.normalizeSelf=function(){return this.normalize(this),this},r.normalize=function(t){t=t||new m,u=this.x,_=this.y,d=this.z,f=this.w;var e=u*u+_*_+d*d+f*f;return 0<e&&(e=1/Math.sqrt(e),t.x=u*e,t.y=_*e,t.z=d*e,t.w=f*e),t},r.transformMat4=function(t,e){e=e||new m,u=this.x,_=this.y,d=this.z,f=this.w;t=t.m;return e.x=t[0]*u+t[4]*_+t[8]*d+t[12]*f,e.y=t[1]*u+t[5]*_+t[9]*d+t[13]*f,e.z=t[2]*u+t[6]*_+t[10]*d+t[14]*f,e.w=t[3]*u+t[7]*_+t[11]*d+t[15]*f,e},r.maxAxis=function(){return Math.max(this.x,this.y,this.z,this.w)},m);function m(t,e,i,n){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),(r=l.call(this)||this).mag=m.prototype.len,r.magSqr=m.prototype.lengthSqr,r.subSelf=m.prototype.subtract,r.mulSelf=m.prototype.multiplyScalar,r.divSelf=m.prototype.divide,r.scaleSelf=m.prototype.multiply,r.negSelf=m.prototype.negate,r.x=void 0,r.y=void 0,r.z=void 0,r.w=void 0,t&&"object"==typeof t?(r.w=t.w,r.z=t.z,r.y=t.y,r.x=t.x):(r.x=t,r.y=e,r.z=i,r.w=n),r}function y(t,e,i,n){return new p(t,e,i,n)}(i.default=p).sub=p.subtract,p.mul=p.multiply,p.div=p.divide,p.scale=p.multiplyScalar,p.mag=p.len,p.squaredMagnitude=p.lengthSqr,p.ZERO_R=p.ZERO,p.ONE_R=p.ONE,p.NEG_ONE_R=p.NEG_ONE,n.default.fastDefine("cc.Vec4",p,{x:0,y:0,z:0,w:0}),cc.v4=y,cc.Vec4=p},{"../platform/CCClass":230,"./utils":337,"./value-type":338}],342:[function(t,e,i){"use strict";cc.js},{}],343:[function(t,e,i){"use strict";t("./core/CCGame"),t("./actions")},{"./actions":7,"./core/CCGame":71}],344:[function(t,e,i){"use strict";function n(t){var e,i,n,r,s,a,o,l,h,c;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},n=null;;){switch(e=this.readUInt32(),s=function(){for(var t=[],e=0;e<4;++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":n&&this.animation.frames.push(n),this.pos+=4,n={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},o=this.readUInt16(),r=this.readUInt16()||100,n.delay=1e3*o/r,n.disposeOp=this.data[this.pos++],n.blendOp=this.data[this.pos++],n.data=[];break;case"IDAT":case"fdAT":for("fdAT"===s&&(this.pos+=4,e-=4),t=(null!=n?n.data:void 0)||this.imgData,l=0;0<=e?l<e:e<l;0<=e?++l:--l)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),0<(a=255-this.transparency.indexed.length))for(h=0;0<=a?h<a:a<h;0<=a?++h:--h)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":r=(o=this.read(e)).indexOf(0),c=String.fromCharCode.apply(String,o.slice(0,r)),this.text[c]=String.fromCharCode.apply(String,o.slice(r+1));break;case"IEND":return n&&this.animation.frames.push(n),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(c=this.colorType)||6===c,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error(C.getError(6017))}}var A=t("../compression/zlib.min"),C=t("../core/CCDebug");n.prototype={constructor:n,read:function(t){for(var e=[],i=0;0<=t?i<t:t<i;0<=t?++i:--i)e.push(this.data[this.pos++]);return e},readUInt32:function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},readUInt16:function(){return this.data[this.pos++]<<8|this.data[this.pos++]},decodePixels:function(t){var e,i,n,r,s,a,o,l,h,c,u,_,d,f,p,m,y,g,v,b,x;if(0===(t=null==t?this.imgData:t).length)return new Uint8Array(0);for(t=new A.Inflate(t,{index:0,verify:!1}).decompress(),f=(c=this.pixelBitlength/8)*this.width,u=new Uint8Array(f*this.height),a=t.length,i=_=d=0;_<a;){switch(t[_++]){case 0:for(r=y=0;y<f;r=y+=1)u[i++]=t[_++];break;case 1:for(r=g=0;g<f;r=g+=1)e=t[_++],s=r<c?0:u[i-c],u[i++]=(e+s)%256;break;case 2:for(r=v=0;v<f;r=v+=1)e=t[_++],n=(r-r%c)/c,p=d&&u[(d-1)*f+n*c+r%c],u[i++]=(p+e)%256;break;case 3:for(r=b=0;b<f;r=b+=1)e=t[_++],n=(r-r%c)/c,s=r<c?0:u[i-c],p=d&&u[(d-1)*f+n*c+r%c],u[i++]=(e+Math.floor((s+p)/2))%256;break;case 4:for(r=x=0;x<f;r=x+=1)e=t[_++],n=(r-r%c)/c,s=r<c?0:u[i-c],0===d?p=m=0:(p=u[(d-1)*f+n*c+r%c],m=n&&u[(d-1)*f+(n-1)*c+r%c]),h=s+p-m,o=Math.abs(h-s),l=Math.abs(h-p),h=Math.abs(h-m),u[i++]=(e+(o<=l&&o<=h?s:l<=h?p:m))%256;break;default:throw new Error(C.getError(6018,t[_-1]))}d++}return u},copyToImageData:function(t,e){var i,n,r,s,a,o,l,h,c=this.colors,u=null,_=this.hasAlphaChannel;if(this.palette.length&&(u=null!=(h=this._decodedPalette)?h:this._decodedPalette=this.decodePalette(),c=4,_=!0),o=(i=t.data||t).length,r=u||e,n=s=0,1===c)for(;n<o;)a=u?4*e[n/4]:s,l=r[a++],i[n++]=l,i[n++]=l,i[n++]=l,i[n++]=_?r[a++]:255,s=a;else for(;n<o;)a=u?4*e[n/4]:s,i[n++]=r[a++],i[n++]=r[a++],i[n++]=r[a++],i[n++]=_?r[a++]:255,s=a},decodePalette:function(){for(var t,e,i=this.palette,n=this.transparency.indexed||[],r=new Uint8Array((n.length||0)+i.length),s=0,a=0,o=t=0,l=i.length;t<l;o=t+=3)r[s++]=i[o],r[s++]=i[o+1],r[s++]=i[o+2],r[s++]=null!=(e=n[a++])?e:255;return r},render:function(t){var e;return t.width=this.width,t.height=this.height,e=(t=t.getContext("2d")).createImageData(this.width,this.height),this.copyToImageData(e,this.decodePixels()),t.putImageData(e,0,0)}},e.exports=n},{"../compression/zlib.min":25,"../core/CCDebug":69}],345:[function(t,e,i){"use strict";var n=t("../core/assets/CCAsset"),t=t("../core/assets/CCSpriteFrame"),n=cc.Class({name:"cc.ParticleAsset",extends:n,properties:{spriteFrame:{default:null,type:t}}});cc.ParticleAsset=e.exports=n},{"../core/assets/CCAsset":76,"../core/assets/CCSpriteFrame":89}],346:[function(t,e,i){"use strict";var a=t("../core/platform/CCMacro"),n=t("./CCParticleAsset"),r=t("../core/components/CCRenderComponent"),o=t("../compression/ZipUtils"),l=t("./CCPNGReader"),h=t("./CCTIFFReader"),c=t("../core/utils/texture-util"),s=(t("../core/renderer/render-flow"),t("./particle-simulator")),u=(t("../core/assets/material/CCMaterial"),t("../core/utils/blend-func"));var _=cc.Enum({GRAVITY:0,RADIUS:1}),d=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),t={preview:{default:!0,editorOnly:!0,notify:!1,animatable:!1,tooltip:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())},animatable:!1,tooltip:!1},_file:{default:null,type:n},file:{get:function(){return this._file},set:function(t,e){this._file!==t&&((this._file=t)?this._applyFile():this.custom=!0)},animatable:!1,type:n,tooltip:!1},_spriteFrame:{default:null,type:cc.SpriteFrame},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){var i=this._renderSpriteFrame;i!==t&&((this._renderSpriteFrame=t)&&!t._uuid||(this._spriteFrame=t),(i&&i.getTexture())!==(t&&t.getTexture())&&this._applySpriteFrame(i))},type:cc.SpriteFrame,tooltip:!1},_texture:{default:null,type:cc.Texture2D,editorOnly:!0},texture:{get:function(){return this._getTexture()},set:function(t){t&&cc.warnID(6017)},type:cc.Texture2D,tooltip:!1,readonly:!0,visible:!1,animatable:!1},particleCount:{visible:!1,get:function(){return this._simulator.particles.length},readonly:!0},_stopped:!0,stopped:{get:function(){return this._stopped},animatable:!1,visible:!1},playOnLoad:!0,autoRemoveOnFinish:{default:!1,animatable:!1,tooltip:!1},active:{get:function(){return this._simulator.active},visible:!1},totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,_startColor:null,startColor:{type:cc.Color,get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},_startColorVar:null,startColorVar:{type:cc.Color,get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},_endColor:null,endColor:{type:cc.Color,get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},_endColorVar:null,endColorVar:{type:cc.Color,get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.Vec2.ZERO,posVar:cc.Vec2.ZERO,_positionType:{default:d.FREE,formerlySerializedAs:"positionType"},positionType:{type:d,get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},emitterMode:{default:_.GRAVITY,type:_},gravity:cc.Vec2.ZERO,speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},n=cc.Class({name:"cc.ParticleSystem",extends:r,mixins:[u],editor:!1,ctor:function(){this.initProperties()},initProperties:function(){this._previewTimer=null,this._focused=!1,this._aspectRatio=1,this._simulator=new s(this),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(0,0,0,0),this._endColor=cc.color(255,255,255,0),this._endColorVar=cc.color(0,0,0,0),this._renderSpriteFrame=null},properties:t,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:_,PositionType:d,_PNGReader:l,_TIFFReader:h},onFocusInEditor:!1,onLostFocusInEditor:!1,_startPreview:!1,_stopPreview:!1,_convertTextureToSpriteFrame:!1,__preload:function(){this._super(),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame(this.spriteFrame):!this._file||this._custom&&this._getTexture()||this._applyFile(),this.playOnLoad&&this.resetSystem()},onDestroy:function(){this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._buffer&&(this._buffer.destroy(),this._buffer=null),this._simulator._uvFilled=0,this._super()},lateUpdate:function(t){this._simulator.finished||this._simulator.step(t)},addParticle:function(){},stopSystem:function(){this._stopped=!0,this._simulator.stop()},resetSystem:function(){this._stopped=!1,this._simulator.reset(),this.markForRender(!0)},isFull:function(){return this.particleCount>=this.totalParticles},setTextureWithRect:function(t,e){t instanceof cc.Texture2D&&(this.spriteFrame=new cc.SpriteFrame(t,e))},_applyFile:function(){var i,n=this._file;n&&(i=this,cc.loader.load(n.nativeUrl,function(t,e){!t&&e?i.isValid&&(i._plistFile=n.nativeUrl,i._custom||i._initWithDictionary(e),i._spriteFrame?!i._renderSpriteFrame&&i._spriteFrame&&i._applySpriteFrame(i.spriteFrame):n.spriteFrame?i.spriteFrame=n.spriteFrame:i._custom&&i._initTextureWithDictionary(e)):cc.errorID(6029)}))},_initTextureWithDictionary:function(i){var t=cc.path.changeBasename(this._plistFile,i.textureFileName||"");if(i.textureFileName)c.loadImage(t,function(t,e){t?(i.textureFileName=void 0,this._initTextureWithDictionary(i)):this.spriteFrame=new cc.SpriteFrame(e)},this);else if(i.textureImageData){var e=i.textureImageData;if(!(e&&0<e.length))return!1;var n=cc.loader.getRes(t);if(!n){e=o.unzipBase64AsArray(e,1);if(!e)return cc.logID(6030),!1;var r=8<(r=e).length&&137===r[0]&&80===r[1]&&78===r[2]&&71===r[3]&&13===r[4]&&10===r[5]&&26===r[6]&&10===r[7]?a.ImageFormat.PNG:2<r.length&&(73===r[0]&&73===r[1]||77===r[0]&&77===r[1]||255===r[0]&&216===r[1])?a.ImageFormat.TIFF:a.ImageFormat.UNKNOWN;if(r!==a.ImageFormat.TIFF&&r!==a.ImageFormat.PNG)return cc.logID(6031),!1;var s=document.createElement("canvas");r===a.ImageFormat.PNG?new l(e).render(s):h.parseTIFF(e,s),n=c.cacheImage(t,s)}n||cc.logID(6032),this.spriteFrame=new cc.SpriteFrame(n)}return!0},_initWithDictionary:function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate,e=(this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this.srcBlendFactor=parseInt(t.blendFuncSource||a.SRC_ALPHA),this.dstBlendFactor=parseInt(t.blendFuncDestination||a.ONE_MINUS_SRC_ALPHA),this._startColor),e=(e.r=255*parseFloat(t.startColorRed||0),e.g=255*parseFloat(t.startColorGreen||0),e.b=255*parseFloat(t.startColorBlue||0),e.a=255*parseFloat(t.startColorAlpha||0),this._startColorVar),e=(e.r=255*parseFloat(t.startColorVarianceRed||0),e.g=255*parseFloat(t.startColorVarianceGreen||0),e.b=255*parseFloat(t.startColorVarianceBlue||0),e.a=255*parseFloat(t.startColorVarianceAlpha||0),this._endColor),e=(e.r=255*parseFloat(t.finishColorRed||0),e.g=255*parseFloat(t.finishColorGreen||0),e.b=255*parseFloat(t.finishColorBlue||0),e.a=255*parseFloat(t.finishColorAlpha||0),this._endColorVar);if(e.r=255*parseFloat(t.finishColorVarianceRed||0),e.g=255*parseFloat(t.finishColorVarianceGreen||0),e.b=255*parseFloat(t.finishColorVarianceBlue||0),e.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:d.RELATIVE),this.sourcePos.x=0,this.sourcePos.y=0,this.posVar.x=parseFloat(t.sourcePositionVariancex||0),this.posVar.y=parseFloat(t.sourcePositionVariancey||0),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||_.GRAVITY),this.emitterMode===_.GRAVITY){this.gravity.x=parseFloat(t.gravityx||0),this.gravity.y=parseFloat(t.gravityy||0),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);e=t.rotationIsDir||"";null!==e?(e=e.toString().toLowerCase(),this.rotationIsDir="true"===e||"1"===e):this.rotationIsDir=!1}else{if(this.emitterMode!==_.RADIUS)return cc.warnID(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},_validateRender:function(){var t=this._getTexture();t&&t.loaded?this._super():this.disableRender()},_onTextureLoaded:function(){this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this.markForRender(!0)},_syncAspect:function(){var t=this._renderSpriteFrame._rect;this._aspectRatio=t.width/t.height},_applySpriteFrame:function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame&&(this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.onTextureLoaded(this._onTextureLoaded,this))},_getTexture:function(){return this._renderSpriteFrame&&this._renderSpriteFrame.getTexture()||this._texture},_updateMaterial:function(){var t=this.getMaterial(0);t&&(t.define("CC_USE_MODEL",this._positionType!==d.FREE),t.setProperty("texture",this._getTexture()),u.prototype._updateMaterial.call(this))},_finishedSimulation:function(){this.resetSystem(),this.stopSystem(),this.disableRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()}});cc.ParticleSystem=e.exports=n},{"../compression/ZipUtils":22,"../core/assets/material/CCMaterial":95,"../core/components/CCRenderComponent":131,"../core/platform/CCMacro":235,"../core/renderer/render-flow":263,"../core/utils/blend-func":308,"../core/utils/texture-util":323,"./CCPNGReader":344,"./CCParticleAsset":345,"./CCTIFFReader":347,"./particle-simulator":349,"fire-url":void 0}],347:[function(t,e,i){"use strict";var tt=t("../core/CCDebug");e.exports={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(tt.getError(6019));this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError(tt.getError(6020));return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(cc.logID(6021,t),"Tag"+t)},getFieldTypeLength:function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:null},getFieldValues:function(t,e,i,n){var r=[],s=this.getFieldTypeLength(e);if(s*i<=4)!1===this.littleEndian?r.push(n>>>8*(4-s)):r.push(n);else for(var a=0;a<i;a++){var o=s*a;8<=s?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(r.push(this.getUint32(n+o)),r.push(this.getUint32(n+o+4))):cc.logID(8e3):r.push(this.getBytes(s,n+o))}return"ASCII"===e&&r.forEach(function(t,e,i){i[e]=String.fromCharCode(t)}),r},getBytes:function(t,e){if(!(t<=0))return t<=1?this.getUint8(e):t<=2?this.getUint16(e):t<=3?this.getUint32(e)>>>8:t<=4?this.getUint32(e):void cc.logID(8002);cc.logID(8001)},getBits:function(t,e,i){i=i||0;var n,r,e=e+Math.floor(i/8),s=i+t,t=32-t;return s<=0?cc.logID(6023):s<=8?(n=24+i,r=this.getUint8(e)):s<=16?(n=16+i,r=this.getUint16(e)):s<=32?(n=i,r=this.getUint32(e)):cc.logID(6022),{bits:r<<n>>>t,byteOffset:e+Math.floor(s/8),bitOffset:s%8}},parseFileDirectory:function(t){for(var e=this.getUint16(t),i=[],n=t+2,r=0;r<e;n+=12,r++){var s=this.getUint16(n),a=this.getUint16(n+2),o=this.getUint32(n+4),l=this.getUint32(n+8),s=this.getFieldTagName(s),a=this.getFieldTypeName(a),o=this.getFieldValues(s,a,o,l);i[s]={type:a,values:o}}this._fileDirectories.push(i);t=this.getUint32(n);0!==t&&this.parseFileDirectory(t)},clampColorSample:function(t,e){e=Math.pow(2,8-e);return Math.floor(t*e+(e-1))},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){var i,t=this.getUint32(4),t=(this._fileDirectories.length=0,this.parseFileDirectory(t),this._fileDirectories[0]),n=t.ImageWidth.values[0],r=t.ImageLength.values[0],s=(this.canvas.width=n,this.canvas.height=r,[]),F=t.Compression?t.Compression.values[0]:1,a=t.SamplesPerPixel.values[0],o=[],l=0,h=!1,c=(t.BitsPerSample.values.forEach(function(t,e,i){o[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(o[e].hasBytesPerSample=!0,o[e].bytesPerSample=t/8),l+=t},this),l%8==0&&(h=!0,i=l/8),t.StripOffsets.values),V=c.length;if(t.StripByteCounts)var N=t.StripByteCounts.values;else{if(cc.logID(8003),1!==V)throw Error(tt.getError(6024));N=[Math.ceil(n*r*l/8)]}for(var u=0;u<V;u++){var _=c[u];s[u]=[];for(var k=N[u],d=0,z=0,f=1,p=!0,m=[],y=0,g=0,v=0;d<k;d+=f)switch(F){case 1:for(var b=0,m=[];b<a;b++){if(!o[b].hasBytesPerSample)throw x=this.getBits(o[b].bitsPerSample,_+d,z),m.push(x.bits),d=x.byteOffset-_,z=x.bitOffset,RangeError(tt.getError(6025));var x=o[b].bytesPerSample*b;m.push(this.getBytes(o[b].bytesPerSample,_+d+x))}if(s[u].push(m),!h)throw f=0,RangeError(tt.getError(6026));f=i;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(p){var p=!1,G=1,U=1,A=this.getInt8(_+d);0<=A&&A<=127?G=A+1:-127<=A&&A<=-1?U=1-A:p=!0}else{for(var j=this.getUint8(_+d),b=0;b<U;b++){if(!o[g].hasBytesPerSample)throw RangeError(tt.getError(6025));v=v<<8*y|j,++y===o[g].bytesPerSample&&(m.push(v),v=y=0,g++),g===a&&(s[u].push(m),m=[],g=0)}0==--G&&(p=!0)}f=1}}if(e.getContext){var C,T,S=this.canvas.getContext("2d"),e=(S.fillStyle="rgba(255, 255, 255, 0)",t.RowsPerStrip?t.RowsPerStrip.values[0]:r),W=s.length,r=r%e,H=0==r?e:r,X=e,Y=0,q=t.PhotometricInterpretation.values[0],w=[],E=0;for(t.ExtraSamples&&(E=(w=t.ExtraSamples.values).length),t.ColorMap&&(C=t.ColorMap.values,T=Math.pow(2,o[0].bitsPerSample)),u=0;u<W;u++){u+1===W&&(X=H);for(var J=s[u].length,Z=Y*u,K=0,M=0;M<J;K++)for(var D=0;D<n;D++,M++){var Q,B=s[u][M],I=0,P=0,R=0,$=1;if(0<E)for(var O=0;O<E;O++)if(1===w[O]||2===w[O]){$=B[3+O]/256;break}switch(q){case 0:o[0].hasBytesPerSample&&(Q=Math.pow(16,2*o[0].bytesPerSample)),B.forEach(function(t,e,i){i[e]=Q-t});case 1:I=P=R=this.clampColorSample(B[0],o[0].bitsPerSample);break;case 2:I=this.clampColorSample(B[0],o[0].bitsPerSample),P=this.clampColorSample(B[1],o[1].bitsPerSample),R=this.clampColorSample(B[2],o[2].bitsPerSample);break;case 3:if(void 0===C)throw Error(tt.getError(6027));var L=B[0],I=this.clampColorSample(C[L],16),P=this.clampColorSample(C[T+L],16),R=this.clampColorSample(C[2*T+L],16);break;default:throw RangeError(tt.getError(6028,q))}S.fillStyle="rgba("+I+", "+P+", "+R+", "+$+")",S.fillRect(D,Z+K,1,1)}Y=X}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}}},{"../core/CCDebug":69}],348:[function(t,e,i){"use strict";t("./CCParticleAsset"),t("./CCParticleSystem"),t("./particle-simulator"),t("./particle-system-assembler")},{"./CCParticleAsset":345,"./CCParticleSystem":346,"./particle-simulator":349,"./particle-system-assembler":350}],349:[function(t,e,i){"use strict";function n(){this.pos=cc.v2(0,0),this.startPos=cc.v2(0,0),this.color=cc.color(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=cc.v2(0,0),this.aspectRatio=1,this.dir=cc.v2(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0}function r(t){this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this._uvFilled=0}var m=t("../core/utils/affine-transform"),s=t("../core/platform/js"),y=t("../core/utils/misc"),g=cc.v2(0,0),v=m.create(),b=cc.v2(),x=cc.v2(),A=cc.v2(),C=cc.v2(),T=new s.Pool(function(t){t.pos.set(g),t.startPos.set(g),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(g),t.aspectRatio=1,t.dir.set(g),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0},1024);T.get=function(){return this._get()||new n};r.prototype.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},r.prototype.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)T.put(t[e]);t.length=0},r.prototype.emitParticle=function(t){var e=this.sys,i=y.clampf,n=T.get();this.particles.push(n),n.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var r,s=n.timeToLive=Math.max(0,n.timeToLive),a=(n.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,n.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2,e._startColor),o=e._startColorVar,l=e._endColor,h=e._endColorVar,o=(n.color.r=r=i(a.r+o.r*(Math.random()-.5)*2,0,255),n.color.g=c=i(a.g+o.g*(Math.random()-.5)*2,0,255),n.color.b=u=i(a.b+o.b*(Math.random()-.5)*2,0,255),n.color.a=a=i(a.a+o.a*(Math.random()-.5)*2,0,255),n.deltaColor.r=(i(l.r+h.r*(Math.random()-.5)*2,0,255)-r)/s,n.deltaColor.g=(i(l.g+h.g*(Math.random()-.5)*2,0,255)-c)/s,n.deltaColor.b=(i(l.b+h.b*(Math.random()-.5)*2,0,255)-u)/s,n.deltaColor.a=(i(l.a+h.a*(Math.random()-.5)*2,0,255)-a)/s,e.startSize+e.startSizeVar*(Math.random()-.5)*2),o=Math.max(0,o),c=(n.size=o,e.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE?n.deltaSize=0:(r=e.endSize+e.endSizeVar*(Math.random()-.5)*2,r=Math.max(0,r),n.deltaSize=(r-o)/s),e.startSpin+e.startSpinVar*(Math.random()-.5)*2),u=e.endSpin+e.endSpinVar*(Math.random()-.5)*2,i=(n.rotation=c,n.deltaRotation=(u-c)/s,n.startPos.x=t.x,n.startPos.y=t.y,n.aspectRatio=e._aspectRatio||1,function(t){for(var e=0,i=t;i;)e+=i.angle,i=i.parent;return e}(e.node)),l=e.positionType===cc.ParticleSystem.PositionType.FREE?e.angle+i:e.angle,h=y.degreesToRadians(l+e.angleVar*(Math.random()-.5)*2);e.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY?(a=e.speed+e.speedVar*(Math.random()-.5)*2,n.dir.x=Math.cos(h),n.dir.y=Math.sin(h),n.dir.mulSelf(a),n.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,n.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(n.rotation=-y.radiansToDegrees(Math.atan2(n.dir.y,n.dir.x)))):(r=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,o=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2,n.radius=r,n.deltaRadius=e.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(o-r)/s,n.angle=h,n.degreesPerSecond=y.degreesToRadians(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2))},r.prototype.updateUVs=function(t){var e=this.sys._assembler;if(e){var i=e.getBuffer();if(i&&this.sys._renderSpriteFrame){for(var n=4*e._vfmt._bytes/4,r=i._vData,s=this.sys._renderSpriteFrame.uv,e=t?0:this._uvFilled,a=this.particles.length,o=e;o<a;o++){var l=o*n;r[2+l]=s[0],r[3+l]=s[1],r[7+l]=s[2],r[8+l]=s[3],r[12+l]=s[4],r[13+l]=s[5],r[17+l]=s[6],r[18+l]=s[7]}this._uvFilled=a}}},r.prototype.updateParticleBuffer=function(t,e,i,n){var r,s,a,o,l,h=i._vData,i=i._uintVData,c=e.x,e=e.y,u=t.size,_=u,d=t.aspectRatio,d=(1<d?_=u/d:u=_*d,u/2),u=_/2;t.rotation?(_=-d,r=-u,s=d,a=u,l=-y.degreesToRadians(t.rotation),o=Math.cos(l),l=Math.sin(l),h[n]=_*o-r*l+c,h[n+1]=_*l+r*o+e,h[n+5]=s*o-r*l+c,h[n+6]=s*l+r*o+e,h[n+10]=_*o-a*l+c,h[n+11]=_*l+a*o+e,h[n+15]=s*o-a*l+c,h[n+16]=s*l+a*o+e):(h[n]=c-d,h[n+1]=e-u,h[n+5]=c+d,h[n+6]=e-u,h[n+10]=c-d,h[n+11]=e+u,h[n+15]=c+d,h[n+16]=e+u),i[n+4]=t.color._val,i[n+9]=t.color._val,i[n+14]=t.color._val,i[n+19]=t.color._val},r.prototype.step=function(t){t=t>cc.director._maxParticleDeltaTime?cc.director._maxParticleDeltaTime:t;var e,i=this.sys,n=i.node,r=this.particles,s=4*this.sys._assembler._vfmt._bytes/4,a=(n._updateWorldMatrix(),v=m.identity(),i.positionType===cc.ParticleSystem.PositionType.FREE?(h=n._worldMatrix.m,v.tx=h[12],v.ty=h[13],m.transformVec2(b,g,v)):i.positionType===cc.ParticleSystem.PositionType.RELATIVE&&(h=y.degreesToRadians(-n.angle),e=Math.cos(h),h=Math.sin(h),v=m.create(e,-h,h,e,0,0),b.x=n.x,b.y=n.y),m.invert(v,v),v);if(this.active&&i.emissionRate){var o=1/i.emissionRate;for(r.length<i.totalParticles&&(this.emitCounter+=t);r.length<i.totalParticles&&this.emitCounter>o;)this.emitParticle(b),this.emitCounter-=o;this.elapsed+=t,-1!==i.duration&&i.duration<this.elapsed&&i.stopSystem()}var l=i._assembler.getBuffer(),h=r.length;l.reset(),l.request(4*h,6*h),h>this._uvFilled&&this.updateUVs();for(var c=0;c<r.length;){x.x=x.y=A.x=A.y=C.x=C.y=0;var u,_,d,f,p=r[c];p.timeToLive-=t,0<p.timeToLive?(i.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY?(f=C,_=x,d=A,(p.pos.x||p.pos.y)&&(_.set(p.pos),_.normalizeSelf()),d.set(_),_.mulSelf(p.radialAccel),u=d.x,d.x=-d.y,d.y=u,d.mulSelf(p.tangentialAccel),f.set(_),f.addSelf(d),f.addSelf(i.gravity),f.mulSelf(t),p.dir.addSelf(f),f.set(p.dir),f.mulSelf(t),p.pos.addSelf(f)):(p.angle+=p.degreesPerSecond*t,p.radius+=p.deltaRadius*t,p.pos.x=-Math.cos(p.angle)*p.radius,p.pos.y=-Math.sin(p.angle)*p.radius),p.color.r+=p.deltaColor.r*t,p.color.g+=p.deltaColor.g*t,p.color.b+=p.deltaColor.b*t,p.color.a+=p.deltaColor.a*t,p.size+=p.deltaSize*t,p.size<0&&(p.size=0),p.rotation+=p.deltaRotation*t,u=x,_=A,i.positionType===cc.ParticleSystem.PositionType.FREE?(_.set(p.startPos),_.negSelf(),u.set(p.pos),u.subSelf(_)):i.positionType===cc.ParticleSystem.PositionType.RELATIVE?(d=C,m.transformVec2(_,b,a),m.transformVec2(d,p.startPos,a),_.subSelf(d),u.set(p.pos),u.subSelf(_)):u.set(p.pos),this.updateParticleBuffer(p,u,l,s*c),++c):(f=r[c],c!==r.length-1&&(r[c]=r[r.length-1]),T.put(f),r.length--)}0<r.length?(l.uploadData(),i._assembler._ia._count=6*r.length):this.active||this.readyToPlay||(this.finished=!0,i._finishedSimulation())},e.exports=r},{"../core/platform/js":250,"../core/utils/affine-transform":305,"../core/utils/misc":315}],350:[function(t,e,i){"use strict";var n=s(t("../core/renderer/assembler")),r=s(t("../renderer/core/input-assembler"));function s(t){return t&&t.__esModule?t:{default:t}}var a,o,l=t("./CCParticleSystem"),h=t("../core/renderer/"),c=t("../core/renderer/webgl/quad-buffer"),u=t("../core/renderer/webgl/vertex-format").vfmtPosUvColor,t=(a=n.default,t=a,(o=_).prototype=Object.create(t.prototype),(o.prototype.constructor=o).__proto__=t,(o=_.prototype).getBuffer=function(){return this._buffer||(this._buffer=new c(h._handle,u),this._ia=new r.default,this._ia._vertexBuffer=this._buffer._vb,this._ia._indexBuffer=this._buffer._ib,this._ia._start=0,this._ia._count=0),this._buffer},o.fillBuffers=function(t,e){this._ia&&(e.node=t.node,e.material=t._materials[0],e._flushIA(this._ia))},_);function _(t){return(t=a.call(this,t)||this)._buffer=null,t._ia=null,t._vfmt=u,t}n.default.register(l,t),e.exports=t},{"../core/renderer/":262,"../core/renderer/assembler":259,"../core/renderer/webgl/quad-buffer":300,"../core/renderer/webgl/vertex-format":303,"../renderer/core/input-assembler":353,"./CCParticleSystem":346}],351:[function(t,e,i){"use strict";var n,r,s,a,o,l;function h(t){this._gfxType=n.UNKNOWN,this._status=r.UNREADY,this._gfxType=t}(u=n=n||{})[u.UNKNOWN=0]="UNKNOWN",u[u.BUFFER=1]="BUFFER",u[u.TEXTURE=2]="TEXTURE",u[u.TEXTURE_VIEW=3]="TEXTURE_VIEW",u[u.RENDER_PASS=4]="RENDER_PASS",u[u.FRAMEBUFFER=5]="FRAMEBUFFER",u[u.SAMPLER=6]="SAMPLER",u[u.SHADER=7]="SHADER",u[u.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",u[u.PIPELINE_STATE=9]="PIPELINE_STATE",u[u.BINDING_LAYOUT=10]="BINDING_LAYOUT",u[u.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",u[u.COMMAND_ALLOCATOR=12]="COMMAND_ALLOCATOR",u[u.COMMAND_BUFFER=13]="COMMAND_BUFFER",u[u.QUEUE=14]="QUEUE",u[u.WINDOW=15]="WINDOW",(u=r=r||{})[u.UNREADY=0]="UNREADY",u[u.FAILED=1]="FAILED",u[u.SUCCESS=2]="SUCCESS",Object.defineProperty(h.prototype,"gfxType",{get:function(){return this._gfxType},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),(u=s=s||{})[u.UNKNOWN=0]="UNKNOWN",u[u.BOOL=1]="BOOL",u[u.BOOL2=2]="BOOL2",u[u.BOOL3=3]="BOOL3",u[u.BOOL4=4]="BOOL4",u[u.INT=5]="INT",u[u.INT2=6]="INT2",u[u.INT3=7]="INT3",u[u.INT4=8]="INT4",u[u.UINT=9]="UINT",u[u.UINT2=10]="UINT2",u[u.UINT3=11]="UINT3",u[u.UINT4=12]="UINT4",u[u.FLOAT=13]="FLOAT",u[u.FLOAT2=14]="FLOAT2",u[u.FLOAT3=15]="FLOAT3",u[u.FLOAT4=16]="FLOAT4",u[u.COLOR4=17]="COLOR4",u[u.MAT2=18]="MAT2",u[u.MAT2X3=19]="MAT2X3",u[u.MAT2X4=20]="MAT2X4",u[u.MAT3X2=21]="MAT3X2",u[u.MAT3=22]="MAT3",u[u.MAT3X4=23]="MAT3X4",u[u.MAT4X2=24]="MAT4X2",u[u.MAT4X3=25]="MAT4X3",u[u.MAT4=26]="MAT4",u[u.SAMPLER1D=27]="SAMPLER1D",u[u.SAMPLER1D_ARRAY=28]="SAMPLER1D_ARRAY",u[u.SAMPLER2D=29]="SAMPLER2D",u[u.SAMPLER2D_ARRAY=30]="SAMPLER2D_ARRAY",u[u.SAMPLER3D=31]="SAMPLER3D",u[u.SAMPLER_CUBE=32]="SAMPLER_CUBE",u[u.COUNT=33]="COUNT",(u=_=_||{})[u.UNKNOWN=0]="UNKNOWN",u[u.A8=1]="A8",u[u.L8=2]="L8",u[u.LA8=3]="LA8",u[u.R8=4]="R8",u[u.R8SN=5]="R8SN",u[u.R8UI=6]="R8UI",u[u.R8I=7]="R8I",u[u.R16F=8]="R16F",u[u.R16UI=9]="R16UI",u[u.R16I=10]="R16I",u[u.R32F=11]="R32F",u[u.R32UI=12]="R32UI",u[u.R32I=13]="R32I",u[u.RG8=14]="RG8",u[u.RG8SN=15]="RG8SN",u[u.RG8UI=16]="RG8UI",u[u.RG8I=17]="RG8I",u[u.RG16F=18]="RG16F",u[u.RG16UI=19]="RG16UI",u[u.RG16I=20]="RG16I",u[u.RG32F=21]="RG32F",u[u.RG32UI=22]="RG32UI",u[u.RG32I=23]="RG32I",u[u.RGB8=24]="RGB8",u[u.SRGB8=25]="SRGB8",u[u.RGB8SN=26]="RGB8SN",u[u.RGB8UI=27]="RGB8UI",u[u.RGB8I=28]="RGB8I",u[u.RGB16F=29]="RGB16F",u[u.RGB16UI=30]="RGB16UI",u[u.RGB16I=31]="RGB16I",u[u.RGB32F=32]="RGB32F",u[u.RGB32UI=33]="RGB32UI",u[u.RGB32I=34]="RGB32I",u[u.RGBA8=35]="RGBA8",u[u.SRGB8_A8=36]="SRGB8_A8",u[u.RGBA8SN=37]="RGBA8SN",u[u.RGBA8UI=38]="RGBA8UI",u[u.RGBA8I=39]="RGBA8I",u[u.RGBA16F=40]="RGBA16F",u[u.RGBA16UI=41]="RGBA16UI",u[u.RGBA16I=42]="RGBA16I",u[u.RGBA32F=43]="RGBA32F",u[u.RGBA32UI=44]="RGBA32UI",u[u.RGBA32I=45]="RGBA32I",u[u.R5G6B5=46]="R5G6B5",u[u.R11G11B10F=47]="R11G11B10F",u[u.RGB5A1=48]="RGB5A1",u[u.RGBA4=49]="RGBA4",u[u.RGB10A2=50]="RGB10A2",u[u.RGB10A2UI=51]="RGB10A2UI",u[u.RGB9E5=52]="RGB9E5",u[u.D16=53]="D16",u[u.D16S8=54]="D16S8",u[u.D24=55]="D24",u[u.D24S8=56]="D24S8",u[u.D32F=57]="D32F",u[u.D32F_S8=58]="D32F_S8",u[u.BC1=59]="BC1",u[u.BC1_ALPHA=60]="BC1_ALPHA",u[u.BC1_SRGB=61]="BC1_SRGB",u[u.BC1_SRGB_ALPHA=62]="BC1_SRGB_ALPHA",u[u.BC2=63]="BC2",u[u.BC2_SRGB=64]="BC2_SRGB",u[u.BC3=65]="BC3",u[u.BC3_SRGB=66]="BC3_SRGB",u[u.BC4=67]="BC4",u[u.BC4_SNORM=68]="BC4_SNORM",u[u.BC5=69]="BC5",u[u.BC5_SNORM=70]="BC5_SNORM",u[u.BC6H_UF16=71]="BC6H_UF16",u[u.BC6H_SF16=72]="BC6H_SF16",u[u.BC7=73]="BC7",u[u.BC7_SRGB=74]="BC7_SRGB",u[u.ETC_RGB8=75]="ETC_RGB8",u[u.ETC2_RGB8=76]="ETC2_RGB8",u[u.ETC2_SRGB8=77]="ETC2_SRGB8",u[u.ETC2_RGB8_A1=78]="ETC2_RGB8_A1",u[u.ETC2_SRGB8_A1=79]="ETC2_SRGB8_A1",u[u.ETC2_RGBA8=80]="ETC2_RGBA8",u[u.ETC2_SRGB8_A8=81]="ETC2_SRGB8_A8",u[u.EAC_R11=82]="EAC_R11",u[u.EAC_R11SN=83]="EAC_R11SN",u[u.EAC_RG11=84]="EAC_RG11",u[u.EAC_RG11SN=85]="EAC_RG11SN",u[u.PVRTC_RGB2=86]="PVRTC_RGB2",u[u.PVRTC_RGBA2=87]="PVRTC_RGBA2",u[u.PVRTC_RGB4=88]="PVRTC_RGB4",u[u.PVRTC_RGBA4=89]="PVRTC_RGBA4",u[u.PVRTC2_2BPP=90]="PVRTC2_2BPP",u[u.PVRTC2_4BPP=91]="PVRTC2_4BPP",f=f||{},f[f.DEFAULT=100]="DEFAULT",(u=a=a||{})[u.MIN=0]="MIN",u[u.MAX=255]="MAX",u[u.DEFAULT=128]="DEFAULT",(u=o=o||{})[u.UBO_GLOBAL=23]="UBO_GLOBAL",u[u.UBO_SHADOW=22]="UBO_SHADOW",u[u.UBO_LOCAL=21]="UBO_LOCAL",u[u.UBO_FORWARD_LIGHTS=20]="UBO_FORWARD_LIGHTS",u[u.UBO_SKINNING=19]="UBO_SKINNING",u[u.UBO_SKINNING_TEXTURE=18]="UBO_SKINNING_TEXTURE",u[u.UBO_UI=17]="UBO_UI",u[u.SAMPLER_JOINTS=25]="SAMPLER_JOINTS",u[u.SAMPLER_ENVIRONMENT=26]="SAMPLER_ENVIRONMENT",u[u.CUSTUM_UBO_BINDING_END_POINT=17]="CUSTUM_UBO_BINDING_END_POINT",u[u.CUSTOM_SAMPLER_BINDING_START_POINT=30]="CUSTOM_SAMPLER_BINDING_START_POINT",(u=l=l||{})[u.minFilter=0]="minFilter",u[u.magFilter=1]="magFilter",u[u.mipFilter=2]="mipFilter",u[u.addressU=3]="addressU",u[u.addressV=4]="addressV",u[u.addressW=5]="addressW",u[u.maxAnisotropy=6]="maxAnisotropy",u[u.cmpFunc=7]="cmpFunc",u[u.minLOD=8]="minLOD",u[u.maxLOD=9]="maxLOD",u[u.mipLODBias=10]="mipLODBias",u[u.borderColor=11]="borderColor",u[u.total=15]="total";var c,u={},_=(u[u.bool=s.BOOL]="bool",u[u.int=s.INT]="int",u[u.ivec2=s.INT2]="ivec2invTypeParams",u[u.ivec3=s.INT3]="ivec3",u[u.ivec4=s.INT4]="ivec4",u[u.float=s.FLOAT]="float",u[u.vec2=s.FLOAT2]="vec2",u[u.vec3=s.FLOAT3]="vec3",u[u.vec4=s.FLOAT4]="vec4",u[u.mat2=s.MAT2]="mat2",u[u.mat3=s.MAT3]="mat3",u[u.mat4=s.MAT4]="mat4",u[u.sampler2D=s.SAMPLER2D]="sampler2D",u[u.samplerCube=s.SAMPLER_CUBE]="samplerCube",(c={})[s.BOOL]=4,c[s.INT]=4,c[s.INT2]=8,c[s.INT3]=12,c[s.INT4]=16,c[s.FLOAT]=4,c[s.FLOAT2]=8,c[s.FLOAT3]=12,c[s.FLOAT4]=16,c[s.MAT2]=16,c[s.MAT3]=36,c[s.MAT4]=64,c[s.SAMPLER2D]=4,c[s.SAMPLER_CUBE]=4,(d={})[s.BOOL]=_.R32I,d[s.INT]=_.R32I,d[s.INT2]=_.RG32I,d[s.INT3]=_.RGB32I,d[s.INT4]=_.RGBA32I,d[s.FLOAT]=_.R32F,d[s.FLOAT2]=_.RG32F,d[s.FLOAT3]=_.RGB32F,d[s.FLOAT4]=_.RGBA32F,d),d={BACK:1029,FRONT:1028,NONE:0,ADD:32774,SUB:32778,REV_SUB:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,SRC_ALPHA_SATURATE:776,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,INCR_WRAP:34055,DECR:7683,DECR_WRAP:34056,INVERT:5386},f=(Object.assign(d,f),{murmurhash2_32_gc:function(t,e){for(var i,n=t.length,r=e^n,s=0;4<=n;)i=1540483477*(65535&(i=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16),n-=4,++s;switch(n){case 3:r^=(255&t.charCodeAt(s+2))<<16;case 2:r^=(255&t.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return((r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16))^r>>>15)>>>0},SamplerInfoIndex:l,effectStructure:{$techniques:[{$passes:[{depthStencilState:{},rasterizerState:{},blendState:{targets:[{}]},properties:{any:{sampler:{},inspector:{}}}}]}]},typeMap:u,sizeMap:c,formatMap:_,passParams:d,RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderPriority:a,GFXGetTypeSize:function(t){switch(t){case s.BOOL:case s.INT:case s.UINT:case s.FLOAT:return 4;case s.BOOL2:case s.INT2:case s.UINT2:case s.FLOAT2:return 8;case s.BOOL3:case s.INT3:case s.UINT3:case s.FLOAT3:return 12;case s.BOOL4:case s.INT4:case s.UINT4:case s.FLOAT4:case s.MAT2:return 16;case s.MAT2X3:return 24;case s.MAT2X4:return 32;case s.MAT3X2:return 24;case s.MAT3:return 36;case s.MAT3X4:return 48;case s.MAT4X2:case s.MAT4X2:return 32;case s.MAT4:return 64;case s.SAMPLER1D:case s.SAMPLER1D_ARRAY:case s.SAMPLER2D:case s.SAMPLER2D_ARRAY:case s.SAMPLER3D:case s.SAMPLER_CUBE:return 4;default:return 0}},UniformBinding:o});e.exports=f},{}],352:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../memop"),y=a(t("../enums")),g=t("../../core/value-types"),r=a(t("./program-lib")),s=a(t("./view")),m=a(t("../gfx"));function a(t){return t&&t.__esModule?t:{default:t}}var v=new g.Mat4,b=new n.RecyclePool(function(){return{stage:null,items:null}},8),x=new n.RecyclePool(function(){return new Float32Array(2)},8),A=new n.RecyclePool(function(){return new Float32Array(3)},8),C=new n.RecyclePool(function(){return new Float32Array(4)},8),T=new n.RecyclePool(function(){return new Float32Array(9)},8),S=new n.RecyclePool(function(){return new Float32Array(16)},8),w=new n.RecyclePool(function(){return new Float32Array(64)},8),E=new n.RecyclePool(function(){return new Int32Array(2)},8),M=new n.RecyclePool(function(){return new Int32Array(3)},8),D=new n.RecyclePool(function(){return new Int32Array(4)},8),B=new n.RecyclePool(function(){return new Int32Array(64)},8);function o(t,e){this._device=t,this._programLib=new r.default(t),this._opts=e,this._type2defaultValue=((t={})[y.default.PARAM_INT]=0,t[y.default.PARAM_INT2]=new g.Vec2(0,0),t[y.default.PARAM_INT3]=new g.Vec3(0,0,0),t[y.default.PARAM_INT4]=new g.Vec4(0,0,0,0),t[y.default.PARAM_FLOAT]=0,t[y.default.PARAM_FLOAT2]=new g.Vec2(0,0),t[y.default.PARAM_FLOAT3]=new g.Vec3(0,0,0),t[y.default.PARAM_FLOAT4]=new g.Vec4(0,0,0,0),t[y.default.PARAM_COLOR4]=new g.Color(0,0,0,1),t[y.default.PARAM_MAT3]=new g.Mat3,t[y.default.PARAM_MAT4]=new g.Mat4,t[y.default.PARAM_TEXTURE_2D]=e.defaultTexture,t[y.default.PARAM_TEXTURE_CUBE]=e.defaultTextureCube,t),this._stage2fn={},this._usedTextureUnits=0,this._viewPools=new n.RecyclePool(function(){return new s.default},8),this._drawItemsPools=new n.RecyclePool(function(){return{model:null,node:null,ia:null,effect:null,defines:null,uniforms:null}},100),this._stageItemsPools=new n.RecyclePool(function(){return new n.RecyclePool(function(){return{model:null,node:null,ia:null,effect:null,defines:null,passes:[],sortKey:-1,uniforms:null}},100)},16)}(t=o.prototype)._resetTextuerUnit=function(){this._usedTextureUnits=0},t._allocTextureUnit=function(){var t=this._device,e=this._usedTextureUnits;return e>=t._caps.maxTextureUnits&&console.warn("Trying to use "+e+" texture units while this GPU supports only "+t._caps.maxTextureUnits),this._usedTextureUnits+=1,e},t._registerStage=function(t,e){this._stage2fn[t]=e},t.clear=function(){this._programLib.clear(),this.reset()},t.reset=function(){this._viewPools.reset(),this._stageItemsPools.reset()},t._requestView=function(){return this._viewPools.add()},t._render=function(t,e){var i=this._device,n=(i.setFrameBuffer(t._framebuffer),i.setViewport(t._rect.x,t._rect.y,t._rect.w,t._rect.h),{});t._clearFlags&y.default.CLEAR_COLOR&&(n.color=g.Vec4.toArray([],t._color)),t._clearFlags&y.default.CLEAR_DEPTH&&(n.depth=t._depth),t._clearFlags&y.default.CLEAR_STENCIL&&(n.stencil=t._stencil),i.clear(n),this._drawItemsPools.reset();for(var r=0;r<e._models.length;++r){var s,a=e._models.data[r];0!=(a._cullingMask&t._cullingMask)&&(s=this._drawItemsPools.add(),a.extractDrawItem(s))}b.reset();for(var o=0;o<t._stages.length;++o){var l=t._stages[o],h=this._stageItemsPools.add();h.reset();for(var c=0;c<this._drawItemsPools.length;++c){var u,_=this._drawItemsPools.data[c],d=_.effect.stagePasses[l];d&&0!==d.length&&((u=h.add()).passes=d,u.model=_.model,u.node=_.node,u.ia=_.ia,u.effect=_.effect,u.defines=_.defines,u.sortKey=-1,u.uniforms=_.uniforms)}var f=b.add();f.stage=l,f.items=h}for(var p=0;p<b.length;++p){var m=b.data[p];(0,this._stage2fn[m.stage])(t,m.items)}},t._setProperty=function(t){var e=this._device,i=t.value;if(void 0!==(i=void 0===(i=void 0===i?t.val:i)?this._type2defaultValue[t.type]:i))if(t.type===y.default.PARAM_TEXTURE_2D||t.type===y.default.PARAM_TEXTURE_CUBE)if(Array.isArray(i))if(i.length>t.count)console.error("Failed to set property ["+t.name+"] : The length of texture array ["+i.length+"] is bigger than ["+t.count+"].");else{for(var n=B.add(),r=0;r<i.length;++r)n[r]=this._allocTextureUnit();e.setTextureArray(t.name,i,n)}else e.setTexture(t.name,i,this._allocTextureUnit());else t.directly?e.setUniformDirectly(t.name,i):e.setUniform(t.name,i);else console.warn("Failed to set technique property "+t.name+", value not found.")},t._draw=function(t){var e=this._device,i=this._programLib,n=t.node,r=t.ia,s=t.passes,a=t.effect;x.reset(),A.reset(),C.reset(),T.reset(),S.reset(),w.reset(),E.reset(),M.reset(),D.reset(),B.reset(),n.getWorldMatrix(v),e.setUniform("cc_matWorld",g.Mat4.toArray(S.add(),v)),g.Mat4.invert(v,v),g.Mat4.transpose(v,v),e.setUniform("cc_matWorldIT",g.Mat4.toArray(S.add(),v));for(var o=this._defines,l=0;l<s.length;++l){var h=s[l],c=r.count,u=(r._vertexBuffer&&e.setVertexBuffer(0,r._vertexBuffer),r._indexBuffer&&e.setIndexBuffer(r._indexBuffer),e.setPrimitiveType(r._primitiveType),Object.setPrototypeOf(o,h._defines),i.getProgram(h._programName,o,a.name));e.setProgram(u);for(var _=u._uniforms,d=h._properties,f=0;f<_.length;f++){var p=d[_[f].name];void 0!==p&&this._setProperty(p)}e.setCullMode(h._cullMode),h._blend&&(e.enableBlend(),e.setBlendFuncSep(h._blendSrc,h._blendDst,h._blendSrcAlpha,h._blendDstAlpha),e.setBlendEqSep(h._blendEq,h._blendAlphaEq),e.setBlendColor32(h._blendColor)),h._depthTest&&(e.enableDepthTest(),e.setDepthFunc(h._depthFunc)),h._depthWrite&&e.enableDepthWrite(),e.setStencilTest(h._stencilTest),h._stencilTest===m.default.STENCIL_ENABLE&&(e.setStencilFuncFront(h._stencilFuncFront,h._stencilRefFront,h._stencilMaskFront),e.setStencilOpFront(h._stencilFailOpFront,h._stencilZFailOpFront,h._stencilZPassOpFront,h._stencilWriteMaskFront),e.setStencilFuncBack(h._stencilFuncBack,h._stencilRefBack,h._stencilMaskBack),e.setStencilOpBack(h._stencilFailOpBack,h._stencilZFailOpBack,h._stencilZPassOpBack,h._stencilWriteMaskBack)),e.draw(r._start,c),this._resetTextuerUnit()}},i.default=o,e.exports=i.default},{"../../core/value-types":330,"../enums":358,"../gfx":363,"../memop":375,"./program-lib":355,"./view":357}],353:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("../gfx"))&&t.__esModule?t:{default:t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t=o,(a=[{key:"count",get:function(){return-1!==this._count?this._count:this._indexBuffer?this._indexBuffer.count:this._vertexBuffer?this._vertexBuffer.count:0}}])&&r(t.prototype,a),s&&r(t,s);var s,a=o;function o(t,e,i){void 0===i&&(i=n.default.PT_TRIANGLES),this._vertexBuffer=t,this._indexBuffer=e,this._primitiveType=i,this._start=0,this._count=-1}i.default=a,e.exports=i.default},{"../gfx":363}],354:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var l=n(t("../gfx")),a=n(t("../enums")),o=n(t("../../core/value-types/value-type"));function n(t){return t&&t.__esModule?t:{default:t}}function h(t,e,i,n,r,s){void 0===r&&(r={}),void 0===s&&(s={}),this._name=t,this._detailName=e,this._programName=i,this._stage=n,this._properties=r,this._defines=s,this._cullMode=l.default.CULL_BACK,this._blend=!1,this._blendEq=l.default.BLEND_FUNC_ADD,this._blendAlphaEq=l.default.BLEND_FUNC_ADD,this._blendSrc=l.default.BLEND_SRC_ALPHA,this._blendDst=l.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendSrcAlpha=l.default.BLEND_SRC_ALPHA,this._blendDstAlpha=l.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendColor=4294967295,this._depthTest=!1,this._depthWrite=!1,this._depthFunc=l.default.DS_FUNC_LESS,this._stencilTest=l.default.STENCIL_INHERIT,this._stencilFuncFront=l.default.DS_FUNC_ALWAYS,this._stencilRefFront=0,this._stencilMaskFront=255,this._stencilFailOpFront=l.default.STENCIL_OP_KEEP,this._stencilZFailOpFront=l.default.STENCIL_OP_KEEP,this._stencilZPassOpFront=l.default.STENCIL_OP_KEEP,this._stencilWriteMaskFront=255,this._stencilFuncBack=l.default.DS_FUNC_ALWAYS,this._stencilRefBack=0,this._stencilMaskBack=255,this._stencilFailOpBack=l.default.STENCIL_OP_KEEP,this._stencilZFailOpBack=l.default.STENCIL_OP_KEEP,this._stencilZPassOpBack=l.default.STENCIL_OP_KEEP,this._stencilWriteMaskBack=255}(t=h.prototype).setCullMode=function(t){void 0===t&&(t=l.default.CULL_BACK),this._cullMode=t},t.setBlend=function(t,e,i,n,r,s,a,o){void 0===e&&(e=l.default.BLEND_FUNC_ADD),void 0===i&&(i=l.default.BLEND_SRC_ALPHA),void 0===n&&(n=l.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===r&&(r=l.default.BLEND_FUNC_ADD),void 0===s&&(s=l.default.BLEND_SRC_ALPHA),void 0===a&&(a=l.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===o&&(o=4294967295),this._blend=t=void 0===t?!1:t,this._blendEq=e,this._blendSrc=i,this._blendDst=n,this._blendAlphaEq=r,this._blendSrcAlpha=s,this._blendDstAlpha=a,this._blendColor=o},t.setDepth=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=l.default.DS_FUNC_LESS),this._depthTest=t=void 0===t?!1:t,this._depthWrite=e,this._depthFunc=i},t.setStencilFront=function(t,e,i,n,r,s,a,o){void 0===t&&(t=l.default.STENCIL_INHERIT),void 0===e&&(e=l.default.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===n&&(n=255),void 0===r&&(r=l.default.STENCIL_OP_KEEP),void 0===s&&(s=l.default.STENCIL_OP_KEEP),void 0===a&&(a=l.default.STENCIL_OP_KEEP),void 0===o&&(o=255),this._stencilTest=t,this._stencilFuncFront=e,this._stencilRefFront=i,this._stencilMaskFront=n,this._stencilFailOpFront=r,this._stencilZFailOpFront=s,this._stencilZPassOpFront=a,this._stencilWriteMaskFront=o},t.setStencilEnabled=function(t){void 0===t&&(t=l.default.STENCIL_INHERIT),this._stencilTest=t},t.setStencilBack=function(t,e,i,n,r,s,a,o){void 0===t&&(t=l.default.STENCIL_INHERIT),void 0===e&&(e=l.default.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===n&&(n=255),void 0===r&&(r=l.default.STENCIL_OP_KEEP),void 0===s&&(s=l.default.STENCIL_OP_KEEP),void 0===a&&(a=l.default.STENCIL_OP_KEEP),void 0===o&&(o=255),this._stencilTest=t,this._stencilFuncBack=e,this._stencilRefBack=i,this._stencilMaskBack=n,this._stencilFailOpBack=r,this._stencilZFailOpBack=s,this._stencilZPassOpBack=a,this._stencilWriteMaskBack=o},t.setStage=function(t){this._stage=t},t.setProperties=function(t){this._properties=t},t.getProperty=function(t){if(this._properties[t])return this._properties[t].value},t.setProperty=function(t,e,i){var n=this._properties[t];if(!n)return!1;if(n.directly=i,Array.isArray(e)){var r=n.value;if(r.length!==e.length)return void cc.warnID(9105,this._name,t);for(var s=0;s<e.length;s++)r[s]=e[s]}else e&&!ArrayBuffer.isView(e)?n.type===a.default.PARAM_TEXTURE_2D?n.value=e.getImpl():e instanceof o.default?e.constructor.toArray(n.value,e):("object"==typeof e&&cc.warnID(9106,this._name,t),n.value=e):n.value=e;return!0},t.getDefine=function(t){return this._defines[t]},t.define=function(t,e,i){return!(!i&&void 0===this._defines[t])&&(this._defines[t]=e,!0)},t.clone=function(){var t,e=new h(this._programName),i=(Object.assign(e,this),{}),n=this._properties;for(t in n){var r,s=n[t],a=i[t]={},o=s.value;for(r in Array.isArray(o)?a.value=o.concat():ArrayBuffer.isView(o)?a.value=new o.__proto__.constructor(o):a.value=o,s)"value"!==r&&(a[r]=s[r])}return e._properties=i,e._defines=Object.assign({},this._defines),e},i.default=h,e.exports=i.default},{"../../core/value-types/value-type":338,"../enums":358,"../gfx":363}],355:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var c=(t=t("../gfx"))&&t.__esModule?t:{default:t},y=0;function u(t,e,i){for(var n=t,r=0;r<e.length;r++){var s=e[r].name,a=i[s];Number.isInteger(a)&&(s=new RegExp(s,"g"),n=n.replace(s,a))}return n}function _(t){return t.replace(/#pragma for (\w+) in range\(\s*(\d+)\s*,\s*(\d+)\s*\)([\s\S]+?)#pragma endFor/g,function(t,e,i,n,r){var s="",i=parseInt(i),a=parseInt(n);(i.isNaN||a.isNaN)&&console.error("Unroll For Loops Error: begin and end of range must be an int num.");for(var o=i;o<a;++o)s+=r.replace(new RegExp("{"+e+"}","g"),o);return s})}function d(t){return t.replace(/\bhighp\b/g,"mediump")}function n(t){this._device=t,this._templates={},this._cache={},this._checkPrecision()}(t=n.prototype).clear=function(){this._templates={},this._cache={}},t.define=function(t){var e=t.name,i=t.defines,n=t.glsl1||t,r=n.vert,n=n.frag;if(!this._templates[e]){for(var s=++y,a=0,o=0;o<i.length;++o){var l,h=i[o],c=1;"number"===h.type?(l=h.range||[],h.min=l[0]||0,h.max=l[1]||4,c=Math.ceil(Math.log2(h.max-h.min)),h._map=function(t){return t-this.min<<this._offset}.bind(h)):h._map=function(t){return t?1<<this._offset:0}.bind(h),h._offset=a,a+=c}var u=t.uniforms||[];if(t.samplers)for(var _=0;_<t.samplers.length;_++)u.push(t.samplers[_]);if(t.blocks)for(var d=0;d<t.blocks.length;d++)for(var f=t.blocks[d].defines,p=t.blocks[d].members,m=0;m<p.length;m++)u.push({defines:f,name:p[m].name,type:p[m].type});this._templates[e]={id:s,name:e,vert:r,frag:n,defines:i,attributes:t.attributes,uniforms:u,extensions:t.extensions}}},t.getTemplate=function(t){return this._templates[t]},t.hasProgram=function(t){return void 0!==this._templates[t]},t.getKey=function(t,e){for(var i=this._templates[t],n=0,r=0;r<i.defines.length;++r){var s=i.defines[r],a=e[s.name];void 0!==a&&(n|=s._map(a))}return i.id+":"+n},t.getProgram=function(t,e,n){var i=this.getKey(t,e),r=this._cache[i];if(r)return r;var t=this._templates[t],s=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[n].name,s=e[r];"number"!=typeof s&&(s=s?1:0),i.push("#define "+r+" "+s)}return i.join("\n")+"\n"}(t.defines,e),a=s+_(a=u(t.vert,t.defines,e));this._highpSupported||(a=d(a));var o,l,h,s=s+_(s=u(t.frag,t.defines,e)),e=(this._highpSupported||(s=d(s)),(r=new c.default.Program(this._device,{vert:a,frag:s})).link());return e&&(o=a.split("\n"),l=s.split("\n"),h=t.defines.length,e.forEach(function(t){var e=t.line-1,i=t.line-h,e=("vs"===t.type?o:l)[e],i=t.info||"Failed to compile "+t.type+" "+t.fileID+" (ln "+i+"): \n "+t.message+": \n  "+e;cc.error(n+" : "+i)})),this._cache[i]=r},t._checkPrecision=function(){var t,e=this._device._gl,i=!1;e.getShaderPrecisionFormat&&(t=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),e=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),i=t&&0<t.precision&&e&&0<e.precision),i||cc.warnID(9102),this._highpSupported=i},i.default=n,e.exports=i.default},{"../gfx":363}],356:[function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.__esModule=!0,i.default=void 0;o.prototype.clone=function(){for(var t=[],e=0;e<this._passes.length;e++)t.push(this._passes[e].clone());return new o(this._name,t)},r=o,(a=[{key:"name",get:function(){return this._name}},{key:"passes",get:function(){return this._passes}}])&&n(r.prototype,a),s&&n(r,s);var r,s,a=o;function o(t,e){this._name=t,this._passes=e}i.default=a,e.exports=i.default},{}],357:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../../core/value-types"),r=(t=t("../enums"))&&t.__esModule?t:{default:t},s=new n.Mat4,a=0;function o(){this._id=a++,this._priority=0,this._rect={x:0,y:0,w:1,h:1},this._color=new n.Vec4(.3,.3,.3,1),this._depth=1,this._stencil=0,this._clearFlags=r.default.CLEAR_COLOR|r.default.CLEAR_DEPTH,this._clearModel=null,this._matView=cc.mat4(),this._matViewInv=cc.mat4(),this._matProj=cc.mat4(),this._matViewProj=cc.mat4(),this._matInvViewProj=cc.mat4(),this._stages=[],this._cullingByID=!1,this._framebuffer=null,this._shadowLight=null,this._cullingMask=4294967295}(t=o.prototype).getForward=function(t){var e=this._matView.m;return n.Vec3.set(t,-e[2],-e[6],-e[10])},t.getPosition=function(t){return n.Mat4.invert(s,this._matView),n.Mat4.getTranslation(t,s)},i.default=o,e.exports=i.default},{"../../core/value-types":330,"../enums":358}],358:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=t("./build/mappings"),t={PROJ_PERSPECTIVE:0,PROJ_ORTHO:1,LIGHT_DIRECTIONAL:0,LIGHT_POINT:1,LIGHT_SPOT:2,LIGHT_AMBIENT:3,SHADOW_NONE:0,SHADOW_HARD:1,SHADOW_SOFT:2,PARAM_INT:t.typeMap.int,PARAM_INT2:t.typeMap.ivec2,PARAM_INT3:t.typeMap.ivec3,PARAM_INT4:t.typeMap.ivec4,PARAM_FLOAT:t.typeMap.float,PARAM_FLOAT2:t.typeMap.vec2,PARAM_FLOAT3:t.typeMap.vec3,PARAM_FLOAT4:t.typeMap.vec4,PARAM_MAT2:t.typeMap.mat2,PARAM_MAT3:t.typeMap.mat3,PARAM_MAT4:t.typeMap.mat4,PARAM_TEXTURE_2D:t.typeMap.sampler2D,PARAM_TEXTURE_CUBE:t.typeMap.samplerCube,CLEAR_COLOR:1,CLEAR_DEPTH:2,CLEAR_STENCIL:4,CLEAR_SKYBOX:8,BUFFER_VIEW_INT8:0,BUFFER_VIEW_UINT8:1,BUFFER_VIEW_INT16:2,BUFFER_VIEW_UINT16:3,BUFFER_VIEW_INT32:4,BUFFER_VIEW_UINT32:5,BUFFER_VIEW_FLOAT32:6};i.default=t,e.exports=i.default},{"./build/mappings":351}],359:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=n(t("./state")),P=t("./enums"),s=n(t("./texture-2d")),a=n(t("./texture-cube"));function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t={})[5124]=function(t,e,i){t.uniform1i(e,i)},t[5126]=function(t,e,i){t.uniform1f(e,i)},t[35664]=function(t,e,i){t.uniform2fv(e,i)},t[35665]=function(t,e,i){t.uniform3fv(e,i)},t[35666]=function(t,e,i){t.uniform4fv(e,i)},t[35667]=function(t,e,i){t.uniform2iv(e,i)},t[35668]=function(t,e,i){t.uniform3iv(e,i)},t[35669]=function(t,e,i){t.uniform4iv(e,i)},t[35670]=function(t,e,i){t.uniform1i(e,i)},t[35671]=function(t,e,i){t.uniform2iv(e,i)},t[35672]=function(t,e,i){t.uniform3iv(e,i)},t[35673]=function(t,e,i){t.uniform4iv(e,i)},t[35674]=function(t,e,i){t.uniformMatrix2fv(e,!1,i)},t[35675]=function(t,e,i){t.uniformMatrix3fv(e,!1,i)},t[35676]=function(t,e,i){t.uniformMatrix4fv(e,!1,i)},t[35678]=function(t,e,i){t.uniform1i(e,i)},t[35680]=function(t,e,i){t.uniform1i(e,i)};var R=t,O=((t={})[5124]=function(t,e,i){t.uniform1iv(e,i)},t[5126]=function(t,e,i){t.uniform1fv(e,i)},t[35664]=function(t,e,i){t.uniform2fv(e,i)},t[35665]=function(t,e,i){t.uniform3fv(e,i)},t[35666]=function(t,e,i){t.uniform4fv(e,i)},t[35667]=function(t,e,i){t.uniform2iv(e,i)},t[35668]=function(t,e,i){t.uniform3iv(e,i)},t[35669]=function(t,e,i){t.uniform4iv(e,i)},t[35670]=function(t,e,i){t.uniform1iv(e,i)},t[35671]=function(t,e,i){t.uniform2iv(e,i)},t[35672]=function(t,e,i){t.uniform3iv(e,i)},t[35673]=function(t,e,i){t.uniform4iv(e,i)},t[35674]=function(t,e,i){t.uniformMatrix2fv(e,!1,i)},t[35675]=function(t,e,i){t.uniformMatrix3fv(e,!1,i)},t[35676]=function(t,e,i){t.uniformMatrix4fv(e,!1,i)},t[35678]=function(t,e,i){t.uniform1iv(e,i)},t[35680]=function(t,e,i){t.uniform1iv(e,i)},t);function l(t,e,i,n){void 0===n&&(n=0),i instanceof s.default?t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,i._glID,0):i instanceof a.default?t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i._glID,0):t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,i._glID)}t=u,(c=[{key:"caps",get:function(){return this._caps}}])&&o(t.prototype,c),h&&o(t,h),(c=u.prototype)._initExtensions=function(t){for(var e=this._gl,i=0;i<t.length;++i)for(var n=t[i],r=["","WEBKIT_","MOZ_"],s=0;s<r.length;s++)try{var a=e.getExtension(r[s]+n);if(a){this._extensions[n]=a;break}}catch(t){console.error(t)}},c._initCaps=function(){var t=this._gl,e=this.ext("WEBGL_draw_buffers");this._caps.maxVertexStreams=4,this._caps.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxFragUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexAttribs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this._caps.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._caps.maxDrawBuffers=e?t.getParameter(e.MAX_DRAW_BUFFERS_WEBGL):1,this._caps.maxColorAttachments=e?t.getParameter(e.MAX_COLOR_ATTACHMENTS_WEBGL):1},c._initStates=function(){var t=this._gl;t.disable(t.BLEND),t.blendFunc(t.ONE,t.ZERO),t.blendEquation(t.FUNC_ADD),t.blendColor(1,1,1,1),t.colorMask(!0,!0,!0,!0),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.disable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.depthMask(!1),t.disable(t.POLYGON_OFFSET_FILL),t.depthRange(0,1),t.disable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,0,255),t.stencilMask(255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearDepth(1),t.clearColor(0,0,0,0),t.clearStencil(0),t.disable(t.SCISSOR_TEST)},c._restoreTexture=function(t){var e=this._gl,t=this._current.textureUnits[t];t&&-1!==t._glID?e.bindTexture(t._target,t._glID):e.bindTexture(e.TEXTURE_2D,null)},c._restoreIndexBuffer=function(){var t=this._gl,e=this._current.indexBuffer;e&&-1!==e._glID?t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._glID):t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},c.ext=function(t){return this._extensions[t]},c.allowFloatTexture=function(){return null!=this.ext("OES_texture_float")},c.setFrameBuffer=function(t){if(this._framebuffer!==t){this._framebuffer=t;var e=this._gl;if(t){e.bindFramebuffer(e.FRAMEBUFFER,t._glID);for(var i=t._colors.length,n=0;n<i;++n){var r=t._colors[n];l(e,e.COLOR_ATTACHMENT0+n,r)}for(var s=i;s<this._caps.maxColorAttachments;++s)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,null,0);t._depth&&l(e,e.DEPTH_ATTACHMENT,t._depth),t._stencil&&l(e,e.STENCIL_ATTACHMENT,t._stencil),t._depthStencil&&l(e,e.DEPTH_STENCIL_ATTACHMENT,t._depthStencil)}else e.bindFramebuffer(e.FRAMEBUFFER,null)}},c.setViewport=function(t,e,i,n){this._vx===t&&this._vy===e&&this._vw===i&&this._vh===n||(this._gl.viewport(t,e,i,n),this._vx=t,this._vy=e,this._vw=i,this._vh=n)},c.setScissor=function(t,e,i,n){this._sx===t&&this._sy===e&&this._sw===i&&this._sh===n||(this._gl.scissor(t,e,i,n),this._sx=t,this._sy=e,this._sw=i,this._sh=n)},c.clear=function(t){var e,i;void 0===t.color&&void 0===t.depth&&void 0===t.stencil||(e=this._gl,void(i=0)!==t.color&&(i|=e.COLOR_BUFFER_BIT,e.clearColor(t.color[0],t.color[1],t.color[2],t.color[3])),void 0!==t.depth&&(i|=e.DEPTH_BUFFER_BIT,e.clearDepth(t.depth),e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.ALWAYS)),void 0!==t.stencil&&(i|=e.STENCIL_BUFFER_BIT,e.clearStencil(t.stencil)),e.clear(i),void 0!==t.depth&&(!1===this._current.depthTest?e.disable(e.DEPTH_TEST):(!1===this._current.depthWrite&&e.depthMask(!1),this._current.depthFunc!==P.enums.DS_FUNC_ALWAYS&&e.depthFunc(this._current.depthFunc))))},c.enableBlend=function(){this._next.blend=!0},c.enableDepthTest=function(){this._next.depthTest=!0},c.enableDepthWrite=function(){this._next.depthWrite=!0},c.setStencilTest=function(t){this._next.stencilTest=t},c.setStencilFunc=function(t,e,i){this._next.stencilSep=!1,this._next.stencilFuncFront=this._next.stencilFuncBack=t,this._next.stencilRefFront=this._next.stencilRefBack=e,this._next.stencilMaskFront=this._next.stencilMaskBack=i},c.setStencilFuncFront=function(t,e,i){this._next.stencilSep=!0,this._next.stencilFuncFront=t,this._next.stencilRefFront=e,this._next.stencilMaskFront=i},c.setStencilFuncBack=function(t,e,i){this._next.stencilSep=!0,this._next.stencilFuncBack=t,this._next.stencilRefBack=e,this._next.stencilMaskBack=i},c.setStencilOp=function(t,e,i,n){this._next.stencilFailOpFront=this._next.stencilFailOpBack=t,this._next.stencilZFailOpFront=this._next.stencilZFailOpBack=e,this._next.stencilZPassOpFront=this._next.stencilZPassOpBack=i,this._next.stencilWriteMaskFront=this._next.stencilWriteMaskBack=n},c.setStencilOpFront=function(t,e,i,n){this._next.stencilSep=!0,this._next.stencilFailOpFront=t,this._next.stencilZFailOpFront=e,this._next.stencilZPassOpFront=i,this._next.stencilWriteMaskFront=n},c.setStencilOpBack=function(t,e,i,n){this._next.stencilSep=!0,this._next.stencilFailOpBack=t,this._next.stencilZFailOpBack=e,this._next.stencilZPassOpBack=i,this._next.stencilWriteMaskBack=n},c.setDepthFunc=function(t){this._next.depthFunc=t},c.setBlendColor32=function(t){this._next.blendColor=t},c.setBlendColor=function(t,e,i,n){this._next.blendColor=(255*t<<24|255*e<<16|255*i<<8|255*n)>>>0},c.setBlendFunc=function(t,e){this._next.blendSep=!1,this._next.blendSrc=t,this._next.blendDst=e},c.setBlendFuncSep=function(t,e,i,n){this._next.blendSep=!0,this._next.blendSrc=t,this._next.blendDst=e,this._next.blendSrcAlpha=i,this._next.blendDstAlpha=n},c.setBlendEq=function(t){this._next.blendSep=!1,this._next.blendEq=t},c.setBlendEqSep=function(t,e){this._next.blendSep=!0,this._next.blendEq=t,this._next.blendAlphaEq=e},c.setCullMode=function(t){this._next.cullMode=t},c.setVertexBuffer=function(t,e,i){void 0===i&&(i=0),this._next.vertexBuffers[t]=e,this._next.vertexBufferOffsets[t]=i,this._next.maxStream<t&&(this._next.maxStream=t)},c.setIndexBuffer=function(t){this._next.indexBuffer=t},c.setProgram=function(t){this._next.program=t},c.setTexture=function(t,e,i){i>=this._caps.maxTextureUnits?console.warn("Can not set texture "+t+" at stage "+i+", max texture exceed: "+this._caps.maxTextureUnits):(this._next.textureUnits[i]=e,this.setUniform(t,i),this._next.maxTextureSlot<i&&(this._next.maxTextureSlot=i))},c.setTextureArray=function(t,e,i){var n=e.length;if(n>=this._caps.maxTextureUnits)console.warn("Can not set "+n+" textures for "+t+", max texture exceed: "+this._caps.maxTextureUnits);else{for(var r=0;r<n;++r){var s=i[r];this._next.textureUnits[s]=e[r],this._next.maxTextureSlot<s&&(this._next.maxTextureSlot=s)}this.setUniform(t,i)}},c.setUniform=function(t,e){for(var i=this._uniforms[t],n=!1,r=!1,s=!1,a=!1;i&&(s=Array.isArray(e)||e instanceof Float32Array,a=e instanceof Int32Array,i.isArray===(r=s||a)&&(!i.isArray||i.value.length===e.length)&&(n=!0,0)););if(n){var o=i.value,l=!1;if(i.isArray)for(var h=0,c=o.length;h<c;h++)o[h]!==e[h]&&(l=!0,o[h]=e[h]);else o!==e&&(l=!0,i.value=e);l&&(i.dirty=!0)}else{var u=e;s?u=new Float32Array(e):a&&(u=new Int32Array(e)),i={dirty:!0,value:u,isArray:r}}this._uniforms[t]=i},c.setUniformDirectly=function(t,e){var i=this._uniforms[t];i||(this._uniforms[t]=i={}),i.dirty=!0,i.value=e},c.setPrimitiveType=function(t){this._next.primitiveType=t},c.resetDrawCalls=function(){this._stats.drawcalls=0},c.getDrawCalls=function(){return this._stats.drawcalls},c.draw=function(t,e){var i,n,r,s=this._gl,a=this._current,o=this._next,l=(function(t,e,i){if(e.blend!==i.blend)return i.blend?(t.enable(t.BLEND),i.blendSrc!==P.enums.BLEND_CONSTANT_COLOR&&i.blendSrc!==P.enums.BLEND_ONE_MINUS_CONSTANT_COLOR&&i.blendDst!==P.enums.BLEND_CONSTANT_COLOR&&i.blendDst!==P.enums.BLEND_ONE_MINUS_CONSTANT_COLOR||t.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),i.blendSep?(t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendFunc(i.blendSrc,i.blendDst),t.blendEquation(i.blendEq))):t.disable(t.BLEND);!1!==i.blend&&(e.blendColor!==i.blendColor&&t.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),e.blendSep===i.blendSep?i.blendSep?(e.blendSrc===i.blendSrc&&e.blendDst===i.blendDst&&e.blendSrcAlpha===i.blendSrcAlpha&&e.blendDstAlpha===i.blendDstAlpha||t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),e.blendEq===i.blendEq&&e.blendAlphaEq===i.blendAlphaEq||t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(e.blendSrc===i.blendSrc&&e.blendDst===i.blendDst||t.blendFunc(i.blendSrc,i.blendDst),e.blendEq!==i.blendEq&&t.blendEquation(i.blendEq)):i.blendSep?(t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendFunc(i.blendSrc,i.blendDst),t.blendEquation(i.blendEq)))}(s,a,o),function(t,e,i){if(e.depthTest!==i.depthTest)return i.depthTest?(t.enable(t.DEPTH_TEST),t.depthFunc(i.depthFunc),t.depthMask(i.depthWrite)):t.disable(t.DEPTH_TEST);e.depthWrite!==i.depthWrite&&t.depthMask(i.depthWrite),!1!==i.depthTest?e.depthFunc!==i.depthFunc&&t.depthFunc(i.depthFunc):i.depthWrite&&(i.depthTest=!0,i.depthFunc=P.enums.DS_FUNC_ALWAYS,t.enable(t.DEPTH_TEST),t.depthFunc(i.depthFunc))}(s,a,o),i=s,n=a,(r=o).stencilTest!==P.enums.STENCIL_INHERIT&&(r.stencilTest!==n.stencilTest?r.stencilTest===P.enums.STENCIL_DISABLE?i.disable(i.STENCIL_TEST):(i.enable(i.STENCIL_TEST),r.stencilSep?(i.stencilFuncSeparate(i.FRONT,r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),i.stencilMaskSeparate(i.FRONT,r.stencilWriteMaskFront),i.stencilOpSeparate(i.FRONT,r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront),i.stencilFuncSeparate(i.BACK,r.stencilFuncBack,r.stencilRefBack,r.stencilMaskBack),i.stencilMaskSeparate(i.BACK,r.stencilWriteMaskBack),i.stencilOpSeparate(i.BACK,r.stencilFailOpBack,r.stencilZFailOpBack,r.stencilZPassOpBack)):(i.stencilFunc(r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),i.stencilMask(r.stencilWriteMaskFront),i.stencilOp(r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront))):r.stencilTest!==P.enums.STENCIL_DISABLE&&(n.stencilSep===r.stencilSep?r.stencilSep?(n.stencilFuncFront===r.stencilFuncFront&&n.stencilRefFront===r.stencilRefFront&&n.stencilMaskFront===r.stencilMaskFront||i.stencilFuncSeparate(i.FRONT,r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),n.stencilWriteMaskFront!==r.stencilWriteMaskFront&&i.stencilMaskSeparate(i.FRONT,r.stencilWriteMaskFront),n.stencilFailOpFront===r.stencilFailOpFront&&n.stencilZFailOpFront===r.stencilZFailOpFront&&n.stencilZPassOpFront===r.stencilZPassOpFront||i.stencilOpSeparate(i.FRONT,r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront),n.stencilFuncBack===r.stencilFuncBack&&n.stencilRefBack===r.stencilRefBack&&n.stencilMaskBack===r.stencilMaskBack||i.stencilFuncSeparate(i.BACK,r.stencilFuncBack,r.stencilRefBack,r.stencilMaskBack),n.stencilWriteMaskBack!==r.stencilWriteMaskBack&&i.stencilMaskSeparate(i.BACK,r.stencilWriteMaskBack),n.stencilFailOpBack===r.stencilFailOpBack&&n.stencilZFailOpBack===r.stencilZFailOpBack&&n.stencilZPassOpBack===r.stencilZPassOpBack||i.stencilOpSeparate(i.BACK,r.stencilFailOpBack,r.stencilZFailOpBack,r.stencilZPassOpBack)):(n.stencilFuncFront===r.stencilFuncFront&&n.stencilRefFront===r.stencilRefFront&&n.stencilMaskFront===r.stencilMaskFront||i.stencilFunc(r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),n.stencilWriteMaskFront!==r.stencilWriteMaskFront&&i.stencilMask(r.stencilWriteMaskFront),n.stencilFailOpFront===r.stencilFailOpFront&&n.stencilZFailOpFront===r.stencilZFailOpFront&&n.stencilZPassOpFront===r.stencilZPassOpFront||i.stencilOp(r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront)):r.stencilSep?(i.stencilFuncSeparate(i.FRONT,r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),i.stencilMaskSeparate(i.FRONT,r.stencilWriteMaskFront),i.stencilOpSeparate(i.FRONT,r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront),i.stencilFuncSeparate(i.BACK,r.stencilFuncBack,r.stencilRefBack,r.stencilMaskBack),i.stencilMaskSeparate(i.BACK,r.stencilWriteMaskBack),i.stencilOpSeparate(i.BACK,r.stencilFailOpBack,r.stencilZFailOpBack,r.stencilZPassOpBack)):(i.stencilFunc(r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),i.stencilMask(r.stencilWriteMaskFront),i.stencilOp(r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront)))),n=s,i=o,a.cullMode!==i.cullMode&&(i.cullMode!==P.enums.CULL_NONE?(n.enable(n.CULL_FACE),n.cullFace(i.cullMode)):n.disable(n.CULL_FACE)),this),h=s,c=a,u=o,_=!1;if(-1!==u.maxStream){if(c.maxStream!==u.maxStream)_=!0;else if(c.program!==u.program)_=!0;else for(var d=0;d<u.maxStream+1;++d)if(c.vertexBuffers[d]!==u.vertexBuffers[d]||c.vertexBufferOffsets[d]!==u.vertexBufferOffsets[d]){_=!0;break}if(_){for(var f=0;f<l._caps.maxVertexAttribs;++f)l._newAttributes[f]=0;for(var p=0;p<u.maxStream+1;++p){var m=u.vertexBuffers[p],y=u.vertexBufferOffsets[p];if(m&&-1!==m._glID){h.bindBuffer(h.ARRAY_BUFFER,m._glID);for(var g=0;g<u.program._attributes.length;++g){var v=u.program._attributes[g],b=m._format.element(v.name);b?(0===l._enabledAttributes[v.location]&&(h.enableVertexAttribArray(v.location),l._enabledAttributes[v.location]=1),l._newAttributes[v.location]=1,h.vertexAttribPointer(v.location,b.num,b.type,b.normalize,b.stride,b.offset+y*b.stride)):console.warn("Can not find vertex attribute: "+v.name)}}}for(var x=0;x<l._caps.maxVertexAttribs;++x)l._enabledAttributes[x]!==l._newAttributes[x]&&(h.disableVertexAttribArray(x),l._enabledAttributes[x]=0)}}a.indexBuffer!==o.indexBuffer&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o.indexBuffer&&-1!==o.indexBuffer._glID?o.indexBuffer._glID:null);for(var A,C=!1,T=(a.program!==o.program&&(o.program._linked?s.useProgram(o.program._glID):console.warn("Failed to use program: has not linked yet."),C=!0),s),S=a,w=o,E=0;E<w.maxTextureSlot+1;++E)S.textureUnits[E]===w.textureUnits[E]||(A=w.textureUnits[E])&&-1!==A._glID&&(T.activeTexture(T.TEXTURE0+E),T.bindTexture(A._target,A._glID));for(var M=0;M<o.program._uniforms.length;++M){var D,B=o.program._uniforms[M],I=this._uniforms[B.name];I&&(C||I.dirty)&&(I.dirty=!1,(D=(void 0===B.size?R:O)[B.type])?D(s,B.location,I.value):console.warn("Can not find commit function for uniform "+B.name))}e&&(o.indexBuffer?s.drawElements(this._next.primitiveType,e,o.indexBuffer._format,t*o.indexBuffer._bytesPerIndex):s.drawArrays(this._next.primitiveType,t,e),this._stats.drawcalls++),a.set(o),o.reset()};var h,c,t=u;function u(t,e){var i;void 0===(e=e||{}).alpha&&(e.alpha=!1),void 0===e.stencil&&(e.stencil=!0),void 0===e.depth&&(e.depth=!0),void 0===e.antialias&&(e.antialias=!1),void 0===e.preserveDrawingBuffer&&(e.preserveDrawingBuffer=!1);try{i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)||t.getContext("webkit-3d",e)||t.getContext("moz-webgl",e)}catch(t){return void console.error(t)}i||console.error("This device does not support webgl"),this._gl=i,this._extensions={},this._caps={},this._stats={texture:0,vb:0,ib:0,drawcalls:0},this._initExtensions(["EXT_texture_filter_anisotropic","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","WEBGL_draw_buffers"]),this._initCaps(),this._initStates(),r.default.initDefault(this),this._current=new r.default(this),this._next=new r.default(this),this._uniforms={},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0,this._framebuffer=null,this._enabledAttributes=new Array(this._caps.maxVertexAttribs),this._newAttributes=new Array(this._caps.maxVertexAttribs);for(var n=0;n<this._caps.maxVertexAttribs;++n)this._enabledAttributes[n]=0,this._newAttributes[n]=0}i.default=t,e.exports=i.default},{"./enums":360,"./state":367,"./texture-2d":368,"./texture-cube":369}],360:[function(t,e,i){"use strict";i.__esModule=!0,i.attrTypeBytes=function(t){return t===s.ATTR_TYPE_INT8||t===s.ATTR_TYPE_UINT8?1:t===s.ATTR_TYPE_INT16||t===s.ATTR_TYPE_UINT16?2:t===s.ATTR_TYPE_INT32||t===s.ATTR_TYPE_UINT32||t===s.ATTR_TYPE_FLOAT32?4:(console.warn("Unknown ATTR_TYPE: "+t),0)},i.glFilter=function(t,e,i){var n=r[e][(i=void 0===i?-1:i)+1];return void 0===n?(console.warn("Unknown FILTER: "+e),-1===i?t.LINEAR:t.LINEAR_MIPMAP_LINEAR):n},i.glTextureFmt=function(t){var e=n[t];return void 0===e?(console.warn("Unknown TEXTURE_FMT: "+t),n[s.TEXTURE_FMT_RGBA8]):e},i.enums=void 0;var r=[[9728,9984,9986],[9729,9985,9987]],n=[{format:6407,internalFormat:33776,pixelType:null},{format:6408,internalFormat:33777,pixelType:null},{format:6408,internalFormat:33778,pixelType:null},{format:6408,internalFormat:33779,pixelType:null},{format:6407,internalFormat:36196,pixelType:null},{format:6407,internalFormat:35841,pixelType:null},{format:6408,internalFormat:35843,pixelType:null},{format:6407,internalFormat:35840,pixelType:null},{format:6408,internalFormat:35842,pixelType:null},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121},{format:6407,internalFormat:6407,pixelType:33635},{format:6408,internalFormat:6408,pixelType:32820},{format:6408,internalFormat:6408,pixelType:32819},{format:6407,internalFormat:6407,pixelType:5121},{format:6408,internalFormat:6408,pixelType:5121},{format:6407,internalFormat:6407,pixelType:36193},{format:6408,internalFormat:6408,pixelType:36193},{format:6407,internalFormat:6407,pixelType:5126},{format:6408,internalFormat:6408,pixelType:5126},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:6402,internalFormat:6402,pixelType:5123},{format:6402,internalFormat:6402,pixelType:5125},{format:6402,internalFormat:6402,pixelType:5125},{format:6407,internalFormat:37492,pixelType:null},{format:6408,internalFormat:37496,pixelType:null}],s={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_D16:25,TEXTURE_FMT_D32:26,TEXTURE_FMT_D24S8:27,TEXTURE_FMT_RGB_ETC2:28,TEXTURE_FMT_RGBA_ETC2:29,DS_FUNC_NEVER:512,DS_FUNC_LESS:513,DS_FUNC_EQUAL:514,DS_FUNC_LEQUAL:515,DS_FUNC_GREATER:516,DS_FUNC_NOTEQUAL:517,DS_FUNC_GEQUAL:518,DS_FUNC_ALWAYS:519,RB_FMT_RGBA4:32854,RB_FMT_RGB5_A1:32855,RB_FMT_RGB565:36194,RB_FMT_D16:33189,RB_FMT_S8:36168,RB_FMT_D24S8:34041,BLEND_FUNC_ADD:32774,BLEND_FUNC_SUBTRACT:32778,BLEND_FUNC_REVERSE_SUBTRACT:32779,BLEND_ZERO:0,BLEND_ONE:1,BLEND_SRC_COLOR:768,BLEND_ONE_MINUS_SRC_COLOR:769,BLEND_DST_COLOR:774,BLEND_ONE_MINUS_DST_COLOR:775,BLEND_SRC_ALPHA:770,BLEND_ONE_MINUS_SRC_ALPHA:771,BLEND_DST_ALPHA:772,BLEND_ONE_MINUS_DST_ALPHA:773,BLEND_CONSTANT_COLOR:32769,BLEND_ONE_MINUS_CONSTANT_COLOR:32770,BLEND_CONSTANT_ALPHA:32771,BLEND_ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_SRC_ALPHA_SATURATE:776,STENCIL_DISABLE:0,STENCIL_ENABLE:1,STENCIL_INHERIT:2,STENCIL_OP_KEEP:7680,STENCIL_OP_ZERO:0,STENCIL_OP_REPLACE:7681,STENCIL_OP_INCR:7682,STENCIL_OP_INCR_WRAP:34055,STENCIL_OP_DECR:7683,STENCIL_OP_DECR_WRAP:34056,STENCIL_OP_INVERT:5386,CULL_NONE:0,CULL_FRONT:1028,CULL_BACK:1029,CULL_FRONT_AND_BACK:1032,PT_POINTS:0,PT_LINES:1,PT_LINE_LOOP:2,PT_LINE_STRIP:3,PT_TRIANGLES:4,PT_TRIANGLE_STRIP:5,PT_TRIANGLE_FAN:6};i.enums=s},{}],361:[function(t,e,i){"use strict";var n;function r(t,e,i,n){this._device=t,this._width=e,this._height=i,this._colors=n.colors||[],this._depth=n.depth||null,this._stencil=n.stencil||null,this._depthStencil=n.depthStencil||null,this._glID=t._gl.createFramebuffer()}i.__esModule=!0,i.default=void 0,(n=r.prototype).destroy=function(){null!==this._glID?(this._device._gl.deleteFramebuffer(this._glID),this._glID=null):console.error("The frame-buffer already destroyed")},n.getHandle=function(){return this._glID},i.default=r,e.exports=i.default},{}],362:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=t("./enums");function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(a={})[t.enums.INDEX_FMT_UINT8]=1,a[t.enums.INDEX_FMT_UINT16]=2,a[t.enums.INDEX_FMT_UINT32]=4;var r,s=a,a=((t=o.prototype).destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.ib-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},t.update=function(t,e){if(-1!==this._glID){if(0!==e.byteLength){if(t+e.byteLength>this._bytes){if(t)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=t+e.byteLength,this._numIndices=this._bytes/this._bytesPerIndex}var i=this._device._gl,n=this._usage;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._glID),this._needExpandDataStore?(i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,n),this._needExpandDataStore=!1):i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,t,e),this._device._restoreIndexBuffer()}}else console.error("The buffer is destroyed")},t.setUsage=function(t){this._usage=t},t=o,(a=[{key:"count",get:function(){return this._numIndices}}])&&n(t.prototype,a),r&&n(t,r),o);function o(t,e,i,n){this._device=t,this._format=e,this._usage=i,this._bytesPerIndex=s[e],this._bytes=n.byteLength,this._numIndices=this._bytes/this._bytesPerIndex,this._needExpandDataStore=!0,this._glID=t._gl.createBuffer(),this.update(0,n),t._stats.ib+=this._bytes}a.BYTES_PER_INDEX=s,i.default=a,e.exports=i.default},{"./enums":360}],363:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("./enums"),t={VertexFormat:t("./vertex-format"),IndexBuffer:t("./index-buffer"),VertexBuffer:t("./vertex-buffer"),Program:t("./program"),Texture:t("./texture"),Texture2D:t("./texture-2d"),TextureCube:t("./texture-cube"),RenderBuffer:t("./render-buffer"),FrameBuffer:t("./frame-buffer"),Device:t("./device"),attrTypeBytes:n.attrTypeBytes,glFilter:n.glFilter,glTextureFmt:n.glTextureFmt};Object.assign(t,n.enums),i.default=t,cc.gfx=t,e.exports=i.default},{"./device":359,"./enums":360,"./frame-buffer":361,"./index-buffer":362,"./program":365,"./render-buffer":366,"./texture":370,"./texture-2d":368,"./texture-cube":369,"./vertex-buffer":371,"./vertex-format":372}],364:[function(t,e,i){"use strict";i.__esModule=!0,i.isPow2=function(t){return!(t&t-1||!t)}},{}],365:[function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.__esModule=!0,i.default=void 0;var r=0;function m(i,n,t){t.split("\n").forEach(function(t){var e;t.length<5||((e=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t))?i.push({type:n,fileID:0|e[1],line:0|e[2],message:e[3].trim()}):0<t.length&&i.push({type:n,fileID:-1,line:0,message:t}))})}(a=l.prototype).link=function(){if(!this._linked){var t=this._device._gl,e=y(t,t.VERTEX_SHADER,this._vertSource),i=y(t,t.FRAGMENT_SHADER,this._fragSource),n=t.createProgram(),r=(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),!1),s=this._errors;if(t.getShaderParameter(e,t.COMPILE_STATUS)||(m(s,"vs",t.getShaderInfoLog(e)),r=!0),t.getShaderParameter(i,t.COMPILE_STATUS)||(m(s,"fs",t.getShaderInfoLog(i)),r=!0),t.deleteShader(e),t.deleteShader(i),r)return s;if(!t.getProgramParameter(n,t.LINK_STATUS))return s.push({info:"Failed to link shader program: "+t.getProgramInfoLog(n)}),s;this._glID=n;for(var a=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES),o=0;o<a;++o){var l=t.getActiveAttrib(n,o),h=t.getAttribLocation(n,l.name);this._attributes.push({name:l.name,location:h,type:l.type})}for(var c=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),u=0;u<c;++u){var _=t.getActiveUniform(n,u),d=_.name,f=t.getUniformLocation(n,d),p="[0]"===d.substr(d.length-3),d={name:d=p?d.substr(0,d.length-3):d,location:f,type:_.type,size:p?_.size:void 0};this._uniforms.push(d)}this._linked=!0}},a.destroy=function(){this._device._gl.deleteProgram(this._glID),this._linked=!1,this._glID=null,this._attributes=[],this._uniforms=[],this._samplers=[]},a=l,(o=[{key:"id",get:function(){return this._id}}])&&n(a.prototype,o),s&&n(a,s);var s,a,o=l;function l(t,e){this._device=t,this._attributes=[],this._uniforms=[],this._samplers=[],this._errors=[],this._linked=!1,this._vertSource=e.vert,this._fragSource=e.frag,this._glID=null,this._id=r++}function y(t,e,i){e=t.createShader(e);return t.shaderSource(e,i),t.compileShader(e),e}i.default=o,e.exports=i.default},{}],366:[function(t,e,i){"use strict";var n;function r(t,e,i,n){this._device=t,this._format=e,this._glID=t._gl.createRenderbuffer(),this.update(i,n)}i.__esModule=!0,i.default=void 0,(n=r.prototype).update=function(t,e){this._width=t,this._height=e;var i=this._device._gl;i.bindRenderbuffer(i.RENDERBUFFER,this._glID),i.renderbufferStorage(i.RENDERBUFFER,this._format,t,e),i.bindRenderbuffer(i.RENDERBUFFER,null)},n.destroy=function(){var t;null!==this._glID?((t=this._device._gl).bindRenderbuffer(t.RENDERBUFFER,null),t.deleteRenderbuffer(this._glID),this._glID=null):console.error("The render-buffer already destroyed")},i.default=r,e.exports=i.default},{}],367:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var t=t("./enums"),n={blend:!1,blendSep:!1,blendColor:4294967295,blendEq:t.enums.BLEND_FUNC_ADD,blendAlphaEq:t.enums.BLEND_FUNC_ADD,blendSrc:t.enums.BLEND_ONE,blendDst:t.enums.BLEND_ZERO,blendSrcAlpha:t.enums.BLEND_ONE,blendDstAlpha:t.enums.BLEND_ZERO,depthTest:!1,depthWrite:!1,depthFunc:t.enums.DS_FUNC_LESS,stencilTest:!1,stencilSep:!1,stencilFuncFront:t.enums.DS_FUNC_ALWAYS,stencilRefFront:0,stencilMaskFront:255,stencilFailOpFront:t.enums.STENCIL_OP_KEEP,stencilZFailOpFront:t.enums.STENCIL_OP_KEEP,stencilZPassOpFront:t.enums.STENCIL_OP_KEEP,stencilWriteMaskFront:255,stencilFuncBack:t.enums.DS_FUNC_ALWAYS,stencilRefBack:0,stencilMaskBack:255,stencilFailOpBack:t.enums.STENCIL_OP_KEEP,stencilZFailOpBack:t.enums.STENCIL_OP_KEEP,stencilZPassOpBack:t.enums.STENCIL_OP_KEEP,stencilWriteMaskBack:255,cullMode:t.enums.CULL_BACK,primitiveType:t.enums.PT_TRIANGLES,maxStream:-1,vertexBuffers:[],vertexBufferOffsets:[],indexBuffer:null,maxTextureSlot:-1,textureUnits:[],program:null};function r(t){this.vertexBuffers=new Array(t._caps.maxVertexStreams),this.vertexBufferOffsets=new Array(t._caps.maxVertexStreams),this.textureUnits=new Array(t._caps.maxTextureUnits),this.set(n)}r.initDefault=function(t){n.vertexBuffers=new Array(t._caps.maxVertexStreams),n.vertexBufferOffsets=new Array(t._caps.maxVertexStreams),n.textureUnits=new Array(t._caps.maxTextureUnits)},(t=r.prototype).reset=function(){this.set(n)},t.set=function(t){this.blend=t.blend,this.blendSep=t.blendSep,this.blendColor=t.blendColor,this.blendEq=t.blendEq,this.blendAlphaEq=t.blendAlphaEq,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.depthFunc=t.depthFunc,this.stencilTest=t.stencilTest,this.stencilSep=t.stencilSep,this.stencilFuncFront=t.stencilFuncFront,this.stencilRefFront=t.stencilRefFront,this.stencilMaskFront=t.stencilMaskFront,this.stencilFailOpFront=t.stencilFailOpFront,this.stencilZFailOpFront=t.stencilZFailOpFront,this.stencilZPassOpFront=t.stencilZPassOpFront,this.stencilWriteMaskFront=t.stencilWriteMaskFront,this.stencilFuncBack=t.stencilFuncBack,this.stencilRefBack=t.stencilRefBack,this.stencilMaskBack=t.stencilMaskBack,this.stencilFailOpBack=t.stencilFailOpBack,this.stencilZFailOpBack=t.stencilZFailOpBack,this.stencilZPassOpBack=t.stencilZPassOpBack,this.stencilWriteMaskBack=t.stencilWriteMaskBack,this.cullMode=t.cullMode,this.primitiveType=t.primitiveType,this.maxStream=t.maxStream;for(var e=0;e<t.vertexBuffers.length;++e)this.vertexBuffers[e]=t.vertexBuffers[e];for(var i=0;i<t.vertexBufferOffsets.length;++i)this.vertexBufferOffsets[i]=t.vertexBufferOffsets[i];this.indexBuffer=t.indexBuffer,this.maxTextureSlot=t.maxTextureSlot;for(var n=0;n<t.textureUnits.length;++n)this.textureUnits[n]=t.textureUnits[n];this.program=t.program},i.default=r,e.exports=i.default},{"./enums":360}],368:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("./texture"))&&n.__esModule?n:{default:n},a=t("./enums"),s=t("./misc");r=n.default,t=r,(n=o).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=o.prototype).update=function(t){var e,i,n=this._device._gl,r=this._genMipmap;t&&(void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),void 0!==t.anisotropy&&(this._anisotropy=t.anisotropy),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,this._compressed=this._format>=a.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=a.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=a.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=a.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==t.genMipmaps&&(this._genMipmap=t.genMipmaps,r=t.genMipmaps),(e=this._device.caps.maxTextureSize||Number.MAX_VALUE)<(i=Math.max(t.width||0,t.height||0))&&console.warn("The current texture size "+i+" exceeds the maximum size ["+e+"] supported on the device."),void 0!==t.images&&1<t.images.length&&(r=!1,(t.width>t.height?t.width:t.height)>>t.images.length-1!=1&&console.error("texture-2d mipmap is invalid, should have a 1x1 mipmap."))),(0,s.isPow2)(this._width)&&(0,s.isPow2)(this._height)||(r=!1),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._glID),void 0!==t.images&&0<t.images.length&&(this._setMipmap(t.images,t.flipY,t.premultiplyAlpha),1<t.images.length&&(this._genMipmap=!0)),r&&(n.hint(n.GENERATE_MIPMAP_HINT,n.NICEST),n.generateMipmap(n.TEXTURE_2D),this._genMipmap=!0),this._setTexInfo(),this._device._restoreTexture(0)},n.updateSubImage=function(t){var e=this._device._gl,i=(0,a.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),this._setSubImage(i,t),this._device._restoreTexture(0)},n.updateImage=function(t){var e=this._device._gl,i=(0,a.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),this._setImage(i,t),this._device._restoreTexture(0)},n._setSubImage=function(t,e){var i=this._device._gl,n=e.flipY,r=e.premultiplyAlpha,s=e.image;!s||ArrayBuffer.isView(s)||s instanceof ArrayBuffer?(void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this._compressed?i.compressedTexSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,e.width,e.height,t.format,s):i.texSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,e.width,e.height,t.format,t.pixelType,s)):(void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),i.texSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,t.format,t.pixelType,s))},n._setImage=function(t,e){var i=this._device._gl,n=e.flipY,r=e.premultiplyAlpha,s=e.image;!s||ArrayBuffer.isView(s)||s instanceof ArrayBuffer?(void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this._compressed?i.compressedTexImage2D(i.TEXTURE_2D,e.level,t.internalFormat,e.width,e.height,0,s):i.texImage2D(i.TEXTURE_2D,e.level,t.internalFormat,e.width,e.height,0,t.format,t.pixelType,s)):(void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),i.texImage2D(i.TEXTURE_2D,e.level,t.internalFormat,t.format,t.pixelType,s))},n._setMipmap=function(t,e,i){for(var n=(0,a.glTextureFmt)(this._format),r={width:this._width,height:this._height,flipY:e,premultiplyAlpha:i,level:0,image:null},s=0;s<t.length;++s)r.level=s,r.width=this._width>>s,r.height=this._height>>s,r.image=t[s],this._setImage(n,r)},n._setTexInfo=function(){var t=this._device._gl,e=(0,s.isPow2)(this._width)&&(0,s.isPow2)(this._height),i=(e||this._wrapS===a.enums.WRAP_CLAMP&&this._wrapT===a.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=a.enums.WRAP_CLAMP,this._wrapT=a.enums.WRAP_CLAMP),this._genMipmap?this._mipFilter:-1),e=(e||-1===i||(console.warn("NPOT textures do not support mipmap filter"),i=-1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,(0,a.glFilter)(t,this._minFilter,i)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,(0,a.glFilter)(t,this._magFilter,-1)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._wrapT),this._device.ext("EXT_texture_filter_anisotropic"));e&&t.texParameteri(t.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)};var r,t=o;function o(t,e){var i=(t=r.call(this,t)||this)._device._gl;return t._target=i.TEXTURE_2D,t._glID=i.createTexture(),e.images=e.images||[null],t.update(e),t}i.default=t,e.exports=i.default},{"./enums":360,"./misc":364,"./texture":370}],369:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("./texture"))&&n.__esModule?n:{default:n},l=t("./enums"),r=t("./misc");s=n.default,t=s,(n=a).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=a.prototype).update=function(t){var e=this._device._gl,i=this._genMipmaps;t&&(void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),void 0!==t.anisotropy&&(this._anisotropy=t.anisotropy),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,this._compressed=this._format>=l.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=l.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=l.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=l.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==t.genMipmaps&&(this._genMipmaps=t.genMipmaps,i=t.genMipmaps),void 0!==t.images&&1<t.images.length&&(i=!1,t.width!==t.height&&console.warn("texture-cube width and height should be identical."),t.width>>t.images.length-1!=1&&console.error("texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn"))),(0,r.isPow2)(this._width)&&(0,r.isPow2)(this._height)||(i=!1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),void 0!==t.images&&0<t.images.length&&(this._setMipmap(t.images,t.flipY,t.premultiplyAlpha),1<t.images.length&&(this._genMipmaps=!0)),i&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_CUBE_MAP),this._genMipmaps=!0),this._setTexInfo(),this._device._restoreTexture(0)},n.updateSubImage=function(t){var e=this._device._gl,i=(0,l.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),this._setSubImage(i,t),this._device._restoreTexture(0)},n.updateImage=function(t){var e=this._device._gl,i=(0,l.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),this._setImage(i,t),this._device._restoreTexture(0)},n._setSubImage=function(t,e){var i=this._device._gl,n=e.flipY,r=e.premultiplyAlpha,s=e.faceIndex,a=e.image;void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),!a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer?this._compressed?i.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,e.width,e.height,t.format,a):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,e.width,e.height,t.format,t.pixelType,a):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,t.format,t.pixelType,a)},n._setImage=function(t,e){var i=this._device._gl,n=e.flipY,r=e.premultiplyAlpha,s=e.faceIndex,a=e.image;void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),!a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer?this._compressed?i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,e.width,e.height,0,a):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,e.width,e.height,0,t.format,t.pixelType,a):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,t.format,t.pixelType,a)},n._setMipmap=function(t,e,i){for(var n=(0,l.glTextureFmt)(this._format),r={width:this._width,height:this._height,faceIndex:0,flipY:e,premultiplyAlpha:i,level:0,image:null},s=0;s<t.length;++s){var a=t[s];r.level=s,r.width=this._width>>s,r.height=this._height>>s;for(var o=0;o<6;++o)r.faceIndex=o,r.image=a[o],this._setImage(n,r)}},n._setTexInfo=function(){var t=this._device._gl,e=(0,r.isPow2)(this._width)&&(0,r.isPow2)(this._height),i=(e||this._wrapS===l.enums.WRAP_CLAMP&&this._wrapT===l.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=l.enums.WRAP_CLAMP,this._wrapT=l.enums.WRAP_CLAMP),this._genMipmaps?this._mipFilter:-1),e=(e||-1===i||(console.warn("NPOT textures do not support mipmap filter"),i=-1),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,(0,l.glFilter)(t,this._minFilter,i)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,(0,l.glFilter)(t,this._magFilter,-1)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this._wrapT),this._device.ext("EXT_texture_filter_anisotropic"));e&&t.texParameteri(t.TEXTURE_CUBE_MAP,e.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)};var s,t=a;function a(t,e){var i=(t=s.call(this,t)||this)._device._gl;return t._target=i.TEXTURE_CUBE_MAP,t._glID=i.createTexture(),t.update(e),t}i.default=t,e.exports=i.default},{"./enums":360,"./misc":364,"./texture":370}],370:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("./enums"),r=0;function s(t){this._device=t,this._width=4,this._height=4,this._genMipmaps=!1,this._compressed=!1,this._anisotropy=1,this._minFilter=n.enums.FILTER_LINEAR,this._magFilter=n.enums.FILTER_LINEAR,this._mipFilter=n.enums.FILTER_LINEAR,this._wrapS=n.enums.WRAP_REPEAT,this._wrapT=n.enums.WRAP_REPEAT,this._format=n.enums.TEXTURE_FMT_RGBA8,this._target=-1,this._id=r++}s.prototype.destroy=function(){null!==this._glID?(this._device._gl.deleteTexture(this._glID),this._device._stats.tex-=this.bytes,this._glID=null):console.error("The texture already destroyed")},i.default=s,e.exports=i.default},{"./enums":360}],371:[function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.__esModule=!0,i.default=void 0,t("./enums");(t=a.prototype).destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.vb-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},t.update=function(t,e){if(-1!==this._glID){if(0!==e.byteLength){if(t+e.byteLength>this._bytes){if(t)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=t+e.byteLength,this._numVertices=this._bytes/this._bytesPerVertex}var i=this._device._gl,n=this._usage;i.bindBuffer(i.ARRAY_BUFFER,this._glID),this._needExpandDataStore?(i.bufferData(i.ARRAY_BUFFER,e,n),this._needExpandDataStore=!1):i.bufferSubData(i.ARRAY_BUFFER,t,e),i.bindBuffer(i.ARRAY_BUFFER,null)}}else console.error("The buffer is destroyed")},t.getFormat=function(t){return this._format.element(t)},t.setUsage=function(t){this._usage=t},t=a,(s=[{key:"count",get:function(){return this._numVertices}}])&&n(t.prototype,s),r&&n(t,r);var r,s=a;function a(t,e,i,n){this._device=t,this._format=e,this._usage=i,this._bytesPerVertex=this._format._bytes,this._bytes=n.byteLength,this._numVertices=this._bytes/this._bytesPerVertex,this._needExpandDataStore=!0,this._glID=t._gl.createBuffer(),this.update(0,n),t._stats.vb+=this._bytes}i.default=s,e.exports=i.default},{"./enums":360}],372:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var o=t("./enums"),l=(t=t("../murmurhash2_gc"))&&t.__esModule?t:{default:t};function n(t){this._attr2el={},this._elements=[];for(var e="",i=this._bytes=0,n=t.length;i<n;++i){var r=t[i],r={name:r.name,offset:this._bytes,stride:0,stream:-1,type:r.type,num:r.num,normalize:void 0!==r.normalize&&r.normalize,bytes:r.num*(0,o.attrTypeBytes)(r.type)};this._attr2el[r.name]=r,this._elements.push(r),this._bytes+=r.bytes,e+=r.name+":"+r.num+":"+r.type+":"+r.normalize}for(var s=0,a=this._elements.length;s<a;++s)this._elements[s].stride=this._bytes;this._hash=(0,l.default)(e,666)}(t=n.prototype).element=function(t){return this._attr2el[t]},t.getHash=function(){return this._hash},i.default=n,e.exports=i.default},{"../murmurhash2_gc":381,"./enums":360}],373:[function(t,e,i){"use strict";function n(t,e){this._cursor=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}i.__esModule=!0,i.default=void 0,n.prototype.request=function(){var t=this._data[this._cursor];return this._cursor=(this._cursor+1)%this._data.length,t},i.default=n,e.exports=i.default},{}],374:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("./timsort"))&&t.__esModule?t:{default:t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t=o.prototype)._resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=void 0},t.reset=function(){for(var t=0;t<this._count;++t)this._data[t]=void 0;this._count=0},t.push=function(t){this._count>=this._data.length&&this._resize(2*this._data.length),this._data[this._count]=t,++this._count},t.pop=function(){--this._count,this._count<0&&(this._count=0);var t=this._data[this._count];return this._data[this._count]=void 0,t},t.fastRemove=function(t){var e;t>=this._count||t<0||(e=this._count-1,this._data[t]=this._data[e],this._data[e]=void 0,--this._count)},t.indexOf=function(t){return this._data.indexOf(t)},t.sort=function(t){return(0,n.default)(this._data,0,this._count,t)},t=o,(a=[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}])&&r(t.prototype,a),s&&r(t,s);var s,a=o;function o(t){this._count=0,this._data=new Array(t)}i.default=a,e.exports=i.default},{"./timsort":379}],375:[function(t,e,i){"use strict";i.__esModule=!0,i.TypedArrayPool=i.RecyclePool=i.Pool=i.LinkedArray=i.FixedArray=i.CircularPool=void 0;var n=r(t("./circular-pool")),n=(i.CircularPool=n.default,r(t("./fixed-array"))),n=(i.FixedArray=n.default,r(t("./linked-array"))),n=(i.LinkedArray=n.default,r(t("./pool"))),n=(i.Pool=n.default,r(t("./recycle-pool"))),n=(i.RecyclePool=n.default,r(t("./typed-array-pool")));function r(t){return t&&t.__esModule?t:{default:t}}i.TypedArrayPool=n.default},{"./circular-pool":373,"./fixed-array":374,"./linked-array":376,"./pool":377,"./recycle-pool":378,"./typed-array-pool":380}],376:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("./pool"))&&t.__esModule?t:{default:t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t=o.prototype).add=function(){var t=this._pool.alloc();return this._tail?(this._tail._next=t)._prev=this._tail:this._head=t,this._tail=t,this._count+=1,t},t.remove=function(t){t._prev?t._prev._next=t._next:this._head=t._next,t._next?t._next._prev=t._prev:this._tail=t._prev,t._next=null,t._prev=null,this._pool.free(t),--this._count},t.forEach=function(t,e){var i=this._head;if(i){e&&(t=t.bind(e));for(var n,r=0;i;)n=i._next,t(i,r,this),i=n,++r}},t=o,(a=[{key:"head",get:function(){return this._head}},{key:"tail",get:function(){return this._tail}},{key:"length",get:function(){return this._count}}])&&r(t.prototype,a),s&&r(t,s);var s,a=o;function o(t,e){this._fn=t,this._count=0,this._head=null,this._tail=null,this._pool=new n.default(t,e)}i.default=a,e.exports=i.default},{"./pool":377}],377:[function(t,e,i){"use strict";var n;function r(t,e){this._fn=t,this._idx=e-1,this._frees=new Array(e);for(var i=0;i<e;++i)this._frees[i]=t()}i.__esModule=!0,i.default=void 0,(n=r.prototype)._expand=function(t){var e=this._frees;this._frees=new Array(t);for(var i=t-e.length,n=0;n<i;++n)this._frees[n]=this._fn();for(var r=i,s=0;r<t;++r,++s)this._frees[r]=e[s];this._idx+=i},n.alloc=function(){this._idx<0&&this._expand(Math.round(1.2*this._frees.length)+1);var t=this._frees[this._idx];return this._frees[this._idx]=null,--this._idx,t},n.free=function(t){++this._idx,this._frees[this._idx]=t},n.clear=function(t){for(var e=0;e<=this._idx;e++)t&&t(this._frees[e]);this._frees.length=0,this._idx=-1},i.default=r,e.exports=i.default},{}],378:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("./timsort"))&&t.__esModule?t:{default:t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t=o.prototype).reset=function(){this._count=0},t.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()},t.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},t.remove=function(t){var e,i;t>=this._count||(e=this._count-1,i=this._data[t],this._data[t]=this._data[e],this._data[e]=i,--this._count)},t.sort=function(t){return(0,n.default)(this._data,0,this._count,t)},t=o,(a=[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}])&&r(t.prototype,a),s&&r(t,s);var s,a=o;function o(t,e){this._fn=t,this._count=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}i.default=a,cc.RecyclePool=a,e.exports=i.default},{"./timsort":379}],379:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e,i,n){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");void 0===n&&(n=c);var r=(i=void 0===i?t.length:i)-(e=void 0===e?0:e);if(!(r<2)){var s=0;if(r<h)_(t,e,i,e+(s=u(t,e,i,n)),n);else{var a,o=new d(t,n),l=function(t){for(var e=0;h<=t;)e|=1&t,t>>=1;return t+e}(r);do{}while((s=u(t,e,i,n))<l&&(_(t,e,e+(a=l<(a=r)?l:r),e+s,n),s=a),o.pushRun(e,s),o.mergeRuns(),e+=s,0!==(r-=s));o.forceMergeRuns()}}};var h=32,s=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function a(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}function c(t,e){if(t===e)return 0;if(~~t===t&&~~e===e){if(0===t||0===e)return t<e?-1:1;if(t<0||e<0){if(0<=e)return-1;if(0<=t)return 1;t=-t,e=-e}var i=a(t),n=a(e),r=0;return i<n?(t*=s[n-i-1],e/=10,r=-1):n<i&&(e*=s[i-n-1],t/=10,r=1),t===e?r:t<e?-1:1}i=String(t),n=String(e);return i===n?0:i<n?-1:1}function u(t,e,i,n){var r=e+1;if(r===i)return 1;if(n(t[r++],t[e])<0){for(;r<i&&n(t[r],t[r-1])<0;)r++;var s=t,a=e,o=r;for(o--;a<o;){var l=s[a];s[a++]=s[o],s[o--]=l}}else for(;r<i&&0<=n(t[r],t[r-1]);)r++;return r-e}function _(t,e,i,n,r){for(n===e&&n++;n<i;n++){for(var s=t[n],a=e,o=n;a<o;){var l=a+o>>>1;r(s,t[l])<0?o=l:a=1+l}var h=n-a;switch(h){case 3:t[a+3]=t[a+2];case 2:t[a+2]=t[a+1];case 1:t[a+1]=t[a];break;default:for(;0<h;)t[a+h]=t[a+h-1],h--}t[a]=s}}function y(t,e,i,n,r,s){var a=0,o=0,l=1;if(0<s(t,e[i+r])){for(o=n-r;l<o&&0<s(t,e[i+r+l]);)(l=1+((a=l)<<1))<=0&&(l=o);o<l&&(l=o),a+=r,l+=r}else{for(o=r+1;l<o&&s(t,e[i+r-l])<=0;)(l=1+((a=l)<<1))<=0&&(l=o);n=a,a=r-(l=o<l?o:l),l=r-n}for(a++;a<l;){var h=a+(l-a>>>1);0<s(t,e[i+h])?a=h+1:l=h}return l}function g(t,e,i,n,r,s){var a=0,o=0,l=1;if(s(t,e[i+r])<0){for(o=r+1;l<o&&s(t,e[i+r-l])<0;)(l=1+((a=l)<<1))<=0&&(l=o);var h=a,a=r-(l=o<l?o:l),l=r-h}else{for(o=n-r;l<o&&0<=s(t,e[i+r+l]);)(l=1+((a=l)<<1))<=0&&(l=o);o<l&&(l=o),a+=r,l+=r}for(a++;a<l;){var c=a+(l-a>>>1);s(t,e[i+c])<0?l=c:a=c+1}return l}(n=r.prototype).pushRun=function(t,e){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=e,this.stackSize+=1},n.mergeRuns=function(){for(;1<this.stackSize;){var t=this.stackSize-2;if(1<=t&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||2<=t&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}},n.forceMergeRuns=function(){for(;1<this.stackSize;){var t=this.stackSize-2;0<t&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}},n.mergeAt=function(t){var e=this.compare,i=this.array,n=this.runStart[t],r=this.runLength[t],s=this.runStart[t+1],a=this.runLength[t+1],t=(this.runLength[t]=r+a,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--,g(i[s],i,n,r,0,e));n+=t,0!=(r-=t)&&0!==(a=y(i[n+r-1],i,s,a,a-1,e))&&(r<=a?this.mergeLow(n,r,s,a):this.mergeHigh(n,r,s,a))},n.mergeLow=function(t,e,i,n){for(var r=this.compare,s=this.array,a=this.tmp,o=0,o=0;o<e;o++)a[o]=s[t+o];var l=0,h=i,c=t;if(s[c++]=s[h++],0!=--n)if(1!==e){for(var u=this.minGallop;;){var _=0,d=0,f=!1;do{if(r(s[h],a[l])<0){if(s[c++]=s[h++],d++,(_=0)==--n){f=!0;break}}else if(s[c++]=a[l++],_++,d=0,1==--e){f=!0;break}}while((_|d)<u);if(f)break;do{if(0!==(_=g(s[h],a,l,e,0,r))){for(o=0;o<_;o++)s[c+o]=a[l+o];if(c+=_,l+=_,(e-=_)<=1){f=!0;break}}if(s[c++]=s[h++],0==--n){f=!0;break}if(0!==(d=y(a[l],s,h,n,0,r))){for(o=0;o<d;o++)s[c+o]=s[h+o];if(c+=d,h+=d,0==(n-=d)){f=!0;break}}if(s[c++]=a[l++],1==--e){f=!0;break}}while(u--,7<=_||7<=d);if(f)break;u<0&&(u=0),u+=2}if((this.minGallop=u)<1&&(this.minGallop=1),1===e){for(o=0;o<n;o++)s[c+o]=s[h+o];s[c+n]=a[l]}else{if(0===e)throw new Error("mergeLow preconditions were not respected");for(o=0;o<e;o++)s[c+o]=a[l+o]}}else{for(o=0;o<n;o++)s[c+o]=s[h+o];s[c+n]=a[l]}else for(o=0;o<e;o++)s[c+o]=a[l+o]},n.mergeHigh=function(t,e,i,n){for(var r=this.compare,s=this.array,a=this.tmp,o=0,o=0;o<n;o++)a[o]=s[i+o];var l=t+e-1,h=n-1,c=i+n-1,u=0,_=0;if(s[c--]=s[l--],0!=--e)if(1!==n){for(var d=this.minGallop;;){var f=0,p=0,m=!1;do{if(r(a[h],s[l])<0){if(s[c--]=s[l--],f++,(p=0)==--e){m=!0;break}}else if(s[c--]=a[h--],p++,f=0,1==--n){m=!0;break}}while((f|p)<d);if(m)break;do{if(0!=(f=e-g(a[h],s,t,e,e-1,r))){for(e-=f,_=1+(c-=f),u=1+(l-=f),o=f-1;0<=o;o--)s[_+o]=s[u+o];if(0===e){m=!0;break}}if(s[c--]=a[h--],1==--n){m=!0;break}if(0!=(p=n-y(s[l],a,0,n,n-1,r))){for(n-=p,_=1+(c-=p),u=1+(h-=p),o=0;o<p;o++)s[_+o]=a[u+o];if(n<=1){m=!0;break}}if(s[c--]=s[l--],0==--e){m=!0;break}}while(d--,7<=f||7<=p);if(m)break;d<0&&(d=0),d+=2}if((this.minGallop=d)<1&&(this.minGallop=1),1===n){for(_=1+(c-=e),u=1+(l-=e),o=e-1;0<=o;o--)s[_+o]=s[u+o];s[c]=a[h]}else{if(0===n)throw new Error("mergeHigh preconditions were not respected");for(u=c-(n-1),o=0;o<n;o++)s[u+o]=a[o]}}else{for(_=1+(c-=e),u=1+(l-=e),o=e-1;0<=o;o--)s[_+o]=s[u+o];s[c]=a[h]}else for(u=c-(n-1),o=0;o<n;o++)s[u+o]=a[o]};var n,d=r;function r(t,e){this.array=t,this.compare=e,this.minGallop=7,this.length=t.length,this.tmpStorageLength=256,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength),this.stackSize=0}e.exports=i.default},{}],380:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;for(var n=Array(8),r=0;r<8;++r)n[r]=[];function s(t){var e,i=(65535<t)<<4;return(i|=e=(255<(t>>>=i))<<3)|(e=(15<(t>>>=e))<<2)|(e=(3<(t>>>=e))<<1)|t>>>e>>1}function a(t){var t=function(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}(t),e=n[s(t)>>2];return 0<e.length?e.pop():new ArrayBuffer(t)}i.default={alloc_int8:function(t){var e=new Int8Array(a(t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint8:function(t){var e=new Uint8Array(a(t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_int16:function(t){var e=new Int16Array(a(2*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint16:function(t){var e=new Uint16Array(a(2*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_int32:function(t){var e=new Int32Array(a(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint32:function(t){var e=new Uint32Array(a(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_float32:function(t){var e=new Float32Array(a(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_float64:function(t){var e=new Float64Array(a(8*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_dataview:function(t){var e=new DataView(a(t),0,t);return e.length!==t?e.subarray(0,t):e},free:function(t){t=t.buffer,n[s(t.byteLength)>>2].push(t)},reset:function(){for(var t=Array(8),e=0;e<8;++e)t[e]=[]}},e.exports=i.default},{}],381:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e){for(var i,n=t.length,r=e^n,s=0;4<=n;)i=1540483477*(65535&(i=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16),n-=4,++s;switch(n){case 3:r^=(255&t.charCodeAt(s+2))<<16;case 2:r^=(255&t.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return((r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16))^r>>>15)>>>0},e.exports=i.default},{}],382:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("../../core/value-types"),n=s(t("../core/base-renderer")),l=s(t("../enums")),t=t("../memop");function s(t){return t&&t.__esModule?t:{default:t}}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var o,h=new Float32Array(16),c=new Float32Array(16),u=new Float32Array(16),_=new Float32Array(16),d=new Float32Array(4),f=new Float32Array(64),p=[],m=new Float32Array(4),y=new r.Vec4(0,0,0,0),g=new r.Vec3(0,0,0),v=new r.Vec3(0,0,0),b=new t.RecyclePool(function(){return new Float32Array(16)},8),t=(o=n.default,t=o,(n=x).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=x.prototype).reset=function(){b.reset(),o.prototype.reset.call(this)},n.render=function(t,e){this.reset(),this._time[0]+=e,this._device.setUniform("cc_time",this._time),this._updateLights(t);for(var i=this._device._gl.canvas,n=0;n<t._cameras.length;++n){var r=this._requestView(),s=i.width,a=i.height;t._cameras.data[n].extractView(r,s,a)}this._viewPools.sort(function(t,e){return t._priority-e._priority});for(var o=0;o<this._viewPools.length;++o){var l=this._viewPools.data[o];this._render(l,t)}},n.renderCamera=function(t,e){this.reset();var i=this._device._gl.canvas,n=i.width,i=i.height,r=this._requestView();t.extractView(r,n,i),this._render(r,e)},n._updateLights=function(t){this._lights.length=0,this._shadowLights.length=0;for(var e=t._lights,i=0;i<e.length;++i){var n,r=e.data[i];r.update(this._device),r.shadowType!==l.default.SHADOW_NONE?(this._shadowLights.length<2&&this._shadowLights.splice(0,0,r),n=this._requestView(),r.extractView(n,["shadowcast"]),this._lights.splice(0,0,r)):this._lights.push(r)}this._updateLightDefines(),this._numLights=e._count},n._updateLightDefines=function(){for(var t=this._defines,e=0;e<this._lights.length;++e){var i=this._lights[e];t["CC_LIGHT_"+e+"_TYPE"]=i._type,t["CC_SHADOW_"+e+"_TYPE"]=i._shadowType}t.CC_NUM_LIGHTS=Math.min(4,this._lights.length),t.CC_NUM_SHADOW_LIGHTS=Math.min(4,this._shadowLights.length)},n._submitLightsUniforms=function(){var t=this._device;if(0<this._lights.length){for(var e=b.add(),i=b.add(),n=b.add(),r=Math.min(4,this._lights.length),s=0;s<r;++s){var a=this._lights[s],o=4*s;n.set(a._colorUniform,o),i.set(a._directionUniform,o),e.set(a._positionUniform,o),e[3+o]=a._range,a._type===l.default.LIGHT_SPOT?(i[3+o]=a._spotUniform[0],n[3+o]=a._spotUniform[1]):(i[3+o]=0,n[3+o]=0)}t.setUniform("cc_lightDirection",i),t.setUniform("cc_lightColor",n),t.setUniform("cc_lightPositionAndRange",e)}},n._submitShadowStageUniforms=function(t){var e=t._shadowLight,i=m;i[0]=e.shadowMinDepth,i[1]=e.shadowMaxDepth,i[2]=e.shadowDepthScale,i[3]=e.shadowDarkness,this._device.setUniform("cc_shadow_map_lightViewProjMatrix",r.Mat4.toArray(_,t._matViewProj)),this._device.setUniform("cc_shadow_map_info",i),this._device.setUniform("cc_shadow_map_bias",e.shadowBias),this._defines.CC_SHADOW_TYPE=e._shadowType},n._submitOtherStagesUniforms=function(){for(var t=b.add(),e=0;e<this._shadowLights.length;++e){var i=this._shadowLights[e],n=(n=p[e])||(p[e]=new Float32Array(f.buffer,64*e,16)),n=(r.Mat4.toArray(n,i.viewProjMatrix),4*e);t[n]=i.shadowMinDepth,t[1+n]=i.shadowMaxDepth,t[2+n]=i._shadowResolution,t[3+n]=i.shadowDarkness}this._device.setUniform("cc_shadow_lightViewProjMatrix",f),this._device.setUniform("cc_shadow_info",t)},n._sortItems=function(t){t.sort(function(t,e){return t.passes.length!==e.passes.length?t.passes.length-e.passes.length:t.sortKey-e.sortKey})},n._shadowStage=function(t,e){this._submitShadowStageUniforms(t);for(var i=0;i<e.length;++i){var n=e.data[i];n.effect.getDefine("CC_CASTING_SHADOW")&&this._draw(n)}},n._drawItems=function(t,e){var i=this._shadowLights;if(0===i.length&&0===this._numLights)for(var n=0;n<e.length;++n){var r=e.data[n];this._draw(r)}else for(var s=0;s<e.length;++s){for(var a=e.data[s],o=0;o<i.length;++o)this._device.setTexture("cc_shadow_map_"+o,i[o].shadowMap,this._allocTextureUnit());this._draw(a)}},n._opaqueStage=function(t,e){t.getPosition(y),this._device.setUniform("cc_matView",r.Mat4.toArray(h,t._matView)),this._device.setUniform("cc_matViewInv",r.Mat4.toArray(c,t._matViewInv)),this._device.setUniform("cc_matpProj",r.Mat4.toArray(u,t._matProj)),this._device.setUniform("cc_matViewProj",r.Mat4.toArray(_,t._matViewProj)),this._device.setUniform("cc_cameraPos",r.Vec4.toArray(d,y)),this._submitLightsUniforms(),this._submitOtherStagesUniforms(),this._drawItems(t,e)},n._transparentStage=function(t,e){t.getPosition(y),t.getForward(g),this._device.setUniform("cc_matView",r.Mat4.toArray(h,t._matView)),this._device.setUniform("cc_matViewInv",r.Mat4.toArray(c,t._matViewInv)),this._device.setUniform("cc_matpProj",r.Mat4.toArray(u,t._matProj)),this._device.setUniform("cc_matViewProj",r.Mat4.toArray(_,t._matViewProj)),this._device.setUniform("cc_cameraPos",r.Vec4.toArray(d,y)),this._submitLightsUniforms(),this._submitOtherStagesUniforms();for(var i=0;i<e.length;++i){var n=e.data[i];n.node.getWorldPosition(v),r.Vec3.sub(v,v,y),n.sortKey=-r.Vec3.dot(v,g)}this._sortItems(e),this._drawItems(t,e)},x);function x(t,e){return(t=o.call(this,t,e)||this)._time=new Float32Array(4),t._lights=[],t._shadowLights=[],t._numLights=0,t._defines={},t._registerStage("shadowcast",t._shadowStage.bind(a(t))),t._registerStage("opaque",t._opaqueStage.bind(a(t))),t._registerStage("transparent",t._transparentStage.bind(a(t))),t}i.default=t,e.exports=i.default},{"../../core/value-types":330,"../core/base-renderer":352,"../enums":358,"../memop":375}],383:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var o=t("../../core/value-types"),l=t("../../core/geom-utils"),h=(t=t("../enums"))&&t.__esModule?t:{default:t};function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r,s=new o.Mat4,a=new o.Mat4,c=new o.Mat4,u=new o.Mat4,_=new o.Mat4,d=new o.Mat4,f=new o.Vec3,p=new o.Vec3,m=((t=y.prototype).setCullingMask=function(t){this._cullingMask=t},t.getNode=function(){return this._node},t.setNode=function(t){this._node=t},t.getType=function(){return this._projection},t.setType=function(t){this._projection=t},t.getPriority=function(){return this._priority},t.setPriority=function(t){this._priority=t},t.getOrthoHeight=function(){return this._orthoHeight},t.setOrthoHeight=function(t){this._orthoHeight=t},t.getFov=function(){return this._fov},t.setFov=function(t){this._fov=t},t.getNear=function(){return this._near},t.setNear=function(t){this._near=t},t.getFar=function(){return this._far},t.setFar=function(t){this._far=t},t.getColor=function(t){return o.Vec4.copy(t,this._color)},t.setColor=function(t,e,i,n){o.Vec4.set(this._color,t,e,i,n)},t.getDepth=function(){return this._depth},t.setDepth=function(t){this._depth=t},t.getStencil=function(){return this._stencil},t.setStencil=function(t){this._stencil=t},t.getClearFlags=function(){return this._clearFlags},t.setClearFlags=function(t){this._clearFlags=t},t.getRect=function(t){return t.x=this._rect.x,t.y=this._rect.y,t.w=this._rect.w,t.h=this._rect.h,t},t.setRect=function(t,e,i,n){this._rect.x=t,this._rect.y=e,this._rect.w=i,this._rect.h=n},t.getStages=function(){return this._stages},t.setStages=function(t){this._stages=t},t.getFramebuffer=function(){return this._framebuffer},t.setFrameBuffer=function(t){this._framebuffer=t},t._calcMatrices=function(t,e){this._node.getWorldRT(c),o.Mat4.invert(a,c);var t=t/e;this._projection===h.default.PROJ_PERSPECTIVE?o.Mat4.perspective(u,this._fov,t,this._near,this._far):(e=this._orthoHeight*t,t=this._orthoHeight,o.Mat4.ortho(u,-e,e,-t,t,this._near,this._far)),o.Mat4.mul(_,u,a),o.Mat4.invert(d,_)},t.extractView=function(t,e,i){this._framebuffer&&(e=this._framebuffer._width,i=this._framebuffer._height),t._priority=this._priority,t._rect.x=this._rect.x*e,t._rect.y=this._rect.y*i,t._rect.w=this._rect.w*e,t._rect.h=this._rect.h*i,this.getColor(t._color),t._depth=this._depth,t._stencil=this._stencil,t._clearFlags=this._clearFlags,t._clearModel=this._clearModel,t._stages=this._stages,t._framebuffer=this._framebuffer,this._calcMatrices(e,i),o.Mat4.copy(t._matView,a),o.Mat4.copy(t._matViewInv,c),o.Mat4.copy(t._matProj,u),o.Mat4.copy(t._matViewProj,_),o.Mat4.copy(t._matInvViewProj,d),t._cullingMask=this._cullingMask},t.screenPointToRay=function(t,e,i,n,r){if(!cc.geomUtils)return r;r=r||new l.Ray,this._calcMatrices(i,n);var s=this._rect.x*i,a=this._rect.y*n,i=this._rect.w*i,n=this._rect.h*n;return o.Vec3.set(p,(t-s)/i*2-1,(e-a)/n*2-1,1),o.Vec3.transformMat4(p,p,d),this._projection===h.default.PROJ_PERSPECTIVE?this._node.getWorldPosition(f):(o.Vec3.set(f,(t-s)/i*2-1,(e-a)/n*2-1,-1),o.Vec3.transformMat4(f,f,d)),l.Ray.fromPoints(r,f,p)},t.screenToWorld=function(t,e,i,n){this._calcMatrices(i,n);var r=this._rect.x*i,s=this._rect.y*n,i=this._rect.w*i,n=this._rect.h*n;return this._projection===h.default.PROJ_PERSPECTIVE?(o.Vec3.set(t,(e.x-r)/i*2-1,(e.y-s)/n*2-1,.9999),o.Vec3.transformMat4(t,t,d),this._node.getWorldPosition(f),o.Vec3.lerp(t,f,t,(0,o.lerp)(this._near/this._far,1,e.z))):(o.Vec3.set(t,(e.x-r)/i*2-1,(e.y-s)/n*2-1,2*e.z-1),o.Vec3.transformMat4(t,t,d)),t},t.worldToScreen=function(t,e,i,n){this._calcMatrices(i,n);var r=this._rect.x*i,s=this._rect.y*n,i=this._rect.w*i,n=this._rect.h*n;return o.Vec3.transformMat4(t,e,_),t.x=r+.5*(t.x+1)*i,t.y=s+.5*(t.y+1)*n,t.z=.5*t.z+.5,t},t.worldMatrixToScreen=function(t,e,i,n){this._calcMatrices(i,n),o.Mat4.mul(t,_,e);e=i/2,i=n/2;return o.Mat4.identity(s),o.Mat4.transform(s,s,o.Vec3.set(f,e,i,0)),o.Mat4.scale(s,s,o.Vec3.set(f,e,i,1)),o.Mat4.mul(t,s,t),t},t=y,(m=[{key:"cullingMask",get:function(){return this._cullingMask},set:function(t){this._cullingMask=t}}])&&n(t.prototype,m),r&&n(t,r),y);function y(){this._poolID=-1,this._node=null,this._projection=h.default.PROJ_PERSPECTIVE,this._priority=0,this._color=new o.Vec4(.2,.3,.47,1),this._depth=1,this._stencil=0,this._clearFlags=h.default.CLEAR_COLOR|h.default.CLEAR_DEPTH,this._clearModel=null,this._stages=[],this._framebuffer=null,this._near=.01,this._far=1e3,this._fov=Math.PI/4,this._rect={x:0,y:0,w:1,h:1},this._orthoHeight=10,this._cullingMask=4294967295}i.default=m,e.exports=i.default},{"../../core/geom-utils":164,"../../core/value-types":330,"../enums":358}],384:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var l=t("../../core/value-types"),n=r(t("../gfx")),h=r(t("../enums"));function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=cc.v3(0,0,-1),o=cc.mat4(),c=l.Mat3.create(),u=cc.v3(0,0,0);(t=f.prototype).getNode=function(){return this._node},t.setNode=function(t){this._node=t},t.setColor=function(t,e,i){l.Vec3.set(this._color,t,e,i),this._colorUniform[0]=t*this._intensity,this._colorUniform[1]=e*this._intensity,this._colorUniform[2]=i*this._intensity},t.setIntensity=function(t){this._intensity=t,this._colorUniform[0]=t*this._color.x,this._colorUniform[1]=t*this._color.y,this._colorUniform[2]=t*this._color.z},t.setType=function(t){this._type=t},t.setSpotAngle=function(t){this._spotAngle=t,this._spotUniform[0]=Math.cos(.5*this._spotAngle)},t.setSpotExp=function(t){this._spotExp=t,this._spotUniform[1]=t},t.setRange=function(t){this._range=t},t.setShadowType=function(t){this._shadowType===h.default.SHADOW_NONE&&t!==h.default.SHADOW_NONE&&(this._shadowMapDirty=!0),this._shadowType=t},t.setShadowResolution=function(t){this._shadowResolution!==t&&(this._shadowMapDirty=!0),this._shadowResolution=t},t.setShadowBias=function(t){this._shadowBias=t},t.setShadowDarkness=function(t){this._shadowDarkness=t},t.setShadowMinDepth=function(t){this._shadowMinDepth=t},t.setShadowMaxDepth=function(t){this._shadowMaxDepth=t},t.setFrustumEdgeFalloff=function(t){this._frustumEdgeFalloff=t},t.setShadowFrustumSize=function(t){this._shadowFrustumSize=t},t.extractView=function(t,e){switch(t._shadowLight=this,t._priority=-1,t._rect.x=0,t._rect.y=0,t._rect.w=this._shadowResolution,t._rect.h=this._shadowResolution,l.Vec3.set(t._color,1,1,1),t._depth=1,t._stencil=1,t._clearFlags=h.default.CLEAR_COLOR|h.default.CLEAR_DEPTH,t._stages=e,t._framebuffer=this._shadowFrameBuffer,this._type){case h.default.LIGHT_SPOT:s=this,a=t._matView,o=t._matProj,s._node.getWorldRT(a),l.Mat4.invert(a,a),l.Mat4.perspective(o,s._spotAngle*s._spotAngleScale,1,s._shadowMinDepth,s._shadowMaxDepth);break;case h.default.LIGHT_DIRECTIONAL:a=this,o=t._matView,s=t._matProj,a._node.getWorldRT(o),l.Mat4.invert(o,o),o=a._shadowFrustumSize/2,l.Mat4.ortho(s,-o,o,-o,o,a._shadowMinDepth,a._shadowMaxDepth);break;case h.default.LIGHT_POINT:i=this,n=t._matView,r=t._matProj,i._node.getWorldRT(n),l.Mat4.invert(n,n),l.Mat4.perspective(r,(0,l.toRadian)(179),1,i._shadowMinDepth,i._shadowMaxDepth);break;case h.default.LIGHT_AMBIENT:break;default:console.warn("shadow of this light type is not supported")}var i,n,r,s,a,o;l.Mat4.mul(t._matViewProj,t._matProj,t._matView),this._viewProjMatrix=t._matViewProj,l.Mat4.invert(t._matInvViewProj,t._matViewProj),t._cullingMask=4294967295},t._updateLightPositionAndDirection=function(){this._node.getWorldMatrix(o),l.Mat3.fromMat4(c,o),l.Vec3.transformMat3(u,a,c),l.Vec3.toArray(this._directionUniform,u);var t=this._positionUniform,e=o.m;t[0]=e[12],t[1]=e[13],t[2]=e[14]},t._generateShadowMap=function(t){this._shadowMap=new n.default.Texture2D(t,{width:this._shadowResolution,height:this._shadowResolution,format:n.default.TEXTURE_FMT_RGBA8,wrapS:n.default.WRAP_CLAMP,wrapT:n.default.WRAP_CLAMP}),this._shadowDepthBuffer=new n.default.RenderBuffer(t,n.default.RB_FMT_D16,this._shadowResolution,this._shadowResolution),this._shadowFrameBuffer=new n.default.FrameBuffer(t,this._shadowResolution,this._shadowResolution,{colors:[this._shadowMap],depth:this._shadowDepthBuffer})},t._destroyShadowMap=function(){this._shadowMap&&(this._shadowMap.destroy(),this._shadowDepthBuffer.destroy(),this._shadowFrameBuffer.destroy(),this._shadowMap=null,this._shadowDepthBuffer=null,this._shadowFrameBuffer=null)},t.update=function(t){this._updateLightPositionAndDirection(),this._shadowType===h.default.SHADOW_NONE?this._destroyShadowMap():this._shadowMapDirty&&(this._destroyShadowMap(),this._generateShadowMap(t),this._shadowMapDirty=!1)},t=f,(d=[{key:"color",get:function(){return this._color}},{key:"intensity",get:function(){return this._intensity}},{key:"type",get:function(){return this._type}},{key:"spotAngle",get:function(){return this._spotAngle}},{key:"spotExp",get:function(){return this._spotExp}},{key:"range",get:function(){return this._range}},{key:"shadowType",get:function(){return this._shadowType}},{key:"shadowMap",get:function(){return this._shadowMap}},{key:"viewProjMatrix",get:function(){return this._viewProjMatrix}},{key:"shadowResolution",get:function(){return this._shadowResolution}},{key:"shadowBias",get:function(){return this._shadowBias}},{key:"shadowDarkness",get:function(){return this._shadowDarkness}},{key:"shadowMinDepth",get:function(){return this._type===h.default.LIGHT_DIRECTIONAL?1:this._shadowMinDepth}},{key:"shadowMaxDepth",get:function(){return this._type===h.default.LIGHT_DIRECTIONAL?1:this._shadowMaxDepth}},{key:"frustumEdgeFalloff",get:function(){return this._frustumEdgeFalloff}},{key:"shadowFrustumSize",get:function(){return this._shadowFrustumSize}}])&&s(t.prototype,d),_&&s(t,_);var _,d=f;function f(){this._poolID=-1,this._node=null,this._type=h.default.LIGHT_DIRECTIONAL,this._color=new l.Vec3(1,1,1),this._intensity=1,this._range=1,this._spotAngle=(0,l.toRadian)(60),this._spotExp=1,this._directionUniform=new Float32Array(3),this._positionUniform=new Float32Array(3),this._colorUniform=new Float32Array([this._color.x*this._intensity,this._color.y*this._intensity,this._color.z*this._intensity]),this._spotUniform=new Float32Array([Math.cos(.5*this._spotAngle),this._spotExp]),this._shadowType=h.default.SHADOW_NONE,this._shadowFrameBuffer=null,this._shadowMap=null,this._shadowMapDirty=!1,this._shadowDepthBuffer=null,this._shadowResolution=1024,this._shadowBias=5e-4,this._shadowDarkness=1,this._shadowMinDepth=1,this._shadowMaxDepth=1e3,this._frustumEdgeFalloff=0,this._viewProjMatrix=cc.mat4(),this._spotAngleScale=1,this._shadowFrustumSize=50}i.default=d,e.exports=i.default},{"../../core/value-types":330,"../enums":358,"../gfx":363}],385:[function(t,e,i){"use strict";var n;function r(){this._type="default",this._poolID=-1,this._node=null,this._inputAssembler=null,this._effect=null,this._viewID=-1,this._cameraID=-1,this._userKey=-1,this._castShadow=!1,this._boundingShape=null}i.__esModule=!0,i.default=void 0,(n=r.prototype).setNode=function(t){this._node=t},n.setInputAssembler=function(t){this._inputAssembler=t},n.setEffect=function(t){this._effect=t},n.setUserKey=function(t){this._userKey=t},n.extractDrawItem=function(t){t.model=this,t.node=this._node,t.ia=this._inputAssembler,t.effect=this._effect},i.default=r,e.exports=i.default},{}],386:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../memop");function r(t){this._lights=new n.FixedArray(16),this._models=new n.FixedArray(16),this._cameras=new n.FixedArray(16),this._debugCamera=null,this._app=t,this._views=[]}(t=r.prototype)._add=function(t,e){-1===e._poolID&&(t.push(e),e._poolID=t.length-1)},t._remove=function(t,e){-1!==e._poolID&&(t.data[t.length-1]._poolID=e._poolID,t.fastRemove(e._poolID),e._poolID=-1)},t.reset=function(){for(var t=0;t<this._models.length;++t)this._models.data[t]._viewID=-1},t.setDebugCamera=function(t){this._debugCamera=t},t.getCameraCount=function(){return this._cameras.length},t.getCamera=function(t){return this._cameras.data[t]},t.addCamera=function(t){this._add(this._cameras,t)},t.removeCamera=function(t){this._remove(this._cameras,t)},t.getModelCount=function(){return this._models.length},t.getModel=function(t){return this._models.data[t]},t.addModel=function(t){this._add(this._models,t)},t.removeModel=function(t){this._remove(this._models,t)},t.getLightCount=function(){return this._lights.length},t.getLight=function(t){return this._lights.data[t]},t.addLight=function(t){this._add(this._lights,t)},t.removeLight=function(t){this._remove(this._lights,t)},t.addView=function(t){-1===this._views.indexOf(t)&&this._views.push(t)},t.removeView=function(t){t=this._views.indexOf(t);-1!==t&&this._views.splice(t,1)},i.default=r,e.exports=i.default},{"../memop":375}],387:[function(t,e,i){"use strict";i.__esModule=!0,i.getInspectorProps=function(t){var e={type:t.type},t=(Object.assign(e,t.editor||t.inspector),e.defines=t.defines,e.value=_(e.type)(t.value),d(e.type));return e.typeName=f[t]||t,e.valueCtor=c[e.type],"cc.Texture2D"==e.typeName&&(e.typeName="cc.Asset",e.assetType="cc.Texture2D"),e},i.getClassName=i.getInstanceCtor=i.getInstanceType=i.enums2default=i.ctor2enums=void 0;var n,r=o(t("./enums")),s=t("../core/value-types"),a=o(t("../core/assets/CCTexture2D"));function o(t){return t&&t.__esModule?t:{default:t}}var t=t("./gfx/texture-2d"),l=cc.Object,h=((n={})[Boolean]=function(t){return t||!1},n[Number]=function(t){return t?ArrayBuffer.isView(t)?t[0]:t:0},n[s.Vec2]=function(t){return t?cc.v2(t[0],t[1]):cc.v2()},n[s.Vec3]=function(t){return t?cc.v3(t[0],t[1],t[2]):cc.v3()},n[s.Vec4]=function(t){return t?cc.v4(t[0],t[1],t[2],t[3]):cc.v4()},n[s.Color]=function(t){return t?cc.color(255*t[0],255*t[1],255*t[2],255*(t[3]||1)):cc.color()},n[s.Mat4]=function(t){return t?cc.mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]):cc.mat4()},n[a.default]=function(){return null},n[l]=function(){return null},n),c=((n={})[r.default.PARAM_INT]=Number,n[r.default.PARAM_INT2]=s.Vec2,n[r.default.PARAM_INT3]=s.Vec3,n[r.default.PARAM_INT4]=s.Vec4,n[r.default.PARAM_FLOAT]=Number,n[r.default.PARAM_FLOAT2]=s.Vec2,n[r.default.PARAM_FLOAT3]=s.Vec3,n[r.default.PARAM_FLOAT4]=s.Vec4,n[r.default.PARAM_MAT4]=s.Mat4,n[r.default.PARAM_TEXTURE_2D]=a.default,n.color=s.Color,n.number=Number,n.boolean=Boolean,n.default=l,n);(l={})[Number]=r.default.PARAM_FLOAT,l[s.Vec2]=r.default.PARAM_FLOAT2,l[s.Vec3]=r.default.PARAM_FLOAT3,l[s.Vec4]=r.default.PARAM_FLOAT4,l[s.Color]=r.default.PARAM_COLOR3,l[s.Color]=r.default.PARAM_COLOR4,l[s.Mat4]=r.default.PARAM_MAT4,l[a.default]=r.default.PARAM_TEXTURE_2D,l[t]=r.default.PARAM_TEXTURE_2D;function u(t){return c[t]||c.default}i.ctor2enums=l,(n={})[r.default.PARAM_INT]=new Uint32Array([0]),n[r.default.PARAM_INT2]=new Uint32Array([0,0]),n[r.default.PARAM_INT3]=new Uint32Array([0,0,0]),n[r.default.PARAM_INT4]=new Uint32Array([0,0,0,0]),n[r.default.PARAM_FLOAT]=new Float32Array([0]),n[r.default.PARAM_FLOAT2]=new Float32Array([0,0]),n[r.default.PARAM_FLOAT3]=new Float32Array([0,0,0]),n[r.default.PARAM_FLOAT4]=new Float32Array([0,0,0,0]),n[r.default.PARAM_MAT4]=cc.mat4().m,n[r.default.PARAM_TEXTURE_2D]=null,n.number=0,n.boolean=!1;var s=n,_=(i.enums2default=s,i.getInstanceType=u,function(t){return h[u(t)]}),d=(i.getInstanceCtor=_,function(t){return cc.js.getClassName(u(t))}),f=(i.getClassName=d,{Number:"number",Boolean:"boolean"})},{"../core/assets/CCTexture2D":92,"../core/value-types":330,"./enums":358,"./gfx/texture-2d":368}],388:[function(t,e,i){"use strict";var _=t("../compression/ZipUtils"),d=t("../compression/zlib.min"),n=t("../core/platform/js");function u(t){if(!t)return cc.color(0,0,0,255);var e;if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length)return e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,n=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16)||0,cc.color(i,n,r,e);var i=parseInt(t.substr(0,2),16)||0,n=parseInt(t.substr(2,2),16)||0,r=parseInt(t.substr(4,2),16)||0;return cc.color(i,n,r,255)}function z(t,e){for(var i=[],n=t.getElementsByTagName("properties"),r=0;r<n.length;++r)for(var s=n[r].getElementsByTagName("property"),a=0;a<s.length;++a)i.push(s[a]);e=e||{};for(var o=0;o<i.length;o++){var l=i[o],h=l.getAttribute("name"),c=l.getAttribute("type")||"string",l=l.getAttribute("value");"int"===c?l=parseInt(l):"float"===c?l=parseFloat(l):"bool"===c?l="true"===l:"color"===c&&(l=u(l)),e[h]=l}return e}t("../core/platform/CCSAXParser"),cc.TMXLayerInfo=function(){this.properties={},this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=cc.v2(0,0)},cc.TMXLayerInfo.prototype={constructor:cc.TMXLayerInfo,getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}},cc.TMXImageLayerInfo=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=cc.v2(0,0),this._opacity=0,this._trans=new cc.Color(255,255,255,255),this.sourceImage=null},cc.TMXObjectGroupInfo=function(){this.properties={},this.name="",this._objects=[],this.visible=!0,this._opacity=0,this._color=new cc.Color(255,255,255,255),this.offset=cc.v2(0,0),this._draworder="topdown"},cc.TMXObjectGroupInfo.prototype={constructor:cc.TMXObjectGroupInfo,getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}},cc.TMXTilesetInfo=function(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=null,this.imageSize=cc.size(0,0),this.tileOffset=cc.v2(0,0),this._tileSize=cc.size(0,0)},cc.TMXTilesetInfo.prototype={constructor:cc.TMXTilesetInfo,rectForGID:function(t,e){var e=e||cc.rect(0,0,0,0),i=(e.width=this._tileSize.width,e.height=this._tileSize.height,t=(t&=cc.TiledMap.TileFlag.FLIPPED_MASK)-parseInt(this.firstGid,10),parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10));return e.x=parseInt(t%i*(this._tileSize.width+this.spacing)+this.margin,10),e.y=parseInt(parseInt(t/i,10)*(this._tileSize.height+this.spacing)+this.margin,10),e}},cc.TMXMapInfo=function(t,e,i,n,r){this.properties=[],this.orientation=null,this.parentElement=null,this.parentGID=null,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=cc.TiledMap.RenderOrder.RightDown,this._supportVersion=[1,2,0],this._parser=new cc.SAXParser,this._objectGroups=[],this._allChildren=[],this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties={},this._tileAnimations={},this._tsxMap=null,this._textures=null,this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerTextures=null,this.initWithXML(t,e,i,n,r)},cc.TMXMapInfo.prototype={constructor:cc.TMXMapInfo,getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getStaggerAxis:function(){return this._staggerAxis},setStaggerAxis:function(t){this._staggerAxis=t},getStaggerIndex:function(){return this._staggerIndex},setStaggerIndex:function(t){this._staggerIndex=t},getHexSideLength:function(){return this._hexSideLength},setHexSideLength:function(t){this._hexSideLength=t},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._allChildren.push(t),this._layers.push(t)},getImageLayers:function(){return this._imageLayers},setImageLayers:function(t){this._allChildren.push(t),this._imageLayers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._allChildren.push(t),this._objectGroups.push(t)},getAllChildren:function(){return this._allChildren},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithXML:function(t,e,i,n,r){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxMap=e,this._textures=i,this._imageLayerTextures=r,this._textureSizes=n,this._objectGroups.length=0,this._allChildren.length=0,this.properties.length=0,this._tileProperties={},this._tileAnimations={},this.currentString="",this.storingCharacters=!1,this.layerAttrs=cc.TMXLayerInfo.ATTRIB_NONE,this.parentElement=cc.TiledMap.NONE,this.parseXMLString(t)},parseXMLString:function(t,e){var t=this._parser._parseXML(t).documentElement,i=t.getAttribute("orientation"),n=t.getAttribute("staggeraxis"),r=t.getAttribute("staggerindex"),s=t.getAttribute("hexsidelength"),a=t.getAttribute("renderorder"),o=t.getAttribute("version")||"1.0.0";if("map"===t.nodeName){for(var l=o.split("."),h=this._supportVersion,c=0;c<h.length;c++){var u=parseInt(l[c])||0;if(h[c]<u){cc.logID(7216,o);break}}"orthogonal"===i?this.orientation=cc.TiledMap.Orientation.ORTHO:"isometric"===i?this.orientation=cc.TiledMap.Orientation.ISO:"hexagonal"===i?this.orientation=cc.TiledMap.Orientation.HEX:null!==i&&cc.logID(7217,i),this.renderOrder="right-up"===a?cc.TiledMap.RenderOrder.RightUp:"left-up"===a?cc.TiledMap.RenderOrder.LeftUp:"left-down"===a?cc.TiledMap.RenderOrder.LeftDown:cc.TiledMap.RenderOrder.RightDown,"x"===n?this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_X):"y"===n&&this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_Y),"odd"===r?this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD):"even"===r&&this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_EVEN),s&&this.setHexSideLength(parseFloat(s));i=cc.size(0,0);i.width=parseFloat(t.getAttribute("width")),i.height=parseFloat(t.getAttribute("height")),this.setMapSize(i),(i=cc.size(0,0)).width=parseFloat(t.getAttribute("tilewidth")),i.height=parseFloat(t.getAttribute("tileheight")),this.setTileSize(i),this.properties=z(t)}var _=t.getElementsByTagName("tileset");for("map"!==t.nodeName&&(_=[]).push(t),R=0;R<_.length;R++){var d=_[R],f=d.getAttribute("source");if(f){var p=parseInt(d.getAttribute("firstgid")),f=this._tsxMap[f];f&&this.parseXMLString(f,p)}else{var f=d.getElementsByTagName("image"),m=1<f.length,y=f[0],g=y.getAttribute("source"),v=(g.replace(/\\/g,"/"),d.getElementsByTagName("tile")),b=v&&v.length||1,x=null,A=d.getAttribute("name")||"",F=parseInt(d.getAttribute("spacing"))||0,V=parseInt(d.getAttribute("margin"))||0,C=(C=parseInt(e))||parseInt(d.getAttribute("firstgid"))||0,T=cc.size(0,0),p=(T.width=parseFloat(d.getAttribute("tilewidth")),T.height=parseFloat(d.getAttribute("tileheight")),d.getElementsByTagName("tileoffset")[0]),S=cc.v2(0,0);p&&(S.x=parseFloat(p.getAttribute("x")),S.y=parseFloat(p.getAttribute("y")));for(var w=null,E=0;E<b;E++)if(w&&!m||((w=new cc.TMXTilesetInfo).name=A,w.firstGid=C,w.spacing=F,w.margin=V,w._tileSize=T,w.tileOffset=S,w.sourceImage=this._textures[g],w.imageSize=this._textureSizes[g]||w.imageSize,w.sourceImage||cc.errorID(7221,g),this.setTilesets(w)),x=v&&v[E]){this.parentGID=parseInt(C)+parseInt(x.getAttribute("id")||0);var M=x.getElementsByTagName("image"),M=(M&&0<M.length&&((M=(y=M[0]).getAttribute("source")).replace(/\\/g,"/"),w.sourceImage=this._textures[M],w.sourceImage||cc.errorID(7221,M),(M=cc.size(0,0)).width=parseFloat(y.getAttribute("width")),M.height=parseFloat(y.getAttribute("height")),w._tileSize=M,w.firstGid=this.parentGID),this._tileProperties[this.parentGID]=z(x),x.getElementsByTagName("animation"));if(M&&0<M.length)for(var D=M[0].getElementsByTagName("frame"),M={frames:[],dt:0,frameIdx:0},N=(this._tileAnimations[this.parentGID]=M).frames,B=0;B<D.length;B++){var I=D[B],k=parseInt(C)+parseInt(I.getAttribute("tileid")),I=parseFloat(I.getAttribute("duration"));N.push({tileid:k,duration:I/1e3,grid:null})}}}}for(var P=t.childNodes,R=0;R<P.length;R++){var O,L=P[R];this._shouldIgnoreNode(L)||("imagelayer"===L.nodeName&&(O=this._parseImageLayer(L))&&this.setImageLayers(O),"layer"===L.nodeName&&(O=this._parseLayer(L),this.setLayers(O)),"objectgroup"===L.nodeName&&(L=this._parseObjectGroup(L),this.setObjectGroups(L)))}return t},_shouldIgnoreNode:function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},_parseImageLayer:function(t){var e=t.getElementsByTagName("image");if(!e||0==e.length)return null;var i=new cc.TMXImageLayerInfo,n=(i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0,t.getAttribute("visible")),n=(i.visible=!("0"===n),t.getAttribute("opacity")||1),t=(i.opacity=parseInt(255*parseFloat(n))||255,e[0]),n=t.getAttribute("source");return i.sourceImage=this._imageLayerTextures[n],i.width=parseInt(t.getAttribute("width"))||0,i.height=parseInt(t.getAttribute("height"))||0,i.trans=u(t.getAttribute("trans")),i.sourceImage?i:(cc.errorID(7221,n),null)},_parseLayer:function(t){var e=t.getElementsByTagName("data")[0],i=new cc.TMXLayerInfo,n=(i.name=t.getAttribute("name"),cc.size(0,0)),n=(n.width=parseFloat(t.getAttribute("width")),n.height=parseFloat(t.getAttribute("height")),i._layerSize=n,t.getAttribute("visible")),n=(i.visible=!("0"===n),t.getAttribute("opacity")||1);i._opacity=n?parseInt(255*parseFloat(n)):255,i.offset=cc.v2(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);for(var r="",s=0;s<e.childNodes.length;s++)r+=e.childNodes[s].nodeValue;var r=r.trim(),n=e.getAttribute("compression"),a=e.getAttribute("encoding");if(n&&"gzip"!==n&&"zlib"!==n)return cc.logID(7218),null;switch(n){case"gzip":o=_.unzipBase64AsArray(r,4);break;case"zlib":o=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],n=0;n<e;n++){var r=4*n;i[n]=t[r]+256*t[1+r]+65536*t[2+r]+t[3+r]*(1<<24)}return i}(new d.Inflate(_.Base64.decodeAsArray(r,1)).decompress());break;case null:case"":if("base64"===a)o=_.Base64.decodeAsArray(r,4);else if("csv"===a)for(var o=[],l=r.split(","),h=0;h<l.length;h++)o.push(parseInt(l[h]));else{var c=e.getElementsByTagName("tile");o=[];for(var u=0;u<c.length;u++)o.push(parseInt(c[u].getAttribute("gid")))}break;default:this.layerAttrs===cc.TMXLayerInfo.ATTRIB_NONE&&cc.logID(7219)}return o&&(i._tiles=new Uint32Array(o)),i.properties=z(t),i},_parseObjectGroup:function(t){var e=new cc.TMXObjectGroupInfo,i=(e.name=t.getAttribute("name")||"",e.offset=cc.v2(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety"))),t.getAttribute("opacity")||1),i=(e._opacity=i?parseInt(255*parseFloat(i)):255,t.getAttribute("visible")),i=(i&&0===parseInt(i)&&(e.visible=!1),t.getAttribute("color")),i=(i&&e._color.fromHEX(i),t.getAttribute("draworder")),n=(i&&(e._draworder=i),e.setProperties(z(t)),t.getElementsByTagName("object"));if(n){for(var r=0;r<n.length;r++){var s=n[r],a={},o=(a.id=s.getAttribute("id")||r,a.name=s.getAttribute("name")||"",a.width=parseFloat(s.getAttribute("width"))||0,a.height=parseFloat(s.getAttribute("height"))||0,a.x=parseFloat(s.getAttribute("x"))||0,a.y=parseFloat(s.getAttribute("y"))||0,a.rotation=parseFloat(s.getAttribute("rotation"))||0,z(s,a),s.getAttribute("visible")),o=(a.visible=!(o&&0===parseInt(o)),s.getElementsByTagName("text")),o=(o&&0<o.length&&(o=o[0],a.type=cc.TiledMap.TMXObjectType.TEXT,a.wrap="1"==o.getAttribute("wrap"),a.color=u(o.getAttribute("color")),a.halign=function(t){var e=cc.Label.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}(o.getAttribute("halign")),a.valign=function(t){var e=cc.Label.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}(o.getAttribute("valign")),a.pixelsize=parseInt(o.getAttribute("pixelsize"))||16,a.text=o.childNodes[0].nodeValue),s.getAttribute("gid")),o=(o&&(a.gid=parseInt(o),a.type=cc.TiledMap.TMXObjectType.IMAGE),s.getElementsByTagName("ellipse")),o=(o&&0<o.length&&(a.type=cc.TiledMap.TMXObjectType.ELLIPSE),s.getElementsByTagName("polygon")),o=(o&&0<o.length&&(a.type=cc.TiledMap.TMXObjectType.POLYGON,(o=o[0].getAttribute("points"))&&(a.points=this._parsePointsString(o))),s.getElementsByTagName("polyline"));o&&0<o.length&&(a.type=cc.TiledMap.TMXObjectType.POLYLINE,(s=o[0].getAttribute("points"))&&(a.polylinePoints=this._parsePointsString(s))),a.type||(a.type=cc.TiledMap.TMXObjectType.RECT),e._objects.push(a)}"index"!==i&&e._objects.sort(function(t,e){return t.y-e.y})}return e},_parsePointsString:function(t){if(!t)return null;for(var e=[],i=t.split(" "),n=0;n<i.length;n++){var r=i[n].split(",");e.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return e},setTileAnimations:function(t){this._tileAnimations=t},getTileAnimations:function(){return this._tileAnimations},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties=t},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t}};t=cc.TMXMapInfo.prototype;n.getset(t,"mapWidth",t._getMapWidth,t._setMapWidth),n.getset(t,"mapHeight",t._getMapHeight,t._setMapHeight),n.getset(t,"tileWidth",t._getTileWidth,t._setTileWidth),n.getset(t,"tileHeight",t._getTileHeight,t._setTileHeight),cc.TMXLayerInfo.ATTRIB_NONE=1,cc.TMXLayerInfo.ATTRIB_BASE64=2,cc.TMXLayerInfo.ATTRIB_GZIP=4,cc.TMXLayerInfo.ATTRIB_ZLIB=8},{"../compression/ZipUtils":22,"../compression/zlib.min":25,"../core/platform/CCSAXParser":237,"../core/platform/js":250}],389:[function(t,e,i){"use strict";var n=t("../core/value-types"),l=(r=t("../core/assets/material/material-variant"))&&r.__esModule?r:{default:r},r=t("../core/components/CCRenderComponent"),h=t("../core/assets/material/CCMaterial"),s=t("../core/renderer/render-flow"),a=cc.mat4(),o=cc.v2(),c=cc.v2(),u={row:0,col:0},_=cc.Class({name:"cc.TiledUserNodeData",extends:cc.Component,ctor:function(){this._index=-1,this._row=-1,this._col=-1,this._tiledLayer=null}}),t=cc.Class({name:"cc.TiledLayer",extends:r,editor:{inspector:"packages://inspector/inspectors/comps/tiled-layer.js"},ctor:function(){this._userNodeGrid={},this._userNodeMap={},this._userNodeDirty=!1,this._tiledTiles=[],this._tilesetIndexArr=[],this._texIdToMatIndex={},this._viewPort={x:-1,y:-1,width:-1,height:-1},this._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},this._cullingDirty=!0,this._rightTop={row:-1,col:-1},this._layerInfo=null,this._mapInfo=null,this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._tiles=[],this._vertices=[],this._verticesDirty=!0,this._layerName="",this._layerOrientation=null,this._texGrids=null,this._textures=null,this._tilesets=null,this._leftDownToCenterX=0,this._leftDownToCenterY=0,this._hasTiledNodeGrid=!1,this._hasAniGrid=!1,this._animations=null,this._enableCulling=cc.macro.ENABLE_TILEDMAP_CULLING},_hasTiledNode:function(){return this._hasTiledNodeGrid},_hasAnimation:function(){return this._hasAniGrid},enableCulling:function(t){this._enableCulling!=t&&(this._enableCulling=t,this._cullingDirty=!0)},addUserNode:function(t){var e=t.getComponent(_);return e?(cc.warn("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(_),t.parent=this.node,t._renderFlag|=s.FLAG_BREAK_FLOW,(this._userNodeMap[t._id]=e)._row=-1,e._col=-1,(e._tiledLayer=this)._nodeLocalPosToLayerPos(t,o),this._positionToRowCol(o.x,o.y,u),this._addUserNodeToGrid(e,u),this._updateCullingOffsetByUserNode(t),t.on(cc.Node.EventType.POSITION_CHANGED,this._userNodePosChange,e),t.on(cc.Node.EventType.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},removeUserNode:function(t){var e=t.getComponent(_);return e?(t.off(cc.Node.EventType.POSITION_CHANGED,this._userNodePosChange,e),t.off(cc.Node.EventType.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t._id],t._removeComponent(e),e.destroy(),t.removeFromParent(!0),t._renderFlag&=~s.FLAG_BREAK_FLOW,!0):(cc.warn("CCTiledLayer:removeUserNode node is not exist"),!1)},destroyUserNode:function(t){this.removeUserNode(t),t.destroy()},_nodeLocalPosToLayerPos:function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},_getNodesByRowCol:function(t,e){t=this._userNodeGrid[t];return t?t[e]:null},_getNodesCountByRow:function(t){t=this._userNodeGrid[t];return t?t.count:0},_updateAllUserNode:function(){for(var t in this._userNodeGrid={},this._userNodeMap){t=this._userNodeMap[t];this._nodeLocalPosToLayerPos(t.node,o),this._positionToRowCol(o.x,o.y,u),this._addUserNodeToGrid(t,u),this._updateCullingOffsetByUserNode(t.node)}},_updateCullingOffsetByUserNode:function(t){this._topOffset<t.height&&(this._topOffset=t.height),this._downOffset<t.height&&(this._downOffset=t.height),this._leftOffset<t.width&&(this._leftOffset=t.width),this._rightOffset<t.width&&(this._rightOffset=t.width)},_userNodeSizeChange:function(){var t=this.node;this._tiledLayer._updateCullingOffsetByUserNode(t)},_userNodePosChange:function(){var t=this.node,e=this._tiledLayer;e._nodeLocalPosToLayerPos(t,o),e._positionToRowCol(o.x,o.y,u),e._limitInLayer(u),u.row===this._row&&u.col===this._col||(e._removeUserNodeFromGrid(this),e._addUserNodeToGrid(this,u))},_removeUserNodeFromGrid:function(t){var e=t._row,i=t._col,n=t._index,e=this._userNodeGrid[e],i=e&&e[i];i&&(e.count--,i.count--,i.list[n]=null,i.count<=0&&(i.list.length=0,i.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0},_limitInLayer:function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},_addUserNodeToGrid:function(t,e){var i=e.row,e=e.col,n=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},r=n[e]=n[e]||{count:0,list:[]};t._row=i,t._col=e,t._index=r.list.length,n.count++,r.count++,r.list.push(t),this._userNodeDirty=!0},_isUserNodeDirty:function(){return this._userNodeDirty},_setUserNodeDirty:function(t){this._userNodeDirty=t},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this),this._activateMaterial()},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},_syncAnchorPoint:function(){var t=this.node;this._leftDownToCenterX=t.width*t.anchorX*t.scaleX,this._leftDownToCenterY=t.height*t.anchorY*t.scaleY,this._cullingDirty=!0},onDestroy:function(){this._super(),this._buffer&&(this._buffer.destroy(),this._buffer=null),this._renderDataList=null},getLayerName:function(){return this._layerName},setLayerName:function(t){this._layerName=t},getProperty:function(t){return this._properties[t]},getPositionAt:function(t,e){var i,n;switch(e=void 0!==e?(i=Math.floor(t),Math.floor(e)):(i=Math.floor(t.x),Math.floor(t.y)),this._layerOrientation){case cc.TiledMap.Orientation.ORTHO:n=this._positionForOrthoAt(i,e);break;case cc.TiledMap.Orientation.ISO:n=this._positionForIsoAt(i,e);break;case cc.TiledMap.Orientation.HEX:n=this._positionForHexAt(i,e)}return n},_isInvalidPosition:function(t,e){var i;return t&&"object"==typeof t&&(e=(i=t).y,t=i.x),t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},_positionForIsoAt:function(t,e){var i=0,n=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,r=this._tiles[r];return r&&(i=(r=this._texGrids[r].tileset.tileOffset).x,n=r.y),cc.v2(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+i,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-n)},_positionForOrthoAt:function(t,e){var i=0,n=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,r=this._tiles[r];return r&&(i=(r=this._texGrids[r].tileset.tileOffset).x,n=r.y),cc.v2(t*this._mapTileSize.width+i,(this._layerSize.height-e-1)*this._mapTileSize.height-n)},_positionForHexAt:function(t,e){var i=this._mapTileSize.width,n=this._mapTileSize.height,r=this._layerSize.height,s=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=this._tiles[s],a=this._texGrids[s].tileset.tileOffset,o=this._staggerIndex===cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD?1:-1,l=0,h=0;switch(this._staggerAxis){case cc.TiledMap.StaggerAxis.STAGGERAXIS_Y:l=t*i+(e%2==1?i/2*o:0)+a.x,h=(r-e-1)*(n-(n-this._hexSideLength)/2)-a.y;break;case cc.TiledMap.StaggerAxis.STAGGERAXIS_X:l=t*(i-(i-this._hexSideLength)/2)+a.x,h=(r-e-1)*n+(t%2==1?n/2*-o:0)-a.y}return cc.v2(l,h)},setTileGIDAt:function(t,e,i,n){if(void 0===e)throw new Error("cc.TiledLayer.setTileGIDAt(): pos should be non-null");var r;if(void 0===n&&e instanceof cc.Vec2?(r=e,n=i):r=cc.v2(e,i),r.x=Math.floor(r.x),r.y=Math.floor(r.y),this._isInvalidPosition(r))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this._tiles&&this._tilesets&&0!=this._tilesets.length?0!==t&&t<this._tilesets[0].firstGid?cc.logID(7239,t):(n=n||0,e=this.getTileFlagsAt(r),this.getTileGIDAt(r)===t&&e===n||this._updateTileForGID((t|n)>>>0,r)):cc.logID(7238)},_updateTileForGID:function(t,e){0!==t&&!this._texGrids[t]||(e=0|e.x+e.y*this._layerSize.width)<this._tiles.length&&(this._tiles[e]=t,this._cullingDirty=!0)},getTileGIDAt:function(t,e){if(void 0===t)throw new Error("cc.TiledLayer.getTileGIDAt(): pos should be non-null");var i=t;if(void 0===e&&(i=t.x,e=t.y),this._isInvalidPosition(i,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this._tiles)return cc.logID(7237),null;t=Math.floor(i)+Math.floor(e)*this._layerSize.width;return(this._tiles[t]&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0},getTileFlagsAt:function(t,e){if(!t)throw new Error("TiledLayer.getTileFlagsAt: pos should be non-null");if(void 0!==e&&(t=cc.v2(t,e)),this._isInvalidPosition(t))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this._tiles)return cc.logID(7240),null;e=Math.floor(t.x)+Math.floor(t.y)*this._layerSize.width;return(this._tiles[e]&cc.TiledMap.TileFlag.FLIPPED_ALL)>>>0},_setCullingDirty:function(t){this._cullingDirty=t},_isCullingDirty:function(){return this._cullingDirty},_updateViewPort:function(t,e,i,n){var r,s,a;this._viewPort.width===i&&this._viewPort.height===n&&this._viewPort.x===t&&this._viewPort.y===e||(this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=n,t=1,this._layerOrientation===cc.TiledMap.Orientation.ISO&&(t=2),e=this._viewPort.x-this._offset.x+this._leftDownToCenterX,a=this._viewPort.y-this._offset.y+this._leftDownToCenterY,r=e-this._leftOffset,s=a-this._downOffset,e=e+i+this._rightOffset,i=a+n+this._topOffset,a=this._cullingRect.leftDown,n=this._cullingRect.rightTop,this._positionToRowCol(r=r<0?0:r,s=s<0?0:s,u),u.row-=t,u.col-=t,u.row=0<u.row?u.row:0,u.col=0<u.col?u.col:0,u.row===a.row&&u.col===a.col||(a.row=u.row,a.col=u.col,this._cullingDirty=!0),e<0||i<0?(u.row=-1,u.col=-1):(this._positionToRowCol(e,i,u),u.row++,u.col++),u.row>this._rightTop.row&&(u.row=this._rightTop.row),u.col>this._rightTop.col&&(u.col=this._rightTop.col),u.row===n.row&&u.col===n.col||(n.row=u.row,n.col=u.col,this._cullingDirty=!0))},_positionToRowCol:function(t,e,i){var n,r=cc.TiledMap,s=r.Orientation,a=r.StaggerAxis,o=this._mapTileSize.width,l=this._mapTileSize.height,h=.5*o,c=.5*l,u=0,_=0,d=this._staggerAxis;switch(this._layerSize.width,this._layerOrientation){case s.ORTHO:_=Math.floor(t/o),u=Math.floor(e/l);break;case s.ISO:_=Math.floor(t/h),u=Math.floor(e/c);break;case s.HEX:d===a.STAGGERAXIS_Y?(n=(u=Math.floor(e/(l-this._diffY1)))%2==1?h*this._odd_even:0,_=Math.floor((t-n)/o)):(n=(_=Math.floor(t/(o-this._diffX1)))%2==1?c*-this._odd_even:0,u=Math.floor((e-n)/l))}return i.row=u,i.col=_,i},_updateCulling:function(){var t,e;this._enableCulling&&(this.node._updateWorldMatrix(),n.Mat4.invert(a,this.node._worldMatrix),t=cc.visibleRect,(e=cc.Camera.findCamera(this.node))&&(o.x=0,o.y=0,c.x=o.x+t.width,c.y=o.y+t.height,e.getScreenToWorldPoint(o,o),e.getScreenToWorldPoint(c,c),n.Vec2.transformMat4(o,o,a),n.Vec2.transformMat4(c,c,a),this._updateViewPort(o.x,o.y,c.x-o.x,c.y-o.y)))},getLayerOrientation:function(){return this._layerOrientation},getProperties:function(){return this._properties},_updateVertices:function(){var t=cc.TiledMap,e=t.TileFlag.FLIPPED_MASK,i=t.StaggerAxis,n=t.Orientation,r=this._vertices,s=(r.length=0,this._layerOrientation),a=this._tiles;if(a){var o=this._rightTop;o.row=-1,o.col=-1;var l,h,c,u,_,d,f=this._mapTileSize.width,p=this._mapTileSize.height,m=.5*f,y=.5*p,g=this._layerSize.height,v=this._layerSize.width,b=this._texGrids,x=0,A=(s===n.HEX&&(c=this._staggerAxis,u=this._diffX1,_=this._diffY1,d=this._odd_even),0),C=0;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var T,S,w=0,E=0,M=0;M<g;++M){for(var D=0;D<v;++D){var B=x+D,I=b[P=(a[B]&e)>>>0];if(this._animations[P]&&(this._hasAniGrid=!0),I){switch(s){case n.ORTHO:l=(A=D)*f,h=(C=g-M-1)*p;break;case n.ISO:l=m*(A=g+D-M-1),h=y*(C=g+v-D-M-2);break;case n.HEX:l=D*(f-u)+(c===i.STAGGERAXIS_Y&&M%2==1?m*d:0),h=(g-M-1)*(p-_)+(c===i.STAGGERAXIS_X&&D%2==1?y*-d:0),A=D,C=g-M-1}var P=r[C]=r[C]||{minCol:0,maxCol:0},R=P[A]=P[A]||{};P.minCol>A&&(P.minCol=A),P.maxCol<A&&(P.maxCol=A),o.row<C&&(o.row=C),o.col<A&&(o.col=A),P=I.tileset.tileOffset,l+=this._offset.x+P.x,h+=this._offset.y-P.y,w=(w=-P.y+I.tileset._tileSize.height-p)<0?0:w,T=P.y<0?0:P.y,S=-P.x<0?0:-P.x,E=(E=P.x+I.tileset._tileSize.width-f)<0?0:E,this._rightOffset<S&&(this._rightOffset=S),this._leftOffset<E&&(this._leftOffset=E),this._topOffset<T&&(this._topOffset=T),this._downOffset<w&&(this._downOffset=w),R.left=l,R.bottom=h,R.index=B}}x+=v}this._verticesDirty=!1}},getTiledTileAt:function(t,e,i){if(this._isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this._tiles)return cc.logID(7236),null;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this._tiledTiles[n];return!n&&i&&((n=(i=new cc.Node).addComponent(cc.TiledTile))._x=t,n._y=e,n._layer=this,n._updateInfo(),i.parent=this.node),n},setTiledTileAt:function(t,e,i){if(this._isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this._tiles)return cc.logID(7236),null;t=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this._tiledTiles[t]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this._tiledTiles.some(function(t,e){return!!t}),i},getTexture:function(t){return t=t||0,this._textures&&0<=t&&this._textures.length>t?this._textures[t]:null},getTextures:function(){return this._textures},setTexture:function(t){this.setTextures([t])},setTextures:function(t){this._textures=t,this._activateMaterial()},getLayerSize:function(){return this._layerSize},getMapTileSize:function(){return this._mapTileSize},getTileSet:function(t){return t=t||0,this._tilesets&&0<=t&&this._tilesets.length>t?this._tilesets[t]:null},getTileSets:function(){return this._tilesets},setTileSet:function(t){this.setTileSets([t])},setTileSets:function(n){this._tilesets=n;for(var t=this._textures=[],r=this._texGrids=[],e=0;e<n.length;e++){var i=n[e];i&&(t[e]=i.sourceImage)}cc.TiledMap.loadAllTextures(t,function(){for(var t=0,e=n.length;t<e;++t){var i=n[t];i&&cc.TiledMap.fillTextureGrids(i,r,t)}this._prepareToRender()}.bind(this))},_traverseAllGrid:function(){for(var t=this._tiles,e=this._texGrids,i=this._tilesetIndexArr,n={},r=cc.TiledMap.TileFlag.FLIPPED_MASK,s=i.length=0;s<t.length;s++){var a,o=t[s];0!==o&&((a=e[o=(o&r)>>>0])?n[a=a.texId]||(n[a]=!0,i.push(a)):cc.error("CCTiledLayer:_traverseAllGrid grid is null, gid is:",o))}},_init:function(t,e,i,n,r){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var s,a,o,l=t._layerSize,l=(this._layerName=t.name,this._tiles=t._tiles,this._properties=t.properties,this._layerSize=l,this._minGID=t._minGID,this._maxGID=t._maxGID,this._opacity=t._opacity,this._renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=i,this._textures=n,this._texGrids=r,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize(),this._mapTileSize.width),i=this._mapTileSize.height,n=this._layerSize.width,r=this._layerSize.height;this._layerOrientation===cc.TiledMap.Orientation.HEX?(s=(e=cc.TiledMap).StaggerAxis,e=e.StaggerIndex,o=a=0,this._odd_even=this._staggerIndex===e.STAGGERINDEX_ODD?1:-1,this._staggerAxis===s.STAGGERAXIS_X?(this._diffX1=(l-this._hexSideLength)/2,this._diffY1=0,o=i*(r+.5),a=(l+this._hexSideLength)*Math.floor(n/2)+l*(n%2)):(this._diffX1=0,this._diffY1=(i-this._hexSideLength)/2,a=l*(n+.5),o=(i+this._hexSideLength)*Math.floor(r/2)+i*(r%2)),this.node.setContentSize(a,o)):this._layerOrientation===cc.TiledMap.Orientation.ISO?this.node.setContentSize(.5*l*(e=n+r),.5*i*e):this.node.setContentSize(n*l,r*i),this._offset=cc.v2(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},_prepareToRender:function(){this._updateVertices(),this._traverseAllGrid(),this._updateAllUserNode(),this._activateMaterial()},_activateMaterial:function(){var t=this._tilesetIndexArr;if(0!==t.length){for(var e=this._texIdToMatIndex={},i=this._textures,n=t.length,r=0;r<n;r++){var s=t[r],a=i[s],o=(o=this._materials[r])||h.getBuiltinMaterial("2d-sprite");(o=l.default.create(o,this)).define("CC_USE_MODEL",!0),o.setProperty("texture",a),this._materials[r]=o,e[s]=r}this._materials.length=n,this.markForRender(!0)}else this.disableRender()}});cc.TiledLayer=e.exports=t},{"../core/assets/material/CCMaterial":95,"../core/assets/material/material-variant":102,"../core/components/CCRenderComponent":131,"../core/renderer/render-flow":263,"../core/value-types":330}],390:[function(t,e,i){"use strict";t("./CCTMXXMLParser"),t("./CCTiledMapAsset"),t("./CCTiledLayer"),t("./CCTiledTile"),t("./CCTiledObjectGroup");var t=cc.Enum({ORTHO:0,HEX:1,ISO:2}),n=cc.Enum({NONE:0,MAP:1,LAYER:2,OBJECTGROUP:3,OBJECT:4,TILE:5}),r=cc.Enum({HORIZONTAL:2147483648,VERTICAL:1073741824,DIAGONAL:536870912,FLIPPED_ALL:4026531840,FLIPPED_MASK:268435455}),s=cc.Enum({STAGGERAXIS_X:0,STAGGERAXIS_Y:1}),a=cc.Enum({STAGGERINDEX_ODD:0,STAGGERINDEX_EVEN:1}),o=cc.Enum({RightDown:0,RightUp:1,LeftDown:2,LeftUp:3}),l=cc.Enum({RECT:0,ELLIPSE:1,POLYGON:2,POLYLINE:3,IMAGE:4,TEXT:5}),t=cc.Class({name:"cc.TiledMap",extends:cc.Component,editor:!1,ctor:function(){this._texGrids=[],this._textures=[],this._tilesets=[],this._animations=[],this._imageLayers=[],this._layers=[],this._groups=[],this._images=[],this._properties=[],this._tileProperties=[],this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0)},statics:{Orientation:t,Property:n,TileFlag:r,StaggerAxis:s,StaggerIndex:a,TMXObjectType:l,RenderOrder:o},properties:{_tmxFile:{default:null,type:cc.TiledMapAsset},tmxAsset:{get:function(){return this._tmxFile},set:function(t,e){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile())},type:cc.TiledMapAsset}},getMapSize:function(){return this._mapSize},getTileSize:function(){return this._tileSize},getMapOrientation:function(){return this._mapOrientation},getObjectGroups:function(){return this._groups},getObjectGroup:function(t){for(var e=this._groups,i=0,n=e.length;i<n;i++){var r=e[i];if(r&&r.getGroupName()===t)return r}return null},enableCulling:function(t){for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling(t)},getProperties:function(){return this._properties},getLayers:function(){return this._layers},getLayer:function(t){for(var e=this._layers,i=0,n=e.length;i<n;i++){var r=e[i];if(r&&r.getLayerName()===t)return r}return null},_changeLayer:function(t,e){for(var i=this._layers,n=0,r=i.length;n<r;n++){var s=i[n];if(s&&s.getLayerName()===t)return void(i[n]=e)}},getProperty:function(t){return this._properties[t.toString()]},getPropertiesForGID:function(t){return this._tileProperties[t]},__preload:function(){this._tmxFile&&this._applyFile()},onEnable:function(){this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},onDisable:function(){this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},_applyFile:function(){var t=this._tmxFile;if(t){for(var e=t.textures,i=t.textureNames,n=t.textureSizes,r={},s={},a=0;a<e.length;++a){var o=i[a];r[o]=e[a],s[o]=n[a]}for(var l={},e=t.imageLayerTextures,i=t.imageLayerTextureNames,h=0;h<e.length;++h)l[i[h]]=e[h];for(var c=t.tsxFileNames,u=t.tsxFiles,_={},d=0;d<c.length;++d)0<c[d].length&&(_[c[d]]=u[d].text);var t=new cc.TMXMapInfo(t.tmxXmlStr,_,r,s,l),f=t.getTilesets();f&&0!==f.length||cc.logID(7241),this._buildWithMapInfo(t)}else this._releaseMapInfo()},_releaseMapInfo:function(){for(var t=this._layers,e=0,i=t.length;e<i;e++)t[e].node.removeFromParent(!0),t[e].node.destroy();t.length=0;for(var n=this._groups,r=0,s=n.length;r<s;r++)n[r].node.removeFromParent(!0),n[r].node.destroy();n.length=0;for(var a=this._images,o=0,l=a.length;o<l;o++)a[o].removeFromParent(!0),a[o].destroy();a.length=0},_syncAnchorPoint:function(){for(var t=this.node.getAnchorPoint(),e=this.node.width*t.x,i=this.node.height*(1-t.y),n=0,r=this._layers.length;n<r;n++)this._layers[n].node.setAnchorPoint(t);for(n=0,r=this._groups.length;n<r;n++){var s=this._groups[n],a=s.node;a.anchorX=.5,a.anchorY=.5,a.x=s._offset.x-e+a.width*a.anchorX,a.y=s._offset.y+i-a.height*a.anchorY}for(n=0,r=this._images.length;n<r;n++){var o=this._images[n];o.anchorX=.5,o.anchorY=.5,o.x=o._offset.x-e+o.width*o.anchorX,o.y=o._offset.y+i-o.height*o.anchorY}},_fillAniGrids:function(t,e){for(var i in e){i=e[i];if(i)for(var n=i.frames,r=0;r<n.length;r++){var s=n[r];s.grid=t[s.tileid]}}},_buildLayerAndGroup:function(){for(var t=this._tilesets,e=this._texGrids,i=this._animations,n=e.length=0,r=t.length;n<r;++n){var s=t[n];s&&cc.TiledMap.fillTextureGrids(s,e,n)}this._fillAniGrids(e,i);for(var a=this._layers,o=this._groups,l=this._images,h={},c=0,u=a.length;c<u;c++)h[a[c].node._name]=!0;for(var _=0,d=o.length;_<d;_++)h[o[_].node._name]=!0;for(var f=0,p=l.length;f<p;f++)h[l[f]._name]=!0;var a=this._layers=[],o=this._groups=[],l=this._images=[],m=this._mapInfo,y=this.node,g=m.getAllChildren(),v=this._textures,b=0,x=0;if(g&&0<g.length)for(var A=0,C=g.length;A<C;A++){var T,S=g[A],w=S.name,E=this.node.getChildByName(w);h[w]=!1,E||((E=new cc.Node).name=w,y.addChild(E)),E.setSiblingIndex(A),E.active=S.visible,S instanceof cc.TMXLayerInfo?((w=(w=E.getComponent(cc.TiledLayer))||E.addComponent(cc.TiledLayer))._init(S,m,t,v,e),S.ownTiles=!1,a.push(w)):S instanceof cc.TMXObjectGroupInfo?((w=(w=E.getComponent(cc.TiledObjectGroup))||E.addComponent(cc.TiledObjectGroup))._init(S,m,e),o.push(w)):S instanceof cc.TMXImageLayerInfo&&(w=S.sourceImage,E.opacity=S.opacity,E.layerInfo=S,E._offset=cc.v2(S.offset.x,-S.offset.y),(T=(S=(S=E.getComponent(cc.Sprite))||E.addComponent(cc.Sprite)).spriteFrame||new cc.SpriteFrame).setTexture(w),S.spriteFrame=T,E.width=w.width,E.height=w.height,l.push(E)),b=Math.max(b,E.width),x=Math.max(x,E.height)}for(var M=y.children,D=0,B=M.length;D<B;D++){var I=M[D];h[I._name]&&I.destroy()}this.node.width=b,this.node.height=x,this._syncAnchorPoint()},_buildWithMapInfo:function(t){this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();for(var e=this._tilesets,i=[],n=this._textures.length=0,r=e.length;n<r;++n){var s=e[n];s&&s.sourceImage&&(this._textures[n]=s.sourceImage,i.push(s.sourceImage))}for(var a=0;a<this._imageLayers.length;a++){var o=this._imageLayers[a];o&&o.sourceImage&&i.push(o.sourceImage)}cc.TiledMap.loadAllTextures(i,function(){this._buildLayerAndGroup()}.bind(this))},update:function(t){var e,i=this._animations,n=this._texGrids;for(e in i){var r=i[e],s=r.frames,a=s[r.frameIdx];r.dt+=t,a.duration<r.dt&&(r.dt=0,r.frameIdx++,r.frameIdx>=s.length&&(r.frameIdx=0),a=s[r.frameIdx]),n[e]=a.grid}}});cc.TiledMap=e.exports=t,cc.TiledMap.loadAllTextures=function(t,e){var i=t.length;if(0!==i)for(var n=0,r=function(){++n>=i&&e()},s=0;s<i;s++){var a=t[s];a.loaded?r():a.once("load",function(){r()})}else e()},cc.TiledMap.fillTextureGrids=function(t,e,i){for(var n=t.sourceImage,r=(t.imageSize.width&&t.imageSize.height||(t.imageSize.width=n.width,t.imageSize.height=n.height),t._tileSize.width),s=t._tileSize.height,a=n.width,o=n.height,n=t.spacing,l=t.margin,h=Math.floor((a-2*l+n)/(r+n)),l=Math.floor((o-2*l+n)/(s+n))*h,c=t.firstGid,u=null,_=!!e[c],d=cc.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX?.5:0,f=t.firstGid+(l=l<=0?1:l);c<f&&((_=_&&!e[c]?!1:_)||!e[c]);++c)t.rectForGID(c,u={texId:i,tileset:t,x:0,y:0,width:r,height:s,t:0,l:0,r:0,b:0,gid:c}),u.x+=d,u.y+=d,u.width-=2*d,u.height-=2*d,u.t=u.y/o,u.l=u.x/a,u.r=(u.x+u.width)/a,u.b=(u.y+u.height)/o,e[c]=u},cc.js.obsolete(cc.TiledMap.prototype,"cc.TiledMap.tmxFile","tmxAsset",!0),cc.js.get(cc.TiledMap.prototype,"mapLoaded",function(){return cc.errorID(7203),[]},!1)},{"./CCTMXXMLParser":388,"./CCTiledLayer":389,"./CCTiledMapAsset":391,"./CCTiledObjectGroup":393,"./CCTiledTile":394}],391:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.TiledMapAsset",extends:cc.Asset,properties:{tmxXmlStr:"",textures:{default:[],type:[cc.Texture2D]},textureNames:[cc.String],textureSizes:{default:[],type:[cc.Size]},imageLayerTextures:{default:[],type:[cc.Texture2D]},imageLayerTextureNames:[cc.String],tsxFiles:[cc.TextAsset],tsxFileNames:[cc.String]},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=n,e.exports=n},{}],392:[function(t,e,i){"use strict";var n=(t=t("../renderer/core/input-assembler"))&&t.__esModule?t:{default:t},t=cc.Class({name:"cc.TiledMapRenderDataList",ctor:function(){this._dataList=[],this._offset=0},_pushRenderData:function(){var t={};t.ia=new n.default,t.nodesRenderList=[],this._dataList.push(t)},popRenderData:function(t){this._offset>=this._dataList.length&&this._pushRenderData();var e=this._dataList[this._offset],i=(e.nodesRenderList.length=0,e.ia);return i._vertexBuffer=t._vb,i._indexBuffer=t._ib,i._start=t.indiceOffset,i._count=0,this._offset++,e},pushNodesList:function(t,e){t.nodesRenderList.push(e)},reset:function(){this._offset=0}});cc.TiledMapRenderDataList=e.exports=t},{"../renderer/core/input-assembler":353}],393:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.TiledObjectGroup",extends:cc.Component,getPositionOffset:function(){return this._positionOffset},getProperties:function(){this._properties},getGroupName:function(){return this._groupName},getProperty:function(t){return this._properties[t.toString()]},getObject:function(t){for(var e=0,i=this._objects.length;e<i;e++){var n=this._objects[e];if(n&&n.name===t)return n}return null},getObjects:function(){return this._objects},_init:function(t,e,i){var n=cc.TiledMap,r=n.TMXObjectType,s=n.Orientation,a=n.StaggerAxis,n=n.TileFlag,o=n.FLIPPED_MASK,l=n.HORIZONTAL,h=n.VERTICAL,c=(this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=cc.v2(t.offset.x,-t.offset.y),this._opacity=t._opacity,e._mapSize),u=e._tileSize,n=0,_=0;e.orientation===s.HEX?e.getStaggerAxis()===a.STAGGERAXIS_X?(_=u.height*(c.height+.5),n=(u.width+e.getHexSideLength())*Math.floor(c.width/2)+u.width*(c.width%2)):(n=u.width*(c.width+.5),_=(u.height+e.getHexSideLength())*Math.floor(c.height/2)+u.height*(c.height%2)):_=e.orientation===s.ISO?(a=c.width+c.height,n=.5*u.width*a,.5*u.height*a):(n=c.width*u.width,c.height*u.height),this.node.setContentSize(n,_);for(var d=n*this.node.anchorX,f=_*(1-this.node.anchorY),p=t._objects,m={},y=0,g=p.length;y<g;y++){var v,b,x,A,C,T,S,w,E,M=p[y],D=M.type,B=(M.offset=cc.v2(M.x,M.y),M.points||M.polylinePoints);if(B)for(var I=0;I<B.length;I++)B[I].y*=-1;s.ISO!==e.orientation?M.y=_-M.y:(v=M.x/u.height,b=M.y/u.height,M.x=.5*u.width*(c.height+v-b),M.y=.5*u.height*(c.width+c.height-v-b)),D===r.TEXT&&(m[v="text"+M.id]=!0,(b=(b=this.node.getChildByName(v))||new cc.Node).anchorX=0,b.anchorY=1,b.angle=-M.rotation,b.x=M.x-d,b.y=M.y-f,b.name=v,b.parent=this.node,b.color=M.color,b.opacity=this._opacity,b.setSiblingIndex(y),(x=(x=b.getComponent(cc.Label))||b.addComponent(cc.Label)).overflow=cc.Label.Overflow.SHRINK,x.lineHeight=M.height,x.string=M.text,x.horizontalAlign=M.halign,x.verticalAlign=M.valign,x.fontSize=M.pixelsize,b.width=M.width,b.height=M.height),D!==r.IMAGE||(D=i[((x=M.gid)&o)>>>0])&&(E=D.tileset,m[A="img"+M.id]=!0,C=this.node.getChildByName(A),T=M.width||D.width,S=M.height||D.height,w=E.tileOffset.x,E=E.tileOffset.y,C instanceof cc.PrivateNode&&(C.removeFromParent(),C.destroy(),C=null),C=C||new cc.Node,s.ISO==e.orientation?C.anchorX=.5+w/T:C.anchorX=w/T,C.anchorY=E/S,C.angle=-M.rotation,C.x=M.x-d,C.y=M.y-f,C.name=A,C.parent=this.node,C.opacity=this._opacity,C.setSiblingIndex(y),E=(E=(w=(w=C.getComponent(cc.Sprite))||C.addComponent(cc.Sprite)).spriteFrame)||new cc.SpriteFrame,(x&l)>>>0?E.setFlipX(!0):E.setFlipX(!1),(x&h)>>>0?E.setFlipY(!0):E.setFlipY(!1),E.setTexture(D.tileset.sourceImage,cc.rect(D)),w.spriteFrame=E,w.setVertsDirty(),C.width=T,C.height=S)}this._objects=p;for(var P=this.node.children,F=/^(?:img|text)\d+$/,R=0,V=P.length;R<V;R++){var O=P[R],L=O._name;F.test(L)&&!m[L]&&O.destroy()}}});cc.TiledObjectGroup=e.exports=n},{}],394:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.TiledTile",extends:cc.Component,editor:!1,ctor:function(){this._layer=null},properties:{_x:0,_y:0,x:{get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer._isInvalidPosition(t,this._y)?cc.warn("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer._layerSize.width):(this._resetTile(),this._x=t,this._updateInfo()))},type:cc.Integer},y:{get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer._isInvalidPosition(this._x,t)?cc.warn("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer._layerSize.height):(this._resetTile(),this._y=t,this._updateInfo()))},type:cc.Integer},gid:{get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)},type:cc.Integer}},onEnable:function(){var t=this.node.parent;this._layer=t.getComponent(cc.TiledLayer),this._resetTile(),this._updateInfo()},onDisable:function(){this._resetTile()},_resetTile:function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},_updateInfo:function(){var t,e;this._layer&&(t=this._x,e=this._y,this._layer.getTiledTileAt(t,e)?cc.warn("There is already a TiledTile at [%s, %s]",t,e):(this.node.setPosition(this._layer.getPositionAt(t,e)),this._layer.setTiledTileAt(t,e,this)))}});cc.TiledTile=e.exports=n},{}],395:[function(t,e,i){"use strict";t("./CCTiledMap"),t("./CCTiledMapRenderDataList"),t("./tiledmap-buffer"),t("./tmx-layer-assembler")},{"./CCTiledMap":390,"./CCTiledMapRenderDataList":392,"./tiledmap-buffer":396,"./tmx-layer-assembler":397}],396:[function(t,e,i){"use strict";t=cc.Class({name:"cc.TiledMapBuffer",extends:t("../core/renderer/webgl/quad-buffer"),_updateOffset:function(){var t=this._offsetInfo;t.vertexOffset=this.vertexOffset,t.indiceOffset=this.indiceOffset,t.byteOffset=this.byteOffset},adjust:function(t,e){this.vertexOffset+=t,this.indiceOffset+=e,this.indiceStart=this.indiceOffset,this.byteOffset=this.byteOffset+t*this._vertexBytes,this._dirty=!0}});cc.TiledMapBuffer=e.exports=t},{"../core/renderer/webgl/quad-buffer":300}],397:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../core/renderer/assembler"))&&n.__esModule?n:{default:n},d=t("../core/value-types");var r=t("./CCTiledLayer"),s=t("./CCTiledMap"),w=s.TileFlag,Y=w.FLIPPED_MASK,h=t("../core/renderer/"),c=t("../core/renderer/webgl/vertex-format").vfmtPosUvColor,E=parseInt(10922.5),f=s.RenderOrder,a=t("../core/renderer/render-flow"),p=cc.mat4(),m=cc.v3(),v={row:0,col:0},M={x:0,y:0},D={x:0,y:0},B={x:0,y:0},I={x:0,y:0},P=null,R=null,O=0,L=0,F=0,V=0,y=null,N=null,k=null,z=null,G=null,U=null,j=null,W=null;function g(t){t._updateLocalMatrix(),d.Mat4.mul(t._worldMatrix,y,t._matrix),t._renderFlag&=~(a.FLAG_TRANSFORM|a.FLAG_BREAK_FLOW),a.visitRootNode(t),t._renderFlag|=a.FLAG_BREAK_FLOW}function H(){0!==R._count&&(N.material=P.material,N.node=U.node,N._flushIA(P.ia),E<=O?(z.uploadData(),z.switchBuffer(),j=z._vData,W=z._uintVData,P=k.popRenderData(z),R=P.ia,O=L=0):(P=k.popRenderData(z),R=P.ia),P.material=G)}function X(t,e){var i=U._getNodesByRowCol(t,e);if(i&&0!=i.count){var n=i.list,r=0,s=0;for(H(),N.worldMatDirty++;r<i.count;){var a=n[s];s++,a&&(g(a.node),r!==s&&((n[r]=a)._index=r),r++)}n.length=r,N.worldMatDirty--,k.pushNodesList(P,n),N._flush(),N.node=U.node}}o=n.default,s=o,(t=l).prototype=Object.create(s.prototype),(t.prototype.constructor=t).__proto__=s,(t=l.prototype).updateRenderData=function(t){t._renderDataList||(t._buffer=new cc.TiledMapBuffer(h._handle,c),t._renderDataList=new cc.TiledMapRenderDataList)},t.fillBuffers=function(t,e){if(0!==t._vertices.length){t._updateCulling();var i=t.node;if(F=t._leftDownToCenterX,V=t._leftDownToCenterY,y=i._worldMatrix,N=e,k=(U=t)._renderDataList,z=t._buffer,t._isCullingDirty()||t._isUserNodeDirty()||t._hasAnimation()||t._hasTiledNode()){z.reset();var n,r,s=((r=t._enableCulling?(n=(s=t._cullingRect).leftDown,s.rightTop):(n=v,t._rightTop)).row-n.row+1)*(r.col-n.col+1);switch(z.request(4*(s=E<s?E:s),6*s),t._renderOrder){case f.RightDown:this.traverseGrids(n,r,-1,1);break;case f.LeftDown:this.traverseGrids(n,r,-1,-1);break;case f.RightUp:this.traverseGrids(n,r,1,1);break;case f.LeftUp:this.traverseGrids(n,r,1,-1)}t._setCullingDirty(!1),t._setUserNodeDirty(!1)}else for(var a,o,l,h=0;h<k._offset;h++){if(0<(o=(a=k._dataList[h]).nodesRenderList).length){e.worldMatDirty++;for(var c=0;c<o.length;c++)if(l=o[c])for(var u=0;u<l.length;u++){var _=l[u];_&&g(_.node)}e.worldMatDirty--,e._flush()}0<a.ia._count&&(e.material=a.material,e.node=i,e._flushIA(a.ia))}W=j=U=G=z=k=N=y=R=P=null}},t.traverseGrids=function(t,e,i,n){if(k.reset(),!(e.row<0||e.col<0)){P=k.popRenderData(z),R=P.ia,j=z._vData,W=z._uintVData,L=O=0,G=null;for(var r,s,a,o,l,h,c,u,_,d,f,p=U.node._color._val,m=U._tiledTiles,y=U._texGrids,g=U._tiles,v=U._texIdToMatIndex,b=U._materials,x=U._vertices,A=-1,C=-1==i?(o=e.row,t.row):(o=t.row,e.row);0<=(C-o)*i;o+=i)for(r=x[o],f=0==(d=U._getNodesCountByRow(o))&&null!=r,a=1==n?(s=f&&t.col<r.minCol?r.minCol:t.col,f&&e.col>r.maxCol?r.maxCol:e.col):(s=f&&e.col>r.maxCol?r.maxCol:e.col,f&&t.col<r.minCol?r.minCol:t.col);0<=(a-s)*n;s+=n)(T=r&&r[s])?(l=y[((h=g[T.index])&Y)>>>0])&&(A!==l.texId&&(-1!==A&&H(),c=v[A=l.texId],G=b[c],P.material=G),G&&(c=T.left-F,u=T.bottom-V,_=c+(S=l.tileset._tileSize).width,S=u+S.height,(T=m[T.index])?this.fillByTiledNode(T.node,j,W,c,_,S,u):(j[L]=c,j[L+1]=S,W[L+4]=p,j[L+5]=c,j[L+6]=u,W[L+9]=p,j[L+10]=_,j[L+11]=S,W[L+14]=p,j[L+15]=_,j[L+16]=u,W[L+19]=p),T=l,S=h,M.x=T.l,M.y=T.t,D.x=T.r,D.y=T.t,B.x=T.l,B.y=T.b,I.x=T.r,I.y=T.b,T=null,(S&w.DIAGONAL)>>>0&&(T=D,D=B,B=T),(S&w.HORIZONTAL)>>>0&&(T=M,M=D,D=T,T=B,B=I,I=T),(S&w.VERTICAL)>>>0&&(T=M,M=B,B=T,T=D,D=I,I=T),j[L+2]=M.x,j[L+3]=M.y,j[L+7]=B.x,j[L+8]=B.y,j[L+12]=D.x,j[L+13]=D.y,j[L+17]=I.x,j[L+18]=I.y,L+=20,z.adjust(4,6),R._count+=6,O++,0<d&&X(o,s),E<=O&&H())):0<d&&X(o,s);z.uploadData(),0<R._count&&(N.material=P.material,N.node=U.node,N._flushIA(P.ia))}var T,S},t.fillByTiledNode=function(t,e,i,n,r,s,a){t._updateLocalMatrix(),d.Mat4.copy(p,t._matrix),d.Vec3.set(m,-(n+F),-(a+V),0),d.Mat4.transform(p,p,m);var o=p.m,l=o[0],h=o[1],c=o[4],u=o[5],_=o[12],o=o[13],t=t._color._val;e[L]=n*l+s*c+_,e[L+1]=n*h+s*u+o,i[L+4]=t,e[L+5]=n*l+a*c+_,e[L+6]=n*h+a*u+o,i[L+9]=t,e[L+10]=r*l+s*c+_,e[L+11]=r*h+s*u+o,i[L+14]=t,e[L+15]=r*l+a*c+_,e[L+16]=r*h+a*u+o,i[L+19]=t};var o,s=l;function l(){return o.apply(this,arguments)||this}i.default=s,n.default.register(r,s),e.exports=i.default},{"../core/renderer/":262,"../core/renderer/assembler":259,"../core/renderer/render-flow":263,"../core/renderer/webgl/vertex-format":303,"../core/value-types":330,"./CCTiledLayer":389,"./CCTiledMap":390}],398:[function(t,e,i){"use strict";var n=t("./video-player-impl"),r=n.EventType,s=cc.Enum({REMOTE:0,LOCAL:1}),t=cc.Class({name:"cc.VideoPlayer",extends:cc.Component,editor:!1,properties:{_resourceType:s.REMOTE,resourceType:{tooltip:!1,type:s,set:function(t){this._resourceType=t,this._updateVideoSource()},get:function(){return this._resourceType}},_remoteURL:"",remoteURL:{tooltip:!1,type:cc.String,set:function(t){this._remoteURL=t,this._updateVideoSource()},get:function(){return this._remoteURL}},_clip:{default:null,type:cc.Asset},clip:{tooltip:!1,get:function(){return this._clip},set:function(t){this._clip=t,this._updateVideoSource()},type:cc.Asset},currentTime:{tooltip:!1,type:cc.Float,set:function(t){this._impl&&this._impl.seekTo(t)},get:function(){return this._impl?this._currentStatus===r.NONE||this._currentStatus===r.STOPPED||this._currentStatus===r.META_LOADED||this._currentStatus===r.READY_TO_PLAY?0:this._currentStatus===r.COMPLETED?this._impl.duration():this._impl.currentTime():-1}},_volume:1,volume:{get:function(){return this._volume},set:function(t){this._volume=t,this.isPlaying()&&!this._mute&&this._syncVolume()},range:[0,1],type:cc.Float,tooltip:!1},_mute:!1,mute:{get:function(){return this._mute},set:function(t){this._mute=t,this._syncVolume()},tooltip:!1},keepAspectRatio:{tooltip:!1,default:!0,type:cc.Boolean,notify:function(){this._impl&&this._impl.setKeepAspectRatioEnabled(this.keepAspectRatio)}},_isFullscreen:{default:!1,formerlySerializedAs:"_N$isFullscreen"},isFullscreen:{get:function(){return this._isFullscreen=this._impl&&this._impl.isFullScreenEnabled(),this._isFullscreen},set:function(t){this._isFullscreen=t,this._impl&&this._impl.setFullScreenEnabled(t)},animatable:!1,tooltip:!1},_stayOnBottom:!1,stayOnBottom:{get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom=t,this._impl&&this._impl.setStayOnBottom(t)},animatable:!1,tooltip:!1},videoPlayerEvent:{default:[],type:cc.Component.EventHandler}},statics:{EventType:r,ResourceType:s,Impl:n},ctor:function(){this._impl=new n,this._currentStatus=r.NONE},_syncVolume:function(){var t,e=this._impl;e&&(t=this._mute?0:this._volume,e.setVolume(t))},_updateVideoSource:function(){var t="";this.resourceType===s.REMOTE?t=this.remoteURL:this._clip&&(t=this._clip.nativeUrl||""),t&&cc.loader.md5Pipe&&(t=cc.loader.md5Pipe.transformURL(t)),this._impl.setURL(t,this._mute||0===this._volume),this._impl.setKeepAspectRatioEnabled(this.keepAspectRatio)},onLoad:function(){var t=this._impl;t&&(t.createDomElementIfNeeded(this._mute||0===this._volume),t.setStayOnBottom(this._stayOnBottom),this._updateVideoSource(),t.seekTo(this.currentTime),t.setFullScreenEnabled(this._isFullscreen),this.pause(),t.setEventListener(r.PLAYING,this.onPlaying.bind(this)),t.setEventListener(r.PAUSED,this.onPasued.bind(this)),t.setEventListener(r.STOPPED,this.onStopped.bind(this)),t.setEventListener(r.COMPLETED,this.onCompleted.bind(this)),t.setEventListener(r.META_LOADED,this.onMetaLoaded.bind(this)),t.setEventListener(r.CLICKED,this.onClicked.bind(this)),t.setEventListener(r.READY_TO_PLAY,this.onReadyToPlay.bind(this)))},onRestore:function(){this._impl||(this._impl=new n)},onEnable:function(){this._impl&&this._impl.enable()},onDisable:function(){this._impl&&this._impl.disable()},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null)},update:function(t){this._impl&&this._impl.updateMatrix(this.node)},onReadyToPlay:function(){this._currentStatus=r.READY_TO_PLAY,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.READY_TO_PLAY),this.node.emit("ready-to-play",this)},onMetaLoaded:function(){this._currentStatus=r.META_LOADED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.META_LOADED),this.node.emit("meta-loaded",this)},onClicked:function(){this._currentStatus=r.CLICKED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.CLICKED),this.node.emit("clicked",this)},onPlaying:function(){this._currentStatus=r.PLAYING,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.PLAYING),this.node.emit("playing",this)},onPasued:function(){this._currentStatus=r.PAUSED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.PAUSED),this.node.emit("paused",this)},onStopped:function(){this._currentStatus=r.STOPPED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.STOPPED),this.node.emit("stopped",this)},onCompleted:function(){this._currentStatus=r.COMPLETED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.COMPLETED),this.node.emit("completed",this)},play:function(){this._impl&&(this._syncVolume(),this._impl.play())},resume:function(){this._impl&&(this._syncVolume(),this._impl.resume())},pause:function(){this._impl&&this._impl.pause()},stop:function(){this._impl&&this._impl.stop()},getDuration:function(){return this._impl?this._impl.duration():-1},isPlaying:function(){return!!this._impl&&this._impl.isPlaying()}});cc.VideoPlayer=e.exports=t},{"./video-player-impl":399}],399:[function(t,e,i){"use strict";var n=t("../core/platform/utils"),_=t("../core/platform/CCSys"),r=t("../core/platform/CCMacro"),s=1,a=4,d=cc.mat4(),f=cc.Class({name:"VideoPlayerImpl",ctor:function(){this._EventList={},this._video=null,this._url="",this._waitingFullscreen=!1,this._fullScreenEnabled=!1,this._stayOnBottom=!1,this._loadedmeta=!1,this._loaded=!1,this._visible=!1,this._playing=!1,this._ignorePause=!1,this._forceUpdate=!1,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this.__eventListeners={}},_bindEvent:function(){var t=this._video,e=this,i=this.__eventListeners;i.loadedmetadata=function(){e._loadedmeta=!0,e._forceUpdate=!0,e._waitingFullscreen&&(e._waitingFullscreen=!1,e._toggleFullscreen(!0)),e._dispatchEvent(f.EventType.META_LOADED)},i.ended=function(){e._video===t&&(e._playing=!1,e._dispatchEvent(f.EventType.COMPLETED))},i.play=function(){e._video===t&&(e._playing=!0,e._updateVisibility(),e._dispatchEvent(f.EventType.PLAYING))},i.pause=function(){e._video===t&&(e._playing=!1,e._ignorePause||e._dispatchEvent(f.EventType.PAUSED))},i.click=function(){e._dispatchEvent(f.EventType.CLICKED)},t.addEventListener("loadedmetadata",i.loadedmetadata),t.addEventListener("ended",i.ended),t.addEventListener("play",i.play),t.addEventListener("pause",i.pause),t.addEventListener("click",i.click),i.onCanPlay=function(){var t;e._loaded||e._playing||((t=e._video).readyState!==a&&t.readyState!==s||(t.currentTime=0,e._loaded=!0,e._forceUpdate=!0,e._dispatchEvent(f.EventType.READY_TO_PLAY),e._updateVisibility()))},t.addEventListener("canplay",i.onCanPlay),t.addEventListener("canplaythrough",i.onCanPlay),t.addEventListener("suspend",i.onCanPlay)},_updateVisibility:function(){var t=this._video;t&&(this._visible?t.style.visibility="visible":(t.style.visibility="hidden",t.pause(),this._playing=!1))},_updateSize:function(t,e){var i=this._video;i&&(i.style.width=t+"px",i.style.height=e+"px")},_createDom:function(t){var e=document.createElement("video");e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["z-index"]=this._stayOnBottom?r.MIN_ZINDEX:0,e.className="cocosVideo",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),t&&e.setAttribute("muted",""),this._video=e,cc.game.container.appendChild(e)},createDomElementIfNeeded:function(t){this._video||this._createDom(t)},removeDom:function(){var t,e=this._video;e&&(n.contains(cc.game.container,e)&&cc.game.container.removeChild(e),t=this.__eventListeners,e.removeEventListener("loadedmetadata",t.loadedmetadata),e.removeEventListener("ended",t.ended),e.removeEventListener("play",t.play),e.removeEventListener("pause",t.pause),e.removeEventListener("click",t.click),e.removeEventListener("canplay",t.onCanPlay),e.removeEventListener("canplaythrough",t.onCanPlay),e.removeEventListener("suspend",t.onCanPlay),t.loadedmetadata=null,t.ended=null,t.play=null,t.pause=null,t.click=null,t.onCanPlay=null),this._video=null,this._url=""},setURL:function(t,e){var i;if(this._url!==t){this.removeDom(),this._url=t,this.createDomElementIfNeeded(e),this._bindEvent();var n=this._video;n.style.visibility="hidden",this._loaded=!1,this._playing=!1,this._loadedmeta=!1,(i=document.createElement("source")).src=t,n.appendChild(i);for(var r=cc.path.extname(t),s=f._polyfill,a=0;a<s.canPlayType.length;a++)r!==s.canPlayType[a]&&((i=document.createElement("source")).src=t.replace(r,s.canPlayType[a]),n.appendChild(i))}},getURL:function(){return this._url},play:function(){var t=this._video;t&&this._visible&&!this._playing&&(f._polyfill.autoplayAfterOperation?setTimeout(function(){t.play()},20):t.play())},pause:function(){var t=this._video;this._playing&&t&&t.pause()},resume:function(){this.play()},stop:function(){var t=this._video;t&&this._visible&&(this._ignorePause=!0,t.currentTime=0,t.pause(),setTimeout(function(){this._dispatchEvent(f.EventType.STOPPED),this._ignorePause=!1}.bind(this),0))},setVolume:function(t){var e=this._video;e&&(e.volume=t)},seekTo:function(e){var i=this._video;i&&(this._loaded?i.currentTime=e:i.addEventListener(f._polyfill.event,function t(){i.currentTime=e,i.removeEventListener(f._polyfill.event,t)}),f._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){i.play()},20))},isPlaying:function(){var t=this._video;return f._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){t.play()},20),this._playing},duration:function(){var t=this._video,e=-1;return t&&((e=t.duration)<=0&&cc.logID(7702)),e},currentTime:function(){var t=this._video;return t?t.currentTime:-1},setKeepAspectRatioEnabled:function(){cc.logID(7700)},isKeepAspectRatioEnabled:function(){return!0},_toggleFullscreen:function(t){var i=this,n=this._video;n&&(t?(_.browserType===_.BROWSER_TYPE_IE&&(n.style.transform=""),cc.screen.requestFullScreen(n,function(t){var e=_.browserType===_.BROWSER_TYPE_IE?document.msFullscreenElement:document.fullscreenElement;i._fullScreenEnabled=e===n},function(t){i._fullScreenEnabled=!1})):cc.screen.fullScreen()&&cc.screen.exitFullScreen(n))},setStayOnBottom:function(t){this._stayOnBottom=t,this._video&&(this._video.style["z-index"]=t?r.MIN_ZINDEX:0)},setFullScreenEnabled:function(t){!this._loadedmeta&&t?this._waitingFullscreen=!0:this._toggleFullscreen(t)},isFullScreenEnabled:function(){return this._fullScreenEnabled},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){t=this._EventList[t];t&&t.call(this,this,this._video.src)},onPlayEvent:function(){this._EventList[f.EventType.PLAYING].call(this,this,this._video.src)},enable:function(){var t=f.elements;-1===t.indexOf(this)&&t.push(this),this.setVisible(!0)},disable:function(){var t=f.elements,e=t.indexOf(this);-1!==e&&t.splice(e,1),this.setVisible(!1)},destroy:function(){this.disable(),this.removeDom()},setVisible:function(t){this._visible!==t&&(this._visible=!!t,this._updateVisibility())},updateMatrix:function(t){var e,i,n,r,s,a,o,l,h,c,u;this._video&&this._visible&&!this._fullScreenEnabled&&(t.getWorldMatrix(d),(e=cc.Camera._findRendererCamera(t))&&e.worldMatrixToScreen(d,d,cc.game.canvas.width,cc.game.canvas.height),e=d.m,!this._forceUpdate&&this._m00===e[0]&&this._m01===e[1]&&this._m04===e[4]&&this._m05===e[5]&&this._m12===e[12]&&this._m13===e[13]&&this._w===t._contentSize.width&&this._h===t._contentSize.height||(this._m00=e[0],this._m01=e[1],this._m04=e[4],this._m05=e[5],this._m12=e[12],this._m13=e[13],this._w=t._contentSize.width,this._h=t._contentSize.height,n=i=1/cc.view._devicePixelRatio,h=cc.game.container,r=e[0]*i,s=e[1],a=e[4],o=e[5]*n,l=h&&h.style.paddingLeft?parseInt(h.style.paddingLeft):0,h=h&&h.style.paddingBottom?parseInt(h.style.paddingBottom):0,f._polyfill.zoomInvalid?(this._updateSize(this._w*r,this._h*o),o=r=1,c=this._w*i,u=this._h*n):(c=this._w*i,u=this._h*n,this._updateSize(this._w,this._h)),c=c*e[0]*t._anchorPoint.x,u=u*e[5]*t._anchorPoint.y,t="matrix("+r+","+-s+","+-a+","+o+","+(e[12]*i-c+l)+","+-(e[13]*n-u+h)+")",this._video.style.transform=t,this._video.style["-webkit-transform"]=t,this._video.style["transform-origin"]="0px 100% 0px",this._video.style["-webkit-transform-origin"]="0px 100% 0px",_.browserType!==_.BROWSER_TYPE_IE&&(this._forceUpdate=!1)))}}),t=(f.EventType={NONE:-1,PLAYING:0,PAUSED:1,STOPPED:2,COMPLETED:3,META_LOADED:4,CLICKED:5,READY_TO_PLAY:6},f.elements=[],f.pauseElements=[],cc.game.on(cc.game.EVENT_HIDE,function(){for(var t,e=f.elements,i=0;i<e.length;i++)(t=e[i]).isPlaying()&&(t.pause(),f.pauseElements.push(t))}),cc.game.on(cc.game.EVENT_SHOW,function(){for(var t=f.pauseElements,e=t.pop();e;)e.play(),e=t.pop()}),f._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]},document.createElement("video")),t=(t.canPlayType&&(t.canPlayType("video/ogg")&&(f._polyfill.canPlayType.push(".ogg"),f._polyfill.canPlayType.push(".ogv")),t.canPlayType("video/mp4")&&f._polyfill.canPlayType.push(".mp4"),t.canPlayType("video/webm")&&f._polyfill.canPlayType.push(".webm")),_.browserType===_.BROWSER_TYPE_FIREFOX&&(f._polyfill.autoplayAfterOperation=!0),_.OS_ANDROID!==_.os||_.browserType!==_.BROWSER_TYPE_SOUGOU&&_.browserType!==_.BROWSER_TYPE_360||(f._polyfill.zoomInvalid=!0),document.createElement("style"));t.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(t),e.exports=f},{"../core/platform/CCMacro":235,"../core/platform/CCSys":239,"../core/platform/utils":254}],400:[function(t,e,i){"use strict";var t=t("./webview-impl"),n=t.EventType;function r(){}var s=cc.Class({name:"cc.WebView",extends:cc.Component,editor:!1,properties:{_useOriginalSize:!0,_url:"",url:{type:cc.String,tooltip:!1,get:function(){return this._url},set:function(t){this._url=t;var e=this._impl;e&&e.loadURL(t)}},webviewEvents:{default:[],type:cc.Component.EventHandler}},statics:{EventType:n,Impl:t},ctor:function(){this._impl=new s.Impl},onRestore:function(){this._impl||(this._impl=new s.Impl)},onEnable:function(){var t=this._impl;t.createDomElementIfNeeded(this.node.width,this.node.height),t.setEventListener(n.LOADED,this._onWebViewLoaded.bind(this)),t.setEventListener(n.LOADING,this._onWebViewLoading.bind(this)),t.setEventListener(n.ERROR,this._onWebViewLoadError.bind(this)),t.loadURL(this._url),t.setVisible(!0)},onDisable:function(){var t=this._impl;t.setVisible(!1),t.setEventListener(n.LOADED,r),t.setEventListener(n.LOADING,r),t.setEventListener(n.ERROR,r)},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null)},update:function(t){this._impl&&this._impl.updateMatrix(this.node)},_onWebViewLoaded:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.LOADED),this.node.emit("loaded",this)},_onWebViewLoading:function(){return cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.LOADING),this.node.emit("loading",this),!0},_onWebViewLoadError:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.ERROR),this.node.emit("error",this)},setJavascriptInterfaceScheme:function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},setOnJSCallback:function(t){this._impl&&this._impl.setOnJSCallback(t)},evaluateJS:function(t){this._impl&&this._impl.evaluateJS(t)}});cc.WebView=e.exports=s},{"./webview-impl":401}],401:[function(t,e,i){"use strict";var n=t("../core/platform/utils"),t=t("../core/platform/CCSys"),_=cc.mat4(),r=cc.Class({name:"WebViewImpl",ctor:function(){this._EventList={},this._visible=!1,this._parent=null,this._div=null,this._iframe=null,this._listener=null,this._forceUpdate=!1,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this.__eventListeners={}},_updateVisibility:function(){var t;this._div&&(t=this._div,this._visible?t.style.visibility="visible":t.style.visibility="hidden")},_updateSize:function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px")},_initEvent:function(){var t,e,i=this._iframe;i&&(t=this.__eventListeners,e=this,t.load=function(){e._forceUpdate=!0,e._dispatchEvent(r.EventType.LOADED)},t.error=function(){e._dispatchEvent(r.EventType.ERROR)},i.addEventListener("load",t.load),i.addEventListener("error",t.error))},_initStyle:function(){var t;this._div&&((t=this._div).style.position="absolute",t.style.bottom="0px",t.style.left="0px")},_setOpacity:function(t){var e=this._iframe;e&&e.style&&(e.style.opacity=t/255)},_createDom:function(t,e){r._polyfill.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe),this._iframe.style.width="100%",this._iframe.style.height="100%"):this._div=this._iframe=document.createElement("iframe"),r._polyfill.enableBG&&(this._div.style.background="#FFF"),this._div.style.background="#FFF",this._div.style.height=e+"px",this._div.style.width=t+"px",this._div.style.overflow="scroll",this._iframe.style.border="none",cc.game.container.appendChild(this._div),this._updateVisibility()},_createNativeControl:function(t,e){this._createDom(t,e),this._initStyle(),this._initEvent()},createDomElementIfNeeded:function(t,e){this._div?this._updateSize(t,e):this._createNativeControl(t,e)},removeDom:function(){var t,e=this._div,e=(e&&(n.contains(cc.game.container,e)&&cc.game.container.removeChild(e),this._div=null),this._iframe);e&&(t=this.__eventListeners,e.removeEventListener("load",t.load),e.removeEventListener("error",t.error),t.load=null,t.error=null,this._iframe=null)},setOnJSCallback:function(t){},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,i,n){},loadHTMLString:function(t,e){},loadURL:function(t){var e,i=this._iframe;i&&(i.src=t,e=this,i.addEventListener("load",function t(){e._loaded=!0,e._updateVisibility(),i.removeEventListener("load",t)}),this._dispatchEvent(r.EventType.LOADING))},stopLoading:function(){cc.logID(7800)},reload:function(){var t=this._iframe;t&&(t=t.contentWindow)&&t.location&&t.location.reload()},canGoBack:function(){return cc.logID(7801),!0},canGoForward:function(){return cc.logID(7802),!0},goBack:function(){try{if(r._polyfill.closeHistory)return cc.logID(7803);var t,e=this._iframe;!e||(t=e.contentWindow)&&t.location&&t.history.back.call(t)}catch(e){cc.log(e)}},goForward:function(){try{if(r._polyfill.closeHistory)return cc.logID(7804);var t,e=this._iframe;!e||(t=e.contentWindow)&&t.location&&t.history.forward.call(t)}catch(e){cc.log(e)}},evaluateJS:function(t){var e=this._iframe;if(e){e=e.contentWindow;try{e.eval(t),this._dispatchEvent(r.EventType.JS_EVALUATED)}catch(t){console.error(t)}}},setScalesPageToFit:function(){cc.logID(7805)},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){t=this._EventList[t];t&&t.call(this,this,this._iframe.src)},_createRenderCmd:function(){return new r.RenderCmd(this)},destroy:function(){this.removeDom()},setVisible:function(t){this._visible!==t&&(this._visible=!!t,this._updateVisibility())},updateMatrix:function(t){var e,i,n,r,s,a,o,l,h,c,u;this._div&&this._visible&&(t.getWorldMatrix(_),(e=cc.Camera._findRendererCamera(t))&&e.worldMatrixToScreen(_,_,cc.game.canvas.width,cc.game.canvas.height),e=_.m,!this._forceUpdate&&this._m00===e[0]&&this._m01===e[1]&&this._m04===e[4]&&this._m05===e[5]&&this._m12===e[12]&&this._m13===e[13]&&this._w===t._contentSize.width&&this._h===t._contentSize.height||(this._m00=e[0],this._m01=e[1],this._m04=e[4],this._m05=e[5],this._m12=e[12],this._m13=e[13],this._w=t._contentSize.width,this._h=t._contentSize.height,n=i=1/cc.view._devicePixelRatio,l=cc.game.container,u=e[0]*i,r=e[1],s=e[4],a=e[5]*n,o=l&&l.style.paddingLeft?parseInt(l.style.paddingLeft):0,l=l&&l.style.paddingBottom?parseInt(l.style.paddingBottom):0,this._updateSize(this._w,this._h),h=this._w*i,c=this._h*n,h=h*e[0]*t._anchorPoint.x,c=c*e[5]*t._anchorPoint.y,u="matrix("+u+","+-r+","+-s+","+a+","+(e[12]*i-h+o)+","+-(e[13]*n-c+l)+")",this._div.style.transform=u,this._div.style["-webkit-transform"]=u,this._div.style["transform-origin"]="0px 100% 0px",this._div.style["-webkit-transform-origin"]="0px 100% 0px",this._setOpacity(t.opacity),this._forceUpdate=!1))}}),s=(r.EventType={LOADING:0,LOADED:1,ERROR:2,JS_EVALUATED:3},r._polyfill={devicePixelRatio:!1,enableDiv:!1});t.os===t.OS_IOS&&(s.enableDiv=!0),t.isMobile?t.browserType===t.BROWSER_TYPE_FIREFOX&&(s.enableBG=!0):t.browserType===t.BROWSER_TYPE_IE&&(s.closeHistory=!0),e.exports=r},{"../core/platform/CCSys":239,"../core/platform/utils":254}],402:[function(t,e,i){"use strict";t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle"),t("./cocos2d/tilemap"),t("./cocos2d/videoplayer/CCVideoPlayer"),t("./cocos2d/webview/CCWebView"),t("./cocos2d/core/components/CCStudioComponent"),t("./extensions/ccpool/CCNodePool"),t("./cocos2d/actions"),t("./extensions/spine"),t("./extensions/dragonbones"),t("./cocos2d/deprecated")},{"./cocos2d/actions":7,"./cocos2d/animation":16,"./cocos2d/core":176,"./cocos2d/core/components/CCStudioComponent":137,"./cocos2d/deprecated":342,"./cocos2d/particle":348,"./cocos2d/particle/CCParticleAsset":345,"./cocos2d/tilemap":395,"./cocos2d/tilemap/CCTiledMapAsset":391,"./cocos2d/videoplayer/CCVideoPlayer":398,"./cocos2d/webview/CCWebView":400,"./extensions/ccpool/CCNodePool":403,"./extensions/dragonbones":413,"./extensions/spine":418}],403:[function(t,e,i){"use strict";cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},put:function(t){var e;t&&-1===this._pool.indexOf(t)&&(t.removeFromParent(!1),(e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null)&&e.unuse&&e.unuse(),this._pool.push(t))},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t],t=(this._pool.length=t,this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null);return t&&t.reuse&&t.reuse.apply(t,arguments),e}},e.exports=cc.NodePool},{}],404:[function(t,e,i){"use strict";var E,M,D=[],B=[],I=0,P=0,R=0,O=null,L=null,F=0,V=0,N=0,k=0,z=null,s=cc.Class({ctor:function(){this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this.isCompleted=!1,this._frameIdx=-1,this._armatureInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null},init:function(t,e){this._inited=!0,this._armatureInfo=t,this._animationName=e},clear:function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},begin:function(){var t,e;this._invalid&&((e=(t=this._armatureInfo).curAnimationCache)&&e!=this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame()),t.armature.animation.play(this._animationName,1),(t.curAnimationCache=this)._invalid=!1,this._frameIdx=-1,this.totalTime=0,this.isCompleted=!1)},end:function(){this._needToUpdate()||(this._armatureInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0)},_needToUpdate:function(t){return!this._armatureInfo.armature.animation.isCompleted&&this.totalTime<30&&(null==t||this._frameIdx<t)},updateToFrame:function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){for(var e=this._armatureInfo.armature;e.advanceTime(1/60),this._frameIdx++,this._updateFrame(e,this._frameIdx),this.totalTime+=1/60,this._needToUpdate(t););this.end()}},isInited:function(){return this._inited},isInvalid:function(){return this._invalid},invalidAllFrame:function(){this.isCompleted=!1,this._invalid=!0},updateAllFrame:function(){this.invalidAllFrame(),this.updateToFrame()},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},_updateFrame:function(t,e){k=N=V=F=P=I=R=0,z=L=O=null,this.frames[e]=this.frames[e]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var e=this.frames[e],i=this._tempSegments=e.segments,n=this._tempColors=e.colors,r=this._tempBoneInfos=e.boneInfos,t=(this._traverseArmature(t,1),0<k&&(n[k-1].vfOffset=R),n.length=k,r.length=I,N-1);if(0<=t&&(0<V?((n=i[t]).indexCount=V,n.vfCount=5*F,n.vertexCount=F,i.length=N):i.length=N-1),0!==i.length){var s=e.vertices,a=e.uintVert;(!s||s.length<R)&&(s=e.vertices=new Float32Array(R),a=e.uintVert=new Uint32Array(s.buffer));for(var o=0,l=0;o<R;)s[o++]=D[l++],s[o++]=D[l++],s[o++]=D[l++],s[o++]=D[l++],a[o++]=D[l++];var h=e.indices;(!h||h.length<P)&&(h=e.indices=new Uint16Array(P));for(var c=0;c<P;c++)h[c]=B[c];e.vertices=s,e.uintVert=a,e.indices=h}},_traverseArmature:function(t,e){var i,n,r,s,a,o=this._tempColors,l=this._tempSegments,h=this._tempBoneInfos,c=D,u=B,_=t._slots,d=t._bones;if(this._enableCacheAttachedInfo)for(var f=0,p=d.length;f<p;f++,I++){var m=d[f],y=(y=h[I])||(h[I]={globalTransformMatrix:new dragonBones.Matrix}),m=m.globalTransformMatrix;y.globalTransformMatrix.copyFrom(m)}for(var g=0,v=_.length;g<v;g++)if((i=_[g])._visible&&i._displayData)if(i.updateWorldMatrix(),n=i._color,i.childArmature)this._traverseArmature(i.childArmature,e*n.a/255);else if(s=i.getTexture()){O===s.url&&L===i._blendMode||(O=s.url,L=i._blendMode,0<=(a=N-1)&&(0<V?((a=l[a]).indexCount=V,a.vertexCount=F,a.vfCount=5*F):N--),l[N]={tex:s,blendMode:i._blendMode,indexCount:0,vertexCount:0,vfCount:0},N++,F=V=0),r=(n.a*e<<24>>>0)+(n.b<<16)+(n.g<<8)+n.r,z!==r&&(z=r,0<k&&(o[k-1].vfOffset=R),o[k++]={r:n.r,g:n.g,b:n.b,a:n.a*e,vfOffset:0});for(var b=i._localVertices,x=i._indices,A=i._worldMatrix.m,C=0,T=b.length;C<T;)E=b[C++],M=b[C++],c[R++]=E*A[0]+M*A[4]+A[12],c[R++]=E*A[1]+M*A[5]+A[13],c[R++]=b[C++],c[R++]=b[C++],c[R++]=r;for(var S=0,w=x.length;S<w;S++)u[P++]=F+x[S];V+=x.length,F+=b.length/4}}}),a=cc.Class({ctor:function(){this._privateMode=!1,this._animationPool={},this._armatureCache={}},enablePrivateMode:function(){this._privateMode=!0},dispose:function(){for(var t in this._armatureCache){var t=this._armatureCache[t];!t||(t=t.armature)&&t.dispose()}this._armatureCache=null,this._animationPool=null},_removeArmature:function(t){var e,i=this._armatureCache[t],n=i.animationsCache;for(e in n){var r=n[e];r&&(this._animationPool[t+"#"+e]=r).clear()}i=i.armature;i&&i.dispose(),delete this._armatureCache[t]},resetArmature:function(t){for(var e in this._armatureCache)-1!=e.indexOf(t)&&this._removeArmature(e)},getArmatureCache:function(t,e,i){var n,r=this._armatureCache[e];if(r)n=r.armature;else{r=dragonBones.CCFactory.getInstance().buildArmatureDisplay(t,e,"",i);if(!r||!r._armature)return;if(n=r._armature,!a.canCache(n))return void n.dispose();this._armatureCache[e]={armature:n,animationsCache:{},curAnimationCache:null}}return n},getAnimationCache:function(t,e){t=this._armatureCache[t];return t?t.animationsCache[e]:null},initAnimationCache:function(t,e){if(!e)return null;var i=this._armatureCache[t],n=i&&i.armature;if(!n)return null;if(!n.animation.hasAnimation(e))return null;var n=i.animationsCache,r=n[e];return r||((r=this._animationPool[t=t+"#"+e])?delete this._animationPool[t]:(r=new s)._privateMode=this._privateMode,r.init(i,e),n[e]=r),r},invalidAnimationCache:function(t){t=this._armatureCache[t];if(!t||!t.armature)return null;var e,i=t.animationsCache;for(e in i)i[e].invalidAllFrame()},updateAnimationCache:function(t,e){if(e){e=this.initAnimationCache(t,e);e&&e.updateAllFrame()}else{e=this._armatureCache[t];if(!e||!e.armature)return null;var i,n=e.animationsCache;for(i in n)n[i].updateAllFrame()}}});a.FrameTime=1/60,a.sharedCache=new a,a.canCache=function(t){for(var e=t._slots,i=0,n=e.length;i<n;i++)if(e[i].childArmature)return!1;return!0},e.exports=a},{}],405:[function(t,e,i){"use strict";var n=t("../../cocos2d/core/components/CCRenderComponent"),r=t("../../cocos2d/core/event/event-target"),s=t("../../cocos2d/core/graphics/graphics"),a=t("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER,o=t("./ArmatureCache"),l=t("./AttachUtil"),t=cc.Enum({default:-1}),h=cc.Enum({"<None>":0}),c=(cc.Enum({REALTIME:0}),cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2})),n=cc.Class({name:"dragonBones.ArmatureDisplay",extends:n,editor:!1,statics:{AnimationCacheMode:c},properties:{_factory:{default:null,type:dragonBones.CCFactory,serializable:!1},dragonAsset:{default:null,type:dragonBones.DragonBonesAsset,notify:function(){this._refresh()},tooltip:!1},dragonAtlasAsset:{default:null,type:dragonBones.DragonBonesAtlasAsset,notify:function(){this._parseDragonAtlasAsset(),this._refresh()},tooltip:!1},_armatureName:"",armatureName:{get:function(){return this._armatureName},set:function(t){this._armatureName=t;t=this.getAnimationNames(this._armatureName);(!this.animationName||t.indexOf(this.animationName)<0)&&(this.animationName=""),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),this._refresh(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)},visible:!1},_animationName:"",animationName:{get:function(){return this._animationName},set:function(t){this._animationName=t},visible:!1},_defaultArmatureIndex:{default:0,notify:function(){var t,e="";if(this.dragonAsset){if(!(t=this.dragonAsset?this.dragonAsset.getArmatureEnum():t))return cc.errorID(7400,this.name);e=t[this._defaultArmatureIndex]}void 0!==e?this.armatureName=e:cc.errorID(7401,this.name)},type:t,visible:!0,editorOnly:!0,animatable:!1,displayName:"Armature",tooltip:!1},_animationIndex:{default:0,notify:function(){var t;0!==this._animationIndex?(t=this.dragonAsset?this.dragonAsset.getAnimsEnum(this.armatureName):t)&&(void 0!==(t=t[this._animationIndex])?this.playAnimation(t,this.playTimes):cc.errorID(7402,this.name)):this.animationName=""},type:h,visible:!0,editorOnly:!0,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:c.REALTIME,_defaultCacheMode:{default:0,type:c,notify:function(){if(this._defaultCacheMode!==c.REALTIME&&this._armature&&!o.canCache(this._armature))return this._defaultCacheMode=c.REALTIME,void cc.warn("Animation cache mode doesn't support skeletal nesting");this.setAnimationCacheMode(this._defaultCacheMode)},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},timeScale:{default:1,notify:function(){this._armature&&!this.isAnimationCached()&&(this._armature.animation.timeScale=this.timeScale)},tooltip:!1},playTimes:{default:-1,tooltip:!1},premultipliedAlpha:{default:!1,tooltip:!1},debugBones:{default:!1,notify:function(){this._updateDebugDraw()},tooltip:!1},enableBatch:{default:!1,notify:function(){this._updateBatch()},tooltip:!1},_armatureKey:"",_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_playing:!1,_armatureCache:null},ctor:function(){this._eventTarget=new r,this._materialCache={},this._inited=!1,this.attachUtil=new l,this._factory=dragonBones.CCFactory.getInstance()},onLoad:function(){for(var t=this.node.children,e=0,i=t.length;e<i;e++){var n=t[e];0===(n._name&&n._name.search("CHILD_ARMATURE-"))&&n.destroy()}},_updateBatch:function(){var t=this.getMaterial(0);t&&t.define("CC_USE_MODEL",!this.enableBatch),this._materialCache={}},_updateMaterial:function(){var t=this.getMaterial(0);t&&(t.define("CC_USE_MODEL",!this.enableBatch),t.define("USE_TEXTURE",!0)),this._materialCache={}},disableRender:function(){this._super(),this.node._renderFlag&=~a},markForRender:function(t){this._super(t),t?this.node._renderFlag|=a:this.node._renderFlag&=~a},_validateRender:function(){var t=this.dragonAtlasAsset&&this.dragonAtlasAsset.texture;t&&t.loaded?this._super():this.disableRender()},__preload:function(){this._init()},_init:function(){if(!this._inited){this._inited=!0,this._resetAssembler(),this._activateMaterial(),this._parseDragonAtlasAsset(),this._refresh();for(var t=this.node.children,e=0,i=t.length;e<i;e++){var n=t[e];n&&"DEBUG_DRAW_NODE"===n._name&&n.destroy()}this._updateDebugDraw()}},getArmatureKey:function(){return this._armatureKey},setAnimationCacheMode:function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._buildArmature())},isAnimationCached:function(){return this._cacheMode!==c.REALTIME},onEnable:function(){this._super(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)},onDisable:function(){this._super(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature)},_emitCacheCompleteEvent:function(){this._eventTarget.emit(dragonBones.EventObject.LOOP_COMPLETE),this._eventTarget.emit(dragonBones.EventObject.COMPLETE)},update:function(t){if(this.isAnimationCached()&&this._frameCache){var e=this._frameCache;if(e.isInited()){var i=e.frames;if(this._playing){var n=o.FrameTime,r=(0==this._accTime&&0==this._playCount&&this._eventTarget.emit(dragonBones.EventObject.START),dragonBones.timeScale),t=(this._accTime+=t*this.timeScale*r,Math.floor(this._accTime/n));if(e.isCompleted||e.updateToFrame(t),e.isCompleted&&t>=i.length){if(this._playCount++,0<this.playTimes&&this._playCount>=this.playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playing=!1,this._playCount=0,void this._emitCacheCompleteEvent();t=this._accTime=0,this._emitCacheCompleteEvent()}this._curFrame=i[t]}else e.isInvalid()&&(e.updateToFrame(),this._curFrame=i[i.length-1])}}},onDestroy:function(){this._super(),this._inited=!1,this._cacheMode===c.PRIVATE_CACHE?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):this._cacheMode===c.SHARED_CACHE?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null)},_updateDebugDraw:function(){var t;this.debugBones?(this._debugDraw||((t=new cc.PrivateNode).name="DEBUG_DRAW_NODE",(t=t.addComponent(s)).lineWidth=1,t.strokeColor=cc.color(255,0,0,255),this._debugDraw=t),this._debugDraw.node.parent=this.node):this._debugDraw&&(this._debugDraw.node.parent=null)},_buildArmature:function(){if(this.dragonAsset&&this.dragonAtlasAsset&&this.armatureName){this._armature&&(this._preCacheMode===c.PRIVATE_CACHE?this._armatureCache.dispose():this._preCacheMode===c.REALTIME&&this._armature.dispose(),this._armatureCache=null,this._armature=null,this._displayProxy=null,this._frameCache=null,this._curFrame=null,this._playing=!1,this._preCacheMode=null),this._cacheMode===c.SHARED_CACHE?this._armatureCache=o.sharedCache:this._cacheMode===c.PRIVATE_CACHE&&(this._armatureCache=new o,this._armatureCache.enablePrivateMode());var t=this.dragonAtlasAsset._uuid;if(this._armatureKey=this.dragonAsset.init(this._factory,t),this.isAnimationCached()&&(this._armature=this._armatureCache.getArmatureCache(this.armatureName,this._armatureKey,t),this._armature||(this._cacheMode=c.REALTIME)),this._preCacheMode=this._cacheMode,this._cacheMode===c.REALTIME){if(this._displayProxy=this._factory.buildArmatureDisplay(this.armatureName,this._armatureKey,"",t),!this._displayProxy)return;this._displayProxy._ccNode=this.node,this._displayProxy.setEventTarget(this._eventTarget),this._armature=this._displayProxy._armature,this._armature.animation.timeScale=this.timeScale,this._factory._dragonBones.clock.add(this._armature)}this._cacheMode!==c.REALTIME&&this.debugBones&&cc.warn("Debug bones is invalid in cached mode"),this._armature&&(t=this._armature.armatureData.aabb,this.node.setContentSize(t.width,t.height)),this._updateBatch(),this.attachUtil.init(this),this.attachUtil._associateAttachedNode(),this.animationName&&this.playAnimation(this.animationName,this.playTimes),this.markForRender(!0)}},_parseDragonAtlasAsset:function(){this.dragonAtlasAsset&&this.dragonAtlasAsset.init(this._factory)},_refresh:function(){this._buildArmature()},_updateCacheModeEnum:!1,_updateAnimEnum:!1,_updateArmatureEnum:!1,playAnimation:function(t,e){if(this.playTimes=void 0===e?-1:e,this.animationName=t,this.isAnimationCached()){e=this._armatureCache.getAnimationCache(this._armatureKey,t);(e=e||this._armatureCache.initAnimationCache(this._armatureKey,t))&&(this._accTime=0,this._playCount=0,this._frameCache=e,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._playing=!0,this._curFrame=this._frameCache.frames[0])}else if(this._armature)return this._armature.animation.play(t,this.playTimes)},updateAnimationCache:function(t){this.isAnimationCached()&&this._armatureCache.updateAnimationCache(this._armatureKey,t)},invalidAnimationCache:function(){this.isAnimationCached()&&this._armatureCache.invalidAnimationCache(this._armatureKey)},getArmatureNames:function(){var t=this._factory.getDragonBonesData(this._armatureKey);return t&&t.armatureNames||[]},getAnimationNames:function(t){var e=[],i=this._factory.getDragonBonesData(this._armatureKey);if(i){var n=i.getArmature(t);if(n)for(var r in n.animations)n.animations.hasOwnProperty(r)&&e.push(r)}return e},on:function(t,e,i){this.addEventListener(t,e,i)},off:function(t,e,i){this.removeEventListener(t,e,i)},once:function(t,e,i){this._eventTarget.once(t,e,i)},addEventListener:function(t,e,i){this._eventTarget.on(t,e,i)},removeEventListener:function(t,e,i){this._eventTarget.off(t,e,i)},buildArmature:function(t,e){return this._factory.createArmatureNode(this,t,e)},armature:function(){return this._armature}});e.exports=dragonBones.ArmatureDisplay=n},{"../../cocos2d/core/components/CCRenderComponent":131,"../../cocos2d/core/event/event-target":156,"../../cocos2d/core/graphics/graphics":172,"../../cocos2d/core/renderer/render-flow":263,"./ArmatureCache":404,"./AttachUtil":406}],406:[function(t,e,i){"use strict";function n(){}function r(t){Object.defineProperty(t,"_worldMatDirty",{get:function(){return!0},set:function(t){}}),t._calculWorldMatrix=n,t._mulMat=n}var f=(s=t("../../cocos2d/core/value-types/mat4"))&&s.__esModule?s:{default:s},p=t("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM,m=new f.default,s=cc.Class({name:"dragonBones.AttachUtil",ctor:function(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null,this._attachedRootNode=null,this._attachedNodeArray=[],this._boneIndexToNode={}},init:function(t){this._inited=!0,this._armature=t._armature,this._armatureNode=t.node,this._armatureDisplay=t},reset:function(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null},_prepareAttachNode:function(){var t;if(this._armature)return(t=this._armatureNode.getChildByName("ATTACHED_NODE_TREE"))&&t.isValid||(t=new cc.Node("ATTACHED_NODE_TREE"),r(t),this._armatureNode.addChild(t)),this._armatureDisplay.isAnimationCached()&&this._armatureDisplay._frameCache&&this._armatureDisplay._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=t},_buildBoneAttachedNode:function(t,e){var i="ATTACHED_NODE:"+t.name,i=new cc.Node(i);return this._buildBoneRelation(i,t,e),i},_buildBoneRelation:function(t,e,i){r(t),t._bone=e,t._boneIndex=i,this._attachedNodeArray.push(t),this._boneIndexToNode[i]=t},getAttachedRootNode:function(){return this._attachedRootNode},getAttachedNodes:function(t){var e=this._attachedNodeArray,i=[];if(this._inited)for(var n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&s.name==="ATTACHED_NODE:"+t&&i.push(s)}return i},_rebuildNodeArray:function(){for(var t=this._boneIndexToNode={},e=this._attachedNodeArray,i=this._attachedNodeArray=[],n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&!s._toRemove&&(i.push(s),t[s._boneIndex]=s)}},_sortNodeArray:function(){this._attachedNodeArray.sort(function(t,e){return t._boneIndex<e._boneIndex?-1:1})},_getNodeByBoneIndex:function(t){t=this._boneIndexToNode[t];return t&&t.isValid?t:null},destroyAttachedNodes:function(t){if(this._inited){for(var e=this._attachedNodeArray,i=function t(e){for(var i=e.children,n=0,r=i.length;n<r;n++){var s=i[n];s&&t(s)}e._toRemove=!0},n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&s.name.split("ATTACHED_NODE:")[1]===t&&(i(s),s.removeFromParent(!0),s.destroy(),e[n]=null)}this._rebuildNodeArray()}},generateAttachedNodes:function(h){var t=[];if(!this._inited)return t;var n=this._prepareAttachNode();if(!n)return t;var c=0,u=[],_=function(t){if(t){for(var e,i=t.getBones(),n=0,r=i.length;n<r;n++)(e=i[n])._boneIndex=c++,h===e.name&&u.push(e);for(var s,a=t.getSlots(),o=0,l=a.length;o<l;o++)(s=a[o]).childArmature&&_(s.childArmature)}}.bind(this);_(this._armature);for(var r=function(t){if(t){if(e=this._getNodeByBoneIndex(t._boneIndex))return e;var e=this._buildBoneAttachedNode(t,t._boneIndex),i=null,i=(t.armature.parent&&(i=t.armature.parent.parent),r(t.parent||i)||n);return e.parent=i,t.parent?e._rootNode=i._rootNode:e._rootNode=i,e}}.bind(this),e=0,i=u.length;e<i;e++){var s=r(u[e]);s&&t.push(s)}return this._sortNodeArray(),t},destroyAllAttachedNodes:function(){var t;this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},this._inited&&(t=this._armatureNode.getChildByName("ATTACHED_NODE_TREE"))&&(t.removeFromParent(!0),t.destroy())},generateAllAttachedNodes:function(){if(this._inited){this._boneIndexToNode={},this._attachedNodeArray.length=0;var d,f,p=this._prepareAttachNode();if(p)return d=0,(f=function(t){if(t){var e=p;t.parent&&(e=t.parent.parent._attachedNode);for(var i,n=t.getBones(),r=0,s=n.length;r<s;r++){var a,o=d++,l=(i=n[r])._attachedNode=null;(l=i.parent?i.parent._attachedNode:e)&&((a=l.getChildByName("ATTACHED_NODE:"+i.name))&&a.isValid?this._buildBoneRelation(a,i,o):(a=this._buildBoneAttachedNode(i,o),l.addChild(a)),a._rootNode=e,i._attachedNode=a)}for(var h,c=t.getSlots(),u=0,_=c.length;u<_;u++)(h=c[u]).childArmature&&f(h.childArmature)}}.bind(this))(this._armature),p}},_hasAttachedNode:function(){return!!this._inited&&!!this._armatureNode.getChildByName("ATTACHED_NODE_TREE")},_associateAttachedNode:function(){var _,t,d,f;this._inited&&(_=this._armatureNode.getChildByName("ATTACHED_NODE_TREE"))&&_.isValid&&(this._attachedRootNode=_,this._boneIndexToNode={},this._attachedNodeArray.length=0,(t=this._armature)&&(r(_),this._armatureDisplay.isAnimationCached()&&this._armatureDisplay._frameCache&&this._armatureDisplay._frameCache.enableCacheAttachedInfo(),d=0,(f=function(t){if(t){var e=_;t.parent&&(e=t.parent.parent._attachedNode);for(var i,n=t.getBones(),r=0,s=n.length;r<s;r++){var a=d++,o=(i=n[r])._attachedNode=null;!(o=i.parent?i.parent._attachedNode:e)||(o=o.getChildByName("ATTACHED_NODE:"+i.name))&&o.isValid&&(this._buildBoneRelation(o,i,a),o._rootNode=e,i._attachedNode=o)}for(var l,h=t.getSlots(),c=0,u=h.length;c<u;c++)(l=h[c]).childArmature&&f(l.childArmature)}}.bind(this))(t)))},_syncAttachedNode:function(){if(this._inited){var t=this._attachedRootNode,e=this._attachedNodeArray;if(!t||!t.isValid)return this._attachedRootNode=null,void(e.length=0);var i=this._armatureNode._worldMatrix,n=(f.default.copy(t._worldMatrix,i),t._renderFlag&=~p,null),r=this._armatureDisplay.isAnimationCached();if(!r||(n=this._armatureDisplay._curFrame&&this._armatureDisplay._curFrame.boneInfos)){for(var s=this._armatureNode._mulMat,a=!1,o=0,l=e.length;o<l;o++){var h=e[o];h&&h.isValid?(_=r?n[h._boneIndex]:h._bone)&&!_._isInPool?(c=h._worldMatrix,u=h._rootNode._worldMatrix,_=_.globalTransformMatrix,d=void 0,(d=m.m)[0]=_.a,d[1]=_.b,d[4]=-_.c,d[5]=-_.d,d[12]=_.tx,d[13]=_.ty,s(c,u,m),h._renderFlag&=~p):(h.removeFromParent(!0),h.destroy(),a=!(e[o]=null)):a=!(e[o]=null)}a&&this._rebuildNodeArray()}}var c,u,_,d}});e.exports=dragonBones.AttachUtil=s},{"../../cocos2d/core/renderer/render-flow":263,"../../cocos2d/core/value-types/mat4":332}],407:[function(t,e,i){"use strict";var n=t("../../cocos2d/core/event/event-target");dragonBones.CCArmatureDisplay=cc.Class({name:"dragonBones.CCArmatureDisplay",properties:{node:{get:function(){return this}}},ctor:function(){this._eventTarget=new n},setEventTarget:function(t){this._eventTarget=t},getRootDisplay:function(){var t,e=this._armature._parent;if(!e)return this;for(;e;)e=(t=e)._armature._parent;return t._armature.getDisplay()},convertToRootSpace:function(t){var e=this._armature._parent;if(!e)return t;e.updateWorldMatrix();var e=e._worldMatrix.m,i=cc.v2(0,0);return i.x=t.x*e[0]+t.y*e[4]+e[12],i.y=t.x*e[1]+t.y*e[5]+e[13],i},convertToWorldSpace:function(t){t=this.convertToRootSpace(t);return this.getRootNode().convertToWorldSpaceAR(t)},getRootNode:function(){var t=this.getRootDisplay();return t&&t._ccNode},dbInit:function(t){this._armature=t},dbClear:function(){this._armature=null},dbUpdate:function(){},advanceTimeBySelf:function(t){this.shouldAdvanced=!!t},hasDBEventListener:function(t){return this._eventTarget.hasEventListener(t)},addDBEventListener:function(t,e,i){this._eventTarget.on(t,e,i)},removeDBEventListener:function(t,e,i){this._eventTarget.off(t,e,i)},dispatchDBEvent:function(t,e){this._eventTarget.emit(t,e)}})},{"../../cocos2d/core/event/event-target":156}],408:[function(t,e,i){"use strict";var r=dragonBones.BaseObject,n=dragonBones.BaseFactory,s=dragonBones.CCFactory=cc.Class({name:"dragonBones.CCFactory",extends:n,statics:{_factory:null,getInstance:function(){return s._factory||(s._factory=new s),s._factory}},ctor:function(){var t=new dragonBones.CCArmatureDisplay;this._dragonBones=new dragonBones.DragonBones(t),cc.director._scheduler&&(cc.game.on(cc.game.EVENT_RESTART,this.initUpdate,this),this.initUpdate())},initUpdate:function(t){cc.director._scheduler.enableForTarget(this),cc.director._scheduler.scheduleUpdate(this,cc.Scheduler.PRIORITY_SYSTEM,!1)},update:function(t){this._dragonBones.advanceTime(t)},getDragonBonesDataByRawData:function(t){return(t instanceof ArrayBuffer?n._binaryParser:this._dataParser).parseDragonBonesData(t,1)},buildArmatureDisplay:function(t,e,i,n){t=this.buildArmature(t,e,i,n);return t&&t._display},createArmatureNode:function(t,e,i){var n=(n=(i=i||new cc.Node).getComponent(dragonBones.ArmatureDisplay))||i.addComponent(dragonBones.ArmatureDisplay);return i.name=e,n._armatureName=e,n._N$dragonAsset=t.dragonAsset,n._N$dragonAtlasAsset=t.dragonAtlasAsset,n._init(),n},_buildTextureAtlasData:function(t,e){return t?t.renderTexture=e:t=r.borrowObject(dragonBones.CCTextureAtlasData),t},_sortSlots:function(){for(var t=this._slots,e=[],i=0,n=t.length;i<n;i++){for(var r=t[i],s=r._zOrder,a=!1,o=e.length-1;0<=o;o--)if(s>=e[o]._zOrder){e.splice(o+1,0,r),a=!0;break}a||e.splice(0,0,r)}this._slots=e},_buildArmature:function(t){var e=r.borrowObject(dragonBones.Armature),i=(e._skinData=t.skin,e._animation=r.borrowObject(dragonBones.Animation),(e._animation._armature=e)._animation.animations=t.armature.animations,e._isChildArmature=!1,new dragonBones.CCArmatureDisplay);return e.init(t.armature,i,i,this._dragonBones),e},_buildSlot:function(t,e,i){var n=r.borrowObject(dragonBones.CCSlot);return n.init(e,i,n,n),n},getDragonBonesDataByUUID:function(t){for(var e in this._dragonBonesDataMap)if(-1!=e.indexOf(t))return this._dragonBonesDataMap[e];return null},removeDragonBonesDataByUUID:function(t,e){for(var i in void 0===e&&(e=!0),this._dragonBonesDataMap)-1!==i.indexOf(t)&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[i]),delete this._dragonBonesDataMap[i])}})},{}],409:[function(t,e,i){"use strict";var n=(t=t("../../cocos2d/core/value-types/mat4"))&&t.__esModule?t:{default:t},O=dragonBones.BinaryOffset,L=dragonBones.BoneType;dragonBones.CCSlot=cc.Class({name:"dragonBones.CCSlot",extends:dragonBones.Slot,ctor:function(){this._localVertices=[],this._indices=[],this._matrix=cc.mat4(),this._worldMatrix=cc.mat4(),this._worldMatrixDirty=!0,this._visible=!1,this._color=cc.color()},_onClear:function(){this._super(),this._localVertices.length=0,this._indices.length=0,n.default.identity(this._matrix),n.default.identity(this._worldMatrix),this._worldMatrixDirty=!0,this._color=cc.color(),this._visible=!1},statics:{toString:function(){return"[class dragonBones.CCSlot]"}},_onUpdateDisplay:function(){},_initDisplay:function(t){},_addDisplay:function(){this._visible=!0},_replaceDisplay:function(t){},_removeDisplay:function(){this._visible=!1},_disposeDisplay:function(t){},_updateVisible:function(){this._visible=this.parent._visible},_updateZOrder:function(){},_updateBlendMode:function(){if(this._childArmature)for(var t=this._childArmature.getSlots(),e=0,i=t.length;e<i;e++){var n=t[e];n._blendMode=this._blendMode,n._updateBlendMode()}},_updateColor:function(){var t=this._color;t.r=255*this._colorTransform.redMultiplier,t.g=255*this._colorTransform.greenMultiplier,t.b=255*this._colorTransform.blueMultiplier,t.a=255*this._colorTransform.alphaMultiplier},getTexture:function(){return this._textureData&&this._textureData.spriteFrame&&this._textureData.spriteFrame.getTexture()},_updateFrame:function(){this._indices.length=0;var t=this._indices,e=this._localVertices,i=0,n=0,r=this._textureData;if(this._display&&!(this._displayIndex<0)&&r&&r.spriteFrame){var s=r.spriteFrame.getTexture(),a=s.width,o=s.height,l=r.region,h=null!==this._deformVertices&&this._display===this._meshDisplay?this._deformVertices.verticesData:null;if(h){var s=h.data,c=s.intArray,u=s.floatArray,r=c[h.offset+O.MeshVertexCount],_=c[h.offset+O.MeshTriangleCount],d=c[h.offset+O.MeshFloatOffset];d<0&&(d+=65536);for(var f=d+2*r,p=this._armature._armatureData.scale,m=0,y=2*r;m<y;m+=2)e[n++]=u[d+m]*p,e[n++]=-u[d+m+1]*p,h.rotated?e[n++]=(l.x+(1-u[f+m])*l.width)/a:e[n++]=(l.x+u[f+m]*l.width)/a,e[n++]=(l.y+u[f+m+1]*l.height)/o;for(var g=0;g<3*_;++g)t[i++]=c[h.offset+O.MeshVertexIndices+g];e.length=n,t.length=i,h.weight&&this._identityTransform()}else{var s=l.x/a,r=(l.y+l.height)/o,v=(l.x+l.width)/a,b=l.y/o;e[n++]=0,e[n++]=0,e[n++]=s,e[n++]=r,e[n++]=l.width,e[n++]=0,e[n++]=v,e[n++]=r,e[n++]=0,e[n++]=l.height,e[n++]=s,e[n++]=b,e[n++]=l.width,e[n++]=l.height,e[n++]=v,e[n++]=b,t[0]=0,t[1]=1,t[2]=2,t[3]=1,t[4]=3,t[5]=2,e.length=n,t.length=6}this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0}},_updateMesh:function(){var t=this._armature._armatureData.scale,e=this._deformVertices.vertices,i=this._deformVertices.bones,n=this._deformVertices.verticesData,r=n.weight,s=0<e.length&&n.inheritDeform,a=this._localVertices;if(r){var o=n.data,l=o.intArray,h=o.floatArray,c=l[n.offset+O.MeshVertexCount],o=l[r.offset+O.WeigthFloatOffset];o<0&&(o+=65536);for(var u=0,_=r.offset+O.WeigthBoneIndices+i.length,d=o,f=0,p=0;u<c;u++,p+=4){for(var m=l[_++],y=0,g=0,v=0;v<m;++v){var b,x,A,C=i[l[_++]];null!==C&&(C=C.globalTransformMatrix,b=h[d++],x=h[d++]*t,A=h[d++]*t,s&&(x+=e[f++],A+=e[f++]),y+=(C.a*x+C.c*A+C.tx)*b,g+=(C.b*x+C.d*A+C.ty)*b)}a[p]=y,a[p+1]=-g}}else if(s){var T=this._parent._boneData.type!==L.Bone,o=n.data,S=o.intArray,w=o.floatArray,o=S[n.offset+O.MeshVertexCount],E=S[n.offset+O.MeshFloatOffset];E<0&&(E+=65536);for(var M=0,D=o,B=0;M<D;M++,B+=4){var I,P=w[E+2*M]*t+e[2*M],R=w[E+2*M+1]*t+e[2*M+1];T?(I=this._parent._getGlobalTransformMatrix(P,R),a[B]=I.a*P+I.c*R+I.tx,a[B+1]=-I.b*P+I.d*R+I.ty):(a[B]=P,a[B+1]=-R)}}r&&this._identityTransform()},_identityTransform:function(){var t=this._matrix.m;t[0]=1,t[1]=0,t[4]=-0,t[5]=-1,t[12]=0,t[13]=0,this._worldMatrixDirty=!0},_updateTransform:function(){var t=this._matrix.m;t[0]=this.globalTransformMatrix.a,t[1]=this.globalTransformMatrix.b,t[4]=-this.globalTransformMatrix.c,t[5]=-this.globalTransformMatrix.d,this._childArmature?(t[12]=this.globalTransformMatrix.tx,t[13]=this.globalTransformMatrix.ty):(t[12]=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX-this.globalTransformMatrix.c*this._pivotY),t[13]=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX-this.globalTransformMatrix.d*this._pivotY)),this._worldMatrixDirty=!0},updateWorldMatrix:function(){if(this._armature){var t=this._armature._parent;if(t&&t.updateWorldMatrix(),this._worldMatrixDirty){this.calculWorldMatrix();t=this.childArmature;if(t)for(var e=t.getSlots(),i=0,n=e.length;i<n;i++){var r=e[i];r&&(r._worldMatrixDirty=!0)}}}},_mulMat:function(t,e,i){var e=e.m,i=i.m,t=t.m,n=e[0],r=e[1],s=e[4],a=e[5],o=e[12],e=e[13],l=i[0],h=i[1],c=i[4],u=i[5],_=i[12],i=i[13];0!==r||0!==s?(t[0]=l*n+h*s,t[1]=l*r+h*a,t[4]=c*n+u*s,t[5]=c*r+u*a,t[12]=n*_+s*i+o,t[13]=r*_+a*i+e):(t[0]=l*n,t[1]=h*a,t[4]=c*n,t[5]=u*a,t[12]=n*_+o,t[13]=a*i+e)},calculWorldMatrix:function(){var t=this._armature._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):n.default.copy(this._worldMatrix,this._matrix),this._worldMatrixDirty=!1}})},{"../../cocos2d/core/value-types/mat4":332}],410:[function(t,e,i){"use strict";dragonBones.CCTextureAtlasData=cc.Class({extends:dragonBones.TextureAtlasData,name:"dragonBones.CCTextureAtlasData",properties:{_renderTexture:{default:null,serializable:!1},renderTexture:{get:function(){return this._renderTexture},set:function(t){if(this._renderTexture=t)for(var e in this.textures){var i,n,r,e=this.textures[e];e.spriteFrame||(i=null,i=e.rotated?cc.rect(e.region.x,e.region.y,e.region.height,e.region.width):cc.rect(e.region.x,e.region.y,e.region.width,e.region.height),n=cc.v2(0,0),r=cc.size(i.width,i.height),e.spriteFrame=new cc.SpriteFrame,e.spriteFrame.setTexture(t,i,!1,n,r))}else for(var s in this.textures)this.textures[s].spriteFrame=null}}},statics:{toString:function(){return"[class dragonBones.CCTextureAtlasData]"}},_onClear:function(){dragonBones.TextureAtlasData.prototype._onClear.call(this),this.renderTexture=null},createTexture:function(){return dragonBones.BaseObject.borrowObject(dragonBones.CCTextureData)}}),dragonBones.CCTextureData=cc.Class({extends:dragonBones.TextureData,name:"dragonBones.CCTextureData",properties:{spriteFrame:{default:null,serializable:!1}},statics:{toString:function(){return"[class dragonBones.CCTextureData]"}},_onClear:function(){dragonBones.TextureData.prototype._onClear.call(this),this.spriteFrame=null}})},{}],411:[function(t,e,i){"use strict";var n=t("./ArmatureCache").sharedCache,t=cc.Class({name:"dragonBones.DragonBonesAsset",extends:cc.Asset,ctor:function(){this.reset()},properties:{_dragonBonesJson:"",dragonBonesJson:{get:function(){return this._dragonBonesJson},set:function(t){this._dragonBonesJson=t,this._dragonBonesJsonData=JSON.parse(t),this.reset()}},_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t,this.reset()},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._clear()},init:function(t,e){this._factory=t,!this._dragonBonesJsonData&&this.dragonBonesJson&&(this._dragonBonesJsonData=JSON.parse(this.dragonBonesJson));var t=this._dragonBonesJsonData||this._nativeAsset,i=(this._uuid||((i=this._factory.getDragonBonesDataByRawData(t))?this._uuid=i.name:cc.warn("dragonbones name is empty")),this._uuid+"#"+e);return this._factory.getDragonBonesData(i)||this._factory.parseDragonBonesData(t,i),i},getArmatureEnum:!1,getAnimsEnum:!1,_clear:function(){this._factory&&(n.resetArmature(this._uuid),this._factory.removeDragonBonesDataByUUID(this._uuid,!0))},destroy:function(){this._clear(),this._super()}});dragonBones.DragonBonesAsset=e.exports=t},{"./ArmatureCache":404}],412:[function(t,e,i){"use strict";var n=t("./ArmatureCache").sharedCache,t=cc.Class({name:"dragonBones.DragonBonesAtlasAsset",extends:cc.Asset,ctor:function(){this._clear()},properties:{_atlasJson:"",atlasJson:{get:function(){return this._atlasJson},set:function(t){this._atlasJson=t,this._atlasJsonData=JSON.parse(this.atlasJson),this._clear()}},_texture:{default:null,type:cc.Texture2D,formerlySerializedAs:"texture"},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._clear()}},_textureAtlasData:null},statics:{preventDeferredLoadDependents:!0},createNode:!1,init:function(t){this._factory=t,this._atlasJsonData||(this._atlasJsonData=JSON.parse(this.atlasJson));var e=this._atlasJsonData;this._uuid=this._uuid||e.name,this._textureAtlasData?t.addTextureAtlasData(this._textureAtlasData,this._uuid):this._textureAtlasData=t.parseTextureAtlasData(e,this.texture,this._uuid)},_clear:function(){this._factory&&(n.resetArmature(this._uuid),this._factory.removeTextureAtlasData(this._uuid,!0),this._factory.removeDragonBonesDataByUUID(this._uuid,!0)),this._textureAtlasData=null},destroy:function(){this._clear(),this._super()}});dragonBones.DragonBonesAtlasAsset=e.exports=t},{"./ArmatureCache":404}],413:[function(t,e,i){"use strict";var n="undefined"==typeof window?global:window;n.dragonBones=t("./lib/dragonBones"),void 0!==n.dragonBones&&(dragonBones._timeScale=1,Object.defineProperty(dragonBones,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t,this.CCFactory.getInstance()._dragonBones.clock.timeScale=t},configurable:!0}),dragonBones.DisplayType={Image:0,Armature:1,Mesh:2},dragonBones.ArmatureType={Armature:0,MovieClip:1,Stage:2},dragonBones.ExtensionType={FFD:0,AdjustColor:10,BevelFilter:11,BlurFilter:12,DropShadowFilter:13,GlowFilter:14,GradientBevelFilter:15,GradientGlowFilter:16},dragonBones.EventType={Frame:0,Sound:1},dragonBones.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5},dragonBones.AnimationFadeOutMode={None:0,SameLayer:1,SameGroup:2,SameLayerAndGroup:3,All:4},dragonBones.BinaryOffset={WeigthBoneCount:0,WeigthFloatOffset:1,WeigthBoneIndices:2,MeshVertexCount:0,MeshTriangleCount:1,MeshFloatOffset:2,MeshWeightOffset:3,MeshVertexIndices:4,TimelineScale:0,TimelineOffset:1,TimelineKeyFrameCount:2,TimelineFrameValueCount:3,TimelineFrameValueOffset:4,TimelineFrameOffset:5,FramePosition:0,FrameTweenType:1,FrameTweenEasingOrCurveSampleCount:2,FrameCurveSamples:3,DeformMeshOffset:0,DeformCount:1,DeformValueCount:2,DeformValueOffset:3,DeformFloatOffset:4},dragonBones.BoneType={Bone:0,Surface:1},t("./CCFactory"),t("./CCSlot"),t("./CCTextureData"),t("./CCArmatureDisplay"),t("./ArmatureCache"),t("./DragonBonesAsset"),t("./DragonBonesAtlasAsset"),t("./ArmatureDisplay"),t("./webgl-assembler"))},{"./ArmatureCache":404,"./ArmatureDisplay":405,"./CCArmatureDisplay":407,"./CCFactory":408,"./CCSlot":409,"./CCTextureData":410,"./DragonBonesAsset":411,"./DragonBonesAtlasAsset":412,"./lib/dragonBones":414,"./webgl-assembler":415}],414:[function(P,R,O){"use strict";Object.setPrototypeOf||0 instanceof Array;var t,g,F,z,V,N,U,j,W,h,H,X,_,Y,e,q,J,Z,K,Q,$,tt,et,it,i=i||{},n=(function(a){function e(t){this._clock=new a.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=t,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}e.prototype.advanceTime=function(t){if(0<this._objects.length){for(var e=0,i=this._objects;e<i.length;e++)i[e].returnToPool();this._objects.length=0}if(this._clock.advanceTime(t),0<this._events.length){for(var n=0;n<this._events.length;++n){var r=this._events[n],s=r.armature;null!==s._armatureData&&(s.eventDispatcher.dispatchDBEvent(r.type,r),r.type===a.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(r.type,r)),this.bufferObject(r)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.6.300",e.yDown=!1,e.debug=!1,e.debugDraw=!1,e.webAssembly=!1,a.DragonBones=e}(i=i||{}),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return(new Date).getTime()}),t=function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},function(t){function r(){this.hashCode=r._hashCode++,this._isInPool=!1}r._returnObject=function(t){var e=String(t.constructor),i=e in r._maxCountMap?r._maxCountMap[e]:r._defaultMaxCount,e=r._poolsMap[e]=r._poolsMap[e]||[];e.length<i&&(t._isInPool?console.warn("The object is already in the pool."):(t._isInPool=!0,e.push(t)))},r.toString=function(){throw new Error},r.setMaxCount=function(t,e){if((e<0||e!=e)&&(e=0),null!==t)null!==(n=(i=String(t))in r._poolsMap?r._poolsMap[i]:null)&&n.length>e&&(n.length=e),r._maxCountMap[i]=e;else for(var i in r._defaultMaxCount=e,r._poolsMap){var n;(n=r._poolsMap[i]).length>e&&(n.length=e),i in r._maxCountMap&&(r._maxCountMap[i]=e)}},r.clearPool=function(t){if(null!==(t=void 0===t?null:t)){t=String(t);null!==(i=t in r._poolsMap?r._poolsMap[t]:null)&&0<i.length&&(i.length=0)}else for(var e in r._poolsMap){var i;(i=r._poolsMap[e]).length=0}},r.borrowObject=function(t){var e=String(t),e=e in r._poolsMap?r._poolsMap[e]:null;if(null!==e&&0<e.length)return(e=e.pop())._isInPool=!1,e;e=new t;return e._onClear(),e},r.prototype.returnToPool=function(){this._onClear(),r._returnObject(this)},r._hashCode=0,r._defaultMaxCount=3e3,r._maxCountMap={},r._poolsMap={},t.BaseObject=r}(i=i||{}),function(t){function e(t,e,i,n,r,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),this.a=t=void 0===t?1:t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s}e.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},e.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},e.prototype.copyFromArray=function(t,e){return this.a=t[e=void 0===e?0:e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},e.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},e.prototype.concat=function(t){var e=this.a*t.a,i=0,n=0,r=this.d*t.d,s=this.tx*t.a+t.tx,a=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,n+=this.c*t.a,r+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,n+=this.d*t.c,s+=this.ty*t.c,a+=this.tx*t.b),this.a=e,this.b=i,this.c=n,this.d=r,this.tx=s,this.ty=a,this},e.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=this.ty;if(0===e&&0===i)return(this.b=this.c=0)===t||0===n?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,n=this.d=1/n,this.tx=-t*r,this.ty=-n*s),this;var a=t*n-e*i;if(0==a)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;var o=this.a=n*(a=1/a),e=this.b=-e*a,i=this.c=-i*a,n=this.d=t*a;return this.tx=-(o*r+i*s),this.ty=-(e*r+n*s),this},e.prototype.transformPoint=function(t,e,i,n){void 0===n&&(n=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,n||(i.x+=this.tx,i.y+=this.ty)},e.prototype.transformRectangle=function(t,e){var i=this.a,n=this.b,r=this.c,s=this.d,a=(e=void 0===e?!1:e)?0:this.tx,e=e?0:this.ty,o=t.x,l=t.y,h=o+t.width,c=l+t.height,u=i*o+r*l+a,_=n*o+s*l+e,d=i*h+r*l+a,l=n*h+s*l+e,f=i*h+r*c+a,h=n*h+s*c+e,i=i*o+r*c+a,r=n*o+s*c+e,a=0;d<u&&(a=u,u=d,d=a),i<f&&(a=f,f=i,i=a),t.x=Math.floor(u<f?u:f),t.width=Math.ceil((i<d?d:i)-t.x),l<_&&(a=_,_=l,l=a),r<h&&(a=h,h=r,r=a),t.y=Math.floor(_<h?_:h),t.height=Math.ceil((r<l?l:r)-t.y)},t.Matrix=e}(i=i||{}),function(t){function s(t,e,i,n,r,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=1),this.x=t=void 0===t?0:t,this.y=e,this.skew=i,this.rotation=n,this.scaleX=r,this.scaleY=s}s.normalizeRadian=function(t){return(t=(t+Math.PI)%(2*Math.PI))+(0<t?-Math.PI:Math.PI)},s.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},s.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},s.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},s.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},s.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},s.prototype.fromMatrix=function(t){var e=this.scaleX,i=this.scaleY,n=s.PI_Q,r=(this.x=t.tx,this.y=t.ty,this.rotation=Math.atan(t.b/t.a),Math.atan(-t.c/t.d));return this.scaleX=this.rotation>-n&&this.rotation<n?t.a/Math.cos(this.rotation):t.b/Math.sin(this.rotation),this.scaleY=-n<r&&r<n?t.d/Math.cos(r):-t.c/Math.sin(r),0<=e&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),0<=i&&this.scaleY<0&&(this.scaleY=-this.scaleY,r-=Math.PI),this.skew=r-this.rotation,this},s.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},s.PI=Math.PI,s.PI_D=2*Math.PI,s.PI_H=Math.PI/2,s.PI_Q=Math.PI/4,s.RAD_DEG=180/Math.PI,s.DEG_RAD=Math.PI/180,t.Transform=s}(i=i||{}),function(t){function e(t,e,i,n,r,s,a,o){void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),this.alphaMultiplier=t=void 0===t?1:t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=n,this.alphaOffset=r,this.redOffset=s,this.greenOffset=a,this.blueOffset=o}e.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},e.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t.ColorTransform=e}(i=i||{}),function(t){function e(t,e){void 0===e&&(e=0),this.x=t=void 0===t?0:t,this.y=e}e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},e.prototype.clear=function(){this.x=this.y=0},t.Point=e}(i=i||{}),function(t){function e(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t=void 0===t?0:t,this.y=e,this.width=i,this.height=n}e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},e.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t.Rectangle=e}(i=i||{}),i=i||{});function r(){var t=null!==it&&it.apply(this,arguments)||this;return t.ints=[],t.floats=[],t.strings=[],t}it=n.BaseObject,t(r,it),r.toString=function(){return"[class dragonBones.UserData]"},r.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},r.prototype.addInt=function(t){this.ints.push(t)},r.prototype.addFloat=function(t){this.floats.push(t)},r.prototype.addString=function(t){this.strings.push(t)},r.prototype.getInt=function(t){return 0<=(t=void 0===t?0:t)&&t<this.ints.length?this.ints[t]:0},r.prototype.getFloat=function(t){return 0<=(t=void 0===t?0:t)&&t<this.floats.length?this.floats[t]:0},r.prototype.getString=function(t){return 0<=(t=void 0===t?0:t)&&t<this.strings.length?this.strings[t]:""},n.UserData=r,nt=n.BaseObject,t(rt,nt),rt.toString=function(){return"[class dragonBones.ActionData]"},rt.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null};var nt;function rt(){var t=null!==nt&&nt.apply(this,arguments)||this;return t.data=null,t}n.ActionData=rt,n=i=i||{},et=n.BaseObject,t(Ne,et),Ne.toString=function(){return"[class dragonBones.DragonBonesData]"},Ne.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.userData=null},Ne.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):((t.parent=this).armatures[t.name]=t,this.armatureNames.push(t.name))},Ne.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},Ne.prototype.dispose=function(){console.warn(""),this.returnToPool()},n.DragonBonesData=Ne;var s=i=i||{};st=s.BaseObject,t(a,st),a.toString=function(){return"[class dragonBones.ArmatureData]"},a.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++)e[t].returnToPool();for(var i,n=0,r=this.actions;n<r.length;n++)r[n].returnToPool();for(i in this.bones)this.bones[i].returnToPool(),delete this.bones[i];for(i in this.slots)this.slots[i].returnToPool(),delete this.slots[i];for(i in this.constraints)this.constraints[i].returnToPool(),delete this.constraints[i];for(i in this.skins)this.skins[i].returnToPool(),delete this.skins[i];for(i in this.animations)this.animations[i].returnToPool(),delete this.animations[i];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},a.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,n=0;for(this.sortedBones.length=0;n<t;){var r=e[i++];if(t<=i&&(i=0),!(0<=this.sortedBones.indexOf(r))){var s,a=!1;for(s in this.constraints){var o=this.constraints[s];if(o.root===r&&this.sortedBones.indexOf(o.target)<0){a=!0;break}}a||null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),n++)}}}},a.prototype.cacheFrames=function(t){if(!(0<this.cacheFrameRate))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},a.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,n=i.length;return i.length+=10,i[n]=t.a,i[n+1]=t.b,i[n+2]=t.c,i[n+3]=t.d,i[n+4]=t.tx,i[n+5]=t.ty,i[n+6]=e.rotation,i[n+7]=e.skew,i[n+8]=e.scaleX,i[n+9]=e.scaleY,n},a.prototype.getCacheFrame=function(t,e,i){var n=this.parent.cachedFrames;t.a=n[i],t.b=n[i+1],t.c=n[i+2],t.d=n[i+3],t.tx=n[i+4],t.ty=n[i+5],e.rotation=n[i+6],e.skew=n[i+7],e.scaleX=n[i+8],e.scaleY=n[i+9],e.x=t.tx,e.y=t.ty},a.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},a.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},a.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},a.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):((t.parent=this).skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},a.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):((t.parent=this).animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},a.prototype.addAction=function(t,e){(e?this.defaultActions:this.actions).push(t)},a.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},a.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},a.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},a.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},a.prototype.getMesh=function(t,e,i){t=this.getSkin(t);return null===t?null:t.getDisplay(e,i)},a.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null};var st,n=a;function a(){var t=null!==st&&st.apply(this,arguments)||this;return t.aabb=new s.Rectangle,t.animationNames=[],t.sortedBones=[],t.sortedSlots=[],t.defaultActions=[],t.actions=[],t.bones={},t.slots={},t.constraints={},t.skins={},t.animations={},t.canvas=null,t.userData=null,t}s.ArmatureData=a,at=s.BaseObject,t(ot,at),ot.toString=function(){return"[class dragonBones.BoneData]"},ot.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.name="",this.transform.identity(),this.userData=null,this.parent=null};var at,n=ot;function ot(){var t=null!==at&&at.apply(this,arguments)||this;return t.transform=new s.Transform,t.userData=null,t}s.BoneData=n,t(ht,lt=n),ht.toString=function(){return"[class dragonBones.SurfaceData]"},ht.prototype._onClear=function(){lt.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.vertices.length=0};var lt,n=ht;function ht(){var t=null!==lt&&lt.apply(this,arguments)||this;return t.vertices=[],t}s.SurfaceData=ht,ct=s.BaseObject,t(ut,ct),ut.createColor=function(){return new s.ColorTransform},ut.toString=function(){return"[class dragonBones.SlotData]"},ut.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.name="",this.color=null,this.userData=null,this.parent=null},ut.DEFAULT_COLOR=new s.ColorTransform;var ct,n=ut;function ut(){var t=null!==ct&&ct.apply(this,arguments)||this;return t.color=null,t.userData=null,t}s.SlotData=ut;n=i=i||{};_t=n.BaseObject,t(ft,_t),ft.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null};var _t,dt,o=ft;function ft(){return null!==_t&&_t.apply(this,arguments)||this}function pt(){return null!==dt&&dt.apply(this,arguments)||this}n.ConstraintData=o,t(pt,dt=o),pt.toString=function(){return"[class dragonBones.IKConstraintData]"},pt.prototype._onClear=function(){dt.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},n.IKConstraintData=pt,t(yt,mt=o),yt.toString=function(){return"[class dragonBones.PathConstraintData]"},yt.prototype._onClear=function(){mt.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},yt.prototype.AddBone=function(t){this.bones.push(t)};var mt;function yt(){var t=null!==mt&&mt.apply(this,arguments)||this;return t.bones=[],t}n.PathConstraintData=yt,o=i=i||{},tt=o.BaseObject,t(Ve,tt),Ve.toString=function(){return"[class dragonBones.CanvasData]"},Ve.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},o.CanvasData=Ve,n=i=i||{},$=n.BaseObject,t(Fe,$),Fe.toString=function(){return"[class dragonBones.SkinData]"},Fe.prototype._onClear=function(){for(var t in this.displays){for(var e=0,i=this.displays[t];e<i.length;e++){var n=i[e];null!==n&&n.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},Fe.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},Fe.prototype.getDisplay=function(t,e){t=this.getDisplays(t);if(null!==t)for(var i=0,n=t;i<n.length;i++){var r=n[i];if(null!==r&&r.name===e)return r}return null},Fe.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},n.SkinData=Fe;var l=i=i||{},gt=(vt.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},vt.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},vt);function vt(){this.weight=null}l.VerticesData=gt,bt=l.BaseObject,t(At,bt),At.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null};var bt,xt,o=At;function At(){var t=null!==bt&&bt.apply(this,arguments)||this;return t.transform=new l.Transform,t}function Ct(){var t=null!==xt&&xt.apply(this,arguments)||this;return t.pivot=new l.Point,t}l.DisplayData=o,t(Ct,xt=o),Ct.toString=function(){return"[class dragonBones.ImageDisplayData]"},Ct.prototype._onClear=function(){xt.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},l.ImageDisplayData=Ct,t(St,Tt=o),St.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},St.prototype._onClear=function(){Tt.prototype._onClear.call(this);for(var t=0,e=this.actions;t<e.length;t++)e[t].returnToPool();this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},St.prototype.addAction=function(t){this.actions.push(t)};var Tt;function St(){var t=null!==Tt&&Tt.apply(this,arguments)||this;return t.actions=[],t}l.ArmatureDisplayData=St,t(Et,wt=o),Et.toString=function(){return"[class dragonBones.MeshDisplayData]"},Et.prototype._onClear=function(){wt.prototype._onClear.call(this),this.type=2,this.vertices.clear(),this.texture=null};var wt;function Et(){var t=null!==wt&&wt.apply(this,arguments)||this;return t.vertices=new gt,t}l.MeshDisplayData=Et,t(Dt,Mt=o),Dt.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},Dt.prototype._onClear=function(){Mt.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null};var Mt;function Dt(){var t=null!==Mt&&Mt.apply(this,arguments)||this;return t.boundingBox=null,t}l.BoundingBoxDisplayData=Dt,t(It,Bt=o),It.toString=function(){return"[class dragonBones.PathDisplayData]"},It.prototype._onClear=function(){Bt.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.vertices.clear(),this.curveLengths.length=0};var Bt;function It(){var t=null!==Bt&&Bt.apply(this,arguments)||this;return t.vertices=new gt,t.curveLengths=[],t}l.PathDisplayData=It,Pt=l.BaseObject,t(Rt,Pt),Rt.toString=function(){return"[class dragonBones.WeightData]"},Rt.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},Rt.prototype.addBone=function(t){this.bones.push(t)};var Pt,o=Rt;function Rt(){var t=null!==Pt&&Pt.apply(this,arguments)||this;return t.bones=[],t}l.WeightData=Rt;n=i=i||{};Ot=n.BaseObject,t(Lt,Ot),Lt.prototype._onClear=function(){this.color=0,this.width=0,this.height=0};var Ot,o=Lt;function Lt(){return null!==Ot&&Ot.apply(this,arguments)||this}n.BoundingBoxData=o,t(b,Ft=o),b.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},b._computeOutCode=function(t,e,i,n,r,s){var a=0;return t<i?a|=1:r<t&&(a|=2),e<n?a|=4:s<e&&(a|=8),a},b.rectangleIntersectsSegment=function(t,e,i,n,r,s,a,o,l,h,c){void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null);var u=r<t&&t<a&&s<e&&e<o,_=r<i&&i<a&&s<n&&n<o;if(u&&_)return-1;for(var d=0,f=b._computeOutCode(t,e,r,s,a,o),p=b._computeOutCode(i,n,r,s,a,o);;){if(0==(f|p)){d=2;break}if(0!=(f&p))break;var m=0,y=0,g=0,v=0!==f?f:p;0!=(4&v)?(m=t+(i-t)*(s-e)/(n-e),y=s,null!==c&&(g=.5*-Math.PI)):0!=(8&v)?(m=t+(i-t)*(o-e)/(n-e),y=o,null!==c&&(g=.5*Math.PI)):0!=(2&v)?(y=e+(n-e)*(a-t)/(i-t),m=a,null!==c&&(g=0)):0!=(1&v)&&(y=e+(n-e)*(r-t)/(i-t),m=r,null!==c&&(g=Math.PI)),v===f?(t=m,e=y,f=b._computeOutCode(t,e,r,s,a,o),null!==c&&(c.x=g)):(i=m,n=y,p=b._computeOutCode(i,n,r,s,a,o),null!==c&&(c.y=g))}return d&&(u?(d=2,null!==l&&(l.x=i,l.y=n),null!==h&&(h.x=i,h.y=i),null!==c&&(c.x=c.y+Math.PI)):_?(d=1,null!==l&&(l.x=t,l.y=e),null!==h&&(h.x=t,h.y=e),null!==c&&(c.y=c.x+Math.PI)):(d=3,null!==l&&(l.x=t,l.y=e),null!==h&&(h.x=i,h.y=n))),d},b.prototype._onClear=function(){Ft.prototype._onClear.call(this),this.type=0},b.prototype.containsPoint=function(t,e){var i=.5*this.width;if(-i<=t&&t<=i){t=.5*this.height;if(-t<=e&&e<=t)return!0}return!1},b.prototype.intersectsSegment=function(t,e,i,n,r,s,a){var o=.5*this.width,l=.5*this.height;return b.rectangleIntersectsSegment(t,e,i,n,-o,-l,o,l,r=void 0===r?null:r,s=void 0===s?null:s,a=void 0===a?null:a)};var Ft,Vt,Nt=b;function b(){return null!==Ft&&Ft.apply(this,arguments)||this}function c(){return null!==Vt&&Vt.apply(this,arguments)||this}n.RectangleBoundingBoxData=Nt,t(c,Vt=o),c.toString=function(){return"[class dragonBones.EllipseData]"},c.ellipseIntersectsSegment=function(t,e,i,n,r,s,a,o,l,h,c){void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null);var o=a/o,u=o*o,_=i-t,d=(n*=o)-(e*=o),f=Math.sqrt(_*_+d*d),_=_/f,d=d/f,r=(r-t)*_+(s-e)*d,s=a*a,a=s-(t*t+e*e)+r*r,p=0;if(0<=a){var a=Math.sqrt(a),m=r-a,r=r+a,a=m<0?-1:m<=f?0:1,f=r<0?-1:r<=f?0:1,y=a*f;if(y<0)return-1;0==y&&(-1==a?(p=2,i=t+r*_,n=(e+r*d)/o,null!==l&&(l.x=i,l.y=n),null!==h&&(h.x=i,h.y=n),null!==c&&(c.x=Math.atan2(n/s*u,i/s),c.y=c.x+Math.PI)):1==f?(p=1,t+=m*_,e=(e+m*d)/o,null!==l&&(l.x=t,l.y=e),null!==h&&(h.x=t,h.y=e),null!==c&&(c.x=Math.atan2(e/s*u,t/s),c.y=c.x+Math.PI)):(p=3,null!==l&&(l.x=t+m*_,l.y=(e+m*d)/o,null!==c&&(c.x=Math.atan2(l.y/s*u,l.x/s))),null!==h&&(h.x=t+r*_,h.y=(e+r*d)/o,null!==c&&(c.y=Math.atan2(h.y/s*u,h.x/s)))))}return p},c.prototype._onClear=function(){Vt.prototype._onClear.call(this),this.type=1},c.prototype.containsPoint=function(t,e){var i=.5*this.width;if(-i<=t&&t<=i){var n=.5*this.height;if(-n<=e&&e<=n)return e*=i/n,Math.sqrt(t*t+e*e)<=i}return!1},c.prototype.intersectsSegment=function(t,e,i,n,r,s,a){return c.ellipseIntersectsSegment(t,e,i,n,0,0,.5*this.width,.5*this.height,r=void 0===r?null:r,s=void 0===s?null:s,a=void 0===a?null:a)},n.EllipseBoundingBoxData=c,t(u,kt=o),u.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},u.polygonIntersectsSegment=function(t,e,i,n,r,s,a,o){void 0===s&&(s=null),void 0===a&&(a=null),void 0===o&&(o=null);for(var l=r.length,h=(t=t===i?i+1e-6:t)-i,c=(e=e===n?n+1e-6:e)-n,u=t*n-e*i,_=0,d=r[l-2],f=r[l-1],p=0,m=0,y=0,g=0,v=0,b=0,x=0;x<l;x+=2){var A=r[x],C=r[x+1],T=(d=d===A?A+1e-4:d)-A,S=(f=f===C?C+1e-4:f)-C,w=d*C-f*A,E=h*S-c*T,T=(u*T-h*w)/E;if((d<=T&&T<=A||A<=T&&T<=d)&&(0==h||t<=T&&T<=i||i<=T&&T<=t)){S=(u*S-c*w)/E;if((f<=S&&S<=C||C<=S&&S<=f)&&(0==c||e<=S&&S<=n||n<=S&&S<=e)){if(null===a){v=y=T,b=g=S,_++,null!==o&&(o.x=Math.atan2(C-f,A-d)-.5*Math.PI,o.y=o.x);break}w=T-t;w<0&&(w=-w),0===_?(m=p=w,v=y=T,b=g=S,null!==o&&(o.x=Math.atan2(C-f,A-d)-.5*Math.PI,o.y=o.x)):(w<p&&(p=w,y=T,g=S,null!==o&&(o.x=Math.atan2(C-f,A-d)-.5*Math.PI)),m<w&&(m=w,v=T,b=S,null!==o&&(o.y=Math.atan2(C-f,A-d)-.5*Math.PI))),_++}}d=A,f=C}return 1===_?(null!==s&&(s.x=y,s.y=g),null!==a&&(a.x=y,a.y=g),null!==o&&(o.y=o.x+Math.PI)):1<_&&(_++,null!==s&&(s.x=y,s.y=g),null!==a&&(a.x=v,a.y=b)),_},u.prototype._onClear=function(){kt.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},u.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var n=0,r=this.vertices.length,s=r-2;n<r;n+=2){var a,o=this.vertices[s+1],l=this.vertices[n+1];!(l<e&&e<=o||o<e&&e<=l)||(e-l)*(this.vertices[s]-(a=this.vertices[n]))/(o-l)+a<t&&(i=!i),s=n}return i},u.prototype.intersectsSegment=function(t,e,i,n,r,s,a){void 0===r&&(r=null),void 0===s&&(s=null),void 0===a&&(a=null);var o=0;return o=0!==Nt.rectangleIntersectsSegment(t,e,i,n,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)?u.polygonIntersectsSegment(t,e,i,n,this.vertices,r,s,a):o};var kt;function u(){var t=null!==kt&&kt.apply(this,arguments)||this;return t.vertices=[],t}n.PolygonBoundingBoxData=u;var zt,o=i=i||{};function d(){var t=null!==zt&&zt.apply(this,arguments)||this;return t.cachedFrames=[],t.boneTimelines={},t.surfaceTimelines={},t.slotTimelines={},t.constraintTimelines={},t.animationTimelines={},t.boneCachedFrameIndices={},t.slotCachedFrameIndices={},t.actionTimeline=null,t.zOrderTimeline=null,t}zt=o.BaseObject,t(d,zt),d.toString=function(){return"[class dragonBones.AnimationData]"},d.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++)i[e].returnToPool();delete this.boneTimelines[t]}for(var t in this.surfaceTimelines){for(var n=0,r=this.surfaceTimelines[t];n<r.length;n++)r[n].returnToPool();delete this.surfaceTimelines[t]}for(var t in this.slotTimelines){for(var s=0,a=this.slotTimelines[t];s<a.length;s++)a[s].returnToPool();delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var o=0,l=this.constraintTimelines[t];o<l.length;o++)l[o].returnToPool();delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var h=0,c=this.animationTimelines[t];h<c.length;h++)c[h].returnToPool();delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},d.prototype.cacheFrames=function(t){if(!(0<this.cacheFrameRate)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,n=this.cacheFrames.length;i<n;++i)this.cachedFrames[i]=!1;for(var r=0,s=this.parent.sortedBones;r<s.length;r++){for(var a=s[r],i=0,n=(h=new Array(e)).length;i<n;++i)h[i]=-1;this.boneCachedFrameIndices[a.name]=h}for(var o=0,l=this.parent.sortedSlots;o<l.length;o++){var h,c=l[o];for(i=0,n=(h=new Array(e)).length;i<n;++i)h[i]=-1;this.slotCachedFrameIndices[c.name]=h}}},d.prototype.addBoneTimeline=function(t,e){t=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];t.indexOf(e)<0&&t.push(e)},d.prototype.addSurfaceTimeline=function(t,e){t=t.name in this.surfaceTimelines?this.surfaceTimelines[t.name]:this.surfaceTimelines[t.name]=[];t.indexOf(e)<0&&t.push(e)},d.prototype.addSlotTimeline=function(t,e){t=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];t.indexOf(e)<0&&t.push(e)},d.prototype.addConstraintTimeline=function(t,e){t=t.name in this.constraintTimelines?this.constraintTimelines[t.name]:this.constraintTimelines[t.name]=[];t.indexOf(e)<0&&t.push(e)},d.prototype.addAnimationTimeline=function(t,e){t=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];t.indexOf(e)<0&&t.push(e)},d.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},d.prototype.getSurfaceTimelines=function(t){return t in this.surfaceTimelines?this.surfaceTimelines[t]:null},d.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},d.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},d.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},d.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},d.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},o.AnimationData=d,Gt=o.BaseObject,t(Ut,Gt),Ut.toString=function(){return"[class dragonBones.TimelineData]"},Ut.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1};var Gt;function Ut(){return null!==Gt&&Gt.apply(this,arguments)||this}o.TimelineData=Ut,n=i=i||{},Q=n.BaseObject,t(I,Q),I.toString=function(){return"[class dragonBones.AnimationConfig]"},I.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},I.prototype.clear=function(){this._onClear()},I.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},I.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||0<=this.boneMask.indexOf(t)},I.prototype.addBoneMask=function(t,e,i){void 0===i&&(i=!0);var n=t.getBone(e);if(null!==n&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),i))for(var r=0,s=t.getBones();r<s.length;r++){var a=s[r];this.boneMask.indexOf(a.name)<0&&n.contains(a)&&this.boneMask.push(a.name)}},I.prototype.removeBoneMask=function(t,e,i){void 0===i&&(i=!0);var n=this.boneMask.indexOf(e);if(0<=n&&this.boneMask.splice(n,1),i){var r=t.getBone(e);if(null!==r)if(0<this.boneMask.length)for(var s=0,a=t.getBones();s<a.length;s++){var o=a[s],l=this.boneMask.indexOf(o.name);0<=l&&r.contains(o)&&this.boneMask.splice(l,1)}else for(var h=0,c=t.getBones();h<c.length;h++)(o=c[h])===r||r.contains(o)||this.boneMask.push(o.name)}},n.AnimationConfig=I;var jt,Wt=i=i||{};function Ht(){var t=null!==jt&&jt.apply(this,arguments)||this;return t.textures={},t}jt=Wt.BaseObject,t(Ht,jt),Ht.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},Ht.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},Ht.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this).textures[t.name]=t},Ht.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},Wt.TextureAtlasData=Ht,Xt=Wt.BaseObject,t(Yt,Xt),Yt.createRectangle=function(){return new Wt.Rectangle},Yt.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},Yt.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=Yt.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)};var Xt;function Yt(){var t=null!==Xt&&Xt.apply(this,arguments)||this;return t.region=new Wt.Rectangle,t.frame=null,t}Wt.TextureData=Yt,o=i=i||{},K=o.BaseObject,t(Le,K),Le.toString=function(){return"[class dragonBones.DeformVertices]"},Le.prototype._onClear=function(){this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},Le.prototype.init=function(t,e){if(this.verticesData=t,null!==this.verticesData){t=null!==this.verticesData.weight?2*this.verticesData.weight.count:2*this.verticesData.data.intArray[this.verticesData.offset+0];this.verticesDirty=!0,this.vertices.length=t;for(var i=this.bones.length=0,n=this.vertices.length;i<n;++i)this.vertices[i]=0;if(null!==this.verticesData.weight)for(i=0,n=this.verticesData.weight.bones.length;i<n;++i){var r=e.getBone(this.verticesData.weight.bones[i].name);this.bones.push(r)}}else this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},Le.prototype.isBonesUpdate=function(){for(var t=0,e=this.bones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},o.DeformVertices=Le,J=i=i||{},Z=J.BaseObject,t(B,Z),B.toString=function(){return"[class dragonBones.Armature]"},B._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},B.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var i=0,n=this._slots;i<n.length;i++)n[i].returnToPool();for(var r=0,s=this._constraints;r<s.length;r++)s[r].returnToPool();for(var a=0,o=this._actions;a<o.length;a++)o[a].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},B.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,n=null===t;if(this._zOrderDirty||!n){for(var r=0,s=i.length;r<s;++r){var a=n?r:t[e+r];a<0||s<=a||(a=i[a],null!==(a=this.getSlot(a.name))&&a._setZorder(r))}this._slotsDirty=!0,this._zOrderDirty=!n}},B.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},B.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},B.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},B.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},B.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},B.prototype.init=function(t,e,i,n){null===this._armatureData&&(this._armatureData=t,this._animation=J.BaseObject.borrowObject(J.Animation),this._proxy=e,this._display=i,this._dragonBones=n,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},B.prototype.advanceTime=function(t){if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty&&(this._slotsDirty=!1,this._slots.sort(B._onSortSlots)),this._cacheFrameIndex<0||this._cacheFrameIndex!==e){for(var i=0,n=0,i=0,n=this._bones.length;i<n;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,n=this._slots.length;i<n;++i)this._slots[i].update(this._cacheFrameIndex)}if(0<this._actions.length){this._lockUpdate=!0;for(var r=0,s=this._actions;r<s.length;r++){var a=s[r],o=a.actionData;if(null!==o&&0===o.type)if(null!==a.slot)null!==(c=a.slot.childArmature)&&c.animation.fadeIn(o.name);else if(null!==a.bone)for(var l=0,h=this.getSlots();l<h.length;l++){var c,u=h[l];u.parent===a.bone&&null!==(c=u.childArmature)&&c.animation.fadeIn(o.name)}else this._animation.fadeIn(o.name);a.returnToPool()}this._actions.length=0,this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},B.prototype.invalidUpdate=function(t,e){if(void 0===e&&(e=!1),null!==(t=void 0===t?null:t)&&0<t.length){if(null!==(r=this.getBone(t))&&(r.invalidUpdate(),e))for(var i=0,n=this._slots;i<n.length;i++)(s=n[i]).parent===r&&s.invalidUpdate()}else{for(var r,s,a=0,o=this._bones;a<o.length;a++)(r=o[a]).invalidUpdate();if(e)for(var l=0,h=this._slots;l<h.length;l++)(s=h[l]).invalidUpdate()}},B.prototype.containsPoint=function(t,e){for(var i=0,n=this._slots;i<n.length;i++){var r=n[i];if(r.containsPoint(t,e))return r}return null},B.prototype.intersectsSegment=function(t,e,i,n,r,s,a){void 0===r&&(r=null),void 0===s&&(s=null),void 0===a&&(a=null);for(var o=t===i,l=0,h=0,c=0,u=0,_=0,d=0,f=0,p=0,m=null,y=null,g=0,v=this._slots;g<v.length;g++){var b,x=v[g];if(0<x.intersectsSegment(t,e,i,n,r,s,a)){if(null===r&&null===s){m=x;break}null!==r&&((b=o?r.y-e:r.x-t)<0&&(b=-b),(null===m||b<l)&&(l=b,c=r.x,u=r.y,m=x,a&&(f=a.x))),null!==s&&((b=s.x-t)<0&&(b=-b),(null===y||h<b)&&(h=b,_=s.x,d=s.y,y=x,null!==a&&(p=a.y)))}}return null!==m&&null!==r&&(r.x=c,r.y=u,null!==a&&(a.x=f)),null!==y&&null!==s&&(s.x=_,s.y=d,null!==a&&(a.y=p)),m},B.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},B.prototype.getBoneByDisplay=function(t){t=this.getSlotByDisplay(t);return null!==t?t.parent:null},B.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},B.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];if(n.display===t)return n}return null},B.prototype.getBones=function(){return this._bones},B.prototype.getSlots=function(){return this._slots},Object.defineProperty(B.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var n=i[e].childArmature;null!==n&&(n.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];n.invalidUpdate(),n.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var n=i[e].childArmature;null!==n&&(n.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),B.prototype.replaceTexture=function(t){this.replacedTexture=t},B.prototype.hasEventListener=function(t){return this._proxy.hasDBEventListener(t)},B.prototype.addEventListener=function(t,e,i){this._proxy.addDBEventListener(t,e,i)},B.prototype.removeEventListener=function(t,e,i){this._proxy.removeDBEventListener(t,e,i)},B.prototype.enableAnimationCache=function(t){console.warn("Deprecated."),this.cacheFrameRate=t},B.prototype.getDisplay=function(){return this._display},J.Armature=B,e=i=i||{},q=e.BaseObject,t(Oe,q),Oe.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null},Oe.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(Oe.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Oe._helpMatrix=new e.Matrix,Oe._helpTransform=new e.Transform,Oe._helpPoint=new e.Point,e.TransformObject=Oe,_=i=i||{},Y=_.TransformObject,t(D,Y),D.toString=function(){return"[class dragonBones.Bone]"},D.prototype._onClear=function(){Y.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendState.clear(),this._boneData=null,this._parent=null,this._cachedFrameIndices=null},D.prototype._updateGlobalTransformMatrix=function(t){var e=this._boneData,i=this.global,n=this.globalTransformMatrix,r=this.origin,s=this.offset,a=this.animationPose,o=this._parent,l=this._armature.flipX,h=this._armature.flipY===_.DragonBones.yDown,c=null!==o,u=0;1===this.offsetMode?null!==r?(i.x=r.x+s.x+a.x,i.scaleX=r.scaleX*s.scaleX*a.scaleX,i.scaleY=r.scaleY*s.scaleY*a.scaleY,_.DragonBones.yDown?(i.y=r.y+s.y+a.y,i.skew=r.skew+s.skew+a.skew,i.rotation=r.rotation+s.rotation+a.rotation):(i.y=r.y-s.y+a.y,i.skew=r.skew-s.skew+a.skew,i.rotation=r.rotation-s.rotation+a.rotation)):(i.copyFrom(s),_.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation),i.add(a)):0===this.offsetMode?null!==r?i.copyFrom(r).add(a):i.copyFrom(a):(c=!1,i.copyFrom(s),_.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation)),c?(r=0===o._boneData.type?o.globalTransformMatrix:o._getGlobalTransformMatrix(i.x,i.y),e.inheritScale?(e.inheritRotation||(o.updateGlobalTransform(),u=l&&h?i.rotation-(o.global.rotation+Math.PI):l?i.rotation+o.global.rotation+Math.PI:h?i.rotation+o.global.rotation:i.rotation-o.global.rotation,i.rotation=u),i.toMatrix(n),n.concat(r),e.inheritTranslation?(i.x=n.tx,i.y=n.ty):(n.tx=i.x,n.ty=i.y),t?i.fromMatrix(n):this._globalDirty=!0):(e.inheritTranslation?(a=i.x,s=i.y,i.x=r.a*a+r.c*s+r.tx,i.y=r.b*a+r.d*s+r.ty):(l&&(i.x=-i.x),h&&(i.y=-i.y)),e.inheritRotation?(o.updateGlobalTransform(),u=o.global.scaleX<0?i.rotation+o.global.rotation+Math.PI:i.rotation+o.global.rotation,r.a*r.d-r.b*r.c<0&&(u-=2*i.rotation,l===h&&!e.inheritReflection||(i.skew+=Math.PI),_.DragonBones.yDown||(i.skew=-i.skew)),i.rotation=u):(l||h)&&(l&&h?u=i.rotation+Math.PI:(u=l?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=u),i.toMatrix(n))):((l||h)&&(l&&(i.x=-i.x),h&&(i.y=-i.y),l&&h?u=i.rotation+Math.PI:(u=l?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=u),i.toMatrix(n))},D.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},D.prototype.update=function(t){if(this._blendState.dirty=!1,0<=t&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(0<=e&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(0<=e)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,n=this._armature._constraints;i<n.length;i++)(a=n[i])._root===this&&a.update();!(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,s=this._armature._constraints;r<s.length;r++){var a;(a=s[r])._root===this&&a.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}this._transformDirty?(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0?(e=0<=t,this._localDirty&&this._updateGlobalTransformMatrix(e),e&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))):this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex)):this._childrenTransformDirty&&(this._childrenTransformDirty=!1),this._localDirty=!0},D.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},D.prototype.invalidUpdate=function(){this._transformDirty=!0},D.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(D.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var n=i[e];n.parent===this&&n._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),D.prototype.getBones=function(){console.warn("Deprecated.");for(var t=new Array,e=0,i=this._armature.getBones();e<i.length;e++){var n=i[e];n.parent===this&&t.push(n)}return t},D.prototype.getSlots=function(){console.warn("Deprecated.");for(var t=new Array,e=0,i=this._armature.getSlots();e<i.length;e++){var n=i[e];n.parent===this&&t.push(n)}return t},Object.defineProperty(D.prototype,"slot",{get:function(){console.warn("Deprecated.");for(var t=0,e=this._armature.getSlots();t<e.length;t++){var i=e[t];if(i.parent===this)return i}return null},enumerable:!0,configurable:!0}),_.Bone=D,n=i=i||{},X=n.Bone,t(M,X),M.toString=function(){return"[class dragonBones.Surface]"},M.prototype._onClear=function(){X.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0},M.prototype._getAffineTransform=function(t,e,i,n,r,s,a,o,l,h,c,u,_){a-=r,o-=s,l-=r,h-=s;c.rotation=Math.atan2(o,a),c.skew=Math.atan2(h,l)-.5*Math.PI-c.rotation,_&&(c.rotation+=Math.PI),c.scaleX=Math.sqrt(a*a+o*o)/i,c.scaleY=Math.sqrt(l*l+h*h)/n,c.toMatrix(u),c.x=u.tx=r-(u.a*t+u.c*e),c.y=u.ty=s-(u.b*t+u.d*e)},M.prototype._updateVertices=function(){var t=this._boneData.vertices,e=this._vertices,i=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var n=0,r=t.length;n<r;n+=2){var s=t[n]+i[n],a=t[n+1]+i[n],o=this._parent._getGlobalTransformMatrix(s,a);e[n]=o.a*s+o.c*a+o.tx,e[n+1]=o.b*s+o.d*a+o.ty}else for(var l=this._parent.globalTransformMatrix,n=0,r=t.length;n<r;n+=2)s=t[n]+i[n],a=t[n+1]+i[n+1],e[n]=l.a*s+l.c*a+l.tx,e[n+1]=l.b*s+l.d*a+l.ty;else for(n=0,r=t.length;n<r;n+=2)e[n]=t[n]+i[n],e[n+1]=t[n+1]+i[n+1]},M.prototype._updateGlobalTransformMatrix=function(t){var e=2*this._boneData.segmentX,i=this._vertices.length-2,n=this._vertices[0],r=this._vertices[1],s=this._vertices[e],a=this._vertices[1+e],o=this._vertices[i],l=this._vertices[1+i],h=this._vertices[i-e],i=this._vertices[i-e+1],e=n+.5*(o-n),n=r+.5*(l-r),r=e+.5*(s+.5*(h-s)-e),e=n+.5*(a+.5*(i-a)-n),n=s+.5*(o-s),s=a+.5*(l-a),a=h+.5*(o-h),o=i+.5*(l-i);this._globalDirty=!1,this._getAffineTransform(0,0,200,200,r,e,n,s,a,o,this.global,this.globalTransformMatrix,!1)},M.prototype._getGlobalTransformMatrix=function(t,e){if(t<-1e3||1e3<t||e<-1e3||1e3<e)return this.globalTransformMatrix;var i=!1,n=this._boneData,r=n.segmentX,s=n.segmentY,n=2*n.segmentX,a=this._dX,o=this._dY,l=Math.floor((t+200)/a),h=Math.floor((e+200)/o),c=0,u=l*a-200,_=h*o-200,d=this._matrixCahce,f=M._helpMatrix;if(t<-200){if(e<-200||200<=e)return this.globalTransformMatrix;var p,m,y,g,v,b,c=7*(2*(r*(s+1)+2*r+s+h)+((i=e>this._kX*(t+200)+_)?1:0));0<this._matrixCahce[c]?f.copyFromArray(d,c+1):(p=h*(2+n),m=this._hullCache[4],y=this._hullCache[5],g=this._hullCache[2]-(s-h)*m,v=this._hullCache[3]-(s-h)*y,b=this._vertices,i?this._getAffineTransform(-200,_+o,800,o,b[p+n+2],b[p+n+3],g+m,v+y,b[p],b[p+1],M._helpTransform,f,!0):this._getAffineTransform(-1e3,_,800,o,g,v,b[p],b[p+1],g+m,v+y,M._helpTransform,f,!1),d[c]=1,d[c+1]=f.a,d[c+2]=f.b,d[c+3]=f.c,d[c+4]=f.d,d[c+5]=f.tx,d[c+6]=f.ty)}else if(200<=t){if(e<-200||200<=e)return this.globalTransformMatrix;c=7*(2*(r*(s+1)+r+h)+((i=e>this._kX*(t-1e3)+_)?1:0)),0<this._matrixCahce[c]?f.copyFromArray(d,c+1):(p=(h+1)*(2+n)-2,m=this._hullCache[4],y=this._hullCache[5],g=this._hullCache[0]+h*m,v=this._hullCache[1]+h*y,b=this._vertices,i?this._getAffineTransform(1e3,_+o,800,o,g+m,v+y,b[p+n+2],b[p+n+3],g,v,M._helpTransform,f,!0):this._getAffineTransform(200,_,800,o,b[p],b[p+1],g,v,b[p+n+2],b[p+n+3],M._helpTransform,f,!1),d[c]=1,d[c+1]=f.a,d[c+2]=f.b,d[c+3]=f.c,d[c+4]=f.d,d[c+5]=f.tx,d[c+6]=f.ty)}else if(e<-200){if(t<-200||200<=t)return this.globalTransformMatrix;c=7*(r*(s+1)+2*l+((i=e>this._kY*(t-u-a)-1e3)?1:0)),0<this._matrixCahce[c]?f.copyFromArray(d,c+1):(p=2*l,m=this._hullCache[10],y=this._hullCache[11],g=this._hullCache[8]+l*m,v=this._hullCache[9]+l*y,b=this._vertices,i?this._getAffineTransform(u+a,-200,a,800,b[p+2],b[p+3],b[p],b[p+1],g+m,v+y,M._helpTransform,f,!0):this._getAffineTransform(u,-1e3,a,800,g,v,g+m,v+y,b[p],b[p+1],M._helpTransform,f,!1),d[c]=1,d[c+1]=f.a,d[c+2]=f.b,d[c+3]=f.c,d[c+4]=f.d,d[c+5]=f.tx,d[c+6]=f.ty)}else if(200<=e){if(t<-200||200<=t)return this.globalTransformMatrix;c=7*(2*(r*(s+1)+r+s+h)+((i=e>this._kY*(t-u-a)+200)?1:0)),0<this._matrixCahce[c]?f.copyFromArray(d,c+1):(p=s*(2+n)+2*l,m=this._hullCache[10],y=this._hullCache[11],g=this._hullCache[6]-(r-l)*m,v=this._hullCache[7]-(r-l)*y,b=this._vertices,i?this._getAffineTransform(u+a,1e3,a,800,g+m,v+y,g,v,b[p+2],b[p+3],M._helpTransform,f,!0):this._getAffineTransform(u,200,a,800,b[p],b[p+1],b[p+2],b[p+3],g,v,M._helpTransform,f,!1),d[c]=1,d[c+1]=f.a,d[c+2]=f.b,d[c+3]=f.c,d[c+4]=f.d,d[c+5]=f.tx,d[c+6]=f.ty)}else c=7*(2*(r*h+l)+((i=e>this._k*(t-u-a)+_)?1:0)),0<this._matrixCahce[c]?f.copyFromArray(d,c+1):(p=2*l+h*(2+n),b=this._vertices,i?this._getAffineTransform(u+a,_+o,a,o,b[p+n+4],b[p+n+5],b[p+n+2],b[p+n+3],b[p+2],b[p+3],M._helpTransform,f,!0):this._getAffineTransform(u,_,a,o,b[p],b[p+1],b[p+2],b[p+3],b[p+n+2],b[p+n+3],M._helpTransform,f,!1),d[c]=1,d[c+1]=f.a,d[c+2]=f.b,d[c+3]=f.c,d[c+4]=f.d,d[c+5]=f.tx,d[c+6]=f.ty);return f},M.prototype.init=function(t,e){if(null===this._boneData){X.prototype.init.call(this,t,e);var e=t.segmentX,i=t.segmentY,n=t.vertices.length;this._dX=400/e,this._dY=400/i,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=n,this._deformVertices.length=n,this._matrixCahce.length=2*(e*i+2*e+2*i)*7,this._hullCache.length=10;for(var r=0;r<n;++r)this._deformVertices[r]=0}},M.prototype.update=function(t){if(this._blendState.dirty=!1,0<=t&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(0<=e&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(0<=e)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,n=this._armature._constraints;i<n.length;i++)(a=n[i])._root===this&&a.update();!(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,s=this._armature._constraints;r<s.length;r++){var a;(a=s[r])._root===this&&a.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var o=0,l=this._matrixCahce.length;o<l;o+=7)this._matrixCahce[o]=-1;this._updateVertices(),this._cachedFrameIndex<0?(e=0<=t,this._localDirty&&this._updateGlobalTransformMatrix(e),e&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))):this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var e=2*this.global.x,t=2*this.global.y,h=M._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,h),this._hullCache[0]=h.x,this._hullCache[1]=h.y,this._hullCache[2]=e-h.x,this._hullCache[3]=t-h.y,this.globalTransformMatrix.transformPoint(0,this._dY,h,!0),this._hullCache[4]=h.x,this._hullCache[5]=h.y,this.globalTransformMatrix.transformPoint(200,1e3,h),this._hullCache[6]=h.x,this._hullCache[7]=h.y,this._hullCache[8]=e-h.x,this._hullCache[9]=t-h.y,this.globalTransformMatrix.transformPoint(this._dX,0,h,!0),this._hullCache[10]=h.x,this._hullCache[11]=h.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},n.Surface=M,h=i=i||{},H=h.TransformObject,t(E,H),E.prototype._onClear=function(){H.prototype._onClear.call(this);for(var t=[],e=0,i=this._displayList;e<i.length;e++)null!==(n=i[e])&&n!==this._rawDisplay&&n!==this._meshDisplay&&t.indexOf(n)<0&&t.push(n);for(var n,r=0,s=t;r<s.length;r++)(n=s[r])instanceof h.Armature?n.dispose():this._disposeDisplay(n,!0);null!==this._deformVertices&&this._deformVertices.returnToPool(),null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayList.length=0,this._displayDatas.length=0,this._slotData=null,this._rawDisplayDatas=null,this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._deformVertices=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},E.prototype._getDefaultRawDisplayData=function(t){var e=this._armature._armatureData.defaultSkin;if(null!==e){e=e.getDisplays(this._slotData.name);if(null!==e)return t<e.length?e[t]:null}return null},E.prototype._updateDisplayData=function(){var t,e,i,n,r=this._displayData,s=null!==this._deformVertices?this._deformVertices.verticesData:null,a=this._textureData,o=null,l=null;this._displayData=null,this._boundingBoxData=null,this._textureData=null,0<=this._displayIndex&&(null===(o=null!==this._rawDisplayDatas?this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null:o)&&(o=this._getDefaultRawDisplayData(this._displayIndex)),this._displayIndex<this._displayDatas.length&&(this._displayData=this._displayDatas[this._displayIndex])),null!==this._displayData&&(2===this._displayData.type||4===this._displayData.type?l=this._displayData.vertices:null===o||2!==o.type&&4!==o.type||(l=o.vertices),3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==o&&3===o.type&&(this._boundingBoxData=o.boundingBox),0!==this._displayData.type&&2!==this._displayData.type||(this._textureData=this._displayData.texture)),this._displayData===r&&l===s&&this._textureData===a||(null===l&&null!==this._textureData?(r=this._displayData,t=this._textureData.parent.scale*this._armature._armatureData.scale,e=this._textureData.frame,this._pivotX=r.pivot.x,this._pivotY=r.pivot.y,i=(r=null!==e?e:this._textureData.region).width,n=r.height,this._textureData.rotated&&null===e&&(i=r.height,n=r.width),this._pivotX*=i*t,this._pivotY*=n*t,null!==e&&(this._pivotX+=e.x*t,this._pivotY+=e.y*t),null!==this._displayData&&null!==o&&this._displayData!==o&&(o.transform.toMatrix(E._helpMatrix),E._helpMatrix.invert(),E._helpMatrix.transformPoint(0,0,E._helpPoint),this._pivotX-=E._helpPoint.x,this._pivotY-=E._helpPoint.y,this._displayData.transform.toMatrix(E._helpMatrix),E._helpMatrix.invert(),E._helpMatrix.transformPoint(0,0,E._helpPoint),this._pivotX+=E._helpPoint.x,this._pivotY+=E._helpPoint.y),h.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*t-this._pivotY)):(this._pivotX=0,this._pivotY=0),null!==o?this.origin=o.transform:null!==this._displayData?this.origin=this._displayData.transform:this.origin=null,l!==s?(null===this._deformVertices&&(this._deformVertices=h.BaseObject.borrowObject(h.DeformVertices)),this._deformVertices.init(l,this._armature)):null!==this._deformVertices&&this._textureData!==a&&(this._deformVertices.verticesDirty=!0),this._displayDirty=!0,this._transformDirty=!0)},E.prototype._updateDisplay=function(){var t=null!==this._display?this._display:this._rawDisplay,e=this._childArmature,i=(0<=this._displayIndex&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof h.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null),null!==this._display?this._display:this._rawDisplay);if(i!==t&&(this._onUpdateDisplay(),this._replaceDisplay(t),this._transformDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),i!==this._rawDisplay&&i!==this._meshDisplay||this._updateFrame(),this._childArmature!==e&&(null!==e&&(e._parent=null,e.clock=null,e.inheritAnimation&&e.animation.reset()),null!==this._childArmature&&((this._childArmature._parent=this)._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){0!==this._childArmature.cacheFrameRate||0!==(t=this._armature.cacheFrameRate)&&(this._childArmature.cacheFrameRate=t);i=null;if(null!==this._displayData&&1===this._displayData.type?i=this._displayData.actions:0<=this._displayIndex&&null!==this._rawDisplayDatas&&(null!==(e=null===(e=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null)?this._getDefaultRawDisplayData(this._displayIndex):e)&&1===e.type&&(i=e.actions)),null!==i&&0<i.length)for(var n=0,r=i;n<r.length;n++){var s=r[n],a=h.BaseObject.borrowObject(h.EventObject);h.EventObject.actionDataToInstance(s,a,this._armature),(a.slot=this)._armature._bufferAction(a,!1)}else this._childArmature.animation.play()}},E.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},E.prototype._setDisplayIndex=function(t,e){if(e=void 0===e?!1:e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex!==t&&(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},E.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},E.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},E.prototype._setDisplayList=function(t){if(null!==t&&0<t.length){this._displayList.length!==t.length&&(this._displayList.length=t.length);for(var e=0,i=t.length;e<i;++e){var n=t[e];null!==n&&n!==this._rawDisplay&&n!==this._meshDisplay&&!(n instanceof h.Armature)&&this._displayList.indexOf(n)<0&&this._initDisplay(n,!0),this._displayList[e]=n}}else 0<this._displayList.length&&(this._displayList.length=0);return 0<=this._displayIndex&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},E.prototype.init=function(t,e,i,n){null===this._slotData&&(this._slotData=t,this._isFromCache=!1,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=n,this._armature=e,null!==(t=this._armature.getBone(this._slotData.parent.name))&&(this._parent=t),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay())},E.prototype.update=function(t){if(this._isFromCache=!1,this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset):this.global.copyFrom(this.offset)).toMatrix(this._localMatrix)),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),0<=t&&null!==this._cachedFrameIndices?0<=(e=this._cachedFrameIndices[t])&&this._cachedFrameIndex===e?this._transformDirty=!1:0<=e?(this._transformDirty=!0,this._cachedFrameIndex=e):!this._transformDirty&&!this._parent._childrenTransformDirty&&0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1):(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1),null!==this._display){if(this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._deformVertices&&null!==this._deformVertices.verticesData&&this._display===this._meshDisplay){var e=null!==this._deformVertices.verticesData.weight,i=0!==this._parent._boneData.type;if((this._deformVertices.verticesDirty||e&&this._deformVertices.isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._deformVertices.verticesDirty=!1,this._updateMesh()),e||i)return}this._transformDirty&&(this._transformDirty=!1,this._cachedFrameIndex<0?(this._updateGlobalTransformMatrix(e=0<=t),e&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))):(this._isFromCache=!0,this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex)),this._updateTransform())}},E.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},E.prototype.replaceDisplayData=function(t,e){if((e=void 0===e?-1:e)<0&&(e=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=e){this._displayDatas.length=e+1;for(var i=0,n=this._displayDatas.length;i<n;++i)this._displayDatas[i]||(this._displayDatas[i]=null)}this._displayDatas[e]=t},E.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),E._helpMatrix.copyFrom(this.globalTransformMatrix),E._helpMatrix.invert(),E._helpMatrix.transformPoint(t,e,E._helpPoint),this._boundingBoxData.containsPoint(E._helpPoint.x,E._helpPoint.y))},E.prototype.intersectsSegment=function(t,e,i,n,r,s,a){if(void 0===r&&(r=null),void 0===s&&(s=null),void 0===a&&(a=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),E._helpMatrix.copyFrom(this.globalTransformMatrix),E._helpMatrix.invert(),E._helpMatrix.transformPoint(t,e,E._helpPoint),t=E._helpPoint.x,e=E._helpPoint.y,E._helpMatrix.transformPoint(i,n,E._helpPoint),i=E._helpPoint.x,n=E._helpPoint.y;t=this._boundingBoxData.intersectsSegment(t,e,i,n,r,s,a);return 0<t&&(1===t||2===t?null!==r?(this.globalTransformMatrix.transformPoint(r.x,r.y,r),null!==s&&(s.x=r.x,s.y=r.y)):null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s):(null!==r&&this.globalTransformMatrix.transformPoint(r.x,r.y,r),null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s)),null!==a&&(this.globalTransformMatrix.transformPoint(Math.cos(a.x),Math.sin(a.x),E._helpPoint,!0),a.x=Math.atan2(E._helpPoint.y,E._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(a.y),Math.sin(a.y),E._helpPoint,!0),a.y=Math.atan2(E._helpPoint.y,E._helpPoint.x))),t},E.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(E.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(t){var e=this._displayList.concat(),i=new Array;this._setDisplayList(t)&&this.update(-1);for(var n=0,r=e;n<r.length;n++)null!==(s=r[n])&&s!==this._rawDisplay&&s!==this._meshDisplay&&this._displayList.indexOf(s)<0&&i.indexOf(s)<0&&i.push(s);for(var s,a=0,o=i;a<o.length;a++)(s=o[a])instanceof h.Armature||this._disposeDisplay(s,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(t){if(this._rawDisplayDatas!==t)if(this._displayDirty=!0,this._rawDisplayDatas=t,null!==this._rawDisplayDatas){this._displayDatas.length=this._rawDisplayDatas.length;for(var e=0,i=this._displayDatas.length;e<i;++e){var n=this._rawDisplayDatas[e];null===n&&(n=this._getDefaultRawDisplayData(e)),this._displayDatas[e]=n}}else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"displayData",{get:function(){return this._displayData},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"display",{get:function(){return this._display},set:function(t){var e,i;this._display!==t&&(e=this._displayList.length,this._displayIndex<0&&0===e&&(this._displayIndex=0),this._displayIndex<0||(i=this.displayList,e<=this._displayIndex&&(i.length=this._displayIndex+1),i[this._displayIndex]=t,this.displayList=i))},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),E.prototype.getDisplay=function(){return this._display},E.prototype.setDisplay=function(t){this.display=t},h.Slot=E;var k=i=i||{};qt=k.BaseObject,t(Zt,qt),Zt.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(Zt.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),Zt._helpMatrix=new k.Matrix,Zt._helpTransform=new k.Transform,Zt._helpPoint=new k.Point;var qt,Jt,o=Zt;function Zt(){return null!==qt&&qt.apply(this,arguments)||this}function f(){return null!==Jt&&Jt.apply(this,arguments)||this}k.Constraint=o,t(f,Jt=o),f.toString=function(){return"[class dragonBones.IKConstraint]"},f.prototype._onClear=function(){Jt.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},f.prototype._computeA=function(){var t=this._target.global,e=this._root.global,i=this._root.globalTransformMatrix,t=Math.atan2(t.y-e.y,t.x-e.x);e.scaleX<0&&(t+=Math.PI),e.rotation+=k.Transform.normalizeRadian(t-e.rotation)*this._weight,e.toMatrix(i)},f.prototype._computeB=function(){var t=this._bone._boneData.length,e=this._root,i=this._target.global,n=e.global,r=this._bone.global,s=this._bone.globalTransformMatrix,a=s.a*t,t=s.b*t,a=a*a+t*t,t=Math.sqrt(a),o=r.x-n.x,l=r.y-n.y,h=o*o+l*l,c=Math.sqrt(h),u=r.rotation,_=n.rotation,d=Math.atan2(l,o),f=(o=i.x-n.x)*o+(l=i.y-n.y)*l,p=Math.sqrt(f),m=0,o=(t+c<=p||p+t<=c||p+c<=t?(m=Math.atan2(i.y-n.y,i.x-n.x),t+c<=p||c<t&&(m+=Math.PI)):(t=(h-a+f)/(2*f),a=Math.sqrt(h-t*t*f)/p,h=n.x+o*t,f=n.y+l*t,p=-l*a,t=o*a,l=!1,(l=null!==(o=e.parent)?(a=o.globalTransformMatrix).a*a.d-a.b*a.c<0:l)!==this._bendPositive?(r.x=h-p,r.y=f-t):(r.x=h+p,r.y=f+t),m=Math.atan2(r.y-n.y,r.x-n.x)),k.Transform.normalizeRadian(m-d)),a=(n.rotation=_+o*this._weight,n.toMatrix(e.globalTransformMatrix),d+o*this._weight),l=(r.x=n.x+Math.cos(a)*c,r.y=n.y+Math.sin(a)*c,Math.atan2(i.y-r.y,i.x-r.x));r.scaleX<0&&(l+=Math.PI),r.rotation=n.rotation+u-_+k.Transform.normalizeRadian(l-o-u)*this._weight,r.toMatrix(s)},f.prototype.init=function(t,e){null===this._constraintData&&(this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null,t=this._constraintData,this._scaleEnabled=t.scaleEnabled,this._bendPositive=t.bendPositive,this._weight=t.weight,this._root._hasConstraint=!0)},f.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},f.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},k.IKConstraint=f,t(p,Kt=o),p.toString=function(){return"[class dragonBones.PathConstraint]"},p.prototype._onClear=function(){Kt.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},p.prototype._updatePathVertices=function(t){var e=this._armature,i=e.armatureData.parent,n=e.armatureData.scale,r=i.intArray,s=i.floatArray,e=t.offset,a=r[e+0],i=r[e+2],e=(this._pathGlobalVertices.length=2*a,t.weight);if(null!==e)for(var o=this._pathSlot._deformVertices.bones,t=e.bones.length,e=e.offset,l=r[e+1],h=e+2+t,c=y=0;y<a;y++){for(var u=0,_=0,d=0,f=r[h++];d<f;d++){var p=o[r[h++]];null!==p&&(p.updateByConstraint(),m=p.globalTransformMatrix,p=s[l++],v=s[l++]*n,b=s[l++]*n,u+=(m.a*v+m.c*b+m.tx)*p,_+=(m.b*v+m.d*b+m.ty)*p)}this._pathGlobalVertices[c++]=u,this._pathGlobalVertices[c++]=_}else{e=this._pathSlot.parent;e.updateByConstraint();for(var m=e.globalTransformMatrix,y=0,g=i;y<a;y+=2){var v=s[g++]*n,b=s[g++]*n,x=m.a*v+m.c*b+m.tx,A=m.b*v+m.d*b+m.ty;this._pathGlobalVertices[y]=x,this._pathGlobalVertices[y+1]=A}}},p.prototype._computeVertices=function(t,e,i,n){for(var r=i,s=t;r<e;r+=2)n[r]=this._pathGlobalVertices[s++],n[r+1]=this._pathGlobalVertices[s++]},p.prototype._computeBezierCurve=function(t,e,F,V,N){var k=this._armature.armatureData.parent.intArray[t.vertices.offset+0],i=this._positions,n=this._spaces,r=t.closed,s=Array(),a=2*k,o=a/6,z=-1,l=this.position,h=(i.length=3*e+2,0);if(t.constantSpeed){r?(a+=2,s.length=k,this._computeVertices(2,a-4,0,s),this._computeVertices(0,2,a-4,s),s[a-2]=s[0],s[a-1]=s[1]):(o--,s.length=a-=4,this._computeVertices(2,a,0,s));for(var c,u,_,d,G=new Array(o),h=0,f=s[0],p=s[1],m=0,y=0,g=0,v=0,b=0,x=0,A=(R=0,2);R<o;R++,A+=6)m=s[A],y=s[A+1],g=s[A+2],v=s[A+3],M=2*(c=.1875*(f-2*m+g))+(_=.09375*(3*(m-g)-f+(b=s[A+4]))),D=2*(u=.1875*(p-2*y+v))+(d=.09375*(3*(y-v)-p+(x=s[A+5]))),B=.75*(m-f)+c+.16666667*_,I=.75*(y-p)+u+.16666667*d,h+=Math.sqrt(B*B+I*I),B+=M,I+=D,M+=_,D+=d,h+=Math.sqrt(B*B+I*I),B+=M,I+=D,h+=Math.sqrt(B*B+I*I),B+=M+_,I+=D+d,h+=Math.sqrt(B*B+I*I),G[R]=h,f=b,p=x;if(V&&(l*=h),N)for(R=0;R<e;R++)n[R]*=h;for(var C=this._segments,T=0,S=L=O=R=0;R<e;R++,O+=3){var w=l+=n[R];if(r)(w%=h)<0&&(w+=h),L=0;else{if(w<0)continue;if(h<w)continue}for(;;L++){var U=G[L];if(!(U<w)){0===L?w/=U:w=(w-(P=G[L-1]))/(U-P);break}}if(L!==z){var z=L,E=6*L,f=s[E],p=s[E+1],m=s[E+2],y=s[E+3],g=s[E+4],v=s[E+5],M=2*(c=.03*(f-2*m+g))+(_=.006*(3*(m-g)-f+(b=s[E+6]))),D=2*(u=.03*(p-2*y+v))+(d=.006*(3*(y-v)-p+(x=s[E+7]))),B=.3*(m-f)+c+.16666667*_,I=.3*(y-p)+u+.16666667*d,T=Math.sqrt(B*B+I*I);for(C[0]=T,E=1;E<8;E++)B+=M,I+=D,M+=_,D+=d,T+=Math.sqrt(B*B+I*I),C[E]=T;B+=M,I+=D,T+=Math.sqrt(B*B+I*I),C[8]=T,B+=M+_,I+=D+d,T+=Math.sqrt(B*B+I*I),C[9]=T,S=0}for(w*=T;;S++){var P,j=C[S];if(!(j<w)){0===S?w/=j:w=S+(w-(P=C[S-1]))/(j-P);break}}this.addCurvePosition(.1*w,f,p,m,y,g,v,b,x,i,O,F)}}else{var W=t.curveLengths;if(h=W[o-=r?1:2],V&&(l*=h),N)for(var R=0;R<e;R++)n[R]*=h;s.length=8;for(var R=0,O=0,L=0;R<e;R++,O+=3){if(l+=n[R],r)(l%=h)<0&&(l+=h),L=0;else{if(l<0)continue;if(h<l)continue}for(var H=0;;L++){var X,Y=W[L];if(!(Y<l)){H=0===L?l/Y:(l-(X=W[L-1]))/(Y-X);break}}L!==z&&(z=L,r&&L===o?(this._computeVertices(a-4,4,0,s),this._computeVertices(0,4,4,s)):this._computeVertices(6*L+2,8,0,s)),this.addCurvePosition(H,s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],i,O,F)}}},p.prototype.addCurvePosition=function(t,e,i,n,r,s,a,o,l,h,c,u){if(0===t)return h[c]=e,h[c+1]=i,void(h[c+2]=0);if(1===t)return h[c]=o,h[c+1]=l,void(h[c+2]=0);var _=1-t,d=_*_,f=t*t,p=d*_,d=d*t*3,_=_*f*3,t=t*f,f=p*e+d*n+_*s+t*o,o=p*i+d*r+_*a+t*l;h[c]=f,h[c+1]=o,h[c+2]=u?Math.atan2(o-(p*i+d*r+_*a),f-(p*e+d*n+_*s)):0},p.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.vertices.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var n=0,r=i.bones.length;n<r;n++){var s=this._armature.getBone(i.bones[n].name);null!==s&&this._bones.push(s)}2===i.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},p.prototype.update=function(){var t=this._pathSlot;if(null!==t._deformVertices&&null!==t._deformVertices.verticesData&&t._deformVertices.verticesData.offset===this.pathOffset){var e=this._constraintData,i=t._displayData,n=!1,r=t._deformVertices;if(this._root._childrenTransformDirty?(this._updatePathVertices(i.vertices),n=!0):null!==r&&(r.verticesDirty||r.isBonesUpdate())&&(this._updatePathVertices(i.vertices),n=!(r.verticesDirty=!1)),n||this.dirty){var r=e.positionMode,n=e.spacingMode,e=e.rotateMode,s=this._bones,F=0===n,a=2===e,o=0===e,l=s.length,h=o?l:l+1,c=this.spacing,u=this._spaces;if(u.length=h,a||F)for(var _=u[0]=0,V=h-1;_<V;_++){(S=s[_]).updateByConstraint();var d=S._boneData.length,f=d*(w=S.globalTransformMatrix).a,p=d*w.b,m=Math.sqrt(f*f+p*p);a&&(this._boneLengths[_]=m),u[_+1]=(d+c)*m/d}else for(_=0;_<h;_++)u[_]=c;this._computeBezierCurve(i,h,o,1===r,2===n);var y,g=this._positions,v=this.rotateOffset,b=g[0],x=g[1];0===v?y=1===e:(y=!1,null!==(S=t.parent)&&(v*=0<(w=S.globalTransformMatrix).a*w.d-w.b*w.c?k.Transform.DEG_RAD:-k.Transform.DEG_RAD));for(var A=this.rotateMix,C=this.translateMix,T=(_=0,3);_<l;_++,T+=3){(S=s[_]).updateByConstraint(),(w=S.globalTransformMatrix).tx+=(b-w.tx)*C,w.ty+=(x-w.ty)*C;var S,w,E=(f=g[T])-b,M=(p=g[T+1])-x;a&&(D=this._boneLengths[_],D=(Math.sqrt(E*E+M*M)/D-1)*A+1,w.a*=D,w.b*=D);var D,B,I,P,R,O,N,L,b=f,x=p;0<A&&(D=w.a,B=w.b,I=w.c,P=w.d,O=R=L=void 0,L=o?g[T-1]:Math.atan2(M,E),L-=Math.atan2(B,D),y?(R=Math.cos(L),O=Math.sin(L),b+=((N=S._boneData.length)*(R*D-O*B)-E)*A,x+=(N*(O*D+R*B)-M)*A):L+=v,L>k.Transform.PI?L-=k.Transform.PI_D:L<-k.Transform.PI&&(L+=k.Transform.PI_D),L*=A,R=Math.cos(L),O=Math.sin(L),w.a=R*D-O*B,w.b=O*D+R*B,w.c=R*I-O*P,w.d=O*I+R*P),S.global.fromMatrix(w)}this.dirty=!1}}},p.prototype.invalidUpdate=function(){};var Kt;function p(){var t=null!==Kt&&Kt.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}k.PathConstraint=p,function(t){function e(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}e.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var i=0,n=0,r=this._animatebles.length;i<r;++i){var s=this._animatebles[i];null!==s?(0<n&&(this._animatebles[i-n]=s,this._animatebles[i]=null),s.advanceTime(t)):n++}if(0<n){for(r=this._animatebles.length;i<r;++i){var a=this._animatebles[i];null!==a?this._animatebles[i-n]=a:n++}this._animatebles.length-=n}}},e.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},e.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},e.prototype.remove=function(t){var e=this._animatebles.indexOf(t);0<=e&&(this._animatebles[e]=null,t.clock=null)},e.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),e.clock=new e,t.WorldClock=e}(i=i||{}),j=i=i||{},W=j.BaseObject,t(w,W),w.toString=function(){return"[class dragonBones.Animation]"},w.prototype._onClear=function(){for(var t,e=0,i=this._animationStates;e<i.length;e++)i[e].returnToPool();for(t in this._animations)delete this._animations[t];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._lockUpdate=!1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},w.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++)null===(o=i[e])._parent&&o.layer===t.layer&&o.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(var n=0,r=this._animationStates;n<r.length;n++)null===(o=r[n])._parent&&o.group===t.group&&o.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(var s=0,a=this._animationStates;s<a.length;s++)null===(o=a[s])._parent&&o.layer===t.layer&&o.group===t.group&&o.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(var o,l=0,h=this._animationStates;l<h.length;l++)null===(o=h[l])._parent&&o.fadeOut(t.fadeOutTime,t.pauseFadeOut)}},w.prototype.init=function(t){null===this._armature&&(this._armature=t,this._animationConfig=j.BaseObject.borrowObject(j.AnimationConfig))},w.prototype.advanceTime=function(t){t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale);var e=this._animationStates.length;if(1===e)if(0<(u=this._animationStates[0])._fadeState&&0<u._subFadeState)this._armature._dragonBones.bufferObject(u),this._animationStates.length=0,this._lastAnimationState=null;else{var i=u._animationData,n=i.cacheFrameRate;if(this._animationDirty&&0<n){this._animationDirty=!1;for(var r=0,s=this._armature.getBones();r<s.length;r++){var a=s[r];a._cachedFrameIndices=i.getBoneCachedFrameIndices(a.name)}for(var o=0,l=this._armature.getSlots();o<l.length;o++){var h=l[o],c=h.rawDisplayDatas;if(null!==c&&0<c.length){c=c[0];if(null!==c&&c.parent===this._armature.armatureData.defaultSkin){h._cachedFrameIndices=i.getSlotCachedFrameIndices(h.name);continue}}h._cachedFrameIndices=null}}u.advanceTime(t,n)}else if(1<e){for(var u,_=0,d=0;_<e;++_)0<(u=this._animationStates[_])._fadeState&&0<u._subFadeState?(d++,this._armature._dragonBones.bufferObject(u),this._animationDirty=!0,this._lastAnimationState===u&&(this._lastAnimationState=null)):(0<d&&(this._animationStates[_-d]=u),u.advanceTime(t,0)),_===e-1&&0<d&&(this._animationStates.length-=d,null===this._lastAnimationState&&0<this._animationStates.length&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]));this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},w.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},w.prototype.stop=function(t){if(null!==(t=void 0===t?null:t))null!==(n=this.getState(t))&&n.stop();else for(var e=0,i=this._animationStates;e<i.length;e++){var n;(n=i[e]).stop()}},w.prototype.playConfig=function(t){var e=t.animation;if(!(e in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+e),null;var i=this._animations[e];if(5===t.fadeOutMode)for(var n=0,r=this._animationStates;n<r.length;n++){var s=r[n];if(s._animationData===i)return s}0===this._animationStates.length?t.fadeInTime=0:t.fadeInTime<0&&(t.fadeInTime=i.fadeInTime),t.fadeOutTime<0&&(t.fadeOutTime=t.fadeInTime),t.timeScale<=-100&&(t.timeScale=1/i.scale),1<i.frameCount?(t.position<0?(t.position%=i.duration,t.position=i.duration-t.position):t.position===i.duration?t.position-=1e-6:t.position>i.duration&&(t.position%=i.duration),0<t.duration&&t.position+t.duration>i.duration&&(t.duration=i.duration-t.position),t.playTimes<0&&(t.playTimes=i.playTimes)):(t.playTimes=1,(t.position=0)<t.duration&&(t.duration=0)),0===t.duration&&(t.duration=-1),this._fadeOut(t);var a=j.BaseObject.borrowObject(j.AnimationState);if(a.init(this._armature,i,t),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,0<this._animationStates.length){for(var o=!1,l=0,h=this._animationStates.length;l<h;++l){if(a.layer>this._animationStates[l].layer){o=!0,this._animationStates.splice(l,0,a);break}if(l!==h-1&&a.layer>this._animationStates[l+1].layer){o=!0,this._animationStates.splice(l+1,0,a);break}}o||this._animationStates.push(a)}else this._animationStates.push(a);for(var c=0,u=this._armature.getSlots();c<u.length;c++){var _=u[c].childArmature;null!==_&&_.inheritAnimation&&_.animation.hasAnimation(e)&&null===_.animation.getState(e)&&_.animation.fadeIn(e)}var d,f=!1;for(d in i.animationTimelines){this._lockUpdate||(this._lockUpdate=f=!0);var p=this.fadeIn(d,t.fadeInTime,1,a.layer,null,0);null!==p&&(p.resetToPose=!1,p._parent=a,p.stop())}return f&&(this._lockUpdate=!1),this._lockUpdate||(t.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=a),a},w.prototype.play=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&0<t.length?this.playConfig(this._animationConfig):null===this._lastAnimationState?null!==(e=this._armature.armatureData.defaultAnimation)&&(this._animationConfig.animation=e.name,this.playConfig(this._animationConfig)):this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play(),this._lastAnimationState},w.prototype.fadeIn=function(t,e,i,n,r,s){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===n&&(n=0),void 0===r&&(r=null),void 0===s&&(s=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=s,this._animationConfig.playTimes=i,this._animationConfig.layer=n,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},w.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},w.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0;i=(this._animationConfig.animation=t)in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*e/i.frameCount),this.playConfig(this._animationConfig)},w.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0;i=(this._animationConfig.animation=t)in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*(0<e?e:0)),this.playConfig(this._animationConfig)},w.prototype.gotoAndStopByTime=function(t,e){t=this.gotoAndPlayByTime(t,e=void 0===e?0:e,1);return null!==t&&t.stop(),t},w.prototype.gotoAndStopByFrame=function(t,e){t=this.gotoAndPlayByFrame(t,e=void 0===e?0:e,1);return null!==t&&t.stop(),t},w.prototype.gotoAndStopByProgress=function(t,e){t=this.gotoAndPlayByProgress(t,e=void 0===e?0:e,1);return null!==t&&t.stop(),t},w.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var i=this._animationStates[e];if(i.name===t)return i}return null},w.prototype.hasAnimation=function(t){return t in this._animations},w.prototype.getStates=function(){return this._animationStates},Object.defineProperty(w.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(e[t].isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(!e[t].isCompleted)return!1;return 0<this._animationStates.length},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),w.prototype.gotoAndPlay=function(t,e,i,n,r,s,a,o,l){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===n&&(n=-1),void 0===r&&(r=0),void 0===s&&(s=null),void 0===a&&(a=3),void 0===o&&(o=!0),void 0===l&&(l=!0),console.warn("Deprecated."),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=a,this._animationConfig.playTimes=n,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==s?s:"";o=this._animations[t];return o&&0<i&&(this._animationConfig.timeScale=o.duration/i),this.playConfig(this._animationConfig)},w.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),console.warn("Deprecated."),this.gotoAndStopByTime(t,e)},Object.defineProperty(w.prototype,"animationList",{get:function(){return console.warn("Deprecated."),this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"animationDataList",{get:function(){console.warn("Deprecated.");for(var t=[],e=0,i=this._animationNames.length;e<i;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),j.Animation=w;var Qt,L=i=i||{};function m(){var t=null!==Qt&&Qt.apply(this,arguments)||this;return t._blendState=new ie,t._boneMask=[],t._boneTimelines=[],t._surfaceTimelines=[],t._slotTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t._parent=null,t}Qt=L.BaseObject,t(m,Qt),m.toString=function(){return"[class dragonBones.AnimationState]"},m.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++)e[t].returnToPool();for(var i=0,n=this._surfaceTimelines;i<n.length;i++)n[i].returnToPool();for(var r=0,s=this._slotTimelines;r<s.length;r++)s[r].returnToPool();for(var a=0,o=this._constraintTimelines;a<o.length;a++)o[a].returnToPool();for(var l,h=0,c=this._animationTimelines;h<c.length;h++)c[h].returnToPool();for(l in this._bonePoses)this._bonePoses[l].returnToPool(),delete this._bonePoses[l];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additiveBlending=!1,this.displayControl=!1,this.resetToPose=!1,this.playTimes=1,this.layer=0,this.timeScale=1,this.weight=1,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._blendState.clear(),this._boneMask.length=0,this._boneTimelines.length=0,this._surfaceTimelines.length=0,this._slotTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._parent=null},m.prototype._updateTimelines=function(){for(var t=0,e=this._armature._constraints;t<e.length;t++){var i=e[t];if(null!==(o=this._animationData.getConstraintTimelines(i.name)))for(var n=0,r=o;n<r.length;n++)30===(l=r[n]).type&&((h=L.BaseObject.borrowObject(L.IKConstraintTimelineState)).constraint=i,h.init(this._armature,this,l),this._constraintTimelines.push(h));else this.resetToPose&&((h=L.BaseObject.borrowObject(L.IKConstraintTimelineState)).constraint=i,h.init(this._armature,this,null),this._constraintTimelines.push(h),this._poseTimelines.push(h))}for(var s=0,a=this._armature.animation.getStates();s<a.length;s++){var o,l,h,c=a[s];if(c._parent===this&&null!==(o=this._animationData.getAnimationTimelines(c.name)))for(var u=0,_=o;u<_.length;u++)40===(l=_[u]).type&&((h=L.BaseObject.borrowObject(L.AnimationTimelineState)).animationState=c,h.init(this._armature,this,l),this._animationTimelines.push(h))}},m.prototype._updateBoneAndSlotTimelines=function(){for(var t={},e=0,i=this._boneTimelines;e<i.length;e++)(a=(p=i[e]).bone.name)in t||(t[a]=[]),t[a].push(p);for(var n=0,r=this._armature.getBones();n<r.length;n++){var s=r[n],a=s.name;if(this.containsBoneMask(a))if(a in t)delete t[a];else if(0===s._boneData.type){var o=this._animationData.getBoneTimelines(a),l=a in this._bonePoses?this._bonePoses[a]:this._bonePoses[a]=L.BaseObject.borrowObject(te);if(null!==o)for(var h=0,c=o;h<c.length;h++)switch((S=c[h]).type){case 10:(p=L.BaseObject.borrowObject(L.BoneAllTimelineState)).bone=s,p.bonePose=l,p.init(this._armature,this,S),this._boneTimelines.push(p);break;case 11:(p=L.BaseObject.borrowObject(L.BoneTranslateTimelineState)).bone=s,p.bonePose=l,p.init(this._armature,this,S),this._boneTimelines.push(p);break;case 12:(p=L.BaseObject.borrowObject(L.BoneRotateTimelineState)).bone=s,p.bonePose=l,p.init(this._armature,this,S),this._boneTimelines.push(p);break;case 13:(p=L.BaseObject.borrowObject(L.BoneScaleTimelineState)).bone=s,p.bonePose=l,p.init(this._armature,this,S),this._boneTimelines.push(p)}else this.resetToPose&&((p=L.BaseObject.borrowObject(L.BoneAllTimelineState)).bone=s,p.bonePose=l,p.init(this._armature,this,null),this._boneTimelines.push(p),this._poseTimelines.push(p))}else if(1===s._boneData.type)if(null!==(o=this._animationData.getSurfaceTimelines(a)))for(var u=0,_=o;u<_.length;u++)50===(S=_[u]).type&&((p=L.BaseObject.borrowObject(L.SurfaceTimelineState)).surface=s,p.init(this._armature,this,S),this._surfaceTimelines.push(p));else this.resetToPose&&((p=L.BaseObject.borrowObject(L.SurfaceTimelineState)).surface=s,p.init(this._armature,this,null),this._surfaceTimelines.push(p),this._poseTimelines.push(p))}for(b in t)for(var d=0,f=t[b];d<f.length;d++){var p=f[d];this._boneTimelines.splice(this._boneTimelines.indexOf(p),1),p.returnToPool()}for(var m={},y=[],g=0,v=this._slotTimelines;g<v.length;g++)(a=(p=v[g]).slot.name)in m||(m[a]=[]),m[a].push(p);for(var b,x=0,A=this._armature.getSlots();x<A.length;x++){var C=A[x],T=C.parent.name;if(this.containsBoneMask(T))if(a=C.name,o=this._animationData.getSlotTimelines(a),a in m)delete m[a];else{var S,w=!1,E=!1;if(y.length=0,null!==o)for(var M=0,D=o;M<D.length;M++)switch((S=D[M]).type){case 20:(p=L.BaseObject.borrowObject(L.SlotDislayTimelineState)).slot=C,p.init(this._armature,this,S),this._slotTimelines.push(p),w=!0;break;case 21:(p=L.BaseObject.borrowObject(L.SlotColorTimelineState)).slot=C,p.init(this._armature,this,S),this._slotTimelines.push(p),E=!0;break;case 22:(p=L.BaseObject.borrowObject(L.DeformTimelineState)).slot=C,p.init(this._armature,this,S),this._slotTimelines.push(p),y.push(p.vertexOffset)}if(this.resetToPose&&(w||((p=L.BaseObject.borrowObject(L.SlotDislayTimelineState)).slot=C,p.init(this._armature,this,null),this._slotTimelines.push(p),this._poseTimelines.push(p)),E||((p=L.BaseObject.borrowObject(L.SlotColorTimelineState)).slot=C,p.init(this._armature,this,null),this._slotTimelines.push(p),this._poseTimelines.push(p)),null!==C.rawDisplayDatas))for(var B=0,I=C.rawDisplayDatas;B<I.length;B++){var P=I[B];null!==P&&2===P.type&&(P=P.vertices.offset,y.indexOf(P)<0&&((p=L.BaseObject.borrowObject(L.DeformTimelineState)).vertexOffset=P,p.slot=C,p.init(this._armature,this,null),this._slotTimelines.push(p),this._poseTimelines.push(p)))}}}for(b in m)for(var R=0,O=m[b];R<O.length;R++)p=O[R],this._slotTimelines.splice(this._slotTimelines.indexOf(p),1),p.returnToPool()},m.prototype._advanceFadeTime=function(t){var e,i,n=0<this._fadeState;this._subFadeState<0&&(this._subFadeState=0,e=n?L.EventObject.FADE_OUT:L.EventObject.FADE_IN,this._armature.eventDispatcher.hasDBEventListener(e)&&((i=L.BaseObject.borrowObject(L.EventObject)).type=e,i.armature=this._armature,(i.animationState=this)._armature._dragonBones.bufferEvent(i))),this._fadeTime+=t=t<0?-t:t,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=n?0:1):0<this._fadeTime?this._fadeProgress=n?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=n?1:0,0<this._subFadeState&&(n||(this._playheadState|=1,this._fadeState=0),e=n?L.EventObject.FADE_OUT_COMPLETE:L.EventObject.FADE_IN_COMPLETE,this._armature.eventDispatcher.hasDBEventListener(e)&&((i=L.BaseObject.borrowObject(L.EventObject)).type=e,i.armature=this._armature,(i.animationState=this)._armature._dragonBones.bufferEvent(i)))},m.prototype.init=function(t,e,i){if(null===this._armature){if(this._armature=t,this._animationData=e,this.resetToPose=i.resetToPose,this.additiveBlending=i.additiveBlending,this.displayControl=i.displayControl,this.actionEnabled=i.actionEnabled,this.layer=i.layer,this.playTimes=i.playTimes,this.timeScale=i.timeScale,this.fadeTotalTime=i.fadeInTime,this.autoFadeOutTime=i.autoFadeOutTime,this.weight=i.weight,this.name=0<i.name.length?i.name:i.animation,this.group=i.group,i.pauseFadeIn?this._playheadState=2:this._playheadState=3,i.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==i.position?0<=this.timeScale?this._time=i.position:this._time=i.position-this._duration:this._time=0):(this._position=i.position,this._duration=i.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),0<i.boneMask.length){this._boneMask.length=i.boneMask.length;for(var n=0,r=this._boneMask.length;n<r;++n)this._boneMask[n]=i.boneMask[n]}this._actionTimeline=L.BaseObject.borrowObject(L.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=L.BaseObject.borrowObject(L.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},m.prototype.advanceTime=function(t,e){if(this._blendState.dirty=!1,0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines()),0!==this.weight){var i,t=0===this._fadeState&&0<e,n=!0,r=!0,s=this._time;if(this._weightResult=this.weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult/this._parent._fadeProgress),this._actionTimeline.playState<=0&&this._actionTimeline.update(s),t&&(i=2*e,this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*i)/i),null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(s),t&&(i=Math.floor(this._actionTimeline.currentTime*e),this._armature._cacheFrameIndex===i?r=n=!1:(this._armature._cacheFrameIndex=i,this._animationData.cachedFrames[i]?r=!1:this._animationData.cachedFrames[i]=!0)),n){if(r)for(var a=0,o=this._boneTimelines.length;a<o;++a)(c=this._boneTimelines[a]).playState<=0&&c.update(s),a!==o-1&&c.bone===this._boneTimelines[a+1].bone||0!==(l=c.bone._blendState.update(this._weightResult,this.layer))&&c.blend(l);for(a=0,o=this._surfaceTimelines.length;a<o;++a){var l=(c=this._surfaceTimelines[a]).surface._blendState.update(this._weightResult,this.layer);c.playState<=0&&c.update(s),0!==l&&c.blend(l)}if(this.displayControl)for(a=0,o=this._slotTimelines.length;a<o;++a){var h=(c=this._slotTimelines[a]).slot.displayController;null!==h&&h!==this.name&&h!==this.group||c.playState<=0&&c.update(s)}for(a=0,o=this._constraintTimelines.length;a<o;++a)(c=this._constraintTimelines[a]).playState<=0&&c.update(s);for(a=0,o=this._animationTimelines.length;a<o;++a)l=(c=this._animationTimelines[a]).animationState._blendState.update(this._weightResult,this.layer),c.playState<=0&&c.update(s),0!==l&&c.blend(l)}if(0===this._fadeState){if(0<this._subFadeState&&(this._subFadeState=0)<this._poseTimelines.length){for(var c,u=0,_=this._poseTimelines;u<_.length;u++)(c=_[u])instanceof L.BoneTimelineState?this._boneTimelines.splice(this._boneTimelines.indexOf(c),1):c instanceof L.SurfaceTimelineState?this._surfaceTimelines.splice(this._surfaceTimelines.indexOf(c),1):c instanceof L.SlotTimelineState?this._slotTimelines.splice(this._slotTimelines.indexOf(c),1):c instanceof L.ConstraintTimelineState&&this._constraintTimelines.splice(this._constraintTimelines.indexOf(c),1),c.returnToPool();this._poseTimelines.length=0}0<this._actionTimeline.playState&&0<=this.autoFadeOutTime&&this.fadeOut(this.autoFadeOutTime)}}},m.prototype.play=function(){this._playheadState=3},m.prototype.stop=function(){this._playheadState&=1},m.prototype.fadeOut=function(t,e){if(t<0&&(t=0),(e=void 0===e?!0:e)&&(this._playheadState&=2),0<this._fadeState){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,n=this._boneTimelines;i<n.length;i++)(c=n[i]).fadeOut();for(var r=0,s=this._surfaceTimelines;r<s.length;r++)(c=s[r]).fadeOut();for(var a=0,o=this._slotTimelines;a<o.length;a++)(c=o[a]).fadeOut();for(var l=0,h=this._constraintTimelines;l<h.length;l++)(c=h[l]).fadeOut();for(var c,u=0,_=this._animationTimelines;u<_.length;u++)(c=_[u]).animationState.fadeOut(t,e),c.fadeOut()}this.displayControl=!1,this.fadeTotalTime=1e-6<this._fadeProgress?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},m.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||0<=this._boneMask.indexOf(t)},m.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var n=0,r=this._armature.getBones();n<r.length;n++){var s=r[n];this._boneMask.indexOf(s.name)<0&&i.contains(s)&&this._boneMask.push(s.name)}this._timelineDirty=1}},m.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(0<=i&&this._boneMask.splice(i,1),e){var n=this._armature.getBone(t);if(null!==n){i=this._armature.getBones();if(0<this._boneMask.length)for(var r=0,s=i;r<s.length;r++){var a=s[r],o=this._boneMask.indexOf(a.name);0<=o&&n.contains(a)&&this._boneMask.splice(o,1)}else for(var l=0,h=i;l<h.length;l++)(a=h[l])===n||n.contains(a)||this._boneMask.push(a.name)}}this._timelineDirty=1},m.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},Object.defineProperty(m.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isFadeOut",{get:function(){return 0<this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isCompleted",{get:function(){return 0<this._actionTimeline.playState},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(0<this._actionTimeline.playState?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),0<this.playTimes&&e==this.playTimes-1&&t===this._duration&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,n=this._boneTimelines;i<n.length;i++)n[i].playState=-1;for(var r=0,s=this._slotTimelines;r<s.length;r++)s[r].playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),L.AnimationState=m,$t=L.BaseObject,t(ee,$t),ee.toString=function(){return"[class dragonBones.BonePose]"},ee.prototype._onClear=function(){this.current.identity(),this.delta.identity(),this.result.identity()};var $t,te=ee;function ee(){var t=null!==$t&&$t.apply(this,arguments)||this;return t.current=new L.Transform,t.delta=new L.Transform,t.result=new L.Transform,t}L.BonePose=te,ne.prototype.update=function(t,e){if(this.dirty){if(!(0<this.leftWeight))return 0;if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return t*=this.leftWeight,this.layerWeight+=t,this.blendWeight=t,2}return this.dirty=!0,this.layer=e,this.layerWeight=t,this.leftWeight=1,this.blendWeight=t,1},ne.prototype.clear=function(){this.dirty=!1,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0};var ie=ne;function ne(){}L.BlendState=ie;n=i=i||{};re=n.BaseObject,t(se,re),se.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._dragonBonesData=null,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},se.prototype._setCurrentTime=function(t){var e,i,n=this.playState,r=this.currentPlayTimes,s=this.currentTime;return null!==this._actionTimeline&&this._frameCount<=1?(this.playState=0<=this._actionTimeline.playState?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime):null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset?(i=(e=this._animationState.playTimes)*this._duration,t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),0<e&&(i<=t||t<=-i)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=e,this.currentTime=t<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position):(this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime),(this.currentPlayTimes!==r||this.currentTime!==s)&&((n<0&&this.playState!==n||this.playState<=0&&this.currentPlayTimes!==r)&&(this._frameIndex=-1),!0)},se.prototype.init=function(t,e,i){this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState._animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._animationData.parent.parent,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},se.prototype.fadeOut=function(){},se.prototype.update=function(t){this._setCurrentTime(t)&&(1<this._frameCount?(t=Math.floor(this.currentTime*this._frameRate),t=this._frameIndices[this._timelineData.frameIndicesOffset+t],this._frameIndex!==t&&(this._frameIndex=t,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())):this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame()),0!==this._tweenState&&this._onUpdateFrame())};var re,o=se;function se(){return null!==re&&re.apply(this,arguments)||this}n.TimelineState=o,t(y,ae=o),y._getEasingValue=function(t,e,i){var n=e;switch(t){case 3:n=Math.pow(e,2);break;case 4:n=1-Math.pow(1-e,2);break;case 5:n=.5*(1-Math.cos(e*Math.PI))}return(n-e)*i+e},y._getEasingCurveValue=function(t,e,i,n){if(t<=0)return 0;if(1<=t)return 1;var i=i+1,r=Math.floor(t*i),s=0===r?0:e[n+r-1];return 1e-4*(s+((r===i-1?1e4:e[n+r])-s)*(t*i-r))},y.prototype._onClear=function(){ae.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},y.prototype._onArriveAtFrame=function(){var t;1<this._frameCount&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1)?(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1?this._frameDurationR=1/(this._animationData.duration-this._framePosition):(t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],t=this._frameArray[t]*this._frameRateR-this._framePosition,this._frameDurationR=0<t?1/t:0)):this._tweenState=1},y.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=y._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=y._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0};var ae,oe,o=y;function y(){return null!==ae&&ae.apply(this,arguments)||this}function le(){return null!==oe&&oe.apply(this,arguments)||this}n.TweenTimelineState=o,t(le,oe=o),le.prototype._onClear=function(){oe.prototype._onClear.call(this),this.bone=null,this.bonePose=null},le.prototype.blend=function(t){var e=this.bone._blendState.blendWeight,i=this.bone.animationPose,n=this.bonePose.result;2===t?(i.x+=n.x*e,i.y+=n.y*e,i.rotation+=n.rotation*e,i.skew+=n.skew*e,i.scaleX+=(n.scaleX-1)*e,i.scaleY+=(n.scaleY-1)*e):1!==e?(i.x=n.x*e,i.y=n.y*e,i.rotation=n.rotation*e,i.skew=n.skew*e,i.scaleX=(n.scaleX-1)*e+1,i.scaleY=(n.scaleY-1)*e+1):(i.x=n.x,i.y=n.y,i.rotation=n.rotation,i.skew=n.skew,i.scaleX=n.scaleX,i.scaleY=n.scaleY),0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.bone._transformDirty=!0)},n.BoneTimelineState=le,t(ce,he=o),ce.prototype._onClear=function(){he.prototype._onClear.call(this),this.slot=null};var he;function ce(){return null!==he&&he.apply(this,arguments)||this}n.SlotTimelineState=ce,t(_e,ue=o),_e.prototype._onClear=function(){ue.prototype._onClear.call(this),this.constraint=null};var ue;function _e(){return null!==ue&&ue.apply(this,arguments)||this}n.ConstraintTimelineState=_e;var de,v=i=i||{};function x(){return null!==de&&de.apply(this,arguments)||this}de=v.TimelineState,t(x,de),x.toString=function(){return"[class dragonBones.ActionTimelineState]"},x.prototype._onCrossFrame=function(t){var e=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var i=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+t],n=this._frameArray[i+1],r=this._animationData.parent.actions,s=0;s<n;++s){var a,o,l=r[this._frameArray[i+2+s]];0===l.type?((a=v.BaseObject.borrowObject(v.EventObject)).time=this._frameArray[i]/this._frameRate,a.animationState=this._animationState,v.EventObject.actionDataToInstance(l,a,this._armature),this._armature._bufferAction(a,!0)):(o=10===l.type?v.EventObject.FRAME_EVENT:v.EventObject.SOUND_EVENT,11!==l.type&&!e.hasDBEventListener(o)||((a=v.BaseObject.borrowObject(v.EventObject)).time=this._frameArray[i]/this._frameRate,a.animationState=this._animationState,v.EventObject.actionDataToInstance(l,a,this._armature),this._armature._dragonBones.bufferEvent(a)))}},x.prototype._onArriveAtFrame=function(){},x.prototype._onUpdateFrame=function(){},x.prototype.update=function(t){var e=this.playState,i=this.currentPlayTimes,n=this.currentTime;if(this._setCurrentTime(t)){t=this._armature.eventDispatcher;if(e<0){if(this.playState===e)return;this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),i=this.currentPlayTimes,t.hasDBEventListener(v.EventObject.START)&&((e=v.BaseObject.borrowObject(v.EventObject)).type=v.EventObject.START,e.armature=this._armature,e.animationState=this._animationState,this._armature._dragonBones.bufferEvent(e))}var e=this._animationState.timeScale<0,r=null,s=null;if(this.currentPlayTimes!==i&&(t.hasDBEventListener(v.EventObject.LOOP_COMPLETE)&&((r=v.BaseObject.borrowObject(v.EventObject)).type=v.EventObject.LOOP_COMPLETE,r.armature=this._armature,r.animationState=this._animationState),0<this.playState&&t.hasDBEventListener(v.EventObject.COMPLETE)&&((s=v.BaseObject.borrowObject(v.EventObject)).type=v.EventObject.COMPLETE,s.armature=this._armature,s.animationState=this._animationState)),1<this._frameCount){var a=this._timelineData,t=Math.floor(this.currentTime*this._frameRate),o=this._frameIndices[a.frameIndicesOffset+t];if(this._frameIndex!==o){var l,h=this._frameIndex;if(this._frameIndex=o,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[a.offset+5+this._frameIndex],e)for(h<0&&(l=Math.floor(n*this._frameRate),h=this._frameIndices[a.frameIndicesOffset+l],this.currentPlayTimes===i&&h===o&&(h=-1));0<=h;){var c=this._animationData.frameOffset+this._timelineArray[a.offset+5+h],u=this._frameArray[c]/this._frameRate;if(this._position<=u&&u<=this._position+this._duration&&this._onCrossFrame(h),null!==r&&0===h&&(this._armature._dragonBones.bufferEvent(r),r=null),0<h?h--:h=this._frameCount-1,h===o)break}else for(h<0&&(l=Math.floor(n*this._frameRate),h=this._frameIndices[a.frameIndicesOffset+l],c=this._animationData.frameOffset+this._timelineArray[a.offset+5+h],u=this._frameArray[c]/this._frameRate,this.currentPlayTimes===i&&(n<=u?0<h?h--:h=this._frameCount-1:h===o&&(h=-1)));0<=h&&(h<this._frameCount-1?h++:h=0,c=this._animationData.frameOffset+this._timelineArray[a.offset+5+h],u=this._frameArray[c]/this._frameRate,this._position<=u&&u<=this._position+this._duration&&this._onCrossFrame(h),null!==r&&0===h&&(this._armature._dragonBones.bufferEvent(r),r=null),h!==o););}}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5],u=this._frameArray[this._frameOffset]/this._frameRate,this.currentPlayTimes===i?n<=u&&this._onCrossFrame(this._frameIndex):this._position<=u&&(e||null===r||(this._armature._dragonBones.bufferEvent(r),r=null),this._onCrossFrame(this._frameIndex)));null!==r&&this._armature._dragonBones.bufferEvent(r),null!==s&&this._armature._dragonBones.bufferEvent(s)}},x.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},v.ActionTimelineState=x,fe=v.TimelineState,t(pe,fe),pe.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},pe.prototype._onArriveAtFrame=function(){0<=this.playState&&(0<this._frameArray[this._frameOffset+1]?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},pe.prototype._onUpdateFrame=function(){};var fe;function pe(){return null!==fe&&fe.apply(this,arguments)||this}v.ZOrderTimelineState=pe,me=v.BoneTimelineState,t(ye,me),ye.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},ye.prototype._onArriveAtFrame=function(){var t,e,i,n,r;me.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,e=this._armature._armatureData.scale,i=this._frameFloatArray,n=this.bonePose.current,r=this.bonePose.delta,n.x=i[t++]*e,n.y=i[t++]*e,n.rotation=i[t++],n.skew=i[t++],n.scaleX=i[t++],n.scaleY=i[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),r.x=i[t++]*e-n.x,r.y=i[t++]*e-n.y,r.rotation=i[t++]-n.rotation,r.skew=i[t++]-n.skew,r.scaleX=i[t++]-n.scaleX,r.scaleY=i[t++]-n.scaleY):(r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=0,r.scaleY=0)):(n=this.bonePose.current,r=this.bonePose.delta,n.x=0,n.y=0,n.rotation=0,n.skew=0,n.scaleX=1,n.scaleY=1,r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=0,r.scaleY=0)},ye.prototype._onUpdateFrame=function(){me.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=t.x+e.x*this._tweenProgress,i.y=t.y+e.y*this._tweenProgress,i.rotation=t.rotation+e.rotation*this._tweenProgress,i.skew=t.skew+e.skew*this._tweenProgress,i.scaleX=t.scaleX+e.scaleX*this._tweenProgress,i.scaleY=t.scaleY+e.scaleY*this._tweenProgress},ye.prototype.fadeOut=function(){var t=this.bonePose.result;t.rotation=v.Transform.normalizeRadian(t.rotation),t.skew=v.Transform.normalizeRadian(t.skew)};var me;function ye(){return null!==me&&me.apply(this,arguments)||this}v.BoneAllTimelineState=ye,ge=v.BoneTimelineState,t(ve,ge),ve.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},ve.prototype._onArriveAtFrame=function(){var t,e,i,n,r;ge.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._armature._armatureData.scale,i=this._frameFloatArray,n=this.bonePose.current,r=this.bonePose.delta,n.x=i[t++]*e,n.y=i[t++]*e,2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),r.x=i[t++]*e-n.x,r.y=i[t++]*e-n.y):(r.x=0,r.y=0)):(n=this.bonePose.current,r=this.bonePose.delta,n.x=0,n.y=0,r.x=0,r.y=0)},ve.prototype._onUpdateFrame=function(){ge.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=t.x+e.x*this._tweenProgress,i.y=t.y+e.y*this._tweenProgress};var ge;function ve(){return null!==ge&&ge.apply(this,arguments)||this}v.BoneTranslateTimelineState=ve,be=v.BoneTimelineState,t(xe,be),xe.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},xe.prototype._onArriveAtFrame=function(){var t,e,i,n;be.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._frameFloatArray,i=this.bonePose.current,n=this.bonePose.delta,i.rotation=e[t++],i.skew=e[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1?(t=this._animationData.frameFloatOffset+this._frameValueOffset,n.rotation=v.Transform.normalizeRadian(e[t++]-i.rotation)):n.rotation=e[t++]-i.rotation,n.skew=e[t++]-i.skew):(n.rotation=0,n.skew=0)):(i=this.bonePose.current,n=this.bonePose.delta,i.rotation=0,i.skew=0,n.rotation=0,n.skew=0)},xe.prototype._onUpdateFrame=function(){be.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.rotation=t.rotation+e.rotation*this._tweenProgress,i.skew=t.skew+e.skew*this._tweenProgress},xe.prototype.fadeOut=function(){var t=this.bonePose.result;t.rotation=v.Transform.normalizeRadian(t.rotation),t.skew=v.Transform.normalizeRadian(t.skew)};var be;function xe(){return null!==be&&be.apply(this,arguments)||this}v.BoneRotateTimelineState=xe,Ae=v.BoneTimelineState,t(Ce,Ae),Ce.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},Ce.prototype._onArriveAtFrame=function(){var t,e,i,n;Ae.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._frameFloatArray,i=this.bonePose.current,n=this.bonePose.delta,i.scaleX=e[t++],i.scaleY=e[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),n.scaleX=e[t++]-i.scaleX,n.scaleY=e[t++]-i.scaleY):(n.scaleX=0,n.scaleY=0)):(i=this.bonePose.current,n=this.bonePose.delta,i.scaleX=1,i.scaleY=1,n.scaleX=0,n.scaleY=0)},Ce.prototype._onUpdateFrame=function(){Ae.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.scaleX=t.scaleX+e.scaleX*this._tweenProgress,i.scaleY=t.scaleY+e.scaleY*this._tweenProgress};var Ae;function Ce(){return null!==Ae&&Ae.apply(this,arguments)||this}v.BoneScaleTimelineState=Ce,Te=v.TweenTimelineState,t(Se,Te),Se.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},Se.prototype._onClear=function(){Te.prototype._onClear.call(this),this.surface=null,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},Se.prototype._onArriveAtFrame=function(){if(Te.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,e=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var n=t+this._valueCount;this._frameIndex===this._frameCount-1&&(n=this._animationData.frameFloatOffset+this._frameValueOffset);for(var r=0;r<this._valueCount;++r)this._delta[r]=i[n+r]*e-(this._current[r]=i[t+r]*e)}else for(r=0;r<this._valueCount;++r)this._current[r]=i[t+r]*e}else for(r=0;r<this._valueCount;++r)this._current[r]=0},Se.prototype._onUpdateFrame=function(){Te.prototype._onUpdateFrame.call(this),this.surface._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var t=0;t<this._valueCount;++t)this._result[t]=this._current[t]+this._delta[t]*this._tweenProgress},Se.prototype.init=function(t,e,i){Te.prototype.init.call(this,t,e,i),null!==this._timelineData?(t=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],this._deformCount=this._frameIntArray[t+1],this._valueCount=this._frameIntArray[t+2],this._valueOffset=this._frameIntArray[t+3],this._frameFloatOffset=this._frameIntArray[t+4]+this._animationData.frameFloatOffset):(this._deformCount=this.surface._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0),this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var n=0;n<this._valueCount;++n)this._delta[n]=0},Se.prototype.blend=function(t){for(var e=this.surface._blendState.blendWeight,i=this.surface._deformVertices,n=0;n<this._deformCount;++n){var r=n<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+n]:n<this._valueOffset+this._valueCount?this._result[n-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+n-this._valueCount];2===t?i[n]+=r*e:i[n]=1!==e?r*e:r}0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.surface._transformDirty=!0)};var Te;function Se(){var t=null!==Te&&Te.apply(this,arguments)||this;return t._current=[],t._delta=[],t._result=[],t}v.SurfaceTimelineState=Se,we=v.SlotTimelineState,t(Ee,we),Ee.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},Ee.prototype._onArriveAtFrame=function(){var t;0<=this.playState&&(t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex,this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0))};var we;function Ee(){return null!==we&&we.apply(this,arguments)||this}v.SlotDislayTimelineState=Ee,Me=v.SlotTimelineState,t(De,Me),De.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},De.prototype._onClear=function(){Me.prototype._onClear.call(this),this._dirty=!1},De.prototype._onArriveAtFrame=function(){var t,e,i,n;Me.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._dragonBonesData.intArray,(i=(n=this._frameIntArray)[e=this._animationData.frameIntOffset+this._frameValueOffset+ +this._frameIndex])<0&&(i+=65536),this._current[0]=t[i++],this._current[1]=t[i++],this._current[2]=t[i++],this._current[3]=t[i++],this._current[4]=t[i++],this._current[5]=t[i++],this._current[6]=t[i++],this._current[7]=t[i++],2===this._tweenState&&((i=this._frameIndex===this._frameCount-1?n[this._animationData.frameIntOffset+this._frameValueOffset]:n[e+1])<0&&(i+=65536),this._delta[0]=t[i++]-this._current[0],this._delta[1]=t[i++]-this._current[1],this._delta[2]=t[i++]-this._current[2],this._delta[3]=t[i++]-this._current[3],this._delta[4]=t[i++]-this._current[4],this._delta[5]=t[i++]-this._current[5],this._delta[6]=t[i++]-this._current[6],this._delta[7]=t[i++]-this._current[7])):(n=this.slot._slotData.color,this._current[0]=100*n.alphaMultiplier,this._current[1]=100*n.redMultiplier,this._current[2]=100*n.greenMultiplier,this._current[3]=100*n.blueMultiplier,this._current[4]=n.alphaOffset,this._current[5]=n.redOffset,this._current[6]=n.greenOffset,this._current[7]=n.blueOffset)},De.prototype._onUpdateFrame=function(){Me.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},De.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},De.prototype.update=function(t){var e;Me.prototype.update.call(this,t),0===this._tweenState&&!this._dirty||(t=this.slot._colorTransform,0!==this._animationState._fadeState||0!==this._animationState._subFadeState?t.alphaMultiplier===this._result[0]&&t.redMultiplier===this._result[1]&&t.greenMultiplier===this._result[2]&&t.blueMultiplier===this._result[3]&&t.alphaOffset===this._result[4]&&t.redOffset===this._result[5]&&t.greenOffset===this._result[6]&&t.blueOffset===this._result[7]||(e=Math.pow(this._animationState._fadeProgress,4),t.alphaMultiplier+=(this._result[0]-t.alphaMultiplier)*e,t.redMultiplier+=(this._result[1]-t.redMultiplier)*e,t.greenMultiplier+=(this._result[2]-t.greenMultiplier)*e,t.blueMultiplier+=(this._result[3]-t.blueMultiplier)*e,t.alphaOffset+=(this._result[4]-t.alphaOffset)*e,t.redOffset+=(this._result[5]-t.redOffset)*e,t.greenOffset+=(this._result[6]-t.greenOffset)*e,t.blueOffset+=(this._result[7]-t.blueOffset)*e,this.slot._colorDirty=!0):this._dirty&&(this._dirty=!1,t.alphaMultiplier===this._result[0]&&t.redMultiplier===this._result[1]&&t.greenMultiplier===this._result[2]&&t.blueMultiplier===this._result[3]&&t.alphaOffset===this._result[4]&&t.redOffset===this._result[5]&&t.greenOffset===this._result[6]&&t.blueOffset===this._result[7]||(t.alphaMultiplier=this._result[0],t.redMultiplier=this._result[1],t.greenMultiplier=this._result[2],t.blueMultiplier=this._result[3],t.alphaOffset=this._result[4],t.redOffset=this._result[5],t.greenOffset=this._result[6],t.blueOffset=this._result[7],this.slot._colorDirty=!0)))};var Me;function De(){var t=null!==Me&&Me.apply(this,arguments)||this;return t._current=[0,0,0,0,0,0,0,0],t._delta=[0,0,0,0,0,0,0,0],t._result=[0,0,0,0,0,0,0,0],t}v.SlotColorTimelineState=De,A=v.SlotTimelineState,t(C,A),C.toString=function(){return"[class dragonBones.DeformTimelineState]"},C.prototype._onClear=function(){A.prototype._onClear.call(this),this.vertexOffset=0,this._dirty=!1,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},C.prototype._onArriveAtFrame=function(){if(A.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,e=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var n=t+this._valueCount;this._frameIndex===this._frameCount-1&&(n=this._animationData.frameFloatOffset+this._frameValueOffset);for(var r=0;r<this._valueCount;++r)this._delta[r]=i[n+r]*e-(this._current[r]=i[t+r]*e)}else for(r=0;r<this._valueCount;++r)this._current[r]=i[t+r]*e}else for(r=0;r<this._valueCount;++r)this._current[r]=0},C.prototype._onUpdateFrame=function(){A.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var t=0;t<this._valueCount;++t)this._result[t]=this._current[t]+this._delta[t]*this._tweenProgress},C.prototype.init=function(t,e,i){A.prototype.init.call(this,t,e,i),null!==this._timelineData?(t=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],this.vertexOffset=this._frameIntArray[t+0],this.vertexOffset<0&&(this.vertexOffset+=65536),this._deformCount=this._frameIntArray[t+1],this._valueCount=this._frameIntArray[t+2],this._valueOffset=this._frameIntArray[t+3],this._frameFloatOffset=this._frameIntArray[t+4]+this._animationData.frameFloatOffset):(e=this.slot._deformVertices,this._deformCount=null!==e?e.vertices.length:0,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0),this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var n=0;n<this._valueCount;++n)this._delta[n]=0},C.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},C.prototype.update=function(t){var e=this.slot._deformVertices;if(null!==e&&null!==e.verticesData&&e.verticesData.offset===this.vertexOffset&&(A.prototype.update.call(this,t),0!==this._tweenState||this._dirty)){var i=e.vertices;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var n=Math.pow(this._animationState._fadeProgress,2),r=0;r<this._deformCount;++r)r<this._valueOffset?i[r]+=(this._frameFloatArray[this._frameFloatOffset+r]-i[r])*n:r<this._valueOffset+this._valueCount?i[r]+=(this._result[r-this._valueOffset]-i[r])*n:i[r]+=(this._frameFloatArray[this._frameFloatOffset+r-this._valueCount]-i[r])*n;e.verticesDirty=!0}else if(this._dirty){for(this._dirty=!1,r=0;r<this._deformCount;++r)r<this._valueOffset?i[r]=this._frameFloatArray[this._frameFloatOffset+r]:r<this._valueOffset+this._valueCount?i[r]=this._result[r-this._valueOffset]:i[r]=this._frameFloatArray[this._frameFloatOffset+r-this._valueCount];e.verticesDirty=!0}}};var A;function C(){var t=null!==A&&A.apply(this,arguments)||this;return t._current=[],t._delta=[],t._result=[],t}v.DeformTimelineState=C,Be=v.ConstraintTimelineState,t(Ie,Be),Ie.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},Ie.prototype._onClear=function(){Be.prototype._onClear.call(this),this._current=0,this._delta=0},Ie.prototype._onArriveAtFrame=function(){Be.prototype._onArriveAtFrame.call(this);var t,e,i,n=this.constraint;null!==this._timelineData?(t=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,e=0!==(i=this._frameIntArray)[t++],this._current=.01*i[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*i[t+1]-this._current):this._delta=0,n._bendPositive=e):(i=n._constraintData,this._current=i.weight,this._delta=0,n._bendPositive=i.bendPositive),n.invalidUpdate()},Ie.prototype._onUpdateFrame=function(){Be.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0);var t=this.constraint;t._weight=this._current+this._delta*this._tweenProgress,t.invalidUpdate()};var Be;function Ie(){return null!==Be&&Be.apply(this,arguments)||this}v.IKConstraintTimelineState=Ie,Pe=v.TweenTimelineState,t(Re,Pe),Re.toString=function(){return"[class dragonBones.AnimationTimelineState]"},Re.prototype._onClear=function(){Pe.prototype._onClear.call(this),this.animationState=null},Re.prototype._onArriveAtFrame=function(){var t,e,i;Pe.prototype._onArriveAtFrame.call(this),null!==this._timelineData&&(t=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,e=1/this.animationState._animationData.parent.frameRate,i=this._frameIntArray,this._floats[0]=i[t++]*e,this._floats[3]=.01*i[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameIntOffset+this._frameValueOffset),this._floats[1]=i[t++]*e-this._floats[0],this._floats[4]=.01*i[t++]-this._floats[3]):(this._floats[1]=0,this._floats[4]=0))},Re.prototype._onUpdateFrame=function(){Pe.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0),0<=this._floats[0]&&(this._floats[2]=this._floats[0]+this._floats[1]*this._tweenProgress),this._floats[5]=this._floats[3]+this._floats[4]*this._tweenProgress},Re.prototype.blend=function(t){var e=this.animationState,i=e._blendState.blendWeight;2===t?(e.weight+=this._floats[5]*i,e.currentTime+=this._floats[2]*i):(e.weight=this._floats[5]*i,e.currentTime=this._floats[2]*i)};var Pe;function Re(){var t=null!==Pe&&Pe.apply(this,arguments)||this;return t._floats=[0,0,0,0,0,0],t}function T(){return null!==F&&F.apply(this,arguments)||this}function G(){var t=null!==V&&V.apply(this,arguments)||this;return t._rawTextureAtlasIndex=0,t._rawBones=[],t._data=null,t._armature=null,t._bone=null,t._surface=null,t._slot=null,t._skin=null,t._mesh=null,t._animation=null,t._timeline=null,t._rawTextureAtlases=null,t._defaultColorOffset=-1,t._prevClockwise=0,t._prevRotation=0,t._helpMatrixA=new z.Matrix,t._helpMatrixB=new z.Matrix,t._helpTransform=new z.Transform,t._helpColorTransform=new z.ColorTransform,t._helpPoint=new z.Point,t._helpArray=[],t._intArray=[],t._floatArray=[],t._frameIntArray=[],t._frameFloatArray=[],t._frameArray=[],t._timelineArray=[],t._cacheRawMeshes=[],t._cacheMeshes=[],t._actionFrames=[],t._weightSlotPose={},t._weightBonePoses={},t._cacheBones={},t._slotChildActions={},t}function S(){return null!==U&&U.apply(this,arguments)||this}function w(){var t=null!==W&&W.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}function E(){var t=null!==H&&H.apply(this,arguments)||this;return t._localMatrix=new h.Matrix,t._colorTransform=new h.ColorTransform,t._displayDatas=[],t._displayList=[],t._deformVertices=null,t._rawDisplay=null,t._meshDisplay=null,t}function M(){var t=null!==X&&X.apply(this,arguments)||this;return t._vertices=[],t._deformVertices=[],t._hullCache=[],t._matrixCahce=[],t}function D(){var t=null!==Y&&Y.apply(this,arguments)||this;return t.animationPose=new _.Transform,t._blendState=new _.BlendState,t}function Oe(){var t=null!==q&&q.apply(this,arguments)||this;return t.globalTransformMatrix=new e.Matrix,t.global=new e.Transform,t.offset=new e.Transform,t}function B(){var t=null!==Z&&Z.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}function Le(){var t=null!==K&&K.apply(this,arguments)||this;return t.vertices=[],t.bones=[],t}function I(){var t=null!==Q&&Q.apply(this,arguments)||this;return t.boneMask=[],t}function Fe(){var t=null!==$&&$.apply(this,arguments)||this;return t.displays={},t}function Ve(){return null!==tt&&tt.apply(this,arguments)||this}function Ne(){var t=null!==et&&et.apply(this,arguments)||this;return t.frameIndices=[],t.cachedFrames=[],t.armatureNames=[],t.armatures={},t.userData=null,t}v.AnimationTimelineState=Re,o=i=i||{},U=o.BaseObject,t(S,U),S.actionDataToInstance=function(t,e,i){0===t.type?e.type=S.FRAME_EVENT:e.type=10===t.type?S.FRAME_EVENT:S.SOUND_EVENT,e.name=t.name,e.armature=i,e.actionData=t,e.data=t.data,null!==t.bone&&(e.bone=i.getBone(t.bone.name)),null!==t.slot&&(e.slot=i.getSlot(t.slot.name))},S.toString=function(){return"[class dragonBones.EventObject]"},S.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},S.START="start",S.LOOP_COMPLETE="loopComplete",S.COMPLETE="complete",S.FADE_IN="fadeIn",S.FADE_IN_COMPLETE="fadeInComplete",S.FADE_OUT="fadeOut",S.FADE_OUT_COMPLETE="fadeOutComplete",S.FRAME_EVENT="frameEvent",S.SOUND_EVENT="soundEvent",o.EventObject=S,function(c){function u(){}u._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},u._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},u._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},u._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},u._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},u._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},u._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},u._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},u._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},u.parseDragonBonesData=function(t){return console.warn("Deprecated."),(t instanceof ArrayBuffer?c.BinaryDataParser:c.ObjectDataParser).getInstance().parseDragonBonesData(t)},u.parseTextureAtlasData=function(t,e){void 0===e&&(e=1),console.warn("");for(var i={},n=t[u.SUB_TEXTURE],r=0,s=n.length;r<s;r++){var a=n[r],o=a[u.NAME],l=new c.Rectangle,h=null;l.x=a[u.X]/e,l.y=a[u.Y]/e,l.width=a[u.WIDTH]/e,l.height=a[u.HEIGHT]/e,u.FRAME_WIDTH in a&&((h=new c.Rectangle).x=a[u.FRAME_X]/e,h.y=a[u.FRAME_Y]/e,h.width=a[u.FRAME_WIDTH]/e,h.height=a[u.FRAME_HEIGHT]/e),i[o]={region:l,frame:h,rotated:!1}}return i},u.DATA_VERSION_2_3="2.3",u.DATA_VERSION_3_0="3.0",u.DATA_VERSION_4_0="4.0",u.DATA_VERSION_4_5="4.5",u.DATA_VERSION_5_0="5.0",u.DATA_VERSION=u.DATA_VERSION_5_5="5.5",u.DATA_VERSIONS=[u.DATA_VERSION_4_0,u.DATA_VERSION_4_5,u.DATA_VERSION_5_0,u.DATA_VERSION_5_5],u.TEXTURE_ATLAS="textureAtlas",u.SUB_TEXTURE="SubTexture",u.FORMAT="format",u.IMAGE_PATH="imagePath",u.WIDTH="width",u.HEIGHT="height",u.ROTATED="rotated",u.FRAME_X="frameX",u.FRAME_Y="frameY",u.FRAME_WIDTH="frameWidth",u.FRAME_HEIGHT="frameHeight",u.DRADON_BONES="dragonBones",u.USER_DATA="userData",u.ARMATURE="armature",u.BONE="bone",u.SURFACE="surface",u.SLOT="slot",u.CONSTRAINT="constraint",u.IK="ik",u.PATH_CONSTRAINT="path",u.SKIN="skin",u.DISPLAY="display",u.ANIMATION="animation",u.Z_ORDER="zOrder",u.FFD="ffd",u.FRAME="frame",u.TRANSLATE_FRAME="translateFrame",u.ROTATE_FRAME="rotateFrame",u.SCALE_FRAME="scaleFrame",u.DISPLAY_FRAME="displayFrame",u.COLOR_FRAME="colorFrame",u.DEFAULT_ACTIONS="defaultActions",u.ACTIONS="actions",u.EVENTS="events",u.INTS="ints",u.FLOATS="floats",u.STRINGS="strings",u.CANVAS="canvas",u.TRANSFORM="transform",u.PIVOT="pivot",u.AABB="aabb",u.COLOR="color",u.VERSION="version",u.COMPATIBLE_VERSION="compatibleVersion",u.FRAME_RATE="frameRate",u.TYPE="type",u.SUB_TYPE="subType",u.NAME="name",u.PARENT="parent",u.TARGET="target",u.STAGE="stage",u.SHARE="share",u.PATH="path",u.LENGTH="length",u.DISPLAY_INDEX="displayIndex",u.BLEND_MODE="blendMode",u.INHERIT_TRANSLATION="inheritTranslation",u.INHERIT_ROTATION="inheritRotation",u.INHERIT_SCALE="inheritScale",u.INHERIT_REFLECTION="inheritReflection",u.INHERIT_ANIMATION="inheritAnimation",u.INHERIT_DEFORM="inheritDeform",u.SEGMENT_X="segmentX",u.SEGMENT_Y="segmentY",u.BEND_POSITIVE="bendPositive",u.CHAIN="chain",u.WEIGHT="weight",u.FADE_IN_TIME="fadeInTime",u.PLAY_TIMES="playTimes",u.SCALE="scale",u.OFFSET="offset",u.POSITION="position",u.DURATION="duration",u.TWEEN_EASING="tweenEasing",u.TWEEN_ROTATE="tweenRotate",u.TWEEN_SCALE="tweenScale",u.CLOCK_WISE="clockwise",u.CURVE="curve",u.SOUND="sound",u.EVENT="event",u.ACTION="action",u.X="x",u.Y="y",u.SKEW_X="skX",u.SKEW_Y="skY",u.SCALE_X="scX",u.SCALE_Y="scY",u.VALUE="value",u.ROTATE="rotate",u.SKEW="skew",u.ALPHA_OFFSET="aO",u.RED_OFFSET="rO",u.GREEN_OFFSET="gO",u.BLUE_OFFSET="bO",u.ALPHA_MULTIPLIER="aM",u.RED_MULTIPLIER="rM",u.GREEN_MULTIPLIER="gM",u.BLUE_MULTIPLIER="bM",u.UVS="uvs",u.VERTICES="vertices",u.TRIANGLES="triangles",u.WEIGHTS="weights",u.SLOT_POSE="slotPose",u.BONE_POSE="bonePose",u.GLUE_WEIGHTS="glueWeights",u.GLUE_MESHES="glueMeshes",u.BONES="bones",u.POSITION_MODE="positionMode",u.SPACING_MODE="spacingMode",u.ROTATE_MODE="rotateMode",u.SPACING="spacing",u.ROTATE_OFFSET="rotateOffset",u.ROTATE_MIX="rotateMix",u.TRANSLATE_MIX="translateMix",u.TARGET_DISPLAY="targetDisplay",u.CLOSED="closed",u.CONSTANT_SPEED="constantSpeed",u.VERTEX_COUNT="vertexCount",u.LENGTHS="lengths",u.GOTO_AND_PLAY="gotoAndPlay",u.DEFAULT_NAME="default",c.DataParser=u}(i=i||{}),z=i=i||{},V=z.DataParser,t(G,V),G._getBoolean=function(t,e,i){if(e in t){t=t[e],e=typeof t;if("boolean"==e)return t;if("string"!=e)return!!t;switch(t){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},G._getNumber=function(t,e,i){return!(e in t)||null===(t=t[e])||"NaN"===t?i:+t||0},G._getString=function(t,e,i){if(e in t){var n=t[e];if("string"!=typeof n)return String(n);if(z.DragonBones.webAssembly)for(var r=0,s=n.length;r<s;++r)if(255<n.charCodeAt(r))return encodeURI(n);return n}return i},G.prototype._getCurvePoint=function(t,e,i,n,r,s,a,o,l,h){var c=1-l,u=c*c,_=l*l,d=c*u,u=3*l*u,c=3*c*_,l=l*_;h.x=d*t+u*i+c*r+l*a,h.y=d*e+u*n+c*s+l*o},G.prototype._samplingEasingCurve=function(t,e){for(var i=t.length,n=-2,r=0,s=e.length;r<s;++r){for(var a=(r+1)/(s+1);(n+6<i?t[n+6]:1)<a;)n+=6;for(var o=0<=n&&n+6<i,l=o?t[n]:0,h=o?t[n+1]:0,c=t[n+2],u=t[n+3],_=t[n+4],d=t[n+5],f=o?t[n+6]:1,p=o?t[n+7]:1,m=0,y=1;1e-4<y-m;){var g=.5*(y+m);this._getCurvePoint(l,h,c,u,_,d,f,p,g,this._helpPoint),0<a-this._helpPoint.x?m=g:y=g}e[r]=this._helpPoint.y}},G.prototype._parseActionDataInFrame=function(t,e,i,n){z.DataParser.EVENT in t&&this._mergeActionFrame(t[z.DataParser.EVENT],e,10,i,n),z.DataParser.SOUND in t&&this._mergeActionFrame(t[z.DataParser.SOUND],e,11,i,n),z.DataParser.ACTION in t&&this._mergeActionFrame(t[z.DataParser.ACTION],e,0,i,n),z.DataParser.EVENTS in t&&this._mergeActionFrame(t[z.DataParser.EVENTS],e,10,i,n),z.DataParser.ACTIONS in t&&this._mergeActionFrame(t[z.DataParser.ACTIONS],e,0,i,n)},G.prototype._mergeActionFrame=function(t,e,i,n,r){for(var s=z.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,a=this._parseActionData(t,i,n,r),o=0,l=null,h=0,c=a;h<c.length;h++){var u=c[h];this._armature.addAction(u,!1)}0===this._actionFrames.length&&((l=new N).frameStart=0,this._actionFrames.push(l),l=null);for(var _=0,d=this._actionFrames;_<d.length;_++){var f=d[_];if(f.frameStart===e){l=f;break}if(f.frameStart>e)break;o++}null===l&&((l=new N).frameStart=e,this._actionFrames.splice(o+1,0,l));for(var p=0;p<a.length;++p)l.actions.push(s+p)},G.prototype._parseArmature=function(t,e){var i,n=z.BaseObject.borrowObject(z.ArmatureData);if(n.name=G._getString(t,z.DataParser.NAME,""),n.frameRate=G._getNumber(t,z.DataParser.FRAME_RATE,this._data.frameRate),n.scale=e,z.DataParser.TYPE in t&&"string"==typeof t[z.DataParser.TYPE]?n.type=z.DataParser._getArmatureType(t[z.DataParser.TYPE]):n.type=G._getNumber(t,z.DataParser.TYPE,0),0===n.frameRate&&(n.frameRate=24),this._armature=n,z.DataParser.CANVAS in t&&(e=t[z.DataParser.CANVAS],i=z.BaseObject.borrowObject(z.CanvasData),z.DataParser.COLOR in e?i.hasBackground=!0:i.hasBackground=!1,i.color=G._getNumber(e,z.DataParser.COLOR,0),i.x=G._getNumber(e,z.DataParser.X,0)*n.scale,i.y=G._getNumber(e,z.DataParser.Y,0)*n.scale,i.width=G._getNumber(e,z.DataParser.WIDTH,0)*n.scale,i.height=G._getNumber(e,z.DataParser.HEIGHT,0)*n.scale,n.canvas=i),z.DataParser.AABB in t&&(e=t[z.DataParser.AABB],n.aabb.x=G._getNumber(e,z.DataParser.X,0)*n.scale,n.aabb.y=G._getNumber(e,z.DataParser.Y,0)*n.scale,n.aabb.width=G._getNumber(e,z.DataParser.WIDTH,0)*n.scale,n.aabb.height=G._getNumber(e,z.DataParser.HEIGHT,0)*n.scale),z.DataParser.BONE in t)for(var r=0,s=t[z.DataParser.BONE];r<s.length;r++){var a=s[r],o=G._getString(a,z.DataParser.PARENT,""),l=this._parseBone(a);if(0<o.length&&(null!==(a=n.getBone(o))?l.parent=a:(o in this._cacheBones||(this._cacheBones[o]=[]),this._cacheBones[o].push(l))),l.name in this._cacheBones){for(var h=0,c=this._cacheBones[l.name];h<c.length;h++)c[h].parent=l;delete this._cacheBones[l.name]}n.addBone(l),this._rawBones.push(l)}if(z.DataParser.IK in t)for(var u=0,_=t[z.DataParser.IK];u<_.length;u++){var d=_[u];(x=this._parseIKConstraint(d))&&n.addConstraint(x)}if(n.sortBones(),z.DataParser.SLOT in t)for(var f=0,p=0,m=t[z.DataParser.SLOT];p<m.length;p++){var F=m[p];n.addSlot(this._parseSlot(F,f++))}if(z.DataParser.SKIN in t)for(var y=0,g=t[z.DataParser.SKIN];y<g.length;y++){var V=g[y];n.addSkin(this._parseSkin(V))}if(z.DataParser.PATH_CONSTRAINT in t)for(var v=0,b=t[z.DataParser.PATH_CONSTRAINT];v<b.length;v++){var x,N=b[v];(x=this._parsePathConstraint(N))&&n.addConstraint(x)}for(var A,C=0,T=this._cacheRawMeshes.length;C<T;++C){var S=this._cacheRawMeshes[C];z.DataParser.GLUE_WEIGHTS in S&&z.DataParser.GLUE_MESHES in S&&this._parseMeshGlue(S,this._cacheMeshes[C])}for(C=0,T=this._cacheRawMeshes.length;C<T;++C){var w=this._cacheRawMeshes[C],E=G._getString(w,z.DataParser.SHARE,"");0!==E.length&&(0===(w=G._getString(w,z.DataParser.SKIN,z.DataParser.DEFAULT_NAME)).length&&(w=z.DataParser.DEFAULT_NAME),null!==(w=n.getMesh(w,"",E))&&this._cacheMeshes[C].vertices.shareFrom(w.vertices))}if(z.DataParser.ANIMATION in t)for(var M=0,D=t[z.DataParser.ANIMATION];M<D.length;M++){var k=D[M],B=this._parseAnimation(k);n.addAnimation(B)}if(z.DataParser.DEFAULT_ACTIONS in t)for(var I=0,P=this._parseActionData(t[z.DataParser.DEFAULT_ACTIONS],0,null,null);I<P.length;I++){var R=P[I];n.addAction(R,!0),0!==R.type||null!==(B=n.getAnimation(R.name))&&(n.defaultAnimation=B)}if(z.DataParser.ACTIONS in t)for(var O=0,L=this._parseActionData(t[z.DataParser.ACTIONS],0,null,null);O<L.length;O++)R=L[O],n.addAction(R,!1);for(A in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[A];for(A in this._weightBonePoses)delete this._weightBonePoses[A];for(A in this._cacheBones)delete this._cacheBones[A];for(A in this._slotChildActions)delete this._slotChildActions[A];return n},G.prototype._parseBone=function(t){var e,i=this._armature.scale;if(0===(z.DataParser.TYPE in t&&"string"==typeof t[z.DataParser.TYPE]?z.DataParser._getBoneType(t[z.DataParser.TYPE]):G._getNumber(t,z.DataParser.TYPE,0)))return(e=z.BaseObject.borrowObject(z.BoneData)).inheritTranslation=G._getBoolean(t,z.DataParser.INHERIT_TRANSLATION,!0),e.inheritRotation=G._getBoolean(t,z.DataParser.INHERIT_ROTATION,!0),e.inheritScale=G._getBoolean(t,z.DataParser.INHERIT_SCALE,!0),e.inheritReflection=G._getBoolean(t,z.DataParser.INHERIT_REFLECTION,!0),e.length=G._getNumber(t,z.DataParser.LENGTH,0)*i,e.name=G._getString(t,z.DataParser.NAME,""),z.DataParser.TRANSFORM in t&&this._parseTransform(t[z.DataParser.TRANSFORM],e.transform,i),e;var n=z.BaseObject.borrowObject(z.SurfaceData);if(n.name=G._getString(t,z.DataParser.NAME,""),n.segmentX=G._getNumber(t,z.DataParser.SEGMENT_X,0),n.segmentY=G._getNumber(t,z.DataParser.SEGMENT_Y,0),n.vertices.length=(n.segmentX+1)*(n.segmentY+1)*2,z.DataParser.VERTICES in t)for(var r=t[z.DataParser.VERTICES],s=0,a=n.vertices.length;s<a;++s)s<r.length?n.vertices[s]=r[s]*i:n.vertices[s]=0;return n},G.prototype._parseIKConstraint=function(t){var e=this._armature.getBone(G._getString(t,z.DataParser.BONE,""));if(null===e)return null;var i=this._armature.getBone(G._getString(t,z.DataParser.TARGET,""));if(null===i)return null;var n=z.BaseObject.borrowObject(z.IKConstraintData);return n.scaleEnabled=G._getBoolean(t,z.DataParser.SCALE,!1),n.bendPositive=G._getBoolean(t,z.DataParser.BEND_POSITIVE,!0),n.weight=G._getNumber(t,z.DataParser.WEIGHT,1),n.name=G._getString(t,z.DataParser.NAME,""),n.type=0,n.target=i,0<G._getNumber(t,z.DataParser.CHAIN,0)&&null!==e.parent?(n.root=e.parent,n.bone=e):(n.root=e,n.bone=null),n},G.prototype._parsePathConstraint=function(t){var e=this._armature.getSlot(G._getString(t,z.DataParser.TARGET,""));if(null===e)return null;var i=this._armature.defaultSkin;if(null===i)return null;i=i.getDisplay(e.name,G._getString(t,z.DataParser.TARGET_DISPLAY,e.name));if(null===i||!(i instanceof z.PathDisplayData))return null;var n=t[z.DataParser.BONES];if(null===n||0===n.length)return null;var r=z.BaseObject.borrowObject(z.PathConstraintData);r.name=G._getString(t,z.DataParser.NAME,""),r.type=1,r.pathSlot=e,r.pathDisplayData=i,r.target=e.parent,r.positionMode=z.DataParser._getPositionMode(G._getString(t,z.DataParser.POSITION_MODE,"")),r.spacingMode=z.DataParser._getSpacingMode(G._getString(t,z.DataParser.SPACING_MODE,"")),r.rotateMode=z.DataParser._getRotateMode(G._getString(t,z.DataParser.ROTATE_MODE,"")),r.position=G._getNumber(t,z.DataParser.POSITION,0),r.spacing=G._getNumber(t,z.DataParser.SPACING,0),r.rotateOffset=G._getNumber(t,z.DataParser.ROTATE_OFFSET,0),r.rotateMix=G._getNumber(t,z.DataParser.ROTATE_MIX,1),r.translateMix=G._getNumber(t,z.DataParser.TRANSLATE_MIX,1);for(var s=0,a=n;s<a.length;s++){var o=a[s],o=this._armature.getBone(o);null!==o&&(r.AddBone(o),null===r.root&&(r.root=o))}return r},G.prototype._parseSlot=function(t,e){var i=z.BaseObject.borrowObject(z.SlotData);return i.displayIndex=G._getNumber(t,z.DataParser.DISPLAY_INDEX,0),i.zOrder=e,i.name=G._getString(t,z.DataParser.NAME,""),i.parent=this._armature.getBone(G._getString(t,z.DataParser.PARENT,"")),z.DataParser.BLEND_MODE in t&&"string"==typeof t[z.DataParser.BLEND_MODE]?i.blendMode=z.DataParser._getBlendMode(t[z.DataParser.BLEND_MODE]):i.blendMode=G._getNumber(t,z.DataParser.BLEND_MODE,0),z.DataParser.COLOR in t?(i.color=z.SlotData.createColor(),this._parseColorTransform(t[z.DataParser.COLOR],i.color)):i.color=z.SlotData.DEFAULT_COLOR,z.DataParser.ACTIONS in t&&(this._slotChildActions[i.name]=this._parseActionData(t[z.DataParser.ACTIONS],0,null,null)),i},G.prototype._parseSkin=function(t){var e=z.BaseObject.borrowObject(z.SkinData);if(e.name=G._getString(t,z.DataParser.NAME,z.DataParser.DEFAULT_NAME),0===e.name.length&&(e.name=z.DataParser.DEFAULT_NAME),z.DataParser.SLOT in t){t=t[z.DataParser.SLOT];this._skin=e;for(var i=0,n=t;i<n.length;i++){var r=n[i],s=G._getString(r,z.DataParser.NAME,""),a=this._armature.getSlot(s);if(null!==a){if(this._slot=a,z.DataParser.DISPLAY in r)for(var o=0,l=r[z.DataParser.DISPLAY];o<l.length;o++){var h=l[o];h?e.addDisplay(s,this._parseDisplay(h)):e.addDisplay(s,null)}this._slot=null}}this._skin=null}return e},G.prototype._parseDisplay=function(t){var e=G._getString(t,z.DataParser.NAME,""),i=G._getString(t,z.DataParser.PATH,""),n=0,r=null;switch(n=z.DataParser.TYPE in t&&"string"==typeof t[z.DataParser.TYPE]?z.DataParser._getDisplayType(t[z.DataParser.TYPE]):G._getNumber(t,z.DataParser.TYPE,n)){case 0:var s=r=z.BaseObject.borrowObject(z.ImageDisplayData);s.name=e,s.path=0<i.length?i:e,this._parsePivot(t,s);break;case 1:var a=r=z.BaseObject.borrowObject(z.ArmatureDisplayData);if(a.name=e,a.path=0<i.length?i:e,a.inheritAnimation=!0,z.DataParser.ACTIONS in t)for(var o=0,l=this._parseActionData(t[z.DataParser.ACTIONS],0,null,null);o<l.length;o++){var h=l[o];a.addAction(h)}else if(this._slot.name in this._slotChildActions){s=this._skin.getDisplays(this._slot.name);if(null===s?0===this._slot.displayIndex:this._slot.displayIndex===s.length){for(var c=0,u=this._slotChildActions[this._slot.name];c<u.length;c++)h=u[c],a.addAction(h);delete this._slotChildActions[this._slot.name]}}break;case 2:s=r=z.BaseObject.borrowObject(z.MeshDisplayData);s.vertices.inheritDeform=G._getBoolean(t,z.DataParser.INHERIT_DEFORM,!0),s.name=e,s.path=0<i.length?i:e,s.vertices.data=this._data,z.DataParser.SHARE in t?(this._cacheRawMeshes.push(t),this._cacheMeshes.push(s)):this._parseMesh(t,s),z.DataParser.GLUE_WEIGHTS in t&&z.DataParser.GLUE_MESHES in t&&(this._cacheRawMeshes.push(t),this._cacheMeshes.push(s));break;case 3:var _,s=this._parseBoundingBox(t);null!==s&&((_=r=z.BaseObject.borrowObject(z.BoundingBoxDisplayData)).name=e,_.path=0<i.length?i:e,_.boundingBox=s);break;case 4:var d=t[z.DataParser.LENGTHS],f=r=z.BaseObject.borrowObject(z.PathDisplayData);f.closed=G._getBoolean(t,z.DataParser.CLOSED,!1),f.constantSpeed=G._getBoolean(t,z.DataParser.CONSTANT_SPEED,!1),f.name=e,f.path=0<i.length?i:e,f.vertices.data=this._data,f.curveLengths.length=d.length;for(var p=0,m=d.length;p<m;++p)f.curveLengths[p]=d[p];this._parsePath(t,f)}return null!==r&&z.DataParser.TRANSFORM in t&&this._parseTransform(t[z.DataParser.TRANSFORM],r.transform,this._armature.scale),r},G.prototype._parsePath=function(t,e){var i=t[z.DataParser.VERTICES],n=G._getNumber(t,z.DataParser.VERTEX_COUNT,0),r=this._floatArray.length,s=this._intArray.length;if(e.vertices.offset=s,this._intArray.length+=2,this._intArray[s+0]=n,this._intArray[s+2]=r,z.DataParser.WEIGHTS in t){var a=t[z.DataParser.WEIGHTS],o=t[z.DataParser.BONES],l=o.length,h=Math.floor(a.length-n)/2,c=this._intArray.length,s=this._floatArray.length,u=this._armature.sortedBones,_=z.BaseObject.borrowObject(z.WeightData);for(_.count=h,_.offset=c,this._intArray.length+=2+l+n+h,this._intArray[c+0]=l,this._intArray[c+1]=s,f=0;f<l;f++){var d=o[f],d=this._rawBones[d];_.addBone(d),this._intArray[c+2+f]=u.indexOf(d)}this._floatArray.length+=3*h;for(var f=0,p=0,m=0,y=c+2+l,g=s;f<h;f++){var v=a[p++];this._intArray[y++]=v;for(var b=0;b<v;b++){var x=a[p++],A=a[p++],C=i[m++],T=i[m++];this._intArray[y++]=o.indexOf(x),this._floatArray[g++]=A,this._floatArray[g++]=C,this._floatArray[g++]=T}}e.vertices.weight=_}else{this._floatArray.length+=i.length;for(var f=0,S=i.length;f<S;++f)this._floatArray[r+f]=i[f]}},G.prototype._parsePivot=function(t,e){z.DataParser.PIVOT in t?(t=t[z.DataParser.PIVOT],e.pivot.x=G._getNumber(t,z.DataParser.X,0),e.pivot.y=G._getNumber(t,z.DataParser.Y,0)):(e.pivot.x=.5,e.pivot.y=.5)},G.prototype._parseMesh=function(t,e){var i=t[z.DataParser.VERTICES],n=t[z.DataParser.UVS],r=t[z.DataParser.TRIANGLES],s=Math.floor(i.length/2),a=Math.floor(r.length/3),o=this._floatArray.length,l=o+2*s,h=this._intArray.length,c=this._skin.name+"_"+this._slot.name+"_"+e.name;e.vertices.offset=h,this._intArray.length+=4+3*a,this._intArray[h+0]=s,this._intArray[h+1]=a,this._intArray[h+2]=o;for(var u=0,_=3*a;u<_;++u)this._intArray[h+4+u]=r[u];for(this._floatArray.length+=2*s+2*s,u=0,_=2*s;u<_;++u)this._floatArray[o+u]=i[u],this._floatArray[l+u]=n[u];if(z.DataParser.WEIGHTS in t){var d=t[z.DataParser.WEIGHTS],a=t[z.DataParser.SLOT_POSE],f=t[z.DataParser.BONE_POSE],p=this._armature.sortedBones,m=new Array,y=Math.floor(f.length/7),t=this._floatArray.length,g=Math.floor(d.length-s)/2,v=this._intArray.length,b=z.BaseObject.borrowObject(z.WeightData);for(b.count=g,b.offset=v,m.length=y,this._intArray.length+=2+y+s+g,this._intArray[v+1]=t,u=0;u<y;++u){var x=f[7*u],A=this._rawBones[x];b.addBone(A),m[u]=x,this._intArray[v+2+u]=p.indexOf(A)}this._floatArray.length+=3*g,this._helpMatrixA.copyFromArray(a,0);for(var u=0,C=0,T=v+2+y,S=t;u<s;++u){var w=2*u,E=this._intArray[T++]=d[C++],M=this._floatArray[o+w],D=this._floatArray[o+w+1];this._helpMatrixA.transformPoint(M,D,this._helpPoint);for(var M=this._helpPoint.x,D=this._helpPoint.y,B=0;B<E;++B){var x=d[C++],I=m.indexOf(x);this._helpMatrixB.copyFromArray(f,7*I+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(M,D,this._helpPoint),this._intArray[T++]=I,this._floatArray[S++]=d[C++],this._floatArray[S++]=this._helpPoint.x,this._floatArray[S++]=this._helpPoint.y}}e.vertices.weight=b,this._weightSlotPose[c]=a,this._weightBonePoses[c]=f}},G.prototype._parseMeshGlue=function(t,e){},G.prototype._parseBoundingBox=function(t){var e=null,i=0;switch(i=z.DataParser.SUB_TYPE in t&&"string"==typeof t[z.DataParser.SUB_TYPE]?z.DataParser._getBoundingBoxType(t[z.DataParser.SUB_TYPE]):G._getNumber(t,z.DataParser.SUB_TYPE,i)){case 0:e=z.BaseObject.borrowObject(z.RectangleBoundingBoxData);break;case 1:e=z.BaseObject.borrowObject(z.EllipseBoundingBoxData);break;case 2:e=this._parsePolygonBoundingBox(t)}return null!==e&&(e.color=G._getNumber(t,z.DataParser.COLOR,0),0!==e.type&&1!==e.type||(e.width=G._getNumber(t,z.DataParser.WIDTH,0),e.height=G._getNumber(t,z.DataParser.HEIGHT,0))),e},G.prototype._parsePolygonBoundingBox=function(t){var e=z.BaseObject.borrowObject(z.PolygonBoundingBoxData);if(z.DataParser.VERTICES in t){var i=this._armature.scale,n=t[z.DataParser.VERTICES],r=e.vertices;z.DragonBones.webAssembly?r.resize(n.length,0):r.length=n.length;for(var s=0,a=n.length;s<a;s+=2){var o=n[s]*i,l=n[s+1]*i;z.DragonBones.webAssembly?(r.set(s,o),r.set(s+1,l)):(r[s]=o,r[s+1]=l),0===s?(e.x=o,e.y=l,e.width=o,e.height=l):(o<e.x?e.x=o:o>e.width&&(e.width=o),l<e.y?e.y=l:l>e.height&&(e.height=l))}e.width-=e.x,e.height-=e.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return e},G.prototype._parseAnimation=function(t){var e=z.BaseObject.borrowObject(z.AnimationData);if(e.frameCount=Math.max(G._getNumber(t,z.DataParser.DURATION,1),1),e.playTimes=G._getNumber(t,z.DataParser.PLAY_TIMES,1),e.duration=e.frameCount/this._armature.frameRate,e.fadeInTime=G._getNumber(t,z.DataParser.FADE_IN_TIME,0),e.scale=G._getNumber(t,z.DataParser.SCALE,1),e.name=G._getString(t,z.DataParser.NAME,z.DataParser.DEFAULT_NAME),0===e.name.length&&(e.name=z.DataParser.DEFAULT_NAME),e.frameIntOffset=this._frameIntArray.length,e.frameFloatOffset=this._frameFloatArray.length,e.frameOffset=this._frameArray.length,this._animation=e,z.DataParser.FRAME in t){var i=t[z.DataParser.FRAME],n=i.length;if(0<n)for(var r=0,s=0;r<n;++r){var a=i[r];this._parseActionDataInFrame(a,s,null,null),s+=G._getNumber(a,z.DataParser.DURATION,1)}}if(z.DataParser.Z_ORDER in t&&(this._animation.zOrderTimeline=this._parseTimeline(t[z.DataParser.Z_ORDER],null,z.DataParser.FRAME,1,!1,!1,0,this._parseZOrderFrame)),z.DataParser.BONE in t)for(var o=0,l=t[z.DataParser.BONE];o<l.length;o++){var h=l[o];this._parseBoneTimeline(h)}if(z.DataParser.SURFACE in t)for(var c=0,u=t[z.DataParser.SURFACE];c<u.length;c++){var h=u[c],_=G._getString(h,z.DataParser.NAME,"");this._surface=this._armature.getBone(_),null!==this._surface&&(null!==(S=this._parseTimeline(h,null,z.DataParser.FRAME,50,!1,!0,0,this._parseSurfaceFrame))&&this._animation.addSurfaceTimeline(this._surface,S),this._surface=null)}if(z.DataParser.SLOT in t)for(var d=0,f=t[z.DataParser.SLOT];d<f.length;d++)h=f[d],this._parseSlotTimeline(h);if(z.DataParser.FFD in t)for(var p=0,m=t[z.DataParser.FFD];p<m.length;p++){h=m[p];var y=G._getString(h,z.DataParser.SKIN,z.DataParser.DEFAULT_NAME),g=G._getString(h,z.DataParser.SLOT,""),v=G._getString(h,z.DataParser.NAME,"");0===y.length&&(y=z.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(g),this._mesh=this._armature.getMesh(y,g,v),null!==this._slot&&null!==this._mesh&&(null!==(S=this._parseTimeline(h,null,z.DataParser.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,S),this._slot=null,this._mesh=null)}if(z.DataParser.IK in t)for(var b=0,x=t[z.DataParser.IK];b<x.length;b++){h=x[b];var A=G._getString(h,z.DataParser.NAME,""),A=this._armature.getConstraint(A);null!==A&&null!==(S=this._parseTimeline(h,null,z.DataParser.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(A,S)}if(z.DataParser.ANIMATION in t)for(var C=0,T=t[z.DataParser.ANIMATION];C<T.length;C++){h=T[C];var S,w=G._getString(h,z.DataParser.NAME,"");null!==(S=this._parseTimeline(h,null,z.DataParser.FRAME,40,!0,!1,2,this._parseAnimationFrame))&&this._animation.addAnimationTimeline(w,S)}return 0<this._actionFrames.length&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,e},G.prototype._parseTimeline=function(t,e,i,n,r,s,a,o){if(null===(e=null!==t&&0<i.length&&i in t?t[i]:e))return null;var l=e.length;if(0===l)return null;var i=this._frameIntArray.length,h=this._frameFloatArray.length,c=z.BaseObject.borrowObject(z.TimelineData),u=this._timelineArray.length;if(this._timelineArray.length+=5+l,null!==t?(this._timelineArray[u+0]=Math.round(100*G._getNumber(t,z.DataParser.SCALE,1)),this._timelineArray[u+1]=Math.round(100*G._getNumber(t,z.DataParser.OFFSET,0))):(this._timelineArray[u+0]=100,this._timelineArray[u+1]=0),this._timelineArray[u+2]=l,this._timelineArray[u+3]=a,this._timelineArray[u+4]=r?i-this._animation.frameIntOffset:s?h-this._animation.frameFloatOffset:0,(this._timeline=c).type=n,c.offset=u,1===l)c.frameIndicesOffset=-1,this._timelineArray[u+5+0]=o.call(this,e[0],0,0)-this._animation.frameOffset;else{var _=this._animation.frameCount+1,d=this._data.frameIndices,f=0;z.DragonBones.webAssembly?(f=d.size(),d.resize(f+_,0)):(f=d.length,d.length+=_),c.frameIndicesOffset=f;for(var p,m=0,y=0,g=0,v=0;m<_;++m)g+v<=m&&y<l&&(p=e[y],g=m,v=y===l-1?this._animation.frameCount-g:p instanceof N?this._actionFrames[y+1].frameStart-g:G._getNumber(p,z.DataParser.DURATION,1),this._timelineArray[u+5+y]=o.call(this,p,g,v)-this._animation.frameOffset,y++),z.DragonBones.webAssembly?d.set(f+m,y-1):d[f+m]=y-1}return this._timeline=null,c},G.prototype._parseBoneTimeline=function(t){var e,i=this._armature.getBone(G._getString(t,z.DataParser.NAME,""));null!==i&&(this._bone=i,this._slot=this._armature.getSlot(this._bone.name),z.DataParser.TRANSLATE_FRAME in t&&null!==(e=this._parseTimeline(t,null,z.DataParser.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(i,e),z.DataParser.ROTATE_FRAME in t&&null!==(e=this._parseTimeline(t,null,z.DataParser.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(i,e),z.DataParser.SCALE_FRAME in t&&null!==(e=this._parseTimeline(t,null,z.DataParser.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(i,e),z.DataParser.FRAME in t&&null!==(e=this._parseTimeline(t,null,z.DataParser.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(i,e),this._bone=null,this._slot=null)},G.prototype._parseSlotTimeline=function(t){var e,i=this._armature.getSlot(G._getString(t,z.DataParser.NAME,""));null!==i&&(this._slot=i,(e=null)!==(e=z.DataParser.DISPLAY_FRAME in t?this._parseTimeline(t,null,z.DataParser.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(t,null,z.DataParser.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(i,e),(e=null)!==(e=z.DataParser.COLOR_FRAME in t?this._parseTimeline(t,null,z.DataParser.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(t,null,z.DataParser.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(i,e),this._slot=null)},G.prototype._parseFrame=function(t,e,i){var n=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[n+0]=e,n},G.prototype._parseTweenFrame=function(t,e,i){var n=this._parseFrame(t,e,i);if(0<i)if(z.DataParser.CURVE in t){var r=i+1;this._helpArray.length=r,this._samplingEasingCurve(t[z.DataParser.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[n+1]=2,this._frameArray[n+2]=r;for(var s=0;s<r;++s)this._frameArray[n+3+s]=Math.round(1e4*this._helpArray[s])}else{e=-2;-2===(e=z.DataParser.TWEEN_EASING in t?G._getNumber(t,z.DataParser.TWEEN_EASING,-2):e)?(this._frameArray.length+=1,this._frameArray[n+1]=0):0===e?(this._frameArray.length+=1,this._frameArray[n+1]=1):e<0?(this._frameArray.length+=2,this._frameArray[n+1]=3,this._frameArray[n+2]=Math.round(100*-e)):e<=1?(this._frameArray.length+=2,this._frameArray[n+1]=4,this._frameArray[n+2]=Math.round(100*e)):(this._frameArray.length+=2,this._frameArray[n+1]=5,this._frameArray[n+2]=Math.round(100*e-100))}else this._frameArray.length+=1,this._frameArray[n+1]=0;return n},G.prototype._parseActionFrame=function(t,e,i){var n=this._frameArray.length,r=t.actions.length;this._frameArray.length+=2+r,this._frameArray[n+0]=e,this._frameArray[n+0+1]=r;for(var s=0;s<r;++s)this._frameArray[n+0+2+s]=t.actions[s];return n},G.prototype._parseZOrderFrame=function(t,e,i){var n=this._parseFrame(t,e,i);if(z.DataParser.Z_ORDER in t){var r=t[z.DataParser.Z_ORDER];if(0<r.length){for(var s=this._armature.sortedSlots.length,a=new Array(s-r.length/2),o=new Array(s),l=0;l<a.length;++l)a[l]=0;for(var h=0;h<s;++h)o[h]=-1;for(var c=0,u=0,_=0,d=r.length;_<d;_+=2){for(var f=r[_],p=r[_+1];c!==f;)a[u++]=c++;o[c+p]=c++}for(;c<s;)a[u++]=c++;this._frameArray.length+=1+s;for(var m=this._frameArray[n+1]=s;m--;)-1===o[m]?this._frameArray[n+2+m]=a[--u]||0:this._frameArray[n+2+m]=o[m]||0;return n}}return this._frameArray.length+=1,this._frameArray[n+1]=0,n},G.prototype._parseBoneAllFrame=function(t,e,i){this._helpTransform.identity(),z.DataParser.TRANSFORM in t&&this._parseTransform(t[z.DataParser.TRANSFORM],this._helpTransform,1);var n=this._helpTransform.rotation,i=(0!==e&&(n=0===this._prevClockwise?this._prevRotation+z.Transform.normalizeRadian(n-this._prevRotation):((0<this._prevClockwise?n>=this._prevRotation:n<=this._prevRotation)&&(this._prevClockwise=0<this._prevClockwise?this._prevClockwise-1:this._prevClockwise+1),this._prevRotation+n-this._prevRotation+z.Transform.PI_D*this._prevClockwise)),this._prevClockwise=G._getNumber(t,z.DataParser.TWEEN_ROTATE,0),this._prevRotation=n,this._parseTweenFrame(t,e,i)),r=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[r++]=this._helpTransform.x,this._frameFloatArray[r++]=this._helpTransform.y,this._frameFloatArray[r++]=n,this._frameFloatArray[r++]=this._helpTransform.skew,this._frameFloatArray[r++]=this._helpTransform.scaleX,this._frameFloatArray[+r]=this._helpTransform.scaleY,this._parseActionDataInFrame(t,e,this._bone,this._slot),i},G.prototype._parseBoneTranslateFrame=function(t,e,i){e=this._parseTweenFrame(t,e,i),i=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[i++]=G._getNumber(t,z.DataParser.X,0),this._frameFloatArray[+i]=G._getNumber(t,z.DataParser.Y,0),e},G.prototype._parseBoneRotateFrame=function(t,e,i){var n=G._getNumber(t,z.DataParser.ROTATE,0)*z.Transform.DEG_RAD,e=(0!==e&&(n=0===this._prevClockwise?this._prevRotation+z.Transform.normalizeRadian(n-this._prevRotation):((0<this._prevClockwise?n>=this._prevRotation:n<=this._prevRotation)&&(this._prevClockwise=0<this._prevClockwise?this._prevClockwise-1:this._prevClockwise+1),this._prevRotation+n-this._prevRotation+z.Transform.PI_D*this._prevClockwise)),this._prevClockwise=G._getNumber(t,z.DataParser.CLOCK_WISE,0),this._prevRotation=n,this._parseTweenFrame(t,e,i)),i=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[i++]=n,this._frameFloatArray[+i]=G._getNumber(t,z.DataParser.SKEW,0)*z.Transform.DEG_RAD,e},G.prototype._parseBoneScaleFrame=function(t,e,i){e=this._parseTweenFrame(t,e,i),i=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[i++]=G._getNumber(t,z.DataParser.X,1),this._frameFloatArray[+i]=G._getNumber(t,z.DataParser.Y,1),e},G.prototype._parseSurfaceFrame=function(t,e,i){var n,r,s=this._frameFloatArray.length,i=this._parseTweenFrame(t,e,i),a=t[z.DataParser.VERTICES],o=G._getNumber(t,z.DataParser.OFFSET,0),l=this._surface.vertices.length/2;this._frameFloatArray.length+=2*l;for(var h=0;h<2*l;h+=2)n=h<o||h-o>=a.length?0:a[h-o],r=h+1<o||h+1-o>=a.length?0:a[h+1-o],this._frameFloatArray[s+h]=n,this._frameFloatArray[s+h+1]=r;return 0===e&&(t=this._frameIntArray.length,this._frameIntArray.length+=5,this._frameIntArray[t+0]=0,this._frameIntArray[t+1]=this._frameFloatArray.length-s,this._frameIntArray[t+2]=this._frameFloatArray.length-s,this._frameIntArray[t+3]=0,this._frameIntArray[t+4]=s-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=t-this._animation.frameIntOffset),i},G.prototype._parseSlotDisplayFrame=function(t,e,i){i=this._parseFrame(t,e,i);return this._frameArray.length+=1,z.DataParser.VALUE in t?this._frameArray[i+1]=G._getNumber(t,z.DataParser.VALUE,0):this._frameArray[i+1]=G._getNumber(t,z.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(t,e,this._slot.parent,this._slot),i},G.prototype._parseSlotColorFrame=function(t,e,i){var e=this._parseTweenFrame(t,e,i),n=-1;if(z.DataParser.VALUE in t||z.DataParser.COLOR in t){var r,s=z.DataParser.VALUE in t?t[z.DataParser.VALUE]:t[z.DataParser.COLOR];for(r in s){this._parseColorTransform(s,this._helpColorTransform),n=this._intArray.length,this._intArray.length+=8,this._intArray[n++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.redMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._intArray[n++]=Math.round(this._helpColorTransform.alphaOffset),this._intArray[n++]=Math.round(this._helpColorTransform.redOffset),this._intArray[n++]=Math.round(this._helpColorTransform.greenOffset),this._intArray[n++]=Math.round(this._helpColorTransform.blueOffset),n-=8;break}}n<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=n=this._intArray.length,this._intArray.length+=8,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=0,this._intArray[n++]=0,this._intArray[n++]=0,this._intArray[n++]=0),n=this._defaultColorOffset);i=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[i]=n,e},G.prototype._parseSlotFFDFrame=function(t,e,i){var n=this._frameFloatArray.length,i=this._parseTweenFrame(t,e,i),r=z.DataParser.VERTICES in t?t[z.DataParser.VERTICES]:null,s=G._getNumber(t,z.DataParser.OFFSET,0),a=this._intArray[this._mesh.vertices.offset+0],o=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,l=this._mesh.vertices.weight,h=0,c=0,u=0,_=0;null!==l?(t=this._weightSlotPose[o],this._helpMatrixA.copyFromArray(t,0),this._frameFloatArray.length+=2*l.count,u=l.offset+2+l.bones.length):this._frameFloatArray.length+=2*a;for(var d=0;d<2*a;d+=2)if(c=null===r?h=0:(h=d<s||d-s>=r.length?0:r[d-s],d+1<s||d+1-s>=r.length?0:r[d+1-s]),null!==l){var f=this._weightBonePoses[o],p=this._intArray[u++];this._helpMatrixA.transformPoint(h,c,this._helpPoint,!0);for(var h=this._helpPoint.x,c=this._helpPoint.y,m=0;m<p;++m){var y=this._intArray[u++];this._helpMatrixB.copyFromArray(f,7*y+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(h,c,this._helpPoint,!0),this._frameFloatArray[n+_++]=this._helpPoint.x,this._frameFloatArray[n+_++]=this._helpPoint.y}}else this._frameFloatArray[n+d]=h,this._frameFloatArray[n+d+1]=c;return 0===e&&(t=this._frameIntArray.length,this._frameIntArray.length+=5,this._frameIntArray[t+0]=this._mesh.vertices.offset,this._frameIntArray[t+1]=this._frameFloatArray.length-n,this._frameIntArray[t+2]=this._frameFloatArray.length-n,this._frameIntArray[t+3]=0,this._frameIntArray[t+4]=n-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=t-this._animation.frameIntOffset),i},G.prototype._parseIKConstraintFrame=function(t,e,i){e=this._parseTweenFrame(t,e,i),i=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[i++]=G._getBoolean(t,z.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[+i]=Math.round(100*G._getNumber(t,z.DataParser.WEIGHT,1)),e},G.prototype._parseAnimationFrame=function(t,e,i){e=this._parseTweenFrame(t,e,i),i=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[i++]=G._getNumber(t,z.DataParser.VALUE,0),this._frameIntArray[+i]=Math.round(100*G._getNumber(t,z.DataParser.WEIGHT,1)),e},G.prototype._parseActionData=function(t,e,i,n){var r=new Array;if("string"==typeof t)(h=z.BaseObject.borrowObject(z.ActionData)).type=e,h.name=t,h.bone=i,h.slot=n,r.push(h);else if(t instanceof Array)for(var s=0,a=t;s<a.length;s++){var o,l=a[s],h=z.BaseObject.borrowObject(z.ActionData),c=(z.DataParser.GOTO_AND_PLAY in l?(h.type=0,h.name=G._getString(l,z.DataParser.GOTO_AND_PLAY,"")):(z.DataParser.TYPE in l&&"string"==typeof l[z.DataParser.TYPE]?h.type=z.DataParser._getActionType(l[z.DataParser.TYPE]):h.type=G._getNumber(l,z.DataParser.TYPE,e),h.name=G._getString(l,z.DataParser.NAME,"")),z.DataParser.BONE in l?(o=G._getString(l,z.DataParser.BONE,""),h.bone=this._armature.getBone(o)):h.bone=i,z.DataParser.SLOT in l?(o=G._getString(l,z.DataParser.SLOT,""),h.slot=this._armature.getSlot(o)):h.slot=n,null);if(z.DataParser.INTS in l){null===c&&(c=z.BaseObject.borrowObject(z.UserData));for(var u=0,_=l[z.DataParser.INTS];u<_.length;u++){var d=_[u];c.addInt(d)}}if(z.DataParser.FLOATS in l){null===c&&(c=z.BaseObject.borrowObject(z.UserData));for(var f=0,p=l[z.DataParser.FLOATS];f<p.length;f++)d=p[f],c.addFloat(d)}if(z.DataParser.STRINGS in l){null===c&&(c=z.BaseObject.borrowObject(z.UserData));for(var m=0,y=l[z.DataParser.STRINGS];m<y.length;m++)d=y[m],c.addString(d)}h.data=c,r.push(h)}return r},G.prototype._parseTransform=function(t,e,i){e.x=G._getNumber(t,z.DataParser.X,0)*i,e.y=G._getNumber(t,z.DataParser.Y,0)*i,z.DataParser.ROTATE in t||z.DataParser.SKEW in t?(e.rotation=z.Transform.normalizeRadian(G._getNumber(t,z.DataParser.ROTATE,0)*z.Transform.DEG_RAD),e.skew=z.Transform.normalizeRadian(G._getNumber(t,z.DataParser.SKEW,0)*z.Transform.DEG_RAD)):(z.DataParser.SKEW_X in t||z.DataParser.SKEW_Y in t)&&(e.rotation=z.Transform.normalizeRadian(G._getNumber(t,z.DataParser.SKEW_Y,0)*z.Transform.DEG_RAD),e.skew=z.Transform.normalizeRadian(G._getNumber(t,z.DataParser.SKEW_X,0)*z.Transform.DEG_RAD)-e.rotation),e.scaleX=G._getNumber(t,z.DataParser.SCALE_X,1),e.scaleY=G._getNumber(t,z.DataParser.SCALE_Y,1)},G.prototype._parseColorTransform=function(t,e){e.alphaMultiplier=.01*G._getNumber(t,z.DataParser.ALPHA_MULTIPLIER,100),e.redMultiplier=.01*G._getNumber(t,z.DataParser.RED_MULTIPLIER,100),e.greenMultiplier=.01*G._getNumber(t,z.DataParser.GREEN_MULTIPLIER,100),e.blueMultiplier=.01*G._getNumber(t,z.DataParser.BLUE_MULTIPLIER,100),e.alphaOffset=G._getNumber(t,z.DataParser.ALPHA_OFFSET,0),e.redOffset=G._getNumber(t,z.DataParser.RED_OFFSET,0),e.greenOffset=G._getNumber(t,z.DataParser.GREEN_OFFSET,0),e.blueOffset=G._getNumber(t,z.DataParser.BLUE_OFFSET,0)},G.prototype._parseArray=function(t){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0},G.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,r=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,s=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,a=t+e+i+n+r+s;if(z.DragonBones.webAssembly){for(var o=z.webAssemblyModule.HEAP16.buffer,l=z.webAssemblyModule._malloc(a),h=new Int16Array(o,l,this._intArray.length),c=new Float32Array(o,l+t,this._floatArray.length),u=new Int16Array(o,l+t+e,this._frameIntArray.length),_=new Float32Array(o,l+t+e+i,this._frameFloatArray.length),d=new Int16Array(o,l+t+e+i+n,this._frameArray.length),f=new Uint16Array(o,l+t+e+i+n+r,this._timelineArray.length),p=0,m=this._intArray.length;p<m;++p)h[p]=this._intArray[p];for(p=0,m=this._floatArray.length;p<m;++p)c[p]=this._floatArray[p];for(p=0,m=this._frameIntArray.length;p<m;++p)u[p]=this._frameIntArray[p];for(p=0,m=this._frameFloatArray.length;p<m;++p)_[p]=this._frameFloatArray[p];for(p=0,m=this._frameArray.length;p<m;++p)d[p]=this._frameArray[p];for(p=0,m=this._timelineArray.length;p<m;++p)f[p]=this._timelineArray[p];z.webAssemblyModule.setDataBinary(this._data,l,t,e,i,n,r,s)}else{for(o=new ArrayBuffer(a),h=new Int16Array(o,0,this._intArray.length),c=new Float32Array(o,t,this._floatArray.length),u=new Int16Array(o,t+e,this._frameIntArray.length),_=new Float32Array(o,t+e+i,this._frameFloatArray.length),d=new Int16Array(o,t+e+i+n,this._frameArray.length),f=new Uint16Array(o,t+e+i+n+r,this._timelineArray.length),p=0,m=this._intArray.length;p<m;++p)h[p]=this._intArray[p];for(p=0,m=this._floatArray.length;p<m;++p)c[p]=this._floatArray[p];for(p=0,m=this._frameIntArray.length;p<m;++p)u[p]=this._frameIntArray[p];for(p=0,m=this._frameFloatArray.length;p<m;++p)_[p]=this._frameFloatArray[p];for(p=0,m=this._frameArray.length;p<m;++p)d[p]=this._frameArray[p];for(p=0,m=this._timelineArray.length;p<m;++p)f[p]=this._timelineArray[p];this._data.binary=o,this._data.intArray=h,this._data.floatArray=c,this._data.frameIntArray=u,this._data.frameFloatArray=_,this._data.frameArray=d,this._data.timelineArray=f}this._defaultColorOffset=-1},G.prototype.parseDragonBonesData=function(t,e){void 0===e&&(e=1),console.assert(null!=t,"Data error.");var i=G._getString(t,z.DataParser.VERSION,""),n=G._getString(t,z.DataParser.COMPATIBLE_VERSION,"");if(0<=z.DataParser.DATA_VERSIONS.indexOf(i)||0<=z.DataParser.DATA_VERSIONS.indexOf(n)){var r=z.BaseObject.borrowObject(z.DragonBonesData);if(r.version=i,r.name=G._getString(t,z.DataParser.NAME,""),r.frameRate=G._getNumber(t,z.DataParser.FRAME_RATE,24),0===r.frameRate&&(r.frameRate=24),z.DataParser.ARMATURE in t){this._data=r,this._parseArray(t);for(var s=0,a=t[z.DataParser.ARMATURE];s<a.length;s++){var o=a[s];r.addArmature(this._parseArmature(o,e))}this._data.binary||this._modifyArray(),z.DataParser.STAGE in t?r.stage=r.getArmature(G._getString(t,z.DataParser.STAGE,"")):0<r.armatureNames.length&&(r.stage=r.getArmature(r.armatureNames[0])),this._data=null}return z.DataParser.TEXTURE_ATLAS in t&&(this._rawTextureAtlases=t[z.DataParser.TEXTURE_ATLAS]),r}return console.assert(!1,"Nonsupport data version: "+i+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},G.prototype.parseTextureAtlasData=function(t,e,i){if(void 0===i&&(i=1),console.assert(void 0!==t),null===t){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var n=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(n,e,i),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(e.width=G._getNumber(t,z.DataParser.WIDTH,0),e.height=G._getNumber(t,z.DataParser.HEIGHT,0),e.scale=1===i?1/G._getNumber(t,z.DataParser.SCALE,1):i,e.name=G._getString(t,z.DataParser.NAME,""),e.imagePath=G._getString(t,z.DataParser.IMAGE_PATH,""),z.DataParser.SUB_TEXTURE in t)for(var r=t[z.DataParser.SUB_TEXTURE],s=0,a=r.length;s<a;++s){var o=r[s],l=e.createTexture(),h=(l.rotated=G._getBoolean(o,z.DataParser.ROTATED,!1),l.name=G._getString(o,z.DataParser.NAME,""),l.region.x=G._getNumber(o,z.DataParser.X,0),l.region.y=G._getNumber(o,z.DataParser.Y,0),l.region.width=G._getNumber(o,z.DataParser.WIDTH,0),l.region.height=G._getNumber(o,z.DataParser.HEIGHT,0),G._getNumber(o,z.DataParser.FRAME_WIDTH,-1)),c=G._getNumber(o,z.DataParser.FRAME_HEIGHT,-1);0<h&&0<c&&(l.frame=z.TextureData.createRectangle(),l.frame.x=G._getNumber(o,z.DataParser.FRAME_X,0),l.frame.y=G._getNumber(o,z.DataParser.FRAME_Y,0),l.frame.width=h,l.frame.height=c),e.addTexture(l)}return!0},G.getInstance=function(){return G._objectDataParserInstance=null===G._objectDataParserInstance?new G:G._objectDataParserInstance},G._objectDataParserInstance=null,z.ObjectDataParser=G,N=function(){this.frameStart=0,this.actions=[]},z.ActionFrame=N,g=i=i||{},F=g.ObjectDataParser,t(T,F),T.prototype._inRange=function(t,e,i){return e<=t&&t<=i},T.prototype._decodeUTF8=function(t){for(var e=0,i="",n=0,r=0,s=0,a=0;t.length>e;){var o,l,h=t[e++];null!==(l=-1===h?0!==r?65533:-1:0===r?this._inRange(h,0,127)?h:(this._inRange(h,194,223)?(r=1,a=128,n=h-192):this._inRange(h,224,239)?(r=2,a=2048,n=h-224):this._inRange(h,240,244)&&(r=3,a=65536,n=h-240),n*=Math.pow(64,r),null):this._inRange(h,128,191)?(s+=1,n+=(h-128)*Math.pow(64,r-s),s!==r?null:(o=n,l=a,a=s=r=n=0,this._inRange(o,l,1114111)&&!this._inRange(o,55296,57343)?o:h)):(a=s=r=n=0,e--,h))&&-1!==l&&(l<=65535?0<l&&(i+=String.fromCharCode(l)):(l-=65536,i=(i+=String.fromCharCode(55296+(l>>10&1023)))+String.fromCharCode(56320+(1023&l))))}return i},T.prototype._getUTF16Key=function(t){for(var e=0,i=t.length;e<i;++e)if(255<t.charCodeAt(e))return encodeURI(t);return t},T.prototype._parseBinaryTimeline=function(t,e,i){var n=null!==(i=void 0===i?null:i)?i:g.BaseObject.borrowObject(g.TimelineData),r=(n.type=t,n.offset=e,this._timeline=n,this._timelineArrayBuffer[n.offset+2]);if(1===r)n.frameIndicesOffset=-1;else{var s=0,a=this._animation.frameCount+1,o=this._data.frameIndices;g.DragonBones.webAssembly?(s=o.size(),o.resize(s+a,0)):(s=o.length,o.length+=a),n.frameIndicesOffset=s;for(var l=0,h=0,c=0,u=0;l<a;++l)c+u<=l&&h<r&&(c=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+h]],u=h===r-1?this._animation.frameCount-c:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+h+1]]-c,h++),g.DragonBones.webAssembly?o.set(s+l,h-1):o[s+l]=h-1}return this._timeline=null,n},T.prototype._parseVertices=function(t,e){e.offset=t[g.DataParser.OFFSET];var i=this._intArrayBuffer[e.offset+3];if(0<=i){var n=g.BaseObject.borrowObject(g.WeightData),t=this._intArrayBuffer[e.offset+0],r=this._intArrayBuffer[i+0];n.offset=i;for(var s=0;s<r;++s){var a=this._intArrayBuffer[i+2+s];n.addBone(this._rawBones[a])}for(var o=i+2+r,l=0,h=(s=0,t);s<h;++s){var c=this._intArrayBuffer[o++];l+=c,o+=c}n.count=l,e.weight=n}},T.prototype._parseMesh=function(t,e){this._parseVertices(t,e.vertices)},T.prototype._parsePath=function(t,e){this._parseVertices(t,e.vertices)},T.prototype._parseAnimation=function(t){var e=g.BaseObject.borrowObject(g.AnimationData),i=(e.frameCount=Math.max(g.ObjectDataParser._getNumber(t,g.DataParser.DURATION,1),1),e.playTimes=g.ObjectDataParser._getNumber(t,g.DataParser.PLAY_TIMES,1),e.duration=e.frameCount/this._armature.frameRate,e.fadeInTime=g.ObjectDataParser._getNumber(t,g.DataParser.FADE_IN_TIME,0),e.scale=g.ObjectDataParser._getNumber(t,g.DataParser.SCALE,1),e.name=g.ObjectDataParser._getString(t,g.DataParser.NAME,g.DataParser.DEFAULT_NAME),0===e.name.length&&(e.name=g.DataParser.DEFAULT_NAME),t[g.DataParser.OFFSET]);if(e.frameIntOffset=i[0],e.frameFloatOffset=i[1],e.frameOffset=i[2],this._animation=e,g.DataParser.ACTION in t&&(e.actionTimeline=this._parseBinaryTimeline(0,t[g.DataParser.ACTION])),g.DataParser.Z_ORDER in t&&(e.zOrderTimeline=this._parseBinaryTimeline(1,t[g.DataParser.Z_ORDER])),g.DataParser.BONE in t){var n=t[g.DataParser.BONE];for(u in n){var r=n[u],s=(g.DragonBones.webAssembly&&(u=this._getUTF16Key(u)),this._armature.getBone(u));if(null!==s)for(var a=0,o=r.length;a<o;a+=2){var l=r[a],h=r[a+1],c=this._parseBinaryTimeline(l,h);this._animation.addBoneTimeline(s,c)}}}if(g.DataParser.SURFACE in t)for(var u in n=t[g.DataParser.SURFACE]){r=n[u],g.DragonBones.webAssembly&&(u=this._getUTF16Key(u));var _=this._armature.getBone(u);if(null!==_)for(a=0,o=r.length;a<o;a+=2)l=r[a],h=r[a+1],c=this._parseBinaryTimeline(l,h),this._animation.addSurfaceTimeline(_,c)}if(g.DataParser.SLOT in t)for(var u in n=t[g.DataParser.SLOT]){r=n[u],g.DragonBones.webAssembly&&(u=this._getUTF16Key(u));var d=this._armature.getSlot(u);if(null!==d)for(a=0,o=r.length;a<o;a+=2)l=r[a],h=r[a+1],c=this._parseBinaryTimeline(l,h),this._animation.addSlotTimeline(d,c)}if(g.DataParser.CONSTRAINT in t)for(var u in n=t[g.DataParser.CONSTRAINT]){r=n[u],g.DragonBones.webAssembly&&(u=this._getUTF16Key(u));var f=this._armature.getConstraint(u);if(null!==f)for(a=0,o=r.length;a<o;a+=2)l=r[a],h=r[a+1],c=this._parseBinaryTimeline(l,h),this._animation.addConstraintTimeline(f,c)}if(g.DataParser.ANIMATION in t)for(var u in n=t[g.DataParser.ANIMATION])for(r=n[u],g.DragonBones.webAssembly&&(u=this._getUTF16Key(u)),a=0,o=r.length;a<o;a+=2)l=r[a],h=r[a+1],c=this._parseBinaryTimeline(l,h),this._animation.addAnimationTimeline(u,c);return this._animation=null,e},T.prototype._parseArray=function(t){var t=t[g.DataParser.OFFSET],e=t[1],i=t[3],n=t[5],r=t[7],s=t[9],a=t[11],o=new Int16Array(this._binary,this._binaryOffset+t[0],e/Int16Array.BYTES_PER_ELEMENT),l=new Float32Array(this._binary,this._binaryOffset+t[2],i/Float32Array.BYTES_PER_ELEMENT),h=new Int16Array(this._binary,this._binaryOffset+t[4],n/Int16Array.BYTES_PER_ELEMENT),c=new Float32Array(this._binary,this._binaryOffset+t[6],r/Float32Array.BYTES_PER_ELEMENT),u=new Int16Array(this._binary,this._binaryOffset+t[8],s/Int16Array.BYTES_PER_ELEMENT),t=new Uint16Array(this._binary,this._binaryOffset+t[10],a/Uint16Array.BYTES_PER_ELEMENT);if(g.DragonBones.webAssembly){for(var _=e+i+n+r+s+a,d=g.webAssemblyModule._malloc(_),f=new Uint8Array(this._binary,this._binaryOffset,_/Uint8Array.BYTES_PER_ELEMENT),p=new Uint8Array(g.webAssemblyModule.HEAP16.buffer,d,f.length),m=0,y=f.length;m<y;++m)p[m]=f[m];g.webAssemblyModule.setDataBinary(this._data,d,e,i,n,r,s,a),this._intArrayBuffer=o,this._floatArrayBuffer=l,this._frameIntArrayBuffer=h,this._frameFloatArrayBuffer=c,this._frameArrayBuffer=u,this._timelineArrayBuffer=t}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=o,this._data.floatArray=this._floatArrayBuffer=l,this._data.frameIntArray=this._frameIntArrayBuffer=h,this._data.frameFloatArray=this._frameFloatArrayBuffer=c,this._data.frameArray=this._frameArrayBuffer=u,this._data.timelineArray=this._timelineArrayBuffer=t},T.prototype.parseDragonBonesData=function(t,e){void 0===e&&(e=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var i=new Uint8Array(t,0,8);if(i[0]!=="D".charCodeAt(0)||i[1]!=="B".charCodeAt(0)||i[2]!=="D".charCodeAt(0)||i[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var i=new Uint32Array(t,8,1)[0],n=new Uint8Array(t,12,i),n=this._decodeUTF8(n),n=JSON.parse(n);return this._binaryOffset=12+i,this._binary=t,F.prototype.parseDragonBonesData.call(this,n,e)},T.getInstance=function(){return T._binaryDataParserInstance=null===T._binaryDataParserInstance?new T:T._binaryDataParserInstance},T._binaryDataParserInstance=null,g.BinaryDataParser=T,function(m){function s(t){void 0===t&&(t=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,(this._dataParser=null)===s._objectParser&&(s._objectParser=new m.ObjectDataParser),null===s._binaryParser&&(s._binaryParser=new m.BinaryDataParser),this._dataParser=null!==t?t:s._objectParser}s.prototype._isSupportMesh=function(){return!0},s.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,n=this._textureAtlasDataMap[t];i<n.length;i++)if(null!==(l=(o=n[i]).getTexture(e)))return l;if(this.autoSearch)for(var r in this._textureAtlasDataMap)for(var s=0,a=this._textureAtlasDataMap[r];s<a.length;s++){var o,l;if((o=a[s]).autoSearch&&null!==(l=o.getTexture(e)))return l}return null},s.prototype._fillBuildArmaturePackage=function(t,e,i,n,r){var s=null,a=null;if(null===(a=0<e.length&&e in this._dragonBonesDataMap?(s=this._dragonBonesDataMap[e]).getArmature(i):a)&&(0===e.length||this.autoSearch))for(var o in this._dragonBonesDataMap)if(s=this._dragonBonesDataMap[o],(0===e.length||s.autoSearch)&&null!==(a=s.getArmature(i))){e=o;break}if(null===a)return!1;if(t.dataName=e,t.textureAtlasName=r,t.data=s,t.armature=a,t.skin=null,0<n.length&&(t.skin=a.getSkin(n),null===t.skin&&this.autoSearch))for(var o in this._dragonBonesDataMap){var l=this._dragonBonesDataMap[o].getArmature(n);if(null!==l){t.skin=l.defaultSkin;break}}return null===t.skin&&(t.skin=a.defaultSkin),!0},s.prototype._buildBones=function(t,e){for(var i=0,n=t.armature.sortedBones;i<n.length;i++){var r=n[i];m.BaseObject.borrowObject(0===r.type?m.Bone:m.Surface).init(r,e)}},s.prototype._buildSlots=function(t,e){var i=t.skin,n=t.armature.defaultSkin;if(null!==i&&null!==n){var r={};for(a in n.displays){var s=n.getDisplays(a);r[a]=s}if(i!==n)for(var a in i.displays)s=i.getDisplays(a),r[a]=s;for(var o=0,l=t.armature.sortedSlots;o<l.length;o++){var h=l[o],c=h.name in r?r[h.name]:null,u=this._buildSlot(t,h,e);if(null!==(u.rawDisplayDatas=c)){for(var _=new Array,d=0,f=m.DragonBones.webAssembly?c.size():c.length;d<f;++d){var p=m.DragonBones.webAssembly?c.get(d):c[d];null!==p?_.push(this._getSlotDisplay(t,p,null,u)):_.push(null)}u._setDisplayList(_)}u._setDisplayIndex(h.displayIndex,!0)}}},s.prototype._buildConstraints=function(t,e){var i,n=t.armature.constraints;for(i in n){var r=n[i];switch(r.type){case 0:var s=m.BaseObject.borrowObject(m.IKConstraint);s.init(r,e),e._addConstraint(s);break;case 1:s=m.BaseObject.borrowObject(m.PathConstraint);s.init(r,e),e._addConstraint(s);break;default:var a=m.BaseObject.borrowObject(m.IKConstraint);a.init(r,e),e._addConstraint(a)}}},s.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},s.prototype._getSlotDisplay=function(t,e,i,n){var r=null!==t?t.dataName:e.parent.parent.parent.name,s=null;switch(e.type){case 0:var a=e;null!==t&&0<t.textureAtlasName.length&&(a.texture=this._getTextureData(t.textureAtlasName,e.path)),null===a.texture&&(a.texture=this._getTextureData(r,e.path)),s=null!==i&&2===i.type&&this._isSupportMesh()?n.meshDisplay:n.rawDisplay;break;case 2:a=e;null!==t&&0<t.textureAtlasName.length&&(a.texture=this._getTextureData(t.textureAtlasName,a.path)),null===a.texture&&(a.texture=this._getTextureData(r,a.path)),s=this._isSupportMesh()?n.meshDisplay:n.rawDisplay;break;case 1:var a=e,o=this._buildChildArmature(t,n,e);if(null!==o){if(o.inheritAnimation=a.inheritAnimation,!o.inheritAnimation){var l=0<a.actions.length?a.actions:o.armatureData.defaultActions;if(0<l.length)for(var h=0,c=l;h<c.length;h++){var u=c[h],_=m.BaseObject.borrowObject(m.EventObject);m.EventObject.actionDataToInstance(u,_,n.armature),(_.slot=n).armature._bufferAction(_,!1)}else o.animation.play()}a.armature=o.armatureData}s=o}return s},s.prototype.parseDragonBonesData=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=1);for(var n=t instanceof ArrayBuffer?s._binaryParser:this._dataParser,t=n.parseDragonBonesData(t,i);;){var r=this._buildTextureAtlasData(null,null);if(!n.parseTextureAtlasData(null,r,i)){r.returnToPool();break}this.addTextureAtlasData(r,e)}return null!==t&&this.addDragonBonesData(t,e),t},s.prototype.parseTextureAtlasData=function(t,e,i,n){void 0===i&&(i=null),void 0===n&&(n=1);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,n),this._buildTextureAtlasData(r,e||null),this.addTextureAtlasData(r,i),r},s.prototype.updateTextureAtlasData=function(t,e){var i=this.getTextureAtlasData(t);if(null!==i)for(var n=0,r=i.length;n<r;++n)n<e.length&&this._buildTextureAtlasData(i[n],e[n])},s.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},s.prototype.addDragonBonesData=function(t,e){(e=null!==(e=void 0===e?null:e)?e:t.name)in this._dragonBonesDataMap?this._dragonBonesDataMap[e]!==t&&console.warn("Can not add same name data: "+e):this._dragonBonesDataMap[e]=t},s.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},s.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},s.prototype.addTextureAtlasData=function(t,e){e=(e=null!==(e=void 0===e?null:e)?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];e.indexOf(t)<0&&e.push(t)},s.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var n=0,r=i;n<r.length;n++){var s=r[n];this._dragonBones.bufferObject(s)}delete this._textureAtlasDataMap[t]}},s.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var i=new a;return this._fillBuildArmaturePackage(i,e,t,"","")?i.armature:null},s.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=0,n=this._textureAtlasDataMap[e];i<n.length;i++){var r=n[i];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[e]}},s.prototype.buildArmature=function(t,e,i,n){void 0===e&&(e=""),void 0===i&&(i=""),void 0===n&&(n="");var r=new a;if(!this._fillBuildArmaturePackage(r,e||"",t,i||"",n||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;i=this._buildArmature(r);return this._buildBones(r,i),this._buildSlots(r,i),this._buildConstraints(r,i),i.invalidUpdate(null,!0),i.advanceTime(0),i},s.prototype.replaceDisplay=function(t,e,i){(i=void 0===i?-1:i)<0&&(i=t.displayIndex),t.replaceDisplayData(e,i=i<0?0:i);var n,r,s=t.displayList;if(s.length<=i){s.length=i+1;for(var a=0,o=s.length;a<o;++a)s[a]||(s[a]=null)}null!==e?(r=null,(n=t.rawDisplayDatas)&&(m.DragonBones.webAssembly?i<n.size()&&(r=n.get(i)):i<n.length&&(r=n[i])),s[i]=this._getSlotDisplay(null,e,r,t)):s[i]=null,t.displayList=s},s.prototype.replaceSlotDisplay=function(t,e,i,n,r,s){void 0===s&&(s=-1);e=this.getArmatureData(e,t||"");if(!e||!e.defaultSkin)return!1;t=e.defaultSkin.getDisplay(i,n);return!!t&&(this.replaceDisplay(r,t,s),!0)},s.prototype.replaceSlotDisplayList=function(t,e,i,n){e=this.getArmatureData(e,t||"");if(!e||!e.defaultSkin)return!1;var r=e.defaultSkin.getDisplays(i);if(!r)return!1;for(var s=0,a=0,o=m.DragonBones.webAssembly?r.size():r.length;a<o;++a){var l=m.DragonBones.webAssembly?r.get(a):r[a];this.replaceDisplay(n,l,s++)}return!0},s.prototype.replaceSkin=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=null);for(var r=!1,s=e.parent.defaultSkin,a=0,o=t.getSlots();a<o.length;a++){var l=o[a];if(!(null!==n&&0<=n.indexOf(l.name))){var h=e.getDisplays(l.name);if(h||(h=null!==s&&e!==s?s.getDisplays(l.name):h)){for(var c=m.DragonBones.webAssembly?h.size():h.length,u=l.displayList,_=0,d=u.length=c;_<d;++_){var f=m.DragonBones.webAssembly?h.get(_):h[_];u[_]=null!==f?this._getSlotDisplay(null,f,null,l):null}r=!0,l.rawDisplayDatas=h,l.displayList=u}else i&&(l.rawDisplayDatas=null,l.displayList=[])}}return r},s.prototype.replaceAnimation=function(t,e,i){var n=e.defaultSkin;if(null===n)return!1;if(i=void 0===i?!0:i)t.animation.animations=e.animations;else{var r,s=t.animation.animations,a={};for(r in s)a[r]=s[r];for(r in e.animations)a[r]=e.animations[r];t.animation.animations=a}for(var o=0,l=t.getSlots();o<l.length;o++)for(var h=l[o],c=0,u=0,_=h.displayList;u<_.length;u++){var d,f=_[u];f instanceof m.Armature&&(null!==(d=n.getDisplays(h.name))&&c<(m.DragonBones.webAssembly?d.size():d.length)&&null!==(d=m.DragonBones.webAssembly?d.get(c):d[c])&&1===d.type&&(d=this.getArmatureData(d.path,d.parent.parent.parent.name))&&this.replaceAnimation(f,d,i)),c++}return!0},s.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},s.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(s.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),s.prototype.changeSkin=function(t,e,i){return this.replaceSkin(t,e,!1,i=void 0===i?null:i)},s.prototype.copyAnimationsToArmature=function(t,e,i,n,r){void 0===i&&(i=""),void 0===r&&(r=!0);i=this.getArmatureData(e,n=void 0===n?"":n);return!!i&&this.replaceAnimation(t,i,r)},s._objectParser=null,s._binaryParser=null,m.BaseFactory=s;var a=function(){this.dataName="",this.textureAtlasName="",this.skin=null};m.BuildArmaturePackage=a}(i=i||{}),R.exports=i},{}],415:[function(t,c,e){"use strict";e.__esModule=!0,e.default=void 0;var i=n(t("../../cocos2d/core/renderer/assembler")),v=n(t("../../cocos2d/core/value-types/mat4"));function n(t){return t&&t.__esModule?t:{default:t}}var d,f,p,m,y,D,B,I,P,g,R,O,L,F,V,N,k,z,r,u,s,a,G,U,j,W,H,X,Y,_=t("./ArmatureDisplay"),b=t("../../cocos2d/core/renderer/render-flow"),x=cc.gfx,A=cc.color(255,0,0,255),C=cc.color(0,0,255,255),T=cc.color(0,255,0,255);function J(t,e){if(!t)return null;var i,n;switch(e){case 1:i=y?cc.macro.ONE:cc.macro.SRC_ALPHA,n=cc.macro.ONE;break;case 10:i=cc.macro.DST_COLOR,n=cc.macro.ONE_MINUS_SRC_ALPHA;break;case 12:i=cc.macro.ONE,n=cc.macro.ONE_MINUS_SRC_COLOR;break;default:i=y?cc.macro.ONE:cc.macro.SRC_ALPHA,n=cc.macro.ONE_MINUS_SRC_ALPHA}var e=!g.enableBatch,r=g._materials[0];if(!r)return null;var s=g._materialCache,a=t.getId()+i+n+e,o=s[a];return o||(s.baseMaterial?o=cc.MaterialVariant.create(r):s.baseMaterial=o=r,o.define("CC_USE_MODEL",e),o.setProperty("texture",t),o.setBlend(!0,x.BLEND_FUNC_ADD,i,n,x.BLEND_FUNC_ADD,i,n),s[a]=o),o}function q(t,e){a=t.a*e*m,s=y?a/255:1,r=t.r*d*s,u=t.g*f*s,s=t.b*p*s,z=(a<<24>>>0)+(s<<16)+(u<<8)+r}o=i.default,t=o,(l=h).prototype=Object.create(t.prototype),(l.prototype.constructor=l).__proto__=t,(l=h.prototype).updateRenderData=function(t,e){},l.realTimeTraverse=function(t,e,i){for(var n,r,s,a,o,l,h,c,u=t._slots,_=0,d=u.length;_<d;_++)if(c=(l=u[_])._color,l._visible&&l._displayData)if(e?l._mulMat(l._worldMatrix,e,l._matrix):v.default.copy(l._worldMatrix,l._matrix),l.childArmature)this.realTimeTraverse(l.childArmature,l._worldMatrix,i*c.a/255);else if(h=J(l.getTexture(),l._blendMode)){!D&&h.getHash()===P.material.getHash()||(D=!1,P._flush(),P.node=I,P.material=h),q(c,i),h=l._worldMatrix.m,a=l._localVertices,F=a.length>>2,o=l._indices,V=o.length,c=B.request(F,V),O=c.indiceOffset,R=c.byteOffset>>2,L=c.vertexOffset,n=B._vData,r=B._iData,s=B._uintVData,U=h[0],j=h[4],W=h[12],H=h[1],X=h[5],Y=h[13];for(var f=0,p=a.length;f<p;)N=a[f++],k=a[f++],n[R++]=N*U+k*j+W,n[R++]=N*H+k*X+Y,n[R++]=a[f++],n[R++]=a[f++],s[R++]=z;for(var m=0,y=o.length;m<y;m++)r[O++]=L+o[m]}},l.cacheTraverse=function(t,e){if(t){var i=t.segments;if(0!=i.length){var n=t.vertices,r=t.indices,s=0,a=0,o=(e&&(e=e.m,U=e[0],H=e[1],j=e[4],X=e[5],W=e[12],Y=e[13]),16&G),l=o&&1===U&&0===H&&0===j&&1===X,h=0,c=t.colors,u=c[h++],_=u.vfOffset;q(u,1);for(var d=0,f=i.length;d<f;d++){var p=i[d],m=J(p.tex,p.blendMode);!D&&m.getHash()===P.material.getHash()||(D=!1,P._flush(),P.node=I,P.material=m),F=p.vertexCount,V=p.indexCount,m=B.request(F,V),O=m.indiceOffset,L=m.vertexOffset,R=m.byteOffset>>2;for(var y=B._vData,g=B._iData,v=B._uintVData,b=O,x=O+V;b<x;b++)g[b]=L+r[a++];if(m=p.vfCount,y.set(n.subarray(s,s+m),R),s+=m,l)for(var A=R,C=R+m;A<C;A+=5)y[A]+=W,y[A+1]+=Y;else if(o)for(var T=R,S=R+m;T<S;T+=5)N=y[T],k=y[T+1],y[T]=N*U+k*j+W,y[T+1]=N*H+k*X+Y;if(1&G)for(var w=s-m,E=R+4,M=R+4+m;E<M;E+=5,w+=5)_<=w&&(q(u=c[h++],1),_=u.vfOffset),v[E]=z}}}},l.fillBuffers=function(t,e){t.node._renderFlag|=b.FLAG_UPDATE_RENDER_DATA;var i=t._armature;if(i){D=!0,y=t.premultipliedAlpha,I=t.node,B=e._meshBuffer,P=e,g=t,G=0;var n=I._color,n=(d=n.r/255,f=n.g/255,p=n.b/255,m=n.a/255,4294967295!==n._val&&(G|=1),void 0);if(g.enableBatch&&(n=I._worldMatrix,D=!1,G|=16),t.isAnimationCached())this.cacheTraverse(t._curFrame,n);else{this.realTimeTraverse(i,n,1);var r=t._debugDraw;if(t.debugBones&&r){r.clear(),r.lineWidth=5,r.strokeColor=A,r.fillColor=C;for(var s=i.getBones(),a=0,o=s.length;a<o;a++){var l=s[a],h=Math.max(l.boneData.length,5),c=l.globalTransformMatrix.tx,u=l.globalTransformMatrix.ty,_=c+l.globalTransformMatrix.a*h,l=u+l.globalTransformMatrix.b*h;r.moveTo(c,u),r.lineTo(_,l),r.stroke(),r.circle(c,u,2*Math.PI),r.fill(),0===a&&(r.fillColor=T)}}}e.worldMatDirty++,t.attachUtil._syncAttachedNode(),g=P=B=I=void 0}},l.postFillBuffers=function(t,e){e.worldMatDirty--};var o,l,t=h;function h(){return o.apply(this,arguments)||this}e.default=t,i.default.register(_,t),c.exports=e.default},{"../../cocos2d/core/renderer/assembler":259,"../../cocos2d/core/renderer/render-flow":263,"../../cocos2d/core/value-types/mat4":332,"./ArmatureDisplay":405}],416:[function(t,e,i){"use strict";function n(){}function l(t){Object.defineProperty(t,"_worldMatDirty",{get:function(){return!0},set:function(t){}}),t._calculWorldMatrix=n,t._mulMat=n}var d=(r=t("../../cocos2d/core/value-types/mat4"))&&r.__esModule?r:{default:r},f=t("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM,p=new d.default,r=cc.Class({name:"sp.AttachUtil",ctor:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._attachedRootNode=null,this._attachedNodeArray=[],this._boneIndexToNode={}},init:function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},reset:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},_prepareAttachNode:function(){var t;if(this._skeleton)return(t=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE"))&&t.isValid||(t=new cc.Node("ATTACHED_NODE_TREE"),l(t),this._skeletonNode.addChild(t)),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=t},_buildBoneAttachedNode:function(t,e){var i="ATTACHED_NODE:"+t.data.name,i=new cc.Node(i);return this._buildBoneRelation(i,t,e),i},_buildBoneRelation:function(t,e,i){l(t),t._bone=e,t._boneIndex=i,this._attachedNodeArray.push(t),this._boneIndexToNode[i]=t},getAttachedRootNode:function(){return this._attachedRootNode},getAttachedNodes:function(t){var e=this._attachedNodeArray,i=[];if(this._inited)for(var n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&s.name==="ATTACHED_NODE:"+t&&i.push(s)}return i},_rebuildNodeArray:function(){for(var t=this._boneIndexToNode={},e=this._attachedNodeArray,i=this._attachedNodeArray=[],n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&!s._toRemove&&(i.push(s),t[s._boneIndex]=s)}},_sortNodeArray:function(){this._attachedNodeArray.sort(function(t,e){return t._boneIndex<e._boneIndex?-1:1})},_getNodeByBoneIndex:function(t){t=this._boneIndexToNode[t];return t&&t.isValid?t:null},destroyAttachedNodes:function(t){if(this._inited){for(var e=this._attachedNodeArray,i=function t(e){for(var i=e.children,n=0,r=i.length;n<r;n++){var s=i[n];s&&t(s)}e._toRemove=!0},n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&s.name.split("ATTACHED_NODE:")[1]===t&&(i(s),s.removeFromParent(!0),s.destroy(),e[n]=null)}this._rebuildNodeArray()}},generateAttachedNodes:function(t){var e=[];if(!this._inited)return e;var n=this._prepareAttachNode();if(!n)return e;for(var i=[],r=this._skeleton.bones,s=0,a=r.length;s<a;s++){var o=r[s];o.data.name==t&&i.push(o)}for(var l=function(t){if(t){var e=t.data;if(i=this._getNodeByBoneIndex(e.index))return i;var i=this._buildBoneAttachedNode(t,e.index),e=l(t.parent)||n;return i.parent=e,i}}.bind(this),h=0,c=i.length;h<c;h++){var u=l(i[h]);e.push(u)}return this._sortNodeArray(),e},destroyAllAttachedNodes:function(){var t;this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},this._inited&&(t=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE"))&&(t.removeFromParent(!0),t.destroy())},generateAllAttachedNodes:function(){if(this._inited){this._boneIndexToNode={},this._attachedNodeArray.length=0;var t=this._prepareAttachNode();if(t){for(var e=this._skeleton.bones,i=0,n=e.length;i<n;i++){var r,s=e[i],a=s.data,o=null;(o=s.parent?(r=s.parent.data.index,this._boneIndexToNode[r]):t)&&((r=o.getChildByName("ATTACHED_NODE:"+a.name))&&r.isValid?this._buildBoneRelation(r,s,a.index):(r=this._buildBoneAttachedNode(s,a.index),o.addChild(r)))}return t}}},_hasAttachedNode:function(){return!!this._inited&&!!this._skeletonNode.getChildByName("ATTACHED_NODE_TREE")},_associateAttachedNode:function(){if(this._inited){var t=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");if(t&&t.isValid){this._attachedRootNode=t,this._boneIndexToNode={},this._attachedNodeArray.length=0,l(t),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo();for(var e=this._skeleton.bones,i=0,n=e.length;i<n;i++){var r,s=e[i],a=s.data,o=null;!(o=s.parent?(r=s.parent.data.index,this._boneIndexToNode[r]):t)||(r=o.getChildByName("ATTACHED_NODE:"+a.name))&&r.isValid&&this._buildBoneRelation(r,s,a.index)}}}},_syncAttachedNode:function(){if(this._inited){var t=this._attachedRootNode,e=this._attachedNodeArray;if(!t||!t.isValid)return this._attachedRootNode=null,void(e.length=0);var i,n=this._skeletonNode._worldMatrix;d.default.copy(t._worldMatrix,n),t._renderFlag&=~f;if(i=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones){for(var r=this._skeletonNode._mulMat,s=!1,a=0,o=e.length;a<o;a++){var l=e[a];l&&l.isValid?(u=i[l._boneIndex])?(h=l._worldMatrix,c=t._worldMatrix,u=u,_=void 0,(_=p.m)[0]=u.a,_[1]=u.c,_[4]=u.b,_[5]=u.d,_[12]=u.worldX,_[13]=u.worldY,r(h,c,p),l._renderFlag&=~f):(l.removeFromParent(!0),l.destroy(),s=!(e[a]=null)):s=!(e[a]=null)}s&&this._rebuildNodeArray()}}var h,c,u,_}});e.exports=sp.AttachUtil=r},{"../../cocos2d/core/renderer/render-flow":263,"../../cocos2d/core/value-types/mat4":332}],417:[function(t,e,i){"use strict";var n=t("./track-entry-listeners"),r=t("../../cocos2d/core/components/CCRenderComponent"),s=t("./lib/spine"),a=t("../../cocos2d/core/graphics/graphics"),o=t("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER,l=t("./skeleton-cache"),h=t("./AttachUtil"),t=cc.Enum({default:-1}),c=cc.Enum({"<None>":0}),u=cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2});sp.Skeleton=cc.Class({name:"sp.Skeleton",extends:r,editor:!1,statics:{AnimationCacheMode:u},properties:{paused:{default:!1,visible:!1},skeletonData:{default:null,type:sp.SkeletonData,notify:function(){this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData()},tooltip:!1},defaultSkin:{default:"",visible:!1},defaultAnimation:{default:"",visible:!1},animation:{get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){(this.defaultAnimation=t)?this.setAnimation(0,t,this.loop):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())},visible:!1},_defaultSkinIndex:{get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0}else{t=t[this.defaultSkin];if(void 0!==t)return t}}return 0},set:function(t){if(!(e=this.skeletonData?this.skeletonData.getSkinsEnum():e))return cc.errorID("",this.name);var e=e[t];void 0!==e?(this.defaultSkin=e,this.setSkin(this.defaultSkin)):cc.errorID(7501,this.name)},type:t,visible:!0,displayName:"Default Skin",tooltip:!1},_animationIndex:{get:function(){var t=this.animation;if(this.skeletonData&&t){var e=this.skeletonData.getAnimsEnum();if(e){e=e[t];if(void 0!==e)return e}}return 0},set:function(t){if(0!==t){if(!(e=this.skeletonData?this.skeletonData.getAnimsEnum():e))return cc.errorID(7502,this.name);var e=e[t];void 0!==e?this.animation=e:cc.errorID(7503,this.name)}else this.animation=""},type:c,visible:!0,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:u.REALTIME,_defaultCacheMode:{default:0,type:u,notify:function(){this.setAnimationCacheMode(this._defaultCacheMode)},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},loop:{default:!0,tooltip:!1},premultipliedAlpha:{default:!0,tooltip:!1},timeScale:{default:1,tooltip:!1},debugSlots:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugBones:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugMesh:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},useTint:{default:!1,tooltip:!1,notify:function(){this._updateUseTint()}},enableBatch:{default:!1,notify:function(){this._updateBatch()},tooltip:!1},_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_skeletonCache:null,_animationName:"",_animationQueue:[],_headAniInfo:null,_playTimes:0,_isAniComplete:!0},ctor:function(){this._effectDelegate=null,this._skeleton=null,this._rootBone=null,this._listener=null,this._materialCache={},this._debugRenderer=null,this._startSlotIndex=-1,this._endSlotIndex=-1,this._startEntry={animation:{name:""},trackIndex:0},this._endEntry={animation:{name:""},trackIndex:0},this.attachUtil=new h},_getDefaultMaterial:function(){return cc.Material.getBuiltinMaterial("2d-spine")},_updateMaterial:function(){var t=this.useTint||this.isAnimationCached()&&!0,e=this.getMaterial(0);e&&(e.define("USE_TINT",t),e.define("CC_USE_MODEL",!this.enableBatch)),this._materialCache={}},disableRender:function(){this._super(),this.node._renderFlag&=~o},markForRender:function(t){this._super(t),t?this.node._renderFlag|=o:this.node._renderFlag&=~o},_updateUseTint:function(){var t,e=this.getMaterial(0);e&&(t=this.useTint||this.isAnimationCached()&&!0,e.define("USE_TINT",t)),this._materialCache={}},_updateBatch:function(){var t=this.getMaterial(0);t&&t.define("CC_USE_MODEL",!this.enableBatch),this._materialCache={}},_validateRender:function(){var t=this.skeletonData;t&&t.isTexturesLoaded()?this._super():this.disableRender()},setSkeletonData:function(t){var e;null!=t.width&&null!=t.height&&this.node.setContentSize(t.width,t.height),this._cacheMode===u.SHARED_CACHE?this._skeletonCache=l.sharedCache:this._cacheMode===u.PRIVATE_CACHE&&(this._skeletonCache=new l,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()?((this.debugBones||this.debugSlots)&&cc.warn("Debug bones or slots is invalid in cached mode"),e=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t),this._skeleton=e.skeleton,this._clipper=e.clipper):(this._skeleton=new s.Skeleton(t),this._clipper=new s.SkeletonClipping),this._rootBone=this._skeleton.getRootBone(),this.markForRender(!0)},setSlotsRange:function(t,e){this.isAnimationCached()?cc.warn("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},setAnimationStateData:function(t){this.isAnimationCached()?cc.warn("'setAnimationStateData' interface can not be invoked in cached mode."):(t=new s.AnimationState(t),this._listener&&(this._state&&this._state.removeListener(this._listener),t.addListener(this._listener)),this._state=t)},__preload:function(){this._super();for(var t=this.node.children,e=0,i=t.length;e<i;e++){var n=t[e];n&&"DEBUG_DRAW_NODE"===n._name&&n.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._updateBatch()},setAnimationCacheMode:function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._updateSkeletonData(),this._updateUseTint())},isAnimationCached:function(){return this._cacheMode!==u.REALTIME},update:function(t){if(!this.paused)if(t*=this.timeScale*sp.timeScale,this.isAnimationCached()){var e;if(this._isAniComplete)return 0!==this._animationQueue.length||this._headAniInfo?(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,void(this._accTime>this._headAniInfo.delay&&(e=this._headAniInfo,this._headAniInfo=null,this.setAnimation(0,e.animationName,e.loop)))):void((e=this._frameCache)&&e.isInvalid()&&(e.updateToFrame(),e=e.frames,this._curFrame=e[e.length-1]));this._updateCache(t)}else this._updateRealtime(t)},_emitCacheCompleteEvent:function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},_updateCache:function(t){var e=this._frameCache;if(e.isInited()){var i=e.frames,n=l.FrameTime,t=(0==this._accTime&&0==this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t,Math.floor(this._accTime/n));if(e.isCompleted||e.updateToFrame(t),e.isCompleted&&t>=i.length){if(this._playCount++,0<this._playTimes&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();t=this._accTime=0,this._emitCacheCompleteEvent()}this._curFrame=i[t]}},_updateRealtime:function(t){var e=this._skeleton,i=this._state;e&&(e.update(t),i&&(i.update(t),i.apply(e)))},setVertexEffectDelegate:function(t){this._effectDelegate=t},updateWorldTransform:function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton&&this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},updateAnimationCache:function(t){var e;this.isAnimationCached()&&(e=this.skeletonData._uuid,this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t))},invalidAnimationCache:function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this.skeletonData._uuid)},findBone:function(t){return this._skeleton?this._skeleton.findBone(t):null},findSlot:function(t){return this._skeleton?this._skeleton.findSlot(t):null},setSkin:function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},getAttachment:function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},setAttachment:function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},getTextureAtlas:function(t){return t.region},setMix:function(t,e,i){this._state&&this._state.data.setMix(t,e,i)},setAnimation:function(t,e,i){if(this._playTimes=i?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&cc.warn("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var n=this._skeletonCache.getAnimationCache(this.skeletonData._uuid,e);(n=n||this._skeletonCache.initAnimationCache(this.skeletonData._uuid,e))&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=n,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){n=this._skeleton.data.findAnimation(e);if(!n)return cc.logID(7509,e),null;e=this._state.setAnimationWith(t,n,i);return this._state.apply(this._skeleton),e}return null},addAnimation:function(t,e,i,n){var r;if(n=n||0,this.isAnimationCached())0!==t&&cc.warn("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:i,delay:n});else if(this._skeleton)return(r=this._skeleton.data.findAnimation(e))?this._state.addAnimationWith(t,r,i,n):(cc.logID(7510,e),null);return null},findAnimation:function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},getCurrent:function(t){if(this.isAnimationCached())cc.warn("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},clearTracks:function(){this.isAnimationCached()?cc.warn("'clearTracks' interface can not be invoked in cached mode."):this._state&&this._state.clearTracks()},clearTrack:function(t){this.isAnimationCached()?cc.warn("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},setStartListener:function(t){this._ensureListener(),this._listener.start=t},setInterruptListener:function(t){this._ensureListener(),this._listener.interrupt=t},setEndListener:function(t){this._ensureListener(),this._listener.end=t},setDisposeListener:function(t){this._ensureListener(),this._listener.dispose=t},setCompleteListener:function(t){this._ensureListener(),this._listener.complete=t},setEventListener:function(t){this._ensureListener(),this._listener.event=t},setTrackStartListener:function(t,e){n.getListeners(t).start=e},setTrackInterruptListener:function(t,e){n.getListeners(t).interrupt=e},setTrackEndListener:function(t,e){n.getListeners(t).end=e},setTrackDisposeListener:function(t,e){n.getListeners(t).dispose=e},setTrackCompleteListener:function(t,i){n.getListeners(t).complete=function(t){var e=Math.floor(t.trackTime/t.animationEnd);i(t,e)}},setTrackEventListener:function(t,e){n.getListeners(t).event=e},getState:function(){return this._state},_updateAnimEnum:!1,_updateSkinEnum:!1,_ensureListener:function(){this._listener||(this._listener=new n,this._state&&this._state.addListener(this._listener))},_updateSkeletonData:function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new s.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(t){cc.warn(t)}this.attachUtil.init(this),this.attachUtil._associateAttachedNode(),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}else this.disableRender()}else this.disableRender()},_refreshInspector:function(){this._updateAnimEnum(),this._updateSkinEnum(),Editor.Utils.refreshSelectedInspector("node",this.node.uuid)},_updateDebugDraw:function(){var t;this.debugBones||this.debugSlots?(this._debugRenderer||((t=new cc.PrivateNode).name="DEBUG_DRAW_NODE",(t=t.addComponent(a)).lineWidth=1,t.strokeColor=cc.color(255,0,0,255),this._debugRenderer=t),this._debugRenderer.node.parent=this.node,this.isAnimationCached()&&cc.warn("Debug bones or slots is invalid in cached mode")):this._debugRenderer&&(this._debugRenderer.node.parent=null)}}),e.exports=sp.Skeleton},{"../../cocos2d/core/components/CCRenderComponent":131,"../../cocos2d/core/graphics/graphics":172,"../../cocos2d/core/renderer/render-flow":263,"./AttachUtil":416,"./lib/spine":419,"./skeleton-cache":420,"./track-entry-listeners":424}],418:[function(t,e,i){"use strict";var n="undefined"==typeof window?global:window;n.spine=t("./lib/spine"),n.sp={},sp._timeScale=1,Object.defineProperty(sp,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t},configurable:!0}),sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.AnimationEventType=cc.Enum({START:0,INTERRUPT:1,END:2,DISPOSE:3,COMPLETE:4,EVENT:5}),sp.spine=n.spine,t("./skeleton-texture"),t("./skeleton-data"),t("./vertex-effect-delegate"),t("./Skeleton"),t("./spine-assembler")},{"./Skeleton":417,"./lib/spine":419,"./skeleton-data":421,"./skeleton-texture":422,"./spine-assembler":423,"./vertex-effect-delegate":425}],419:[function(R,O,F){"use strict";n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var t,n,l,e,i,r,s,a,o,u,V,h,N,c,k,_,z,G,U,j,d,f,X,Y,p,q,L=function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},W=(function(N){e.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},e.prototype.apply=function(t,e,i,n,r,s,a,o){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(i%=this.duration,0<e&&(e%=this.duration));for(var l=this.timelines,h=0,c=l.length;h<c;h++)l[h].apply(t,e,i,r,s,a,o)},e.binarySearch=function(t,e,i){var n=0,r=t.length/(i=void 0===i?1:i)-2;if(0==r)return i;for(var s=r>>>1;;){if(t[(s+1)*i]<=e?n=s+1:r=s,n==r)return(n+1)*i;s=n+r>>>1}},e.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1};var k,f,t,z=e;function e(t,e,i){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var n=0;n<e.length;n++)this.timelineIds[e[n].getPropertyId()]=!0;this.duration=i}N.Animation=z,(i=k=N.MixBlend||(N.MixBlend={}))[i.setup=0]="setup",i[i.first=1]="first",i[i.replace=2]="replace",i[i.add=3]="add",(i=f=N.MixDirection||(N.MixDirection={}))[i.mixIn=0]="mixIn",i[i.mixOut=1]="mixOut",(i=t=N.TimelineType||(N.TimelineType={}))[i.rotate=0]="rotate",i[i.translate=1]="translate",i[i.scale=2]="scale",i[i.shear=3]="shear",i[i.attachment=4]="attachment",i[i.color=5]="color",i[i.deform=6]="deform",i[i.event=7]="event",i[i.drawOrder=8]="drawOrder",i[i.ikConstraint=9]="ikConstraint",i[i.transformConstraint=10]="transformConstraint",i[i.pathConstraintPosition=11]="pathConstraintPosition",i[i.pathConstraintSpacing=12]="pathConstraintSpacing",i[i.pathConstraintMix=13]="pathConstraintMix",i[i.twoColor=14]="twoColor";g.prototype.getFrameCount=function(){return this.curves.length/g.BEZIER_SIZE+1},g.prototype.setLinear=function(t){this.curves[t*g.BEZIER_SIZE]=g.LINEAR},g.prototype.setStepped=function(t){this.curves[t*g.BEZIER_SIZE]=g.STEPPED},g.prototype.getCurveType=function(t){t*=g.BEZIER_SIZE;if(t==this.curves.length)return g.LINEAR;t=this.curves[t];return t==g.LINEAR?g.LINEAR:t==g.STEPPED?g.STEPPED:g.BEZIER},g.prototype.setCurve=function(t,e,i,n,r){var s=.03*(2*-e+n),a=.03*(2*-i+r),o=.006*(3*(e-n)+1),l=.006*(3*(i-r)+1),h=2*s+o,c=2*a+l,u=.3*e+s+.16666667*o,_=.3*i+a+.16666667*l,d=t*g.BEZIER_SIZE,f=this.curves;f[d++]=g.BEZIER;for(var p=u,m=_,y=d+g.BEZIER_SIZE-1;d<y;d+=2)f[d]=p,f[d+1]=m,u+=h,_+=c,h+=o,c+=l,p+=u,m+=_},g.prototype.getCurvePercent=function(t,e){e=N.MathUtils.clamp(e,0,1);var i=this.curves,n=t*g.BEZIER_SIZE,t=i[n];if(t==g.LINEAR)return e;if(t==g.STEPPED)return 0;for(var r,s,a=0,o=++n,l=n+g.BEZIER_SIZE-1;n<l;n+=2)if((a=i[n])>=e)return s=r=void 0,(s=n==o?r=0:(r=i[n-2],i[n-1]))+(i[n+1]-s)*(e-r)/(a-r);t=i[n-1];return t+(1-t)*(e-a)/(1-a)},g.LINEAR=0,g.STEPPED=1,g.BEZIER=2,g.BEZIER_SIZE=19;var i=g;function g(t){if(t<=0)throw new Error("frameCount must be > 0: "+t);this.curves=N.Utils.newFloatArray((t-1)*g.BEZIER_SIZE)}N.CurveTimeline=i;L(p,n=i),p.prototype.getPropertyId=function(){return(t.rotate<<24)+this.boneIndex},p.prototype.setFrame=function(t,e,i){this.frames[t<<=1]=e,this.frames[t+p.ROTATION]=i},p.prototype.apply=function(t,e,i,n,r,s,a){var o=this.frames,l=t.bones[this.boneIndex];if(l.active)if(i<o[0])switch(s){case k.setup:return void(l.rotation=l.data.rotation);case k.first:var h=l.data.rotation-l.rotation;l.rotation+=(h-360*(16384-(16384.499999999996-h/360|0)))*r}else if(i>=o[o.length-p.ENTRIES]){var c=o[o.length+p.PREV_ROTATION];switch(s){case k.setup:l.rotation=l.data.rotation+c*r;break;case k.first:case k.replace:c=(c+=l.data.rotation-l.rotation)-360*(16384-(16384.499999999996-c/360|0));case k.add:l.rotation+=c*r}}else{var t=z.binarySearch(o,i,p.ENTRIES),u=o[t+p.PREV_ROTATION],_=o[t],i=this.getCurvePercent((t>>1)-1,1-(i-_)/(o[t+p.PREV_TIME]-_)),d=u+((d=o[t+p.ROTATION]-u)-360*(16384-(16384.499999999996-d/360|0)))*i;switch(s){case k.setup:l.rotation=l.data.rotation+(d-360*(16384-(16384.499999999996-d/360|0)))*r;break;case k.first:case k.replace:d+=l.data.rotation-l.rotation;case k.add:l.rotation+=(d-360*(16384-(16384.499999999996-d/360|0)))*r}}},p.ENTRIES=2,p.PREV_TIME=-2,p.PREV_ROTATION=-1,p.ROTATION=1;var n,r=p;function p(t){var e=n.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t<<1),e}N.RotateTimeline=r;L(_,s=i),_.prototype.getPropertyId=function(){return(t.translate<<24)+this.boneIndex},_.prototype.setFrame=function(t,e,i,n){this.frames[t*=_.ENTRIES]=e,this.frames[t+_.X]=i,this.frames[t+_.Y]=n},_.prototype.apply=function(t,e,i,n,r,s,a){var o=this.frames,l=t.bones[this.boneIndex];if(l.active)if(i<o[0])switch(s){case k.setup:return l.x=l.data.x,void(l.y=l.data.y);case k.first:l.x+=(l.data.x-l.x)*r,l.y+=(l.data.y-l.y)*r}else{var h,c=0,u=0;switch(i>=o[o.length-_.ENTRIES]?(c=o[o.length+_.PREV_X],u=o[o.length+_.PREV_Y]):(c=o[(t=z.binarySearch(o,i,_.ENTRIES))+_.PREV_X],u=o[t+_.PREV_Y],h=o[t],i=this.getCurvePercent(t/_.ENTRIES-1,1-(i-h)/(o[t+_.PREV_TIME]-h)),c+=(o[t+_.X]-c)*i,u+=(o[t+_.Y]-u)*i),s){case k.setup:l.x=l.data.x+c*r,l.y=l.data.y+u*r;break;case k.first:case k.replace:l.x+=(l.data.x+c-l.x)*r,l.y+=(l.data.y+u-l.y)*r;break;case k.add:l.x+=c*r,l.y+=u*r}}},_.ENTRIES=3,_.PREV_TIME=-3,_.PREV_X=-2,_.PREV_Y=-1,_.X=1,_.Y=2;var s,r=_;function _(t){var e=s.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*_.ENTRIES),e}N.TranslateTimeline=r;L(m,a=r),m.prototype.getPropertyId=function(){return(t.scale<<24)+this.boneIndex},m.prototype.apply=function(t,e,i,n,r,s,a){var o=this.frames,l=t.bones[this.boneIndex];if(l.active)if(i<o[0])switch(s){case k.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case k.first:l.scaleX+=(l.data.scaleX-l.scaleX)*r,l.scaleY+=(l.data.scaleY-l.scaleY)*r}else{var h,c=0,u=0;if(u=i>=o[o.length-m.ENTRIES]?(c=o[o.length+m.PREV_X]*l.data.scaleX,o[o.length+m.PREV_Y]*l.data.scaleY):(c=o[(t=z.binarySearch(o,i,m.ENTRIES))+m.PREV_X],u=o[t+m.PREV_Y],h=o[t],i=this.getCurvePercent(t/m.ENTRIES-1,1-(i-h)/(o[t+m.PREV_TIME]-h)),c=(c+(o[t+m.X]-c)*i)*l.data.scaleX,(u+(o[t+m.Y]-u)*i)*l.data.scaleY),1==r)s==k.add?(l.scaleX+=c-l.data.scaleX,l.scaleY+=u-l.data.scaleY):(l.scaleX=c,l.scaleY=u);else{var _=0,d=0;if(a==f.mixOut)switch(s){case k.setup:_=l.data.scaleX,d=l.data.scaleY,l.scaleX=_+(Math.abs(c)*N.MathUtils.signum(_)-_)*r,l.scaleY=d+(Math.abs(u)*N.MathUtils.signum(d)-d)*r;break;case k.first:case k.replace:_=l.scaleX,d=l.scaleY,l.scaleX=_+(Math.abs(c)*N.MathUtils.signum(_)-_)*r,l.scaleY=d+(Math.abs(u)*N.MathUtils.signum(d)-d)*r;break;case k.add:_=l.scaleX,d=l.scaleY,l.scaleX=_+(Math.abs(c)*N.MathUtils.signum(_)-l.data.scaleX)*r,l.scaleY=d+(Math.abs(u)*N.MathUtils.signum(d)-l.data.scaleY)*r}else switch(s){case k.setup:_=Math.abs(l.data.scaleX)*N.MathUtils.signum(c),d=Math.abs(l.data.scaleY)*N.MathUtils.signum(u),l.scaleX=_+(c-_)*r,l.scaleY=d+(u-d)*r;break;case k.first:case k.replace:_=Math.abs(l.scaleX)*N.MathUtils.signum(c),d=Math.abs(l.scaleY)*N.MathUtils.signum(u),l.scaleX=_+(c-_)*r,l.scaleY=d+(u-d)*r;break;case k.add:_=N.MathUtils.signum(c),d=N.MathUtils.signum(u),l.scaleX=Math.abs(l.scaleX)*_+(c-Math.abs(l.data.scaleX)*_)*r,l.scaleY=Math.abs(l.scaleY)*d+(u-Math.abs(l.data.scaleY)*d)*r}}}};var a,o=m;function m(t){return a.call(this,t)||this}N.ScaleTimeline=o;L(d,l=r),d.prototype.getPropertyId=function(){return(t.shear<<24)+this.boneIndex},d.prototype.apply=function(t,e,i,n,r,s,a){var o=this.frames,l=t.bones[this.boneIndex];if(l.active)if(i<o[0])switch(s){case k.setup:return l.shearX=l.data.shearX,void(l.shearY=l.data.shearY);case k.first:l.shearX+=(l.data.shearX-l.shearX)*r,l.shearY+=(l.data.shearY-l.shearY)*r}else{var h,c=0,u=0;switch(i>=o[o.length-d.ENTRIES]?(c=o[o.length+d.PREV_X],u=o[o.length+d.PREV_Y]):(c=o[(t=z.binarySearch(o,i,d.ENTRIES))+d.PREV_X],u=o[t+d.PREV_Y],h=o[t],i=this.getCurvePercent(t/d.ENTRIES-1,1-(i-h)/(o[t+d.PREV_TIME]-h)),c+=(o[t+d.X]-c)*i,u+=(o[t+d.Y]-u)*i),s){case k.setup:l.shearX=l.data.shearX+c*r,l.shearY=l.data.shearY+u*r;break;case k.first:case k.replace:l.shearX+=(l.data.shearX+c-l.shearX)*r,l.shearY+=(l.data.shearY+u-l.shearY)*r;break;case k.add:l.shearX+=c*r,l.shearY+=u*r}}};var l,o=d;function d(t){return l.call(this,t)||this}N.ShearTimeline=o;L(y,h=i),y.prototype.getPropertyId=function(){return(t.color<<24)+this.slotIndex},y.prototype.setFrame=function(t,e,i,n,r,s){this.frames[t*=y.ENTRIES]=e,this.frames[t+y.R]=i,this.frames[t+y.G]=n,this.frames[t+y.B]=r,this.frames[t+y.A]=s},y.prototype.apply=function(t,e,i,n,r,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){t=this.frames;if(i<t[0])switch(s){case k.setup:return void o.color.setFromColor(o.data.color);case k.first:var l=o.color,h=o.data.color;l.add((h.r-l.r)*r,(h.g-l.g)*r,(h.b-l.b)*r,(h.a-l.a)*r)}else{var c,u,_=0,d=0,f=0,p=0;i>=t[t.length-y.ENTRIES]?(_=t[(c=t.length)+y.PREV_R],d=t[c+y.PREV_G],f=t[c+y.PREV_B],p=t[c+y.PREV_A]):(_=t[(c=z.binarySearch(t,i,y.ENTRIES))+y.PREV_R],d=t[c+y.PREV_G],f=t[c+y.PREV_B],p=t[c+y.PREV_A],u=t[c],i=this.getCurvePercent(c/y.ENTRIES-1,1-(i-u)/(t[c+y.PREV_TIME]-u)),_+=(t[c+y.R]-_)*i,d+=(t[c+y.G]-d)*i,f+=(t[c+y.B]-f)*i,p+=(t[c+y.A]-p)*i),1==r?o.color.set(_,d,f,p):(l=o.color,s==k.setup&&l.setFromColor(o.data.color),l.add((_-l.r)*r,(d-l.g)*r,(f-l.b)*r,(p-l.a)*r))}}},y.ENTRIES=5,y.PREV_TIME=-5,y.PREV_R=-4,y.PREV_G=-3,y.PREV_B=-2,y.PREV_A=-1,y.R=1,y.G=2,y.B=3,y.A=4;var h,r=y;function y(t){var e=h.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*y.ENTRIES),e}N.ColorTimeline=r;L(x,c=i),x.prototype.getPropertyId=function(){return(t.twoColor<<24)+this.slotIndex},x.prototype.setFrame=function(t,e,i,n,r,s,a,o,l){this.frames[t*=x.ENTRIES]=e,this.frames[t+x.R]=i,this.frames[t+x.G]=n,this.frames[t+x.B]=r,this.frames[t+x.A]=s,this.frames[t+x.R2]=a,this.frames[t+x.G2]=o,this.frames[t+x.B2]=l},x.prototype.apply=function(t,e,i,n,r,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){t=this.frames;if(i<t[0])switch(s){case k.setup:return o.color.setFromColor(o.data.color),void o.darkColor.setFromColor(o.data.darkColor);case k.first:var l=o.color,h=o.darkColor,c=o.data.color,u=o.data.darkColor;l.add((c.r-l.r)*r,(c.g-l.g)*r,(c.b-l.b)*r,(c.a-l.a)*r),h.add((u.r-h.r)*r,(u.g-h.g)*r,(u.b-h.b)*r,0)}else{var _,d,f=0,p=0,m=0,y=0,g=0,v=0,b=0;i>=t[t.length-x.ENTRIES]?(f=t[(_=t.length)+x.PREV_R],p=t[_+x.PREV_G],m=t[_+x.PREV_B],y=t[_+x.PREV_A],g=t[_+x.PREV_R2],v=t[_+x.PREV_G2],b=t[_+x.PREV_B2]):(f=t[(_=z.binarySearch(t,i,x.ENTRIES))+x.PREV_R],p=t[_+x.PREV_G],m=t[_+x.PREV_B],y=t[_+x.PREV_A],g=t[_+x.PREV_R2],v=t[_+x.PREV_G2],b=t[_+x.PREV_B2],d=t[_],i=this.getCurvePercent(_/x.ENTRIES-1,1-(i-d)/(t[_+x.PREV_TIME]-d)),f+=(t[_+x.R]-f)*i,p+=(t[_+x.G]-p)*i,m+=(t[_+x.B]-m)*i,y+=(t[_+x.A]-y)*i,g+=(t[_+x.R2]-g)*i,v+=(t[_+x.G2]-v)*i,b+=(t[_+x.B2]-b)*i),1==r?(o.color.set(f,p,m,y),o.darkColor.set(g,v,b,1)):(l=o.color,h=o.darkColor,s==k.setup&&(l.setFromColor(o.data.color),h.setFromColor(o.data.darkColor)),l.add((f-l.r)*r,(p-l.g)*r,(m-l.b)*r,(y-l.a)*r),h.add((g-h.r)*r,(v-h.g)*r,(b-h.b)*r,0))}}},x.ENTRIES=8,x.PREV_TIME=-8,x.PREV_R=-7,x.PREV_G=-6,x.PREV_B=-5,x.PREV_A=-4,x.PREV_R2=-3,x.PREV_G2=-2,x.PREV_B2=-1,x.R=1,x.G=2,x.B=3,x.A=4,x.R2=5,x.G2=6,x.B2=7;var c,o=x;function x(t){var e=c.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*x.ENTRIES),e}function u(t){this.frames=N.Utils.newFloatArray(t),this.attachmentNames=new Array(t)}N.TwoColorTimeline=o,u.prototype.getPropertyId=function(){return(t.attachment<<24)+this.slotIndex},u.prototype.getFrameCount=function(){return this.frames.length},u.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},u.prototype.apply=function(t,e,i,n,r,s,a){var o=t.slots[this.slotIndex];o.bone.active&&(a!=f.mixOut||s!=k.setup?i<(a=this.frames)[0]?s!=k.setup&&s!=k.first||(s=o.data.attachmentName,o.setAttachment(null==s?null:t.getAttachment(this.slotIndex,s))):(s=0,s=i>=a[a.length-1]?a.length-1:z.binarySearch(a,i,1)-1,a=this.attachmentNames[s],t.slots[this.slotIndex].setAttachment(null==a?null:t.getAttachment(this.slotIndex,a))):(i=o.data.attachmentName,o.setAttachment(null==i?null:t.getAttachment(this.slotIndex,i))))},N.AttachmentTimeline=u;var v,b=null,r=(L(A,v=i),A.prototype.getPropertyId=function(){return(t.deform<<27)+ +this.attachment.id+this.slotIndex},A.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},A.prototype.apply=function(t,L,e,F,i,n,V){t=t.slots[this.slotIndex];if(t.bone.active){var r=t.getAttachment();if(r instanceof N.VertexAttachment&&r.deformAttachment==this.attachment){var s=t.deform,t=(0==s.length&&(n=k.setup),this.frameVertices),a=t[0].length,o=this.frames;if(e<o[0]){var l=r;switch(n){case k.setup:return void(s.length=0);case k.first:if(1==i){s.length=0;break}var h=N.Utils.setArraySize(s,a);if(null==l.bones)for(var c=l.vertices,u=0;u<a;u++)h[u]+=(c[u]-h[u])*i;else for(i=1-i,u=0;u<a;u++)h[u]*=i}}else{var _=N.Utils.setArraySize(s,a);if(e>=o[o.length-1]){var d=t[o.length-1];if(1==i)if(n==k.add)if(null==(l=r).bones)for(var c=l.vertices,f=0;f<a;f++)_[f]+=d[f]-c[f];else for(var p=0;p<a;p++)_[p]+=d[p];else N.Utils.arrayCopy(d,0,_,0,a);else switch(n){case k.setup:if(null==r.bones){c=r.vertices;for(var m=0;m<a;m++){var y=c[m];_[m]=y+(d[m]-y)*i}}else for(var g=0;g<a;g++)_[g]=d[g]*i;break;case k.first:case k.replace:for(var v=0;v<a;v++)_[v]+=(d[v]-_[v])*i;case k.add:if(null==(l=r).bones){c=l.vertices;for(var b=0;b<a;b++)_[b]+=(d[b]-c[b])*i}else for(var x=0;x<a;x++)_[x]+=d[x]*i}}else{var A=z.binarySearch(o,e),C=t[A-1],T=t[A],t=o[A],S=this.getCurvePercent(A-1,1-(e-t)/(o[A-1]-t));if(1==i)if(n==k.add)if(null==(l=r).bones){c=l.vertices;for(var w=0;w<a;w++){var E=C[w];_[w]+=E+(T[w]-E)*S-c[w]}}else for(var M=0;M<a;M++)E=C[M],_[M]+=E+(T[M]-E)*S;else for(var D=0;D<a;D++)E=C[D],_[D]=E+(T[D]-E)*S;else switch(n){case k.setup:if(null==r.bones){c=r.vertices;for(var B=0;B<a;B++)E=C[B],y=c[B],_[B]=y+(E+(T[B]-E)*S-y)*i}else for(var I=0;I<a;I++)E=C[I],_[I]=(E+(T[I]-E)*S)*i;break;case k.first:case k.replace:for(var P=0;P<a;P++)E=C[P],_[P]+=(E+(T[P]-E)*S-_[P])*i;break;case k.add:if(null==(l=r).bones){c=l.vertices;for(var R=0;R<a;R++)E=C[R],_[R]+=(E+(T[R]-E)*S-c[R])*i}else for(var O=0;O<a;O++)E=C[O],_[O]+=(E+(T[O]-E)*S)*i}}}}}},A);function A(t){var e=v.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t),e.frameVertices=new Array(t),null==b&&(b=N.Utils.newFloatArray(64)),e}function C(t){this.frames=N.Utils.newFloatArray(t),this.events=new Array(t)}function T(t){this.frames=N.Utils.newFloatArray(t),this.drawOrders=new Array(t)}N.DeformTimeline=r,C.prototype.getPropertyId=function(){return t.event<<24},C.prototype.getFrameCount=function(){return this.frames.length},C.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},C.prototype.apply=function(t,e,i,n,r,s,a){if(null!=n){var o=this.frames,l=this.frames.length;if(i<e)this.apply(t,e,Number.MAX_VALUE,n,r,s,a),e=-1;else if(e>=o[l-1])return;if(!(i<o[0])){var h=0;if(e<o[0])h=0;else for(var c=o[h=z.binarySearch(o,e)];0<h&&o[h-1]==c;)h--;for(;h<l&&i>=o[h];h++)n.push(this.events[h])}}},N.EventTimeline=C,T.prototype.getPropertyId=function(){return t.drawOrder<<24},T.prototype.getFrameCount=function(){return this.frames.length},T.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},T.prototype.apply=function(t,e,i,n,r,s,a){var o=t.drawOrder,l=t.slots;if(a!=f.mixOut||s!=k.setup){a=this.frames;if(i<a[0])s!=k.setup&&s!=k.first||N.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var s=i>=a[a.length-1]?a.length-1:z.binarySearch(a,i)-1,h=this.drawOrders[s];if(null==h)N.Utils.arrayCopy(l,0,o,0,l.length);else for(var c=0,u=h.length;c<u;c++)o[c]=l[h[c]]}}else N.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)},N.DrawOrderTimeline=T;L(w,S=i),w.prototype.getPropertyId=function(){return(t.ikConstraint<<24)+this.ikConstraintIndex},w.prototype.setFrame=function(t,e,i,n,r,s,a){this.frames[t*=w.ENTRIES]=e,this.frames[t+w.MIX]=i,this.frames[t+w.SOFTNESS]=n,this.frames[t+w.BEND_DIRECTION]=r,this.frames[t+w.COMPRESS]=s?1:0,this.frames[t+w.STRETCH]=a?1:0},w.prototype.apply=function(t,e,i,n,r,s,a){var o,l,h,c=this.frames,u=t.ikConstraints[this.ikConstraintIndex];if(u.active)if(i<c[0])switch(s){case k.setup:return u.mix=u.data.mix,u.softness=u.data.softness,u.bendDirection=u.data.bendDirection,u.compress=u.data.compress,void(u.stretch=u.data.stretch);case k.first:u.mix+=(u.data.mix-u.mix)*r,u.softness+=(u.data.softness-u.softness)*r,u.bendDirection=u.data.bendDirection,u.compress=u.data.compress,u.stretch=u.data.stretch}else i>=c[c.length-w.ENTRIES]?s==k.setup?(u.mix=u.data.mix+(c[c.length+w.PREV_MIX]-u.data.mix)*r,u.softness=u.data.softness+(c[c.length+w.PREV_SOFTNESS]-u.data.softness)*r,a==f.mixOut?(u.bendDirection=u.data.bendDirection,u.compress=u.data.compress,u.stretch=u.data.stretch):(u.bendDirection=c[c.length+w.PREV_BEND_DIRECTION],u.compress=0!=c[c.length+w.PREV_COMPRESS],u.stretch=0!=c[c.length+w.PREV_STRETCH])):(u.mix+=(c[c.length+w.PREV_MIX]-u.mix)*r,u.softness+=(c[c.length+w.PREV_SOFTNESS]-u.softness)*r,a==f.mixIn&&(u.bendDirection=c[c.length+w.PREV_BEND_DIRECTION],u.compress=0!=c[c.length+w.PREV_COMPRESS],u.stretch=0!=c[c.length+w.PREV_STRETCH])):(o=c[(t=z.binarySearch(c,i,w.ENTRIES))+w.PREV_MIX],l=c[t+w.PREV_SOFTNESS],h=c[t],i=this.getCurvePercent(t/w.ENTRIES-1,1-(i-h)/(c[t+w.PREV_TIME]-h)),s==k.setup?(u.mix=u.data.mix+(o+(c[t+w.MIX]-o)*i-u.data.mix)*r,u.softness=u.data.softness+(l+(c[t+w.SOFTNESS]-l)*i-u.data.softness)*r,a==f.mixOut?(u.bendDirection=u.data.bendDirection,u.compress=u.data.compress,u.stretch=u.data.stretch):(u.bendDirection=c[t+w.PREV_BEND_DIRECTION],u.compress=0!=c[t+w.PREV_COMPRESS],u.stretch=0!=c[t+w.PREV_STRETCH])):(u.mix+=(o+(c[t+w.MIX]-o)*i-u.mix)*r,u.softness+=(l+(c[t+w.SOFTNESS]-l)*i-u.softness)*r,a==f.mixIn&&(u.bendDirection=c[t+w.PREV_BEND_DIRECTION],u.compress=0!=c[t+w.PREV_COMPRESS],u.stretch=0!=c[t+w.PREV_STRETCH])))},w.ENTRIES=6,w.PREV_TIME=-6,w.PREV_MIX=-5,w.PREV_SOFTNESS=-4,w.PREV_BEND_DIRECTION=-3,w.PREV_COMPRESS=-2,w.PREV_STRETCH=-1,w.MIX=1,w.SOFTNESS=2,w.BEND_DIRECTION=3,w.COMPRESS=4,w.STRETCH=5;var S,o=w;function w(t){var e=S.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*w.ENTRIES),e}N.IkConstraintTimeline=o;L(M,E=i),M.prototype.getPropertyId=function(){return(t.transformConstraint<<24)+this.transformConstraintIndex},M.prototype.setFrame=function(t,e,i,n,r,s){this.frames[t*=M.ENTRIES]=e,this.frames[t+M.ROTATE]=i,this.frames[t+M.TRANSLATE]=n,this.frames[t+M.SCALE]=r,this.frames[t+M.SHEAR]=s},M.prototype.apply=function(t,e,i,n,r,s,a){var o=this.frames,l=t.transformConstraints[this.transformConstraintIndex];if(l.active)if(i<o[0]){var h=l.data;switch(s){case k.setup:return l.rotateMix=h.rotateMix,l.translateMix=h.translateMix,l.scaleMix=h.scaleMix,void(l.shearMix=h.shearMix);case k.first:l.rotateMix+=(h.rotateMix-l.rotateMix)*r,l.translateMix+=(h.translateMix-l.translateMix)*r,l.scaleMix+=(h.scaleMix-l.scaleMix)*r,l.shearMix+=(h.shearMix-l.shearMix)*r}}else{var c,u,t=0,_=0,d=0,f=0;i>=o[o.length-M.ENTRIES]?(t=o[(c=o.length)+M.PREV_ROTATE],_=o[c+M.PREV_TRANSLATE],d=o[c+M.PREV_SCALE],f=o[c+M.PREV_SHEAR]):(t=o[(c=z.binarySearch(o,i,M.ENTRIES))+M.PREV_ROTATE],_=o[c+M.PREV_TRANSLATE],d=o[c+M.PREV_SCALE],f=o[c+M.PREV_SHEAR],u=o[c],i=this.getCurvePercent(c/M.ENTRIES-1,1-(i-u)/(o[c+M.PREV_TIME]-u)),t+=(o[c+M.ROTATE]-t)*i,_+=(o[c+M.TRANSLATE]-_)*i,d+=(o[c+M.SCALE]-d)*i,f+=(o[c+M.SHEAR]-f)*i),s==k.setup?(h=l.data,l.rotateMix=h.rotateMix+(t-h.rotateMix)*r,l.translateMix=h.translateMix+(_-h.translateMix)*r,l.scaleMix=h.scaleMix+(d-h.scaleMix)*r,l.shearMix=h.shearMix+(f-h.shearMix)*r):(l.rotateMix+=(t-l.rotateMix)*r,l.translateMix+=(_-l.translateMix)*r,l.scaleMix+=(d-l.scaleMix)*r,l.shearMix+=(f-l.shearMix)*r)}},M.ENTRIES=5,M.PREV_TIME=-5,M.PREV_ROTATE=-4,M.PREV_TRANSLATE=-3,M.PREV_SCALE=-2,M.PREV_SHEAR=-1,M.ROTATE=1,M.TRANSLATE=2,M.SCALE=3,M.SHEAR=4;var E,r=M;function M(t){var e=E.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*M.ENTRIES),e}N.TransformConstraintTimeline=r;L(B,D=i),B.prototype.getPropertyId=function(){return(t.pathConstraintPosition<<24)+this.pathConstraintIndex},B.prototype.setFrame=function(t,e,i){this.frames[t*=B.ENTRIES]=e,this.frames[t+B.VALUE]=i},B.prototype.apply=function(t,e,i,n,r,s,a){var o=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(i<o[0])switch(s){case k.setup:return void(l.position=l.data.position);case k.first:l.position+=(l.data.position-l.position)*r}else{var h,c,t=0;i>=o[o.length-B.ENTRIES]?t=o[o.length+B.PREV_VALUE]:(t=o[(h=z.binarySearch(o,i,B.ENTRIES))+B.PREV_VALUE],c=o[h],i=this.getCurvePercent(h/B.ENTRIES-1,1-(i-c)/(o[h+B.PREV_TIME]-c)),t+=(o[h+B.VALUE]-t)*i),s==k.setup?l.position=l.data.position+(t-l.data.position)*r:l.position+=(t-l.position)*r}},B.ENTRIES=2,B.PREV_TIME=-2,B.PREV_VALUE=-1,B.VALUE=1;var D,o=B;function B(t){var e=D.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*B.ENTRIES),e}N.PathConstraintPositionTimeline=o;L(I,R=o),I.prototype.getPropertyId=function(){return(t.pathConstraintSpacing<<24)+this.pathConstraintIndex},I.prototype.apply=function(t,e,i,n,r,s,a){var o=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(i<o[0])switch(s){case k.setup:return void(l.spacing=l.data.spacing);case k.first:l.spacing+=(l.data.spacing-l.spacing)*r}else{var h,c,t=0;i>=o[o.length-I.ENTRIES]?t=o[o.length+I.PREV_VALUE]:(t=o[(h=z.binarySearch(o,i,I.ENTRIES))+I.PREV_VALUE],c=o[h],i=this.getCurvePercent(h/I.ENTRIES-1,1-(i-c)/(o[h+I.PREV_TIME]-c)),t+=(o[h+I.VALUE]-t)*i),s==k.setup?l.spacing=l.data.spacing+(t-l.data.spacing)*r:l.spacing+=(t-l.spacing)*r}};var R,r=I;function I(t){return R.call(this,t)||this}N.PathConstraintSpacingTimeline=r;L(P,O=i),P.prototype.getPropertyId=function(){return(t.pathConstraintMix<<24)+this.pathConstraintIndex},P.prototype.setFrame=function(t,e,i,n){this.frames[t*=P.ENTRIES]=e,this.frames[t+P.ROTATE]=i,this.frames[t+P.TRANSLATE]=n},P.prototype.apply=function(t,e,i,n,r,s,a){var o=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(i<o[0])switch(s){case k.setup:return l.rotateMix=l.data.rotateMix,void(l.translateMix=l.data.translateMix);case k.first:l.rotateMix+=(l.data.rotateMix-l.rotateMix)*r,l.translateMix+=(l.data.translateMix-l.translateMix)*r}else{var h,c,t=0,u=0;i>=o[o.length-P.ENTRIES]?(t=o[o.length+P.PREV_ROTATE],u=o[o.length+P.PREV_TRANSLATE]):(t=o[(h=z.binarySearch(o,i,P.ENTRIES))+P.PREV_ROTATE],u=o[h+P.PREV_TRANSLATE],c=o[h],i=this.getCurvePercent(h/P.ENTRIES-1,1-(i-c)/(o[h+P.PREV_TIME]-c)),t+=(o[h+P.ROTATE]-t)*i,u+=(o[h+P.TRANSLATE]-u)*i),s==k.setup?(l.rotateMix=l.data.rotateMix+(t-l.data.rotateMix)*r,l.translateMix=l.data.translateMix+(u-l.data.translateMix)*r):(l.rotateMix+=(t-l.rotateMix)*r,l.translateMix+=(u-l.translateMix)*r)}},P.ENTRIES=3,P.PREV_TIME=-3,P.PREV_ROTATE=-2,P.PREV_TRANSLATE=-1,P.ROTATE=1,P.TRANSLATE=2;var O,o=P;function P(t){var e=O.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*P.ENTRIES),e}N.PathConstraintMixTimeline=o}(t=t||{}),function(T){S.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,i=0,n=e.length;i<n;i++){var r=e[i];if(null!=r){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var s=t*r.timeScale;if(0<r.delay){if(r.delay-=s,0<r.delay)continue;s=-r.delay,r.delay=0}var a=r.next;if(null!=a){var o=r.trackLast-a.delay;if(0<=o){for(a.delay=0,a.trackTime+=0==r.timeScale?0:(o/r.timeScale+t)*a.timeScale,r.trackTime+=s,this.setCurrent(i,a,!0);null!=a.mixingFrom;)a.mixTime+=t,a=a.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[i]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){var l=r.mixingFrom;for((r.mixingFrom=null)!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}r.trackTime+=s}}this.queue.drain()},S.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var n=this.updateMixingFrom(i,e);return i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,0<t.mixTime&&t.mixTime>=t.mixDuration?(0!=i.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=i.mixingFrom,null!=i.mixingFrom&&(i.mixingFrom.mixingTo=t),t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),n):(i.trackTime+=e*i.timeScale,t.mixTime+=e,!1)},S.prototype.apply=function(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var e=this.events,i=this.tracks,n=!1,r=0,s=i.length;r<s;r++){var a=i[r];if(!(null==a||0<a.delay)){var n=!0,o=0==r?T.MixBlend.first:a.mixBlend,l=a.alpha,h=(null!=a.mixingFrom?l*=this.applyMixingFrom(a,t,o):a.trackTime>=a.trackEnd&&null==a.next&&(l=0),a.animationLast),c=a.getAnimationTime(),u=a.animation.timelines.length,_=a.animation.timelines;if(0==r&&1==l||o==T.MixBlend.add)for(var d=0;d<u;d++)T.Utils.webkit602BugfixHelper(l,o),_[d].apply(t,h,c,e,l,o,T.MixDirection.mixIn);else for(var f=a.timelineMode,p=0==a.timelinesRotation.length,m=(p&&T.Utils.setArraySize(a.timelinesRotation,u<<1,null),a.timelinesRotation),d=0;d<u;d++){var y=_[d],g=(f[d]&S.NOT_LAST-1)==S.SUBSEQUENT?o:T.MixBlend.setup;y instanceof T.RotateTimeline?this.applyRotateTimeline(y,t,c,l,g,m,d<<1,p):(T.Utils.webkit602BugfixHelper(l,o),y.apply(t,h,c,e,l,g,T.MixDirection.mixIn))}this.queueEvents(a,c),e.length=0,a.nextAnimationLast=c,a.nextTrackLast=a.trackTime}}return this.queue.drain(),n},S.prototype.applyMixingFrom=function(t,e,i){var n=t.mixingFrom,r=(null!=n.mixingFrom&&this.applyMixingFrom(n,e,i),0),s=(0==t.mixDuration?(r=1,i==T.MixBlend.first&&(i=T.MixBlend.setup)):(1<(r=t.mixTime/t.mixDuration)&&(r=1),i!=T.MixBlend.first&&(i=n.mixBlend)),r<n.eventThreshold?this.events:null),a=r<n.attachmentThreshold,o=r<n.drawOrderThreshold,l=n.animationLast,h=n.getAnimationTime(),c=n.animation.timelines.length,u=n.animation.timelines,_=n.alpha*t.interruptAlpha,d=_*(1-r);if(i==T.MixBlend.add)for(var f=0;f<c;f++)u[f].apply(e,l,h,s,d,i,T.MixDirection.mixOut);else for(var p=n.timelineMode,m=n.timelineHoldMix,y=0==n.timelinesRotation.length,g=(y&&T.Utils.setArraySize(n.timelinesRotation,c<<1,null),n.timelinesRotation),f=n.totalAlpha=0;f<c;f++){var v=u[f],b=T.MixDirection.mixOut,x=void 0,A=0;switch(p[f]&S.NOT_LAST-1){case S.SUBSEQUENT:if(x=i,!a&&v instanceof T.AttachmentTimeline){if((p[f]&S.NOT_LAST)==S.NOT_LAST)continue;x=T.MixBlend.setup}if(!o&&v instanceof T.DrawOrderTimeline)continue;A=d;break;case S.FIRST:x=T.MixBlend.setup,A=d;break;case S.HOLD:x=T.MixBlend.setup,A=_;break;default:var x=T.MixBlend.setup,C=m[f],A=_*Math.max(0,1-C.mixTime/C.mixDuration)}n.totalAlpha+=A,v instanceof T.RotateTimeline?this.applyRotateTimeline(v,e,h,A,x,g,f<<1,y):(T.Utils.webkit602BugfixHelper(A,i),x==T.MixBlend.setup&&(v instanceof T.AttachmentTimeline?!a&&(p[f]&S.NOT_LAST)!=S.NOT_LAST||(b=T.MixDirection.mixIn):v instanceof T.DrawOrderTimeline&&o&&(b=T.MixDirection.mixIn)),v.apply(e,l,h,s,A,x,b))}return 0<t.mixDuration&&this.queueEvents(n,h),this.events.length=0,n.nextAnimationLast=h,n.nextTrackLast=n.trackTime,r},S.prototype.applyRotateTimeline=function(t,e,i,n,r,s,a,o){if(o&&(s[a]=0),1!=n){var l=t,h=l.frames,c=e.bones[l.boneIndex];if(c.active){var u=0,_=0;if(i<h[0])switch(r){case T.MixBlend.setup:c.rotation=c.data.rotation;default:return;case T.MixBlend.first:u=c.rotation,_=c.data.rotation}else u=(r==T.MixBlend.setup?c.data:c).rotation,i>=h[h.length-T.RotateTimeline.ENTRIES]?_=c.data.rotation+h[h.length+T.RotateTimeline.PREV_ROTATION]:(f=h[(d=T.Animation.binarySearch(h,i,T.RotateTimeline.ENTRIES))+T.RotateTimeline.PREV_ROTATION],p=h[d],l=l.getCurvePercent((d>>1)-1,1-(i-p)/(h[d+T.RotateTimeline.PREV_TIME]-p)),_=h[d+T.RotateTimeline.ROTATION]-f,_=f+(_-=360*(16384-(16384.499999999996-_/360|0)))*l+c.data.rotation,_-=360*(16384-(16384.499999999996-_/360|0)));var d,f,p=0,h=_-u;0==(h-=360*(16384-(16384.499999999996-h/360|0)))?p=s[a]:(f=d=0,f=o?(d=0,h):(d=s[a],s[a+1]),l=0<h,o=0<=d,T.MathUtils.signum(f)!=T.MathUtils.signum(h)&&Math.abs(f)<=90&&(180<Math.abs(d)&&(d+=360*T.MathUtils.signum(d)),o=l),p=h+d-d%360,o!=l&&(p+=360*T.MathUtils.signum(d)),s[a]=p),s[a+1]=h,c.rotation=(u+=p*n)-360*(16384-(16384.499999999996-u/360|0))}}else t.apply(e,0,i,null,1,r,T.MixDirection.mixIn)},S.prototype.queueEvents=function(t,e){for(var i=t.animationStart,n=t.animationEnd,r=n-i,s=t.trackLast%r,a=this.events,o=0,l=a.length;o<l;o++){var h=a[o];if(h.time<s)break;h.time>n||this.queue.event(t,h)}for((t.loop?0==r||s>t.trackTime%r:n<=e&&t.animationLast<n)&&this.queue.complete(t);o<l;o++)a[o].time<i||this.queue.event(t,a[o])},S.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},S.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){t=this.tracks[t];if(null!=t){this.queue.end(t),this.disposeNext(t);for(var e=t;;){var i=e.mixingFrom;if(null==i)break;this.queue.end(i),e.mixingFrom=null,e.mixingTo=null,e=i}this.tracks[t.trackIndex]=null,this.queue.drain()}}},S.prototype.setCurrent=function(t,e,i){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(i&&this.queue.interrupt(n),((e.mixingFrom=n).mixingTo=e).mixTime=0,null!=n.mixingFrom&&0<n.mixDuration&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)},S.prototype.setAnimation=function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,i)},S.prototype.setAnimationWith=function(t,e,i){if(null==e)throw new Error("animation cannot be null.");var n=!0,r=this.expandToIndex(t),e=(null!=r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,n=!1):this.disposeNext(r)),this.trackEntry(t,e,i,r));return this.setCurrent(t,e,n),this.queue.drain(),e},S.prototype.addAnimation=function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,i,n)},S.prototype.addAnimationWith=function(t,e,i,n){if(null==e)throw new Error("animation cannot be null.");var r=this.expandToIndex(t);if(null!=r)for(;null!=r.next;)r=r.next;i=this.trackEntry(t,e,i,r);return null==r?(this.setCurrent(t,i,!0),this.queue.drain()):(r.next=i,n<=0&&(0!=(t=r.animationEnd-r.animationStart)?(r.loop?n+=t*(1+(r.trackTime/t|0)):n+=Math.max(t,r.trackTime),n-=this.data.getMix(r.animation,e)):n=r.trackTime)),i.delay=n,i},S.prototype.setEmptyAnimation=function(t,e){t=this.setAnimationWith(t,S.emptyAnimation,!1);return t.mixDuration=e,t.trackEnd=e,t},S.prototype.addEmptyAnimation=function(t,e,i){i<=0&&(i-=e);t=this.addAnimationWith(t,S.emptyAnimation,!1,i);return t.mixDuration=e,t.trackEnd=e,t},S.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,n=this.tracks.length;i<n;i++){var r=this.tracks[i];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},S.prototype.expandToIndex=function(t){return t<this.tracks.length?this.tracks[t]:(T.Utils.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)},S.prototype.trackEntry=function(t,e,i,n){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=i,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==n?0:this.data.getMix(n.animation,e),r},S.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},S.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++)if(null!=(i=this.tracks[t])){for(;null!=i.mixingFrom;)i=i.mixingFrom;for(;null!=i.mixingFrom&&i.mixBlend==T.MixBlend.add||this.computeHold(i),null!=(i=i.mixingTo););}for(this.propertyIDs.clear(),t=this.tracks.length-1;0<=t;t--)for(var i=this.tracks[t];null!=i;)this.computeNotLast(i),i=i.mixingFrom},S.prototype.computeHold=function(t){var e=t.mixingTo,i=t.animation.timelines,n=t.animation.timelines.length,r=T.Utils.setArraySize(t.timelineMode,n),s=(t.timelineHoldMix.length=0,T.Utils.setArraySize(t.timelineHoldMix,n)),a=this.propertyIDs;if(null!=e&&e.holdPrevious)for(var o=0;o<n;o++)a.add(i[o].getPropertyId()),r[o]=S.HOLD;else t:for(o=0;o<n;o++){var l=i[o],h=l.getPropertyId();if(a.add(h))if(null==e||l instanceof T.AttachmentTimeline||l instanceof T.DrawOrderTimeline||l instanceof T.EventTimeline||!e.animation.hasTimeline(h))r[o]=S.FIRST;else{for(var c=e.mixingTo;null!=c;c=c.mixingTo)if(!c.animation.hasTimeline(h)){if(0<t.mixDuration){r[o]=S.HOLD_MIX,s[o]=c;continue t}break}r[o]=S.HOLD}else r[o]=S.SUBSEQUENT}},S.prototype.computeNotLast=function(t){for(var e,i=t.animation.timelines,n=t.animation.timelines.length,r=t.timelineMode,s=this.propertyIDs,a=0;a<n;a++)i[a]instanceof T.AttachmentTimeline&&(e=i[a],s.add(e.slotIndex)||(r[a]|=S.NOT_LAST))},S.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},S.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},S.prototype.removeListener=function(t){t=this.listeners.indexOf(t);0<=t&&this.listeners.splice(t,1)},S.prototype.clearListeners=function(){this.listeners.length=0},S.prototype.clearListenerNotifications=function(){this.queue.clear()},S.emptyAnimation=new T.Animation("<empty>",[],0),S.SUBSEQUENT=0,S.FIRST=1,S.HOLD=2,S.HOLD_MIX=3,S.NOT_LAST=4;var t=S;function S(t){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new n(this),this.propertyIDs=new T.IntSet,this.animationsChanged=!1,this.trackEntryPool=new T.Pool(function(){return new e}),this.data=t}T.AnimationState=t;i.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},i.prototype.getAnimationTime=function(){var t;return this.loop?0==(t=this.animationEnd-this.animationStart)?this.animationStart:this.trackTime%t+this.animationStart:Math.min(this.trackTime+this.animationStart,this.animationEnd)},i.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},i.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},i.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0};var e=i;function i(){this.mixBlend=T.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}T.TrackEntry=e;r.prototype.start=function(t){this.objects.push(o.start),this.objects.push(t),this.animState.animationsChanged=!0},r.prototype.interrupt=function(t){this.objects.push(o.interrupt),this.objects.push(t)},r.prototype.end=function(t){this.objects.push(o.end),this.objects.push(t),this.animState.animationsChanged=!0},r.prototype.dispose=function(t){this.objects.push(o.dispose),this.objects.push(t)},r.prototype.complete=function(t){this.objects.push(o.complete),this.objects.push(t)},r.prototype.event=function(t,e){this.objects.push(o.event),this.objects.push(t),this.objects.push(e)},r.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,i=0;i<t.length;i+=2){var n=t[i],r=t[i+1];switch(n){case o.start:null!=r.listener&&r.listener.start&&r.listener.start(r);for(var s=0;s<e.length;s++)e[s].start&&e[s].start(r);break;case o.interrupt:for(null!=r.listener&&r.listener.interrupt&&r.listener.interrupt(r),s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(r);break;case o.end:for(null!=r.listener&&r.listener.end&&r.listener.end(r),s=0;s<e.length;s++)e[s].end&&e[s].end(r);case o.dispose:for(null!=r.listener&&r.listener.dispose&&r.listener.dispose(r),s=0;s<e.length;s++)e[s].dispose&&e[s].dispose(r);this.animState.trackEntryPool.free(r);break;case o.complete:for(null!=r.listener&&r.listener.complete&&r.listener.complete(r),s=0;s<e.length;s++)e[s].complete&&e[s].complete(r);break;case o.event:var a=t[2+i++];for(null!=r.listener&&r.listener.event&&r.listener.event(r,a),s=0;s<e.length;s++)e[s].event&&e[s].event(r,a)}}this.clear(),this.drainDisabled=!1}},r.prototype.clear=function(){this.objects.length=0};var o,n=r;function r(t){this.objects=[],this.drainDisabled=!1,this.animState=t}function s(){}T.EventQueue=n,(t=o=T.EventType||(T.EventType={}))[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",s.prototype.start=function(t){},s.prototype.interrupt=function(t){},s.prototype.end=function(t){},s.prototype.dispose=function(t){},s.prototype.complete=function(t){},s.prototype.event=function(t,e){},T.AnimationStateAdapter=s}(t=t||{}),function(t){function e(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}e.prototype.setMix=function(t,e,i){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);t=this.skeletonData.findAnimation(e);if(null==t)throw new Error("Animation not found: "+e);this.setMixWith(n,t,i)},e.prototype.setMixWith=function(t,e,i){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");t=t.name+"."+e.name;this.animationToMixTime[t]=i},e.prototype.getMix=function(t,e){t=t.name+"."+e.name,e=this.animationToMixTime[t];return void 0===e?this.defaultMix:e},t.AnimationStateData=e}(t=t||{}),function(_){function t(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}t.downloadText=function(t,e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){200==n.status?e(n.responseText):i(n.status,n.responseText)},n.onerror=function(){i(n.status,n.responseText)},n.send()},t.downloadBinary=function(t,e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status?e(new Uint8Array(n.response)):i(n.status,n.responseText)},n.onerror=function(){i(n.status,n.responseText)},n.send()},t.prototype.loadBinary=function(i,e,n){var r=this;void 0===e&&(e=null),void 0===n&&(n=null),i=this.pathPrefix+i,this.toLoad++,t.downloadBinary(i,function(t){r.assets[i]=t,e&&e(i,t),r.toLoad--,r.loaded++},function(t,e){r.errors[i]="Couldn't load binary "+i+": status "+status+", "+e,n&&n(i,"Couldn't load binary "+i+": status "+status+", "+e),r.toLoad--,r.loaded++})},t.prototype.loadText=function(i,e,n){var r=this;void 0===e&&(e=null),void 0===n&&(n=null),i=this.pathPrefix+i,this.toLoad++,t.downloadText(i,function(t){r.assets[i]=t,e&&e(i,t),r.toLoad--,r.loaded++},function(t,e){r.errors[i]="Couldn't load text "+i+": status "+status+", "+e,n&&n(i,"Couldn't load text "+i+": status "+status+", "+e),r.toLoad--,r.loaded++})},t.prototype.loadTexture=function(i,n,e){var r=this,s=(void 0===n&&(n=null),void 0===e&&(e=null),i=this.pathPrefix+i,this.toLoad++,new Image);s.crossOrigin="anonymous",s.onload=function(t){var e=r.textureLoader(s);r.assets[i]=e,r.toLoad--,r.loaded++,n&&n(i,s)},s.onerror=function(t){r.errors[i]="Couldn't load image "+i,r.toLoad--,r.loaded++,e&&e(i,"Couldn't load image "+i)},s.src=i},t.prototype.loadTextureData=function(i,t,n,e){var r=this,s=(void 0===n&&(n=null),void 0===e&&(e=null),i=this.pathPrefix+i,this.toLoad++,new Image);s.onload=function(t){var e=r.textureLoader(s);r.assets[i]=e,r.toLoad--,r.loaded++,n&&n(i,s)},s.onerror=function(t){r.errors[i]="Couldn't load image "+i,r.toLoad--,r.loaded++,e&&e(i,"Couldn't load image "+i)},s.src=t},t.prototype.loadTextureAtlas=function(o,l,h){var c=this,u=(void 0===l&&(l=null),void 0===h&&(h=null),0<=o.lastIndexOf("/")?o.substring(0,o.lastIndexOf("/")):"");o=this.pathPrefix+o,this.toLoad++,t.downloadText(o,function(r){var s={count:0},a=new Array;try{new _.TextureAtlas(r,function(t){a.push(u+"/"+t);t=document.createElement("img");return t.width=16,t.height=16,new _.FakeTexture(t)})}catch(t){var e=t;return c.errors[o]="Couldn't load texture atlas "+o+": "+e.message,h&&h(o,"Couldn't load texture atlas "+o+": "+e.message),c.toLoad--,void c.loaded++}for(var t=0,i=a;t<i.length;t++)!function(t){var n=!1;c.loadTexture(t,function(e,t){if(s.count++,s.count==a.length)if(n)c.errors[o]="Couldn't load texture atlas page "+e+"} of atlas "+o,h&&h(o,"Couldn't load texture atlas page "+e+" of atlas "+o),c.toLoad--,c.loaded++;else try{var i=new _.TextureAtlas(r,function(t){return c.get(u+"/"+t)});c.assets[o]=i,l&&l(o,i),c.toLoad--,c.loaded++}catch(t){e=t;c.errors[o]="Couldn't load texture atlas "+o+": "+e.message,h&&h(o,"Couldn't load texture atlas "+o+": "+e.message),c.toLoad--,c.loaded++}},function(t,e){n=!0,s.count++,s.count==a.length&&(c.errors[o]="Couldn't load texture atlas page "+t+"} of atlas "+o,h&&h(o,"Couldn't load texture atlas page "+t+" of atlas "+o),c.toLoad--,c.loaded++)})}(i[t])},function(t,e){c.errors[o]="Couldn't load texture atlas "+o+": status "+status+", "+e,h&&h(o,"Couldn't load texture atlas "+o+": status "+status+", "+e),c.toLoad--,c.loaded++})},t.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},t.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},t.prototype.removeAll=function(){for(var t in this.assets){t=this.assets[t];t.dispose&&t.dispose()}this.assets={}},t.prototype.isLoadingComplete=function(){return 0==this.toLoad},t.prototype.getToLoad=function(){return this.toLoad},t.prototype.getLoaded=function(){return this.loaded},t.prototype.dispose=function(){this.removeAll()},t.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length},t.prototype.getErrors=function(){return this.errors},_.AssetManager=t}(t=t||{}),function(n){function t(t){this.atlas=t}t.prototype.newRegionAttachment=function(t,e,i){i=this.atlas.findRegion(i);if(null==i)return null;i.renderObject=i;e=new n.RegionAttachment(e);return e.setRegion(i),e},t.prototype.newMeshAttachment=function(t,e,i){i=this.atlas.findRegion(i);if(null==i)return null;i.renderObject=i;e=new n.MeshAttachment(e);return e.region=i,e},t.prototype.newBoundingBoxAttachment=function(t,e){return new n.BoundingBoxAttachment(e)},t.prototype.newPathAttachment=function(t,e){return new n.PathAttachment(e)},t.prototype.newPointAttachment=function(t,e){return new n.PointAttachment(e)},t.prototype.newClippingAttachment=function(t,e){return new n.ClippingAttachment(e)},n.AtlasAttachmentLoader=t}(t=t||{}),(m=(m=t=t||{}).BlendMode||(m.BlendMode={}))[m.Normal=0]="Normal",m[m.Additive=1]="Additive",m[m.Multiply=2]="Multiply",m[m.Screen=3]="Screen",function(S){function t(t,e,i){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}t.prototype.isActive=function(){return this.active},t.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransformWith=function(t,e,i,n,r,s,a){this.ax=t,this.ay=e,this.arotation=i,this.ascaleX=n,this.ascaleY=r,this.ashearX=s,this.ashearY=a,this.appliedValid=!0;var o,l,h,c=this.parent;if(null==c)return p=i+90+a,l=(o=this.skeleton).scaleX,h=o.scaleY,this.a=S.MathUtils.cosDeg(i+s)*n*l,this.b=S.MathUtils.cosDeg(p)*r*l,this.c=S.MathUtils.sinDeg(i+s)*n*h,this.d=S.MathUtils.sinDeg(p)*r*h,this.worldX=t*l+o.x,void(this.worldY=e*h+o.y);var u=c.a,_=c.b,d=c.c,f=c.d;switch(this.worldX=u*t+_*e+c.worldX,this.worldY=d*t+f*e+c.worldY,this.data.transformMode){case S.TransformMode.Normal:var p=i+90+a,m=S.MathUtils.cosDeg(i+s)*n,y=S.MathUtils.cosDeg(p)*r,g=S.MathUtils.sinDeg(i+s)*n,v=S.MathUtils.sinDeg(p)*r;return this.a=u*m+_*g,this.b=u*y+_*v,this.c=d*m+f*g,void(this.d=d*y+f*v);case S.TransformMode.OnlyTranslation:p=i+90+a,this.a=S.MathUtils.cosDeg(i+s)*n,this.b=S.MathUtils.cosDeg(p)*r,this.c=S.MathUtils.sinDeg(i+s)*n,this.d=S.MathUtils.sinDeg(p)*r;break;case S.TransformMode.NoRotationOrReflection:var b=0,x=i+s-(b=1e-4<(A=u*u+d*d)?(_=d*(A=Math.abs(u*f-_*d)/A),f=u*A,Math.atan2(d,u)*S.MathUtils.radDeg):(d=u=0,90-Math.atan2(f,_)*S.MathUtils.radDeg)),b=i+a-b+90,m=S.MathUtils.cosDeg(x)*n,y=S.MathUtils.cosDeg(b)*r,g=S.MathUtils.sinDeg(x)*n,v=S.MathUtils.sinDeg(b)*r;this.a=u*m-_*g,this.b=u*y-_*v,this.c=d*m+f*g,this.d=d*y+f*v;break;case S.TransformMode.NoScale:case S.TransformMode.NoScaleOrReflection:var A,x=S.MathUtils.cosDeg(i),b=S.MathUtils.sinDeg(i),C=(u*x+_*b)/this.skeleton.scaleX,x=(d*x+f*b)/this.skeleton.scaleY,b=(C*=A=1e-5<(A=Math.sqrt(C*C+x*x))?1/A:A,x*=A,A=Math.sqrt(C*C+x*x),this.data.transformMode==S.TransformMode.NoScale&&u*f-_*d<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(A=-A),Math.PI/2+Math.atan2(x,C)),T=Math.cos(b)*A,b=Math.sin(b)*A;m=S.MathUtils.cosDeg(s)*n,y=S.MathUtils.cosDeg(90+a)*r,g=S.MathUtils.sinDeg(s)*n,v=S.MathUtils.sinDeg(90+a)*r,this.a=C*m+T*g,this.b=C*y+T*v,this.c=x*m+b*g,this.d=x*y+b*v}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},t.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},t.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*S.MathUtils.radDeg},t.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*S.MathUtils.radDeg},t.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},t.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},t.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var t=this.parent;if(null==t)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*S.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*S.MathUtils.radDeg);var e=t.a,i=t.b,n=t.c,r=t.d,s=1/(e*r-i*n),a=this.worldX-t.worldX,t=this.worldY-t.worldY,t=(this.ax=a*r*s-t*i*s,this.ay=t*e*s-a*n*s,s*r),a=s*e,r=s*i,e=s*n,i=t*this.a-r*this.c,s=t*this.b-r*this.d,n=a*this.c-e*this.a,t=a*this.d-e*this.b;this.ashearX=0,this.ascaleX=Math.sqrt(i*i+n*n),1e-4<this.ascaleX?(this.ascaleY=(r=i*t-s*n)/this.ascaleX,this.ashearY=Math.atan2(i*s+n*t,r)*S.MathUtils.radDeg,this.arotation=Math.atan2(n,i)*S.MathUtils.radDeg):(this.ascaleX=0,this.ascaleY=Math.sqrt(s*s+t*t),this.ashearY=0,this.arotation=90-Math.atan2(t,s)*S.MathUtils.radDeg)},t.prototype.worldToLocal=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=1/(e*r-i*n),a=t.x-this.worldX,o=t.y-this.worldY;return t.x=a*r*s-o*i*s,t.y=o*e*s-a*n*s,t},t.prototype.localToWorld=function(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t},t.prototype.worldToLocalRotation=function(t){var e=S.MathUtils.sinDeg(t),t=S.MathUtils.cosDeg(t);return Math.atan2(this.a*e-this.c*t,this.d*t-this.b*e)*S.MathUtils.radDeg+this.rotation-this.shearX},t.prototype.localToWorldRotation=function(t){t-=this.rotation-this.shearX;var e=S.MathUtils.sinDeg(t),t=S.MathUtils.cosDeg(t);return Math.atan2(t*this.c+e*this.d,t*this.a+e*this.b)*S.MathUtils.radDeg},t.prototype.rotateWorld=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=S.MathUtils.cosDeg(t),t=S.MathUtils.sinDeg(t);this.a=s*e-t*n,this.b=s*i-t*r,this.c=t*e+s*n,this.d=t*i+s*r,this.appliedValid=!1},S.Bone=t}(t=t||{}),(p=t=t||{}).BoneData=function(t,e,i){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=q.Normal,this.skinRequired=!1,this.color=new p.Color,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=i},(m=q=p.TransformMode||(p.TransformMode={}))[m.Normal=0]="Normal",m[m.OnlyTranslation=1]="OnlyTranslation",m[m.NoRotationOrReflection=2]="NoRotationOrReflection",m[m.NoScale=3]="NoScale",m[m.NoScaleOrReflection=4]="NoScaleOrReflection",(t||(t={})).ConstraintData=function(t,e,i){this.name=t,this.order=e,this.skinRequired=i},(t||(t={})).Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e},(t||(t={})).EventData=function(t){this.name=t},function(q){function t(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},t.prototype.apply1=function(t,e,i,n,r,s,a){t.appliedValid||t.updateAppliedTransform();var o,l=t.parent,h=1/(l.a*l.d-l.b*l.c),e=e-l.worldX,i=i-l.worldY,c=(e*l.d-i*l.b)*h-t.ax,i=(i*l.a-e*l.c)*h-t.ay,e=Math.atan2(i,c)*q.MathUtils.radDeg-t.ashearX-t.arotation,l=(t.ascaleX<0&&(e+=180),180<e?e-=360:e<-180&&(e+=360),t.ascaleX),h=t.ascaleY;(n||r)&&(o=t.data.length*l,c=Math.sqrt(c*c+i*i),(n&&c<o||r&&o<c&&1e-4<o)&&(l*=i=(c/o-1)*a+1,s&&(h*=i))),t.updateWorldTransformWith(t.ax,t.ay,t.arotation+e*a,l,h,t.ashearX,t.ashearY)},t.prototype.apply2=function(t,e,i,n,r,F,s,a){if(0!=a){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var o,l,V=t.ax,N=t.ay,h=t.ascaleX,k=h,c=t.ascaleY,u=e.ascaleX,z=0,G=0,_=0,_=h<0?(h=-h,z=180,-1):(z=0,1),G=(c<0&&(c=-c,_=-_),u<0?(u=-u,180):0),d=e.ax,f=0,p=0,m=0,y=t.a,g=t.b,v=t.c,b=t.d,U=Math.abs(h-c)<=1e-4,m=U?(p=y*d+g*(f=e.ay)+t.worldX,v*d+b*f+t.worldY):(f=0,p=y*d+t.worldX,v*d+t.worldY),x=t.parent,y=x.a,g=x.b,v=x.c,A=1/(y*(b=x.d)-g*v),C=p-x.worldX,T=m-x.worldY,p=(C*b-T*g)*A-V,m=(T*y-C*v)*A-N,S=Math.sqrt(p*p+m*m),w=e.data.length*u;if(S<1e-4)return this.apply1(t,i,n,!1,F,!1,a),void e.updateWorldTransformWith(d,f,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var E=((C=i-x.worldX)*b-(T=n-x.worldY)*g)*A-V,M=(T*y-C*v)*A-N,D=E*E+M*M;0!=s&&(s*=h*(u+1)/2,0<(m=(p=Math.sqrt(D))-S-w*h+s)&&(D=(E-=(i=(m-s*(1-(i=Math.min(1,m/(2*s))-1)*i))/p)*E)*E+(M-=i*M)*M));t:if(U){var B=(D-S*S-(w*=h)*w)/(2*S*w);B<-1?B=-1:1<B&&(B=1,F&&(k*=(Math.sqrt(D)/(S+w)-1)*a+1)),l=Math.acos(B)*r,y=S+w*B,g=w*Math.sin(l),o=Math.atan2(M*y-E*g,E*y+M*g)}else{var B=(y=h*w)*y,I=(g=c*w)*g,j=Math.atan2(M,E),P=-2*I*S,R=I-B;if(0<=(b=P*P-4*R*(v=I*S*S+B*D-B*I))){var O=Math.sqrt(b),P=(O=-(P+(O=P<0?-O:O))/2)/R,R=v/O,O=Math.abs(P)<Math.abs(R)?P:R;if(O*O<=D){T=Math.sqrt(D-O*O)*r,o=j-Math.atan2(T,O),l=Math.atan2(T/c,(O-S)/h);break t}}var P=q.MathUtils.PI,R=S-y,O=R*R,W=0,H=0,L=S+y,X=L*L,Y=0;-1<=(v=-y*S/(B-I))&&v<=1&&(v=Math.acos(v),(b=(C=y*Math.cos(v)+S)*C+(T=g*Math.sin(v))*T)<O&&(P=v,O=b,R=C,W=T),X<b&&(H=v,X=b,L=C,Y=T)),l=D<=(O+X)/2?(o=j-Math.atan2(W*r,R),P*r):(o=j-Math.atan2(Y*r,L),H*r)}n=Math.atan2(f,d)*_,x=t.arotation;180<(o=(o-n)*q.MathUtils.radDeg+z-x)?o-=360:o<-180&&(o+=360),t.updateWorldTransformWith(V,N,x+o*a,k,t.ascaleY,0,0),x=e.arotation,180<(l=((l+n)*q.MathUtils.radDeg-e.ashearX)*_+G-x)?l-=360:l<-180&&(l+=360),e.updateWorldTransformWith(d,f,x+l*a,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()},q.IkConstraint=t}(t=t||{}),m=t=t||{},Y=m.ConstraintData,L(it,Y),m.IkConstraintData=it,function(q){function J(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}J.prototype.isActive=function(){return this.active},J.prototype.apply=function(){this.update()},J.prototype.update=function(){var t=this.target.getAttachment();if(t instanceof q.PathAttachment){var e=this.rotateMix,i=this.translateMix,n=0<e;if(0<i||n){var r=this.data,s=r.spacingMode==q.SpacingMode.Percent,a=r.rotateMode,o=a==q.RotateMode.Tangent,l=a==q.RotateMode.ChainScale,h=this.bones.length,c=o?h:h+1,u=this.bones,_=q.Utils.setArraySize(this.spaces,c),d=null,f=this.spacing;if(l||!s){l&&(d=q.Utils.setArraySize(this.lengths,h));for(var F=r.spacingMode==q.SpacingMode.Length,p=0,V=c-1;p<V;){var m,y,g,v=(w=u[p]).data.length;v<J.epsilon?(l&&(d[p]=0),_[++p]=0):s?(l&&(m=v*w.a,y=v*w.c,g=Math.sqrt(m*m+y*y),d[p]=g),_[++p]=f):(m=v*w.a,y=v*w.c,g=Math.sqrt(m*m+y*y),l&&(d[p]=g),_[++p]=(F?v+f:f)*g/v)}}else for(p=1;p<c;p++)_[p]=f;var b=this.computeWorldPositions(t,c,o,r.positionMode==q.PositionMode.Percent,s),x=b[0],A=b[1],C=r.offsetRotation,T=!1;0==C?T=a==q.RotateMode.Chain:(T=!1,C*=0<(S=this.target.bone).a*S.d-S.b*S.c?q.MathUtils.degRad:-q.MathUtils.degRad);for(var p=0,S=3;p<h;p++,S+=3){(w=u[p]).worldX+=(x-w.worldX)*i,w.worldY+=(A-w.worldY)*i;var w,E=(m=b[S])-x,M=(y=b[S+1])-A;!l||0!=(D=d[p])&&(D=(Math.sqrt(E*E+M*M)/D-1)*e+1,w.a*=D,w.c*=D);var D,B,I,P,R,O,N,L,x=m,A=y;n&&(D=w.a,B=w.b,I=w.c,P=w.d,O=R=L=0,L=o?b[S-1]:0==_[p+1]?b[S+2]:Math.atan2(M,E),L-=Math.atan2(I,D),T?(R=Math.cos(L),O=Math.sin(L),x+=((N=w.data.length)*(R*D-O*I)-E)*e,A+=(N*(O*D+R*I)-M)*e):L+=C,L>q.MathUtils.PI?L-=q.MathUtils.PI2:L<-q.MathUtils.PI&&(L+=q.MathUtils.PI2),L*=e,R=Math.cos(L),O=Math.sin(L),w.a=R*D-O*I,w.b=R*B-O*P,w.c=O*D+R*I,w.d=O*B+R*P),w.appliedValid=!1}}}},J.prototype.computeWorldPositions=function(t,e,F,V,N){var i=this.target,n=this.position,r=this.spaces,s=q.Utils.setArraySize(this.positions,3*e+2),a=null,o=t.closed,l=t.worldVerticesLength,h=l/6,c=J.NONE;if(t.constantSpeed){o?(a=q.Utils.setArraySize(this.world,l+=2),t.computeWorldVertices(i,2,l-4,a,0,2),t.computeWorldVertices(i,0,2,a,l-4,2),a[l-2]=a[0],a[l-1]=a[1]):(h--,a=q.Utils.setArraySize(this.world,l-=4),t.computeWorldVertices(i,2,l,a,0,2));for(var k=q.Utils.setArraySize(this.curves,h),u=0,_=a[0],d=a[1],f=0,p=0,m=0,y=0,g=0,z=0,G=0,U=0,v=0,b=0,x=0,A=0,C=0,T=0,S=(R=0,2);R<h;R++,S+=6)f=a[S],p=a[S+1],m=a[S+2],y=a[S+3],x=2*(G=.1875*(_-2*f+m))+(v=.09375*(3*(f-m)-_+(g=a[S+4]))),A=2*(U=.1875*(d-2*p+y))+(b=.09375*(3*(p-y)-d+(z=a[S+5]))),C=.75*(f-_)+G+.16666667*v,T=.75*(p-d)+U+.16666667*b,u+=Math.sqrt(C*C+T*T),C+=x,T+=A,x+=v,A+=b,u+=Math.sqrt(C*C+T*T),C+=x,T+=A,u+=Math.sqrt(C*C+T*T),C+=x+v,T+=A+b,u+=Math.sqrt(C*C+T*T),k[R]=u,_=g,d=z;if(n*=V?u:u/t.lengths[h-1],N)for(R=1;R<e;R++)r[R]*=u;for(var w=this.segments,E=0,M=L=O=R=0;R<e;R++,O+=3){var j,D=n+=j=r[R];if(o)(D%=u)<0&&(D+=u),L=0;else{if(D<0){this.addBeforePosition(D,a,0,s,O);continue}if(u<D){this.addAfterPosition(D-u,a,l-4,s,O);continue}}for(;;L++){var W=k[L];if(!(W<D)){0==L?D/=W:D=(D-(I=k[L-1]))/(W-I);break}}if(L!=c){var c=L,B=6*L,_=a[B],d=a[B+1],f=a[B+2],p=a[B+3],m=a[B+4],y=a[B+5],x=2*(G=.03*(_-2*f+m))+(v=.006*(3*(f-m)-_+(g=a[B+6]))),A=2*(U=.03*(d-2*p+y))+(b=.006*(3*(p-y)-d+(z=a[B+7]))),C=.3*(f-_)+G+.16666667*v,T=.3*(p-d)+U+.16666667*b,E=Math.sqrt(C*C+T*T);for(w[0]=E,B=1;B<8;B++)C+=x,T+=A,x+=v,A+=b,E+=Math.sqrt(C*C+T*T),w[B]=E;C+=x,T+=A,E+=Math.sqrt(C*C+T*T),w[8]=E,C+=x+v,T+=A+b,E+=Math.sqrt(C*C+T*T),w[9]=E,M=0}for(D*=E;;M++){var I,H=w[M];if(!(H<D)){0==M?D/=H:D=M+(D-(I=w[M-1]))/(H-I);break}}this.addCurvePosition(.1*D,_,d,f,p,m,y,g,z,s,O,F||0<R&&0==j)}}else{var X=t.lengths,P=X[h-=o?1:2];if(V&&(n*=P),N)for(var R=1;R<e;R++)r[R]*=P;for(var a=q.Utils.setArraySize(this.world,8),R=0,O=0,L=0;R<e;R++,O+=3){var D=n+=j=r[R];if(o)(D%=P)<0&&(D+=P),L=0;else{if(D<0){c!=J.BEFORE&&(c=J.BEFORE,t.computeWorldVertices(i,2,4,a,0,2)),this.addBeforePosition(D,a,0,s,O);continue}if(P<D){c!=J.AFTER&&(c=J.AFTER,t.computeWorldVertices(i,l-6,4,a,0,2)),this.addAfterPosition(D-P,a,0,s,O);continue}}for(;;L++){var Y=X[L];if(!(Y<D)){0==L?D/=Y:D=(D-(I=X[L-1]))/(Y-I);break}}L!=c&&(c=L,o&&L==h?(t.computeWorldVertices(i,l-4,4,a,0,2),t.computeWorldVertices(i,0,4,a,4,2)):t.computeWorldVertices(i,6*L+2,8,a,0,2)),this.addCurvePosition(D,a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],s,O,F||0<R&&0==j)}}return s},J.prototype.addBeforePosition=function(t,e,i,n,r){var s=e[i],a=e[i+1],o=e[i+2]-s,e=e[i+3]-a,i=Math.atan2(e,o);n[r]=s+t*Math.cos(i),n[r+1]=a+t*Math.sin(i),n[r+2]=i},J.prototype.addAfterPosition=function(t,e,i,n,r){var s=e[i+2],a=e[i+3],o=s-e[i],e=a-e[i+1],i=Math.atan2(e,o);n[r]=s+t*Math.cos(i),n[r+1]=a+t*Math.sin(i),n[r+2]=i},J.prototype.addCurvePosition=function(t,e,i,n,r,s,a,o,l,h,c,u){if(0==t||isNaN(t))return h[c]=e,h[c+1]=i,void(h[c+2]=Math.atan2(r-i,n-e));var _=t*t,d=_*t,f=1-t,p=f*f,m=p*f,y=f*t,g=3*y,f=f*g,g=g*t,o=e*m+n*f+s*g+o*d,m=i*m+r*f+a*g+l*d;h[c]=o,h[c+1]=m,u&&(h[c+2]=t<.001?Math.atan2(r-i,n-e):Math.atan2(m-(i*p+r*y*2+a*_),o-(e*p+n*y*2+s*_)))},J.NONE=-1,J.BEFORE=-2,J.AFTER=-3,J.epsilon=1e-5,q.PathConstraint=J}(t=t||{}),m=t=t||{},X=m.ConstraintData,L(et,X),g=et,m.PathConstraintData=g,(g=m.PositionMode||(m.PositionMode={}))[g.Fixed=0]="Fixed",g[g.Percent=1]="Percent",(g=m.SpacingMode||(m.SpacingMode={}))[g.Length=0]="Length",g[g.Fixed=1]="Fixed",g[g.Percent=2]="Percent",(g=m.RotateMode||(m.RotateMode={}))[g.Tangent=0]="Tangent",g[g.Chain=1]="Chain",g[g.ChainScale=2]="ChainScale",function(t){i.prototype.loaded=function(){var t,e=0;for(t in this.assets)e++;return e};var r=i;function e(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}function i(t){this.toLoad=new Array,this.assets={},this.clientId=t}e.prototype.queueAsset=function(t,e,i){var n=this.clientAssets[t];return null==n&&(n=new r(t),this.clientAssets[t]=n),null!==e&&(n.textureLoader=e),n.toLoad.push(i),this.queuedAssets[i]!==i&&(this.queuedAssets[i]=i,!0)},e.prototype.loadText=function(t,e){var i,n=this;e=this.pathPrefix+e,this.queueAsset(t,null,e)&&((i=new XMLHttpRequest).onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(200<=i.status&&i.status<300?n.rawAssets[e]=i.responseText:n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send())},e.prototype.loadJson=function(t,e){var i,n=this;e=this.pathPrefix+e,this.queueAsset(t,null,e)&&((i=new XMLHttpRequest).onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(200<=i.status&&i.status<300?n.rawAssets[e]=JSON.parse(i.responseText):n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send())},e.prototype.loadTexture=function(t,e,i){var n,r=this;i=this.pathPrefix+i,this.queueAsset(t,e,i)&&((n=new Image).src=i,n.crossOrigin="anonymous",n.onload=function(t){r.rawAssets[i]=n},n.onerror=function(t){r.errors[i]="Couldn't load image "+i})},e.prototype.get=function(t,e){e=this.pathPrefix+e;t=this.clientAssets[t];return null==t||t.assets[e]},e.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var i=t.toLoad[e],n=t.assets[i];null!=n||null!=(n=this.rawAssets[i])&&(n instanceof HTMLImageElement?t.assets[i]=t.textureLoader(n):t.assets[i]=n)}},e.prototype.isLoadingComplete=function(t){t=this.clientAssets[t];return null==t||(this.updateClientAssets(t),t.toLoad.length==t.loaded())},e.prototype.dispose=function(){},e.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length},e.prototype.getErrors=function(){return this.errors},t.SharedAssetManager=e}(t=t||{}),function(g){function t(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(var e=0;e<t.bones.length;e++){var i,n=t.bones[e],r=void 0;null==n.parent?r=new g.Bone(n,this,null):(i=this.bones[n.parent.index],r=new g.Bone(n,this,i),i.children.push(r)),this.bones.push(r)}for(this.slots=new Array,this.drawOrder=new Array,e=0;e<t.slots.length;e++){var s=t.slots[e],s=(r=this.bones[s.boneData.index],new g.Slot(s,r));this.slots.push(s),this.drawOrder.push(s)}for(this.ikConstraints=new Array,e=0;e<t.ikConstraints.length;e++){var a=t.ikConstraints[e];this.ikConstraints.push(new g.IkConstraint(a,this))}for(this.transformConstraints=new Array,e=0;e<t.transformConstraints.length;e++){var o=t.transformConstraints[e];this.transformConstraints.push(new g.TransformConstraint(o,this))}for(this.pathConstraints=new Array,e=0;e<t.pathConstraints.length;e++){var l=t.pathConstraints[e];this.pathConstraints.push(new g.PathConstraint(l,this))}this.color=new g.Color(1,1,1,1),this.updateCache()}t.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,i=t.length;e<i;e++)(r=t[e]).sorted=r.data.skinRequired,r.active=!r.sorted;if(null!=this.skin)for(var n=this.skin.bones,e=0,i=this.skin.bones.length;e<i;e++)for(var r=this.bones[n[e].index];r.sorted=!1,r.active=!0,null!=(r=r.parent););var s=this.ikConstraints,a=this.transformConstraints,o=this.pathConstraints,l=s.length,h=a.length,c=o.length,u=l+h+c;t:for(e=0;e<u;e++){for(var _,d=0;d<l;d++)if((_=s[d]).data.order==e){this.sortIkConstraint(_);continue t}for(d=0;d<h;d++)if((_=a[d]).data.order==e){this.sortTransformConstraint(_);continue t}for(d=0;d<c;d++)if((_=o[d]).data.order==e){this.sortPathConstraint(_);continue t}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e])},t.prototype.sortIkConstraint=function(t){var e,i,n;t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.Utils.contains(this.skin.constraints,t.data,!0)),t.active&&(e=t.target,this.sortBone(e),i=(e=t.bones)[0],this.sortBone(i),1<e.length&&(n=e[e.length-1],-1<this._updateCache.indexOf(n)||this.updateCacheReset.push(n)),this._updateCache.push(t),this.sortReset(i.children),e[e.length-1].sorted=!0)},t.prototype.sortPathConstraint=function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.Utils.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,i=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,i,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,n);for(var r=0,s=this.data.skins.length;r<s;r++)this.sortPathConstraintAttachment(this.data.skins[r],i,n);for(var e=e.getAttachment(),a=(e instanceof g.PathAttachment&&this.sortPathConstraintAttachmentWith(e,n),t.bones),o=a.length,r=0;r<o;r++)this.sortBone(a[r]);for(this._updateCache.push(t),r=0;r<o;r++)this.sortReset(a[r].children);for(r=0;r<o;r++)a[r].sorted=!0}},t.prototype.sortTransformConstraint=function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.Utils.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones,i=e.length;if(t.data.local)for(var n=0;n<i;n++){var r=e[n];this.sortBone(r.parent),-1<this._updateCache.indexOf(r)||this.updateCacheReset.push(r)}else for(n=0;n<i;n++)this.sortBone(e[n]);this._updateCache.push(t);for(var s=0;s<i;s++)this.sortReset(e[s].children);for(s=0;s<i;s++)e[s].sorted=!0}},t.prototype.sortPathConstraintAttachment=function(t,e,i){var n=t.attachments[e];if(n)for(var r in n)this.sortPathConstraintAttachmentWith(n[r],i)},t.prototype.sortPathConstraintAttachmentWith=function(t,e){if(t instanceof g.PathAttachment){var i=t.bones;if(null==i)this.sortBone(e);else for(var n=this.bones,r=0;r<i.length;)for(var s=i[r++],a=r+s;r<a;r++){var o=i[r];this.sortBone(n[o])}}},t.prototype.sortBone=function(t){var e;t.sorted||(null!=(e=t.parent)&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t))},t.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}},t.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,i=t.length;e<i;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}for(var r=this._updateCache,e=0,i=r.length;e<i;e++)r[e].update()},t.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},t.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,e=0,i=n.length;e<i;e++)(o=n[e]).mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch;var r=this.transformConstraints;for(e=0,i=r.length;e<i;e++){var s=(o=r[e]).data;o.rotateMix=s.rotateMix,o.translateMix=s.translateMix,o.scaleMix=s.scaleMix,o.shearMix=s.shearMix}var a=this.pathConstraints;for(e=0,i=a.length;e<i;e++){var o,s=(o=a[e]).data;o.position=s.position,o.spacing=s.spacing,o.rotateMix=s.rotateMix,o.translateMix=s.translateMix}},t.prototype.setSlotsToSetupPose=function(){var t=this.slots;g.Utils.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,i=t.length;e<i;e++)t[e].setToSetupPose()},t.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},t.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},t.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i],s=r.data.attachmentName;null==s||null!=(s=t.getAttachment(i,s))&&r.setAttachment(s)}this.skin=t,this.updateCache()}},t.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},t.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},t.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,n=0,r=i.length;n<r;n++){var s=i[n];if(s.data.name==t){var a=null;if(null!=e&&null==(a=this.getAttachment(n,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void s.setAttachment(a)}}throw new Error("Slot not found: "+t)},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.getBounds=function(t,e,i){if(void 0===i&&(i=new Array(2)),null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");for(var n=this.drawOrder,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=0,h=n.length;l<h;l++){var c=n[l];if(c.bone.active){var u=0,_=null,d=c.getAttachment();if(d instanceof g.RegionAttachment?(_=g.Utils.setArraySize(i,u=8,0),d.computeWorldVertices(c.bone,_,0,2)):d instanceof g.MeshAttachment&&(u=(d=d).worldVerticesLength,_=g.Utils.setArraySize(i,u,0),d.computeWorldVertices(c,0,u,_,0,2)),null!=_)for(var f=0,p=_.length;f<p;f+=2)var m=_[f],y=_[f+1],r=Math.min(r,m),s=Math.min(s,y),a=Math.max(a,m),o=Math.max(o,y)}}t.set(r,s),e.set(a-r,o-s)},t.prototype.update=function(t){this.time+=t},g.Skeleton=t}(t=t||{}),t=t||{}),m=(H.prototype.readSkeletonData=function(t){for(var e=this.scale,i=new W.SkeletonData,n=(i.name="",new J(t)),r=(i.hash=n.readString(),i.version=n.readString(),i.x=n.readFloat(),i.y=n.readFloat(),i.width=n.readFloat(),i.height=n.readFloat(),n.readBoolean()),s=(r&&(i.fps=n.readFloat(),i.imagesPath=n.readString(),i.audioPath=n.readString()),0),s=n.readInt(!0),a=0;a<s;a++)n.strings.push(n.readString());for(s=n.readInt(!0),a=0;a<s;a++){var o=n.readString(),l=0==a?null:i.bones[n.readInt(!0)];(u=new W.BoneData(a,o,l)).rotation=n.readFloat(),u.x=n.readFloat()*e,u.y=n.readFloat()*e,u.scaleX=n.readFloat(),u.scaleY=n.readFloat(),u.shearX=n.readFloat(),u.shearY=n.readFloat(),u.length=n.readFloat()*e,u.transformMode=H.TransformModeValues[n.readInt(!0)],u.skinRequired=n.readBoolean(),r&&W.Color.rgba8888ToColor(u.color,n.readInt32()),i.bones.push(u)}for(s=n.readInt(!0),a=0;a<s;a++){var h=n.readString(),c=i.bones[n.readInt(!0)],u=new W.SlotData(a,h,c),h=(W.Color.rgba8888ToColor(u.color,n.readInt32()),n.readInt32());-1!=h&&W.Color.rgb888ToColor(u.darkColor=new W.Color,h),u.attachmentName=n.readStringRef(),u.blendMode=H.BlendModeValues[n.readInt(!0)],i.slots.push(u)}s=n.readInt(!0);for(var a=0,_=void 0;a<s;a++){(u=new W.IkConstraintData(n.readString())).order=n.readInt(!0),u.skinRequired=n.readBoolean();for(var _=n.readInt(!0),d=0;d<_;d++)u.bones.push(i.bones[n.readInt(!0)]);u.target=i.bones[n.readInt(!0)],u.mix=n.readFloat(),u.softness=n.readFloat()*e,u.bendDirection=n.readByte(),u.compress=n.readBoolean(),u.stretch=n.readBoolean(),u.uniform=n.readBoolean(),i.ikConstraints.push(u)}for(s=n.readInt(!0),_=void(a=0);a<s;a++){for((u=new W.TransformConstraintData(n.readString())).order=n.readInt(!0),u.skinRequired=n.readBoolean(),_=n.readInt(!0),d=0;d<_;d++)u.bones.push(i.bones[n.readInt(!0)]);u.target=i.bones[n.readInt(!0)],u.local=n.readBoolean(),u.relative=n.readBoolean(),u.offsetRotation=n.readFloat(),u.offsetX=n.readFloat()*e,u.offsetY=n.readFloat()*e,u.offsetScaleX=n.readFloat(),u.offsetScaleY=n.readFloat(),u.offsetShearY=n.readFloat(),u.rotateMix=n.readFloat(),u.translateMix=n.readFloat(),u.scaleMix=n.readFloat(),u.shearMix=n.readFloat(),i.transformConstraints.push(u)}for(s=n.readInt(!0),_=void(a=0);a<s;a++){for((u=new W.PathConstraintData(n.readString())).order=n.readInt(!0),u.skinRequired=n.readBoolean(),_=n.readInt(!0),d=0;d<_;d++)u.bones.push(i.bones[n.readInt(!0)]);u.target=i.slots[n.readInt(!0)],u.positionMode=H.PositionModeValues[n.readInt(!0)],u.spacingMode=H.SpacingModeValues[n.readInt(!0)],u.rotateMode=H.RotateModeValues[n.readInt(!0)],u.offsetRotation=n.readFloat(),u.position=n.readFloat(),u.positionMode==W.PositionMode.Fixed&&(u.position*=e),u.spacing=n.readFloat(),u.spacingMode!=W.SpacingMode.Length&&u.spacingMode!=W.SpacingMode.Fixed||(u.spacing*=e),u.rotateMix=n.readFloat(),u.translateMix=n.readFloat(),i.pathConstraints.push(u)}t=this.readSkin(n,i,!0,r);for(null!=t&&(i.defaultSkin=t,i.skins.push(t)),a=i.skins.length,W.Utils.setArraySize(i.skins,s=a+n.readInt(!0));a<s;a++)i.skins[a]=this.readSkin(n,i,!1,r);for(s=this.linkedMeshes.length,a=0;a<s;a++){var f=this.linkedMeshes[a],p=null==f.skin?i.defaultSkin:i.findSkin(f.skin);if(null==p)throw new Error("Skin not found: "+f.skin);p=p.getAttachment(f.slotIndex,f.parent);if(null==p)throw new Error("Parent mesh not found: "+f.parent);f.mesh.deformAttachment=f.inheritDeform?p:f.mesh,f.mesh.setParentMesh(p),f.mesh.updateUVs()}for(this.linkedMeshes.length=0,s=n.readInt(!0),a=0;a<s;a++)(u=new W.EventData(n.readStringRef())).intValue=n.readInt(!1),u.floatValue=n.readFloat(),u.stringValue=n.readString(),u.audioPath=n.readString(),null!=u.audioPath&&(u.volume=n.readFloat(),u.balance=n.readFloat()),i.events.push(u);for(s=n.readInt(!0),a=0;a<s;a++)i.animations.push(this.readAnimation(n,n.readString(),i));return i},H.prototype.readSkin=function(t,e,i,n){var r=null,s=0;if(i){if(0==(s=t.readInt(!0)))return null;r=new W.Skin("default")}else{(r=new W.Skin(t.readStringRef())).bones.length=t.readInt(!0);for(var a=0,o=r.bones.length;a<o;a++)r.bones[a]=e.bones[t.readInt(!0)];for(o=t.readInt(!(a=0));a<o;a++)r.constraints.push(e.ikConstraints[t.readInt(!0)]);for(o=t.readInt(!(a=0));a<o;a++)r.constraints.push(e.transformConstraints[t.readInt(!0)]);for(o=t.readInt(!(a=0));a<o;a++)r.constraints.push(e.pathConstraints[t.readInt(!0)]);s=t.readInt(!0)}for(a=0;a<s;a++)for(var l=t.readInt(!0),h=0,c=t.readInt(!0);h<c;h++){var u=t.readStringRef(),_=this.readAttachment(t,e,r,l,u,n);null!=_&&r.setAttachment(l,u,_)}return r},H.prototype.readAttachment=function(t,e,i,n,r,s){var a=this.scale,o=t.readStringRef(),r=(null==o&&(o=r),t.readByte());switch(H.AttachmentTypeValues[r]){case W.AttachmentType.Region:var l=t.readStringRef(),h=t.readFloat(),c=t.readFloat(),u=t.readFloat(),_=t.readFloat(),d=t.readFloat(),f=t.readFloat(),p=t.readFloat(),m=t.readInt32(),y=(null==l&&(l=o),this.attachmentLoader.newRegionAttachment(i,o,l));return null==y?null:(y.path=l,y.x=c*a,y.y=u*a,y.scaleX=_,y.scaleY=d,y.rotation=h,y.width=f*a,y.height=p*a,W.Color.rgba8888ToColor(y.color,m),y.updateOffset(),y);case W.AttachmentType.BoundingBox:var g=t.readInt(!0),v=this.readVertices(t,g),_=(m=s?t.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(i,o));return null==_?null:(_.worldVerticesLength=g<<1,_.vertices=v.vertices,_.bones=v.bones,s&&W.Color.rgba8888ToColor(_.color,m),_);case W.AttachmentType.Mesh:var l=t.readStringRef(),m=t.readInt32(),g=t.readInt(!0),d=this.readFloatArray(t,g<<1,1),y=this.readShortArray(t),_=(v=this.readVertices(t,g),t.readInt(!0)),b=null,f=0,p=0;return s&&(b=this.readShortArray(t),f=t.readFloat(),p=t.readFloat()),null==l&&(l=o),null==(x=this.attachmentLoader.newMeshAttachment(i,o,l))?null:(x.path=l,W.Color.rgba8888ToColor(x.color,m),x.bones=v.bones,x.vertices=v.vertices,x.worldVerticesLength=g<<1,x.triangles=y,x.regionUVs=d,x.updateUVs(),x.hullLength=_<<1,s&&(x.edges=b,x.width=f*a,x.height=p*a),x);case W.AttachmentType.LinkedMesh:l=t.readStringRef(),m=t.readInt32();var x,y=t.readStringRef(),d=t.readStringRef(),_=t.readBoolean();return p=f=0,s&&(f=t.readFloat(),p=t.readFloat()),null==l&&(l=o),null==(x=this.attachmentLoader.newMeshAttachment(i,o,l))?null:(x.path=l,W.Color.rgba8888ToColor(x.color,m),s&&(x.width=f*a,x.height=p*a),this.linkedMeshes.push(new Z(x,y,n,d,_)),x);case W.AttachmentType.Path:for(var b=t.readBoolean(),f=t.readBoolean(),A=(g=t.readInt(!0),v=this.readVertices(t,g),W.Utils.newArray(g/3,0)),C=0,T=A.length;C<T;C++)A[C]=t.readFloat()*a;return m=s?t.readInt32():0,null==(l=this.attachmentLoader.newPathAttachment(i,o))?null:(l.closed=b,l.constantSpeed=f,l.worldVerticesLength=g<<1,l.vertices=v.vertices,l.bones=v.bones,l.lengths=A,s&&W.Color.rgba8888ToColor(l.color,m),l);case W.AttachmentType.Point:h=t.readFloat(),c=t.readFloat(),u=t.readFloat(),m=s?t.readInt32():0;p=this.attachmentLoader.newPointAttachment(i,o);return null==p?null:(p.x=c*a,p.y=u*a,p.rotation=h,s&&W.Color.rgba8888ToColor(p.color,m),p);case W.AttachmentType.Clipping:y=t.readInt(!0),d=(g=t.readInt(!0),v=this.readVertices(t,g),m=s?t.readInt32():0,this.attachmentLoader.newClippingAttachment(i,o));return null==d?null:(d.endSlot=e.slots[y],d.worldVerticesLength=g<<1,d.vertices=v.vertices,d.bones=v.bones,s&&W.Color.rgba8888ToColor(d.color,m),d)}return null},H.prototype.readVertices=function(t,e){var i=e<<1,n=new K,r=this.scale;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,i,r),n;for(var s=new Array,a=new Array,o=0;o<e;o++){var l=t.readInt(!0);a.push(l);for(var h=0;h<l;h++)a.push(t.readInt(!0)),s.push(t.readFloat()*r),s.push(t.readFloat()*r),s.push(t.readFloat())}return n.vertices=W.Utils.toFloatArray(s),n.bones=a,n},H.prototype.readFloatArray=function(t,e,i){var n=new Array(e);if(1==i)for(var r=0;r<e;r++)n[r]=t.readFloat();else for(r=0;r<e;r++)n[r]=t.readFloat()*i;return n},H.prototype.readShortArray=function(t){for(var e=t.readInt(!0),i=new Array(e),n=0;n<e;n++)i[n]=t.readShort();return i},H.prototype.readAnimation=function(t,F,e){for(var i=new Array,n=this.scale,r=0,s=new W.Color,a=new W.Color,o=0,l=t.readInt(!0);o<l;o++)for(var h=t.readInt(!0),c=0,u=t.readInt(!0);c<u;c++){var _=t.readByte(),d=t.readInt(!0);switch(_){case H.SLOT_ATTACHMENT:(y=new W.AttachmentTimeline(d)).slotIndex=h;for(var f=0;f<d;f++)y.setFrame(f,t.readFloat(),t.readStringRef());i.push(y),r=Math.max(r,y.frames[d-1]);break;case H.SLOT_COLOR:for((y=new W.ColorTimeline(d)).slotIndex=h,f=0;f<d;f++){var p=t.readFloat();W.Color.rgba8888ToColor(s,t.readInt32()),y.setFrame(f,p,s.r,s.g,s.b,s.a),f<d-1&&this.readCurve(t,f,y)}i.push(y),r=Math.max(r,y.frames[(d-1)*W.ColorTimeline.ENTRIES]);break;case H.SLOT_TWO_COLOR:for((y=new W.TwoColorTimeline(d)).slotIndex=h,f=0;f<d;f++)p=t.readFloat(),W.Color.rgba8888ToColor(s,t.readInt32()),W.Color.rgb888ToColor(a,t.readInt32()),y.setFrame(f,p,s.r,s.g,s.b,s.a,a.r,a.g,a.b),f<d-1&&this.readCurve(t,f,y);i.push(y),r=Math.max(r,y.frames[(d-1)*W.TwoColorTimeline.ENTRIES])}}for(l=t.readInt(!(o=0));o<l;o++)for(var m=t.readInt(!0),c=0,u=t.readInt(!0);c<u;c++)switch(_=t.readByte(),d=t.readInt(!0),_){case H.BONE_ROTATE:for((y=new W.RotateTimeline(d)).boneIndex=m,f=0;f<d;f++)y.setFrame(f,t.readFloat(),t.readFloat()),f<d-1&&this.readCurve(t,f,y);i.push(y),r=Math.max(r,y.frames[(d-1)*W.RotateTimeline.ENTRIES]);break;case H.BONE_TRANSLATE:case H.BONE_SCALE:case H.BONE_SHEAR:var y=void 0,g=1;for(_==H.BONE_SCALE?y=new W.ScaleTimeline(d):_==H.BONE_SHEAR?y=new W.ShearTimeline(d):(y=new W.TranslateTimeline(d),g=n),y.boneIndex=m,f=0;f<d;f++)y.setFrame(f,t.readFloat(),t.readFloat()*g,t.readFloat()*g),f<d-1&&this.readCurve(t,f,y);i.push(y),r=Math.max(r,y.frames[(d-1)*W.TranslateTimeline.ENTRIES])}for(l=t.readInt(!(o=0));o<l;o++){var v=t.readInt(!0),d=t.readInt(!0);for((y=new W.IkConstraintTimeline(d)).ikConstraintIndex=v,f=0;f<d;f++)y.setFrame(f,t.readFloat(),t.readFloat(),t.readFloat()*n,t.readByte(),t.readBoolean(),t.readBoolean()),f<d-1&&this.readCurve(t,f,y);i.push(y),r=Math.max(r,y.frames[(d-1)*W.IkConstraintTimeline.ENTRIES])}for(l=t.readInt(!(o=0));o<l;o++){for(v=t.readInt(!0),d=t.readInt(!0),(y=new W.TransformConstraintTimeline(d)).transformConstraintIndex=v,f=0;f<d;f++)y.setFrame(f,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),f<d-1&&this.readCurve(t,f,y);i.push(y),r=Math.max(r,y.frames[(d-1)*W.TransformConstraintTimeline.ENTRIES])}for(l=t.readInt(!(o=0));o<l;o++){var v=t.readInt(!0),b=e.pathConstraints[v];for(u=t.readInt(!(c=0));c<u;c++)switch(_=t.readByte(),d=t.readInt(!0),_){case H.PATH_POSITION:case H.PATH_SPACING:for(y=void 0,g=1,_==H.PATH_SPACING?(y=new W.PathConstraintSpacingTimeline(d),b.spacingMode!=W.SpacingMode.Length&&b.spacingMode!=W.SpacingMode.Fixed||(g=n)):(y=new W.PathConstraintPositionTimeline(d),b.positionMode==W.PositionMode.Fixed&&(g=n)),y.pathConstraintIndex=v,f=0;f<d;f++)y.setFrame(f,t.readFloat(),t.readFloat()*g),f<d-1&&this.readCurve(t,f,y);i.push(y),r=Math.max(r,y.frames[(d-1)*W.PathConstraintPositionTimeline.ENTRIES]);break;case H.PATH_MIX:for((y=new W.PathConstraintMixTimeline(d)).pathConstraintIndex=v,f=0;f<d;f++)y.setFrame(f,t.readFloat(),t.readFloat(),t.readFloat()),f<d-1&&this.readCurve(t,f,y);i.push(y),r=Math.max(r,y.frames[(d-1)*W.PathConstraintMixTimeline.ENTRIES])}}for(l=t.readInt(!(o=0));o<l;o++){var V=e.skins[t.readInt(!0)];for(u=t.readInt(!(c=0));c<u;c++)for(var h=t.readInt(!0),N=0,k=t.readInt(!0);N<k;N++){var x=V.getAttachment(h,t.readStringRef()),A=null!=x.bones,C=x.vertices,z=A?C.length/3*2:C.length;for(d=t.readInt(!0),(y=new W.DeformTimeline(d)).slotIndex=h,y.attachment=x,f=0;f<d;f++){var p=t.readFloat(),T=void 0,S=t.readInt(!0);if(0==S)T=A?W.Utils.newFloatArray(z):C;else{var T=W.Utils.newFloatArray(z),w=t.readInt(!0);if(S+=w,1==n)for(var E=w;E<S;E++)T[E]=t.readFloat();else for(E=w;E<S;E++)T[E]=t.readFloat()*n;if(!A)for(var E=0,G=T.length;E<G;E++)T[E]+=C[E]}y.setFrame(f,p,T),f<d-1&&this.readCurve(t,f,y)}i.push(y),r=Math.max(r,y.frames[d-1])}}var M=t.readInt(!0);if(0<M){for(var y=new W.DrawOrderTimeline(M),D=e.slots.length,o=0;o<M;o++){p=t.readFloat();var U=t.readInt(!0),B=W.Utils.newArray(D,0);for(c=D-1;0<=c;c--)B[c]=-1;var I=W.Utils.newArray(D-U,0),P=0,R=0;for(c=0;c<U;c++){for(h=t.readInt(!0);P!=h;)I[R++]=P++;B[P+t.readInt(!0)]=P++}for(;P<D;)I[R++]=P++;for(c=D-1;0<=c;c--)-1==B[c]&&(B[c]=I[--R]);y.setFrame(o,p,B)}i.push(y),r=Math.max(r,y.frames[M-1])}var O=t.readInt(!0);if(0<O){for(y=new W.EventTimeline(O),o=0;o<O;o++){p=t.readFloat();var j=e.events[t.readInt(!0)],L=new W.Event(p,j);L.intValue=t.readInt(!1),L.floatValue=t.readFloat(),L.stringValue=t.readBoolean()?t.readString():j.stringValue,null!=L.data.audioPath&&(L.volume=t.readFloat(),L.balance=t.readFloat()),y.setFrame(o,L)}i.push(y),r=Math.max(r,y.frames[O-1])}return new W.Animation(F,i,r)},H.prototype.readCurve=function(t,e,i){switch(t.readByte()){case H.CURVE_STEPPED:i.setStepped(e);break;case H.CURVE_BEZIER:this.setCurve(i,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},H.prototype.setCurve=function(t,e,i,n,r,s){t.setCurve(e,i,n,r,s)},H.AttachmentTypeValues=[0,1,2,3,4,5,6],H.TransformModeValues=[W.TransformMode.Normal,W.TransformMode.OnlyTranslation,W.TransformMode.NoRotationOrReflection,W.TransformMode.NoScale,W.TransformMode.NoScaleOrReflection],H.PositionModeValues=[W.PositionMode.Fixed,W.PositionMode.Percent],H.SpacingModeValues=[W.SpacingMode.Length,W.SpacingMode.Fixed,W.SpacingMode.Percent],H.RotateModeValues=[W.RotateMode.Tangent,W.RotateMode.Chain,W.RotateMode.ChainScale],H.BlendModeValues=[W.BlendMode.Normal,W.BlendMode.Additive,W.BlendMode.Multiply,W.BlendMode.Screen],H.BONE_ROTATE=0,H.BONE_TRANSLATE=1,H.BONE_SCALE=2,H.BONE_SHEAR=3,H.SLOT_ATTACHMENT=0,H.SLOT_COLOR=1,H.SLOT_TWO_COLOR=2,H.PATH_POSITION=0,H.PATH_SPACING=1,H.PATH_MIX=2,H.CURVE_LINEAR=0,H.CURVE_STEPPED=1,H.CURVE_BEZIER=2,H);function H(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}W.SkeletonBinary=m,y.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},y.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},y.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},y.prototype.readInt=function(t){var e=this.readByte(),i=127&e;return 0!=(128&e)&&(i|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(i|=(127&this.readByte())<<28)))),t?i:i>>>1^-(1&i)},y.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},y.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",i=0;i<t;){var n=this.readByte();switch(n>>4){case 12:case 13:e+=String.fromCharCode((31&n)<<6|63&this.readByte()),i+=2;break;case 14:e+=String.fromCharCode((15&n)<<12|(63&this.readByte())<<6|63&this.readByte()),i+=3;break;default:e+=String.fromCharCode(n),i++}}return e},y.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},y.prototype.readBoolean=function(){return 0!=this.readByte()};var J=y,Z=function(t,e,i,n,r){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=n,this.inheritDeform=r},K=function(t,e){void 0===e&&(e=null),this.bones=t=void 0===t?null:t,this.vertices=e};function y(t,e,i,n){void 0===e&&(e=new Array),void 0===i&&(i=0),void 0===n&&(n=new DataView(t.buffer)),this.strings=e,this.index=i,this.buffer=n}(function(u){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new u.Pool(function(){return u.Utils.newFloatArray(16)})}t.prototype.update=function(t,e){if(null==t)throw new Error("skeleton cannot be null.");var i=this.boundingBoxes,n=this.polygons,r=this.polygonPool,s=t.slots,a=s.length;i.length=0,r.freeAll(n);for(var o=n.length=0;o<a;o++){var l,h,c=s[o];!c.bone.active||(l=c.getAttachment())instanceof u.BoundingBoxAttachment&&(i.push(l=l),(h=r.obtain()).length!=l.worldVerticesLength&&(h=u.Utils.newFloatArray(l.worldVerticesLength)),n.push(h),l.computeWorldVertices(c,0,l.worldVerticesLength,h,0,2))}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},t.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=this.polygons,s=0,a=r.length;s<a;s++)for(var o=r[s],l=o,h=0,c=o.length;h<c;h+=2)var u=l[h],_=l[h+1],t=Math.min(t,u),e=Math.min(e,_),i=Math.max(i,u),n=Math.max(n,_);this.minX=t,this.minY=e,this.maxX=i,this.maxY=n},t.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},t.prototype.aabbIntersectsSegment=function(t,e,i,n){var r=this.minX,s=this.minY,a=this.maxX,o=this.maxY;if(t<=r&&i<=r||e<=s&&n<=s||a<=t&&a<=i||o<=e&&o<=n)return!1;n=(n-e)/(i-t),i=n*(r-t)+e;if(s<i&&i<o)return!0;if((i=n*(a-t)+e)>s&&i<o)return!0;i=(s-e)/n+t;return r<i&&i<a||(i=(o-e)/n+t)>r&&i<a},t.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},t.prototype.containsPoint=function(t,e){for(var i=this.polygons,n=0,r=i.length;n<r;n++)if(this.containsPointPolygon(i[n],t,e))return this.boundingBoxes[n];return null},t.prototype.containsPointPolygon=function(t,e,i){for(var n=t,r=t.length,s=r-2,a=!1,o=0;o<r;o+=2){var l,h=n[o+1],c=n[s+1];!(h<i&&i<=c||c<i&&i<=h)||(l=n[o])+(i-h)/(c-h)*(n[s]-l)<e&&(a=!a),s=o}return a},t.prototype.intersectsSegment=function(t,e,i,n){for(var r=this.polygons,s=0,a=r.length;s<a;s++)if(this.intersectsSegmentPolygon(r[s],t,e,i,n))return this.boundingBoxes[s];return null},t.prototype.intersectsSegmentPolygon=function(t,e,i,n,r){for(var s=t,a=t.length,o=e-n,l=i-r,h=e*r-i*n,c=s[a-2],u=s[a-1],_=0;_<a;_+=2){var d=s[_],f=s[_+1],p=c*f-u*d,m=c-d,y=u-f,g=o*y-l*m,m=(h*m-o*p)/g;if((c<=m&&m<=d||d<=m&&m<=c)&&(e<=m&&m<=n||n<=m&&m<=e)){m=(h*y-l*p)/g;if((u<=m&&m<=f||f<=m&&m<=u)&&(i<=m&&m<=r||r<=m&&m<=i))return!0}c=d,u=f}return!1},t.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");t=this.boundingBoxes.indexOf(t);return-1==t?null:this.polygons[t]},t.prototype.getWidth=function(){return this.maxX-this.minX},t.prototype.getHeight=function(){return this.maxY-this.minY},u.SkeletonBounds=t})(t=t||{}),function(Q){function l(){this.triangulator=new Q.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}l.prototype.clipStart=function(t,e){if(null!=this.clipAttachment)return 0;var i=(this.clipAttachment=e).worldVerticesLength,n=Q.Utils.setArraySize(this.clippingPolygon,i),e=(e.computeWorldVertices(t,0,i,n,0,2),this.clippingPolygon);l.makeClockwise(e);for(var r=this.clippingPolygons=this.triangulator.decompose(e,this.triangulator.triangulate(e)),s=0,a=r.length;s<a;s++){var o=r[s];l.makeClockwise(o),o.push(o[0]),o.push(o[1])}return r.length},l.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},l.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},l.prototype.isClipping=function(){return null!=this.clipAttachment},l.prototype.clipTriangles=function(t,F,e,V,i,n,r,s,a,o,l,h){var N=this.clipOutput,c=this.clippedVertices,u=this.clippedTriangles,k=this.clippingPolygons,z=this.clippingPolygons.length,_=s?12:8,d=0;o=o||0,l=l||0,h=h||0,c.length=0,u.length=0;t:for(var f=o,G=o+V;f<G;f+=3){var p=e[f]*a,m=p+l,y=t[m],g=t[m+1],v=i[x=p+h],b=i[x+1],x=(p=e[f+1]*a)+h,A=t[m=p+l],C=t[m+1],T=i[x],S=i[x+1];x=(p=e[f+2]*a)+h;for(var w=t[m=p+l],E=t[m+1],M=i[x],U=i[x+1],j=0;j<z;j++){var D=c.length;if(!this.clip(y,g,A,C,w,E,k[j],N)){(I=Q.Utils.setArraySize(c,D+3*_))[D]=y,I[D+1]=g,I[D+2]=n.r,I[D+3]=n.g,I[D+4]=n.b,I[D+5]=n.a,s?(I[D+6]=v,I[D+7]=b,I[D+8]=r.r,I[D+9]=r.g,I[D+10]=r.b,I[D+11]=r.a,I[D+12]=A,I[D+13]=C,I[D+14]=n.r,I[D+15]=n.g,I[D+16]=n.b,I[D+17]=n.a,I[D+18]=T,I[D+19]=S,I[D+20]=r.r,I[D+21]=r.g,I[D+22]=r.b,I[D+23]=r.a,I[D+24]=w,I[D+25]=E,I[D+26]=n.r,I[D+27]=n.g,I[D+28]=n.b,I[D+29]=n.a,I[D+30]=M,I[D+31]=U,I[D+32]=r.r,I[D+33]=r.g,I[D+34]=r.b,I[D+35]=r.a):(I[D+6]=v,I[D+7]=b,I[D+8]=A,I[D+9]=C,I[D+10]=n.r,I[D+11]=n.g,I[D+12]=n.b,I[D+13]=n.a,I[D+14]=T,I[D+15]=S,I[D+16]=w,I[D+17]=E,I[D+18]=n.r,I[D+19]=n.g,I[D+20]=n.b,I[D+21]=n.a,I[D+22]=M,I[D+23]=U),D=u.length,(L=Q.Utils.setArraySize(u,D+3))[D]=d,L[D+1]=d+1,L[D+2]=d+2,d+=3;continue t}var W=N.length;if(0!=W){for(var H=C-E,X=w-A,Y=y-w,q=E-g,J=1/(H*Y+X*(g-E)),B=W>>1,Z=this.clipOutput,I=Q.Utils.setArraySize(c,D+B*_),P=0;P<W;P+=2){var R=Z[P],O=Z[P+1],R=(I[D]=R,I[D+1]=O,I[D+2]=n.r,I[D+3]=n.g,I[D+4]=n.b,I[D+5]=n.a,R-w),O=O-E,K=(H*R+X*O)*J,R=(q*R+Y*O)*J,O=1-K-R;I[D+6]=v*K+T*R+M*O,I[D+7]=b*K+S*R+U*O,s&&(I[D+8]=r.r,I[D+9]=r.g,I[D+10]=r.b,I[D+11]=r.a),D+=_}var D=u.length,L=Q.Utils.setArraySize(u,D+3*(B-2));for(B--,P=1;P<B;P++)L[D]=d,L[D+1]=d+P,L[D+2]=d+P+1,D+=3;d+=1+B}}}},l.prototype.clip=function(t,e,i,n,r,s,a,o){var l=o,h=!1,c=null;2<=a.length%4?(c=o,o=this.scratch):c=this.scratch,c.length=0,c.push(t),c.push(e),c.push(i),c.push(n),c.push(r),c.push(s),c.push(t),c.push(e),o.length=0;for(var u=a,_=a.length-4,d=0;;d+=2){for(var f=u[d],p=u[d+1],m=u[d+2],y=u[d+3],g=f-m,v=p-y,b=c,x=c.length-2,A=o.length,C=0;C<x;C+=2){var T,S,w=b[C],E=b[C+1],M=b[C+2],D=b[C+3],B=0<g*(D-y)-v*(M-m);if(0<g*(E-y)-v*(w-m)){if(B){o.push(M),o.push(D);continue}var I,P=(T=D-E)*(m-f)-(S=M-w)*(y-p);1e-6<Math.abs(P)?(o.push(f+(m-f)*(I=(S*(p-E)-T*(f-w))/P)),o.push(p+(y-p)*I)):(o.push(f),o.push(p))}else B&&(P=(T=D-E)*(m-f)-(S=M-w)*(y-p),1e-6<Math.abs(P)?(o.push(f+(m-f)*(I=(S*(p-E)-T*(f-w))/P)),o.push(p+(y-p)*I)):(o.push(f),o.push(p)),o.push(M),o.push(D));h=!0}if(A==o.length)return!(l.length=0);if(o.push(o[0]),o.push(o[1]),d==_)break;A=o;(o=c).length=0,c=A}if(l!=o)for(var d=l.length=0,R=o.length-2;d<R;d++)l[d]=o[d];else l.length=l.length-2;return h},l.makeClockwise=function(t){for(var e,i,n,r=t,t=t.length,s=r[t-2]*r[1]-r[0]*r[t-1],a=0,o=t-3;a<o;a+=2)e=r[a],i=r[a+1],n=r[a+2],s+=e*r[a+3]-n*i;if(!(s<0))for(var a=0,l=t-2,o=t>>1;a<o;a+=2){var h=r[a],c=r[a+1],u=l-a;r[a]=r[u],r[a+1]=r[1+u],r[u]=h,r[1+u]=c}},Q.SkeletonClipping=l}(t=t||{}),function(t){function e(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},e.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t.SkeletonData=e}(t=t||{}),function(et){function O(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}O.prototype.readSkeletonData=function(t){var e=this.scale,i=new et.SkeletonData,n="string"==typeof t?JSON.parse(t):t,t=n.skeleton;if(null!=t&&(i.hash=t.hash,i.version=t.spine,i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,i.fps=t.fps,i.imagesPath=t.images),n.bones)for(var r=0;r<n.bones.length;r++){var s=n.bones[r],a=null,o=this.getValue(s,"parent",null);if(null!=o&&null==(a=i.findBone(o)))throw new Error("Parent bone not found: "+o);(u=new et.BoneData(i.bones.length,s.name,a)).length=this.getValue(s,"length",0)*e,u.x=this.getValue(s,"x",0)*e,u.y=this.getValue(s,"y",0)*e,u.rotation=this.getValue(s,"rotation",0),u.scaleX=this.getValue(s,"scaleX",1),u.scaleY=this.getValue(s,"scaleY",1),u.shearX=this.getValue(s,"shearX",0),u.shearY=this.getValue(s,"shearY",0),u.transformMode=O.transformModeFromString(this.getValue(s,"transform","normal")),u.skinRequired=this.getValue(s,"skin",!1),i.bones.push(u)}if(n.slots)for(r=0;r<n.slots.length;r++){var l=(S=n.slots[r]).name,h=S.bone,c=i.findBone(h);if(null==c)throw new Error("Slot bone not found: "+h);var u=new et.SlotData(i.slots.length,l,c),c=this.getValue(S,"color",null),c=(null!=c&&u.color.setFromString(c),this.getValue(S,"dark",null));null!=c&&(u.darkColor=new et.Color(1,1,1,1),u.darkColor.setFromString(c)),u.attachmentName=this.getValue(S,"attachment",null),u.blendMode=O.blendModeFromString(this.getValue(S,"blend","normal")),i.slots.push(u)}if(n.ik)for(r=0;r<n.ik.length;r++){var _=n.ik[r];(u=new et.IkConstraintData(_.name)).order=this.getValue(_,"order",0),u.skinRequired=this.getValue(_,"skin",!1);for(var d=0;d<_.bones.length;d++){if(h=_.bones[d],null==(g=i.findBone(h)))throw new Error("IK bone not found: "+h);u.bones.push(g)}var f=_.target;if(u.target=i.findBone(f),null==u.target)throw new Error("IK target bone not found: "+f);u.mix=this.getValue(_,"mix",1),u.softness=this.getValue(_,"softness",0)*e,u.bendDirection=this.getValue(_,"bendPositive",!0)?1:-1,u.compress=this.getValue(_,"compress",!1),u.stretch=this.getValue(_,"stretch",!1),u.uniform=this.getValue(_,"uniform",!1),i.ikConstraints.push(u)}if(n.transform)for(r=0;r<n.transform.length;r++){for(_=n.transform[r],(u=new et.TransformConstraintData(_.name)).order=this.getValue(_,"order",0),u.skinRequired=this.getValue(_,"skin",!1),d=0;d<_.bones.length;d++){if(h=_.bones[d],null==(g=i.findBone(h)))throw new Error("Transform constraint bone not found: "+h);u.bones.push(g)}if(f=_.target,u.target=i.findBone(f),null==u.target)throw new Error("Transform constraint target bone not found: "+f);u.local=this.getValue(_,"local",!1),u.relative=this.getValue(_,"relative",!1),u.offsetRotation=this.getValue(_,"rotation",0),u.offsetX=this.getValue(_,"x",0)*e,u.offsetY=this.getValue(_,"y",0)*e,u.offsetScaleX=this.getValue(_,"scaleX",0),u.offsetScaleY=this.getValue(_,"scaleY",0),u.offsetShearY=this.getValue(_,"shearY",0),u.rotateMix=this.getValue(_,"rotateMix",1),u.translateMix=this.getValue(_,"translateMix",1),u.scaleMix=this.getValue(_,"scaleMix",1),u.shearMix=this.getValue(_,"shearMix",1),i.transformConstraints.push(u)}if(n.path)for(r=0;r<n.path.length;r++){for(_=n.path[r],(u=new et.PathConstraintData(_.name)).order=this.getValue(_,"order",0),u.skinRequired=this.getValue(_,"skin",!1),d=0;d<_.bones.length;d++){if(h=_.bones[d],null==(g=i.findBone(h)))throw new Error("Transform constraint bone not found: "+h);u.bones.push(g)}if(f=_.target,u.target=i.findSlot(f),null==u.target)throw new Error("Path target slot not found: "+f);u.positionMode=O.positionModeFromString(this.getValue(_,"positionMode","percent")),u.spacingMode=O.spacingModeFromString(this.getValue(_,"spacingMode","length")),u.rotateMode=O.rotateModeFromString(this.getValue(_,"rotateMode","tangent")),u.offsetRotation=this.getValue(_,"rotation",0),u.position=this.getValue(_,"position",0),u.positionMode==et.PositionMode.Fixed&&(u.position*=e),u.spacing=this.getValue(_,"spacing",0),u.spacingMode!=et.SpacingMode.Length&&u.spacingMode!=et.SpacingMode.Fixed||(u.spacing*=e),u.rotateMix=this.getValue(_,"rotateMix",1),u.translateMix=this.getValue(_,"translateMix",1),i.pathConstraints.push(u)}if(n.skins){var p=n.skins;if(!(p instanceof Array)){var m,y=[];for(m in p)y.push({name:m,attachments:p[m]});p=y}for(r=0;r<p.length;r++){var g,v,b=p[r],x=new et.Skin(b.name);if(b.bones)for(var A=0;A<b.bones.length;A++){if(null==(g=i.findBone(b.bones[A])))throw new Error("Skin bone not found: "+b.bones[r]);x.bones.push(g)}if(b.ik)for(A=0;A<b.ik.length;A++){if(null==(v=i.findIkConstraint(b.ik[A])))throw new Error("Skin IK constraint not found: "+b.ik[r]);x.constraints.push(v)}if(b.transform)for(A=0;A<b.transform.length;A++){if(null==(v=i.findTransformConstraint(b.transform[A])))throw new Error("Skin transform constraint not found: "+b.transform[r]);x.constraints.push(v)}if(b.path)for(A=0;A<b.path.length;A++){if(null==(v=i.findPathConstraint(b.path[A])))throw new Error("Skin path constraint not found: "+b.path[r]);x.constraints.push(v)}for(l in b.attachments){var C=i.findSlot(l);if(null==C)throw new Error("Slot not found: "+l);var T,S=b.attachments[l];for(T in S){var w=this.readAttachment(S[T],x,C.index,T,i);null!=w&&x.setAttachment(C.index,T,w)}}i.skins.push(x),"default"==x.name&&(i.defaultSkin=x)}}for(var r=0,E=this.linkedMeshes.length;r<E;r++){var M=this.linkedMeshes[r];if(null==(x=null==M.skin?i.defaultSkin:i.findSkin(M.skin)))throw new Error("Skin not found: "+M.skin);var D=x.getAttachment(M.slotIndex,M.parent);if(null==D)throw new Error("Parent mesh not found: "+M.parent);M.mesh.deformAttachment=M.inheritDeform?D:M.mesh,M.mesh.setParentMesh(D),M.mesh.updateUVs()}if(this.linkedMeshes.length=0,n.events)for(var B in n.events){var I=n.events[B];(u=new et.EventData(B)).intValue=this.getValue(I,"int",0),u.floatValue=this.getValue(I,"float",0),u.stringValue=this.getValue(I,"string",""),u.audioPath=this.getValue(I,"audio",null),null!=u.audioPath&&(u.volume=this.getValue(I,"volume",1),u.balance=this.getValue(I,"balance",0)),i.events.push(u)}if(n.animations)for(var P in n.animations){var R=n.animations[P];this.readAnimation(R,P,i)}return i},O.prototype.readAttachment=function(t,e,i,n,r){var s=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":var a=this.getValue(t,"path",n),o=this.attachmentLoader.newRegionAttachment(e,n,a);return null==o?null:(o.path=a,o.x=this.getValue(t,"x",0)*s,o.y=this.getValue(t,"y",0)*s,o.scaleX=this.getValue(t,"scaleX",1),o.scaleY=this.getValue(t,"scaleY",1),o.rotation=this.getValue(t,"rotation",0),o.width=t.width*s,o.height=t.height*s,null!=(_=this.getValue(t,"color",null))&&o.color.setFromString(_),o.updateOffset(),o);case"boundingbox":o=this.attachmentLoader.newBoundingBoxAttachment(e,n);return null==o?null:(this.readVertices(t,o,t.vertexCount<<1),null!=(_=this.getValue(t,"color",null))&&o.color.setFromString(_),o);case"mesh":case"linkedmesh":a=this.getValue(t,"path",n),o=this.attachmentLoader.newMeshAttachment(e,n,a);if(null==o)return null;o.path=a,null!=(_=this.getValue(t,"color",null))&&o.color.setFromString(_),o.width=this.getValue(t,"width",0)*s,o.height=this.getValue(t,"height",0)*s;var l=this.getValue(t,"parent",null);if(null!=l)return this.linkedMeshes.push(new d(o,this.getValue(t,"skin",null),i,l,this.getValue(t,"deform",!0))),o;l=t.uvs;return this.readVertices(t,o,l.length),o.triangles=t.triangles,o.regionUVs=l,o.updateUVs(),o.edges=this.getValue(t,"edges",null),o.hullLength=2*this.getValue(t,"hull",0),o;case"path":if(null==(a=this.attachmentLoader.newPathAttachment(e,n)))return null;a.closed=this.getValue(t,"closed",!1),a.constantSpeed=this.getValue(t,"constantSpeed",!0);var h=t.vertexCount;this.readVertices(t,a,h<<1);for(var c=et.Utils.newArray(h/3,0),u=0;u<t.lengths.length;u++)c[u]=t.lengths[u]*s;return a.lengths=c,null!=(_=this.getValue(t,"color",null))&&a.color.setFromString(_),a;case"point":l=this.attachmentLoader.newPointAttachment(e,n);return null==l?null:(l.x=this.getValue(t,"x",0)*s,l.y=this.getValue(t,"y",0)*s,l.rotation=this.getValue(t,"rotation",0),null!=(_=this.getValue(t,"color",null))&&l.color.setFromString(_),l);case"clipping":o=this.attachmentLoader.newClippingAttachment(e,n);if(null==o)return null;var _,a=this.getValue(t,"end",null);if(null!=a){l=r.findSlot(a);if(null==l)throw new Error("Clipping end slot not found: "+a);o.endSlot=l}return h=t.vertexCount,this.readVertices(t,o,h<<1),null!=(_=this.getValue(t,"color",null))&&o.color.setFromString(_),o}return null},O.prototype.readVertices=function(t,e,i){var n=this.scale,r=(e.worldVerticesLength=i,t.vertices);if(i!=r.length){for(var s=new Array,a=new Array,o=0,l=r.length;o<l;){var h=r[o++];a.push(h);for(var c=o+4*h;o<c;o+=4)a.push(r[o]),s.push(r[o+1]*n),s.push(r[o+2]*n),s.push(r[o+3])}e.bones=a,e.vertices=et.Utils.toFloatArray(s)}else{var u=et.Utils.toFloatArray(r);if(1!=n)for(var o=0,l=r.length;o<l;o++)u[o]*=n;e.vertices=u}},O.prototype.readAnimation=function(t,F,e){var i=this.scale,n=new Array,r=0;if(t.slots)for(var s in t.slots){var a=t.slots[s];if(-1==(P=e.findSlotIndex(s)))throw new Error("Slot not found: "+s);for(x in a){var o=a[x];if("attachment"==x){(m=new et.AttachmentTimeline(o.length)).slotIndex=P;for(var l=0,h=0;h<o.length;h++){var c=o[h];m.setFrame(l++,this.getValue(c,"time",0),c.name)}n.push(m),r=Math.max(r,m.frames[m.getFrameCount()-1])}else if("color"==x){for((m=new et.ColorTimeline(o.length)).slotIndex=P,h=l=0;h<o.length;h++){var c=o[h],u=new et.Color;u.setFromString(c.color),m.setFrame(l,this.getValue(c,"time",0),u.r,u.g,u.b,u.a),this.readCurve(c,m,l),l++}n.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*et.ColorTimeline.ENTRIES])}else{if("twoColor"!=x)throw new Error("Invalid timeline type for a slot: "+x+" ("+s+")");for((m=new et.TwoColorTimeline(o.length)).slotIndex=P,h=l=0;h<o.length;h++){c=o[h];var _=new et.Color,d=new et.Color;_.setFromString(c.light),d.setFromString(c.dark),m.setFrame(l,this.getValue(c,"time",0),_.r,_.g,_.b,_.a,d.r,d.g,d.b),this.readCurve(c,m,l),l++}n.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*et.TwoColorTimeline.ENTRIES])}}}if(t.bones)for(var f in t.bones){var V=t.bones[f],p=e.findBoneIndex(f);if(-1==p)throw new Error("Bone not found: "+f);for(x in V)if(o=V[x],"rotate"===x){for((m=new et.RotateTimeline(o.length)).boneIndex=p,h=l=0;h<o.length;h++)c=o[h],m.setFrame(l,this.getValue(c,"time",0),this.getValue(c,"angle",0)),this.readCurve(c,m,l),l++;n.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*et.RotateTimeline.ENTRIES])}else{if("translate"!==x&&"scale"!==x&&"shear"!==x)throw new Error("Invalid timeline type for a bone: "+x+" ("+f+")");var m=null,y=1,N=0;for("scale"===x?(m=new et.ScaleTimeline(o.length),N=1):"shear"===x?m=new et.ShearTimeline(o.length):(m=new et.TranslateTimeline(o.length),y=i),m.boneIndex=p,h=l=0;h<o.length;h++){c=o[h];var k=this.getValue(c,"x",N),z=this.getValue(c,"y",N);m.setFrame(l,this.getValue(c,"time",0),k*y,z*y),this.readCurve(c,m,l),l++}n.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*et.TranslateTimeline.ENTRIES])}}if(t.ik)for(var g in t.ik){var v=t.ik[g],G=e.findIkConstraint(g);for((m=new et.IkConstraintTimeline(v.length)).ikConstraintIndex=e.ikConstraints.indexOf(G),h=l=0;h<v.length;h++)c=v[h],m.setFrame(l,this.getValue(c,"time",0),this.getValue(c,"mix",1),this.getValue(c,"softness",0)*i,this.getValue(c,"bendPositive",!0)?1:-1,this.getValue(c,"compress",!1),this.getValue(c,"stretch",!1)),this.readCurve(c,m,l),l++;n.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*et.IkConstraintTimeline.ENTRIES])}if(t.transform)for(var g in t.transform){for(v=t.transform[g],G=e.findTransformConstraint(g),(m=new et.TransformConstraintTimeline(v.length)).transformConstraintIndex=e.transformConstraints.indexOf(G),h=l=0;h<v.length;h++)c=v[h],m.setFrame(l,this.getValue(c,"time",0),this.getValue(c,"rotateMix",1),this.getValue(c,"translateMix",1),this.getValue(c,"scaleMix",1),this.getValue(c,"shearMix",1)),this.readCurve(c,m,l),l++;n.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*et.TransformConstraintTimeline.ENTRIES])}var U=t.path||t.paths;if(U)for(var g in U){var v=U[g],b=e.findPathConstraintIndex(g);if(-1==b)throw new Error("Path constraint not found: "+g);var j=e.pathConstraints[b];for(x in v)if(o=v[x],"position"===x||"spacing"===x){for(m=null,y=1,"spacing"===x?(m=new et.PathConstraintSpacingTimeline(o.length),j.spacingMode!=et.SpacingMode.Length&&j.spacingMode!=et.SpacingMode.Fixed||(y=i)):(m=new et.PathConstraintPositionTimeline(o.length),j.positionMode==et.PositionMode.Fixed&&(y=i)),m.pathConstraintIndex=b,h=l=0;h<o.length;h++)c=o[h],m.setFrame(l,this.getValue(c,"time",0),this.getValue(c,x,0)*y),this.readCurve(c,m,l),l++;n.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*et.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===x){for((m=new et.PathConstraintMixTimeline(o.length)).pathConstraintIndex=b,h=l=0;h<o.length;h++)c=o[h],m.setFrame(l,this.getValue(c,"time",0),this.getValue(c,"rotateMix",1),this.getValue(c,"translateMix",1)),this.readCurve(c,m,l),l++;n.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*et.PathConstraintMixTimeline.ENTRIES])}}if(t.deform)for(var W in t.deform){var H=t.deform[W],X=e.findSkin(W);if(null==X)throw new Error("Skin not found: "+W);for(s in H){if(a=H[s],-1==(P=e.findSlotIndex(s)))throw new Error("Slot not found: "+a.name);for(var x in a){var o=a[x],A=X.getAttachment(P,x);if(null!=A){var Y=null!=A.bones,C=A.vertices,q=Y?C.length/3*2:C.length;(m=new et.DeformTimeline(o.length)).slotIndex=P,m.attachment=A;for(var l=0,T=0;T<o.length;T++){c=o[T];var S=void 0,w=this.getValue(c,"vertices",null);if(null==w)S=Y?et.Utils.newFloatArray(q):C;else{var S=et.Utils.newFloatArray(q),J=this.getValue(c,"offset",0);if(et.Utils.arrayCopy(w,0,S,J,w.length),1!=i)for(var Z=(h=J)+w.length;h<Z;h++)S[h]*=i;if(!Y)for(h=0;h<q;h++)S[h]+=C[h]}m.setFrame(l,this.getValue(c,"time",0),S),this.readCurve(c,m,l),l++}n.push(m),r=Math.max(r,m.frames[m.getFrameCount()-1])}}}}var E=t.drawOrder;if(null!=(E=null==E?t.draworder:E)){for(var m=new et.DrawOrderTimeline(E.length),M=e.slots.length,T=l=0;T<E.length;T++){var K=E[T],D=null,B=this.getValue(K,"offsets",null);if(null!=B){for(var D=et.Utils.newArray(M,-1),Q=et.Utils.newArray(M-B.length,0),I=0,$=0,h=0;h<B.length;h++){var P,tt=B[h];if(-1==(P=e.findSlotIndex(tt.slot)))throw new Error("Slot not found: "+tt.slot);for(;I!=P;)Q[$++]=I++;D[I+tt.offset]=I++}for(;I<M;)Q[$++]=I++;for(h=M-1;0<=h;h--)-1==D[h]&&(D[h]=Q[--$])}m.setFrame(l++,this.getValue(K,"time",0),D)}n.push(m),r=Math.max(r,m.frames[m.getFrameCount()-1])}if(t.events){for(m=new et.EventTimeline(t.events.length),h=l=0;h<t.events.length;h++){var R=t.events[h],O=e.findEvent(R.name);if(null==O)throw new Error("Event not found: "+R.name);var L=new et.Event(et.Utils.toSinglePrecision(this.getValue(R,"time",0)),O);L.intValue=this.getValue(R,"int",O.intValue),L.floatValue=this.getValue(R,"float",O.floatValue),L.stringValue=this.getValue(R,"string",O.stringValue),null!=L.data.audioPath&&(L.volume=this.getValue(R,"volume",1),L.balance=this.getValue(R,"balance",0)),m.setFrame(l++,L)}n.push(m),r=Math.max(r,m.frames[m.getFrameCount()-1])}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");e.animations.push(new et.Animation(F,n,r))},O.prototype.readCurve=function(t,e,i){var n=t.curve;n&&("stepped"==n?e.setStepped(i):"[object Array]"===Object.prototype.toString.call(n)?e.setCurve(i,n[0],n[1],n[2],n[3]):e.setCurve(i,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},O.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i},O.blendModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return et.BlendMode.Normal;if("additive"==t)return et.BlendMode.Additive;if("multiply"==t)return et.BlendMode.Multiply;if("screen"==t)return et.BlendMode.Screen;throw new Error("Unknown blend mode: "+t)},O.positionModeFromString=function(t){if("fixed"==(t=t.toLowerCase()))return et.PositionMode.Fixed;if("percent"==t)return et.PositionMode.Percent;throw new Error("Unknown position mode: "+t)},O.spacingModeFromString=function(t){if("length"==(t=t.toLowerCase()))return et.SpacingMode.Length;if("fixed"==t)return et.SpacingMode.Fixed;if("percent"==t)return et.SpacingMode.Percent;throw new Error("Unknown position mode: "+t)},O.rotateModeFromString=function(t){if("tangent"==(t=t.toLowerCase()))return et.RotateMode.Tangent;if("chain"==t)return et.RotateMode.Chain;if("chainscale"==t)return et.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+t)},O.transformModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return et.TransformMode.Normal;if("onlytranslation"==t)return et.TransformMode.OnlyTranslation;if("norotationorreflection"==t)return et.TransformMode.NoRotationOrReflection;if("noscale"==t)return et.TransformMode.NoScale;if("noscaleorreflection"==t)return et.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+t)},et.SkeletonJson=O;var d=function(t,e,i,n,r){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=n,this.inheritDeform=r}}(t=t||{}),d=t=t||{},f=function(t,e,i){this.slotIndex=t,this.name=e,this.attachment=i},d.SkinEntry=f,P.prototype.setAttachment=function(t,e,i){if(null==i)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=i},P.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var i=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==i){n=!0;break}n||this.bones.push(i)}for(e=0;e<t.constraints.length;e++){for(var s=t.constraints[e],n=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==s){n=!0;break}n||this.constraints.push(s)}for(var a=t.getAttachments(),e=0;e<a.length;e++){var o=a[e];this.setAttachment(o.slotIndex,o.name,o.attachment)}},P.prototype.copySkin=function(t){for(var e=0;e<t.bones.length;e++){for(var i=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==i){n=!0;break}n||this.bones.push(i)}for(e=0;e<t.constraints.length;e++){for(var s=t.constraints[e],n=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==s){n=!0;break}n||this.constraints.push(s)}for(var a=t.getAttachments(),e=0;e<a.length;e++){var o=a[e];null!=o.attachment&&(o.attachment instanceof d.MeshAttachment?o.attachment=o.attachment.newLinkedMesh():o.attachment=o.attachment.copy(),this.setAttachment(o.slotIndex,o.name,o.attachment))}},P.prototype.getAttachment=function(t,e){t=this.attachments[t];return t?t[e]:null},P.prototype.removeAttachment=function(t,e){t=this.attachments[t];t&&(t[e]=null)},P.prototype.getAttachments=function(){for(var t=new Array,e=0;e<this.attachments.length;e++){var i=this.attachments[e];if(i)for(var n in i){var r=i[n];r&&t.push(new f(e,n,r))}}return t},P.prototype.getAttachmentsForSlot=function(t,e){var i=this.attachments[t];if(i)for(var n in i){var r=i[n];r&&e.push(new f(t,n,r))}},P.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},P.prototype.attachAll=function(t,e){for(var i=0,n=0;n<t.slots.length;n++){var r=t.slots[n],s=r.getAttachment();if(s&&i<e.attachments.length){var a,o=e.attachments[i];for(a in o)if(s==o[a]){var l=this.getAttachment(i,a);null!=l&&r.setAttachment(l);break}}i++}},d.Skin=P,function(i){function t(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new i.Color,this.darkColor=null==t.darkColor?null:new i.Color,this.setToSetupPose()}t.prototype.getSkeleton=function(){return this.bone.skeleton},t.prototype.getAttachment=function(){return this.attachment},t.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},t.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},t.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},t.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},i.Slot=t}(t=t||{}),(j=t=t||{}).SlotData=function(t,e,i){if(this.color=new j.Color(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==i)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=i};var g=t=t||{};x.prototype.getImage=function(){return this._image},x.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return v.Nearest;case"linear":return v.Linear;case"mipmap":return v.MipMap;case"mipmapnearestnearest":return v.MipMapNearestNearest;case"mipmaplinearnearest":return v.MipMapLinearNearest;case"mipmapnearestlinear":return v.MipMapNearestLinear;case"mipmaplinearlinear":return v.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},x.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return b.MirroredRepeat;case"clamptoedge":return b.ClampToEdge;case"repeat":return b.Repeat;default:throw new Error("Unknown texture wrap "+t)}};var v,b,m=x;function x(t){this._image=t}g.Texture=m,(A=v=g.TextureFilter||(g.TextureFilter={}))[A.Nearest=9728]="Nearest",A[A.Linear=9729]="Linear",A[A.MipMap=9987]="MipMap",A[A.MipMapNearestNearest=9984]="MipMapNearestNearest",A[A.MipMapLinearNearest=9985]="MipMapLinearNearest",A[A.MipMapNearestLinear=9986]="MipMapNearestLinear",A[A.MipMapLinearLinear=9987]="MipMapLinearLinear",(A=b=g.TextureWrap||(g.TextureWrap={}))[A.MirroredRepeat=33648]="MirroredRepeat",A[A.ClampToEdge=33071]="ClampToEdge",A[A.Repeat=10497]="Repeat",g.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0},L(C,Q=m),C.prototype.setFilters=function(t,e){},C.prototype.setWraps=function(t,e){},C.prototype.dispose=function(){};var Q,A=C;function C(){return null!==Q&&Q.apply(this,arguments)||this}function T(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}function S(t){t=i.call(this,t)||this;return t.x=0,t.y=0,t.scaleX=1,t.scaleY=1,t.rotation=0,t.width=0,t.height=0,t.color=new e.Color(1,1,1,1),t.offset=e.Utils.newFloatArray(8),t.uvs=e.Utils.newFloatArray(8),t.tempColor=new e.Color(1,1,1,1),t}function w(t){t=s.call(this,t)||this;return t.color=new r.Color(.38,.94,0,1),t}function E(t){t=o.call(this,t)||this;return t.closed=!1,t.constantSpeed=!1,t.color=new a.Color(1,1,1,1),t}function M(t){t=V.call(this,t)||this;return t.color=new u.Color(1,1,1,1),t.tempColor=new u.Color(0,0,0,0),t}function D(t){t=N.call(this,t)||this;return t.color=new h.Color(.2275,.2275,.8078,1),t}function B(t){t=k.call(this,t)||this;return t.color=new c.Color(1,1,1,1),t}function $(t){if(null==t)throw new Error("name cannot be null.");this.name=t}function I(t){t=z.call(this,t)||this;return t.id=(65535&I.nextID++)<<11,t.worldVerticesLength=0,t.deformAttachment=t}function tt(t){t=U.call(this,t,0,!1)||this;return t.bones=new Array,t.rotateMix=0,t.translateMix=0,t.scaleMix=0,t.shearMix=0,t.offsetRotation=0,t.offsetX=0,t.offsetY=0,t.offsetScaleX=0,t.offsetScaleY=0,t.offsetShearY=0,t.relative=!1,t.local=!1,t}function P(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}function et(t){t=X.call(this,t,0,!1)||this;return t.bones=new Array,t}function it(t){t=Y.call(this,t,0,!1)||this;return t.bones=new Array,t.bendDirection=1,t.compress=!1,t.stretch=!1,t.uniform=!1,t.mix=1,t.softness=0,t}g.FakeTexture=A,function(u){function t(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}t.prototype.load=function(t,e){if(null==e)throw new Error("textureLoader cannot be null.");for(var i=new _(t),n=new Array(4),r=null;;){var s,a,o,l,h,c=i.readLine();if(null==c)break;0==(c=c.trim()).length?r=null:r?((s=new f).name=c,s.page=r,"true"==(h=i.readValue()).toLocaleLowerCase()?s.degrees=90:"false"==h.toLocaleLowerCase()?s.degrees=0:s.degrees=parseFloat(h),s.rotate=90==s.degrees,i.readTuple(n),h=parseInt(n[0]),a=parseInt(n[1]),i.readTuple(n),o=parseInt(n[0]),l=parseInt(n[1]),s.u=h/r.width,s.v=a/r.height,s.rotate?(s.u2=(h+l)/r.width,s.v2=(a+o)/r.height):(s.u2=(h+o)/r.width,s.v2=(a+l)/r.height),s.x=h,s.y=a,s.width=Math.abs(o),s.height=Math.abs(l),4==i.readTuple(n)&&4==i.readTuple(n)&&i.readTuple(n),s.originalWidth=parseInt(n[0]),s.originalHeight=parseInt(n[1]),i.readTuple(n),s.offsetX=parseInt(n[0]),s.offsetY=parseInt(n[1]),s.index=parseInt(i.readValue()),s.texture=r.texture,this.regions.push(s)):((r=new d).name=c,2==i.readTuple(n)&&(r.width=parseInt(n[0]),r.height=parseInt(n[1]),i.readTuple(n)),i.readTuple(n),r.minFilter=u.Texture.filterFromString(n[0]),r.magFilter=u.Texture.filterFromString(n[1]),h=i.readValue(),r.uWrap=u.TextureWrap.ClampToEdge,r.vWrap=u.TextureWrap.ClampToEdge,"x"==h?r.uWrap=u.TextureWrap.Repeat:"y"==h?r.vWrap=u.TextureWrap.Repeat:"xy"==h&&(r.uWrap=r.vWrap=u.TextureWrap.Repeat),r.texture=e(c),r.texture.setFilters(r.minFilter,r.magFilter),r.texture.setWraps(r.uWrap,r.vWrap),r.width=r.texture.getImage().width,r.height=r.texture.getImage().height,this.pages.push(r))}},t.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},t.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},u.TextureAtlas=t;e.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},e.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},e.prototype.readTuple=function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);for(var n=0,r=i+1;n<3;n++){var s=e.indexOf(",",r);if(-1==s)break;t[n]=e.substr(r,s-r).trim(),r=s+1}return t[n]=e.substring(r).trim(),n+1};var _=e,d=function(){};function e(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}u.TextureAtlasPage=d;i=u.TextureRegion,L(n,i);var i,f=n;function n(){return null!==i&&i.apply(this,arguments)||this}u.TextureAtlasRegion=f}(t=t||{}),function(S){function t(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new S.Vector2,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},t.prototype.applyAbsoluteWorld=function(){for(var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target,s=r.a,a=r.b,o=r.c,l=r.d,h=0<s*l-a*o?S.MathUtils.degRad:-S.MathUtils.degRad,c=this.data.offsetRotation*h,u=this.data.offsetShearY*h,_=this.bones,d=0,f=_.length;d<f;d++){var p,m,y,g,v,b,x,A,C=_[d],T=!1;0!=t&&(m=C.a,v=C.b,g=C.c,b=C.d,(x=Math.atan2(o,s)-Math.atan2(g,m)+c)>S.MathUtils.PI?x-=S.MathUtils.PI2:x<-S.MathUtils.PI&&(x+=S.MathUtils.PI2),x*=t,p=Math.cos(x),A=Math.sin(x),C.a=p*m-A*g,C.b=p*v-A*b,C.c=A*m+p*g,C.d=A*v+p*b,T=!0),0!=e&&(m=this.temp,r.localToWorld(m.set(this.data.offsetX,this.data.offsetY)),C.worldX+=(m.x-C.worldX)*e,C.worldY+=(m.y-C.worldY)*e,T=!0),0<i&&(y=Math.sqrt(C.a*C.a+C.c*C.c),g=Math.sqrt(s*s+o*o),1e-5<y&&(y=(y+(g-y+this.data.offsetScaleX)*i)/y),C.a*=y,C.c*=y,y=Math.sqrt(C.b*C.b+C.d*C.d),g=Math.sqrt(a*a+l*l),1e-5<y&&(y=(y+(g-y+this.data.offsetScaleY)*i)/y),C.b*=y,C.d*=y,T=!0),0<n&&(v=C.b,b=C.d,A=Math.atan2(b,v),(x=Math.atan2(l,a)-Math.atan2(o,s)-(A-Math.atan2(C.c,C.a)))>S.MathUtils.PI?x-=S.MathUtils.PI2:x<-S.MathUtils.PI&&(x+=S.MathUtils.PI2),x=A+(x+u)*n,y=Math.sqrt(v*v+b*b),C.b=Math.cos(x)*y,C.d=Math.sin(x)*y,T=!0),T&&(C.appliedValid=!1)}},t.prototype.applyRelativeWorld=function(){for(var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target,s=r.a,a=r.b,o=r.c,l=r.d,h=0<s*l-a*o?S.MathUtils.degRad:-S.MathUtils.degRad,c=this.data.offsetRotation*h,u=this.data.offsetShearY*h,_=this.bones,d=0,f=_.length;d<f;d++){var p,m,y,g,v,b,x,A,C=_[d],T=!1;0!=t&&(b=C.a,p=C.b,m=C.c,y=C.d,(A=Math.atan2(o,s)+c)>S.MathUtils.PI?A-=S.MathUtils.PI2:A<-S.MathUtils.PI&&(A+=S.MathUtils.PI2),A*=t,g=Math.cos(A),v=Math.sin(A),C.a=g*b-v*m,C.b=g*p-v*y,C.c=v*b+g*m,C.d=v*p+g*y,T=!0),0!=e&&(b=this.temp,r.localToWorld(b.set(this.data.offsetX,this.data.offsetY)),C.worldX+=b.x*e,C.worldY+=b.y*e,T=!0),0<i&&(x=(Math.sqrt(s*s+o*o)-1+this.data.offsetScaleX)*i+1,C.a*=x,C.c*=x,x=(Math.sqrt(a*a+l*l)-1+this.data.offsetScaleY)*i+1,C.b*=x,C.d*=x,T=!0),0<n&&((A=Math.atan2(l,a)-Math.atan2(o,s))>S.MathUtils.PI?A-=S.MathUtils.PI2:A<-S.MathUtils.PI&&(A+=S.MathUtils.PI2),p=C.b,y=C.d,A=Math.atan2(y,p)+(A-S.MathUtils.PI/2+u)*n,x=Math.sqrt(p*p+y*y),C.b=Math.cos(A)*x,C.d=Math.sin(A)*x,T=!0),T&&(C.appliedValid=!1)}},t.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var s=this.bones,a=0,o=s.length;a<o;a++){var l,h=s[a],c=(h.appliedValid||h.updateAppliedTransform(),h.arotation),u=(0!=t&&(l=r.arotation-c+this.data.offsetRotation,c+=(l-=360*(16384-(16384.499999999996-l/360|0)))*t),h.ax),_=h.ay,d=(0!=e&&(u+=(r.ax-u+this.data.offsetX)*e,_+=(r.ay-_+this.data.offsetY)*e),h.ascaleX),f=h.ascaleY,p=(0!=i&&(1e-5<d&&(d=(d+(r.ascaleX-d+this.data.offsetScaleX)*i)/d),1e-5<f&&(f=(f+(r.ascaleY-f+this.data.offsetScaleY)*i)/f)),h.ashearY);0!=n&&(l=r.ashearY-p+this.data.offsetShearY,l-=360*(16384-(16384.499999999996-l/360|0)),h.shearY+=l*n),h.updateWorldTransformWith(u,_,c,d,f,h.ashearX,p)}},t.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var s=this.bones,a=0,o=s.length;a<o;a++){var l=s[a],h=(l.appliedValid||l.updateAppliedTransform(),l.arotation),c=(0!=t&&(h+=(r.arotation+this.data.offsetRotation)*t),l.ax),u=l.ay,_=(0!=e&&(c+=(r.ax+this.data.offsetX)*e,u+=(r.ay+this.data.offsetY)*e),l.ascaleX),d=l.ascaleY,f=(0!=i&&(1e-5<_&&(_*=(r.ascaleX-1+this.data.offsetScaleX)*i+1),1e-5<d&&(d*=(r.ascaleY-1+this.data.offsetScaleY)*i+1)),l.ashearY);0!=n&&(f+=(r.ashearY+this.data.offsetShearY)*n),l.updateWorldTransformWith(c,u,h,_,d,l.ashearX,f)}},S.TransformConstraint=t}(t=t||{}),m=t=t||{},U=m.ConstraintData,L(tt,U),m.TransformConstraintData=tt,function(t){function G(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool(function(){return new Array}),this.polygonIndicesPool=new t.Pool(function(){return new Array})}G.prototype.triangulate=function(t){for(var e=t,i=t.length>>1,n=this.indicesArray,r=n.length=0;r<i;r++)n[r]=r;for(var s=this.isConcaveArray,r=s.length=0,a=i;r<a;++r)s[r]=G.isConcave(r,i,e,n);var o=this.triangles;for(o.length=0;3<i;){for(var l=i-1,h=(r=0,1);;){t:if(!s[r]){for(var c=n[l]<<1,u=n[r]<<1,_=n[h]<<1,d=e[c],f=e[1+c],p=e[u],m=e[1+u],y=e[_],g=e[1+_],v=(h+1)%i;v!=l;v=(v+1)%i)if(s[v]){var b=n[v]<<1,x=e[b],b=e[1+b];if(G.positiveArea(y,g,d,f,x,b)&&G.positiveArea(d,f,p,m,x,b)&&G.positiveArea(p,m,y,g,x,b))break t}break}if(0==h){for(;s[r]&&0<--r;);break}l=r,h=((r=h)+1)%i}o.push(n[(i+r-1)%i]),o.push(n[r]),o.push(n[(r+1)%i]),n.splice(r,1),s.splice(r,1);var A=(--i+r-1)%i,C=r==i?0:r;s[A]=G.isConcave(A,i,e,n),s[C]=G.isConcave(C,i,e,n)}return 3==i&&(o.push(n[2]),o.push(n[0]),o.push(n[1])),o},G.prototype.decompose=function(F,t){for(var e,i,n,r,s,a=F,o=this.convexPolygons,l=(this.polygonPool.freeAll(o),o.length=0,this.convexPolygonsIndices),h=(this.polygonIndicesPool.freeAll(l),l.length=0,this.polygonIndicesPool.obtain()),c=(h.length=0,this.polygonPool.obtain()),u=-1,_=c.length=0,d=0,f=t.length;d<f;d+=3){var p,m,y,g=t[d]<<1,v=t[d+1]<<1,b=t[d+2]<<1,x=a[g],A=a[1+g],C=a[v],T=a[1+v],S=a[b],w=a[1+b],E=!1;u==g&&(p=c.length-4,m=G.winding(c[p],c[p+1],c[p+2],c[p+3],S,w),y=G.winding(S,w,c[0],c[1],c[2],c[3]),m==_&&y==_&&(c.push(S),c.push(w),h.push(b),E=!0)),E||(0<c.length?(o.push(c),l.push(h)):(this.polygonPool.free(c),this.polygonIndicesPool.free(h)),(c=this.polygonPool.obtain()).length=0,c.push(x),c.push(A),c.push(C),c.push(T),c.push(S),c.push(w),(h=this.polygonIndicesPool.obtain()).length=0,h.push(g),h.push(v),h.push(b),_=G.winding(x,A,C,T,S,w),u=g)}for(0<c.length&&(o.push(c),l.push(h)),d=0,f=o.length;d<f;d++)if(0!=(h=l[d]).length)for(var V=h[0],N=h[h.length-1],M=(c=o[d])[p=c.length-4],D=c[p+1],B=c[p+2],I=c[p+3],P=c[0],R=c[1],k=c[2],z=c[3],O=G.winding(M,D,B,I,P,R),L=0;L<f;L++)L==d||3==(e=l[L]).length&&(i=e[0],n=e[1],r=e[2],S=(s=o[L])[s.length-2],w=s[s.length-1],i==V&&n==N&&(m=G.winding(M,D,B,I,S,w),y=G.winding(S,w,P,R,k,z),m==O&&y==O&&(s.length=0,e.length=0,c.push(S),c.push(w),h.push(r),M=B,D=I,B=S,I=w,L=0)));for(d=o.length-1;0<=d;d--)0==(c=o[d]).length&&(o.splice(d,1),this.polygonPool.free(c),h=l[d],l.splice(d,1),this.polygonIndicesPool.free(h));return o},G.isConcave=function(t,e,i,n){var r=n[(e+t-1)%e]<<1,s=n[t]<<1,n=n[(t+1)%e]<<1;return!this.positiveArea(i[r],i[1+r],i[s],i[1+s],i[n],i[1+n])},G.positiveArea=function(t,e,i,n,r,s){return 0<=t*(s-n)+i*(e-s)+r*(n-e)},G.winding=function(t,e,i,n,r,s){i-=t,n-=e;return 0<=r*n-s*i+i*e-t*n?1:-1},t.Triangulator=G}(t=t||{}),function(t){function e(){this.array=new Array}function i(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t=void 0===t?0:t,this.g=e,this.b=i,this.a=n}function n(){}e.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},e.prototype.contains=function(t){return null!=this.array[0|t]},e.prototype.remove=function(t){this.array[0|t]=void 0},e.prototype.clear=function(){this.array.length=0},t.IntSet=e,i.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this.clamp(),this},i.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},i.prototype.add=function(t,e,i,n){return this.r+=t,this.g+=e,this.b+=i,this.a+=n,this.clamp(),this},i.prototype.clamp=function(){return this.r<0?this.r=0:1<this.r&&(this.r=1),this.g<0?this.g=0:1<this.g&&(this.g=1),this.b<0?this.b=0:1<this.b&&(this.b=1),this.a<0?this.a=0:1<this.a&&(this.a=1),this},i.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},i.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},i.WHITE=new i(1,1,1,1),i.RED=new i(1,0,0,1),i.GREEN=new i(0,1,0,1),i.BLUE=new i(0,0,1,1),i.MAGENTA=new i(1,0,1,1),t.Color=i,n.clamp=function(t,e,i){return t<e?e:i<t?i:t},n.cosDeg=function(t){return Math.cos(t*n.degRad)},n.sinDeg=function(t){return Math.sin(t*n.degRad)},n.signum=function(t){return 0<t?1:t<0?-1:0},n.toInt=function(t){return 0<t?Math.floor(t):Math.ceil(t)},n.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},n.randomTriangular=function(t,e){return n.randomTriangularWith(t,e,.5*(t+e))},n.randomTriangularWith=function(t,e,i){var n=Math.random(),r=e-t;return n<=(i-t)/r?t+Math.sqrt(n*r*(i-t)):e-Math.sqrt((1-n)*r*(e-i))},n.PI2=2*(n.PI=3.1415927),n.radDeg=n.radiansToDegrees=180/n.PI,n.degRad=n.degreesToRadians=n.PI/180,t.MathUtils=n;s.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i)};var r=s;function s(){}t.Interpolation=r;L(o,a=r),o.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1};var a,r=o;function o(t){var e=a.call(this)||this;return e.power=2,e.power=t,e}t.Pow=r;L(h,l=r),h.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1};var l,r=h;function h(t){return l.call(this,t)||this}function c(){}function u(){}function _(t){this.items=new Array,this.instantiator=t}function d(t,e){void 0===e&&(e=0),this.x=t=void 0===t?0:t,this.y=e}function f(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}function p(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}t.PowOut=r,c.arrayCopy=function(t,e,i,n,r){for(var s=e,a=n;s<e+r;s++,a++)i[a]=t[s]},c.setArraySize=function(t,e,i){void 0===i&&(i=0);var n=t.length;if(n!=e&&n<(t.length=e))for(var r=n;r<e;r++)t[r]=i;return t},c.ensureArrayCapacity=function(t,e,i){return void 0===i&&(i=0),t.length>=e?t:c.setArraySize(t,e,i)},c.newArray=function(t,e){for(var i=new Array(t),n=0;n<t;n++)i[n]=e;return i},c.newFloatArray=function(t){if(c.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);for(var e=new Array(t),i=0;i<e.length;i++)e[i]=0;return e},c.newShortArray=function(t){if(c.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);for(var e=new Array(t),i=0;i<e.length;i++)e[i]=0;return e},c.toFloatArray=function(t){return c.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t},c.toSinglePrecision=function(t){return c.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t},c.webkit602BugfixHelper=function(t,e){},c.contains=function(t,e,i){void 0===i&&(i=!0);for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},c.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t.Utils=c,u.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];console.log(i.data.name+", "+i.a+", "+i.b+", "+i.c+", "+i.d+", "+i.worldX+", "+i.worldY)}},t.DebugUtils=u,_.prototype.obtain=function(){return 0<this.items.length?this.items.pop():this.instantiator()},_.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},_.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},_.prototype.clear=function(){this.items.length=0},t.Pool=_,d.prototype.set=function(t,e){return this.x=t,this.y=e,this},d.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},d.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t.Vector2=d,f.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,1<this.frameTime&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t.TimeKeeper=f,p.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},p.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},p.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t.WindowedMean=p}(t=t||{}),Math.fround||(Math.fround=(G=new Float32Array(1),function(t){return G[0]=t,G[0]})),(_=t=t||{}).Attachment=$,L(I,z=$),I.prototype.computeWorldVertices=function(t,e,i,n,r,s){i=r+(i>>1)*s;var a=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(null!=h){for(var c=0,u=0,_=0;_<e;_+=2)c+=(m=h[c])+1,u+=m;var d=a.bones;if(0==o.length)for(B=r,w=3*u;B<i;B+=s){var f=0,p=0,m=h[c++];for(m+=c;c<m;c++,w+=3){var y=d[h[c]],g=l[w],v=l[w+1],b=l[w+2];f+=(g*y.a+v*y.b+y.worldX)*b,p+=(g*y.c+v*y.d+y.worldY)*b}n[B]=f,n[B+1]=p}else for(var x=o,A=(B=r,w=3*u,u<<1);B<i;B+=s){for(p=f=0,m=h[c++],m+=c;c<m;c++,w+=3,A+=2)y=d[h[c]],g=l[w]+x[A],v=l[w+1]+x[A+1],b=l[w+2],f+=(g*y.a+v*y.b+y.worldX)*b,p+=(g*y.c+v*y.d+y.worldY)*b;n[B]=f,n[B+1]=p}}else{0<o.length&&(l=o);for(var y,C=(y=t.bone).worldX,T=y.worldY,S=y.a,w=y.b,E=y.c,M=y.d,D=e,B=r;B<i;D+=2,B+=s){var g=l[D],v=l[D+1];n[B]=g*S+v*w+C,n[B+1]=g*E+v*M+T}}},I.prototype.copyTo=function(t){null!=this.bones?(t.bones=new Array(this.bones.length),_.Utils.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=_.Utils.newFloatArray(this.vertices.length),_.Utils.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment},I.nextID=0,_.VertexAttachment=I,(g=(g=t=t||{}).AttachmentType||(g.AttachmentType={}))[g.Region=0]="Region",g[g.BoundingBox=1]="BoundingBox",g[g.Mesh=2]="Mesh",g[g.LinkedMesh=3]="LinkedMesh",g[g.Path=4]="Path",g[g.Point=5]="Point",g[g.Clipping=6]="Clipping",c=t=t||{},k=c.VertexAttachment,L(B,k),B.prototype.copy=function(){var t=new B(name);return this.copyTo(t),t.color.setFromColor(this.color),t},c.BoundingBoxAttachment=B,h=t=t||{},N=h.VertexAttachment,L(D,N),D.prototype.copy=function(){var t=new D(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},h.ClippingAttachment=D,u=t=t||{},V=u.VertexAttachment,L(M,V),M.prototype.updateUVs=function(){var t=this.regionUVs,e=(null!=this.uvs&&this.uvs.length==t.length||(this.uvs=u.Utils.newFloatArray(t.length)),this.uvs),i=this.uvs.length,n=this.region.u,r=this.region.v,s=0,a=0;if(this.region instanceof u.TextureAtlasRegion){var o=this.region,l=o.texture.getImage().width,h=o.texture.getImage().height;switch(o.degrees){case 90:n-=(o.originalHeight-o.offsetY-o.height)/l,r-=(o.originalWidth-o.offsetX-o.width)/h;for(var s=o.originalHeight/l,a=o.originalWidth/h,c=0;c<i;c+=2)e[c]=n+t[c+1]*s,e[c+1]=r+(1-t[c])*a;return;case 180:for(n-=(o.originalWidth-o.offsetX-o.width)/l,r-=o.offsetY/h,s=o.originalWidth/l,a=o.originalHeight/h,c=0;c<i;c+=2)e[c]=n+(1-t[c])*s,e[c+1]=r+(1-t[c+1])*a;return;case 270:for(n-=o.offsetY/l,r-=o.offsetX/h,s=o.originalHeight/l,a=o.originalWidth/h,c=0;c<i;c+=2)e[c]=n+(1-t[c+1])*s,e[c+1]=r+t[c]*a;return}n-=o.offsetX/l,r-=(o.originalHeight-o.offsetY-o.height)/h,s=o.originalWidth/l,a=o.originalHeight/h}else null==this.region?(n=r=0,s=a=1):(s=this.region.u2-n,a=this.region.v2-r);for(c=0;c<i;c+=2)e[c]=n+t[c]*s,e[c+1]=r+t[c+1]*a},M.prototype.getParentMesh=function(){return this.parentMesh},M.prototype.setParentMesh=function(t){null!=(this.parentMesh=t)&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},M.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new M(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),u.Utils.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),u.Utils.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),u.Utils.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),u.Utils.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t},M.prototype.newLinkedMesh=function(){var t=new M(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},u.MeshAttachment=M,a=t=t||{},o=a.VertexAttachment,L(E,o),E.prototype.copy=function(){var t=new E(name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),a.Utils.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t},a.PathAttachment=E,r=t=t||{},s=r.VertexAttachment,L(w,s),w.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},w.prototype.computeWorldRotation=function(t){var e=r.MathUtils.cosDeg(this.rotation),i=r.MathUtils.sinDeg(this.rotation),n=e*t.a+i*t.b,e=e*t.c+i*t.d;return Math.atan2(e,n)*r.MathUtils.radDeg},w.prototype.copy=function(){var t=new w(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},r.PointAttachment=w,e=t=t||{},i=e.Attachment,L(S,i),S.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,t=i+this.region.width*t,e=n+this.region.height*e,r=this.rotation*Math.PI/180,s=Math.cos(r),r=Math.sin(r),a=i*s+this.x,i=i*r,o=n*s+this.y,n=n*r,l=t*s+this.x,t=t*r,s=e*s+this.y,e=e*r,r=this.offset;r[S.OX1]=a-n,r[S.OY1]=o+i,r[S.OX2]=a-e,r[S.OY2]=s+i,r[S.OX3]=l-e,r[S.OY3]=s+t,r[S.OX4]=l-n,r[S.OY4]=o+t},S.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},S.prototype.computeWorldVertices=function(t,e,i,n){var r=this.offset,s=t.worldX,a=t.worldY,o=t.a,l=t.b,h=t.c,t=t.d,c=r[S.OX1],u=r[S.OY1];e[i]=c*o+u*l+s,e[i+1]=c*h+u*t+a,c=r[S.OX2],u=r[S.OY2],e[i+=n]=c*o+u*l+s,e[i+1]=c*h+u*t+a,c=r[S.OX3],u=r[S.OY3],e[i+=n]=c*o+u*l+s,e[i+1]=c*h+u*t+a,c=r[S.OX4],u=r[S.OY4],e[i+=n]=c*o+u*l+s,e[i+1]=c*h+u*t+a},S.prototype.copy=function(){var t=new S(name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,e.Utils.arrayCopy(this.uvs,0,t.uvs,0,8),e.Utils.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t},S.OX1=0,S.OY1=1,S.OX2=2,S.OY2=3,S.OX3=4,S.OY3=5,S.OX4=6,S.OY4=7,S.X1=0,S.Y1=1,S.C1R=2,S.C1G=3,S.C1B=4,S.C1A=5,S.U1=6,S.V1=7,S.X2=8,S.Y2=9,S.C2R=10,S.C2G=11,S.C2B=12,S.C2A=13,S.U2=14,S.V2=15,S.X3=16,S.Y3=17,S.C3R=18,S.C3G=19,S.C3B=20,S.C3A=21,S.U3=22,S.V3=23,S.X4=24,S.Y4=25,S.C4R=26,S.C4G=27,S.C4B=28,S.C4A=29,S.U4=30,S.V4=31,e.RegionAttachment=S,function(r){function t(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}t.prototype.begin=function(t){},t.prototype.transform=function(t,e,i,n){t.x+=r.MathUtils.randomTriangular(-this.jitterX,this.jitterY),t.y+=r.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},t.prototype.end=function(){},r.JitterEffect=t}(t=t||{}),l=t=t||{},T.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},T.prototype.transform=function(t,e,i,n){var r=this.angle*l.MathUtils.degreesToRadians,s=t.x-this.worldX,a=t.y-this.worldY,o=Math.sqrt(s*s+a*a);o<this.radius&&(r=this.interpolation.apply(0,r,(this.radius-o)/this.radius),o=Math.cos(r),r=Math.sin(r),t.x=o*s-r*a+this.worldX,t.y=r*s+o*a+this.worldY)},T.prototype.end=function(){},T.interpolation=new l.PowOut(2),l.SwirlEffect=T,O.exports=t},{}],420:[function(t,e,i){"use strict";var p,m,y,g,v,b,a=t("./track-entry-listeners"),D=t("./lib/spine"),B=[],I=[],P=0,R=0,O=0,L=null,F=null,V=0,N=0,k=0,x=0,A=null,C=null,z=0,G=0,T=new D.Color(1,1,1,1),S=new D.Color(1,1,1,1),U=[0,1,2,2,3,0],s=cc.Class({ctor:function(){this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null},init:function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},clear:function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},bind:function(t){var e=function(t){t&&t.animation.name===this._animationName&&(this.isCompleted=!0)}.bind(this);t.complete=e},unbind:function(t){t.complete=null},begin:function(){var t,e,i,n;this._invalid&&((n=(t=this._skeletonInfo).curAnimationCache)&&n!==this&&(this._privateMode?n.invalidAllFrame():n.updateToFrame()),n=t.skeleton,e=t.listener,i=t.state,n=n.data.findAnimation(this._animationName),i.setAnimationWith(0,n,!1),this.bind(e),(t.curAnimationCache=this)._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1)},end:function(){this._needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},_needToUpdate:function(t){return!this.isCompleted&&this.totalTime<30&&(null==t||this._frameIdx<t)},updateToFrame:function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){for(var e=this._skeletonInfo,i=e.skeleton,n=e.clipper,r=e.state;i.update(1/60),r.update(1/60),r.apply(i),i.updateWorldTransform(),this._frameIdx++,this._updateFrame(i,n,this._frameIdx),this.totalTime+=1/60,this._needToUpdate(t););this.end()}},isInited:function(){return this._inited},isInvalid:function(){return this._invalid},invalidAllFrame:function(){this.isCompleted=!1,this._invalid=!0},updateAllFrame:function(){this.invalidAllFrame(),this.updateToFrame()},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},_updateFrame:function(t,e,i){x=k=N=V=R=P=O=0,C=A=F=L=null,this.frames[i]=this.frames[i]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var i=this.frames[i],n=this._tempSegments=i.segments,r=this._tempColors=i.colors,s=this._tempBoneInfos=i.boneInfos,t=(this._traverseSkeleton(t,e),0<x&&(r[x-1].vfOffset=O),r.length=x,s.length=P,k-1);if(0<=t&&(0<N?((e=n[t]).indexCount=N,e.vfCount=6*V,e.vertexCount=V,n.length=k):n.length=k-1),0!=n.length){var a=i.vertices,o=i.uintVert;(!a||a.length<O)&&(a=i.vertices=new Float32Array(O),o=i.uintVert=new Uint32Array(a.buffer));for(var l=0,h=0;l<O;)a[l++]=B[h++],a[l++]=B[h++],a[l++]=B[h++],a[l++]=B[h++],o[l++]=B[h++],o[l++]=B[h++];var c=i.indices;(!c||c.length<R)&&(c=i.indices=new Uint16Array(R));for(var u=0;u<R;u++)c[u]=I[u];i.vertices=a,i.uintVert=o,i.indices=c}},fillVertices:function(t,e,i,n,r){if(g=i.a*e.a*t.a*255,p=e.r*t.r*255,m=e.g*t.g*255,y=e.b*t.b*255,T.r=p*i.r,T.g=m*i.g,T.b=y*i.b,T.a=g,null==r.darkColor?S.set(0,0,0,1):(S.r=r.darkColor.r*p,S.g=r.darkColor.g*m,S.b=r.darkColor.b*y),S.a=0,v=(T.a<<24>>>0)+(T.b<<16)+(T.g<<8)+T.r,b=(S.a<<24>>>0)+(S.b<<16)+(S.g<<8)+S.r,A===v&&C===b||(e=this._tempColors,A=v,C=b,0<x&&(e[x-1].vfOffset=O),e[x++]={fr:T.r,fg:T.g,fb:T.b,fa:T.a,dr:S.r,dg:S.g,db:S.b,da:S.a,vfOffset:0}),n.isClipping()){n.clipTriangles(B,z,I,G,B,T,S,!0,6,R,O,O+2);var s=n.clippedVertices,a=n.clippedTriangles;G=a.length,z=s.length/12*6;for(var o=0,l=R,h=a.length;o<h;)I[l++]=a[o++];for(var c=0,u=s.length,_=O;c<u;c+=12,_+=6)B[_]=s[c],B[_+1]=s[c+1],B[_+2]=s[c+6],B[_+3]=s[c+7],B[_+4]=v,B[_+5]=b}else for(var d=O,f=O+z;d<f;d+=6)B[d+4]=v,B[d+5]=b},_traverseSkeleton:function(t,e){var i,n,r,s,a,o,l,h,c=this._tempSegments,u=this._tempBoneInfos,_=t.color,d=t.bones;if(this._enableCacheAttachedInfo)for(var f=0,p=d.length;f<p;f++,P++){var m=d[f],y=u[P];(y=y||(u[P]={})).a=m.a,y.b=m.b,y.c=m.c,y.d=m.d,y.worldX=m.worldX,y.worldY=m.worldY}for(var g=0,v=t.drawOrder.length;g<v;g++)if(h=t.drawOrder[g],G=z=0,i=h.getAttachment())if(r=i instanceof D.RegionAttachment,s=i instanceof D.MeshAttachment,i instanceof D.ClippingAttachment)e.clipStart(h,i);else if(r||s)if(a=i.region.texture._texture)if(l=h.data.blendMode,L===a.url&&F===l||(L=a.url,F=l,0<=(o=k-1)&&(0<N?((o=c[o]).indexCount=N,o.vertexCount=V,o.vfCount=6*V):k--),c[k]={tex:a,blendMode:l,indexCount:0,vertexCount:0,vfCount:0},k++,V=N=0),r?(n=U,z=24,G=6,i.computeWorldVertices(h.bone,B,O,6)):s&&(n=i.triangles,z=6*(i.worldVerticesLength>>1),G=n.length,i.computeWorldVertices(h,0,i.worldVerticesLength,B,O,6)),0!=z&&0!=G){for(var b=0,x=R,A=n.length;b<A;)I[x++]=n[b++];for(var C=i.uvs,T=O,S=O+z,w=0;T<S;T+=6,w+=2)B[T+2]=C[w],B[T+3]=C[w+1];if(o=i.color,a=h.color,this.fillVertices(_,o,a,e,h),0<G){for(var E=R,M=R+G;E<M;E++)I[E]+=V;R+=G,O+=z,N+=G,V+=z/6}e.clipEndWithSlot(h)}else e.clipEndWithSlot(h);else e.clipEndWithSlot(h);else e.clipEndWithSlot(h);else e.clipEndWithSlot(h);e.clipEnd()}}),t=cc.Class({ctor:function(){this._privateMode=!1,this._animationPool={},this._skeletonCache={}},enablePrivateMode:function(){this._privateMode=!0},clear:function(){this._animationPool={},this._skeletonCache={}},removeSkeleton:function(t){var e=this._skeletonCache[t];if(e){var i,n=e.animationsCache;for(i in n){var r=n[i];r&&(this._animationPool[t+"#"+i]=r).clear()}delete this._skeletonCache[t]}},getSkeletonCache:function(t,e){var i,n,r,s=this._skeletonCache[t];return s||(e=new D.Skeleton(e),i=new D.SkeletonClipping,n=new D.AnimationStateData(e.data),n=new D.AnimationState(n),r=new a,n.addListener(r),this._skeletonCache[t]=s={skeleton:e,clipper:i,state:n,listener:r,animationsCache:{},curAnimationCache:null}),s},getAnimationCache:function(t,e){t=this._skeletonCache[t];return t?t.animationsCache[e]:null},invalidAnimationCache:function(t){t=this._skeletonCache[t];if(t&&t.skeleton){var e,i=t.animationsCache;for(e in i)i[e].invalidAllFrame()}},initAnimationCache:function(t,e){if(!e)return null;var i=this._skeletonCache[t],n=i&&i.skeleton;if(!n)return null;if(!n.data.findAnimation(e))return null;var n=i.animationsCache,r=n[e];return r||((r=this._animationPool[t=t+"#"+e])?delete this._animationPool[t]:(r=new s)._privateMode=this._privateMode,r.init(i,e),n[e]=r),r},updateAnimationCache:function(t,e){if(e){e=this.initAnimationCache(t,e);if(!e)return null;e.updateAllFrame()}else{e=this._skeletonCache[t];if(e&&e.skeleton){var i,n=e.animationsCache;for(i in n)n[i].updateAllFrame()}}}});t.FrameTime=1/60,t.sharedCache=new t,e.exports=t},{"./lib/spine":419,"./track-entry-listeners":424}],421:[function(t,e,i){"use strict";var n=t("./skeleton-cache").sharedCache,t=cc.Class({name:"sp.SkeletonData",extends:cc.Asset,ctor:function(){this.reset()},properties:{_skeletonJson:null,skeletonJsonStr:{get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},skeletonJson:{get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},_atlasText:"",atlasText:{get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},textures:{default:[],type:[cc.Texture2D]},textureNames:{default:[],type:[cc.String]},scale:1,_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t,this.reset()},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._skeletonCache=null,this._atlasCache=null},ensureTexturesLoaded:function(t,e){var i=this.textures,n=i.length;if(0!=n)for(var r=0,s=function(){++r>=n&&(t&&t.call(e,!0),t=null)},a=0;a<n;a++){var o=i[a];o.loaded?s():o.once("load",s)}else t.call(e,!1)},isTexturesLoaded:function(){for(var t=this.textures,e=t.length,i=0;i<e;i++)if(!t[i].loaded)return!1;return!0},getRuntimeData:function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&0<this.textures.length)&&this.textureNames&&0<this.textureNames.length)return t||cc.errorID(7507,this.name),null;t=this._getAtlas(t);if(!t)return null;var e=new sp.spine.AtlasAttachmentLoader(t),i=null,n=null,i=this.skeletonJson?(n=new sp.spine.SkeletonJson(e),this.skeletonJson):(n=new sp.spine.SkeletonBinary(e),new Uint8Array(this._nativeAsset));return n.scale=this.scale,this._skeletonCache=n.readSkeletonData(i),t.dispose(),this._skeletonCache},getSkinsEnum:!1,getAnimsEnum:!1,_getTexture:function(t){for(var e,i,n=this.textureNames,r=0;r<n.length;r++)if(n[r]===t)return e=this.textures[r],(i=new sp.SkeletonTexture({width:e.width,height:e.height})).setRealTexture(e),i;return cc.errorID(7506,t),null},_getAtlas:function(t){return this._atlasCache||(this.atlasText?this._atlasCache=new sp.spine.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||cc.errorID(7508,this.name),null))},destroy:function(){n.removeSkeleton(this._uuid),this._super()}});sp.SkeletonData=e.exports=t},{"./skeleton-cache":420}],422:[function(t,e,i){"use strict";sp.SkeletonTexture=cc.Class({name:"sp.SkeletonTexture",extends:sp.spine.Texture,_texture:null,_material:null,setRealTexture:function(t){this._texture=t},getRealTexture:function(){return this._texture},setFilters:function(t,e){this._texture&&this._texture.setFilters(t,e)},setWraps:function(t,e){this._texture&&this._texture.setWrapMode(t,e)},dispose:function(){}})},{}],423:[function(t,r,s){"use strict";s.__esModule=!0,s.default=void 0;var e=(e=t("../../cocos2d/core/renderer/assembler"))&&e.__esModule?e:{default:e};var v,b,nt,rt,F,st,at,ot,E,M,P,R,D,B,a,V,lt,O,L,ht,ct,N,k,z,G,U,j,W,H,X,o,l,h,c,i,u,_,Y,q,J,Z,ut,x,d=t("./Skeleton"),K=t("./lib/spine"),f=t("../../cocos2d/core/renderer/render-flow"),t=t("../../cocos2d/core/renderer/webgl/vertex-format"),p=t.vfmtPosUvColor,m=t.vfmtPosUvTwoColor,y=cc.gfx,_t=0,dt=[0,1,2,2,3,0],ft=cc.color(0,0,255,255),pt=cc.color(255,0,0,255),mt=cc.color(0,255,0,255),yt=cc.color(255,255,0,255),A=null,C=null,T=null,S=null,A=new K.Color(1,1,1,1),C=new K.Color(1,1,1,1),T=new K.Vector2,S=new K.Vector2,Q=0,gt=0,$=0,tt=0,et=0,it=0,I=0;function vt(t,e){var i,n;switch(e){case K.BlendMode.Additive:i=v?cc.macro.ONE:cc.macro.SRC_ALPHA,n=cc.macro.ONE;break;case K.BlendMode.Multiply:i=cc.macro.DST_COLOR,n=cc.macro.ONE_MINUS_SRC_ALPHA;break;case K.BlendMode.Screen:i=cc.macro.ONE,n=cc.macro.ONE_MINUS_SRC_COLOR;break;default:K.BlendMode.Normal;i=v?cc.macro.ONE:cc.macro.SRC_ALPHA,n=cc.macro.ONE_MINUS_SRC_ALPHA}var e=!Y.enableBatch,r=Y._materials[0];if(!r)return null;var s=t.getId()+i+n+F+e,a=Y._materialCache,o=a[s];return o||(a.baseMaterial?o=cc.MaterialVariant.create(r):a.baseMaterial=o=r,o.define("CC_USE_MODEL",e),o.define("USE_TINT",F),o.setProperty("texture",t),o.setBlend(!0,y.BLEND_FUNC_ADD,i,n,y.BLEND_FUNC_ADD,i,n),a[s]=o),o}function bt(t){i=t.fa*R,o=E*(b=v?i/255:1),l=M*b,h=P*b,c=t.fr*o,_=t.fg*l,u=t.fb*h,D=(i<<24>>>0)+(u<<16)+(_<<8)+c,i=t.dr*o,u=t.dg*l,_=t.db*h,B=((v?255:0)<<24>>>0)+(_<<16)+(u<<8)+i}function w(t){return(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r}g=e.default,t=g,(n=xt).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,(n=xt.prototype).updateRenderData=function(t){t.isAnimationCached()||(t=t._skeleton)&&t.updateWorldTransform()},n.fillVertices=function(t,e,i,n,r){var s=q._vData,a=q._iData,o=q._uintVData;if(A.a=i.a*e.a*t.a*R*255,b=v?A.a:255,O=E*e.r*t.r*b,L=M*e.g*t.g*b,ht=P*e.b*t.b*b,A.r=O*i.r,A.g=L*i.g,A.b=ht*i.b,null==r.darkColor?C.set(0,0,0,1):(C.r=r.darkColor.r*O,C.g=r.darkColor.g*L,C.b=r.darkColor.b*ht),C.a=v?255:0,n.isClipping()){var e=s.subarray($+2),l=(n.clipTriangles(s.subarray($),Q,a.subarray(it),et,e,A,C,F,V),new Float32Array(n.clippedVertices)),t=n.clippedTriangles;if(et=t.length,Q=l.length/lt*V,i=q.request(Q/V,et),it=i.indiceOffset,tt=i.vertexOffset,$=i.byteOffset>>2,s=q._vData,a=q._iData,o=q._uintVData,a.set(t,it),x)for(var h=0,c=l.length,u=$;h<c;h+=lt,u+=V)T.x=l[h],T.y=l[h+1],A.set(l[h+2],l[h+3],l[h+4],l[h+5]),S.x=l[h+6],S.y=l[h+7],F?C.set(l[h+8],l[h+9],l[h+10],l[h+11]):C.set(0,0,0,0),x.transform(T,S,A,C),s[u]=T.x,s[u+1]=T.y,s[u+2]=S.x,s[u+3]=S.y,o[u+4]=w(A),F&&(o[u+5]=w(C));else for(var _=0,d=l.length,f=$;_<d;_+=lt,f+=V)s[f]=l[_],s[f+1]=l[_+1],s[f+2]=l[_+6],s[f+3]=l[_+7],D=(l[_+5]<<24>>>0)+(l[_+4]<<16)+(l[_+3]<<8)+l[_+2],o[f+4]=D,F&&(B=(l[_+11]<<24>>>0)+(l[_+10]<<16)+(l[_+9]<<8)+l[_+8],o[f+5]=B)}else if(x)for(var p=$,m=$+Q;p<m;p+=V)T.x=s[p],T.y=s[p+1],S.x=s[p+2],S.y=s[p+3],x.transform(T,S,A,C),s[p]=T.x,s[p+1]=T.y,s[p+2]=S.x,s[p+3]=S.y,o[p+4]=w(A),F&&(o[p+5]=w(C));else{D=w(A),B=w(C);for(var y=$,g=$+Q;y<g;y+=V)o[y+4]=D,F&&(o[y+5]=B)}},n.realTimeTraverse=function(t){var e,i,n,r,s,a,o,l,h=Y._skeleton,c=h.color,u=Y._debugRenderer,_=Y._clipper,d=null;nt=Y._startSlotIndex,rt=Y._endSlotIndex,ct=-1==nt?!0:!1,st=Y.debugSlots,at=Y.debugBones,ot=Y.debugMesh,u&&(at||st||ot)&&(u.clear(),u.lineWidth=2),lt=F?12:8;for(var f,p=it=et=tt=$=Q=0,m=h.drawOrder.length;p<m;p++)if(o=h.drawOrder[p],ct=0<=nt&&nt==o.data.index?!0:ct)if(0<=rt&&rt==o.data.index&&(ct=!1),et=Q=0,l=o.getAttachment())if(r=l instanceof K.RegionAttachment,s=l instanceof K.MeshAttachment,l instanceof K.ClippingAttachment)_.clipStart(o,l);else if(r||s)if(d=vt(l.region.texture._texture,o.data.blendMode)){if(!N&&d.getHash()===J.material.getHash()||(N=!1,J._flush(),J.node=Z,J.material=d),r){if(n=dt,Q=4*V,et=6,a=q.request(4,6),it=a.indiceOffset,tt=a.vertexOffset,$=a.byteOffset>>2,e=q._vData,i=q._iData,l.computeWorldVertices(o.bone,e,$,V),u&&st){u.strokeColor=ft,u.moveTo(e[$],e[$+1]);for(var y=$+V,g=$+Q;y<g;y+=V)u.lineTo(e[y],e[y+1]);u.close(),u.stroke()}}else if(s&&(n=l.triangles,Q=(l.worldVerticesLength>>1)*V,et=n.length,a=q.request(Q/V,et),it=a.indiceOffset,tt=a.vertexOffset,$=a.byteOffset>>2,e=q._vData,i=q._iData,l.computeWorldVertices(o,0,l.worldVerticesLength,e,$,V),u&&ot)){u.strokeColor=yt;for(var v=0,b=n.length;v<b;v+=3){var x=n[v]*V+$,A=n[v+1]*V+$,C=n[v+2]*V+$;u.moveTo(e[x],e[x+1]),u.lineTo(e[A],e[A+1]),u.lineTo(e[C],e[C+1]),u.close(),u.stroke()}}if(0!=Q&&0!=et){i.set(n,it);for(var T=l.uvs,S=$,w=$+Q,E=0;S<w;S+=V,E+=2)e[S+2]=T[E],e[S+3]=T[E+1];if(r=l.color,s=o.color,this.fillVertices(c,r,s,_,o),0<et){for(var M=it,D=it+et;M<D;M++)i[M]+=tt;if(t){l=t.m,G=l[0],U=l[4],j=l[12],W=l[1],H=l[5],X=l[13];for(var B=$,I=$+Q;B<I;B+=V)k=e[B],z=e[B+1],e[B]=k*G+z*U+j,e[B+1]=k*W+z*H+X}q.adjust(Q/V,et)}_.clipEndWithSlot(o)}else _.clipEndWithSlot(o)}else _.clipEndWithSlot(o);else _.clipEndWithSlot(o);else _.clipEndWithSlot(o);else _.clipEndWithSlot(o);if(_.clipEnd(),u&&at){u.strokeColor=pt,u.fillColor=ft;for(var P=0,R=h.bones.length;P<R;P++){var O=(f=h.bones[P]).data.length*f.a+f.worldX,L=f.data.length*f.c+f.worldY;u.moveTo(f.worldX,f.worldY),u.lineTo(O,L),u.stroke(),u.circle(f.worldX,f.worldY,1.5*Math.PI),u.fill(),0===P&&(u.fillColor=mt)}}},n.cacheTraverse=function(t){var e=Y._curFrame;if(e){var i=e.segments;if(0!=i.length){var n,r=e.vertices,s=e.indices,a=0,o=0,l=(t&&(t=t.m,G=t[0],W=t[1],U=t[4],H=t[5],j=t[12],X=t[13]),16&_t),h=l&&1===G&&0===W&&0===U&&1===H,c=0,u=e.colors,_=u[c++],d=_.vfOffset;bt(_);for(var f=0,p=i.length;f<p;f++){var m=i[f];if(n=vt(m.tex,m.blendMode)){!N&&n.getHash()===J.material.getHash()||(N=!1,J._flush(),J.node=Z,J.material=n),gt=m.vertexCount,et=m.indexCount,n=q.request(gt,et),it=n.indiceOffset,tt=n.vertexOffset,I=n.byteOffset>>2;for(var y=q._vData,g=q._iData,v=q._uintVData,b=it,x=it+et;b<x;b++)g[b]=tt+s[o++];if(n=m.vfCount,y.set(r.subarray(a,a+n),I),a+=n,h)for(var A=I,C=I+n;A<C;A+=6)y[A]+=j,y[A+1]+=X;else if(l)for(var T=I,S=I+n;T<S;T+=6)k=y[T],z=y[T+1],y[T]=k*G+z*U+j,y[T+1]=k*W+z*H+X;if(q.adjust(gt,et),ut)for(var w=a-n,E=I+4,M=I+4+n;E<M;E+=6,w+=6)d<=w&&(bt(_=u[c++]),d=_.vfOffset),v[E]=D,v[E+1]=B}}}}},n.fillBuffers=function(t,e){var i=t.node;i._renderFlag|=f.FLAG_UPDATE_RENDER_DATA,t._skeleton&&(i=i._color,E=i.r/255,M=i.g/255,P=i.b/255,R=i.a/255,F=t.useTint||t.isAnimationCached(),a=F?m:p,V=F?6:5,Z=t.node,q=e.getBuffer("spine",a),J=e,N=!0,v=(Y=t).premultipliedAlpha,_t=0,ut=!(b=1),x=t._effectDelegate&&t._effectDelegate._vertexEffect,4294967295===i._val&&!v||(ut=!0),i=void(F&&(_t|=1)),Y.enableBatch&&(i=Z._worldMatrix,N=!1,_t|=16),t.isAnimationCached()?this.cacheTraverse(i):(x&&x.begin(t._skeleton),this.realTimeTraverse(i),x&&x.end()),e.worldMatDirty++,t.attachUtil._syncAttachedNode(),Y=J=q=Z=void 0,x=null)},n.postFillBuffers=function(t,e){e.worldMatDirty--};var g,n,t=xt;function xt(){return g.apply(this,arguments)||this}s.default=t,e.default.register(d,t),r.exports=s.default},{"../../cocos2d/core/renderer/assembler":259,"../../cocos2d/core/renderer/render-flow":263,"../../cocos2d/core/renderer/webgl/vertex-format":303,"./Skeleton":417,"./lib/spine":419}],424:[function(t,e,i){"use strict";function n(){this.start=null,this.end=null,this.complete=null,this.event=null,this.interrupt=null,this.dispose=null}n.getListeners=function(t){return t.listener||(t.listener=new n),t.listener},e.exports=n},{}],425:[function(t,e,i){"use strict";var n=t("./lib/spine");sp.VertexEffectDelegate=cc.Class({name:"sp.VertexEffectDelegate",ctor:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},clear:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},initJitter:function(t,e){return this._effectType="jitter",this._vertexEffect=new n.JitterEffect(t,e),this._vertexEffect},initSwirlWithPow:function(t,e){return this._interpolation=new n.Pow(e),this._vertexEffect=new n.SwirlEffect(t,this._interpolation),this._vertexEffect},initSwirlWithPowOut:function(t,e){return this._interpolation=new n.PowOut(e),this._vertexEffect=new n.SwirlEffect(t,this._interpolation),this._vertexEffect},getJitterVertexEffect:function(){return this._vertexEffect},getSwirlVertexEffect:function(){return this._vertexEffect},getVertexEffect:function(){return this._vertexEffect},getEffectType:function(){return this._effectType}}),e.exports=sp.VertexEffectDelegate},{"./lib/spine":419}],426:[function(t,e,i){"use strict";var n;n=function(W){function f(t,e){return void 0!==t?t:e}var B=1e37,F=1e-5,b=F*F,x=3.14159265359,V=.008,N=2/180*x,w=(z.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},z),k=new w(2,3,2);function z(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}function G(t,e){for(var i=[],n=0;n<t;++n)i.push(e(n));return i}function U(t,e){void 0===e&&(e=0);for(var i=[],n=0;n<t;++n)i.push(e);return i}var j=x/180,Y=180/x,D=Math.abs,I=Math.min,P=Math.max;function q(t,e,i){return t<e?e:i<t?i:t}var J=isFinite;function Z(t){return t*t}function K(t){return 1/Math.sqrt(t)}var Q=Math.sqrt,$=Math.pow,tt=Math.cos,et=Math.sin,it=Math.acos,nt=Math.asin,rt=Math.atan2,H=(e.prototype.Clone=function(){return new e(this.x,this.y)},e.prototype.SetZero=function(){return this.x=0,this.y=0,this},e.prototype.Set=function(t,e){return this.x=t,this.y=e,this},e.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this},e.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.SelfAddXY=function(t,e){return this.x+=t,this.y+=e,this},e.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.SelfSubXY=function(t,e){return this.x-=t,this.y-=e,this},e.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this},e.prototype.SelfMulAdd=function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this},e.prototype.SelfMulSub=function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this},e.prototype.Dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.Cross=function(t){return this.x*t.y-this.y*t.x},e.prototype.Length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},e.prototype.LengthSquared=function(){var t=this.x,e=this.y;return t*t+e*e},e.prototype.Normalize=function(){var t,e=this.Length();return F<=e&&(this.x*=t=1/e,this.y*=t),e},e.prototype.SelfNormalize=function(){var t=this.Length();return F<=t&&(this.x*=t=1/t,this.y*=t),this},e.prototype.SelfRotate=function(t){var e=Math.cos(t),t=Math.sin(t),i=this.x;return this.x=e*i-t*this.y,this.y=t*i+e*this.y,this},e.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},e.prototype.SelfCrossVS=function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this},e.prototype.SelfCrossSV=function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this},e.prototype.SelfMinV=function(t){return this.x=I(this.x,t.x),this.y=I(this.y,t.y),this},e.prototype.SelfMaxV=function(t){return this.x=P(this.x,t.x),this.y=P(this.y,t.y),this},e.prototype.SelfAbs=function(){return this.x=D(this.x),this.y=D(this.y),this},e.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.SelfSkew=function(){var t=this.x;return this.x=-this.y,this.y=t,this},e.MakeArray=function(t){return G(t,function(t){return new e})},e.AbsV=function(t,e){return e.x=D(t.x),e.y=D(t.y),e},e.MinV=function(t,e,i){return i.x=I(t.x,e.x),i.y=I(t.y,e.y),i},e.MaxV=function(t,e,i){return i.x=P(t.x,e.x),i.y=P(t.y,e.y),i},e.ClampV=function(t,e,i,n){return n.x=q(t.x,e.x,i.x),n.y=q(t.y,e.y,i.y),n},e.RotateV=function(t,e,i){var n=t.x,t=t.y,r=Math.cos(e),e=Math.sin(e);return i.x=r*n-e*t,i.y=e*n+r*t,i},e.DotVV=function(t,e){return t.x*e.x+t.y*e.y},e.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},e.CrossVS=function(t,e,i){var n=t.x;return i.x=e*t.y,i.y=-e*n,i},e.CrossVOne=function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e},e.CrossSV=function(t,e,i){var n=e.x;return i.x=-t*e.y,i.y=t*n,i},e.CrossOneV=function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e},e.AddVV=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},e.SubVV=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},e.MulSV=function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i},e.MulVS=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},e.AddVMulSV=function(t,e,i,n){return n.x=t.x+e*i.x,n.y=t.y+e*i.y,n},e.SubVMulSV=function(t,e,i,n){return n.x=t.x-e*i.x,n.y=t.y-e*i.y,n},e.AddVCrossSV=function(t,e,i,n){var r=i.x;return n.x=t.x-e*i.y,n.y=t.y+e*r,n},e.MidVV=function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i},e.ExtVV=function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i},e.IsEqualToV=function(t,e){return t.x===e.x&&t.y===e.y},e.DistanceVV=function(t,e){var i=t.x-e.x,t=t.y-e.y;return Math.sqrt(i*i+t*t)},e.DistanceSquaredVV=function(t,e){var i=t.x-e.x,t=t.y-e.y;return i*i+t*t},e.NegV=function(t,e){return e.x=-t.x,e.y=-t.y,e},e.ZERO=new e(0,0),e.UNITX=new e(1,0),e.UNITY=new e(0,1),e.s_t0=new e,e.s_t1=new e,e.s_t2=new e,e.s_t3=new e,e),st=new H(0,0),at=(pt.prototype.Clone=function(){return new pt(this.x,this.y,this.z)},pt.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},pt.prototype.SetXYZ=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},pt.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},pt.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},pt.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},pt.prototype.SelfAddXYZ=function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this},pt.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},pt.prototype.SelfSubXYZ=function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this},pt.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},pt.DotV3V3=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},pt.CrossV3V3=function(t,e,i){var n=t.x,r=t.y,t=t.z,s=e.x,a=e.y,e=e.z;return i.x=r*e-t*a,i.y=t*s-n*e,i.z=n*a-r*s,i},pt.ZERO=new pt(0,0,0),pt.s_t0=new pt,pt),ot=(r.prototype.Clone=function(){return(new r).Copy(this)},r.FromVV=function(t,e){return(new r).SetVV(t,e)},r.FromSSSS=function(t,e,i,n){return(new r).SetSSSS(t,e,i,n)},r.FromAngle=function(t){return(new r).SetAngle(t)},r.prototype.SetSSSS=function(t,e,i,n){return this.ex.Set(t,i),this.ey.Set(e,n),this},r.prototype.SetVV=function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this},r.prototype.SetAngle=function(t){var e=Math.cos(t),t=Math.sin(t);return this.ex.Set(e,t),this.ey.Set(-t,e),this},r.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this},r.prototype.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},r.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},r.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},r.prototype.GetInverse=function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,s=e*r-i*n;return t.ex.x=(s=0!==s?1/s:s)*r,t.ey.x=-s*i,t.ex.y=-s*n,t.ey.y=s*e,t},r.prototype.Solve=function(t,e,i){var n=this.ex.x,r=this.ey.x,s=this.ex.y,a=this.ey.y,o=n*a-r*s;return i.x=(o=0!==o?1/o:o)*(a*t-r*e),i.y=o*(n*e-s*t),i},r.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},r.prototype.SelfInv=function(){return this.GetInverse(this),this},r.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this},r.prototype.SelfSubM=function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this},r.AbsM=function(t,e){var i=t.ex,t=t.ey;return e.ex.x=D(i.x),e.ex.y=D(i.y),e.ey.x=D(t.x),e.ey.y=D(t.y),e},r.MulMV=function(t,e,i){var n=t.ex,t=t.ey,r=e.x,e=e.y;return i.x=n.x*r+t.x*e,i.y=n.y*r+t.y*e,i},r.MulTMV=function(t,e,i){var n=t.ex,t=t.ey,r=e.x,e=e.y;return i.x=n.x*r+n.y*e,i.y=t.x*r+t.y*e,i},r.AddMM=function(t,e,i){var n=t.ex,t=t.ey,r=e.ex,e=e.ey;return i.ex.x=n.x+r.x,i.ex.y=n.y+r.y,i.ey.x=t.x+e.x,i.ey.y=t.y+e.y,i},r.MulMM=function(t,e,i){var n=t.ex.x,r=t.ex.y,s=t.ey.x,t=t.ey.y,a=e.ex.x,o=e.ex.y,l=e.ey.x,e=e.ey.y;return i.ex.x=n*a+s*o,i.ex.y=r*a+t*o,i.ey.x=n*l+s*e,i.ey.y=r*l+t*e,i},r.MulTMM=function(t,e,i){var n=t.ex.x,r=t.ex.y,s=t.ey.x,t=t.ey.y,a=e.ex.x,o=e.ex.y,l=e.ey.x,e=e.ey.y;return i.ex.x=n*a+r*o,i.ex.y=s*a+t*o,i.ey.x=n*l+r*e,i.ey.y=s*l+t*e,i},r.IDENTITY=new r,r),lt=(ft.prototype.Clone=function(){return(new ft).Copy(this)},ft.prototype.SetVVV=function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this},ft.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this},ft.prototype.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},ft.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},ft.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this},ft.prototype.Solve33=function(t,e,i,n){var r=this.ex.x,s=this.ex.y,a=this.ex.z,o=this.ey.x,l=this.ey.y,h=this.ey.z,c=this.ez.x,u=this.ez.y,_=this.ez.z,d=r*(l*_-h*u)+s*(h*c-o*_)+a*(o*u-l*c);return n.x=(d=0!==d?1/d:d)*(t*(l*_-h*u)+e*(h*c-o*_)+i*(o*u-l*c)),n.y=d*(r*(e*_-i*u)+s*(i*c-t*_)+a*(t*u-e*c)),n.z=d*(r*(l*i-h*e)+s*(h*t-o*i)+a*(o*e-l*t)),n},ft.prototype.Solve22=function(t,e,i){var n=this.ex.x,r=this.ey.x,s=this.ex.y,a=this.ey.y,o=n*a-r*s;return i.x=(o=0!==o?1/o:o)*(a*t-r*e),i.y=o*(n*e-s*t),i},ft.prototype.GetInverse22=function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,s=e*r-i*n;t.ex.x=(s=0!==s?1/s:s)*r,t.ey.x=-s*i,t.ex.z=0,t.ex.y=-s*n,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},ft.prototype.GetSymInverse33=function(t){var e=at.DotV3V3(this.ex,at.CrossV3V3(this.ey,this.ez,at.s_t0)),i=this.ex.x,n=this.ey.x,r=this.ez.x,s=this.ey.y,a=this.ez.y,o=this.ez.z;t.ex.x=(e=0!==e?1/e:e)*(s*o-a*a),t.ex.y=e*(r*a-n*o),t.ex.z=e*(n*a-r*s),t.ey.x=t.ex.y,t.ey.y=e*(i*o-r*r),t.ey.z=e*(r*n-i*a),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*s-n*n)},ft.MulM33V3=function(t,e,i){var n=e.x,r=e.y,e=e.z;return i.x=t.ex.x*n+t.ey.x*r+t.ez.x*e,i.y=t.ex.y*n+t.ey.y*r+t.ez.y*e,i.z=t.ex.z*n+t.ey.z*r+t.ez.z*e,i},ft.MulM33XYZ=function(t,e,i,n,r){return r.x=t.ex.x*e+t.ey.x*i+t.ez.x*n,r.y=t.ex.y*e+t.ey.y*i+t.ez.y*n,r.z=t.ex.z*e+t.ey.z*i+t.ez.z*n,r},ft.MulM33V2=function(t,e,i){var n=e.x,e=e.y;return i.x=t.ex.x*n+t.ey.x*e,i.y=t.ex.y*n+t.ey.y*e,i},ft.MulM33XY=function(t,e,i,n){return n.x=t.ex.x*e+t.ey.x*i,n.y=t.ex.y*e+t.ey.y*i,n},ft.IDENTITY=new ft,ft),R=(dt.prototype.Clone=function(){return(new dt).Copy(this)},dt.prototype.Copy=function(t){return this.s=t.s,this.c=t.c,this},dt.prototype.SetAngle=function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this},dt.prototype.SetIdentity=function(){return this.s=0,this.c=1,this},dt.prototype.GetAngle=function(){return Math.atan2(this.s,this.c)},dt.prototype.GetXAxis=function(t){return t.x=this.c,t.y=this.s,t},dt.prototype.GetYAxis=function(t){return t.x=-this.s,t.y=this.c,t},dt.MulRR=function(t,e,i){var n=t.c,t=t.s,r=e.c,e=e.s;return i.s=t*r+n*e,i.c=n*r-t*e,i},dt.MulTRR=function(t,e,i){var n=t.c,t=t.s,r=e.c,e=e.s;return i.s=n*e-t*r,i.c=n*r+t*e,i},dt.MulRV=function(t,e,i){var n=t.c,t=t.s,r=e.x,e=e.y;return i.x=n*r-t*e,i.y=t*r+n*e,i},dt.MulTRV=function(t,e,i){var n=t.c,t=t.s,r=e.x,e=e.y;return i.x=n*r+t*e,i.y=-t*r+n*e,i},dt.IDENTITY=new dt,dt),O=(_t.prototype.Clone=function(){return(new _t).Copy(this)},_t.prototype.Copy=function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this},_t.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},_t.prototype.SetPositionRotation=function(t,e){return this.p.Copy(t),this.q.Copy(e),this},_t.prototype.SetPositionAngle=function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this},_t.prototype.SetPosition=function(t){return this.p.Copy(t),this},_t.prototype.SetPositionXY=function(t,e){return this.p.Set(t,e),this},_t.prototype.SetRotation=function(t){return this.q.Copy(t),this},_t.prototype.SetRotationAngle=function(t){return this.q.SetAngle(t),this},_t.prototype.GetPosition=function(){return this.p},_t.prototype.GetRotation=function(){return this.q},_t.prototype.GetRotationAngle=function(){return this.q.GetAngle()},_t.prototype.GetAngle=function(){return this.q.GetAngle()},_t.MulXV=function(t,e,i){var n=t.q.c,r=t.q.s,s=e.x,e=e.y;return i.x=n*s-r*e+t.p.x,i.y=r*s+n*e+t.p.y,i},_t.MulTXV=function(t,e,i){var n=t.q.c,r=t.q.s,s=e.x-t.p.x,e=e.y-t.p.y;return i.x=n*s+r*e,i.y=-r*s+n*e,i},_t.MulXX=function(t,e,i){return R.MulRR(t.q,e.q,i.q),H.AddVV(R.MulRV(t.q,e.p,i.p),t.p,i.p),i},_t.MulTXX=function(t,e,i){return R.MulTRR(t.q,e.q,i.q),R.MulTRV(t.q,H.SubVV(e.p,t.p,i.p),i.p),i},_t.IDENTITY=new _t,_t),ht=(ut.prototype.Clone=function(){return(new ut).Copy(this)},ut.prototype.Copy=function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this},ut.prototype.GetTransform=function(t,e){var i=1-e,i=(t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y,i*this.a0+e*this.a);return t.q.SetAngle(i),t.p.SelfSub(R.MulRV(t.q,this.localCenter,H.s_t0)),t},ut.prototype.Advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t},ut.prototype.Normalize=function(){var t=6.28318530718*Math.floor(this.a0/6.28318530718);this.a0-=t,this.a-=t},ut),ct=(i.prototype.Clone=function(){return(new i).Copy(this)},i.prototype.Copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.IsEqual=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},i.prototype.IsZero=function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a},i.prototype.Set=function(t,e,i,n){void 0===n&&(n=this.a),this.SetRGBA(t,e,i,n)},i.prototype.SetByteRGB=function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this},i.prototype.SetByteRGBA=function(t,e,i,n){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=n/255,this},i.prototype.SetRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},i.prototype.SetRGBA=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this},i.prototype.SelfAdd=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},i.prototype.Add=function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e},i.prototype.SelfSub=function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this},i.prototype.Sub=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e},i.prototype.SelfMul=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},i.prototype.Mul=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e},i.prototype.Mix=function(t,e){i.MixColors(this,t,e)},i.MixColors=function(t,e,i){var n=i*(e.r-t.r),r=i*(e.g-t.g),s=i*(e.b-t.b),i=i*(e.a-t.a);t.r+=n,t.g+=r,t.b+=s,t.a+=i,e.r-=n,e.g-=r,e.b-=s,e.a-=i},i.prototype.MakeStyleString=function(t){return void 0===t&&(t=this.a),i.MakeStyleString(this.r,this.g,this.b,t)},i.MakeStyleString=function(t,e,i,n){return t*=255,e*=255,i*=255,(n=void 0===n?1:n)<1?"rgba("+t+","+e+","+i+","+n+")":"rgb("+t+","+e+","+i+")"},i.ZERO=new i(0,0,0,0),i.RED=new i(1,0,0),i.GREEN=new i(0,1,0),i.BLUE=new i(0,0,1),i);function i(t,e,i,n){void 0===e&&(e=.5),void 0===i&&(i=.5),void 0===n&&(n=1),this.r=t=void 0===t?.5:t,this.g=e,this.b=i,this.a=n}function ut(){this.localCenter=new H,this.c0=new H,this.c=new H,this.a0=0,this.a=0,this.alpha0=0}function _t(){this.p=new H,this.q=new R}function dt(t){void 0===t&&(t=0),this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}function ft(){this.ex=new at(1,0,0),this.ey=new at(0,1,0),this.ez=new at(0,0,1)}function r(){this.ex=new H(1,0),this.ey=new H(0,1)}function pt(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.x=t=void 0===t?0:t,this.y=e,this.z=i}function e(t,e){void 0===e&&(e=0),this.x=t=void 0===t?0:t,this.y=e}(bt=W.b2DrawFlags||(W.b2DrawFlags={}))[bt.e_none=0]="e_none",bt[bt.e_shapeBit=1]="e_shapeBit",bt[bt.e_jointBit=2]="e_jointBit",bt[bt.e_aabbBit=4]="e_aabbBit",bt[bt.e_pairBit=8]="e_pairBit",bt[bt.e_centerOfMassBit=16]="e_centerOfMassBit",bt[bt.e_particleBit=32]="e_particleBit",bt[bt.e_controllerBit=64]="e_controllerBit",bt[bt.e_all=63]="e_all";function mt(){}function yt(){}function gt(){this.proxyA=new Tt,this.proxyB=new Tt,this.transformA=new O,this.transformB=new O,this.translationB=new H}function vt(){this.point=new H,this.normal=new H,this.lambda=0,this.iterations=0}Lt.prototype.SetFlags=function(t){this.m_drawFlags=t},Lt.prototype.GetFlags=function(){return this.m_drawFlags},Lt.prototype.AppendFlags=function(t){this.m_drawFlags|=t},Lt.prototype.ClearFlags=function(t){this.m_drawFlags&=~t};var bt=Lt,xt=(Ot.prototype.Reset=function(){return this.m_start=Date.now(),this},Ot.prototype.GetMilliseconds=function(){return Date.now()-this.m_start},Ot),At=(Rt.prototype.GetCount=function(){return this.m_count},Rt.prototype.GetMinCount=function(){return this.m_min_count},Rt.prototype.GetMaxCount=function(){return this.m_max_count},Rt.prototype.ResetCount=function(){var t=this.m_count;return this.m_count=0,t},Rt.prototype.ResetMinCount=function(){this.m_min_count=0},Rt.prototype.ResetMaxCount=function(){this.m_max_count=0},Rt.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},Rt.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},Rt),Ct=(Pt.prototype.Reset=function(){return this.m_count=0,this},Pt.prototype.Push=function(t){this.m_stack[this.m_count]=t,this.m_count++},Pt.prototype.Pop=function(){this.m_count--;var t=this.m_stack[this.m_count];if((this.m_stack[this.m_count]=null)===t)throw new Error;return t},Pt.prototype.GetCount=function(){return this.m_count},Pt),Tt=(It.prototype.Copy=function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this},It.prototype.Reset=function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this},It.prototype.SetShape=function(t,e){t.SetupDistanceProxy(this,e)},It.prototype.SetVerticesRadius=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i},It.prototype.GetSupport=function(t){for(var e=0,i=H.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var r=H.DotVV(this.m_vertices[n],t);i<r&&(e=n,i=r)}return e},It.prototype.GetSupportVertex=function(t){for(var e=0,i=H.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var r=H.DotVV(this.m_vertices[n],t);i<r&&(e=n,i=r)}return this.m_vertices[e]},It.prototype.GetVertexCount=function(){return this.m_count},It.prototype.GetVertex=function(t){return this.m_vertices[t]},It),St=(Bt.prototype.Reset=function(){return this.metric=0,this.count=0,this},Bt),wt=(Dt.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},Dt),Et=(Mt.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},Mt);function Mt(){this.pointA=new H,this.pointB=new H,this.distance=0,this.iterations=0}function Dt(){this.proxyA=new Tt,this.proxyB=new Tt,this.transformA=new O,this.transformB=new O,this.useRadii=!1}function Bt(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}function It(){this.m_buffer=H.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}function Pt(t){this.m_stack=[],this.m_count=0,this.m_stack=G(t,function(t){return null}),this.m_count=0}function Rt(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}function Ot(){this.m_start=Date.now()}function Lt(){this.m_drawFlags=0}W.b2_gjkCalls=0,W.b2_gjkIters=0,W.b2_gjkMaxIters=0;Yt.prototype.Copy=function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this};var Ft=Yt,Vt=(Xt.prototype.ReadCache=function(t,e,i,n,r){this.m_count=t.count;for(var s,a,o,l=this.m_vertices,h=0;h<this.m_count;++h){(o=l[h]).indexA=t.indexA[h],o.indexB=t.indexB[h];var c=e.GetVertex(o.indexA),u=n.GetVertex(o.indexB);O.MulXV(i,c,o.wA),O.MulXV(r,u,o.wB),H.SubVV(o.wB,o.wA,o.w),o.a=0}1<this.m_count&&(s=t.metric,((a=this.GetMetric())<.5*s||2*s<a||a<F)&&(this.m_count=0)),0===this.m_count&&((o=l[0]).indexA=0,o.indexB=0,c=e.GetVertex(0),u=n.GetVertex(0),O.MulXV(i,c,o.wA),O.MulXV(r,u,o.wB),H.SubVV(o.wB,o.wA,o.w),o.a=1,this.m_count=1)},Xt.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB},Xt.prototype.GetSearchDirection=function(t){switch(this.m_count){case 1:return H.NegV(this.m_v1.w,t);case 2:var e=H.SubVV(this.m_v2.w,this.m_v1.w,t);return 0<H.CrossVV(e,H.NegV(this.m_v1.w,H.s_t0))?H.CrossOneV(e,t):H.CrossVOne(e,t);default:return t.SetZero()}},Xt.prototype.GetClosestPoint=function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return t.SetZero()}},Xt.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}},Xt.prototype.GetMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return H.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return H.CrossVV(H.SubVV(this.m_v2.w,this.m_v1.w,H.s_t0),H.SubVV(this.m_v3.w,this.m_v1.w,H.s_t1));default:return 0}},Xt.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=H.SubVV(e,t,Xt.s_e12),t=-H.DotVV(t,i);if(t<=0)return this.m_v1.a=1,void(this.m_count=1);e=H.DotVV(e,i);if(e<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);i=1/(e+t);this.m_v1.a=e*i,this.m_v2.a=t*i,this.m_count=2},Xt.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,n=H.SubVV(e,t,Xt.s_e12),r=H.DotVV(t,n),s=H.DotVV(e,n),r=-r,a=H.SubVV(i,t,Xt.s_e13),o=H.DotVV(t,a),l=H.DotVV(i,a),o=-o,h=H.SubVV(i,e,Xt.s_e23),c=H.DotVV(e,h),h=H.DotVV(i,h),c=-c,n=H.CrossVV(n,a),a=n*H.CrossVV(e,i),i=n*H.CrossVV(i,t),n=n*H.CrossVV(t,e);if(r<=0&&o<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<s&&0<r&&n<=0)return this.m_v1.a=s*(t=1/(s+r)),this.m_v2.a=r*t,void(this.m_count=2);if(0<l&&0<o&&i<=0)return this.m_v1.a=l*(e=1/(l+o)),this.m_v3.a=o*e,this.m_count=2,void this.m_v2.Copy(this.m_v3);if(s<=0&&c<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(l<=0&&h<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(0<h&&0<c&&a<=0)return this.m_v2.a=h*(r=1/(h+c)),this.m_v3.a=c*r,this.m_count=2,void this.m_v1.Copy(this.m_v3);t=1/(a+i+n);this.m_v1.a=a*t,this.m_v2.a=i*t,this.m_v3.a=n*t,this.m_count=3},Xt.s_e12=new H,Xt.s_e13=new H,Xt.s_e23=new H,Xt),Nt=new Vt,kt=[0,0,0],zt=[0,0,0],Gt=new H,Ut=new H,jt=new H,Wt=new H,Ht=new H;function Xt(){this.m_v1=new Ft,this.m_v2=new Ft,this.m_v3=new Ft,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}function Yt(){this.wA=new H,this.wB=new H,this.w=new H,this.a=0,this.indexA=0,this.indexB=0}function qt(t,e,i){++W.b2_gjkCalls;var n=i.proxyA,r=i.proxyB,s=i.transformA,a=i.transformB,o=Nt;o.ReadCache(e,n,s,r,a);for(var l,h=o.m_vertices,c=kt,u=zt,_=0;_<20;){for(var d=o.m_count,f=0;f<d;++f)c[f]=h[f].indexA,u[f]=h[f].indexB;switch(o.m_count){case 1:break;case 2:o.Solve2();break;case 3:o.Solve3()}if(3===o.m_count)break;var p=o.GetSearchDirection(Ut);if(p.LengthSquared()<b)break;for(var m=h[o.m_count],y=(m.indexA=n.GetSupport(R.MulTRV(s.q,H.NegV(p,H.s_t0),Wt)),O.MulXV(s,n.GetVertex(m.indexA),m.wA),m.indexB=r.GetSupport(R.MulTRV(a.q,p,Ht)),O.MulXV(a,r.GetVertex(m.indexB),m.wB),H.SubVV(m.wB,m.wA,m.w),++_,++W.b2_gjkIters,!1),f=0;f<d;++f)if(m.indexA===c[f]&&m.indexB===u[f]){y=!0;break}if(y)break;++o.m_count}W.b2_gjkMaxIters=P(W.b2_gjkMaxIters,_),o.GetWitnessPoints(t.pointA,t.pointB),t.distance=H.DistanceVV(t.pointA,t.pointB),t.iterations=_,o.WriteCache(e),i.useRadii&&(e=n.m_radius,i=r.m_radius,t.distance>e+i&&t.distance>F?(t.distance-=e+i,(l=H.SubVV(t.pointB,t.pointA,jt)).Normalize(),t.pointA.SelfMulAdd(e,l),t.pointB.SelfMulSub(i,l)):(e=H.MidVV(t.pointA,t.pointB,Gt),t.pointA.Copy(e),t.pointB.Copy(e),t.distance=0))}var Jt=new H,Zt=new Vt,Kt=new H,Qt=new H,$t=new H,te=new H,ee=new H,ie=new H,ne=((ce=W.b2ContactFeatureType||(W.b2ContactFeatureType={}))[ce.e_vertex=0]="e_vertex",ce[ce.e_face=1]="e_face",Object.defineProperty(le.prototype,"key",{get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255},enumerable:!0,configurable:!0}),Object.defineProperty(le.prototype,"indexA",{get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(le.prototype,"indexB",{get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(le.prototype,"typeA",{get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(le.prototype,"typeB",{get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),le),re=(oe.prototype.Copy=function(t){return this.key=t.key,this},oe.prototype.Clone=function(){return(new oe).Copy(this)},Object.defineProperty(oe.prototype,"key",{get:function(){return this.cf.key},set:function(t){this.cf.key=t},enumerable:!0,configurable:!0}),oe),se=(ae.MakeArray=function(t){return G(t,function(t){return new ae})},ae.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},ae.prototype.Copy=function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this},ae);function ae(){this.localPoint=new H,this.normalImpulse=0,this.tangentImpulse=0,this.id=new re}function oe(){this.cf=new ne}function le(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}(ce=W.b2ManifoldType||(W.b2ManifoldType={}))[ce.e_unknown=-1]="e_unknown",ce[ce.e_circles=0]="e_circles",ce[ce.e_faceA=1]="e_faceA",ce[ce.e_faceB=2]="e_faceB";_e.prototype.Reset=function(){for(var t=0;t<2;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=W.b2ManifoldType.e_unknown,this.pointCount=0},_e.prototype.Copy=function(t){this.pointCount=t.pointCount;for(var e=0;e<2;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this},_e.prototype.Clone=function(){return(new _e).Copy(this)};var he=_e,ce=(ue.prototype.Initialize=function(t,e,i,n,r){if(0!==t.pointCount)switch(t.type){case W.b2ManifoldType.e_circles:this.normal.Set(1,0);var s=O.MulXV(e,t.localPoint,ue.Initialize_s_pointA),a=O.MulXV(n,t.points[0].localPoint,ue.Initialize_s_pointB),o=(H.DistanceSquaredVV(s,a)>b&&H.SubVV(a,s,this.normal).SelfNormalize(),H.AddVMulSV(s,i,this.normal,ue.Initialize_s_cA)),l=H.SubVMulSV(a,r,this.normal,ue.Initialize_s_cB);H.MidVV(o,l,this.points[0]),this.separations[0]=H.DotVV(H.SubVV(l,o,H.s_t0),this.normal);break;case W.b2ManifoldType.e_faceA:R.MulRV(e.q,t.localNormal,this.normal);for(var h=O.MulXV(e,t.localPoint,ue.Initialize_s_planePoint),c=0;c<t.pointCount;++c){var u=O.MulXV(n,t.points[c].localPoint,ue.Initialize_s_clipPoint),_=i-H.DotVV(H.SubVV(u,h,H.s_t0),this.normal),o=H.AddVMulSV(u,_,this.normal,ue.Initialize_s_cA),l=H.SubVMulSV(u,r,this.normal,ue.Initialize_s_cB);H.MidVV(o,l,this.points[c]),this.separations[c]=H.DotVV(H.SubVV(l,o,H.s_t0),this.normal)}break;case W.b2ManifoldType.e_faceB:for(R.MulRV(n.q,t.localNormal,this.normal),h=O.MulXV(n,t.localPoint,ue.Initialize_s_planePoint),c=0;c<t.pointCount;++c)u=O.MulXV(e,t.points[c].localPoint,ue.Initialize_s_clipPoint),_=r-H.DotVV(H.SubVV(u,h,H.s_t0),this.normal),l=H.AddVMulSV(u,_,this.normal,ue.Initialize_s_cB),o=H.SubVMulSV(u,i,this.normal,ue.Initialize_s_cA),H.MidVV(o,l,this.points[c]),this.separations[c]=H.DotVV(H.SubVV(o,l,H.s_t0),this.normal);this.normal.SelfNeg()}},ue.Initialize_s_pointA=new H,ue.Initialize_s_pointB=new H,ue.Initialize_s_cA=new H,ue.Initialize_s_cB=new H,ue.Initialize_s_planePoint=new H,ue.Initialize_s_clipPoint=new H,ue);function ue(){this.normal=new H,this.points=H.MakeArray(2),this.separations=U(2)}function _e(){this.points=se.MakeArray(2),this.localNormal=new H,this.localPoint=new H,this.type=W.b2ManifoldType.e_unknown,this.pointCount=0}(de=W.b2PointState||(W.b2PointState={}))[de.b2_nullState=0]="b2_nullState",de[de.b2_addState=1]="b2_addState",de[de.b2_persistState=2]="b2_persistState",de[de.b2_removeState=3]="b2_removeState";be.MakeArray=function(t){return G(t,function(t){return new be})},be.prototype.Copy=function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this};var de=be,fe=(ve.prototype.Copy=function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this},ve),pe=(ge.prototype.Copy=function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this},ge),me=(ye.prototype.Copy=function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this},ye.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,t=0<=t&&0<=e;return t&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},ye.prototype.GetCenter=function(){return H.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)},ye.prototype.GetExtents=function(){return H.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)},ye.prototype.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},ye.prototype.Combine1=function(t){return this.lowerBound.x=I(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=I(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=P(this.upperBound.x,t.upperBound.x),this.upperBound.y=P(this.upperBound.y,t.upperBound.y),this},ye.prototype.Combine2=function(t,e){return this.lowerBound.x=I(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=I(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=P(t.upperBound.x,e.upperBound.x),this.upperBound.y=P(t.upperBound.y,e.upperBound.y),this},ye.Combine=function(t,e,i){return i.Combine2(t,e),i},ye.prototype.Contains=function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y},ye.prototype.RayCast=function(t,e){var i=-B,n=B,r=e.p1.x,s=e.p1.y,a=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,l=D(a),h=D(o),c=t.normal;if(l<F){if(r<this.lowerBound.x||this.upperBound.x<r)return!1}else{var u,_=1/a,d=-1;if((f=(this.lowerBound.x-r)*_)>(p=(this.upperBound.x-r)*_)&&(u=f,f=p,p=u,d=1),i<f&&(c.x=d,c.y=0,i=f),i>(n=I(n,p)))return!1}if(h<F){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{var f,p,_=1/o;if(d=-1,(f=(this.lowerBound.y-s)*_)>(p=(this.upperBound.y-s)*_)&&(u=f,f=p,p=u,d=1),i<f&&(c.x=0,c.y=d,i=f),i>(n=I(n,p)))return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,0))},ye.prototype.TestContain=function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)},ye.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,n=this.lowerBound.x-t.upperBound.x,t=this.lowerBound.y-t.upperBound.y;return!(0<e||0<i||0<n||0<t)},ye);function ye(){this.lowerBound=new H,this.upperBound=new H,this.m_cache_center=new H,this.m_cache_extent=new H}function ge(){this.normal=new H,this.fraction=0}function ve(){this.p1=new H,this.p2=new H,this.maxFraction=1}function be(){this.v=new H,this.id=new re}function xe(t,e){var i=e.lowerBound.x-t.upperBound.x,n=e.lowerBound.y-t.upperBound.y,r=t.lowerBound.x-e.upperBound.x,t=t.lowerBound.y-e.upperBound.y;return!(0<i||0<n||0<r||0<t)}function Ae(t,e,i,n,r){var s=0,a=e[0],e=e[1],o=H.DotVV(i,a.v)-n,i=H.DotVV(i,e.v)-n;return o<=0&&t[s++].Copy(a),i<=0&&t[s++].Copy(e),o*i<0&&((n=t[s].v).x=a.v.x+(o=o/(o-i))*(e.v.x-a.v.x),n.y=a.v.y+o*(e.v.y-a.v.y),(i=t[s].id).cf.indexA=r,i.cf.indexB=a.id.cf.indexB,i.cf.typeA=W.b2ContactFeatureType.e_vertex,i.cf.typeB=W.b2ContactFeatureType.e_face,++s),s}var Ce=new wt,Te=new St,Se=new Et;function we(t,e,i,n,r,s){var a=Ce.Reset(),t=(a.proxyA.SetShape(t,e),a.proxyB.SetShape(i,n),a.transformA.Copy(r),a.transformB.Copy(s),a.useRadii=!0,Te.Reset()),e=(t.count=0,Se.Reset());return qt(e,t,a),e.distance<10*F}function p(t){if(null===t)throw new Error;return t}Pe.prototype.IsLeaf=function(){return null===this.child1};var Ee=Pe,Me=(m.prototype.Query=function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);0<i.GetCount();){var n=i.Pop();if(n.aabb.TestOverlap(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(p(n.child1)),i.Push(p(n.child2))}}},m.prototype.QueryPoint=function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);0<i.GetCount();){var n=i.Pop();if(n.aabb.TestContain(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(p(n.child1)),i.Push(p(n.child2))}}},m.prototype.RayCast=function(t,e){if(null!==this.m_root){var i=t.p1,n=t.p2,r=H.SubVV(n,i,m.s_r),s=(r.Normalize(),H.CrossOneV(r,m.s_v)),a=H.AbsV(s,m.s_abs_v),o=t.maxFraction,l=m.s_segmentAABB,h=i.x+o*(n.x-i.x),c=i.y+o*(n.y-i.y),u=(l.lowerBound.x=I(i.x,h),l.lowerBound.y=I(i.y,c),l.upperBound.x=P(i.x,h),l.upperBound.y=P(i.y,c),this.m_stack.Reset());for(u.Push(this.m_root);0<u.GetCount();){var _=u.Pop();if(xe(_.aabb,l)){var d=_.aabb.GetCenter(),f=_.aabb.GetExtents();if(!(0<D(H.DotVV(s,H.SubVV(i,d,H.s_t0)))-H.DotVV(a,f)))if(_.IsLeaf()){d=m.s_subInput,f=(d.p1.Copy(t.p1),d.p2.Copy(t.p2),d.maxFraction=o,e(d,_));if(0===f)return;0<f&&(h=i.x+(o=f)*(n.x-i.x),c=i.y+o*(n.y-i.y),l.lowerBound.x=I(i.x,h),l.lowerBound.y=I(i.y,c),l.upperBound.x=P(i.x,h),l.upperBound.y=P(i.y,c))}else u.Push(p(_.child1)),u.Push(p(_.child2))}}}},m.prototype.AllocateNode=function(){var t;return this.m_freeList?(t=this.m_freeList,this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,delete t.userData,t):new Ee(m.s_node_id++)},m.prototype.FreeNode=function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,delete t.userData,this.m_freeList=t},m.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();return i.aabb.lowerBound.x=t.lowerBound.x-.1,i.aabb.lowerBound.y=t.lowerBound.y-.1,i.aabb.upperBound.x=t.upperBound.x+.1,i.aabb.upperBound.y=t.upperBound.y+.1,i.userData=e,i.height=0,this.InsertLeaf(i),i},m.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},m.prototype.MoveProxy=function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var n=.1+2*(0<i.x?i.x:-i.x),i=.1+2*(0<i.y?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-n,t.aabb.lowerBound.y=e.lowerBound.y-i,t.aabb.upperBound.x=e.upperBound.x+n,t.aabb.upperBound.y=e.upperBound.y+i,this.InsertLeaf(t),!0},m.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;!i.IsLeaf();){var n=p(i.child1),r=p(i.child2),s=i.aabb.GetPerimeter(),a=m.s_combinedAABB,a=(a.Combine2(i.aabb,e),a.GetPerimeter()),o=2*a,a=2*(a-s),s=void 0,l=m.s_aabb,h=void 0,s=n.IsLeaf()?(l.Combine2(e,n.aabb),l.GetPerimeter()+a):(l.Combine2(e,n.aabb),h=n.aabb.GetPerimeter(),l.GetPerimeter()-h+a),c=void 0,c=r.IsLeaf()?(l.Combine2(e,r.aabb),l.GetPerimeter()+a):(l.Combine2(e,r.aabb),h=r.aabb.GetPerimeter(),l.GetPerimeter()-h+a);if(o<s&&o<c)break;i=s<c?n:r}var u=i,_=u.parent,d=this.AllocateNode();d.parent=_,delete d.userData,d.aabb.Combine2(e,u.aabb),d.height=u.height+1,_?(_.child1===u?_.child1=d:_.child2=d,d.child1=u,d.child2=t,u.parent=d,t.parent=d):(d.child1=u,d.child2=t,u.parent=d,t.parent=d,this.m_root=d);for(var f=t.parent;null!==f;)n=p((f=this.Balance(f)).child1),r=p(f.child2),f.height=1+P(n.height,r.height),f.aabb.Combine2(n.aabb,r.aabb),f=f.parent},m.prototype.RemoveLeaf=function(t){if(t!==this.m_root){var e=p(t.parent),i=e&&e.parent,t=e.child1===t?p(e.child2):p(e.child1);if(i){i.child1===e?i.child1=t:i.child2=t,t.parent=i,this.FreeNode(e);for(var n=i;n;){var r=p((n=this.Balance(n)).child1),s=p(n.child2);n.aabb.Combine2(r.aabb,s.aabb),n.height=1+P(r.height,s.height),n=n.parent}}else(this.m_root=t).parent=null,this.FreeNode(e)}else this.m_root=null},m.prototype.Balance=function(t){if(t.IsLeaf()||t.height<2)return t;var e,i,n=p(t.child1),r=p(t.child2),s=r.height-n.height;return 1<s?(e=p(r.child1),i=p(r.child2),r.child1=t,r.parent=t.parent,null!==(t.parent=r).parent?r.parent.child1===t?r.parent.child1=r:r.parent.child2=r:this.m_root=r,e.height>i.height?(r.child2=e,((t.child2=i).parent=t).aabb.Combine2(n.aabb,i.aabb),r.aabb.Combine2(t.aabb,e.aabb),t.height=1+P(n.height,i.height),r.height=1+P(t.height,e.height)):(r.child2=i,((t.child2=e).parent=t).aabb.Combine2(n.aabb,e.aabb),r.aabb.Combine2(t.aabb,i.aabb),t.height=1+P(n.height,e.height),r.height=1+P(t.height,i.height)),r):s<-1?(e=p(n.child1),i=p(n.child2),n.child1=t,n.parent=t.parent,null!==(t.parent=n).parent?n.parent.child1===t?n.parent.child1=n:n.parent.child2=n:this.m_root=n,e.height>i.height?(n.child2=e,((t.child1=i).parent=t).aabb.Combine2(r.aabb,i.aabb),n.aabb.Combine2(t.aabb,e.aabb),t.height=1+P(r.height,i.height),n.height=1+P(t.height,e.height)):(n.child2=i,((t.child1=e).parent=t).aabb.Combine2(r.aabb,e.aabb),n.aabb.Combine2(t.aabb,i.aabb),t.height=1+P(r.height,e.height),n.height=1+P(t.height,i.height)),n):t},m.prototype.GetHeight=function(){return null===this.m_root?0:this.m_root.height},m.GetAreaNode=function(t){if(null===t)return 0;if(t.IsLeaf())return 0;var e=t.aabb.GetPerimeter();return(e+=m.GetAreaNode(t.child1))+m.GetAreaNode(t.child2)},m.prototype.GetAreaRatio=function(){if(null===this.m_root)return 0;var t=this.m_root.aabb.GetPerimeter();return m.GetAreaNode(this.m_root)/t},m.prototype.ComputeHeightNode=function(t){if(!t||t.IsLeaf())return 0;var e=this.ComputeHeightNode(t.child1),t=this.ComputeHeightNode(t.child2);return 1+P(e,t)},m.prototype.ComputeHeight=function(){return this.ComputeHeightNode(this.m_root)},m.prototype.ValidateStructure=function(t){var e;null!==t&&(this.m_root,(t=t).IsLeaf()||(e=p(t.child1),t=p(t.child2),this.ValidateStructure(e),this.ValidateStructure(t)))},m.prototype.ValidateMetrics=function(t){var e;null===t||(t=t).IsLeaf()||(e=p(t.child1),t=p(t.child2),m.s_aabb.Combine2(e.aabb,t.aabb),this.ValidateMetrics(e),this.ValidateMetrics(t))},m.prototype.Validate=function(){},m.GetMaxBalanceNode=function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=p(t.child1),t=p(t.child2),t=D(t.height-i.height);return P(e,t)},m.prototype.GetMaxBalance=function(){return m.GetMaxBalanceNode(this.m_root,0)},m.prototype.RebuildBottomUp=function(){this.Validate()},m.ShiftOriginNode=function(t,e){var i,n;null===t||t.height<=1||(i=t.child1,n=t.child2,m.ShiftOriginNode(i,e),m.ShiftOriginNode(n,e),t.aabb.lowerBound.SelfSub(e),t.aabb.upperBound.SelfSub(e))},m.prototype.ShiftOrigin=function(t){m.ShiftOriginNode(this.m_root,t)},m.s_r=new H,m.s_v=new H,m.s_abs_v=new H,m.s_segmentAABB=new me,m.s_subInput=new fe,m.s_combinedAABB=new me,m.s_aabb=new me,m.s_node_id=0,m),De=function(t,e){this.proxyA=t,this.proxyB=e},Be=(Ie.prototype.CreateProxy=function(t,e){t=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(t),t},Ie.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},Ie.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},Ie.prototype.TouchProxy=function(t){this.BufferMove(t)},Ie.prototype.GetProxyCount=function(){return this.m_proxyCount},Ie.prototype.UpdatePairs=function(t){var r=this;this.m_pairCount=0;for(var e=this,i=0;i<this.m_moveCount;++i)!function(t){var n=e.m_moveBuffer[t];if(null===n)return;t=n.aabb;e.m_tree.Query(t,function(t){if(t.m_id===n.m_id)return!0;var e,i,t=t.m_id<n.m_id?(e=t,n):(e=n,t);return r.m_pairCount===r.m_pairBuffer.length?r.m_pairBuffer[r.m_pairCount]=new De(e,t):((i=r.m_pairBuffer[r.m_pairCount]).proxyA=e,i.proxyB=t),++r.m_pairCount,!0})}(i);this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(Re);for(var n=0;n<this.m_pairCount;){var s=this.m_pairBuffer[n],a=s.proxyA.userData,o=s.proxyB.userData;for(a&&o&&t(a,o),++n;n<this.m_pairCount;){var l=this.m_pairBuffer[n];if(l.proxyA.m_id!==s.proxyA.m_id||l.proxyB.m_id!==s.proxyB.m_id)break;++n}}},Ie.prototype.Query=function(t,e){this.m_tree.Query(t,e)},Ie.prototype.QueryPoint=function(t,e){this.m_tree.QueryPoint(t,e)},Ie.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},Ie.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},Ie.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},Ie.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},Ie.prototype.ShiftOrigin=function(t){this.m_tree.ShiftOrigin(t)},Ie.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},Ie.prototype.UnBufferMove=function(t){t=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[t]=null},Ie);function Ie(){this.m_tree=new Me,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}function m(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new Ct(256)}function Pe(t){void 0===t&&(t=0),this.m_id=0,this.aabb=new me,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}function Re(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}W.b2_toiTime=0,W.b2_toiMaxTime=0,W.b2_toiCalls=0,W.b2_toiIters=0,W.b2_toiMaxIters=0,W.b2_toiRootIters=0,W.b2_toiMaxRootIters=0;var Oe=new O,Le=new O,Fe=new H,Ve=new H,Ne=new H,ke=new H,ze=new H,Ge=function(){this.proxyA=new Tt,this.proxyB=new Tt,this.sweepA=new ht,this.sweepB=new ht,this.tMax=0},Ue=((Ue=W.b2TOIOutputState||(W.b2TOIOutputState={}))[Ue.e_unknown=0]="e_unknown",Ue[Ue.e_failed=1]="e_failed",Ue[Ue.e_overlapped=2]="e_overlapped",Ue[Ue.e_touching=3]="e_touching",Ue[Ue.e_separated=4]="e_separated",function(){this.state=W.b2TOIOutputState.e_unknown,this.t=0}),je=((je=W.b2SeparationFunctionType||(W.b2SeparationFunctionType={}))[je.e_unknown=-1]="e_unknown",je[je.e_points=0]="e_points",je[je.e_faceA=1]="e_faceA",je[je.e_faceB=2]="e_faceB",$e.prototype.Initialize=function(t,e,i,n,r,s){this.m_proxyA=e,this.m_proxyB=n;var a,o,l,h,c,u,e=t.count,n=(this.m_sweepA.Copy(i),this.m_sweepB.Copy(r),Oe),i=Le;if(this.m_sweepA.GetTransform(n,s),this.m_sweepB.GetTransform(i,s),1===e)return this.m_type=W.b2SeparationFunctionType.e_points,a=this.m_proxyA.GetVertex(t.indexA[0]),o=this.m_proxyB.GetVertex(t.indexB[0]),l=O.MulXV(n,a,Fe),h=O.MulXV(i,o,Ve),H.SubVV(h,l,this.m_axis),c=this.m_axis.Normalize(),this.m_localPoint.SetZero(),c;if(t.indexA[0]===t.indexA[1])return this.m_type=W.b2SeparationFunctionType.e_faceB,r=this.m_proxyB.GetVertex(t.indexB[0]),s=this.m_proxyB.GetVertex(t.indexB[1]),H.CrossVOne(H.SubVV(s,r,H.s_t0),this.m_axis).SelfNormalize(),u=R.MulRV(i.q,this.m_axis,Ne),H.MidVV(r,s,this.m_localPoint),h=O.MulXV(i,this.m_localPoint,Ve),a=this.m_proxyA.GetVertex(t.indexA[0]),l=O.MulXV(n,a,Fe),(c=H.DotVV(H.SubVV(l,h,H.s_t0),u))<0&&(this.m_axis.SelfNeg(),c=-c),c;this.m_type=W.b2SeparationFunctionType.e_faceA;e=this.m_proxyA.GetVertex(t.indexA[0]),r=this.m_proxyA.GetVertex(t.indexA[1]);return H.CrossVOne(H.SubVV(r,e,H.s_t0),this.m_axis).SelfNormalize(),u=R.MulRV(n.q,this.m_axis,Ne),H.MidVV(e,r,this.m_localPoint),l=O.MulXV(n,this.m_localPoint,Fe),o=this.m_proxyB.GetVertex(t.indexB[0]),h=O.MulXV(i,o,Ve),(c=H.DotVV(H.SubVV(h,l,H.s_t0),u))<0&&(this.m_axis.SelfNeg(),c=-c),c},$e.prototype.FindMinSeparation=function(t,e,i){var n=Oe,r=Le;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(r,i),this.m_type){case W.b2SeparationFunctionType.e_points:var s=R.MulTRV(n.q,this.m_axis,ke),a=R.MulTRV(r.q,H.NegV(this.m_axis,H.s_t0),ze),o=(t[0]=this.m_proxyA.GetSupport(s),e[0]=this.m_proxyB.GetSupport(a),this.m_proxyA.GetVertex(t[0])),l=this.m_proxyB.GetVertex(e[0]),h=O.MulXV(n,o,Fe),c=O.MulXV(r,l,Ve);return H.DotVV(H.SubVV(c,h,H.s_t0),this.m_axis);case W.b2SeparationFunctionType.e_faceA:var u=R.MulRV(n.q,this.m_axis,Ne),h=O.MulXV(n,this.m_localPoint,Fe),a=R.MulTRV(r.q,H.NegV(u,H.s_t0),ze);return t[0]=-1,e[0]=this.m_proxyB.GetSupport(a),l=this.m_proxyB.GetVertex(e[0]),c=O.MulXV(r,l,Ve),H.DotVV(H.SubVV(c,h,H.s_t0),u);case W.b2SeparationFunctionType.e_faceB:return u=R.MulRV(r.q,this.m_axis,Ne),c=O.MulXV(r,this.m_localPoint,Ve),s=R.MulTRV(n.q,H.NegV(u,H.s_t0),ke),e[0]=-1,t[0]=this.m_proxyA.GetSupport(s),o=this.m_proxyA.GetVertex(t[0]),h=O.MulXV(n,o,Fe),H.DotVV(H.SubVV(h,c,H.s_t0),u);default:return t[0]=-1,e[0]=-1,0}},$e.prototype.Evaluate=function(t,e,i){var n=Oe,r=Le;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(r,i),this.m_type){case W.b2SeparationFunctionType.e_points:var s=this.m_proxyA.GetVertex(t),a=this.m_proxyB.GetVertex(e),o=O.MulXV(n,s,Fe),l=O.MulXV(r,a,Ve);return H.DotVV(H.SubVV(l,o,H.s_t0),this.m_axis);case W.b2SeparationFunctionType.e_faceA:var h=R.MulRV(n.q,this.m_axis,Ne),o=O.MulXV(n,this.m_localPoint,Fe),a=this.m_proxyB.GetVertex(e),l=O.MulXV(r,a,Ve);return H.DotVV(H.SubVV(l,o,H.s_t0),h);case W.b2SeparationFunctionType.e_faceB:return h=R.MulRV(r.q,this.m_axis,Ne),l=O.MulXV(r,this.m_localPoint,Ve),s=this.m_proxyA.GetVertex(t),o=O.MulXV(n,s,Fe),H.DotVV(H.SubVV(o,l,H.s_t0),h);default:return 0}},$e),We=new xt,He=new St,Xe=new wt,Ye=new Et,qe=new je,Je=[0],Ze=[0],Ke=new ht,Qe=new ht;function $e(){this.m_sweepA=new ht,this.m_sweepB=new ht,this.m_type=W.b2SeparationFunctionType.e_unknown,this.m_localPoint=new H,this.m_axis=new H}function ti(t,e){var i=We.Reset(),n=(++W.b2_toiCalls,t.state=W.b2TOIOutputState.e_unknown,t.t=e.tMax,e.proxyA),r=e.proxyB,s=Ke.Copy(e.sweepA),a=Qe.Copy(e.sweepB),o=(s.Normalize(),a.Normalize(),e.tMax),l=n.m_radius+r.m_radius,h=P(V,l-.024),c=0,u=0,_=He,d=(_.count=0,Xe);for(d.proxyA.Copy(e.proxyA),d.proxyB.Copy(e.proxyB),d.useRadii=!1;;){var f=Oe,p=Le,f=(s.GetTransform(f,c),a.GetTransform(p,c),d.transformA.Copy(f),d.transformB.Copy(p),Ye);if(qt(f,_,d),f.distance<=0){t.state=W.b2TOIOutputState.e_overlapped,t.t=0;break}if(f.distance<h+.002){t.state=W.b2TOIOutputState.e_touching,t.t=c;break}var m=qe;m.Initialize(_,n,s,r,a,c);for(var y=!1,g=o,v=0;;){var b=Je,x=Ze,A=m.FindMinSeparation(b,x,g);if(h+.002<A){t.state=W.b2TOIOutputState.e_separated,t.t=o,y=!0;break}if(h-.002<A){c=g;break}var C=m.Evaluate(b[0],x[0],c);if(C<h-.002){t.state=W.b2TOIOutputState.e_failed,t.t=c,y=!0;break}if(C<=h+.002){t.state=W.b2TOIOutputState.e_touching,t.t=c,y=!0;break}for(var T=0,S=c,w=g;;){var E=1&T?S+(h-C)*(w-S)/(A-C):.5*(S+w),M=(++T,++W.b2_toiRootIters,m.Evaluate(b[0],x[0],E));if(D(M-h)<.002){g=E;break}if(h<M?(S=E,C=M):(w=E,A=M),50===T)break}if(W.b2_toiMaxRootIters=P(W.b2_toiMaxRootIters,T),8==++v)break}if(++u,++W.b2_toiIters,y)break;if(20===u){t.state=W.b2TOIOutputState.e_failed,t.t=c;break}}W.b2_toiMaxIters=P(W.b2_toiMaxIters,u);l=i.GetMilliseconds();W.b2_toiMaxTime=P(W.b2_toiMaxTime,l),W.b2_toiTime+=l}var ei=new H,ii=new H;function ni(t,e,i,n,r){t.pointCount=0;i=O.MulXV(i,e.m_p,ei),r=O.MulXV(r,n.m_p,ii),i=H.DistanceSquaredVV(i,r),r=e.m_radius+n.m_radius;r*r<i||(t.type=W.b2ManifoldType.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0)}var ri=new H,si=new H,ai=new H;function oi(t,e,i,n,r){t.pointCount=0;for(var r=O.MulXV(r,n.m_p,ri),s=O.MulTXV(i,r,si),a=0,o=-B,l=e.m_radius+n.m_radius,h=e.m_count,c=e.m_vertices,u=e.m_normals,_=0;_<h;++_){var d=H.DotVV(u[_],H.SubVV(s,c[_],H.s_t0));if(l<d)return;o<d&&(o=d,a=_)}i=a,r=c[i],e=c[(i+1)%h];if(o<F)return t.pointCount=1,t.type=W.b2ManifoldType.e_faceA,t.localNormal.Copy(u[a]),H.MidVV(r,e,t.localPoint),t.points[0].localPoint.Copy(n.m_p),void(t.points[0].id.key=0);var f=H.DotVV(H.SubVV(s,r,H.s_t0),H.SubVV(e,r,H.s_t1)),p=H.DotVV(H.SubVV(s,e,H.s_t0),H.SubVV(r,e,H.s_t1));f<=0?H.DistanceSquaredVV(s,r)>l*l||(t.pointCount=1,t.type=W.b2ManifoldType.e_faceA,H.SubVV(s,r,t.localNormal).SelfNormalize(),t.localPoint.Copy(r),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0):p<=0?H.DistanceSquaredVV(s,e)>l*l||(t.pointCount=1,t.type=W.b2ManifoldType.e_faceA,H.SubVV(s,e,t.localNormal).SelfNormalize(),t.localPoint.Copy(e),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0):(f=H.MidVV(r,e,ai),H.DotVV(H.SubVV(s,f,H.s_t1),u[i])>l||(t.pointCount=1,t.type=W.b2ManifoldType.e_faceA,t.localNormal.Copy(u[i]).SelfNormalize(),t.localPoint.Copy(f),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0))}var li=new H,hi=new H,ci=new H,ui=new H;function _i(t,e,i,n,r){for(var s=t.m_vertices,t=t.m_normals,a=n.m_count,o=n.m_vertices,n=R.MulRV(e.q,t[i],li),l=R.MulTRV(r.q,n,hi),h=0,c=B,u=0;u<a;++u){var _=H.DotVV(o[u],l);_<c&&(c=_,h=u)}t=O.MulXV(e,s[i],ci),e=O.MulXV(r,o[h],ui);return H.DotVV(H.SubVV(e,t,H.s_t0),n)}var di=new H,fi=new H;function pi(t,e,i,n,r){for(var s=e.m_count,a=e.m_normals,o=H.SubVV(O.MulXV(r,n.m_centroid,H.s_t0),O.MulXV(i,e.m_centroid,H.s_t1),di),l=R.MulTRV(i.q,o,fi),h=0,c=-B,u=0;u<s;++u){var _=H.DotVV(a[u],l);c<_&&(c=_,h=u)}var d=_i(e,i,h,n,r),o=(h+s-1)%s,f=_i(e,i,o,n,r),p=(h+1)%s,m=_i(e,i,p,n,r),y=0,g=0,v=0;if(d<f&&m<f)v=-1,y=o,g=f;else{if(!(d<m))return t[0]=h,d;v=1,y=p,g=m}for(;(d=_i(e,i,h=-1===v?(y+s-1)%s:(y+1)%s,n,r))>g;)y=h,g=d;return t[0]=y,g}var mi=new H;var yi=de.MakeArray(2),gi=de.MakeArray(2),vi=de.MakeArray(2),bi=[0],xi=[0],Ai=new H,Ci=new H,Ti=new H,Si=new H,wi=new H,Ei=new H,Mi=new H,Di=new H;function Bi(t,e,i,n,r){t.pointCount=0;var s=e.m_radius+n.m_radius,a=bi,o=(a[0]=0,pi(a,e,i,n,r));if(!(s<o)){var l=xi,h=(l[0]=0,pi(l,n,r,e,i));if(!(s<h)){for(var c,u,_=0,d=0,d=.98*o+.001<h?(c=n,x=e,T=r,u=i,_=l[0],t.type=W.b2ManifoldType.e_faceB,1):(c=e,x=n,T=i,u=r,_=a[0],t.type=W.b2ManifoldType.e_faceA,0),o=yi,h=o,l=T,e=_,n=x,i=u,r=(r=c).m_normals,f=n.m_count,a=n.m_vertices,p=n.m_normals,m=R.MulTRV(i.q,R.MulRV(l.q,r[e],H.s_t0),mi),y=0,g=B,v=0;v<f;++v){var b=H.DotVV(m,p[v]);b<g&&(g=b,y=v)}l=((n=y)+1)%f,r=h[0],O.MulXV(i,a[n],r.v),(r=r.id.cf).indexA=e,r.indexB=n,r.typeA=W.b2ContactFeatureType.e_face,r.typeB=W.b2ContactFeatureType.e_vertex,n=h[1],O.MulXV(i,a[l],n.v),(r=n.id.cf).indexA=e,r.indexB=l,r.typeA=W.b2ContactFeatureType.e_face,r.typeB=W.b2ContactFeatureType.e_vertex;var x=c.m_count,h=c.m_vertices,i=_,a=(_+1)%x,n=h[i],e=h[a],l=H.SubVV(e,n,Ai),r=(l.Normalize(),H.CrossVOne(l,Ci)),_=H.MidVV(n,e,Ti),x=R.MulRV(T.q,l,wi),A=H.CrossVOne(x,Si),h=O.MulXV(T,n,Mi),l=O.MulXV(T,e,Di),C=H.DotVV(A,h),n=-H.DotVV(x,h)+s,T=H.DotVV(x,l)+s,e=gi,S=vi;if(!(Ae(e,o,H.NegV(x,Ei),n,i)<2||Ae(S,e,x,T,a)<2)){t.localNormal.Copy(r),t.localPoint.Copy(_);for(var w=0,E=0;E<2;++E){var M,D=S[E];H.DotVV(A,D.v)-C<=s&&(M=t.points[w],O.MulTXV(u,D.v,M.localPoint),M.id.Copy(D.id),d&&(D=M.id.cf,M.id.cf.indexA=D.indexB,M.id.cf.indexB=D.indexA,M.id.cf.typeA=D.typeB,M.id.cf.typeB=D.typeA),++w)}t.pointCount=w}}}}var Ii=new H,Pi=new H,Ri=new H,Oi=new H,Li=new H,Fi=new H,Vi=new H,Ni=new re;function ki(t,e,i,n,r){t.pointCount=0;var i=O.MulTXV(i,O.MulXV(r,n.m_p,H.s_t0),Ii),r=e.m_vertex1,s=e.m_vertex2,a=H.SubVV(s,r,Pi),o=H.DotVV(a,H.SubVV(s,i,H.s_t0)),l=H.DotVV(a,H.SubVV(i,r,H.s_t0)),h=e.m_radius+n.m_radius,c=Ni;if(c.cf.indexB=0,c.cf.typeB=W.b2ContactFeatureType.e_vertex,l<=0){var u=r,_=H.SubVV(i,u,Ri);if(H.DotVV(_,_)>h*h)return;if(e.m_hasVertex0){var _=e.m_vertex0,d=r,_=H.SubVV(d,_,Oi);if(0<H.DotVV(_,H.SubVV(d,i,H.s_t0)))return}return c.cf.indexA=0,c.cf.typeA=W.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=W.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(u),t.points[0].id.Copy(c),void t.points[0].localPoint.Copy(n.m_p)}if(o<=0){_=s,d=H.SubVV(i,_,Ri);if(H.DotVV(d,d)>h*h)return;if(e.m_hasVertex3){u=e.m_vertex3,d=s,e=H.SubVV(u,d,Li);if(0<H.DotVV(e,H.SubVV(i,d,H.s_t0)))return}return c.cf.indexA=1,c.cf.typeA=W.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=W.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(_),t.points[0].id.Copy(c),void t.points[0].localPoint.Copy(n.m_p)}u=H.DotVV(a,a),e=Fi,e.x=1/u*(o*r.x+l*s.x),e.y=1/u*(o*r.y+l*s.y),d=H.SubVV(i,e,Ri);H.DotVV(d,d)>h*h||(_=Vi.Set(-a.y,a.x),H.DotVV(_,H.SubVV(i,r,H.s_t0))<0&&_.Set(-_.x,-_.y),_.Normalize(),c.cf.indexA=0,c.cf.typeA=W.b2ContactFeatureType.e_face,t.pointCount=1,t.type=W.b2ManifoldType.e_faceA,t.localNormal.Copy(_),t.localPoint.Copy(r),t.points[0].id.Copy(c),t.points[0].localPoint.Copy(n.m_p))}var zi=function(){this.type=0,this.index=0,this.separation=0},Gi=function(){this.vertices=H.MakeArray(8),this.normals=H.MakeArray(8),this.count=0},Ui=function(){this.i1=0,this.i2=0,this.v1=new H,this.v2=new H,this.normal=new H,this.sideNormal1=new H,this.sideOffset1=0,this.sideNormal2=new H,this.sideOffset2=0},ji=(C.prototype.Collide=function(t,e,i,n,r){O.MulTXX(i,r,this.m_xf),O.MulXV(this.m_xf,n.m_centroid,this.m_centroidB),this.m_v0.Copy(e.m_vertex0),this.m_v1.Copy(e.m_vertex1),this.m_v2.Copy(e.m_vertex2),this.m_v3.Copy(e.m_vertex3);var i=e.m_hasVertex0,r=e.m_hasVertex3,s=H.SubVV(this.m_v2,this.m_v1,C.s_edge1),a=(s.Normalize(),this.m_normal1.Set(s.y,-s.x),H.DotVV(this.m_normal1,H.SubVV(this.m_centroidB,this.m_v1,H.s_t0))),o=0,l=0,h=!1,c=!1;i&&((_=H.SubVV(this.m_v1,this.m_v0,C.s_edge0)).Normalize(),this.m_normal0.Set(_.y,-_.x),h=0<=H.CrossVV(_,s),o=H.DotVV(this.m_normal0,H.SubVV(this.m_centroidB,this.m_v0,H.s_t0))),r&&((_=H.SubVV(this.m_v3,this.m_v2,C.s_edge2)).Normalize(),this.m_normal2.Set(_.y,-_.x),c=0<H.CrossVV(s,_),l=H.DotVV(this.m_normal2,H.SubVV(this.m_centroidB,this.m_v2,H.s_t0))),i&&r?h&&c?(this.m_front=0<=o||0<=a||0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):h?(this.m_front=0<=o||0<=a&&0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):c?(this.m_front=0<=l||0<=o&&0<=a,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=0<=o&&0<=a&&0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):i?h?(this.m_front=0<=o||0<=a,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1)),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_front=0<=o&&0<=a,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):r?c?(this.m_front=0<=a||0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=0<=a&&0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg()),this.m_upperLimit.Copy(this.m_normal1)):(this.m_front=0<=a,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=n.m_count;for(var u=0;u<n.m_count;++u)O.MulXV(this.m_xf,n.m_vertices[u],this.m_polygonB.vertices[u]),R.MulRV(this.m_xf.q,n.m_normals[u],this.m_polygonB.normals[u]);this.m_radius=n.m_radius+e.m_radius,t.pointCount=0;s=this.ComputeEdgeSeparation(C.s_edgeAxis);if(0!==s.type&&!(s.separation>this.m_radius)){var _=this.ComputePolygonSeparation(C.s_polygonAxis);if(!(0!==_.type&&_.separation>this.m_radius)){var d,f,p=0!==_.type&&_.separation>.98*s.separation+.001?_:s,i=C.s_ie,m=C.s_rf;if(1===p.type){t.type=W.b2ManifoldType.e_faceA;for(var y=0,g=H.DotVV(this.m_normal,this.m_polygonB.normals[0]),u=1;u<this.m_polygonB.count;++u){var v=H.DotVV(this.m_normal,this.m_polygonB.normals[u]);v<g&&(g=v,y=u)}h=y,o=(h+1)%this.m_polygonB.count;(d=i[0]).v.Copy(this.m_polygonB.vertices[h]),d.id.cf.indexA=0,d.id.cf.indexB=h,d.id.cf.typeA=W.b2ContactFeatureType.e_face,d.id.cf.typeB=W.b2ContactFeatureType.e_vertex,(f=i[1]).v.Copy(this.m_polygonB.vertices[o]),f.id.cf.indexA=0,f.id.cf.indexB=o,f.id.cf.typeA=W.b2ContactFeatureType.e_face,f.id.cf.typeB=W.b2ContactFeatureType.e_vertex,this.m_front?(m.i1=0,m.i2=1,m.v1.Copy(this.m_v1),m.v2.Copy(this.m_v2),m.normal.Copy(this.m_normal1)):(m.i1=1,m.i2=0,m.v1.Copy(this.m_v2),m.v2.Copy(this.m_v1),m.normal.Copy(this.m_normal1).SelfNeg())}else t.type=W.b2ManifoldType.e_faceB,(d=i[0]).v.Copy(this.m_v1),d.id.cf.indexA=0,d.id.cf.indexB=p.index,d.id.cf.typeA=W.b2ContactFeatureType.e_vertex,d.id.cf.typeB=W.b2ContactFeatureType.e_face,(f=i[1]).v.Copy(this.m_v2),f.id.cf.indexA=0,f.id.cf.indexB=p.index,f.id.cf.typeA=W.b2ContactFeatureType.e_vertex,f.id.cf.typeB=W.b2ContactFeatureType.e_face,m.i1=p.index,m.i2=(m.i1+1)%this.m_polygonB.count,m.v1.Copy(this.m_polygonB.vertices[m.i1]),m.v2.Copy(this.m_polygonB.vertices[m.i2]),m.normal.Copy(this.m_polygonB.normals[m.i1]);m.sideNormal1.Set(m.normal.y,-m.normal.x),m.sideNormal2.Copy(m.sideNormal1).SelfNeg(),m.sideOffset1=H.DotVV(m.sideNormal1,m.v1),m.sideOffset2=H.DotVV(m.sideNormal2,m.v2);var r=C.s_clipPoints1,b=C.s_clipPoints2;if(!(Ae(r,i,m.sideNormal1,m.sideOffset1,m.i1)<2||Ae(b,r,m.sideNormal2,m.sideOffset2,m.i2)<2)){1===p.type?(t.localNormal.Copy(m.normal),t.localPoint.Copy(m.v1)):(t.localNormal.Copy(n.m_normals[m.i1]),t.localPoint.Copy(n.m_vertices[m.i1]));var x,A=0;for(u=0;u<2;++u)H.DotVV(m.normal,H.SubVV(b[u].v,m.v1,H.s_t0))<=this.m_radius&&(x=t.points[A],1===p.type?(O.MulTXV(this.m_xf,b[u].v,x.localPoint),x.id=b[u].id):(x.localPoint.Copy(b[u].v),x.id.cf.typeA=b[u].id.cf.typeB,x.id.cf.typeB=b[u].id.cf.typeA,x.id.cf.indexA=b[u].id.cf.indexB,x.id.cf.indexB=b[u].id.cf.indexA),++A);t.pointCount=A}}}},C.prototype.ComputeEdgeSeparation=function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=B;for(var i=0;i<this.m_polygonB.count;++i){var n=H.DotVV(this.m_normal,H.SubVV(this.m_polygonB.vertices[i],this.m_v1,H.s_t0));n<e.separation&&(e.separation=n)}return e},C.prototype.ComputePolygonSeparation=function(t){var e=t;e.type=0,e.index=-1,e.separation=-B;for(var i=C.s_perp.Set(-this.m_normal.y,this.m_normal.x),n=0;n<this.m_polygonB.count;++n){var r=H.NegV(this.m_polygonB.normals[n],C.s_n),s=H.DotVV(r,H.SubVV(this.m_polygonB.vertices[n],this.m_v1,H.s_t0)),a=H.DotVV(r,H.SubVV(this.m_polygonB.vertices[n],this.m_v2,H.s_t0)),s=I(s,a);if(s>this.m_radius)return e.type=2,e.index=n,e.separation=s,e;if(0<=H.DotVV(r,i)){if(H.DotVV(H.SubVV(r,this.m_upperLimit,H.s_t0),this.m_normal)<-N)continue}else if(H.DotVV(H.SubVV(r,this.m_lowerLimit,H.s_t0),this.m_normal)<-N)continue;s>e.separation&&(e.type=2,e.index=n,e.separation=s)}return e},C.s_edge1=new H,C.s_edge0=new H,C.s_edge2=new H,C.s_ie=de.MakeArray(2),C.s_rf=new Ui,C.s_clipPoints1=de.MakeArray(2),C.s_clipPoints2=de.MakeArray(2),C.s_edgeAxis=new zi,C.s_polygonAxis=new zi,C.s_n=new H,C.s_perp=new H,new C);function C(){this.m_polygonB=new Gi,this.m_xf=new O,this.m_centroidB=new H,this.m_v0=new H,this.m_v1=new H,this.m_v2=new H,this.m_v3=new H,this.m_normal0=new H,this.m_normal1=new H,this.m_normal2=new H,this.m_normal=new H,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new H,this.m_upperLimit=new H,this.m_radius=0,this.m_front=!1}function Wi(t,e,i,n,r){ji.Collide(t,e,i,n,r)}var Hi=function(){this.mass=0,this.center=new H(0,0),this.I=0},Xi=((Ui=W.b2ShapeType||(W.b2ShapeType={}))[Ui.e_unknown=-1]="e_unknown",Ui[Ui.e_circleShape=0]="e_circleShape",Ui[Ui.e_edgeShape=1]="e_edgeShape",Ui[Ui.e_polygonShape=2]="e_polygonShape",Ui[Ui.e_chainShape=3]="e_chainShape",Ui[Ui.e_shapeTypeCount=4]="e_shapeTypeCount",qi.prototype.Copy=function(t){return this.m_radius=t.m_radius,this},qi.prototype.GetType=function(){return this.m_type},qi),Yi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};function qi(t,e){this.m_type=W.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=t,this.m_radius=e}function A(t,e){function i(){this.constructor=t}Yi(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}A(l,Qi=Xi),l.prototype.Set=function(t,e){return void 0===e&&(e=this.m_radius),this.m_p.Copy(t),this.m_radius=e,this},l.prototype.Clone=function(){return(new l).Copy(this)},l.prototype.Copy=function(t){return Qi.prototype.Copy.call(this,t),this.m_p.Copy(t.m_p),this},l.prototype.GetChildCount=function(){return 1},l.prototype.TestPoint=function(t,e){t=O.MulXV(t,this.m_p,l.TestPoint_s_center),e=H.SubVV(e,t,l.TestPoint_s_d);return H.DotVV(e,e)<=Z(this.m_radius)},l.prototype.ComputeDistance=function(t,e,i,n){t=O.MulXV(t,this.m_p,l.ComputeDistance_s_center);return H.SubVV(e,t,i),i.Normalize()-this.m_radius},l.prototype.RayCast=function(t,e,i,n){var i=O.MulXV(i,this.m_p,l.RayCast_s_position),i=H.SubVV(e.p1,i,l.RayCast_s_s),r=H.DotVV(i,i)-Z(this.m_radius),s=H.SubVV(e.p2,e.p1,l.RayCast_s_r),a=H.DotVV(i,s),o=H.DotVV(s,s),r=a*a-o*r;if(r<0||o<F)return!1;a=-(a+Q(r));return 0<=a&&a<=e.maxFraction*o&&(t.fraction=a/=o,H.AddVMulSV(i,a,s,t.normal).SelfNormalize(),!0)},l.prototype.ComputeAABB=function(t,e,i){e=O.MulXV(e,this.m_p,l.ComputeAABB_s_p);t.lowerBound.Set(e.x-this.m_radius,e.y-this.m_radius),t.upperBound.Set(e.x+this.m_radius,e.y+this.m_radius)},l.prototype.ComputeMass=function(t,e){var i=Z(this.m_radius);t.mass=e*x*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+H.DotVV(this.m_p,this.m_p))},l.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius},l.prototype.ComputeSubmergedArea=function(t,e,i,n){i=O.MulXV(i,this.m_p,new H),e=-(H.DotVV(t,i)-e);if(e<-this.m_radius+F)return 0;if(e>this.m_radius)return n.Copy(i),x*this.m_radius*this.m_radius;var r=this.m_radius*this.m_radius,s=e*e,e=r*(nt(e/this.m_radius)+x/2)+e*Q(r-s),r=-2/3*$(r-s,1.5)/e;return n.x=i.x+t.x*r,n.y=i.y+t.y*r,e},l.prototype.Dump=function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},l.TestPoint_s_center=new H,l.TestPoint_s_d=new H,l.ComputeDistance_s_center=new H,l.RayCast_s_position=new H,l.RayCast_s_s=new H,l.RayCast_s_r=new H,l.ComputeAABB_s_p=new H;var Ji,Zi,Ki,Qi,zi=l,Ui=(A(T,Ki=Xi),T.prototype.Clone=function(){return(new T).Copy(this)},T.prototype.Copy=function(t){Ki.prototype.Copy.call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=H.MakeArray(this.m_count),this.m_normals=H.MakeArray(this.m_count);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this},T.prototype.GetChildCount=function(){return 1},T.prototype.Set=function(t,e,i){if(void 0===i&&(i=0),(e=void 0===e?t.length:e)<3)return this.SetAsBox(1,1);for(var n=I(e,8),r=T.Set_s_ps,s=0,a=0;a<n;++a){for(var o=t[i+a],l=!0,h=0;h<s;++h)if(H.DistanceSquaredVV(o,r[h])<16e-6){l=!1;break}l&&r[s++].Copy(o)}if((n=s)<3)return this.SetAsBox(1,1);for(var c=0,u=r[0].x,a=1;a<n;++a){var _=r[a].x;(u<_||_===u&&r[a].y<r[c].y)&&(c=a,u=_)}for(var d=T.Set_s_hull,f=0,p=c;;){d[f]=p;for(var m,y,g=0,h=1;h<n;++h)g!==p?(m=H.SubVV(r[g],r[d[f]],T.Set_s_r),o=H.SubVV(r[h],r[d[f]],T.Set_s_v),(y=H.CrossVV(m,o))<0&&(g=h),0===y&&o.LengthSquared()>m.LengthSquared()&&(g=h)):g=h;if(++f,(p=g)===c)break}for(this.m_count=f,this.m_vertices=H.MakeArray(this.m_count),this.m_normals=H.MakeArray(this.m_count),a=0;a<f;++a)this.m_vertices[a].Copy(r[d[a]]);for(a=0;a<f;++a){var v=this.m_vertices[a],b=this.m_vertices[(a+1)%f],b=H.SubVV(b,v,H.s_t0);H.CrossVOne(b,this.m_normals[a]).SelfNormalize()}return T.ComputeCentroid(this.m_vertices,f,this.m_centroid),this},T.prototype.SetAsArray=function(t,e){return void 0===e&&(e=t.length),this.Set(t,e)},T.prototype.SetAsBox=function(t,e,i,n){if(void 0===n&&(n=0),this.m_count=4,this.m_vertices=H.MakeArray(this.m_count),this.m_normals=H.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var r=new O;r.SetPosition(i),r.SetRotationAngle(n);for(var s=0;s<this.m_count;++s)O.MulXV(r,this.m_vertices[s],this.m_vertices[s]),R.MulRV(r.q,this.m_normals[s],this.m_normals[s])}return this},T.prototype.TestPoint=function(t,e){for(var i=O.MulTXV(t,e,T.TestPoint_s_pLocal),n=0;n<this.m_count;++n)if(0<H.DotVV(this.m_normals[n],H.SubVV(i,this.m_vertices[n],H.s_t0)))return!1;return!0},T.prototype.ComputeDistance=function(t,e,i,n){for(var r=O.MulTXV(t,e,T.ComputeDistance_s_pLocal),s=-B,a=T.ComputeDistance_s_normalForMaxDistance.Copy(r),o=0;o<this.m_count;++o){var l=H.DotVV(this.m_normals[o],H.SubVV(r,this.m_vertices[o],H.s_t0));s<l&&(s=l,a.Copy(this.m_normals[o]))}if(0<s){for(var h=T.ComputeDistance_s_minDistance.Copy(a),c=s*s,o=0;o<this.m_count;++o){var u=H.SubVV(r,this.m_vertices[o],T.ComputeDistance_s_distance),_=u.LengthSquared();_<c&&(h.Copy(u),c=_)}return R.MulRV(t.q,h,i),i.Normalize(),Math.sqrt(c)}return R.MulRV(t.q,a,i),s},T.prototype.RayCast=function(t,e,i,n){for(var r=O.MulTXV(i,e.p1,T.RayCast_s_p1),s=O.MulTXV(i,e.p2,T.RayCast_s_p2),a=H.SubVV(s,r,T.RayCast_s_d),o=0,l=e.maxFraction,h=-1,c=0;c<this.m_count;++c){var u=H.DotVV(this.m_normals[c],H.SubVV(this.m_vertices[c],r,H.s_t0)),_=H.DotVV(this.m_normals[c],a);if(0===_){if(u<0)return!1}else _<0&&u<o*_?(o=u/_,h=c):0<_&&u<l*_&&(l=u/_);if(l<o)return!1}return 0<=h&&(t.fraction=o,R.MulRV(i.q,this.m_normals[h],t.normal),!0)},T.prototype.ComputeAABB=function(t,e,i){for(var n=O.MulXV(e,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(n),s=0;s<this.m_count;++s){var a=O.MulXV(e,this.m_vertices[s],T.ComputeAABB_s_v);H.MinV(a,n,n),H.MaxV(a,r,r)}t=this.m_radius;n.SelfSubXY(t,t),r.SelfAddXY(t,t)},T.prototype.ComputeMass=function(t,e){for(var i=T.ComputeMass_s_center.SetZero(),n=0,r=0,s=T.ComputeMass_s_s.SetZero(),a=0;a<this.m_count;++a)s.SelfAdd(this.m_vertices[a]);for(s.SelfMul(1/this.m_count),a=0;a<this.m_count;++a){var o=H.SubVV(this.m_vertices[a],s,T.ComputeMass_s_e1),l=H.SubVV(this.m_vertices[(a+1)%this.m_count],s,T.ComputeMass_s_e2),h=H.CrossVV(o,l),c=.5*h,c=(n+=c,i.SelfAdd(H.MulSV(1/3*c,H.AddVV(o,l,H.s_t0),H.s_t1)),o.x),o=o.y,u=l.x,l=l.y;r+=1/3*.25*h*(c*c+u*c+u*u+(o*o+l*o+l*l))}t.mass=e*n,i.SelfMul(1/n),H.AddVV(i,s,t.center),t.I=e*r,t.I+=t.mass*(H.DotVV(t.center,t.center)-H.DotVV(i,i))},T.prototype.Validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=(t+1)%this.m_count,n=this.m_vertices[e],r=H.SubVV(this.m_vertices[i],n,T.Validate_s_e),s=0;s<this.m_count;++s)if(s!==e&&s!==i){var a=H.SubVV(this.m_vertices[s],n,T.Validate_s_v);if(H.CrossVV(r,a)<0)return!1}return!0},T.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},T.prototype.ComputeSubmergedArea=function(t,e,i,n){for(var r,s=R.MulTRV(i.q,t,T.ComputeSubmergedArea_s_normalL),a=e-H.DotVV(t,i.p),o=T.ComputeSubmergedArea_s_depths,l=0,h=-1,c=-1,u=!1,_=0;_<this.m_count;++_){o[_]=H.DotVV(s,this.m_vertices[_])-a;var d=o[_]<-F;0<_&&(d?u||(h=_-1,l++):u&&(c=_-1,l++)),u=d}switch(l){case 0:return u?(this.ComputeMass(r=T.ComputeSubmergedArea_s_md,1),O.MulXV(i,r.center,n),r.mass):0;case 1:-1===h?h=this.m_count-1:c=this.m_count-1}for(var e=(h+1)%this.m_count,f=(c+1)%this.m_count,t=(0-o[h])/(o[e]-o[h]),p=(0-o[c])/(o[f]-o[c]),m=T.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[h].x*(1-t)+this.m_vertices[e].x*t,this.m_vertices[h].y*(1-t)+this.m_vertices[e].y*t),y=T.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[c].x*(1-p)+this.m_vertices[f].x*p,this.m_vertices[c].y*(1-p)+this.m_vertices[f].y*p),g=0,v=T.ComputeSubmergedArea_s_center.SetZero(),b=this.m_vertices[e],x=e;x!==f;){var A=(x=(x+1)%this.m_count)==f?y:this.m_vertices[x],C=.5*((b.x-m.x)*(A.y-m.y)-(b.y-m.y)*(A.x-m.x));g+=C,v.x+=C*(m.x+b.x+A.x)/3,v.y+=C*(m.y+b.y+A.y)/3,b=A}return v.SelfMul(1/g),O.MulXV(i,v,n),g},T.prototype.Dump=function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",8);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)},T.ComputeCentroid=function(t,e,i){var n=i;n.SetZero();for(var r=0,s=T.ComputeCentroid_s_pRef.SetZero(),a=0;a<e;++a){var o=s,l=t[a],h=t[(a+1)%e],c=H.SubVV(l,o,T.ComputeCentroid_s_e1),u=H.SubVV(h,o,T.ComputeCentroid_s_e2),c=.5*H.CrossVV(c,u);r+=c,n.x+=1/3*c*(o.x+l.x+h.x),n.y+=1/3*c*(o.y+l.y+h.y)}return n.SelfMul(1/r),n},T.Set_s_ps=H.MakeArray(8),T.Set_s_hull=U(8),T.Set_s_r=new H,T.Set_s_v=new H,T.TestPoint_s_pLocal=new H,T.ComputeDistance_s_pLocal=new H,T.ComputeDistance_s_normalForMaxDistance=new H,T.ComputeDistance_s_minDistance=new H,T.ComputeDistance_s_distance=new H,T.RayCast_s_p1=new H,T.RayCast_s_p2=new H,T.RayCast_s_d=new H,T.ComputeAABB_s_v=new H,T.ComputeMass_s_center=new H,T.ComputeMass_s_s=new H,T.ComputeMass_s_e1=new H,T.ComputeMass_s_e2=new H,T.Validate_s_e=new H,T.Validate_s_v=new H,T.ComputeSubmergedArea_s_normalL=new H,T.ComputeSubmergedArea_s_depths=U(8),T.ComputeSubmergedArea_s_md=new Hi,T.ComputeSubmergedArea_s_intoVec=new H,T.ComputeSubmergedArea_s_outoVec=new H,T.ComputeSubmergedArea_s_center=new H,T.ComputeCentroid_s_pRef=new H,T.ComputeCentroid_s_e1=new H,T.ComputeCentroid_s_e2=new H,T),$i=(A(c,Zi=Xi),c.prototype.Set=function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},c.prototype.Clone=function(){return(new c).Copy(this)},c.prototype.Copy=function(t){return Zi.prototype.Copy.call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this},c.prototype.GetChildCount=function(){return 1},c.prototype.TestPoint=function(t,e){return!1},c.prototype.ComputeDistance=function(t,e,i,n){var r,s=O.MulXV(t,this.m_vertex1,c.ComputeDistance_s_v1),t=O.MulXV(t,this.m_vertex2,c.ComputeDistance_s_v2),a=H.SubVV(e,s,c.ComputeDistance_s_d),s=H.SubVV(t,s,c.ComputeDistance_s_s),o=H.DotVV(a,s);return 0<o&&((r=H.DotVV(s,s))<o?H.SubVV(e,t,a):a.SelfMulSub(o/r,s)),i.Copy(a),i.Normalize()},c.prototype.RayCast=function(t,e,i,n){var r=O.MulTXV(i,e.p1,c.RayCast_s_p1),s=O.MulTXV(i,e.p2,c.RayCast_s_p2),s=H.SubVV(s,r,c.RayCast_s_d),a=this.m_vertex1,o=this.m_vertex2,l=H.SubVV(o,a,c.RayCast_s_e),l=t.normal.Set(l.y,-l.x).SelfNormalize(),h=H.DotVV(l,H.SubVV(a,r,H.s_t0)),l=H.DotVV(l,s);if(0===l)return!1;l=h/l;if(l<0||e.maxFraction<l)return!1;e=H.AddVMulSV(r,l,s,c.RayCast_s_q),r=H.SubVV(o,a,c.RayCast_s_r),s=H.DotVV(r,r);if(0===s)return!1;o=H.DotVV(H.SubVV(e,a,H.s_t0),r)/s;return!(o<0||1<o||(t.fraction=l,R.MulRV(i.q,t.normal,t.normal),0<h&&t.normal.SelfNeg(),0))},c.prototype.ComputeAABB=function(t,e,i){var n=O.MulXV(e,this.m_vertex1,c.ComputeAABB_s_v1),e=O.MulXV(e,this.m_vertex2,c.ComputeAABB_s_v2),n=(H.MinV(n,e,t.lowerBound),H.MaxV(n,e,t.upperBound),this.m_radius);t.lowerBound.SelfSubXY(n,n),t.upperBound.SelfAddXY(n,n)},c.prototype.ComputeMass=function(t,e){t.mass=0,H.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0},c.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius},c.prototype.ComputeSubmergedArea=function(t,e,i,n){return n.SetZero(),0},c.prototype.Dump=function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},c.ComputeDistance_s_v1=new H,c.ComputeDistance_s_v2=new H,c.ComputeDistance_s_d=new H,c.ComputeDistance_s_s=new H,c.RayCast_s_p1=new H,c.RayCast_s_p2=new H,c.RayCast_s_d=new H,c.RayCast_s_e=new H,c.RayCast_s_q=new H,c.RayCast_s_r=new H,c.ComputeAABB_s_v1=new H,c.ComputeAABB_s_v2=new H,c),tn=(A(s,Ji=Xi),s.prototype.CreateLoop=function(t,e,i){if(void 0===i&&(i=0),(e=void 0===e?t.length:e)<3)return this;this.m_count=e+1,this.m_vertices=H.MakeArray(this.m_count);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t[i+n]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},s.prototype.CreateChain=function(t,e,i){void 0===e&&(e=t.length),void 0===i&&(i=0),this.m_count=e,this.m_vertices=H.MakeArray(e);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t[i+n]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},s.prototype.SetPrevVertex=function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this},s.prototype.SetNextVertex=function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this},s.prototype.Clone=function(){return(new s).Copy(this)},s.prototype.Copy=function(t){return Ji.prototype.Copy.call(this,t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this},s.prototype.GetChildCount=function(){return this.m_count-1},s.prototype.GetChildEdge=function(t,e){t.m_type=W.b2ShapeType.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),0<e?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)},s.prototype.TestPoint=function(t,e){return!1},s.prototype.ComputeDistance=function(t,e,i,n){var r=s.ComputeDistance_s_edgeShape;return this.GetChildEdge(r,n),r.ComputeDistance(t,e,i,0)},s.prototype.RayCast=function(t,e,i,n){var r=s.RayCast_s_edgeShape;return r.m_vertex1.Copy(this.m_vertices[n]),r.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),r.RayCast(t,e,i,0)},s.prototype.ComputeAABB=function(t,e,i){var n=this.m_vertices[i],i=this.m_vertices[(i+1)%this.m_count],n=O.MulXV(e,n,s.ComputeAABB_s_v1),e=O.MulXV(e,i,s.ComputeAABB_s_v2);H.MinV(n,e,t.lowerBound),H.MaxV(n,e,t.upperBound)},s.prototype.ComputeMass=function(t,e){t.mass=0,t.center.SetZero(),t.I=0},s.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius},s.prototype.ComputeSubmergedArea=function(t,e,i,n){return n.SetZero(),0},s.prototype.Dump=function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",8);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},s.ComputeDistance_s_edgeShape=new $i,s.RayCast_s_edgeShape=new $i,s.ComputeAABB_s_v1=new H,s.ComputeAABB_s_v2=new H,s),en=(an.prototype.Clone=function(){return(new an).Copy(this)},an.prototype.Copy=function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this},an.DEFAULT=new an,an),nn=function(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new en},rn=function(t){this.aabb=new me,this.childIndex=0,this.fixture=t},sn=(o.prototype.GetType=function(){return this.m_shape.GetType()},o.prototype.GetShape=function(){return this.m_shape},o.prototype.SetSensor=function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},o.prototype.IsSensor=function(){return this.m_isSensor},o.prototype.SetFilterData=function(t){this.m_filter.Copy(t),this.Refilter()},o.prototype.GetFilterData=function(){return this.m_filter},o.prototype.Refilter=function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!==this&&n!==this||e.FlagForFiltering(),t=t.next}var r=this.m_body.GetWorld();if(null!==r)for(var s=r.m_contactManager.m_broadPhase,a=0;a<this.m_proxyCount;++a)s.TouchProxy(this.m_proxies[a].treeNode)},o.prototype.GetBody=function(){return this.m_body},o.prototype.GetNext=function(){return this.m_next},o.prototype.GetUserData=function(){return this.m_userData},o.prototype.SetUserData=function(t){this.m_userData=t},o.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},o.prototype.ComputeDistance=function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)},o.prototype.RayCast=function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)},o.prototype.GetMassData=function(t){return void 0===t&&(t=new Hi),this.m_shape.ComputeMass(t,this.m_density),t},o.prototype.SetDensity=function(t){this.m_density=t},o.prototype.GetDensity=function(){return this.m_density},o.prototype.GetFriction=function(){return this.m_friction},o.prototype.SetFriction=function(t){this.m_friction=t},o.prototype.GetRestitution=function(){return this.m_restitution},o.prototype.SetRestitution=function(t){this.m_restitution=t},o.prototype.GetAABB=function(t){return this.m_proxies[t].aabb},o.prototype.Dump=function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)},o.prototype.Create=function(t){var e=this;this.m_userData=t.userData,this.m_friction=f(t.friction,.2),this.m_restitution=f(t.restitution,0),this.m_next=null,this.m_filter.Copy(f(t.filter,en.DEFAULT)),this.m_isSensor=f(t.isSensor,!1),this.m_proxies=G(this.m_shape.GetChildCount(),function(t){return new rn(e)}),this.m_proxyCount=0,this.m_density=f(t.density,0)},o.prototype.Destroy=function(){},o.prototype.CreateProxies=function(t){var e=this.m_body.m_world.m_contactManager.m_broadPhase;this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i]=new rn(this);this.m_shape.ComputeAABB(n.aabb,t,i),n.treeNode=e.CreateProxy(n.aabb,n),n.childIndex=i}},o.prototype.DestroyProxies=function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];delete i.treeNode.userData,t.DestroyProxy(i.treeNode),delete i.treeNode}this.m_proxyCount=0},o.prototype.TouchProxies=function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=this.m_proxyCount,i=0;i<e;++i)t.TouchProxy(this.m_proxies[i].treeNode)},o.prototype.Synchronize=function(t,e){if(0!==this.m_proxyCount)for(var i=this.m_body.m_world.m_contactManager.m_broadPhase,n=0;n<this.m_proxyCount;++n){var r=this.m_proxies[n],s=o.Synchronize_s_aabb1,a=o.Synchronize_s_aabb2,s=(this.m_shape.ComputeAABB(s,t,n),this.m_shape.ComputeAABB(a,e,n),r.aabb.Combine2(s,a),H.SubVV(e.p,t.p,o.Synchronize_s_displacement));i.MoveProxy(r.treeNode,r.aabb,s)}},o.Synchronize_s_aabb1=new me,o.Synchronize_s_aabb2=new me,o.Synchronize_s_displacement=new H,o);function o(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_proxyCount=0,this.m_filter=new en,this.m_isSensor=!1,this.m_userData=null,this.m_body=e,this.m_shape=t.shape.Clone()}function an(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}function s(){var t=Ji.call(this,W.b2ShapeType.e_chainShape,.016)||this;return t.m_vertices=[],t.m_count=0,t.m_prevVertex=new H,t.m_nextVertex=new H,t.m_hasPrevVertex=!1,t.m_hasNextVertex=!1,t}function c(){var t=Zi.call(this,W.b2ShapeType.e_edgeShape,.016)||this;return t.m_vertex1=new H,t.m_vertex2=new H,t.m_vertex0=new H,t.m_vertex3=new H,t.m_hasVertex0=!1,t.m_hasVertex3=!1,t}function T(){var t=Ki.call(this,W.b2ShapeType.e_polygonShape,.016)||this;return t.m_centroid=new H(0,0),t.m_vertices=[],t.m_normals=[],t.m_count=0,t}function l(t){t=Qi.call(this,W.b2ShapeType.e_circleShape,t=void 0===t?0:t)||this;return t.m_p=new H,t}(t=W.b2BodyType||(W.b2BodyType={}))[t.b2_unknown=-1]="b2_unknown",t[t.b2_staticBody=0]="b2_staticBody",t[t.b2_kinematicBody=1]="b2_kinematicBody",t[t.b2_dynamicBody=2]="b2_dynamicBody";function on(){this.type=W.b2BodyType.b2_staticBody,this.position=new H(0,0),this.angle=0,this.linearVelocity=new H(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1}a.prototype.CreateFixture=function(t,e){return void 0===e&&(e=0),t instanceof Xi?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)},a.prototype.CreateFixtureDef=function(t){if(this.m_world.IsLocked())throw new Error;var e=new sn(t,this);return e.Create(t),this.m_activeFlag&&e.CreateProxies(this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,0<e.m_density&&this.ResetMassData(),this.m_world.m_newFixture=!0,e},a.prototype.CreateFixtureShapeDensity=function(t,e){void 0===e&&(e=0);var i=a.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=e,this.CreateFixtureDef(i)},a.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}e=(i=e).m_next}for(var n=this.m_contactList;n;){var r=n.contact,n=n.next,s=r.GetFixtureA(),a=r.GetFixtureB();t!==s&&t!==a||this.m_world.m_contactManager.Destroy(r)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Destroy(),--this.m_fixtureCount,this.ResetMassData()},a.prototype.SetTransformVec=function(t,e){this.SetTransformXY(t.x,t.y,e)},a.prototype.SetTransformXY=function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),O.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},a.prototype.SetTransform=function(t){this.SetTransformVec(t.p,t.GetAngle())},a.prototype.GetTransform=function(){return this.m_xf},a.prototype.GetPosition=function(){return this.m_xf.p},a.prototype.SetPosition=function(t){this.SetTransformVec(t,this.GetAngle())},a.prototype.SetPositionXY=function(t,e){this.SetTransformXY(t,e,this.GetAngle())},a.prototype.GetAngle=function(){return this.m_sweep.a},a.prototype.SetAngle=function(t){this.SetTransformVec(this.GetPosition(),t)},a.prototype.GetWorldCenter=function(){return this.m_sweep.c},a.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},a.prototype.SetLinearVelocity=function(t){this.m_type!==W.b2BodyType.b2_staticBody&&(0<H.DotVV(t,t)&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))},a.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},a.prototype.SetAngularVelocity=function(t){this.m_type!==W.b2BodyType.b2_staticBody&&(0<t*t&&this.SetAwake(!0),this.m_angularVelocity=t)},a.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},a.prototype.GetDefinition=function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t},a.prototype.ApplyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type===W.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},a.prototype.ApplyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type===W.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))},a.prototype.ApplyTorque=function(t,e){void 0===e&&(e=!0),this.m_type===W.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},a.prototype.ApplyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type===W.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))},a.prototype.ApplyLinearImpulseToCenter=function(t,e){void 0===e&&(e=!0),this.m_type===W.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))},a.prototype.ApplyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type===W.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},a.prototype.GetMass=function(){return this.m_mass},a.prototype.GetInertia=function(){return this.m_I+this.m_mass*H.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},a.prototype.GetMassData=function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*H.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t},a.prototype.SetMassData=function(t){if(this.m_world.IsLocked())throw new Error;var e;this.m_type===W.b2BodyType.b2_dynamicBody&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<t.I&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*H.DotVV(t.center,t.center),this.m_invI=1/this.m_I),e=a.SetMassData_s_oldCenter.Copy(this.m_sweep.c),this.m_sweep.localCenter.Copy(t.center),O.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),H.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,H.SubVV(this.m_sweep.c,e,H.s_t0),this.m_linearVelocity))},a.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===W.b2BodyType.b2_staticBody||this.m_type===W.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var t,e=a.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)0!==i.m_density&&(t=i.GetMassData(a.ResetMassData_s_massData),this.m_mass+=t.mass,e.x+=t.center.x*t.mass,e.y+=t.center.y*t.mass,this.m_I+=t.I);0<this.m_mass?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*H.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=a.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),O.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),H.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,H.SubVV(this.m_sweep.c,n,H.s_t0),this.m_linearVelocity)},a.prototype.GetWorldPoint=function(t,e){return O.MulXV(this.m_xf,t,e)},a.prototype.GetWorldVector=function(t,e){return R.MulRV(this.m_xf.q,t,e)},a.prototype.GetLocalPoint=function(t,e){return O.MulTXV(this.m_xf,t,e)},a.prototype.GetLocalVector=function(t,e){return R.MulTRV(this.m_xf.q,t,e)},a.prototype.GetLinearVelocityFromWorldPoint=function(t,e){return H.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,H.SubVV(t,this.m_sweep.c,H.s_t0),e)},a.prototype.GetLinearVelocityFromLocalPoint=function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)},a.prototype.GetLinearDamping=function(){return this.m_linearDamping},a.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},a.prototype.GetAngularDamping=function(){return this.m_angularDamping},a.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},a.prototype.GetGravityScale=function(){return this.m_gravityScale},a.prototype.SetGravityScale=function(t){this.m_gravityScale=t},a.prototype.SetType=function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t){this.m_type=t,this.ResetMassData(),this.m_type===W.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e,e=e.next;this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var n=this.m_fixtureList;n;n=n.m_next)n.TouchProxies()}},a.prototype.GetType=function(){return this.m_type},a.prototype.SetBullet=function(t){this.m_bulletFlag=t},a.prototype.IsBullet=function(){return this.m_bulletFlag},a.prototype.SetSleepingAllowed=function(t){(this.m_autoSleepFlag=t)||this.SetAwake(!0)},a.prototype.IsSleepingAllowed=function(){return this.m_autoSleepFlag},a.prototype.SetAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},a.prototype.IsAwake=function(){return this.m_awakeFlag},a.prototype.SetActive=function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(this.m_xf);else{for(e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxies();for(var i=this.m_contactList;i;){var n=i,i=i.next;this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}},a.prototype.IsActive=function(){return this.m_activeFlag},a.prototype.SetFixedRotation=function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())},a.prototype.IsFixedRotation=function(){return this.m_fixedRotationFlag},a.prototype.GetFixtureList=function(){return this.m_fixtureList},a.prototype.GetJointList=function(){return this.m_jointList},a.prototype.GetContactList=function(){return this.m_contactList},a.prototype.GetNext=function(){return this.m_next},a.prototype.GetUserData=function(){return this.m_userData},a.prototype.SetUserData=function(t){this.m_userData=t},a.prototype.GetWorld=function(){return this.m_world},a.prototype.Dump=function(t){var e=this.m_islandIndex,i=(t("{\n"),t("  const bd: b2BodyDef = new b2BodyDef();\n"),"");switch(this.m_type){case W.b2BodyType.b2_staticBody:i="b2BodyType.b2_staticBody";break;case W.b2BodyType.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case W.b2BodyType.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(var n=this.m_fixtureList;n;n=n.m_next)t("  {\n"),n.Dump(t,e),t("  }\n");t("}\n")},a.prototype.SynchronizeFixtures=function(){var t=a.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),R.MulRV(t.q,this.m_sweep.localCenter,t.p),H.SubVV(this.m_sweep.c0,t.p,t.p);for(var e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf)},a.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngle(this.m_sweep.a),R.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),H.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},a.prototype.ShouldCollide=function(t){return(this.m_type!==W.b2BodyType.b2_staticBody||t.m_type!==W.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(t)},a.prototype.ShouldCollideConnected=function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0},a.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),R.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),H.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},a.prototype.GetControllerList=function(){return this.m_controllerList},a.prototype.GetControllerCount=function(){return this.m_controllerCount},a.CreateFixtureShapeDensity_s_def=new nn,a.SetMassData_s_oldCenter=new H,a.ResetMassData_s_localCenter=new H,a.ResetMassData_s_oldCenter=new H,a.ResetMassData_s_massData=new Hi,a.SynchronizeFixtures_s_xf1=new O;var ln=a;function a(t,e){this.m_type=W.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new O,this.m_xf0=new O,this.m_sweep=new ht,this.m_linearVelocity=new H,this.m_angularVelocity=0,this.m_force=new H,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=f(t.bullet,!1),this.m_fixedRotationFlag=f(t.fixedRotation,!1),this.m_autoSleepFlag=f(t.allowSleep,!0),this.m_awakeFlag=f(t.awake,!0),this.m_activeFlag=f(t.active,!0),this.m_world=e,this.m_xf.p.Copy(f(t.position,H.ZERO)),this.m_xf.q.SetAngle(f(t.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(f(t.linearVelocity,H.ZERO)),this.m_angularVelocity=f(t.angularVelocity,0),this.m_linearDamping=f(t.linearDamping,0),this.m_angularDamping=f(t.angularDamping,0),this.m_gravityScale=f(t.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=f(t.type,W.b2BodyType.b2_staticBody),t.type===W.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}(t=W.b2JointType||(W.b2JointType={}))[t.e_unknownJoint=0]="e_unknownJoint",t[t.e_revoluteJoint=1]="e_revoluteJoint",t[t.e_prismaticJoint=2]="e_prismaticJoint",t[t.e_distanceJoint=3]="e_distanceJoint",t[t.e_pulleyJoint=4]="e_pulleyJoint",t[t.e_mouseJoint=5]="e_mouseJoint",t[t.e_gearJoint=6]="e_gearJoint",t[t.e_wheelJoint=7]="e_wheelJoint",t[t.e_weldJoint=8]="e_weldJoint",t[t.e_frictionJoint=9]="e_frictionJoint",t[t.e_ropeJoint=10]="e_ropeJoint",t[t.e_motorJoint=11]="e_motorJoint",t[t.e_areaJoint=12]="e_areaJoint",(t=W.b2LimitState||(W.b2LimitState={}))[t.e_inactiveLimit=0]="e_inactiveLimit",t[t.e_atLowerLimit=1]="e_atLowerLimit",t[t.e_atUpperLimit=2]="e_atUpperLimit",t[t.e_equalLimits=3]="e_equalLimits";function hn(t){this.type=W.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=t}Tr.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},Tr.prototype.Set=function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this};var cn,un,_n,dn,fn,pn,mn,yn,gn,vn,bn,xn,An,Cn,Tn,Sn,wn,En,Mn,Dn,Bn,In,Pn,Rn,t=Tr,On=function(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e},Ln=(Cr.prototype.GetType=function(){return this.m_type},Cr.prototype.GetBodyA=function(){return this.m_bodyA},Cr.prototype.GetBodyB=function(){return this.m_bodyB},Cr.prototype.GetNext=function(){return this.m_next},Cr.prototype.GetUserData=function(){return this.m_userData},Cr.prototype.SetUserData=function(t){this.m_userData=t},Cr.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Cr.prototype.GetCollideConnected=function(){return this.m_collideConnected},Cr.prototype.Dump=function(t){t("// Dump is not supported for this joint type.\n")},Cr.prototype.ShiftOrigin=function(t){},Cr),Fn=(A(Ar,Rn=hn),Ar.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.length=H.DistanceVV(i,n),this.frequencyHz=0,this.dampingRatio=0},Ar),Vn=(A(u,Pn=Ln),u.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},u.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},u.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e},u.prototype.GetReactionTorque=function(t){return 0},u.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},u.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},u.prototype.SetLength=function(t){this.m_length=t},u.prototype.Length=function(){return this.m_length},u.prototype.SetFrequency=function(t){this.m_frequencyHz=t},u.prototype.GetFrequency=function(){return this.m_frequencyHz},u.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},u.prototype.GetDampingRatio=function(){return this.m_dampingRatio},u.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},u.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e,i=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,h=t.velocities[this.m_indexB].w,n=this.m_qA.SetAngle(n),o=this.m_qB.SetAngle(o),n=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(n,this.m_lalcA,this.m_rA),H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(o,this.m_lalcB,this.m_rB),this.m_u.x=a.x+this.m_rB.x-i.x-this.m_rA.x,this.m_u.y=a.y+this.m_rB.y-i.y-this.m_rA.y,this.m_u.Length()),o=(V<n?this.m_u.SelfMul(1/n):this.m_u.SetZero(),H.CrossVV(this.m_rA,this.m_u)),a=H.CrossVV(this.m_rB,this.m_u),i=this.m_invMassA+this.m_invIA*o*o+this.m_invMassB+this.m_invIB*a*a;this.m_mass=0!==i?1/i:0,0<this.m_frequencyHz?(o=n-this.m_length,a=2*x*this.m_frequencyHz,n=2*this.m_mass*this.m_dampingRatio*a,a=this.m_mass*a*a,e=t.step.dt,this.m_gamma=e*(n+e*a),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=o*e*a*this.m_gamma,i+=this.m_gamma,this.m_mass=0!==i?1/i:0):(this.m_gamma=0,this.m_bias=0),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,n=H.MulSV(this.m_impulse,this.m_u,u.InitVelocityConstraints_s_P),r.SelfMulSub(this.m_invMassA,n),s-=this.m_invIA*H.CrossVV(this.m_rA,n),l.SelfMulAdd(this.m_invMassB,n),h+=this.m_invIB*H.CrossVV(this.m_rB,n)):this.m_impulse=0,t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=h},u.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=H.AddVCrossSV(e,i,this.m_rA,u.SolveVelocityConstraints_s_vpA),a=H.AddVCrossSV(n,r,this.m_rB,u.SolveVelocityConstraints_s_vpB),a=H.DotVV(this.m_u,H.SubVV(a,s,H.s_t0)),s=-this.m_mass*(a+this.m_bias+this.m_gamma*this.m_impulse),a=(this.m_impulse+=s,H.MulSV(s,this.m_u,u.SolveVelocityConstraints_s_P));e.SelfMulSub(this.m_invMassA,a),i-=this.m_invIA*H.CrossVV(this.m_rA,a),n.SelfMulAdd(this.m_invMassB,a),r+=this.m_invIB*H.CrossVV(this.m_rB,a),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},u.prototype.SolvePositionConstraints=function(t){if(0<this.m_frequencyHz)return!0;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),s=R.MulRV(s,this.m_lalcA,this.m_rA),a=R.MulRV(a,this.m_lalcB,this.m_rB),o=this.m_u;o.x=n.x+a.x-e.x-s.x,o.y=n.y+a.y-e.y-s.y;var l=q(this.m_u.Normalize()-this.m_length,-.2,.2),h=-this.m_mass*l,h=H.MulSV(h,o,u.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,h),i-=this.m_invIA*H.CrossVV(s,h),n.SelfMulAdd(this.m_invMassB,h),r+=this.m_invIB*H.CrossVV(a,h),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,D(l)<V},u.InitVelocityConstraints_s_P=new H,u.SolveVelocityConstraints_s_vpA=new H,u.SolveVelocityConstraints_s_vpB=new H,u.SolveVelocityConstraints_s_P=new H,u.SolvePositionConstraints_s_P=new H,u),Nn=(A(xr,In=hn),xr.prototype.AddBody=function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)},xr),kn=(A(br,Bn=Ln),br.prototype.GetAnchorA=function(t){return t},br.prototype.GetAnchorB=function(t){return t},br.prototype.GetReactionForce=function(t,e){return e},br.prototype.GetReactionTorque=function(t){return 0},br.prototype.SetFrequency=function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)},br.prototype.GetFrequency=function(){return this.m_frequencyHz},br.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)},br.prototype.GetDampingRatio=function(){return this.m_dampingRatio},br.prototype.Dump=function(t){t("Area joint dumping is not supported.\n")},br.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],n=this.m_bodies[(e+1)%this.m_bodies.length],i=t.positions[i.m_islandIndex].c,n=t.positions[n.m_islandIndex].c,r=this.m_deltas[e];H.SubVV(n,i,r)}if(t.step.warmStarting)for(this.m_impulse*=t.step.dtRatio,e=0;e<this.m_bodies.length;++e){var s=this.m_bodies[e],a=t.velocities[s.m_islandIndex].v,r=this.m_deltas[e];a.x+=s.m_invMass*r.y*.5*this.m_impulse,a.y+=s.m_invMass*-r.x*.5*this.m_impulse}else this.m_impulse=0},br.prototype.SolveVelocityConstraints=function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],s=t.velocities[r.m_islandIndex].v;e+=(o=this.m_deltas[n]).LengthSquared()/r.GetMass(),i+=H.CrossVV(s,o)}var a=-2*i/e;for(this.m_impulse+=a,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],s=t.velocities[r.m_islandIndex].v,o=this.m_deltas[n];s.x+=r.m_invMass*o.y*.5*a,s.y+=r.m_invMass*-o.x*.5*a}},br.prototype.SolvePositionConstraints=function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],s=this.m_bodies[(n+1)%this.m_bodies.length],a=t.positions[r.m_islandIndex].c,s=t.positions[s.m_islandIndex].c,o=(c=H.SubVV(s,a,this.m_delta)).Length();o<F&&(o=1),this.m_normals[n].x=c.y/o,this.m_normals[n].y=-c.x/o,e+=o,i+=H.CrossVV(a,s)}for(var l=.5*(this.m_targetArea-(i*=.5))/e,h=!0,n=0;n<this.m_bodies.length;++n){var c,r=this.m_bodies[n],a=t.positions[r.m_islandIndex].c,u=(n+1)%this.m_bodies.length,u=((c=H.AddVV(this.m_normals[n],this.m_normals[u],this.m_delta)).SelfMul(l),c.LengthSquared());u>Z(.2)&&c.SelfMul(.2/Q(u)),64e-6<u&&(h=!1),a.x+=c.x,a.y+=c.y}return h},br),zn=(A(vr,Dn=hn),vr.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)},vr),Gn=(A(gr,Mn=Ln),gr.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,e=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(r),e=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(e,this.m_lalcA,this.m_rA)),r=(H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(r,this.m_lalcB,this.m_rB)),o=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,u=this.m_K;u.ex.x=o+l+h*e.y*e.y+c*r.y*r.y,u.ex.y=-h*e.x*e.y-c*r.x*r.y,u.ey.x=u.ex.y,u.ey.y=o+l+h*e.x*e.x+c*r.x*r.x,u.GetInverse(this.m_linearMass),this.m_angularMass=h+c,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting?(this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio,e=this.m_linearImpulse,i.SelfMulSub(o,e),n-=h*(H.CrossVV(this.m_rA,e)+this.m_angularImpulse),s.SelfMulAdd(l,e),a+=c*(H.CrossVV(this.m_rB,e)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a},gr.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=this.m_invMassA,a=this.m_invMassB,o=this.m_invIA,l=this.m_invIB,h=t.step.dt,c=-this.m_angularMass*(r-i),u=this.m_angularImpulse,_=h*this.m_maxTorque,u=(this.m_angularImpulse=q(this.m_angularImpulse+c,-_,_),i-=o*(c=this.m_angularImpulse-u),H.SubVV(H.AddVCrossSV(n,r+=l*c,this.m_rB,H.s_t0),H.AddVCrossSV(e,i,this.m_rA,H.s_t1),gr.SolveVelocityConstraints_s_Cdot_v2)),c=ot.MulMV(this.m_linearMass,u,gr.SolveVelocityConstraints_s_impulseV).SelfNeg(),u=gr.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(c),_=h*this.m_maxForce,this.m_linearImpulse.LengthSquared()>_*_&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(_)),H.SubVV(this.m_linearImpulse,u,c),e.SelfMulSub(s,c),i-=o*H.CrossVV(this.m_rA,c),n.SelfMulAdd(a,c),r+=l*H.CrossVV(this.m_rB,c),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},gr.prototype.SolvePositionConstraints=function(t){return!0},gr.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},gr.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},gr.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e},gr.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},gr.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},gr.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},gr.prototype.SetMaxForce=function(t){this.m_maxForce=t},gr.prototype.GetMaxForce=function(){return this.m_maxForce},gr.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},gr.prototype.GetMaxTorque=function(){return this.m_maxTorque},gr.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},gr.SolveVelocityConstraints_s_Cdot_v2=new H,gr.SolveVelocityConstraints_s_impulseV=new H,gr.SolveVelocityConstraints_s_oldImpulseV=new H,gr),Un=(A(yr,En=hn),yr),jn=(A(S,wn=Ln),S.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,l=t.positions[this.m_indexC].a,h=t.velocities[this.m_indexC].v,c=t.velocities[this.m_indexC].w,u=t.positions[this.m_indexD].a,_=t.velocities[this.m_indexD].v,d=t.velocities[this.m_indexD].w,i=this.m_qA.SetAngle(i),s=this.m_qB.SetAngle(s),l=this.m_qC.SetAngle(l),u=this.m_qD.SetAngle(u);this.m_mass=0,this.m_typeA===W.b2JointType.e_revoluteJoint?(this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC):(e=R.MulRV(l,this.m_localAxisC,S.InitVelocityConstraints_s_u),H.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC),l=R.MulRV(l,this.m_lalcC,S.InitVelocityConstraints_s_rC),H.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA),i=R.MulRV(i,this.m_lalcA,S.InitVelocityConstraints_s_rA),this.m_JvAC.Copy(e),this.m_JwC=H.CrossVV(l,e),this.m_JwA=H.CrossVV(i,e),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA),this.m_typeB===W.b2JointType.e_revoluteJoint?(this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD)):(e=R.MulRV(u,this.m_localAxisD,S.InitVelocityConstraints_s_u),H.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD),l=R.MulRV(u,this.m_lalcD,S.InitVelocityConstraints_s_rD),H.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB),i=R.MulRV(s,this.m_lalcB,S.InitVelocityConstraints_s_rB),H.MulSV(this.m_ratio,e,this.m_JvBD),this.m_JwD=this.m_ratio*H.CrossVV(l,e),this.m_JwB=this.m_ratio*H.CrossVV(i,e),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB),this.m_mass=0<this.m_mass?1/this.m_mass:0,t.step.warmStarting?(n.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),r+=this.m_iA*this.m_impulse*this.m_JwA,a.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),o+=this.m_iB*this.m_impulse*this.m_JwB,h.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),c-=this.m_iC*this.m_impulse*this.m_JwC,_.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),d-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o,t.velocities[this.m_indexC].w=c,t.velocities[this.m_indexD].w=d},S.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=t.velocities[this.m_indexC].v,a=t.velocities[this.m_indexC].w,o=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,h=H.DotVV(this.m_JvAC,H.SubVV(e,s,H.s_t0))+H.DotVV(this.m_JvBD,H.SubVV(n,o,H.s_t0)),h=(h+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*r-this.m_JwD*l),-this.m_mass*h);this.m_impulse+=h,e.SelfMulAdd(this.m_mA*h,this.m_JvAC),i+=this.m_iA*h*this.m_JwA,n.SelfMulAdd(this.m_mB*h,this.m_JvBD),r+=this.m_iB*h*this.m_JwB,s.SelfMulSub(this.m_mC*h,this.m_JvAC),a-=this.m_iC*h*this.m_JwC,o.SelfMulSub(this.m_mD*h,this.m_JvBD),l-=this.m_iD*h*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=l},S.prototype.SolvePositionConstraints=function(t){var e,i,n,r,s,a=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,l=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,c=t.positions[this.m_indexC].c,u=t.positions[this.m_indexC].a,_=t.positions[this.m_indexD].c,d=t.positions[this.m_indexD].a,f=this.m_qA.SetAngle(o),p=this.m_qB.SetAngle(h),m=this.m_qC.SetAngle(u),y=this.m_qD.SetAngle(d),g=this.m_JvAC,v=this.m_JvBD,b=0,y=(f=this.m_typeA===W.b2JointType.e_revoluteJoint?(g.SetZero(),n=e=1,b+=this.m_iA+this.m_iC,o-u-this.m_referenceAngleA):(s=R.MulRV(m,this.m_localAxisC,S.SolvePositionConstraints_s_u),x=R.MulRV(m,this.m_lalcC,S.SolvePositionConstraints_s_rC),f=R.MulRV(f,this.m_lalcA,S.SolvePositionConstraints_s_rA),g.Copy(s),n=H.CrossVV(x,s),e=H.CrossVV(f,s),b+=this.m_mC+this.m_mA+this.m_iC*n*n+this.m_iA*e*e,x=this.m_lalcC,m=R.MulTRV(m,H.AddVV(f,H.SubVV(a,c,H.s_t0),H.s_t0),H.s_t0),H.DotVV(H.SubVV(m,x,H.s_t0),this.m_localAxisC)),s=this.m_typeB===W.b2JointType.e_revoluteJoint?(v.SetZero(),i=this.m_ratio,r=this.m_ratio,b+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),h-d-this.m_referenceAngleB):(s=R.MulRV(y,this.m_localAxisD,S.SolvePositionConstraints_s_u),m=R.MulRV(y,this.m_lalcD,S.SolvePositionConstraints_s_rD),x=R.MulRV(p,this.m_lalcB,S.SolvePositionConstraints_s_rB),H.MulSV(this.m_ratio,s,v),r=this.m_ratio*H.CrossVV(m,s),i=this.m_ratio*H.CrossVV(x,s),b+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*r*r+this.m_iB*i*i,p=this.m_lalcD,m=R.MulTRV(y,H.AddVV(x,H.SubVV(l,_,H.s_t0),H.s_t0),H.s_t0),H.DotVV(H.SubVV(m,p,H.s_t0),this.m_localAxisD)),f+this.m_ratio*s-this.m_constant),x=0<b?-y/b:0;return a.SelfMulAdd(this.m_mA*x,g),o+=this.m_iA*x*e,l.SelfMulAdd(this.m_mB*x,v),h+=this.m_iB*x*i,c.SelfMulSub(this.m_mC*x,g),u-=this.m_iC*x*n,_.SelfMulSub(this.m_mD*x,v),d-=this.m_iD*x*r,t.positions[this.m_indexA].a=o,t.positions[this.m_indexB].a=h,t.positions[this.m_indexC].a=u,t.positions[this.m_indexD].a=d,!0},S.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},S.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},S.prototype.GetReactionForce=function(t,e){return H.MulSV(t*this.m_impulse,this.m_JvAC,e)},S.prototype.GetReactionTorque=function(t){return t*this.m_impulse*this.m_JwA},S.prototype.GetJoint1=function(){return this.m_joint1},S.prototype.GetJoint2=function(){return this.m_joint2},S.prototype.GetRatio=function(){return this.m_ratio},S.prototype.SetRatio=function(t){this.m_ratio=t},S.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,n=this.m_joint1.m_index,r=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",n),t("  jd.joint2 = joints[%d];\n",r),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},S.InitVelocityConstraints_s_u=new H,S.InitVelocityConstraints_s_rA=new H,S.InitVelocityConstraints_s_rB=new H,S.InitVelocityConstraints_s_rC=new H,S.InitVelocityConstraints_s_rD=new H,S.SolvePositionConstraints_s_u=new H,S.SolvePositionConstraints_s_rA=new H,S.SolvePositionConstraints_s_rB=new H,S.SolvePositionConstraints_s_rC=new H,S.SolvePositionConstraints_s_rD=new H,S),Wn=(A(mr,Sn=hn),mr.prototype.Initialize=function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);t=this.bodyA.GetAngle(),e=this.bodyB.GetAngle();this.angularOffset=e-t},mr),Hn=(A(pr,Tn=Ln),pr.prototype.GetAnchorA=function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t},pr.prototype.GetAnchorB=function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t},pr.prototype.GetReactionForce=function(t,e){return H.MulSV(t,this.m_linearImpulse,e)},pr.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},pr.prototype.SetLinearOffset=function(t){H.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))},pr.prototype.GetLinearOffset=function(){return this.m_linearOffset},pr.prototype.SetAngularOffset=function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},pr.prototype.GetAngularOffset=function(){return this.m_angularOffset},pr.prototype.SetMaxForce=function(t){this.m_maxForce=t},pr.prototype.GetMaxForce=function(){return this.m_maxForce},pr.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},pr.prototype.GetMaxTorque=function(){return this.m_maxTorque},pr.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(a),h=R.MulRV(h,H.SubVV(this.m_linearOffset,this.m_localCenterA,H.s_t0),this.m_rA),c=R.MulRV(c,H.NegV(this.m_localCenterB,H.s_t0),this.m_rB),u=this.m_invMassA,_=this.m_invMassB,d=this.m_invIA,f=this.m_invIB,p=this.m_K;p.ex.x=u+_+d*h.y*h.y+f*c.y*c.y,p.ex.y=-d*h.x*h.y-f*c.x*c.y,p.ey.x=p.ex.y,p.ey.y=u+_+d*h.x*h.x+f*c.x*c.x,p.GetInverse(this.m_linearMass),this.m_angularMass=d+f,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),H.SubVV(H.AddVV(s,c,H.s_t0),H.AddVV(e,h,H.s_t1),this.m_linearError),this.m_angularError=a-i-this.m_angularOffset,t.step.warmStarting?(this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio,p=this.m_linearImpulse,n.SelfMulSub(u,p),r-=d*(H.CrossVV(h,p)+this.m_angularImpulse),o.SelfMulAdd(_,p),l+=f*(H.CrossVV(c,p)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l},pr.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=this.m_invMassA,a=this.m_invMassB,o=this.m_invIA,l=this.m_invIB,h=t.step.dt,c=t.step.inv_dt,u=r-i+c*this.m_correctionFactor*this.m_angularError,u=-this.m_angularMass*u,_=this.m_angularImpulse,d=h*this.m_maxTorque,_=(this.m_angularImpulse=q(this.m_angularImpulse+u,-d,d),i-=o*(u=this.m_angularImpulse-_),this.m_rA),f=this.m_rB,u=H.AddVV(H.SubVV(H.AddVV(n,H.CrossSV(r+=l*u,f,H.s_t0),H.s_t0),H.AddVV(e,H.CrossSV(i,_,H.s_t1),H.s_t1),H.s_t2),H.MulSV(c*this.m_correctionFactor,this.m_linearError,H.s_t3),pr.SolveVelocityConstraints_s_Cdot_v2),c=ot.MulMV(this.m_linearMass,u,pr.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),u=pr.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(c),d=h*this.m_maxForce,this.m_linearImpulse.LengthSquared()>d*d&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(d)),H.SubVV(this.m_linearImpulse,u,c),e.SelfMulSub(s,c),i-=o*H.CrossVV(_,c),n.SelfMulAdd(a,c),r+=l*H.CrossVV(f,c),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},pr.prototype.SolvePositionConstraints=function(t){return!0},pr.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},pr.SolveVelocityConstraints_s_Cdot_v2=new H,pr.SolveVelocityConstraints_s_impulse_v2=new H,pr.SolveVelocityConstraints_s_oldImpulse_v2=new H,pr),Xn=(A(fr,Cn=hn),fr),Yn=(A(dr,An=Ln),dr.prototype.SetTarget=function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)},dr.prototype.GetTarget=function(){return this.m_targetA},dr.prototype.SetMaxForce=function(t){this.m_maxForce=t},dr.prototype.GetMaxForce=function(){return this.m_maxForce},dr.prototype.SetFrequency=function(t){this.m_frequencyHz=t},dr.prototype.GetFrequency=function(){return this.m_frequencyHz},dr.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},dr.prototype.GetDampingRatio=function(){return this.m_dampingRatio},dr.prototype.InitVelocityConstraints=function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,i=this.m_qB.SetAngle(i),s=this.m_bodyB.GetMass(),a=2*x*this.m_frequencyHz,o=2*s*this.m_dampingRatio*a,s=s*(a*a),a=t.step.dt,o=(this.m_gamma=a*(o+a*s),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=a*s*this.m_gamma,H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(i,this.m_lalcB,this.m_rB),this.m_K);o.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,o.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,o.ey.x=o.ex.y,o.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,o.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*H.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r},dr.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexB].v,i=t.velocities[this.m_indexB].w,n=H.AddVCrossSV(e,i,this.m_rB,dr.SolveVelocityConstraints_s_Cdot),n=ot.MulMV(this.m_mass,H.AddVV(n,H.AddVV(this.m_C,H.MulSV(this.m_gamma,this.m_impulse,H.s_t0),H.s_t0),H.s_t0).SelfNeg(),dr.SolveVelocityConstraints_s_impulse),r=dr.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse),s=(this.m_impulse.SelfAdd(n),t.step.dt*this.m_maxForce);this.m_impulse.LengthSquared()>s*s&&this.m_impulse.SelfMul(s/this.m_impulse.Length()),H.SubVV(this.m_impulse,r,n),e.SelfMulAdd(this.m_invMassB,n),i+=this.m_invIB*H.CrossVV(this.m_rB,n),t.velocities[this.m_indexB].w=i},dr.prototype.SolvePositionConstraints=function(t){return!0},dr.prototype.GetAnchorA=function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t},dr.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},dr.prototype.GetReactionForce=function(t,e){return H.MulSV(t,this.m_impulse,e)},dr.prototype.GetReactionTorque=function(t){return 0},dr.prototype.Dump=function(t){t("Mouse joint dumping is not supported.\n")},dr.prototype.ShiftOrigin=function(t){this.m_targetA.SelfSub(t)},dr.SolveVelocityConstraints_s_Cdot=new H,dr.SolveVelocityConstraints_s_impulse=new H,dr.SolveVelocityConstraints_s_oldImpulse=new H,dr),qn=(A(_r,xn=hn),_r.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_r),Jn=(A(E,bn=Ln),E.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,i=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(a),h=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(i,this.m_lalcA,this.m_rA)),a=(H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(a,this.m_lalcB,this.m_rB)),s=H.AddVV(H.SubVV(s,e,H.s_t0),H.SubVV(a,h,H.s_t1),E.InitVelocityConstraints_s_d),e=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,_=this.m_invIB;R.MulRV(i,this.m_localXAxisA,this.m_axis),this.m_a1=H.CrossVV(H.AddVV(s,h,H.s_t0),this.m_axis),this.m_a2=H.CrossVV(a,this.m_axis),this.m_motorMass=e+c+u*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),R.MulRV(i,this.m_localYAxisA,this.m_perp),this.m_s1=H.CrossVV(H.AddVV(s,h,H.s_t0),this.m_perp),this.m_s2=H.CrossVV(a,this.m_perp),this.m_K.ex.x=e+c+u*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2,this.m_K.ex.y=u*this.m_s1+_*this.m_s2,this.m_K.ex.z=u*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=u+_,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=u*this.m_a1+_*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=e+c+u*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2,this.m_enableLimit?(i=H.DotVV(this.m_axis,s),D(this.m_upperTranslation-this.m_lowerTranslation)<.016?this.m_limitState=W.b2LimitState.e_equalLimits:i<=this.m_lowerTranslation?this.m_limitState!==W.b2LimitState.e_atLowerLimit&&(this.m_limitState=W.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):i>=this.m_upperTranslation?this.m_limitState!==W.b2LimitState.e_atUpperLimit&&(this.m_limitState=W.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=W.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)):(this.m_limitState=W.b2LimitState.e_inactiveLimit,this.m_impulse.z=0),this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,h=H.AddVV(H.MulSV(this.m_impulse.x,this.m_perp,H.s_t0),H.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,H.s_t1),E.InitVelocityConstraints_s_P),a=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,s=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,n.SelfMulSub(e,h),r-=u*a,o.SelfMulAdd(c,h),l+=_*s):(this.m_impulse.SetZero(),this.m_motorImpulse=0),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l},E.prototype.SolveVelocityConstraints=function(t){var e,i,n,r,s,a,o,l=t.velocities[this.m_indexA].v,h=t.velocities[this.m_indexA].w,c=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,_=this.m_invMassA,d=this.m_invMassB,f=this.m_invIA,p=this.m_invIB,m=(this.m_enableMotor&&this.m_limitState!==W.b2LimitState.e_equalLimits&&(n=H.DotVV(this.m_axis,H.SubVV(c,l,H.s_t0))+this.m_a2*u-this.m_a1*h,n=this.m_motorMass*(this.m_motorSpeed-n),i=this.m_motorImpulse,e=t.step.dt*this.m_maxMotorForce,this.m_motorImpulse=q(this.m_motorImpulse+n,-e,e),n=this.m_motorImpulse-i,e=H.MulSV(n,this.m_axis,E.SolveVelocityConstraints_s_P),i=n*this.m_a1,n=n*this.m_a2,l.SelfMulSub(_,e),h-=f*i,c.SelfMulAdd(d,e),u+=p*n),H.DotVV(this.m_perp,H.SubVV(c,l,H.s_t0))+this.m_s2*u-this.m_s1*h),y=u-h;n=this.m_enableLimit&&this.m_limitState!==W.b2LimitState.e_inactiveLimit?(s=H.DotVV(this.m_axis,H.SubVV(c,l,H.s_t0))+this.m_a2*u-this.m_a1*h,r=E.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),s=this.m_K.Solve33(-m,-y,-s,E.SolveVelocityConstraints_s_df3),this.m_impulse.SelfAdd(s),this.m_limitState===W.b2LimitState.e_atLowerLimit?this.m_impulse.z=P(this.m_impulse.z,0):this.m_limitState===W.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=I(this.m_impulse.z,0)),a=-m-(this.m_impulse.z-r.z)*this.m_K.ez.x,o=-y-(this.m_impulse.z-r.z)*this.m_K.ez.y,(a=this.m_K.Solve22(a,o,E.SolveVelocityConstraints_s_f2r)).x+=r.x,a.y+=r.y,this.m_impulse.x=a.x,this.m_impulse.y=a.y,s.x=this.m_impulse.x-r.x,s.y=this.m_impulse.y-r.y,s.z=this.m_impulse.z-r.z,e=H.AddVV(H.MulSV(s.x,this.m_perp,H.s_t0),H.MulSV(s.z,this.m_axis,H.s_t1),E.SolveVelocityConstraints_s_P),i=s.x*this.m_s1+s.y+s.z*this.m_a1,s.x*this.m_s2+s.y+s.z*this.m_a2):(o=this.m_K.Solve22(-m,-y,E.SolveVelocityConstraints_s_df2),this.m_impulse.x+=o.x,this.m_impulse.y+=o.y,e=H.MulSV(o.x,this.m_perp,E.SolveVelocityConstraints_s_P),i=o.x*this.m_s1+o.y,o.x*this.m_s2+o.y),l.SelfMulSub(_,e),h-=f*i,c.SelfMulAdd(d,e),u+=p*n,t.velocities[this.m_indexA].w=h,t.velocities[this.m_indexB].w=u},E.prototype.SolvePositionConstraints=function(t){var e,i,n,r=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,a=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,l=this.m_qA.SetAngle(s),h=this.m_qB.SetAngle(o),c=this.m_invMassA,u=this.m_invMassB,_=this.m_invIA,d=this.m_invIB,f=R.MulRV(l,this.m_lalcA,this.m_rA),h=R.MulRV(h,this.m_lalcB,this.m_rB),p=H.SubVV(H.AddVV(a,h,H.s_t0),H.AddVV(r,f,H.s_t1),E.SolvePositionConstraints_s_d),m=R.MulRV(l,this.m_localXAxisA,this.m_axis),y=H.CrossVV(H.AddVV(p,f,H.s_t0),m),g=H.CrossVV(h,m),l=R.MulRV(l,this.m_localYAxisA,this.m_perp),f=H.CrossVV(H.AddVV(p,f,H.s_t0),l),h=H.CrossVV(h,l),v=E.SolvePositionConstraints_s_impulse,b=H.DotVV(l,p),x=o-s-this.m_referenceAngle,A=D(b),C=D(x),T=!1,S=0,T=(this.m_enableLimit&&(p=H.DotVV(m,p),D(this.m_upperTranslation-this.m_lowerTranslation)<.016?(S=q(p,-.2,.2),A=P(A,D(p)),T=!0):p<=this.m_lowerTranslation?(S=q(p-this.m_lowerTranslation+V,-.2,0),A=P(A,this.m_lowerTranslation-p),T=!0):p>=this.m_upperTranslation&&(S=q(p-this.m_upperTranslation-V,0,.2),A=P(A,p-this.m_upperTranslation),T=!0)),T?(0===(e=_+d)&&(e=1),p=_*y+d*g,T=c+u+_*y*y+d*g*g,(w=this.m_K3).ex.SetXYZ(c+u+_*f*f+d*h*h,i=_*f+d*h,n=_*f*y+d*h*g),w.ey.SetXYZ(i,e,p),w.ez.SetXYZ(n,p,T),v=w.Solve33(-b,-x,-S,v)):(0===(e=_+d)&&(e=1),(n=this.m_K2).ex.Set(c+u+_*f*f+d*h*h,i=_*f+d*h),n.ey.Set(i,e),p=n.Solve(-b,-x,E.SolvePositionConstraints_s_impulse1),v.x=p.x,v.y=p.y,v.z=0),H.AddVV(H.MulSV(v.x,l,H.s_t0),H.MulSV(v.z,m,H.s_t1),E.SolvePositionConstraints_s_P)),w=v.x*f+v.y+v.z*y,S=v.x*h+v.y+v.z*g;return r.SelfMulSub(c,T),s-=_*w,a.SelfMulAdd(u,T),o+=d*S,t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=o,A<=V&&C<=N},E.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},E.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},E.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e},E.prototype.GetReactionTorque=function(t){return t*this.m_impulse.y},E.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},E.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},E.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},E.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},E.prototype.GetJointTranslation=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,E.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,E.GetJointTranslation_s_pB),e=H.SubVV(e,t,E.GetJointTranslation_s_d),t=this.m_bodyA.GetWorldVector(this.m_localXAxisA,E.GetJointTranslation_s_axis);return H.DotVV(e,t)},E.prototype.GetJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=(H.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA),R.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA)),n=(H.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB),R.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB)),r=H.AddVV(t.m_sweep.c,i,H.s_t0),s=H.AddVV(e.m_sweep.c,n,H.s_t1),s=H.SubVV(s,r,H.s_t2),r=t.GetWorldVector(this.m_localXAxisA,this.m_axis),a=t.m_linearVelocity,o=e.m_linearVelocity,t=t.m_angularVelocity,e=e.m_angularVelocity;return H.DotVV(s,H.CrossSV(t,r,H.s_t0))+H.DotVV(r,H.SubVV(H.AddVCrossSV(o,e,n,H.s_t0),H.AddVCrossSV(a,t,i,H.s_t1),H.s_t0))},E.prototype.IsLimitEnabled=function(){return this.m_enableLimit},E.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},E.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},E.prototype.GetUpperLimit=function(){return this.m_upperTranslation},E.prototype.SetLimits=function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},E.prototype.IsMotorEnabled=function(){return this.m_enableMotor},E.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},E.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},E.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},E.prototype.SetMaxMotorForce=function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)},E.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},E.prototype.GetMotorForce=function(t){return t*this.m_motorImpulse},E.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},E.InitVelocityConstraints_s_d=new H,E.InitVelocityConstraints_s_P=new H,E.SolveVelocityConstraints_s_P=new H,E.SolveVelocityConstraints_s_f2r=new H,E.SolveVelocityConstraints_s_f1=new at,E.SolveVelocityConstraints_s_df3=new at,E.SolveVelocityConstraints_s_df2=new H,E.SolvePositionConstraints_s_d=new H,E.SolvePositionConstraints_s_impulse=new at,E.SolvePositionConstraints_s_impulse1=new H,E.SolvePositionConstraints_s_P=new H,E.GetJointTranslation_s_pA=new H,E.GetJointTranslation_s_pB=new H,E.GetJointTranslation_s_d=new H,E.GetJointTranslation_s_axis=new H,E),Zn=(A(ur,vn=hn),ur.prototype.Initialize=function(t,e,i,n,r,s,a){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(n),this.bodyA.GetLocalPoint(r,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.lengthA=H.DistanceVV(r,i),this.lengthB=H.DistanceVV(s,n),this.ratio=a},ur),Kn=(A(d,gn=Ln),d.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,i=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(a),i=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(i,this.m_lalcA,this.m_rA),H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(a,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(s).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB),this.m_uA.Length()),a=this.m_uB.Length(),e=(.08<i?this.m_uA.SelfMul(1/i):this.m_uA.SetZero(),.08<a?this.m_uB.SelfMul(1/a):this.m_uB.SetZero(),H.CrossVV(this.m_rA,this.m_uA)),s=H.CrossVV(this.m_rB,this.m_uB),i=this.m_invMassA+this.m_invIA*e*e,a=this.m_invMassB+this.m_invIB*s*s;this.m_mass=i+this.m_ratio*this.m_ratio*a,0<this.m_mass&&(this.m_mass=1/this.m_mass),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,e=H.MulSV(-this.m_impulse,this.m_uA,d.InitVelocityConstraints_s_PA),s=H.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,d.InitVelocityConstraints_s_PB),n.SelfMulAdd(this.m_invMassA,e),r+=this.m_invIA*H.CrossVV(this.m_rA,e),o.SelfMulAdd(this.m_invMassB,s),l+=this.m_invIB*H.CrossVV(this.m_rB,s)):this.m_impulse=0,t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l},d.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=H.AddVCrossSV(e,i,this.m_rA,d.SolveVelocityConstraints_s_vpA),a=H.AddVCrossSV(n,r,this.m_rB,d.SolveVelocityConstraints_s_vpB),s=-H.DotVV(this.m_uA,s)-this.m_ratio*H.DotVV(this.m_uB,a),a=-this.m_mass*s,s=(this.m_impulse+=a,H.MulSV(-a,this.m_uA,d.SolveVelocityConstraints_s_PA)),a=H.MulSV(-this.m_ratio*a,this.m_uB,d.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,s),i+=this.m_invIA*H.CrossVV(this.m_rA,s),n.SelfMulAdd(this.m_invMassB,a),r+=this.m_invIB*H.CrossVV(this.m_rB,a),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},d.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),s=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(s,this.m_lalcA,this.m_rA)),a=(H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(a,this.m_lalcB,this.m_rB)),o=this.m_uA.Copy(e).SelfAdd(s).SelfSub(this.m_groundAnchorA),l=this.m_uB.Copy(n).SelfAdd(a).SelfSub(this.m_groundAnchorB),h=o.Length(),c=l.Length(),u=(.08<h?o.SelfMul(1/h):o.SetZero(),.08<c?l.SelfMul(1/c):l.SetZero(),H.CrossVV(s,o)),_=H.CrossVV(a,l),u=this.m_invMassA+this.m_invIA*u*u,_=this.m_invMassB+this.m_invIB*_*_,u=u+this.m_ratio*this.m_ratio*_,_=(0<u&&(u=1/u),this.m_constant-h-this.m_ratio*c),h=D(_),c=-u*_,u=H.MulSV(-c,o,d.SolvePositionConstraints_s_PA),_=H.MulSV(-this.m_ratio*c,l,d.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,u),i+=this.m_invIA*H.CrossVV(s,u),n.SelfMulAdd(this.m_invMassB,_),r+=this.m_invIB*H.CrossVV(a,_),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,h<V},d.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},d.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},d.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e},d.prototype.GetReactionTorque=function(t){return 0},d.prototype.GetGroundAnchorA=function(){return this.m_groundAnchorA},d.prototype.GetGroundAnchorB=function(){return this.m_groundAnchorB},d.prototype.GetLengthA=function(){return this.m_lengthA},d.prototype.GetLengthB=function(){return this.m_lengthB},d.prototype.GetRatio=function(){return this.m_ratio},d.prototype.GetCurrentLengthA=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,d.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return H.DistanceVV(t,e)},d.prototype.GetCurrentLengthB=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return H.DistanceVV(t,e)},d.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},d.prototype.ShiftOrigin=function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)},d.InitVelocityConstraints_s_PA=new H,d.InitVelocityConstraints_s_PB=new H,d.SolveVelocityConstraints_s_vpA=new H,d.SolveVelocityConstraints_s_vpB=new H,d.SolveVelocityConstraints_s_PA=new H,d.SolveVelocityConstraints_s_PB=new H,d.SolvePositionConstraints_s_PA=new H,d.SolvePositionConstraints_s_PB=new H,d.GetCurrentLengthA_s_p=new H,d.GetCurrentLengthB_s_p=new H,d),Qn=(A(cr,yn=hn),cr.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},cr),$n=(A(v,mn=Ln),v.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,o=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(r),o=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(o,this.m_lalcA,this.m_rA),H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(l,this.m_lalcB,this.m_rB),this.m_invMassA),l=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,u=h+c===0;this.m_mass.ex.x=o+l+this.m_rA.y*this.m_rA.y*h+this.m_rB.y*this.m_rB.y*c,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*h-this.m_rB.y*this.m_rB.x*c,this.m_mass.ez.x=-this.m_rA.y*h-this.m_rB.y*c,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=o+l+this.m_rA.x*this.m_rA.x*h+this.m_rB.x*this.m_rB.x*c,this.m_mass.ez.y=this.m_rA.x*h+this.m_rB.x*c,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=h+c,this.m_motorMass=h+c,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!u||(this.m_motorImpulse=0),this.m_enableLimit&&!u?(u=r-e-this.m_referenceAngle,D(this.m_upperAngle-this.m_lowerAngle)<2*N?this.m_limitState=W.b2LimitState.e_equalLimits:u<=this.m_lowerAngle?(this.m_limitState!==W.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=W.b2LimitState.e_atLowerLimit):u>=this.m_upperAngle?(this.m_limitState!==W.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=W.b2LimitState.e_atUpperLimit):(this.m_limitState=W.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=W.b2LimitState.e_inactiveLimit,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,r=v.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),i.SelfMulSub(o,r),n-=h*(H.CrossVV(this.m_rA,r)+this.m_motorImpulse+this.m_impulse.z),s.SelfMulAdd(l,r),a+=c*(H.CrossVV(this.m_rB,r)+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a},v.prototype.SolveVelocityConstraints=function(t){var e,i,n,r,s,a,o=t.velocities[this.m_indexA].v,l=t.velocities[this.m_indexA].w,h=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,u=this.m_invMassA,_=this.m_invMassB,d=this.m_invIA,f=this.m_invIB,p=d+f===0;this.m_enableMotor&&this.m_limitState!==W.b2LimitState.e_equalLimits&&!p&&(s=c-l-this.m_motorSpeed,s=-this.m_motorMass*s,e=this.m_motorImpulse,a=t.step.dt*this.m_maxMotorTorque,this.m_motorImpulse=q(this.m_motorImpulse+s,-a,a),l-=d*(s=this.m_motorImpulse-e),c+=f*s),this.m_enableLimit&&this.m_limitState!==W.b2LimitState.e_inactiveLimit&&!p?(a=H.SubVV(H.AddVCrossSV(h,c,this.m_rB,H.s_t0),H.AddVCrossSV(o,l,this.m_rA,H.s_t1),v.SolveVelocityConstraints_s_Cdot1),e=this.m_mass.Solve33(a.x,a.y,c-l,v.SolveVelocityConstraints_s_impulse_v3).SelfNeg(),this.m_limitState===W.b2LimitState.e_equalLimits?this.m_impulse.SelfAdd(e):this.m_limitState===W.b2LimitState.e_atLowerLimit?this.m_impulse.z+e.z<0?(i=-a.x+this.m_impulse.z*this.m_mass.ez.x,n=-a.y+this.m_impulse.z*this.m_mass.ez.y,r=this.m_mass.Solve22(i,n,v.SolveVelocityConstraints_s_reduced_v2),e.x=r.x,e.y=r.y,e.z=-this.m_impulse.z,this.m_impulse.x+=r.x,this.m_impulse.y+=r.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(e):this.m_limitState===W.b2LimitState.e_atUpperLimit&&(0<this.m_impulse.z+e.z?(i=-a.x+this.m_impulse.z*this.m_mass.ez.x,n=-a.y+this.m_impulse.z*this.m_mass.ez.y,r=this.m_mass.Solve22(i,n,v.SolveVelocityConstraints_s_reduced_v2),e.x=r.x,e.y=r.y,e.z=-this.m_impulse.z,this.m_impulse.x+=r.x,this.m_impulse.y+=r.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(e)),s=v.SolveVelocityConstraints_s_P.Set(e.x,e.y),o.SelfMulSub(u,s),l-=d*(H.CrossVV(this.m_rA,s)+e.z),h.SelfMulAdd(_,s),c+=f*(H.CrossVV(this.m_rB,s)+e.z)):(p=H.SubVV(H.AddVCrossSV(h,c,this.m_rB,H.s_t0),H.AddVCrossSV(o,l,this.m_rA,H.s_t1),v.SolveVelocityConstraints_s_Cdot_v2),a=this.m_mass.Solve22(-p.x,-p.y,v.SolveVelocityConstraints_s_impulse_v2),this.m_impulse.x+=a.x,this.m_impulse.y+=a.y,o.SelfMulSub(u,a),l-=d*H.CrossVV(this.m_rA,a),h.SelfMulAdd(_,a),c+=f*H.CrossVV(this.m_rB,a)),t.velocities[this.m_indexA].w=l,t.velocities[this.m_indexB].w=c},v.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),o=0,l=this.m_invIA+this.m_invIB===0,l=(this.m_enableLimit&&this.m_limitState!==W.b2LimitState.e_inactiveLimit&&!l&&(l=r-i-this.m_referenceAngle,c=0,this.m_limitState===W.b2LimitState.e_equalLimits?(h=q(l-this.m_lowerAngle,-.13962634015955555,.13962634015955555),c=-this.m_motorMass*h,o=D(h)):this.m_limitState===W.b2LimitState.e_atLowerLimit?(o=-(h=l-this.m_lowerAngle),h=q(h+N,-.13962634015955555,0),c=-this.m_motorMass*h):this.m_limitState===W.b2LimitState.e_atUpperLimit&&(o=h=l-this.m_upperAngle,h=q(h-N,0,.13962634015955555),c=-this.m_motorMass*h),i-=this.m_invIA*c,r+=this.m_invIB*c),s.SetAngle(i),a.SetAngle(r),H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(s,this.m_lalcA,this.m_rA)),h=(H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(a,this.m_lalcB,this.m_rB)),c=H.SubVV(H.AddVV(n,h,H.s_t0),H.AddVV(e,l,H.s_t1),v.SolvePositionConstraints_s_C_v2),s=c.Length(),a=this.m_invMassA,u=this.m_invMassB,_=this.m_invIA,d=this.m_invIB,f=this.m_K,f=(f.ex.x=a+u+_*l.y*l.y+d*h.y*h.y,f.ex.y=-_*l.x*l.y-d*h.x*h.y,f.ey.x=f.ex.y,f.ey.y=a+u+_*l.x*l.x+d*h.x*h.x,f.Solve(c.x,c.y,v.SolvePositionConstraints_s_impulse).SelfNeg());return e.SelfMulSub(a,f),i-=_*H.CrossVV(l,f),n.SelfMulAdd(u,f),r+=d*H.CrossVV(h,f),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,s<=V&&o<=N},v.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},v.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},v.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},v.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},v.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},v.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},v.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},v.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},v.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},v.prototype.IsMotorEnabled=function(){return this.m_enableMotor},v.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},v.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},v.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},v.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},v.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},v.prototype.IsLimitEnabled=function(){return this.m_enableLimit},v.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},v.prototype.GetLowerLimit=function(){return this.m_lowerAngle},v.prototype.GetUpperLimit=function(){return this.m_upperAngle},v.prototype.SetLimits=function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},v.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},v.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},v.InitVelocityConstraints_s_P=new H,v.SolveVelocityConstraints_s_P=new H,v.SolveVelocityConstraints_s_Cdot_v2=new H,v.SolveVelocityConstraints_s_Cdot1=new H,v.SolveVelocityConstraints_s_impulse_v3=new at,v.SolveVelocityConstraints_s_reduced_v2=new H,v.SolveVelocityConstraints_s_impulse_v2=new H,v.SolvePositionConstraints_s_C_v2=new H,v.SolvePositionConstraints_s_impulse=new H,v),tr=(A(hr,pn=hn),hr),er=(A(lr,fn=Ln),lr.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,i=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(a),i=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(i,this.m_lalcA,this.m_rA),H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(a,this.m_lalcB,this.m_rB),this.m_u.Copy(s).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length(),this.m_length-this.m_maxLength);if(this.m_state=0<i?W.b2LimitState.e_atUpperLimit:W.b2LimitState.e_inactiveLimit,!(this.m_length>V))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);a=H.CrossVV(this.m_rA,this.m_u),s=H.CrossVV(this.m_rB,this.m_u),e=this.m_invMassA+this.m_invIA*a*a+this.m_invMassB+this.m_invIB*s*s;this.m_mass=0!==e?1/e:0,t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,i=H.MulSV(this.m_impulse,this.m_u,lr.InitVelocityConstraints_s_P),n.SelfMulSub(this.m_invMassA,i),r-=this.m_invIA*H.CrossVV(this.m_rA,i),o.SelfMulAdd(this.m_invMassB,i),l+=this.m_invIB*H.CrossVV(this.m_rB,i)):this.m_impulse=0,t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l},lr.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=H.AddVCrossSV(e,i,this.m_rA,lr.SolveVelocityConstraints_s_vpA),a=H.AddVCrossSV(n,r,this.m_rB,lr.SolveVelocityConstraints_s_vpB),o=this.m_length-this.m_maxLength,a=H.DotVV(this.m_u,H.SubVV(a,s,H.s_t0)),s=(o<0&&(a+=t.step.inv_dt*o),-this.m_mass*a),o=this.m_impulse,a=(this.m_impulse=I(0,this.m_impulse+s),s=this.m_impulse-o,H.MulSV(s,this.m_u,lr.SolveVelocityConstraints_s_P));e.SelfMulSub(this.m_invMassA,a),i-=this.m_invIA*H.CrossVV(this.m_rA,a),n.SelfMulAdd(this.m_invMassB,a),r+=this.m_invIB*H.CrossVV(this.m_rB,a),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},lr.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),s=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(s,this.m_lalcA,this.m_rA)),a=(H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(a,this.m_lalcB,this.m_rB)),o=this.m_u.Copy(n).SelfAdd(a).SelfSub(e).SelfSub(s),l=o.Normalize(),h=q(l-this.m_maxLength,0,.2),h=-this.m_mass*h,h=H.MulSV(h,o,lr.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,h),i-=this.m_invIA*H.CrossVV(s,h),n.SelfMulAdd(this.m_invMassB,h),r+=this.m_invIB*H.CrossVV(a,h),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,l-this.m_maxLength<V},lr.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},lr.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},lr.prototype.GetReactionForce=function(t,e){return H.MulSV(t*this.m_impulse,this.m_u,e)},lr.prototype.GetReactionTorque=function(t){return 0},lr.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},lr.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},lr.prototype.SetMaxLength=function(t){this.m_maxLength=t},lr.prototype.GetMaxLength=function(){return this.m_maxLength},lr.prototype.GetLimitState=function(){return this.m_state},lr.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},lr.InitVelocityConstraints_s_P=new H,lr.SolveVelocityConstraints_s_vpA=new H,lr.SolveVelocityConstraints_s_vpB=new H,lr.SolveVelocityConstraints_s_P=new H,lr.SolvePositionConstraints_s_P=new H,lr),ir=(A(or,dn=hn),or.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},or),nr=(A(g,_n=Ln),g.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e,i,n,r,s=t.positions[this.m_indexA].a,a=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,l=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(s),_=this.m_qB.SetAngle(l),u=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(u,this.m_lalcA,this.m_rA),H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(_,this.m_lalcB,this.m_rB),this.m_invMassA),_=this.m_invMassB,d=this.m_invIA,f=this.m_invIB,p=this.m_K;p.ex.x=u+_+this.m_rA.y*this.m_rA.y*d+this.m_rB.y*this.m_rB.y*f,p.ey.x=-this.m_rA.y*this.m_rA.x*d-this.m_rB.y*this.m_rB.x*f,p.ez.x=-this.m_rA.y*d-this.m_rB.y*f,p.ex.y=p.ey.x,p.ey.y=u+_+this.m_rA.x*this.m_rA.x*d+this.m_rB.x*this.m_rB.x*f,p.ez.y=this.m_rA.x*d+this.m_rB.x*f,p.ex.z=p.ez.x,p.ey.z=p.ez.y,p.ez.z=d+f,0<this.m_frequencyHz?(p.GetInverse22(this.m_mass),l=l-s-this.m_referenceAngle,s=2*x*this.m_frequencyHz,i=2*(r=0<(e=d+f)?1/e:0)*this.m_dampingRatio*s,n=t.step.dt,this.m_gamma=n*(i+n*(i=r*s*s)),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=l*n*i*this.m_gamma,e+=this.m_gamma,this.m_mass.ez.z=0!==e?1/e:0):(p.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0),t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),r=g.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),a.SelfMulSub(u,r),o-=d*(H.CrossVV(this.m_rA,r)+this.m_impulse.z),h.SelfMulAdd(_,r),c+=f*(H.CrossVV(this.m_rB,r)+this.m_impulse.z)):this.m_impulse.SetZero(),t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=c},g.prototype.SolveVelocityConstraints=function(t){var e,i,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,o=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,c=this.m_invIB;0<this.m_frequencyHz?(i=-this.m_mass.ez.z*(a-r+this.m_bias+this.m_gamma*this.m_impulse.z),this.m_impulse.z+=i,r-=h*i,i=H.SubVV(H.AddVCrossSV(s,a+=c*i,this.m_rB,H.s_t0),H.AddVCrossSV(n,r,this.m_rA,H.s_t1),g.SolveVelocityConstraints_s_Cdot1),e=lt.MulM33XY(this.m_mass,i.x,i.y,g.SolveVelocityConstraints_s_impulse1).SelfNeg(),this.m_impulse.x+=e.x,this.m_impulse.y+=e.y,n.SelfMulSub(o,e=e),r-=h*H.CrossVV(this.m_rA,e),s.SelfMulAdd(l,e),a+=c*H.CrossVV(this.m_rB,e)):(i=H.SubVV(H.AddVCrossSV(s,a,this.m_rB,H.s_t0),H.AddVCrossSV(n,r,this.m_rA,H.s_t1),g.SolveVelocityConstraints_s_Cdot1),i=lt.MulM33XYZ(this.m_mass,i.x,i.y,a-r,g.SolveVelocityConstraints_s_impulse).SelfNeg(),this.m_impulse.SelfAdd(i),e=g.SolveVelocityConstraints_s_P.Set(i.x,i.y),n.SelfMulSub(o,e),r-=h*(H.CrossVV(this.m_rA,e)+i.z),s.SelfMulAdd(l,e),a+=c*(H.CrossVV(this.m_rB,e)+i.z)),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=a},g.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),o=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,s=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(s,this.m_lalcA,this.m_rA));H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u,_,d,f,a=R.MulRV(a,this.m_lalcB,this.m_rB),p=this.m_K;return p.ex.x=o+l+s.y*s.y*h+a.y*a.y*c,p.ey.x=-s.y*s.x*h-a.y*a.x*c,p.ez.x=-s.y*h-a.y*c,p.ex.y=p.ey.x,p.ey.y=o+l+s.x*s.x*h+a.x*a.x*c,p.ez.y=s.x*h+a.x*c,p.ex.z=p.ez.x,p.ey.z=p.ez.y,p.ez.z=h+c,0<this.m_frequencyHz?(u=(d=H.SubVV(H.AddVV(n,a,H.s_t0),H.AddVV(e,s,H.s_t1),g.SolvePositionConstraints_s_C1)).Length(),_=0,f=p.Solve22(d.x,d.y,g.SolvePositionConstraints_s_P).SelfNeg(),e.SelfMulSub(o,f),i-=h*H.CrossVV(s,f),n.SelfMulAdd(l,f),r+=c*H.CrossVV(a,f)):(d=H.SubVV(H.AddVV(n,a,H.s_t0),H.AddVV(e,s,H.s_t1),g.SolvePositionConstraints_s_C1),a=r-i-this.m_referenceAngle,u=d.Length(),_=D(a),s=p.Solve33(d.x,d.y,a,g.SolvePositionConstraints_s_impulse).SelfNeg(),f=g.SolvePositionConstraints_s_P.Set(s.x,s.y),e.SelfMulSub(o,f),i-=h*(H.CrossVV(this.m_rA,f)+s.z),n.SelfMulAdd(l,f),r+=c*(H.CrossVV(this.m_rB,f)+s.z)),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,u<=V&&_<=N},g.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},g.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},g.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},g.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},g.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},g.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},g.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},g.prototype.SetFrequency=function(t){this.m_frequencyHz=t},g.prototype.GetFrequency=function(){return this.m_frequencyHz},g.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},g.prototype.GetDampingRatio=function(){return this.m_dampingRatio},g.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},g.InitVelocityConstraints_s_P=new H,g.SolveVelocityConstraints_s_Cdot1=new H,g.SolveVelocityConstraints_s_impulse1=new H,g.SolveVelocityConstraints_s_impulse=new at,g.SolveVelocityConstraints_s_P=new H,g.SolvePositionConstraints_s_C1=new H,g.SolvePositionConstraints_s_P=new H,g.SolvePositionConstraints_s_impulse=new at,g),rr=(A(ar,un=hn),ar.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA)},ar),sr=(A(y,cn=Ln),y.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},y.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},y.prototype.SetSpringFrequencyHz=function(t){this.m_frequencyHz=t},y.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},y.prototype.SetSpringDampingRatio=function(t){this.m_dampingRatio=t},y.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},y.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,s=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,o=t.velocities[this.m_indexA].v,l=t.velocities[this.m_indexA].w,h=t.positions[this.m_indexB].c,c=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,_=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(a),c=this.m_qB.SetAngle(c),d=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(a,this.m_lalcA,this.m_rA)),c=(H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(c,this.m_lalcB,this.m_rB)),h=H.SubVV(H.AddVV(h,c,H.s_t0),H.AddVV(s,d,H.s_t1),y.InitVelocityConstraints_s_d);R.MulRV(a,this.m_localYAxisA,this.m_ay),this.m_sAy=H.CrossVV(H.AddVV(h,d,H.s_t0),this.m_ay),this.m_sBy=H.CrossVV(c,this.m_ay),this.m_mass=e+i+n*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,0<this.m_mass&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,(this.m_gamma=0)<this.m_frequencyHz?(R.MulRV(a,this.m_localXAxisA,this.m_ax),this.m_sAx=H.CrossVV(H.AddVV(h,d,H.s_t0),this.m_ax),this.m_sBx=H.CrossVV(c,this.m_ax),0<(s=e+i+n*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx)&&(this.m_springMass=1/s,a=H.DotVV(h,this.m_ax),d=2*x*this.m_frequencyHz,c=2*this.m_springMass*this.m_dampingRatio*d,e=this.m_springMass*d*d,i=t.step.dt,this.m_gamma=i*(c+i*e),0<this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_bias=a*i*e*this.m_gamma,this.m_springMass=s+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass))):this.m_springImpulse=0,this.m_enableMotor?(this.m_motorMass=n+r,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio,h=H.AddVV(H.MulSV(this.m_impulse,this.m_ay,H.s_t0),H.MulSV(this.m_springImpulse,this.m_ax,H.s_t1),y.InitVelocityConstraints_s_P),d=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,c=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse,o.SelfMulSub(this.m_invMassA,h),l-=this.m_invIA*d,u.SelfMulAdd(this.m_invMassB,h),_+=this.m_invIB*c):(this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0),t.velocities[this.m_indexA].w=l,t.velocities[this.m_indexB].w=_},y.prototype.SolveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,s=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,o=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=H.DotVV(this.m_ax,H.SubVV(o,s,H.s_t0))+this.m_sBx*l-this.m_sAx*a,c=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse),u=(this.m_springImpulse+=c,H.MulSV(c,this.m_ax,y.SolveVelocityConstraints_s_P)),_=c*this.m_sAx,d=c*this.m_sBx,f=(s.SelfMulSub(e,u),a-=n*_,o.SelfMulAdd(i,u),h=(l+=r*d)-a-this.m_motorSpeed,c=-this.m_motorMass*h,this.m_motorImpulse),p=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=q(this.m_motorImpulse+c,-p,p),a-=n*(c=this.m_motorImpulse-f),l+=r*c,h=H.DotVV(this.m_ay,H.SubVV(o,s,H.s_t0))+this.m_sBy*l-this.m_sAy*a,c=-this.m_mass*h,this.m_impulse+=c,u=H.MulSV(c,this.m_ay,y.SolveVelocityConstraints_s_P),_=c*this.m_sAy,d=c*this.m_sBy,s.SelfMulSub(e,u),a-=n*_,o.SelfMulAdd(i,u),l+=r*d,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=l},y.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),o=(H.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(s,this.m_lalcA,this.m_rA));H.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var a=R.MulRV(a,this.m_lalcB,this.m_rB),l=H.AddVV(H.SubVV(n,e,H.s_t0),H.SubVV(a,o,H.s_t1),y.SolvePositionConstraints_s_d),s=R.MulRV(s,this.m_localYAxisA,this.m_ay),o=H.CrossVV(H.AddVV(l,o,H.s_t0),s),a=H.CrossVV(a,s),l=H.DotVV(l,this.m_ay),h=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,h=0!==h?-l/h:0,s=H.MulSV(h,s,y.SolvePositionConstraints_s_P),o=h*o,h=h*a;return e.SelfMulSub(this.m_invMassA,s),i-=this.m_invIA*o,n.SelfMulAdd(this.m_invMassB,s),r+=this.m_invIB*h,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,D(l)<=V},y.prototype.GetDefinition=function(t){return t},y.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},y.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},y.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e},y.prototype.GetReactionTorque=function(t){return t*this.m_motorImpulse},y.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},y.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},y.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},y.prototype.GetJointTranslation=function(){return this.GetPrismaticJointTranslation()},y.prototype.GetJointLinearSpeed=function(){return this.GetPrismaticJointSpeed()},y.prototype.GetJointAngle=function(){return this.GetRevoluteJointAngle()},y.prototype.GetJointAngularSpeed=function(){return this.GetRevoluteJointSpeed()},y.prototype.GetPrismaticJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new H),e=e.GetWorldPoint(this.m_localAnchorB,new H),e=H.SubVV(e,i,new H),i=t.GetWorldVector(this.m_localXAxisA,new H);return H.DotVV(e,i)},y.prototype.GetPrismaticJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=(H.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA),R.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA)),n=(H.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB),R.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB)),r=H.AddVV(t.m_sweep.c,i,H.s_t0),s=H.AddVV(e.m_sweep.c,n,H.s_t1),s=H.SubVV(s,r,H.s_t2),r=t.GetWorldVector(this.m_localXAxisA,new H),a=t.m_linearVelocity,o=e.m_linearVelocity,t=t.m_angularVelocity,e=e.m_angularVelocity;return H.DotVV(s,H.CrossSV(t,r,H.s_t0))+H.DotVV(r,H.SubVV(H.AddVCrossSV(o,e,n,H.s_t0),H.AddVCrossSV(a,t,i,H.s_t1),H.s_t0))},y.prototype.GetRevoluteJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a},y.prototype.GetRevoluteJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},y.prototype.IsMotorEnabled=function(){return this.m_enableMotor},y.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},y.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},y.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},y.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},y.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},y.InitVelocityConstraints_s_d=new H,y.InitVelocityConstraints_s_P=new H,y.SolveVelocityConstraints_s_P=new H,y.SolvePositionConstraints_s_d=new H,y.SolvePositionConstraints_s_P=new H,y);function y(t){var e=cn.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_localAnchorA=new H,e.m_localAnchorB=new H,e.m_localXAxisA=new H,e.m_localYAxisA=new H,e.m_impulse=0,e.m_motorImpulse=0,e.m_springImpulse=0,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableMotor=!1,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_ax=new H,e.m_ay=new H,e.m_sAx=0,e.m_sBx=0,e.m_sAy=0,e.m_sBy=0,e.m_mass=0,e.m_motorMass=0,e.m_springMass=0,e.m_bias=0,e.m_gamma=0,e.m_qA=new R,e.m_qB=new R,e.m_lalcA=new H,e.m_lalcB=new H,e.m_rA=new H,e.m_rB=new H,e.m_frequencyHz=f(t.frequencyHz,2),e.m_dampingRatio=f(t.dampingRatio,.7),e.m_localAnchorA.Copy(f(t.localAnchorA,H.ZERO)),e.m_localAnchorB.Copy(f(t.localAnchorB,H.ZERO)),e.m_localXAxisA.Copy(f(t.localAxisA,H.UNITX)),H.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_maxMotorTorque=f(t.maxMotorTorque,0),e.m_motorSpeed=f(t.motorSpeed,0),e.m_enableMotor=f(t.enableMotor,!1),e.m_ax.SetZero(),e.m_ay.SetZero(),e}function ar(){var t=un.call(this,W.b2JointType.e_wheelJoint)||this;return t.localAnchorA=new H(0,0),t.localAnchorB=new H(0,0),t.localAxisA=new H(1,0),t.enableMotor=!1,t.maxMotorTorque=0,t.motorSpeed=0,t.frequencyHz=2,t.dampingRatio=.7,t}function g(t){var e=_n.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_bias=0,e.m_localAnchorA=new H,e.m_localAnchorB=new H,e.m_referenceAngle=0,e.m_gamma=0,e.m_impulse=new at(0,0,0),e.m_indexA=0,e.m_indexB=0,e.m_rA=new H,e.m_rB=new H,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=new lt,e.m_qA=new R,e.m_qB=new R,e.m_lalcA=new H,e.m_lalcB=new H,e.m_K=new lt,e.m_frequencyHz=f(t.frequencyHz,0),e.m_dampingRatio=f(t.dampingRatio,0),e.m_localAnchorA.Copy(f(t.localAnchorA,H.ZERO)),e.m_localAnchorB.Copy(f(t.localAnchorB,H.ZERO)),e.m_referenceAngle=f(t.referenceAngle,0),e.m_impulse.SetZero(),e}function or(){var t=dn.call(this,W.b2JointType.e_weldJoint)||this;return t.localAnchorA=new H,t.localAnchorB=new H,t.referenceAngle=0,t.frequencyHz=0,t.dampingRatio=0,t}function lr(t){var e=fn.call(this,t)||this;return e.m_localAnchorA=new H,e.m_localAnchorB=new H,e.m_maxLength=0,e.m_length=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_u=new H,e.m_rA=new H,e.m_rB=new H,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_state=W.b2LimitState.e_inactiveLimit,e.m_qA=new R,e.m_qB=new R,e.m_lalcA=new H,e.m_lalcB=new H,e.m_localAnchorA.Copy(f(t.localAnchorA,new H(-1,0))),e.m_localAnchorB.Copy(f(t.localAnchorB,new H(1,0))),e.m_maxLength=f(t.maxLength,0),e}function hr(){var t=pn.call(this,W.b2JointType.e_ropeJoint)||this;return t.localAnchorA=new H(-1,0),t.localAnchorB=new H(1,0),t.maxLength=0,t}function v(t){var e=mn.call(this,t)||this;return e.m_localAnchorA=new H,e.m_localAnchorB=new H,e.m_impulse=new at,e.m_motorImpulse=0,e.m_enableMotor=!1,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_referenceAngle=0,e.m_lowerAngle=0,e.m_upperAngle=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new H,e.m_rB=new H,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=new lt,e.m_motorMass=0,e.m_limitState=W.b2LimitState.e_inactiveLimit,e.m_qA=new R,e.m_qB=new R,e.m_lalcA=new H,e.m_lalcB=new H,e.m_K=new ot,e.m_localAnchorA.Copy(f(t.localAnchorA,H.ZERO)),e.m_localAnchorB.Copy(f(t.localAnchorB,H.ZERO)),e.m_referenceAngle=f(t.referenceAngle,0),e.m_impulse.SetZero(),e.m_motorImpulse=0,e.m_lowerAngle=f(t.lowerAngle,0),e.m_upperAngle=f(t.upperAngle,0),e.m_maxMotorTorque=f(t.maxMotorTorque,0),e.m_motorSpeed=f(t.motorSpeed,0),e.m_enableLimit=f(t.enableLimit,!1),e.m_enableMotor=f(t.enableMotor,!1),e.m_limitState=W.b2LimitState.e_inactiveLimit,e}function cr(){var t=yn.call(this,W.b2JointType.e_revoluteJoint)||this;return t.localAnchorA=new H(0,0),t.localAnchorB=new H(0,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerAngle=0,t.upperAngle=0,t.enableMotor=!1,t.motorSpeed=0,t.maxMotorTorque=0,t}function d(t){var e=gn.call(this,t)||this;return e.m_groundAnchorA=new H,e.m_groundAnchorB=new H,e.m_lengthA=0,e.m_lengthB=0,e.m_localAnchorA=new H,e.m_localAnchorB=new H,e.m_constant=0,e.m_ratio=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_uA=new H,e.m_uB=new H,e.m_rA=new H,e.m_rB=new H,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_qA=new R,e.m_qB=new R,e.m_lalcA=new H,e.m_lalcB=new H,e.m_groundAnchorA.Copy(f(t.groundAnchorA,new H(-1,1))),e.m_groundAnchorB.Copy(f(t.groundAnchorB,new H(1,0))),e.m_localAnchorA.Copy(f(t.localAnchorA,new H(-1,0))),e.m_localAnchorB.Copy(f(t.localAnchorB,new H(1,0))),e.m_lengthA=f(t.lengthA,0),e.m_lengthB=f(t.lengthB,0),e.m_ratio=f(t.ratio,1),e.m_constant=f(t.lengthA,0)+e.m_ratio*f(t.lengthB,0),e.m_impulse=0,e}function ur(){var t=vn.call(this,W.b2JointType.e_pulleyJoint)||this;return t.groundAnchorA=new H(-1,1),t.groundAnchorB=new H(1,1),t.localAnchorA=new H(-1,0),t.localAnchorB=new H(1,0),t.lengthA=0,t.lengthB=0,t.ratio=1,t.collideConnected=!0,t}function E(t){var e=bn.call(this,t)||this;return e.m_localAnchorA=new H,e.m_localAnchorB=new H,e.m_localXAxisA=new H,e.m_localYAxisA=new H,e.m_referenceAngle=0,e.m_impulse=new at(0,0,0),e.m_motorImpulse=0,e.m_lowerTranslation=0,e.m_upperTranslation=0,e.m_maxMotorForce=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_enableMotor=!1,e.m_limitState=W.b2LimitState.e_inactiveLimit,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_axis=new H(0,0),e.m_perp=new H(0,0),e.m_s1=0,e.m_s2=0,e.m_a1=0,e.m_a2=0,e.m_K=new lt,e.m_K3=new lt,e.m_K2=new ot,e.m_motorMass=0,e.m_qA=new R,e.m_qB=new R,e.m_lalcA=new H,e.m_lalcB=new H,e.m_rA=new H,e.m_rB=new H,e.m_localAnchorA.Copy(f(t.localAnchorA,H.ZERO)),e.m_localAnchorB.Copy(f(t.localAnchorB,H.ZERO)),e.m_localXAxisA.Copy(f(t.localAxisA,new H(1,0))).SelfNormalize(),H.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_referenceAngle=f(t.referenceAngle,0),e.m_lowerTranslation=f(t.lowerTranslation,0),e.m_upperTranslation=f(t.upperTranslation,0),e.m_maxMotorForce=f(t.maxMotorForce,0),e.m_motorSpeed=f(t.motorSpeed,0),e.m_enableLimit=f(t.enableLimit,!1),e.m_enableMotor=f(t.enableMotor,!1),e}function _r(){var t=xn.call(this,W.b2JointType.e_prismaticJoint)||this;return t.localAnchorA=new H,t.localAnchorB=new H,t.localAxisA=new H(1,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerTranslation=0,t.upperTranslation=0,t.enableMotor=!1,t.maxMotorForce=0,t.motorSpeed=0,t}function dr(t){var e=An.call(this,t)||this;return e.m_localAnchorB=new H,e.m_targetA=new H,e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_beta=0,e.m_impulse=new H,e.m_maxForce=0,e.m_gamma=0,e.m_indexA=0,e.m_indexB=0,e.m_rB=new H,e.m_localCenterB=new H,e.m_invMassB=0,e.m_invIB=0,e.m_mass=new ot,e.m_C=new H,e.m_qB=new R,e.m_lalcB=new H,e.m_K=new ot,e.m_targetA.Copy(f(t.target,H.ZERO)),O.MulTXV(e.m_bodyB.GetTransform(),e.m_targetA,e.m_localAnchorB),e.m_maxForce=f(t.maxForce,0),e.m_impulse.SetZero(),e.m_frequencyHz=f(t.frequencyHz,0),e.m_dampingRatio=f(t.dampingRatio,0),e.m_beta=0,e.m_gamma=0,e}function fr(){var t=Cn.call(this,W.b2JointType.e_mouseJoint)||this;return t.target=new H,t.maxForce=0,t.frequencyHz=5,t.dampingRatio=.7,t}function pr(t){var e=Tn.call(this,t)||this;return e.m_linearOffset=new H,e.m_angularOffset=0,e.m_linearImpulse=new H,e.m_angularImpulse=0,e.m_maxForce=0,e.m_maxTorque=0,e.m_correctionFactor=.3,e.m_indexA=0,e.m_indexB=0,e.m_rA=new H,e.m_rB=new H,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_linearError=new H,e.m_angularError=0,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_linearMass=new ot,e.m_angularMass=0,e.m_qA=new R,e.m_qB=new R,e.m_K=new ot,e.m_linearOffset.Copy(f(t.linearOffset,H.ZERO)),e.m_linearImpulse.SetZero(),e.m_maxForce=f(t.maxForce,0),e.m_maxTorque=f(t.maxTorque,0),e.m_correctionFactor=f(t.correctionFactor,.3),e}function mr(){var t=Sn.call(this,W.b2JointType.e_motorJoint)||this;return t.linearOffset=new H(0,0),t.angularOffset=0,t.maxForce=1,t.maxTorque=1,t.correctionFactor=.3,t}function S(t){var e,i,n=wn.call(this,t)||this,r=(n.m_typeA=W.b2JointType.e_unknownJoint,n.m_typeB=W.b2JointType.e_unknownJoint,n.m_localAnchorA=new H,n.m_localAnchorB=new H,n.m_localAnchorC=new H,n.m_localAnchorD=new H,n.m_localAxisC=new H,n.m_localAxisD=new H,n.m_referenceAngleA=0,n.m_referenceAngleB=0,n.m_constant=0,n.m_ratio=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_indexC=0,n.m_indexD=0,n.m_lcA=new H,n.m_lcB=new H,n.m_lcC=new H,n.m_lcD=new H,n.m_mA=0,n.m_mB=0,n.m_mC=0,n.m_mD=0,n.m_iA=0,n.m_iB=0,n.m_iC=0,n.m_iD=0,n.m_JvAC=new H,n.m_JvBD=new H,n.m_JwA=0,n.m_JwB=0,n.m_JwC=0,n.m_JwD=0,n.m_mass=0,n.m_qA=new R,n.m_qB=new R,n.m_qC=new R,n.m_qD=new R,n.m_lalcA=new H,n.m_lalcB=new H,n.m_lalcC=new H,n.m_lalcD=new H,n.m_joint1=t.joint1,n.m_joint2=t.joint2,n.m_typeA=n.m_joint1.GetType(),n.m_typeB=n.m_joint2.GetType(),n.m_bodyC=n.m_joint1.GetBodyA(),n.m_bodyA=n.m_joint1.GetBodyB(),n.m_bodyA.m_xf),s=n.m_bodyA.m_sweep.a,a=n.m_bodyC.m_xf,o=n.m_bodyC.m_sweep.a,a=(r=n.m_typeA===W.b2JointType.e_revoluteJoint?(i=t.joint1,n.m_localAnchorC.Copy(i.m_localAnchorA),n.m_localAnchorA.Copy(i.m_localAnchorB),n.m_referenceAngleA=i.m_referenceAngle,n.m_localAxisC.SetZero(),s-o-n.m_referenceAngleA):(e=t.joint1,n.m_localAnchorC.Copy(e.m_localAnchorA),n.m_localAnchorA.Copy(e.m_localAnchorB),n.m_referenceAngleA=e.m_referenceAngle,n.m_localAxisC.Copy(e.m_localXAxisA),s=n.m_localAnchorC,o=R.MulTRV(a.q,H.AddVV(R.MulRV(r.q,n.m_localAnchorA,H.s_t0),H.SubVV(r.p,a.p,H.s_t1),H.s_t0),H.s_t0),H.DotVV(H.SubVV(o,s,H.s_t0),n.m_localAxisC)),n.m_bodyD=n.m_joint2.GetBodyA(),n.m_bodyB=n.m_joint2.GetBodyB(),n.m_bodyB.m_xf),o=n.m_bodyB.m_sweep.a,s=n.m_bodyD.m_xf,l=n.m_bodyD.m_sweep.a;return l=n.m_typeB===W.b2JointType.e_revoluteJoint?(i=t.joint2,n.m_localAnchorD.Copy(i.m_localAnchorA),n.m_localAnchorB.Copy(i.m_localAnchorB),n.m_referenceAngleB=i.m_referenceAngle,n.m_localAxisD.SetZero(),o-l-n.m_referenceAngleB):(e=t.joint2,n.m_localAnchorD.Copy(e.m_localAnchorA),n.m_localAnchorB.Copy(e.m_localAnchorB),n.m_referenceAngleB=e.m_referenceAngle,n.m_localAxisD.Copy(e.m_localXAxisA),i=n.m_localAnchorD,o=R.MulTRV(s.q,H.AddVV(R.MulRV(a.q,n.m_localAnchorB,H.s_t0),H.SubVV(a.p,s.p,H.s_t1),H.s_t0),H.s_t0),H.DotVV(H.SubVV(o,i,H.s_t0),n.m_localAxisD)),n.m_ratio=f(t.ratio,1),n.m_constant=r+n.m_ratio*l,n.m_impulse=0,n}function yr(){var t=En.call(this,W.b2JointType.e_gearJoint)||this;return t.ratio=1,t}function gr(t){var e=Mn.call(this,t)||this;return e.m_localAnchorA=new H,e.m_localAnchorB=new H,e.m_linearImpulse=new H,e.m_angularImpulse=0,e.m_maxForce=0,e.m_maxTorque=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new H,e.m_rB=new H,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_linearMass=new ot,e.m_angularMass=0,e.m_qA=new R,e.m_qB=new R,e.m_lalcA=new H,e.m_lalcB=new H,e.m_K=new ot,e.m_localAnchorA.Copy(t.localAnchorA),e.m_localAnchorB.Copy(t.localAnchorB),e.m_linearImpulse.SetZero(),e.m_maxForce=f(t.maxForce,0),e.m_maxTorque=f(t.maxTorque,0),e.m_linearMass.SetZero(),e}function vr(){var t=Dn.call(this,W.b2JointType.e_frictionJoint)||this;return t.localAnchorA=new H,t.localAnchorB=new H,t.maxForce=0,t.maxTorque=0,t}function br(t){var e=Bn.call(this,t)||this,i=(e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_impulse=0,e.m_targetArea=0,e.m_bodies=t.bodies,e.m_frequencyHz=f(t.frequencyHz,0),e.m_dampingRatio=f(t.dampingRatio,0),e.m_targetLengths=U(t.bodies.length),e.m_normals=H.MakeArray(t.bodies.length),e.m_joints=[],e.m_deltas=H.MakeArray(t.bodies.length),e.m_delta=new H,new Fn);i.frequencyHz=e.m_frequencyHz,i.dampingRatio=e.m_dampingRatio;for(var n=e.m_targetArea=0;n<e.m_bodies.length;++n){var r=e.m_bodies[n],s=e.m_bodies[(n+1)%e.m_bodies.length],a=r.GetWorldCenter(),o=s.GetWorldCenter();e.m_targetLengths[n]=H.DistanceVV(a,o),e.m_targetArea+=H.CrossVV(a,o),i.Initialize(r,s,a,o),e.m_joints[n]=r.GetWorld().CreateJoint(i)}return e.m_targetArea*=.5,e}function xr(){var t=In.call(this,W.b2JointType.e_areaJoint)||this;return t.bodies=[],t.frequencyHz=0,t.dampingRatio=0,t}function u(t){var e=Pn.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_bias=0,e.m_localAnchorA=new H,e.m_localAnchorB=new H,e.m_gamma=0,e.m_impulse=0,e.m_length=0,e.m_indexA=0,e.m_indexB=0,e.m_u=new H,e.m_rA=new H,e.m_rB=new H,e.m_localCenterA=new H,e.m_localCenterB=new H,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_qA=new R,e.m_qB=new R,e.m_lalcA=new H,e.m_lalcB=new H,e.m_frequencyHz=f(t.frequencyHz,0),e.m_dampingRatio=f(t.dampingRatio,0),e.m_localAnchorA.Copy(t.localAnchorA),e.m_localAnchorB.Copy(t.localAnchorB),e.m_length=t.length,e}function Ar(){var t=Rn.call(this,W.b2JointType.e_distanceJoint)||this;return t.localAnchorA=new H,t.localAnchorB=new H,t.length=1,t.frequencyHz=0,t.dampingRatio=0,t}function Cr(t){this.m_type=W.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=t.type,this.m_edgeA=new On(this,t.bodyB),this.m_edgeB=new On(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=f(t.collideConnected,!1),this.m_userData=t.userData}function Tr(){this.linear=new H,this.angularA=0,this.angularB=0}function Sr(t,e){return Q(t*e)}function wr(t,e){return e<t?t:e}var Er,Mr,Dr,Br,Ir,Pr,Rr,Or=function(t){this.prev=null,this.next=null,this.contact=t},Lr=(n.prototype.GetManifold=function(){return this.m_manifold},n.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)},n.prototype.IsTouching=function(){return this.m_touchingFlag},n.prototype.SetEnabled=function(t){this.m_enabledFlag=t},n.prototype.IsEnabled=function(){return this.m_enabledFlag},n.prototype.GetNext=function(){return this.m_next},n.prototype.GetFixtureA=function(){return this.m_fixtureA},n.prototype.GetChildIndexA=function(){return this.m_indexA},n.prototype.GetFixtureB=function(){return this.m_fixtureB},n.prototype.GetChildIndexB=function(){return this.m_indexB},n.prototype.FlagForFiltering=function(){this.m_filterFlag=!0},n.prototype.SetFriction=function(t){this.m_friction=t},n.prototype.GetFriction=function(){return this.m_friction},n.prototype.ResetFriction=function(){this.m_friction=Sr(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},n.prototype.SetRestitution=function(t){this.m_restitution=t},n.prototype.GetRestitution=function(){return this.m_restitution},n.prototype.ResetRestitution=function(){this.m_restitution=wr(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},n.prototype.SetTangentSpeed=function(t){this.m_tangentSpeed=t},n.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},n.prototype.Reset=function(t,e,i,n){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,delete this.m_nodeA.contact,this.m_nodeA.prev=null,this.m_nodeA.next=null,delete this.m_nodeA.other,delete this.m_nodeB.contact,this.m_nodeB.prev=null,this.m_nodeB.next=null,delete this.m_nodeB.other,this.m_toiCount=0,this.m_friction=Sr(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=wr(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},n.prototype.Update=function(t){var e=this.m_oldManifold,e=(this.m_oldManifold=this.m_manifold,this.m_manifold=e,!(this.m_enabledFlag=!0)),i=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),n=n||r,r=this.m_fixtureA.GetBody(),s=this.m_fixtureB.GetBody(),a=r.GetTransform(),o=s.GetTransform();if(n){var l=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape(),e=we(l,this.m_indexA,h,this.m_indexB,a,o);this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,a,o),e=0<this.m_manifold.pointCount;for(var c=0;c<this.m_manifold.pointCount;++c){var u=this.m_manifold.points[c];u.normalImpulse=0,u.tangentImpulse=0;for(var _=u.id,d=0;d<this.m_oldManifold.pointCount;++d){var f=this.m_oldManifold.points[d];if(f.id.key===_.key){u.normalImpulse=f.normalImpulse,u.tangentImpulse=f.tangentImpulse;break}}}e!==i&&(r.SetAwake(!0),s.SetAwake(!0))}this.m_touchingFlag=e,!i&&e&&t&&t.BeginContact(this),i&&!e&&t&&t.EndContact(this),!n&&e&&t&&t.PreSolve(this,this.m_oldManifold)},n.prototype.ComputeTOI=function(t,e){var i=n.ComputeTOI_s_input,t=(i.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),i.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=V,n.ComputeTOI_s_output);return ti(t,i),t.t},n.ComputeTOI_s_input=new Ge,n.ComputeTOI_s_output=new Ue,n),Fr=(A(Ps,Rr=Lr),Ps.Create=function(t){return new Ps},Ps.Destroy=function(t,e){},Ps.prototype.Reset=function(t,e,i,n){Rr.prototype.Reset.call(this,t,e,i,n)},Ps.prototype.Evaluate=function(t,e,i){ni(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Ps),Vr=(A(Is,Pr=Lr),Is.Create=function(t){return new Is},Is.Destroy=function(t,e){},Is.prototype.Reset=function(t,e,i,n){Pr.prototype.Reset.call(this,t,e,i,n)},Is.prototype.Evaluate=function(t,e,i){Bi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Is),Nr=(A(Bs,Ir=Lr),Bs.Create=function(t){return new Bs},Bs.Destroy=function(t,e){},Bs.prototype.Reset=function(t,e,i,n){Ir.prototype.Reset.call(this,t,e,i,n)},Bs.prototype.Evaluate=function(t,e,i){oi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Bs),kr=(A(Ds,Br=Lr),Ds.Create=function(t){return new Ds},Ds.Destroy=function(t,e){},Ds.prototype.Reset=function(t,e,i,n){Br.prototype.Reset.call(this,t,e,i,n)},Ds.prototype.Evaluate=function(t,e,i){ki(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Ds),zr=(A(Ms,Dr=Lr),Ms.Create=function(t){return new Ms},Ms.Destroy=function(t,e){},Ms.prototype.Reset=function(t,e,i,n){Dr.prototype.Reset.call(this,t,e,i,n)},Ms.prototype.Evaluate=function(t,e,i){Wi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Ms),Gr=(A(Es,Mr=Lr),Es.Create=function(t){return new Es},Es.Destroy=function(t,e){},Es.prototype.Reset=function(t,e,i,n){Mr.prototype.Reset.call(this,t,e,i,n)},Es.prototype.Evaluate=function(t,e,i){var n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape(),s=Es.Evaluate_s_edge;n.GetChildEdge(s,this.m_indexA),ki(t,s,e,r,i)},Es.Evaluate_s_edge=new $i,Es),Ur=(A(ws,Er=Lr),ws.Create=function(t){return new ws},ws.Destroy=function(t,e){},ws.prototype.Reset=function(t,e,i,n){Er.prototype.Reset.call(this,t,e,i,n)},ws.prototype.Evaluate=function(t,e,i){var n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape(),s=ws.Evaluate_s_edge;n.GetChildEdge(s,this.m_indexA),Wi(t,s,e,r,i)},ws.Evaluate_s_edge=new $i,ws),jr=function(){this.createFcn=null,this.destroyFcn=null,this.primary=!1},Wr=(Ss.prototype.AddType=function(e,t,i,n){var r=this,s=G(256,function(t){return e(r.m_allocator)});function a(t){return s.pop()||e(t)}function o(t,e){s.push(t)}this.m_registers[i][n].createFcn=a,this.m_registers[i][n].destroyFcn=o,this.m_registers[i][n].primary=!0,i!==n&&(this.m_registers[n][i].createFcn=a,this.m_registers[n][i].destroyFcn=o,this.m_registers[n][i].primary=!1)},Ss.prototype.InitializeRegisters=function(){this.m_registers=[];for(var t=0;t<W.b2ShapeType.e_shapeTypeCount;t++){this.m_registers[t]=[];for(var e=0;e<W.b2ShapeType.e_shapeTypeCount;e++)this.m_registers[t][e]=new jr}this.AddType(Fr.Create,Fr.Destroy,W.b2ShapeType.e_circleShape,W.b2ShapeType.e_circleShape),this.AddType(Nr.Create,Nr.Destroy,W.b2ShapeType.e_polygonShape,W.b2ShapeType.e_circleShape),this.AddType(Vr.Create,Vr.Destroy,W.b2ShapeType.e_polygonShape,W.b2ShapeType.e_polygonShape),this.AddType(kr.Create,kr.Destroy,W.b2ShapeType.e_edgeShape,W.b2ShapeType.e_circleShape),this.AddType(zr.Create,zr.Destroy,W.b2ShapeType.e_edgeShape,W.b2ShapeType.e_polygonShape),this.AddType(Gr.Create,Gr.Destroy,W.b2ShapeType.e_chainShape,W.b2ShapeType.e_circleShape),this.AddType(Ur.Create,Ur.Destroy,W.b2ShapeType.e_chainShape,W.b2ShapeType.e_polygonShape)},Ss.prototype.Create=function(t,e,i,n){var r=t.GetType(),s=i.GetType(),r=this.m_registers[r][s];return r.createFcn?(s=r.createFcn(this.m_allocator),r.primary?s.Reset(t,e,i,n):s.Reset(i,n,t,e),s):null},Ss.prototype.Destroy=function(t){var e=t.m_fixtureA,i=t.m_fixtureB,e=(0<t.m_manifold.pointCount&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),e.GetType()),i=i.GetType(),e=this.m_registers[e][i];e.destroyFcn&&e.destroyFcn(t,this.m_allocator)},Ss),Hr=(Ts.prototype.SayGoodbyeJoint=function(t){},Ts.prototype.SayGoodbyeFixture=function(t){},Ts.prototype.SayGoodbyeParticleGroup=function(t){},Ts.prototype.SayGoodbyeParticle=function(t,e){},Ts),Xr=(Cs.prototype.ShouldCollide=function(t,e){var i=t.GetBody(),n=e.GetBody();if(n.GetType()===W.b2BodyType.b2_staticBody&&i.GetType()===W.b2BodyType.b2_staticBody)return!1;if(!n.ShouldCollideConnected(i))return!1;n=t.GetFilterData(),i=e.GetFilterData();return n.groupIndex===i.groupIndex&&0!==n.groupIndex?0<n.groupIndex:0!=(n.maskBits&i.categoryBits)&&0!=(n.categoryBits&i.maskBits)},Cs.prototype.ShouldCollideFixtureParticle=function(t,e,i){return!0},Cs.prototype.ShouldCollideParticleParticle=function(t,e,i){return!0},Cs.b2_defaultFilter=new Cs,Cs),Yr=function(){this.normalImpulses=U(2),this.tangentImpulses=U(2),this.count=0},qr=(As.prototype.BeginContact=function(t){},As.prototype.EndContact=function(t){},As.prototype.BeginContactFixtureParticle=function(t,e){},As.prototype.EndContactFixtureParticle=function(t,e){},As.prototype.BeginContactParticleParticle=function(t,e){},As.prototype.EndContactParticleParticle=function(t,e){},As.prototype.PreSolve=function(t,e){},As.prototype.PostSolve=function(t,e){},As.b2_defaultListener=new As,As),Jr=(xs.prototype.ReportFixture=function(t){return!0},xs.prototype.ReportParticle=function(t,e){return!1},xs.prototype.ShouldQueryParticleSystem=function(t){return!0},xs),Zr=(bs.prototype.ReportFixture=function(t,e,i,n){return n},bs.prototype.ReportParticle=function(t,e,i,n,r){return 0},bs.prototype.ShouldQueryParticleSystem=function(t){return!0},bs),Kr=(vs.prototype.AddPair=function(t,e){var i=t.fixture,n=e.fixture,r=t.childIndex,s=e.childIndex,a=i.GetBody(),t=n.GetBody();if(a!==t){for(var o=t.GetContactList();o;){if(o.other===a){var l=o.contact.GetFixtureA(),h=o.contact.GetFixtureB(),c=o.contact.GetChildIndexA(),u=o.contact.GetChildIndexB();if(l===i&&h===n&&c===r&&u===s)return;if(l===n&&h===i&&c===s&&u===r)return}o=o.next}this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,n)||null!==(e=this.m_contactFactory.Create(i,r,n,s))&&(i=e.GetFixtureA(),n=e.GetFixtureB(),r=e.GetChildIndexA(),s=e.GetChildIndexB(),a=i.m_body,t=n.m_body,e.m_prev=null,e.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=e),((this.m_contactList=e).m_nodeA.contact=e).m_nodeA.other=t,e.m_nodeA.prev=null,e.m_nodeA.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=e.m_nodeA),a.m_contactList=e.m_nodeA,(e.m_nodeB.contact=e).m_nodeB.other=a,e.m_nodeB.prev=null,e.m_nodeB.next=t.m_contactList,null!==t.m_contactList&&(t.m_contactList.prev=e.m_nodeB),t.m_contactList=e.m_nodeB,i.IsSensor()||n.IsSensor()||(a.SetAwake(!0),t.SetAwake(!0)),++this.m_contactCount)}},vs.prototype.FindNewContacts=function(){var i=this;this.m_broadPhase.UpdatePairs(function(t,e){i.AddPair(t,e)})},vs.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),e=e.GetBody(),i=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===e.m_contactList&&(e.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===i.m_contactList&&(i.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},vs.prototype.Collide=function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=t.GetChildIndexA(),r=t.GetChildIndexB(),s=e.GetBody(),a=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){t=(o=t).m_next,this.Destroy(o);continue}t.m_filterFlag=!1}var o,s=s.IsAwake()&&s.m_type!==W.b2BodyType.b2_staticBody,a=a.IsAwake()&&a.m_type!==W.b2BodyType.b2_staticBody;s||a?(s=e.m_proxies[n].treeNode,a=i.m_proxies[r].treeNode,xe(s.aabb,a.aabb)?(t.Update(this.m_contactListener),t=t.m_next):(t=(o=t).m_next,this.Destroy(o))):t=t.m_next}},vs),Qr=(gs.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},gs),$r=(ys.prototype.Copy=function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this},ys),ts=(ms.MakeArray=function(t){return G(t,function(t){return new ms})},ms),es=(ps.MakeArray=function(t){return G(t,function(t){return new ps})},ps),is=function(){this.step=new $r},ns=(fs.MakeArray=function(t){return G(t,function(t){return new fs})},fs),rs=(ds.MakeArray=function(t){return G(t,function(t){return new ds})},ds),ss=(_s.MakeArray=function(t){return G(t,function(t){return new _s})},_s),as=function(){this.step=new $r,this.count=0,this.allocator=null},os=(us.prototype.Initialize=function(t,e,i,n){var r=us.Initialize_s_pointA,s=us.Initialize_s_pointB,a=us.Initialize_s_planePoint,o=us.Initialize_s_clipPoint;switch(t.type){case W.b2ManifoldType.e_circles:O.MulXV(e,t.localPoint,r),O.MulXV(i,t.localPoints[0],s),H.SubVV(s,r,this.normal).SelfNormalize(),H.MidVV(r,s,this.point),this.separation=H.DotVV(H.SubVV(s,r,H.s_t0),this.normal)-t.radiusA-t.radiusB;break;case W.b2ManifoldType.e_faceA:R.MulRV(e.q,t.localNormal,this.normal),O.MulXV(e,t.localPoint,a),O.MulXV(i,t.localPoints[n],o),this.separation=H.DotVV(H.SubVV(o,a,H.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(o);break;case W.b2ManifoldType.e_faceB:R.MulRV(i.q,t.localNormal,this.normal),O.MulXV(i,t.localPoint,a),O.MulXV(e,t.localPoints[n],o),this.separation=H.DotVV(H.SubVV(o,a,H.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(o),this.normal.SelfNeg()}},us.Initialize_s_pointA=new H,us.Initialize_s_pointB=new H,us.Initialize_s_planePoint=new H,us.Initialize_s_clipPoint=new H,us),ls=(L.prototype.Initialize=function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=P(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new ss;if(this.m_velocityConstraints.length<this.m_count)for(e=P(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<e;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new rs;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var i=0;i<this.m_count;++i){var n=this.m_contacts[i],r=n.m_fixtureA,s=n.m_fixtureB,a=r.GetShape(),o=s.GetShape(),a=a.m_radius,o=o.m_radius,r=r.GetBody(),s=s.GetBody(),l=n.GetManifold(),h=l.pointCount,c=this.m_velocityConstraints[i],u=(c.friction=n.m_friction,c.restitution=n.m_restitution,c.tangentSpeed=n.m_tangentSpeed,c.indexA=r.m_islandIndex,c.indexB=s.m_islandIndex,c.invMassA=r.m_invMass,c.invMassB=s.m_invMass,c.invIA=r.m_invI,c.invIB=s.m_invI,c.contactIndex=i,c.pointCount=h,c.K.SetZero(),c.normalMass.SetZero(),this.m_positionConstraints[i]);u.indexA=r.m_islandIndex,u.indexB=s.m_islandIndex,u.invMassA=r.m_invMass,u.invMassB=s.m_invMass,u.localCenterA.Copy(r.m_sweep.localCenter),u.localCenterB.Copy(s.m_sweep.localCenter),u.invIA=r.m_invI,u.invIB=s.m_invI,u.localNormal.Copy(l.localNormal),u.localPoint.Copy(l.localPoint),u.pointCount=h,u.radiusA=a,u.radiusB=o,u.type=l.type;for(var _=0;_<h;++_){var d=l.points[_],f=c.points[_];this.m_step.warmStarting?(f.normalImpulse=this.m_step.dtRatio*d.normalImpulse,f.tangentImpulse=this.m_step.dtRatio*d.tangentImpulse):(f.normalImpulse=0,f.tangentImpulse=0),f.rA.SetZero(),f.rB.SetZero(),f.normalMass=0,f.tangentMass=0,f.velocityBias=0,u.localPoints[_].Copy(d.localPoint)}}return this},L.prototype.InitializeVelocityConstraints=function(){for(var t=L.InitializeVelocityConstraints_s_xfA,e=L.InitializeVelocityConstraints_s_xfB,i=L.InitializeVelocityConstraints_s_worldManifold,n=0;n<this.m_count;++n){var r=this.m_velocityConstraints[n],s=this.m_positionConstraints[n],a=s.radiusA,o=s.radiusB,l=this.m_contacts[r.contactIndex].GetManifold(),h=r.indexA,c=r.indexB,u=r.invMassA,_=r.invMassB,d=r.invIA,f=r.invIB,p=s.localCenterA,s=s.localCenterB,m=this.m_positions[h].c,y=this.m_positions[h].a,g=this.m_velocities[h].v,v=this.m_velocities[h].w,b=this.m_positions[c].c,h=this.m_positions[c].a,x=this.m_velocities[c].v,A=this.m_velocities[c].w;t.q.SetAngle(y),e.q.SetAngle(h),H.SubVV(m,R.MulRV(t.q,p,H.s_t0),t.p),H.SubVV(b,R.MulRV(e.q,s,H.s_t0),e.p),i.Initialize(l,t,a,e,o),r.normal.Copy(i.normal),H.CrossVOne(r.normal,r.tangent);for(var C=r.pointCount,T=0;T<C;++T){var S=r.points[T],w=(H.SubVV(i.points[T],m,S.rA),H.SubVV(i.points[T],b,S.rB),H.CrossVV(S.rA,r.normal)),E=H.CrossVV(S.rB,r.normal),w=u+_+d*w*w+f*E*E,E=(S.normalMass=0<w?1/w:0,r.tangent),w=H.CrossVV(S.rA,E),E=H.CrossVV(S.rB,E),w=u+_+d*w*w+f*E*E,E=(S.tangentMass=0<w?1/w:0,S.velocityBias=0,H.DotVV(r.normal,H.SubVV(H.AddVCrossSV(x,A,S.rB,H.s_t0),H.AddVCrossSV(g,v,S.rA,H.s_t1),H.s_t0)));E<-1&&(S.velocityBias+=-r.restitution*E)}r.pointCount}},L.prototype.WarmStart=function(){for(var t=L.WarmStart_s_P,e=0;e<this.m_count;++e){for(var i=this.m_velocityConstraints[e],n=i.indexA,r=i.indexB,s=i.invMassA,a=i.invIA,o=i.invMassB,l=i.invIB,h=i.pointCount,c=this.m_velocities[n].v,u=this.m_velocities[n].w,_=this.m_velocities[r].v,d=this.m_velocities[r].w,f=i.normal,p=i.tangent,m=0;m<h;++m){var y=i.points[m];H.AddVV(H.MulSV(y.normalImpulse,f,H.s_t0),H.MulSV(y.tangentImpulse,p,H.s_t1),t),u-=a*H.CrossVV(y.rA,t),c.SelfMulSub(s,t),d+=l*H.CrossVV(y.rB,t),_.SelfMulAdd(o,t)}this.m_velocities[n].w=u,this.m_velocities[r].w=d}},L.prototype.SolveVelocityConstraints=function(){for(var t=L.SolveVelocityConstraints_s_dv,e=L.SolveVelocityConstraints_s_P,i=0;i<this.m_count;++i){for(var n=this.m_velocityConstraints[i],r=n.indexA,s=n.indexB,a=n.invMassA,o=n.invIA,l=n.invMassB,h=n.invIB,c=n.pointCount,u=this.m_velocities[r].v,_=this.m_velocities[r].w,d=this.m_velocities[s].v,f=this.m_velocities[s].w,p=n.normal,m=n.tangent,y=n.friction,g=0;g<c;++g){var v=n.points[g],b=(H.SubVV(H.AddVCrossSV(d,f,v.rB,H.s_t0),H.AddVCrossSV(u,_,v.rA,H.s_t1),t),H.DotVV(t,m)-n.tangentSpeed),x=v.tangentMass*-b,b=y*v.normalImpulse,x=(A=q(v.tangentImpulse+x,-b,b))-v.tangentImpulse;v.tangentImpulse=A,H.MulSV(x,m,e),u.SelfMulSub(a,e),_-=o*H.CrossVV(v.rA,e),d.SelfMulAdd(l,e),f+=h*H.CrossVV(v.rB,e)}for(n.pointCount,g=0;g<c;++g){v=n.points[g],H.SubVV(H.AddVCrossSV(d,f,v.rB,H.s_t0),H.AddVCrossSV(u,_,v.rA,H.s_t1),t);var A,C=H.DotVV(t,p);x=-v.normalMass*(C-v.velocityBias),x=(A=P(v.normalImpulse+x,0))-v.normalImpulse,v.normalImpulse=A,H.MulSV(x,p,e),u.SelfMulSub(a,e),_-=o*H.CrossVV(v.rA,e),d.SelfMulAdd(l,e),f+=h*H.CrossVV(v.rB,e)}this.m_velocities[r].w=_,this.m_velocities[s].w=f}},L.prototype.StoreImpulses=function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),n=0;n<e.pointCount;++n)i.points[n].normalImpulse=e.points[n].normalImpulse,i.points[n].tangentImpulse=e.points[n].tangentImpulse},L.prototype.SolvePositionConstraints=function(){for(var t=L.SolvePositionConstraints_s_xfA,e=L.SolvePositionConstraints_s_xfB,i=L.SolvePositionConstraints_s_psm,n=L.SolvePositionConstraints_s_rA,r=L.SolvePositionConstraints_s_rB,s=L.SolvePositionConstraints_s_P,a=0,o=0;o<this.m_count;++o){for(var l=this.m_positionConstraints[o],h=l.indexA,c=l.indexB,u=l.localCenterA,_=l.invMassA,d=l.invIA,f=l.localCenterB,p=l.invMassB,m=l.invIB,y=l.pointCount,g=this.m_positions[h].c,v=this.m_positions[h].a,b=this.m_positions[c].c,x=this.m_positions[c].a,A=0;A<y;++A){t.q.SetAngle(v),e.q.SetAngle(x),H.SubVV(g,R.MulRV(t.q,u,H.s_t0),t.p),H.SubVV(b,R.MulRV(e.q,f,H.s_t0),e.p),i.Initialize(l,t,e,A);var C=i.normal,T=i.point,S=i.separation,T=(H.SubVV(T,g,n),H.SubVV(T,b,r),a=I(a,S),q(.2*(S+V),-.2,0)),S=H.CrossVV(n,C),w=H.CrossVV(r,C),S=_+p+d*S*S+m*w*w;H.MulSV(0<S?-T/S:0,C,s),g.SelfMulSub(_,s),v-=d*H.CrossVV(n,s),b.SelfMulAdd(p,s),x+=m*H.CrossVV(r,s)}this.m_positions[h].a=v,this.m_positions[c].a=x}return-.024<a},L.prototype.SolveTOIPositionConstraints=function(t,e){for(var i=L.SolveTOIPositionConstraints_s_xfA,n=L.SolveTOIPositionConstraints_s_xfB,r=L.SolveTOIPositionConstraints_s_psm,s=L.SolveTOIPositionConstraints_s_rA,a=L.SolveTOIPositionConstraints_s_rB,o=L.SolveTOIPositionConstraints_s_P,l=0,h=0;h<this.m_count;++h){var c=this.m_positionConstraints[h],u=c.indexA,_=c.indexB,d=c.localCenterA,f=c.localCenterB,p=c.pointCount,m=0,y=0,g=(u!==t&&u!==e||(m=c.invMassA,y=c.invIA),0),v=0;_!==t&&_!==e||(g=c.invMassB,v=c.invIB);for(var b=this.m_positions[u].c,x=this.m_positions[u].a,A=this.m_positions[_].c,C=this.m_positions[_].a,T=0;T<p;++T){i.q.SetAngle(x),n.q.SetAngle(C),H.SubVV(b,R.MulRV(i.q,d,H.s_t0),i.p),H.SubVV(A,R.MulRV(n.q,f,H.s_t0),n.p),r.Initialize(c,i,n,T);var S=r.normal,w=r.point,E=r.separation,w=(H.SubVV(w,b,s),H.SubVV(w,A,a),l=I(l,E),q(.75*(E+V),-.2,0)),E=H.CrossVV(s,S),M=H.CrossVV(a,S),E=m+g+y*E*E+v*M*M;H.MulSV(0<E?-w/E:0,S,o),b.SelfMulSub(m,o),x-=y*H.CrossVV(s,o),A.SelfMulAdd(g,o),C+=v*H.CrossVV(a,o)}this.m_positions[u].a=x,this.m_positions[_].a=C}return-.012<=l},L.InitializeVelocityConstraints_s_xfA=new O,L.InitializeVelocityConstraints_s_xfB=new O,L.InitializeVelocityConstraints_s_worldManifold=new ce,L.WarmStart_s_P=new H,L.SolveVelocityConstraints_s_dv=new H,L.SolveVelocityConstraints_s_dv1=new H,L.SolveVelocityConstraints_s_dv2=new H,L.SolveVelocityConstraints_s_P=new H,L.SolveVelocityConstraints_s_a=new H,L.SolveVelocityConstraints_s_b=new H,L.SolveVelocityConstraints_s_x=new H,L.SolveVelocityConstraints_s_d=new H,L.SolveVelocityConstraints_s_P1=new H,L.SolveVelocityConstraints_s_P2=new H,L.SolveVelocityConstraints_s_P1P2=new H,L.SolvePositionConstraints_s_xfA=new O,L.SolvePositionConstraints_s_xfB=new O,L.SolvePositionConstraints_s_psm=new os,L.SolvePositionConstraints_s_rA=new H,L.SolvePositionConstraints_s_rB=new H,L.SolvePositionConstraints_s_P=new H,L.SolveTOIPositionConstraints_s_xfA=new O,L.SolveTOIPositionConstraints_s_xfB=new O,L.SolveTOIPositionConstraints_s_psm=new os,L.SolveTOIPositionConstraints_s_rA=new H,L.SolveTOIPositionConstraints_s_rB=new H,L.SolveTOIPositionConstraints_s_P=new H,L),hs=(cs.prototype.Initialize=function(t,e,i,n,r){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=n,this.m_listener=r,this.m_positions.length<t)for(var s=P(2*this.m_positions.length,t);this.m_positions.length<s;)this.m_positions[this.m_positions.length]=new ts;if(this.m_velocities.length<t)for(s=P(2*this.m_velocities.length,t);this.m_velocities.length<s;)this.m_velocities[this.m_velocities.length]=new es},cs.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},cs.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},cs.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},cs.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},cs.prototype.Solve=function(t,e,i,n){for(var r=cs.s_timer.Reset(),s=e.dt,a=0;a<this.m_bodyCount;++a){var o=this.m_bodies[a],l=(this.m_positions[a].c.Copy(o.m_sweep.c),o.m_sweep.a),h=this.m_velocities[a].v.Copy(o.m_linearVelocity),c=o.m_angularVelocity;o.m_sweep.c0.Copy(o.m_sweep.c),o.m_sweep.a0=o.m_sweep.a,o.m_type===W.b2BodyType.b2_dynamicBody&&(h.x+=s*(o.m_gravityScale*i.x+o.m_invMass*o.m_force.x),h.y+=s*(o.m_gravityScale*i.y+o.m_invMass*o.m_force.y),c+=s*o.m_invI*o.m_torque,h.SelfMul(1/(1+s*o.m_linearDamping)),c*=1/(1+s*o.m_angularDamping)),this.m_positions[a].a=l,this.m_velocities[a].w=c}r.Reset();var u=cs.s_solverData,_=(u.step.Copy(e),u.positions=this.m_positions,u.velocities=this.m_velocities,cs.s_contactSolverDef),d=(_.step.Copy(e),_.contacts=this.m_contacts,_.count=this.m_contactCount,_.positions=this.m_positions,_.velocities=this.m_velocities,_.allocator=this.m_allocator,cs.s_contactSolver.Initialize(_));for(d.InitializeVelocityConstraints(),e.warmStarting&&d.WarmStart(),a=0;a<this.m_jointCount;++a)this.m_joints[a].InitVelocityConstraints(u);for(t.solveInit=r.GetMilliseconds(),r.Reset(),a=0;a<e.velocityIterations;++a){for(var f=0;f<this.m_jointCount;++f)this.m_joints[f].SolveVelocityConstraints(u);d.SolveVelocityConstraints()}for(d.StoreImpulses(),t.solveVelocity=r.GetMilliseconds(),a=0;a<this.m_bodyCount;++a){var p,m=this.m_positions[a].c,y=(l=this.m_positions[a].a,h=this.m_velocities[a].v,c=this.m_velocities[a].w,H.MulSV(s,h,cs.s_translation)),y=(4<H.DotVV(y,y)&&(p=2/y.Length(),h.SelfMul(p)),s*c);2.4674011002726646<y*y&&(c*=p=1.570796326795/D(y)),m.x+=s*h.x,m.y+=s*h.y,l+=s*c,this.m_positions[a].a=l,this.m_velocities[a].w=c}r.Reset();var g=!1;for(a=0;a<e.positionIterations;++a){for(var v=d.SolvePositionConstraints(),b=!0,f=0;f<this.m_jointCount;++f)var x=this.m_joints[f].SolvePositionConstraints(u),b=b&&x;if(v&&b){g=!0;break}}for(a=0;a<this.m_bodyCount;++a){var A=this.m_bodies[a];A.m_sweep.c.Copy(this.m_positions[a].c),A.m_sweep.a=this.m_positions[a].a,A.m_linearVelocity.Copy(this.m_velocities[a].v),A.m_angularVelocity=this.m_velocities[a].w,A.SynchronizeTransform()}if(t.solvePosition=r.GetMilliseconds(),this.Report(d.m_velocityConstraints),n){for(var C=B,a=0;a<this.m_bodyCount;++a)(o=this.m_bodies[a]).GetType()!==W.b2BodyType.b2_staticBody&&(C=!o.m_autoSleepFlag||.0012184696791469947<o.m_angularVelocity*o.m_angularVelocity||1e-4<H.DotVV(o.m_linearVelocity,o.m_linearVelocity)?o.m_sleepTime=0:(o.m_sleepTime+=s,I(C,o.m_sleepTime)));if(.5<=C&&g)for(a=0;a<this.m_bodyCount;++a)(o=this.m_bodies[a]).SetAwake(!1)}},cs.prototype.SolveTOI=function(t,e,i){for(var n=0;n<this.m_bodyCount;++n){var r=this.m_bodies[n];this.m_positions[n].c.Copy(r.m_sweep.c),this.m_positions[n].a=r.m_sweep.a,this.m_velocities[n].v.Copy(r.m_linearVelocity),this.m_velocities[n].w=r.m_angularVelocity}for(var s=cs.s_contactSolverDef,a=(s.contacts=this.m_contacts,s.count=this.m_contactCount,s.allocator=this.m_allocator,s.step.Copy(t),s.positions=this.m_positions,s.velocities=this.m_velocities,cs.s_contactSolver.Initialize(s)),n=0;n<t.positionIterations&&!a.SolveTOIPositionConstraints(e,i);++n);for(this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,a.InitializeVelocityConstraints(),n=0;n<t.velocityIterations;++n)a.SolveVelocityConstraints();var o=t.dt;for(n=0;n<this.m_bodyCount;++n){var l,h=this.m_positions[n].c,c=this.m_positions[n].a,u=this.m_velocities[n].v,_=this.m_velocities[n].w,d=H.MulSV(o,u,cs.s_translation),d=(4<H.DotVV(d,d)&&(l=2/d.Length(),u.SelfMul(l)),o*_),d=(2.4674011002726646<d*d&&(_*=l=1.570796326795/D(d)),h.SelfMulAdd(o,u),c+=o*_,this.m_positions[n].a=c,this.m_velocities[n].w=_,this.m_bodies[n]);d.m_sweep.c.Copy(h),d.m_sweep.a=c,d.m_linearVelocity.Copy(u),d.m_angularVelocity=_,d.SynchronizeTransform()}this.Report(a.m_velocityConstraints)},cs.prototype.Report=function(t){if(null!==this.m_listener)for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];if(i){var n=t[e],r=cs.s_impulse;r.count=n.pointCount;for(var s=0;s<n.pointCount;++s)r.normalImpulses[s]=n.points[s].normalImpulse,r.tangentImpulses[s]=n.points[s].tangentImpulse;this.m_listener.PostSolve(i,r)}}},cs.s_timer=new xt,cs.s_solverData=new is,cs.s_contactSolverDef=new as,cs.s_contactSolver=new ls,cs.s_translation=new H,cs.s_impulse=new Yr,cs);function cs(){this.m_allocator=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=ts.MakeArray(1024),this.m_velocities=es.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}function L(){this.m_step=new $r,this.m_allocator=null,this.m_positionConstraints=ss.MakeArray(1024),this.m_velocityConstraints=rs.MakeArray(1024),this.m_count=0}function us(){this.normal=new H,this.point=new H,this.separation=0}function _s(){this.localPoints=H.MakeArray(2),this.localNormal=new H,this.localPoint=new H,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new H,this.localCenterB=new H,this.invIA=0,this.invIB=0,this.type=W.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}function ds(){this.points=ns.MakeArray(2),this.normal=new H,this.tangent=new H,this.normalMass=new ot,this.K=new ot,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}function fs(){this.rA=new H,this.rB=new H,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function ps(){this.v=new H,this.w=0}function ms(){this.c=new H,this.a=0}function ys(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}function gs(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}function vs(){this.m_broadPhase=new Be,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=Xr.b2_defaultFilter,this.m_contactListener=qr.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=new Wr(this.m_allocator)}function bs(){}function xs(){}function As(){}function Cs(){}function Ts(){}function Ss(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}function ws(){return Er.call(this)||this}function Es(){return Mr.call(this)||this}function Ms(){return Dr.call(this)||this}function Ds(){return Br.call(this)||this}function Bs(){return Ir.call(this)||this}function Is(){return Pr.call(this)||this}function Ps(){return Rr.call(this)||this}function n(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new he,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new he,this.m_nodeA=new Or(this),this.m_nodeB=new Or(this)}(_=W.b2ParticleFlag||(W.b2ParticleFlag={}))[_.b2_waterParticle=0]="b2_waterParticle",_[_.b2_zombieParticle=2]="b2_zombieParticle",_[_.b2_wallParticle=4]="b2_wallParticle",_[_.b2_springParticle=8]="b2_springParticle",_[_.b2_elasticParticle=16]="b2_elasticParticle",_[_.b2_viscousParticle=32]="b2_viscousParticle",_[_.b2_powderParticle=64]="b2_powderParticle",_[_.b2_tensileParticle=128]="b2_tensileParticle",_[_.b2_colorMixingParticle=256]="b2_colorMixingParticle",_[_.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",_[_.b2_barrierParticle=1024]="b2_barrierParticle",_[_.b2_staticPressureParticle=2048]="b2_staticPressureParticle",_[_.b2_reactiveParticle=4096]="b2_reactiveParticle",_[_.b2_repulsiveParticle=8192]="b2_repulsiveParticle",_[_.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",_[_.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",_[_.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",_[_.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";var Rs=function(){this.flags=0,this.position=new H,this.velocity=new H,this.color=new ct(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null};function Os(t,e,i){return q(Math.ceil(Math.sqrt(t/(.01*e))*i),1,8)}Fs.prototype.GetIndex=function(){return this.m_index},Fs.prototype.SetIndex=function(t){this.m_index=t};var Ls=Fs;function Fs(){this.m_index=-1}(_=W.b2ParticleGroupFlag||(W.b2ParticleGroupFlag={}))[_.b2_solidParticleGroup=1]="b2_solidParticleGroup",_[_.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",_[_.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",_[_.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",_[_.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",_[_.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var Vs=function(){this.flags=0,this.groupFlags=0,this.position=new H,this.angle=0,this.linearVelocity=new H,this.angularVelocity=0,this.color=new ct,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},Ns=(h.prototype.GetNext=function(){return this.m_next},h.prototype.GetParticleSystem=function(){return this.m_system},h.prototype.GetParticleCount=function(){return this.m_lastIndex-this.m_firstIndex},h.prototype.GetBufferIndex=function(){return this.m_firstIndex},h.prototype.ContainsParticle=function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex},h.prototype.GetAllParticleFlags=function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t},h.prototype.GetGroupFlags=function(){return this.m_groupFlags},h.prototype.SetGroupFlags=function(t){t|=this.m_groupFlags&W.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,t)},h.prototype.GetMass=function(){return this.UpdateStatistics(),this.m_mass},h.prototype.GetInertia=function(){return this.UpdateStatistics(),this.m_inertia},h.prototype.GetCenter=function(){return this.UpdateStatistics(),this.m_center},h.prototype.GetLinearVelocity=function(){return this.UpdateStatistics(),this.m_linearVelocity},h.prototype.GetAngularVelocity=function(){return this.UpdateStatistics(),this.m_angularVelocity},h.prototype.GetTransform=function(){return this.m_transform},h.prototype.GetPosition=function(){return this.m_transform.p},h.prototype.GetAngle=function(){return this.m_transform.q.GetAngle()},h.prototype.GetLinearVelocityFromWorldPoint=function(t,e){var i=h.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),H.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,H.SubVV(t,this.m_center,i),e)},h.prototype.GetUserData=function(){return this.m_userData},h.prototype.SetUserData=function(t){this.m_userData=t},h.prototype.ApplyForce=function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)},h.prototype.ApplyLinearImpulse=function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)},h.prototype.DestroyParticles=function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)},h.prototype.UpdateStatistics=function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new H,e=new H;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var n,r=this.m_firstIndex;r<this.m_lastIndex;r++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[r]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[r]);for(0<this.m_mass&&(n=1/this.m_mass,this.m_center.SelfMul(n),this.m_linearVelocity.SelfMul(n)),this.m_inertia=0,this.m_angularVelocity=0,r=this.m_firstIndex;r<this.m_lastIndex;r++)H.SubVV(this.m_system.m_positionBuffer.data[r],this.m_center,t),H.SubVV(this.m_system.m_velocityBuffer.data[r],this.m_linearVelocity,e),this.m_inertia+=i*H.DotVV(t,t),this.m_angularVelocity+=i*H.CrossVV(t,e);0<this.m_inertia&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}},h.GetLinearVelocityFromWorldPoint_s_t0=new H,h),ks=(Us.prototype.Push=function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(0<this.m_capacity?(this.m_buffer.concat(G(this.m_capacity,function(t){return null})),this.m_capacity*=2):(this.m_buffer.concat(G(1,function(t){return null})),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++},Us.prototype.Pop=function(){this.m_buffer[this.m_front]=null,this.m_front++},Us.prototype.Empty=function(){return this.m_front===this.m_back},Us.prototype.Front=function(){var t=this.m_buffer[this.m_front];if(t)return t;throw new Error},Us),zs=(Gs.prototype.AddGenerator=function(t,e,i){var n=this.m_generatorBuffer[this.m_generatorCount++];n.center.Copy(t),n.tag=e,n.necessary=i},Gs.prototype.Generate=function(t,e){for(var i=1/t,n=new H(+B,+B),r=new H(-B,-B),s=0,a=0;a<this.m_generatorCount;a++)(y=this.m_generatorBuffer[a]).necessary&&(H.MinV(n,y.center,n),H.MaxV(r,y.center,r),++s);if(0===s)return this.m_countX=0,void(this.m_countY=0);n.x-=e,n.y-=e,r.x+=e,r.y+=e,this.m_countX=1+Math.floor(i*(r.x-n.x)),this.m_countY=1+Math.floor(i*(r.y-n.y)),this.m_diagram=[];for(var o,l,h,c,u,_,d=new ks(4*this.m_countX*this.m_countY),a=0;a<this.m_generatorCount;a++){(y=this.m_generatorBuffer[a]).center.SelfSub(n).SelfMul(i);var f=Math.floor(y.center.x),p=Math.floor(y.center.y);0<=f&&0<=p&&f<this.m_countX&&p<this.m_countY&&d.Push(new Gs.Task(f,p,f+p*this.m_countX,y))}for(;!d.Empty();){var f=(o=d.Front()).m_x,p=o.m_y,m=o.m_i,y=o.m_generator;d.Pop(),this.m_diagram[m]||(this.m_diagram[m]=y,0<f&&d.Push(new Gs.Task(f-1,p,m-1,y)),0<p&&d.Push(new Gs.Task(f,p-1,m-this.m_countX,y)),f<this.m_countX-1&&d.Push(new Gs.Task(f+1,p,m+1,y)),p<this.m_countY-1&&d.Push(new Gs.Task(f,p+1,m+this.m_countX,y)))}for(p=0;p<this.m_countY;p++)for(f=0;f<this.m_countX-1;f++)m=f+p*this.m_countX,(l=this.m_diagram[m])!==(h=this.m_diagram[m+1])&&(d.Push(new Gs.Task(f,p,m,h)),d.Push(new Gs.Task(f+1,p,m+1,l)));for(p=0;p<this.m_countY-1;p++)for(f=0;f<this.m_countX;f++)m=f+p*this.m_countX,(l=this.m_diagram[m])!==(h=this.m_diagram[m+this.m_countX])&&(d.Push(new Gs.Task(f,p,m,h)),d.Push(new Gs.Task(f,p+1,m+this.m_countX,l)));for(;!d.Empty();)f=(o=d.Front()).m_x,p=o.m_y,m=o.m_i,a=o.m_generator,d.Pop(),(l=this.m_diagram[m])!==(h=a)&&(c=l.center.x-f,u=l.center.y-p,(_=h.center.x-f)*_+(_=h.center.y-p)*_<c*c+u*u&&(this.m_diagram[m]=h,0<f&&d.Push(new Gs.Task(f-1,p,m-1,h)),0<p&&d.Push(new Gs.Task(f,p-1,m-this.m_countX,h)),f<this.m_countX-1&&d.Push(new Gs.Task(f+1,p,m+1,h)),p<this.m_countY-1&&d.Push(new Gs.Task(f,p+1,m+this.m_countX,h))))},Gs.prototype.GetNodes=function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var n=i+e*this.m_countX,r=this.m_diagram[n],s=this.m_diagram[n+1],a=this.m_diagram[n+this.m_countX],n=this.m_diagram[n+1+this.m_countX];s!==a&&(r!==s&&r!==a&&(r.necessary||s.necessary||a.necessary)&&t(r.tag,s.tag,a.tag),n!==s&&n!==a&&(r.necessary||s.necessary||a.necessary)&&t(s.tag,n.tag,a.tag))}},Gs);function Gs(t){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=G(t,function(t){return new Gs.Generator}),this.m_generatorCapacity=t}function Us(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=G(t,function(t){return null}),this.m_capacity=t}function h(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new H,this.m_linearVelocity=new H,this.m_angularVelocity=0,this.m_transform=new O,this.m_userData=null,this.m_system=t}function js(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Ws(t,e){return t<e}function Hs(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=t.length-e),void 0===n&&(n=Ws);for(var r=e,s=[],a=0;;){for(;r+1<i;i++){var o=t[r+Math.floor(Math.random()*(i-r))];s[a++]=i;for(var l=r-1;;){for(;n(t[++l],o););for(;n(o,t[--i]););if(i<=l)break;js(t,l,i)}}if(0===a)break;r=i,i=s[--a]}return t}function Xs(t,e,i,n){Hs(t,e=void 0===e?0:e,i=void 0===i?t.length-e:i,n=void 0===n?Ws:n)}function Ys(t,e,i){void 0===i&&(i=t.length);for(var n=0,r=0;r<i;++r)e(t[r])||(r!==n?js(t,n++,r):++n);return n}function qs(t,e,i,n,r){void 0===r&&(r=Ws);for(var s=i-e;0<s;){var a=Math.floor(s/2),o=e+a;r(t[o],n)?(e=++o,s-=a+1):s=a}return e}function Js(t,e,i,n,r){void 0===r&&(r=Ws);for(var s=i-e;0<s;){var a=Math.floor(s/2),o=e+a;r(n,t[o])?s=a:(e=++o,s-=a+1)}return e}function Zs(t,e,i,n){for(var r=i;e!==r;)js(t,e++,r++),r===n?r=i:e===i&&(i=r)}var _=zs=Gs||{};function Ks(t,e,i,n){this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=n}_.Generator=function(){this.center=new H,this.tag=0,this.necessary=!1},_.Task=Ks;ha.prototype.Append=function(){return this.count>=this.capacity&&this.Grow(),this.count++},ha.prototype.Reserve=function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}},ha.prototype.Grow=function(){var t=this.capacity?2*this.capacity:256;this.Reserve(t)},ha.prototype.Free=function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)},ha.prototype.Shorten=function(t){},ha.prototype.Data=function(){return this.data},ha.prototype.GetCount=function(){return this.count},ha.prototype.SetCount=function(t){this.count=t},ha.prototype.GetCapacity=function(){return this.capacity},ha.prototype.RemoveIf=function(t){this.count=Ys(this.data,t,this.count)},ha.prototype.Unique=function(t){this.count=function(t,e,i,n){if(e===i)return i;for(var r=e;++e!==i;)n(t[r],t[e])||js(t,++r,e);return++r}(this.data,0,this.count,t)};var Qs,$s=ha,ta=(A(la,Qs=Jr),la.prototype.ShouldQueryParticleSystem=function(t){return!1},la.prototype.ReportFixture=function(t){if(!t.IsSensor())for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var n,r=t.GetAABB(i),s=this.m_system.GetInsideBoundsEnumerator(r);0<=(n=s.GetNext());)this.ReportFixtureAndParticle(t,i,n);return!0},la.prototype.ReportParticle=function(t,e){return!1},la.prototype.ReportFixtureAndParticle=function(t,e,i){},la),ea=(oa.prototype.SetIndices=function(t,e){this.indexA=t,this.indexB=e},oa.prototype.SetWeight=function(t){this.weight=t},oa.prototype.SetNormal=function(t){this.normal.Copy(t)},oa.prototype.SetFlags=function(t){this.flags=t},oa.prototype.GetIndexA=function(){return this.indexA},oa.prototype.GetIndexB=function(){return this.indexB},oa.prototype.GetWeight=function(){return this.weight},oa.prototype.GetNormal=function(){return this.normal},oa.prototype.GetFlags=function(){return this.flags},oa.prototype.IsEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y},oa.prototype.IsNotEqual=function(t){return!this.IsEqual(t)},oa.prototype.ApproximatelyEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&D(this.weight-t.weight)<.01&&H.DistanceSquaredVV(this.normal,t.normal)<1e-4},oa),ia=function(){this.index=0,this.weight=0,this.normal=new H,this.mass=0},na=function(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0},ra=function(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new H(0,0),this.pb=new H(0,0),this.pc=new H(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0},sa=(aa.prototype.Copy=function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this},aa.prototype.Clone=function(){return(new aa).Copy(this)},aa);function aa(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}function oa(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new H,this.flags=0}function la(t){var e=Qs.call(this)||this;return e.m_system=t,e}function ha(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}function X(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new X.UserOverridableBuffer,this.m_flagsBuffer=new X.UserOverridableBuffer,this.m_positionBuffer=new X.UserOverridableBuffer,this.m_velocityBuffer=new X.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new X.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new X.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new X.UserOverridableBuffer,this.m_bodyContactCountBuffer=new X.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new X.UserOverridableBuffer,this.m_stuckParticleBuffer=new $s(function(){return 0}),this.m_proxyBuffer=new $s(function(){return new X.Proxy}),this.m_contactBuffer=new $s(function(){return new ea}),this.m_bodyContactBuffer=new $s(function(){return new ia}),this.m_pairBuffer=new $s(function(){return new na}),this.m_triadBuffer=new $s(function(){return new ra}),this.m_expirationTimeBuffer=new X.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new X.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new sa,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}W.b2ParticleSystem=(X.computeTag=function(t,e){return(e+X.yOffset>>>0<<X.yShift)+(X.xScale*t+X.xOffset>>>0)>>>0},X.computeRelativeTag=function(t,e,i){return t+(i<<X.yShift)+(e<<X.xShift)>>>0},X.prototype.Drop=function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)},X.prototype.CreateParticle=function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity&&(e=this.m_count?2*this.m_count:256,this.ReallocateInternalAllocatedBuffers(e)),this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return-1;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var e=this.m_count++;if(!this.m_flagsBuffer.data)throw new Error;if(this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new H).Copy(f(t.position,H.ZERO)),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new H).Copy(f(t.velocity,H.ZERO)),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new H).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0);var i=(new ct).Copy(f(t.color,ct.ZERO)),i=(!this.m_colorBuffer.data&&i.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new ct).Copy(i)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null),this.m_proxyBuffer.data[this.m_proxyBuffer.Append()]),n=f(t.lifetime,0),r=0<n;if(this.m_expirationTimeBuffer.data||r){if(this.SetParticleLifetime(e,r?n:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_indexByExpirationTimeBuffer.data[e]=e}i.index=e;r=f(t.group,null);return(this.m_groupBuffer[e]=r)&&(r.m_firstIndex<r.m_lastIndex?this.RotateBuffer(r.m_firstIndex,r.m_lastIndex,e):r.m_firstIndex=e,r.m_lastIndex=1+e),this.SetParticleFlags(e,f(t.flags,0)),e},X.prototype.GetParticleHandleFromIndex=function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new Ls).SetIndex(t),this.m_handleIndexBuffer.data[t]=e)},X.prototype.DestroyParticle=function(t,e){if(void 0===e&&(e=!1),!this.m_flagsBuffer.data)throw new Error;var i=W.b2ParticleFlag.b2_zombieParticle;e&&(i|=W.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i)},X.prototype.DestroyOldestParticle=function(t,e){void 0===e&&(e=!1);var i=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;if(!this.m_expirationTimeBuffer.data)throw new Error;i=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],t=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(0<this.m_expirationTimeBuffer.data[i]?i:t,e)},X.prototype.DestroyParticlesInShape=function(t,e,i){void 0===i&&(i=!1);var n=X.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;i=new X.DestroyParticlesInShapeCallback(this,t,e,i);return t.ComputeAABB(n,e,0),this.m_world.QueryAABB(i,n),i.Destroyed()},X.prototype.CreateParticleGroup=function(t){var e=X.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var i=e,e=(i.SetPositionAngle(f(t.position,H.ZERO),f(t.angle,0)),this.m_count);if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,i),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,f(t.shapeCount,t.shapes.length),t,i),t.positionData)for(var n=f(t.particleCount,t.positionData.length),r=0;r<n;r++){var s=t.positionData[r];this.CreateParticleForGroup(t,i,s)}var a=this.m_count,o=new Ns(this);for(o.m_firstIndex=e,o.m_lastIndex=a,o.m_strength=f(t.strength,1),o.m_userData=t.userData,o.m_transform.Copy(i),o.m_prev=null,o.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=o),this.m_groupList=o,++this.m_groupCount,r=e;r<a;r++)this.m_groupBuffer[r]=o;this.SetGroupFlags(o,f(t.groupFlags,0));var l=new X.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(e,a,l),t.group&&(this.JoinParticleGroups(t.group,o),o=t.group),o},X.prototype.JoinParticleGroups=function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new X.JoinParticleGroupsFilter(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var n=e.m_firstIndex;n<e.m_lastIndex;n++)this.m_groupBuffer[n]=t;i=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,i),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)},X.prototype.SplitParticleGroup=function(t){this.UpdateContacts(!0);var e=G(t.GetParticleCount(),function(t){return new X.ParticleListNode}),i=(X.InitializeParticleLists(t,e),this.MergeParticleListsInContact(t,e),X.FindLongestParticleList(t,e));this.MergeZombieParticleListNodes(t,e,i),this.CreateParticleGroupsFromParticleList(t,e,i),this.UpdatePairsAndTriadsWithParticleList(t,e)},X.prototype.GetParticleGroupList=function(){return this.m_groupList},X.prototype.GetParticleGroupCount=function(){return this.m_groupCount},X.prototype.GetParticleCount=function(){return this.m_count},X.prototype.GetMaxParticleCount=function(){return this.m_def.maxCount},X.prototype.SetMaxParticleCount=function(t){this.m_def.maxCount=t},X.prototype.GetAllParticleFlags=function(){return this.m_allParticleFlags},X.prototype.GetAllGroupFlags=function(){return this.m_allGroupFlags},X.prototype.SetPaused=function(t){this.m_paused=t},X.prototype.GetPaused=function(){return this.m_paused},X.prototype.SetDensity=function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density},X.prototype.GetDensity=function(){return this.m_def.density},X.prototype.SetGravityScale=function(t){this.m_def.gravityScale=t},X.prototype.GetGravityScale=function(){return this.m_def.gravityScale},X.prototype.SetDamping=function(t){this.m_def.dampingStrength=t},X.prototype.GetDamping=function(){return this.m_def.dampingStrength},X.prototype.SetStaticPressureIterations=function(t){this.m_def.staticPressureIterations=t},X.prototype.GetStaticPressureIterations=function(){return this.m_def.staticPressureIterations},X.prototype.SetRadius=function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter},X.prototype.GetRadius=function(){return this.m_particleDiameter/2},X.prototype.GetPositionBuffer=function(){if(this.m_positionBuffer.data)return this.m_positionBuffer.data;throw new Error},X.prototype.GetVelocityBuffer=function(){if(this.m_velocityBuffer.data)return this.m_velocityBuffer.data;throw new Error},X.prototype.GetColorBuffer=function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data},X.prototype.GetGroupBuffer=function(){return this.m_groupBuffer},X.prototype.GetWeightBuffer=function(){return this.m_weightBuffer},X.prototype.GetUserDataBuffer=function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data},X.prototype.GetFlagsBuffer=function(){if(this.m_flagsBuffer.data)return this.m_flagsBuffer.data;throw new Error},X.prototype.SetParticleFlags=function(t,e){if(!this.m_flagsBuffer.data)throw new Error;this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&W.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&W.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e},X.prototype.GetParticleFlags=function(t){if(this.m_flagsBuffer.data)return this.m_flagsBuffer.data[t];throw new Error},X.prototype.SetFlagsBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)},X.prototype.SetPositionBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)},X.prototype.SetVelocityBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)},X.prototype.SetColorBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)},X.prototype.SetUserDataBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)},X.prototype.GetContacts=function(){return this.m_contactBuffer.data},X.prototype.GetContactCount=function(){return this.m_contactBuffer.count},X.prototype.GetBodyContacts=function(){return this.m_bodyContactBuffer.data},X.prototype.GetBodyContactCount=function(){return this.m_bodyContactBuffer.count},X.prototype.GetPairs=function(){return this.m_pairBuffer.data},X.prototype.GetPairCount=function(){return this.m_pairBuffer.count},X.prototype.GetTriads=function(){return this.m_triadBuffer.data},X.prototype.GetTriadCount=function(){return this.m_triadBuffer.count},X.prototype.SetStuckThreshold=function(t){0<(this.m_stuckThreshold=t)&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))},X.prototype.GetStuckCandidates=function(){return this.m_stuckParticleBuffer.Data()},X.prototype.GetStuckCandidateCount=function(){return this.m_stuckParticleBuffer.GetCount()},X.prototype.ComputeCollisionEnergy=function(){if(!this.m_velocityBuffer.data)throw new Error;for(var t=X.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data,i=0,n=0;n<this.m_contactBuffer.count;n++){var r=this.m_contactBuffer.data[n],s=r.indexA,a=r.indexB,r=r.normal,a=H.SubVV(e[a],e[s],t),s=H.DotVV(a,r);s<0&&(i+=s*s)}return.5*this.GetParticleMass()*i},X.prototype.SetStrictContactCheck=function(t){this.m_def.strictContactCheck=t},X.prototype.GetStrictContactCheck=function(){return this.m_def.strictContactCheck},X.prototype.SetParticleLifetime=function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var n=this.GetParticleCount(),r=0;r<n;++r)this.m_indexByExpirationTimeBuffer.data[r]=r;i=e/this.m_def.lifetimeGranularity,e=0<i?this.GetQuantizedTimeElapsed()+i:i;e!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=e,this.m_expirationTimeBufferRequiresSorting=!0)},X.prototype.GetParticleLifetime=function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])},X.prototype.SetDestructionByAge=function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t},X.prototype.GetDestructionByAge=function(){return this.m_def.destroyByAge},X.prototype.GetExpirationTimeBuffer=function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data},X.prototype.ExpirationTimeToLifetime=function(t){return(0<t?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity},X.prototype.GetIndexByExpirationTimeBuffer=function(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data)return this.m_indexByExpirationTimeBuffer.data;throw new Error},X.prototype.ParticleApplyLinearImpulse=function(t,e){this.ApplyLinearImpulse(t,t+1,e)},X.prototype.ApplyLinearImpulse=function(t,e,i){if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_velocityBuffer.data,r=(e-t)*this.GetParticleMass(),s=(new H).Copy(i).SelfMul(1/r),a=t;a<e;a++)n[a].SelfAdd(s)},X.IsSignificantForce=function(t){return 0!==t.x||0!==t.y},X.prototype.ParticleApplyForce=function(t,e){if(!this.m_flagsBuffer.data)throw new Error;X.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(e))},X.prototype.ApplyForce=function(t,e,i){var n=(new H).Copy(i).SelfMul(1/(e-t));if(X.IsSignificantForce(n)){this.PrepareForceBuffer();for(var r=t;r<e;r++)this.m_forceBuffer[r].SelfAdd(n)}},X.prototype.GetNext=function(){return this.m_next},X.prototype.QueryAABB=function(t,e){if(0!==this.m_proxyBuffer.count){var i=this.m_proxyBuffer.count,n=qs(this.m_proxyBuffer.data,0,i,X.computeTag(this.m_inverseDiameter*e.lowerBound.x,this.m_inverseDiameter*e.lowerBound.y),X.Proxy.CompareProxyTag),r=Js(this.m_proxyBuffer.data,n,i,X.computeTag(this.m_inverseDiameter*e.upperBound.x,this.m_inverseDiameter*e.upperBound.y),X.Proxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error;for(var s=this.m_positionBuffer.data,a=n;a<r;++a){var o=this.m_proxyBuffer.data[a].index,l=s[o];if(e.lowerBound.x<l.x&&l.x<e.upperBound.x&&e.lowerBound.y<l.y&&l.y<e.upperBound.y&&!t.ReportParticle(this,o))break}}},X.prototype.QueryShapeAABB=function(t,e,i,n){var r=X.QueryShapeAABB_s_aabb;e.ComputeAABB(r,i,n=void 0===n?0:n),this.QueryAABB(t,r)},X.prototype.QueryPointAABB=function(t,e,i){var n=X.QueryPointAABB_s_aabb;n.lowerBound.Set(e.x-(i=void 0===i?V:i),e.y-i),n.upperBound.Set(e.x+i,e.y+i),this.QueryAABB(t,n)},X.prototype.RayCast=function(t,e,i){var n=X.RayCast_s_aabb,r=X.RayCast_s_p,s=X.RayCast_s_v,a=X.RayCast_s_n,o=X.RayCast_s_point;if(0!==this.m_proxyBuffer.count){if(!this.m_positionBuffer.data)throw new Error;var l=this.m_positionBuffer.data;H.MinV(e,i,n.lowerBound),H.MaxV(e,i,n.upperBound);for(var h,c=1,u=H.SubVV(i,e,s),_=H.DotVV(u,u),d=this.GetInsideBoundsEnumerator(n);0<=(h=d.GetNext());){var f=H.SubVV(e,l[h],r),p=H.DotVV(f,u),m=p*p-_*(H.DotVV(f,f)-this.m_squaredDiameter);if(0<=m){var m=Q(m),y=(-p-m)/_;if(!(c<y)&&!(y<0&&((y=(-p+m)/_)<0||c<y))){p=H.AddVMulSV(f,y,u,a),m=(p.Normalize(),t.ReportParticle(this,h,H.AddVMulSV(e,y,u,o),p,y));if((c=I(c,m))<=0)break}}}}},X.prototype.ComputeAABB=function(t){var e=this.GetParticleCount();if(t.lowerBound.x=+B,t.lowerBound.y=+B,t.upperBound.x=-B,t.upperBound.y=-B,!this.m_positionBuffer.data)throw new Error;for(var i=this.m_positionBuffer.data,n=0;n<e;n++){var r=i[n];H.MinV(t.lowerBound,r,t.lowerBound),H.MaxV(t.upperBound,r,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter},X.prototype.FreeBuffer=function(t,e){null!==t&&(t.length=0)},X.prototype.FreeUserOverridableBuffer=function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)},X.prototype.ReallocateBuffer3=function(t,e,i){if(i<=e)throw new Error;e=t?t.slice():[];return e.length=i,e},X.prototype.ReallocateBuffer5=function(t,e,i,n,r){if(n<=i||e&&!(n<=e))throw new Error;return t=r&&!t||e?t:this.ReallocateBuffer3(t,i,n)},X.prototype.ReallocateBuffer4=function(t,e,i,n){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,n)},X.prototype.RequestBuffer=function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(256),(t=[]).length=this.m_internalAllocatedCapacity),t},X.prototype.ReallocateHandleBuffers=function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)},X.prototype.ReallocateInternalAllocatedBuffers=function(t){function e(t,e){return e&&e<t?e:t}var i;t=e(t=e(t=e(t=e(t=e(t=e(t,this.m_def.maxCount),this.m_flagsBuffer.userSuppliedCapacity),this.m_positionBuffer.userSuppliedCapacity),this.m_velocityBuffer.userSuppliedCapacity),this.m_colorBuffer.userSuppliedCapacity),this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t&&(this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1),i=0<this.m_stuckThreshold,this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t)},X.prototype.CreateParticleForGroup=function(t,e,i){var n=new Rs;n.flags=f(t.flags,0),O.MulXV(e,i,n.position),H.AddVV(f(t.linearVelocity,H.ZERO),H.CrossSV(f(t.angularVelocity,0),H.SubVV(n.position,f(t.position,H.ZERO),H.s_t0),H.s_t0),n.velocity),n.color.Copy(f(t.color,ct.ZERO)),n.lifetime=f(t.lifetime,0),n.userData=t.userData,this.CreateParticle(n)},X.prototype.CreateParticlesStrokeShapeForGroup=function(t,e,i){var n=X.CreateParticlesStrokeShapeForGroup_s_edge,r=X.CreateParticlesStrokeShapeForGroup_s_d,s=X.CreateParticlesStrokeShapeForGroup_s_p,a=f(e.stride,0);0===a&&(a=this.GetParticleStride());for(var o=0,l=t.GetChildCount(),h=0;h<l;h++){var c=null;t.GetType()===W.b2ShapeType.e_edgeShape?c=t:t.GetChildEdge(c=n,h);for(var u=H.SubVV(c.m_vertex2,c.m_vertex1,r),_=u.Length();o<_;){var d=H.AddVMulSV(c.m_vertex1,o/_,u,s);this.CreateParticleForGroup(e,i,d),o+=a}o-=_}},X.prototype.CreateParticlesFillShapeForGroup=function(t,e,i){var n=X.CreateParticlesFillShapeForGroup_s_aabb,r=X.CreateParticlesFillShapeForGroup_s_p,s=f(e.stride,0),a=(0===s&&(s=this.GetParticleStride()),O.IDENTITY),o=n;t.ComputeAABB(o,a,0);for(var l=Math.floor(o.lowerBound.y/s)*s;l<o.upperBound.y;l+=s)for(var h=Math.floor(o.lowerBound.x/s)*s;h<o.upperBound.x;h+=s){var c=r.Set(h,l);t.TestPoint(a,c)&&this.CreateParticleForGroup(e,i,c)}},X.prototype.CreateParticlesWithShapeForGroup=function(t,e,i){switch(t.GetType()){case W.b2ShapeType.e_edgeShape:case W.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case W.b2ShapeType.e_polygonShape:case W.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i)}},X.prototype.CreateParticlesWithShapesForGroup=function(t,e,i,n){t=new X.CompositeShape(t,e);this.CreateParticlesFillShapeForGroup(t,i,n)},X.prototype.CloneParticle=function(t,e){var i=new Rs;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;e=this.CreateParticle(i);return this.m_handleIndexBuffer.data&&((i=this.m_handleIndexBuffer.data[t])&&i.SetIndex(e),this.m_handleIndexBuffer.data[e]=i,this.m_handleIndexBuffer.data[t]=null),this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[e].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[e]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[e]=this.m_expirationTimeBuffer.data[t]),e},X.prototype.DestroyParticlesInGroup=function(t,e){void 0===e&&(e=!1);for(var i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)},X.prototype.DestroyParticleGroup=function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount},X.ParticleCanBeConnected=function(t,e){return 0!=(t&(W.b2ParticleFlag.b2_wallParticle|W.b2ParticleFlag.b2_springParticle|W.b2ParticleFlag.b2_elasticParticle))||null!==e&&0!=(e.GetGroupFlags()&W.b2ParticleGroupFlag.b2_rigidParticleGroup)},X.prototype.UpdatePairsAndTriads=function(t,e,m){var y=X.UpdatePairsAndTriads_s_dab,g=X.UpdatePairsAndTriads_s_dbc,v=X.UpdatePairsAndTriads_s_dca;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var b=this.m_positionBuffer.data,i=0,n=t;n<e;n++)i|=this.m_flagsBuffer.data[n];if(i&X.k_pairFlags)for(var r=0;r<this.m_contactBuffer.count;r++){var s=this.m_contactBuffer.data[r],a=s.indexA,o=s.indexB,l=this.m_flagsBuffer.data[a],h=this.m_flagsBuffer.data[o],c=this.m_groupBuffer[a],u=this.m_groupBuffer[o];t<=a&&a<e&&t<=o&&o<e&&!((l|h)&W.b2ParticleFlag.b2_zombieParticle)&&(l|h)&X.k_pairFlags&&(m.IsNecessary(a)||m.IsNecessary(o))&&X.ParticleCanBeConnected(l,c)&&X.ParticleCanBeConnected(h,u)&&m.ShouldCreatePair(a,o)&&((l=this.m_pairBuffer.data[this.m_pairBuffer.Append()]).indexA=a,l.indexB=o,l.flags=s.flags,l.strength=I(c?c.m_strength:1,u?u.m_strength:1),l.distance=H.DistanceVV(b[a],b[o])),Xs(this.m_pairBuffer.data,0,this.m_pairBuffer.count,X.ComparePairIndices),this.m_pairBuffer.Unique(X.MatchPairIndices)}if(i&X.k_triadFlags){for(var _=new zs(e-t),n=t;n<e;n++){var d=this.m_flagsBuffer.data[n],f=this.m_groupBuffer[n];d&W.b2ParticleFlag.b2_zombieParticle||!X.ParticleCanBeConnected(d,f)||_.AddGenerator(b[n],n,m.IsNecessary(n))}var p=this.GetParticleStride(),x=(_.Generate(p/2,2*p),this);_.GetNodes(function(t,e,i){if(!x.m_flagsBuffer.data)throw new Error;var n,r,s,a,o,l,h,c,u,_,d=x.m_flagsBuffer.data[t],f=x.m_flagsBuffer.data[e],p=x.m_flagsBuffer.data[i];(d|f|p)&X.k_triadFlags&&m.ShouldCreateTriad(t,e,i)&&(n=b[t],r=b[e],s=b[i],a=H.SubVV(n,r,y),o=H.SubVV(r,s,g),l=H.SubVV(s,n,v),h=4*x.m_squaredDiameter,H.DotVV(a,a)>h||H.DotVV(o,o)>h||H.DotVV(l,l)>h||(h=x.m_groupBuffer[t],c=x.m_groupBuffer[e],u=x.m_groupBuffer[i],(_=x.m_triadBuffer.data[x.m_triadBuffer.Append()]).indexA=t,_.indexB=e,_.indexC=i,_.flags=d|f|p,_.strength=I(I(h?h.m_strength:1,c?c.m_strength:1),u?u.m_strength:1),t=(n.x+r.x+s.x)/3,e=(n.y+r.y+s.y)/3,_.pa.x=n.x-t,_.pa.y=n.y-e,_.pb.x=r.x-t,_.pb.y=r.y-e,_.pc.x=s.x-t,_.pc.y=s.y-e,_.ka=-H.DotVV(l,a),_.kb=-H.DotVV(a,o),_.kc=-H.DotVV(o,l),_.s=H.CrossVV(n,r)+H.CrossVV(r,s)+H.CrossVV(s,n)))}),Xs(this.m_triadBuffer.data,0,this.m_triadBuffer.count,X.CompareTriadIndices),this.m_triadBuffer.Unique(X.MatchTriadIndices)}},X.prototype.UpdatePairsAndTriadsWithReactiveParticles=function(){var t=new X.ReactiveFilter(this.m_flagsBuffer);if(this.UpdatePairsAndTriads(0,this.m_count,t),!this.m_flagsBuffer.data)throw new Error;for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=~W.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~W.b2ParticleFlag.b2_reactiveParticle},X.ComparePairIndices=function(t,e){var i=t.indexA-e.indexA;return 0!=i?i<0:t.indexB<e.indexB},X.MatchPairIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB},X.CompareTriadIndices=function(t,e){var i=t.indexA-e.indexA;if(0!=i)return i<0;i=t.indexB-e.indexB;return 0!=i?i<0:t.indexC<e.indexC},X.MatchTriadIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC},X.InitializeParticleLists=function(t,e){for(var i=t.GetBufferIndex(),n=t.GetParticleCount(),r=0;r<n;r++){var s=e[r];(s.list=s).next=null,s.count=1,s.index=r+i}},X.prototype.MergeParticleListsInContact=function(t,e){for(var i=t.GetBufferIndex(),n=0;n<this.m_contactBuffer.count;n++){var r,s=this.m_contactBuffer.data[n],a=s.indexA,s=s.indexB;t.ContainsParticle(a)&&t.ContainsParticle(s)&&((a=e[a-i].list)!==(s=e[s-i].list)&&(a.count<s.count&&(r=a,a=s,s=r),X.MergeParticleLists(a,s)))}},X.MergeParticleLists=function(t,e){for(var i=e;;){i.list=t;var n=i.next;if(!n){i.next=t.next;break}i=n}t.next=e,t.count+=e.count,e.count=0},X.FindLongestParticleList=function(t,e){for(var i=t.GetParticleCount(),n=e[0],r=0;r<i;r++){var s=e[r];n.count<s.count&&(n=s)}return n},X.prototype.MergeZombieParticleListNodes=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;for(var n=t.GetParticleCount(),r=0;r<n;r++){var s=e[r];s!==i&&this.m_flagsBuffer.data[s.index]&W.b2ParticleFlag.b2_zombieParticle&&X.MergeParticleListAndNode(i,s)}},X.MergeParticleListAndNode=function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0},X.prototype.CreateParticleGroupsFromParticleList=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;var n=t.GetParticleCount(),r=new Vs;r.groupFlags=t.GetGroupFlags(),r.userData=t.GetUserData();for(var s=0;s<n;s++){var a=e[s];if(a.count&&a!==i)for(var o=this.CreateParticleGroup(r),l=a;l;l=l.next){var h=l.index,c=this.CloneParticle(h,o);this.m_flagsBuffer.data[h]|=W.b2ParticleFlag.b2_zombieParticle,l.index=c}}},X.prototype.UpdatePairsAndTriadsWithParticleList=function(t,e){for(var i=t.GetBufferIndex(),n=0;n<this.m_pairBuffer.count;n++){var r=this.m_pairBuffer.data[n],s=r.indexA,a=r.indexB;t.ContainsParticle(s)&&(r.indexA=e[s-i].index),t.ContainsParticle(a)&&(r.indexB=e[a-i].index)}for(n=0;n<this.m_triadBuffer.count;n++){var o=this.m_triadBuffer.data[n],l=(s=o.indexA,a=o.indexB,o.indexC);t.ContainsParticle(s)&&(o.indexA=e[s-i].index),t.ContainsParticle(a)&&(o.indexB=e[a-i].index),t.ContainsParticle(l)&&(o.indexC=e[l-i].index)}},X.prototype.ComputeDepth=function(){for(var t=[],e=0,i=0;i<this.m_contactBuffer.count;i++){var n=(m=this.m_contactBuffer.data[i]).indexA,r=m.indexB,s=this.m_groupBuffer[n],a=this.m_groupBuffer[r];s&&s===a&&s.m_groupFlags&W.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(t[e++]=m)}for(var o=[],l=0,h=this.m_groupList;h;h=h.GetNext())if(h.m_groupFlags&W.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){o[l++]=h,this.SetGroupFlags(h,h.m_groupFlags&~W.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var c=h.m_firstIndex;c<h.m_lastIndex;c++)this.m_accumulationBuffer[c]=0}for(i=0;i<e;i++){var n=(m=t[i]).indexA,r=m.indexB,u=m.weight;this.m_accumulationBuffer[n]+=u,this.m_accumulationBuffer[r]+=u}for(c=0;c<l;c++)for(var _=(h=o[c]).m_firstIndex;_<h.m_lastIndex;_++)u=this.m_accumulationBuffer[_],this.m_depthBuffer[_]=u<.8?0:B;for(var d=Q(this.m_count)>>0,f=0;f<d;f++){for(var p=!1,i=0;i<e;i++){n=(m=t[i]).indexA,r=m.indexB;var m,y=1-m.weight,g=this.m_depthBuffer[n],v=this.m_depthBuffer[r],b=v+y,y=g+y;b<g&&(this.m_depthBuffer[n]=b,p=!0),y<v&&(this.m_depthBuffer[r]=y,p=!0)}if(!p)break}for(c=0;c<l;c++)for(var x=(h=o[c]).m_firstIndex;x<h.m_lastIndex;x++)this.m_depthBuffer[x]<B?this.m_depthBuffer[x]*=this.m_particleDiameter:this.m_depthBuffer[x]=0},X.prototype.GetInsideBoundsEnumerator=function(t){var e=X.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),t=X.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),i=this.m_proxyBuffer.count,n=qs(this.m_proxyBuffer.data,0,i,e,X.Proxy.CompareProxyTag),i=Js(this.m_proxyBuffer.data,0,i,t,X.Proxy.CompareTagProxy);return new X.InsideBoundsEnumerator(this,e,t,n,i)},X.prototype.UpdateAllParticleFlags=function(){if(!this.m_flagsBuffer.data)throw new Error;for(var t=this.m_allParticleFlags=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1},X.prototype.UpdateAllGroupFlags=function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1},X.prototype.AddContact=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;var n,r,s=X.AddContact_s_d,a=this.m_positionBuffer.data,a=H.SubVV(a[e],a[t],s),s=H.DotVV(a,a);s<this.m_squaredDiameter&&(n=K(s),isFinite(n)||(n=198177537e11),(r=this.m_contactBuffer.data[this.m_contactBuffer.Append()]).indexA=t,r.indexB=e,r.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[e],r.weight=1-s*n*this.m_inverseDiameter,H.MulSV(n,a,r.normal))},X.prototype.FindContacts_Reference=function(t){for(var e=this.m_proxyBuffer.count,i=this.m_contactBuffer.count=0,n=0;i<e;i++){for(var r=X.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,0),s=i+1;s<e&&!(r<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer);for(var a=X.computeRelativeTag(this.m_proxyBuffer.data[i].tag,-1,1);n<e&&!(a<=this.m_proxyBuffer.data[n].tag);n++);for(var o=X.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,1),s=n;s<e&&!(o<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer)}},X.prototype.FindContacts=function(t){this.FindContacts_Reference(t)},X.prototype.UpdateProxies_Reference=function(t){if(!this.m_positionBuffer.data)throw new Error;for(var e=this.m_positionBuffer.data,i=this.m_inverseDiameter,n=0;n<this.m_proxyBuffer.count;++n){var r=this.m_proxyBuffer.data[n],s=e[r.index];r.tag=X.computeTag(i*s.x,i*s.y)}},X.prototype.UpdateProxies=function(t){this.UpdateProxies_Reference(t)},X.prototype.SortProxies=function(t){Hs(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,X.Proxy.CompareProxyProxy)},X.prototype.FilterContacts=function(t){var e,i=this.GetParticleContactFilter();null!==i&&(e=this).m_contactBuffer.RemoveIf(function(t){return 0!=(t.flags&W.b2ParticleFlag.b2_particleContactFilterParticle)&&!i.ShouldCollideParticleParticle(e,t.indexA,t.indexB)})},X.prototype.NotifyContactListenerPreContact=function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error},X.prototype.NotifyContactListenerPostContact=function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var n=this.m_contactBuffer.data[i];e.BeginContactParticleParticle(this,n)}throw new Error}},X.b2ParticleContactIsZombie=function(t){return(t.flags&W.b2ParticleFlag.b2_zombieParticle)===W.b2ParticleFlag.b2_zombieParticle},X.prototype.UpdateContacts=function(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var e=new X.b2ParticlePairSet;this.NotifyContactListenerPreContact(e),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(X.b2ParticleContactIsZombie)},X.prototype.NotifyBodyContactListenerPreContact=function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error},X.prototype.NotifyBodyContactListenerPostContact=function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var n=this.m_bodyContactBuffer.data[i];e.BeginContactFixtureParticle(this,n)}throw new Error}},X.prototype.UpdateBodyContacts=function(){var t=X.UpdateBodyContacts_s_aabb,e=new X.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(e),0<this.m_stuckThreshold){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;for(var i=this.GetParticleCount(),n=0;n<i;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);this.ComputeAABB(t);var r=new X.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(r,t),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)},X.prototype.Solve=function(t){var e=X.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&W.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<t.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var i=e.Copy(t);if(i.dt/=t.particleIterations,i.inv_dt*=t.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&W.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&W.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&W.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&W.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&W.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&W.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&W.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&W.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&W.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&X.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&W.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&W.b2ParticleFlag.b2_springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&W.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&W.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&W.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&W.b2ParticleFlag.b2_wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=0;n<this.m_count;n++)this.m_positionBuffer.data[n].SelfMulAdd(i.dt,this.m_velocityBuffer.data[n])}},X.prototype.SolveCollision=function(t){var e=X.SolveCollision_s_aabb;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;var i=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,r=e;r.lowerBound.x=+B,r.lowerBound.y=+B,r.upperBound.x=-B,r.upperBound.y=-B;for(var s=0;s<this.m_count;s++){var a=n[s],o=i[s],l=o.x+t.dt*a.x,a=o.y+t.dt*a.y;r.lowerBound.x=I(r.lowerBound.x,I(o.x,l)),r.lowerBound.y=I(r.lowerBound.y,I(o.y,a)),r.upperBound.x=P(r.upperBound.x,P(o.x,l)),r.upperBound.y=P(r.upperBound.y,P(o.y,a))}e=new X.SolveCollisionCallback(this,t);this.m_world.QueryAABB(e,r)},X.prototype.LimitVelocity=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),n=0;n<this.m_count;n++){var r=e[n],s=H.DotVV(r,r);i<s&&r.SelfMul(Q(i/s))}},X.prototype.SolveGravity=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=X.SolveGravity_s_gravity,i=this.m_velocityBuffer.data,n=H.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e),r=0;r<this.m_count;r++)i[r].SelfAdd(n)},X.prototype.SolveBarrier=function(t){var e=X.SolveBarrier_s_aabb,i=X.SolveBarrier_s_va,n=X.SolveBarrier_s_vb,r=X.SolveBarrier_s_pba,s=X.SolveBarrier_s_vba,a=X.SolveBarrier_s_vc,F=X.SolveBarrier_s_pca,V=X.SolveBarrier_s_vca,N=X.SolveBarrier_s_qba,k=X.SolveBarrier_s_qca,z=X.SolveBarrier_s_dv,G=X.SolveBarrier_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var o=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,h=0;h<this.m_count;h++)0!=(this.m_flagsBuffer.data[h]&X.k_barrierWallFlags)&&l[h].SetZero();for(var c=2.5*t.dt,U=this.GetParticleMass(),u=0;u<this.m_pairBuffer.count;u++){var _=this.m_pairBuffer.data[u];if(_.flags&W.b2ParticleFlag.b2_barrierParticle){var d=_.indexA,_=_.indexB,f=o[d],p=o[_],m=e;H.MinV(f,p,m.lowerBound),H.MaxV(f,p,m.upperBound);for(var y,g=this.m_groupBuffer[d],v=this.m_groupBuffer[_],b=this.GetLinearVelocity(g,d,f,i),d=this.GetLinearVelocity(v,_,p,n),x=H.SubVV(p,f,r),A=H.SubVV(d,b,s),j=this.GetInsideBoundsEnumerator(m);0<=(y=j.GetNext());){var C=o[y],T=this.m_groupBuffer[y];if(g!==T&&v!==T){var S=this.GetLinearVelocity(T,y,C,a),w=H.SubVV(C,f,F),E=H.SubVV(S,b,V),M=H.CrossVV(A,E),D=H.CrossVV(x,E)-H.CrossVV(w,A),B=H.CrossVV(x,w),I=void 0,P=void 0,R=N,O=k;if(0===M){if(0==D)continue;if(!(0<=(P=-B/D)&&P<c))continue;if(H.AddVMulSV(x,P,A,R),H.AddVMulSV(w,P,E,O),!(0<=(I=H.DotVV(R,O)/H.DotVV(R,R))&&I<=1))continue}else{B=D*D-4*B*M;if(B<0)continue;var B=Q(B),L=(-D-B)/(2*M),D=(-D+B)/(2*M);if(D<L&&(B=L,L=D,D=B),P=L,H.AddVMulSV(x,P,A,R),H.AddVMulSV(w,P,E,O),I=H.DotVV(R,O)/H.DotVV(R,R),!(0<=P&&P<c&&0<=I&&I<=1)){if(!(0<=(P=D)&&P<c))continue;if(H.AddVMulSV(x,P,A,R),H.AddVMulSV(w,P,E,O),!(0<=(I=H.DotVV(R,O)/H.DotVV(R,R))&&I<=1))continue}}M=z,B=(M.x=b.x+I*A.x-S.x,M.y=b.y+I*A.y-S.y,H.MulSV(U,M,G));T&&this.IsRigidGroup(T)?(L=T.GetMass(),D=T.GetInertia(),0<L&&T.m_linearVelocity.SelfMulAdd(1/L,B),0<D&&(T.m_angularVelocity+=H.CrossVV(H.SubVV(C,T.GetCenter(),H.s_t0),B)/D)):l[y].SelfAdd(M),this.ParticleApplyForce(y,B.SelfMul(-t.inv_dt))}}}}},X.prototype.SolveStaticPressure=function(t){if(!this.m_flagsBuffer.data)throw new Error;this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var t=this.GetCriticalPressure(t),e=this.m_def.staticPressureStrength*t,i=.25*t,n=this.m_def.staticPressureRelaxation,r=0;r<this.m_def.staticPressureIterations;r++){for(var s=0;s<this.m_count;s++)this.m_accumulationBuffer[s]=0;for(var a=0;a<this.m_contactBuffer.count;a++){var o,l,h=this.m_contactBuffer.data[a];h.flags&W.b2ParticleFlag.b2_staticPressureParticle&&(o=h.indexA,l=h.indexB,u=h.weight,this.m_accumulationBuffer[o]+=u*this.m_staticPressureBuffer[l],this.m_accumulationBuffer[l]+=u*this.m_staticPressureBuffer[o])}for(s=0;s<this.m_count;s++){var c,u=this.m_weightBuffer[s];this.m_flagsBuffer.data[s]&W.b2ParticleFlag.b2_staticPressureParticle?(c=(this.m_accumulationBuffer[s]+e*(u-1))/(u+n),this.m_staticPressureBuffer[s]=q(c,0,i)):this.m_staticPressureBuffer[s]=0}}},X.prototype.ComputeWeight=function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(t=0;t<this.m_bodyContactBuffer.count;t++){var e=(n=this.m_bodyContactBuffer.data[t]).index,i=n.weight;this.m_weightBuffer[e]+=i}for(t=0;t<this.m_contactBuffer.count;t++){var n,e=(n=this.m_contactBuffer.data[t]).indexA,r=n.indexB,i=n.weight;this.m_weightBuffer[e]+=i,this.m_weightBuffer[r]+=i}},X.prototype.SolvePressure=function(t){var e=X.SolvePressure_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,r=this.GetCriticalPressure(t),s=this.m_def.pressureStrength*r,a=.25*r,o=0;o<this.m_count;o++){var l=this.m_weightBuffer[o],h=s*P(0,l-1);this.m_accumulationBuffer[o]=I(h,a)}if(this.m_allParticleFlags&X.k_noPressureFlags)for(o=0;o<this.m_count;o++)this.m_flagsBuffer.data[o]&X.k_noPressureFlags&&(this.m_accumulationBuffer[o]=0);if(this.m_allParticleFlags&W.b2ParticleFlag.b2_staticPressureParticle)for(o=0;o<this.m_count;o++)this.m_flagsBuffer.data[o]&W.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[o]+=this.m_staticPressureBuffer[o]);for(var c=t.dt/(this.m_def.density*this.m_particleDiameter),u=this.GetParticleInvMass(),_=0;_<this.m_bodyContactBuffer.count;_++){var d=(v=this.m_bodyContactBuffer.data[_]).index,f=v.body,p=(l=v.weight,v.mass),m=v.normal,y=i[d],g=(h=this.m_accumulationBuffer[d]+s*l,H.MulSV(c*l*p*h,m,e));n[d].SelfMulSub(u,g),f.ApplyLinearImpulse(g,y,!0)}for(_=0;_<this.m_contactBuffer.count;_++){var v,d=(v=this.m_contactBuffer.data[_]).indexA,f=v.indexB,l=v.weight,m=v.normal,h=this.m_accumulationBuffer[d]+this.m_accumulationBuffer[f],g=H.MulSV(c*l*h,m,e);n[d].SelfSub(g),n[f].SelfAdd(g)}},X.prototype.SolveDamping=function(t){var e=X.SolveDamping_s_v,i=X.SolveDamping_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),o=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var h,c,u=(g=this.m_bodyContactBuffer.data[l]).index,_=g.body,d=g.weight,f=g.mass,p=g.normal,m=n[u],y=H.SubVV(_.GetLinearVelocityFromWorldPoint(m,H.s_t0),r[u],e);(v=H.DotVV(y,p))<0&&(h=P(s*d,I(-a*v,.5)),c=H.MulSV(h*f*v,p,i),r[u].SelfMulAdd(o,c),_.ApplyLinearImpulse(c.SelfNeg(),m,!0))}for(l=0;l<this.m_contactBuffer.count;l++){var g,v,u=(g=this.m_contactBuffer.data[l]).indexA,_=g.indexB,d=g.weight,p=g.normal,y=H.SubVV(r[_],r[u],e);(v=H.DotVV(y,p))<0&&(h=P(s*d,I(-a*v,.5)),c=H.MulSV(h*v,p,i),r[u].SelfAdd(c),r[_].SelfSub(c))}},X.prototype.SolveRigidDamping=function(){var t=X.SolveRigidDamping_s_t0,e=X.SolveRigidDamping_s_t1,i=X.SolveRigidDamping_s_p,n=X.SolveRigidDamping_s_v,r=[0],s=[0],a=[0],o=[0],l=[0],h=[0];if(!this.m_positionBuffer.data)throw new Error;for(var c=this.m_positionBuffer.data,u=this.m_def.dampingStrength,_=0;_<this.m_bodyContactBuffer.count;_++){var d,f=(p=this.m_bodyContactBuffer.data[_]).index;(A=this.m_groupBuffer[f])&&this.IsRigidGroup(A)&&(v=p.body,b=p.normal,x=p.weight,y=c[f],g=H.SubVV(v.GetLinearVelocityFromWorldPoint(y,t),A.GetLinearVelocityFromWorldPoint(y,e),n),(m=H.DotVV(g,b))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(r,s,a,!0,A,f,y,b),this.InitDampingParameter(o,l,h,v.GetMass(),v.GetInertia()-v.GetMass()*v.GetLocalCenter().LengthSquared(),v.GetWorldCenter(),y,b),d=u*I(x,1)*this.ComputeDampingImpulse(r[0],s[0],a[0],o[0],l[0],h[0],m),this.ApplyDamping(r[0],s[0],a[0],!0,A,f,d,b),v.ApplyLinearImpulse(H.MulSV(-d,b,H.s_t0),y,!0)))}for(_=0;_<this.m_contactBuffer.count;_++){var p,m,y,g,f=(p=this.m_contactBuffer.data[_]).indexA,v=p.indexB,b=p.normal,x=p.weight,A=this.m_groupBuffer[f],C=this.m_groupBuffer[v],T=this.IsRigidGroup(A),S=this.IsRigidGroup(C);A!==C&&(T||S)&&(y=H.MidVV(c[f],c[v],i),g=H.SubVV(this.GetLinearVelocity(C,v,y,t),this.GetLinearVelocity(A,f,y,e),n),(m=H.DotVV(g,b))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(r,s,a,T,A,f,y,b),this.InitDampingParameterWithRigidGroupOrParticle(o,l,h,S,C,v,y,b),d=u*x*this.ComputeDampingImpulse(r[0],s[0],a[0],o[0],l[0],h[0],m),this.ApplyDamping(r[0],s[0],a[0],T,A,f,d,b),this.ApplyDamping(o[0],l[0],h[0],S,C,v,-d,b)))}},X.prototype.SolveExtraDamping=function(){var t=X.SolveExtraDamping_s_v,e=X.SolveExtraDamping_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_velocityBuffer.data,n=this.m_positionBuffer.data,r=this.GetParticleInvMass(),s=0;s<this.m_bodyContactBuffer.count;s++){var a,o,l,h,c=this.m_bodyContactBuffer.data[s],u=c.index;this.m_flagsBuffer.data[u]&X.k_extraDampingFlags&&(a=c.body,h=c.mass,c=c.normal,o=n[u],l=H.SubVV(a.GetLinearVelocityFromWorldPoint(o,H.s_t0),i[u],t),(l=H.DotVV(l,c))<0&&(h=H.MulSV(.5*h*l,c,e),i[u].SelfMulAdd(r,h),a.ApplyLinearImpulse(h.SelfNeg(),o,!0)))}},X.prototype.SolveWall=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var t=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&W.b2ParticleFlag.b2_wallParticle&&t[e].SetZero()},X.prototype.SolveRigid=function(t){var e=X.SolveRigid_s_position,i=X.SolveRigid_s_rotation,n=X.SolveRigid_s_transform,r=X.SolveRigid_s_velocityTransform;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var s=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,o=this.m_groupList;o;o=o.GetNext())if(o.m_groupFlags&W.b2ParticleGroupFlag.b2_rigidParticleGroup){o.UpdateStatistics();var l=i,h=(l.SetAngle(t.dt*o.m_angularVelocity),H.AddVV(o.m_center,H.SubVV(H.MulSV(t.dt,o.m_linearVelocity,H.s_t0),R.MulRV(l,o.m_center,H.s_t1),H.s_t0),e)),c=n,u=(c.SetPositionRotation(h,l),O.MulXX(c,o.m_transform,o.m_transform),r);u.p.x=t.inv_dt*c.p.x,u.p.y=t.inv_dt*c.p.y,u.q.s=t.inv_dt*c.q.s,u.q.c=t.inv_dt*(c.q.c-1);for(var _=o.m_firstIndex;_<o.m_lastIndex;_++)O.MulXV(u,s[_],a[_])}},X.prototype.SolveElastic=function(t){var e=X.SolveElastic_s_pa,i=X.SolveElastic_s_pb,n=X.SolveElastic_s_pc,r=X.SolveElastic_s_r,s=X.SolveElastic_s_t0;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,l=t.inv_dt*this.m_def.elasticStrength,h=0;h<this.m_triadBuffer.count;h++){var c,u,_,d,f,p,m,y,g,v,b,x=this.m_triadBuffer.data[h];x.flags&W.b2ParticleFlag.b2_elasticParticle&&(m=x.indexA,y=x.indexB,g=x.indexC,c=x.pa,u=x.pb,_=x.pc,d=e.Copy(a[m]),f=i.Copy(a[y]),p=n.Copy(a[g]),m=o[m],y=o[y],g=o[g],d.SelfMulAdd(t.dt,m),f.SelfMulAdd(t.dt,y),p.SelfMulAdd(t.dt,g),v=(d.x+f.x+p.x)/3,b=(d.y+f.y+p.y)/3,d.x-=v,d.y-=b,f.x-=v,f.y-=b,p.x-=v,p.y-=b,(v=r).s=H.CrossVV(c,d)+H.CrossVV(u,f)+H.CrossVV(_,p),v.c=H.DotVV(c,d)+H.DotVV(u,f)+H.DotVV(_,p),b=K(v.s*v.s+v.c*v.c),isFinite(b)||(b=198177537e11),v.s*=b,v.c*=b,b=l*x.strength,R.MulRV(v,c,s),H.SubVV(s,d,s),H.MulSV(b,s,s),m.SelfAdd(s),R.MulRV(v,u,s),H.SubVV(s,f,s),H.MulSV(b,s,s),y.SelfAdd(s),R.MulRV(v,_,s),H.SubVV(s,p,s),H.MulSV(b,s,s),g.SelfAdd(s))}},X.prototype.SolveSpring=function(t){var e=X.SolveSpring_s_pa,i=X.SolveSpring_s_pb,n=X.SolveSpring_s_d,r=X.SolveSpring_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var s=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,o=t.inv_dt*this.m_def.springStrength,l=0;l<this.m_pairBuffer.count;l++){var h,c,u,_,d,f=this.m_pairBuffer.data[l];f.flags&W.b2ParticleFlag.b2_springParticle&&(h=f.indexA,c=f.indexB,_=e.Copy(s[h]),u=i.Copy(s[c]),h=a[h],c=a[c],_.SelfMulAdd(t.dt,h),u.SelfMulAdd(t.dt,c),u=H.SubVV(u,_,n),_=f.distance,d=u.Length(),f=o*f.strength,f=H.MulSV(f*(_-d)/d,u,r),h.SelfSub(f),c.SelfAdd(f))}},X.prototype.SolveTensile=function(t){var e=X.SolveTensile_s_weightedNormal,i=X.SolveTensile_s_s,n=X.SolveTensile_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var r=this.m_velocityBuffer.data,s=0;s<this.m_count;s++)this.m_accumulation2Buffer[s]=new H,this.m_accumulation2Buffer[s].SetZero();for(var a,o=0;o<this.m_contactBuffer.count;o++)(l=this.m_contactBuffer.data[o]).flags&W.b2ParticleFlag.b2_tensileParticle&&(h=l.indexA,c=l.indexB,u=l.weight,_=l.normal,a=H.MulSV((1-u)*u,_,e),this.m_accumulation2Buffer[h].SelfSub(a),this.m_accumulation2Buffer[c].SelfAdd(a));for(var l,h,c,u,_,d,f,t=this.GetCriticalVelocity(t),p=this.m_def.surfaceTensionPressureStrength*t,m=this.m_def.surfaceTensionNormalStrength*t,y=.5*t,o=0;o<this.m_contactBuffer.count;o++)(l=this.m_contactBuffer.data[o]).flags&W.b2ParticleFlag.b2_tensileParticle&&(h=l.indexA,c=l.indexB,u=l.weight,_=l.normal,d=this.m_weightBuffer[h]+this.m_weightBuffer[c],f=H.SubVV(this.m_accumulation2Buffer[c],this.m_accumulation2Buffer[h],i),d=I(p*(d-2)+m*H.DotVV(f,_),y)*u,f=H.MulSV(d,_,n),r[h].SelfSub(f),r[c].SelfAdd(f))},X.prototype.SolveViscous=function(){var t=X.SolveViscous_s_v,e=X.SolveViscous_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var i,n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=this.m_def.viscousStrength,a=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var l,h,c,u,_,d,f=(i=this.m_bodyContactBuffer.data[o]).index;this.m_flagsBuffer.data[f]&W.b2ParticleFlag.b2_viscousParticle&&(l=i.body,h=i.weight,c=i.mass,u=n[f],_=H.SubVV(l.GetLinearVelocityFromWorldPoint(u,H.s_t0),r[f],t),d=H.MulSV(s*c*h,_,e),r[f].SelfMulAdd(a,d),l.ApplyLinearImpulse(d.SelfNeg(),u,!0))}for(o=0;o<this.m_contactBuffer.count;o++)(i=this.m_contactBuffer.data[o]).flags&W.b2ParticleFlag.b2_viscousParticle&&(f=i.indexA,l=i.indexB,h=i.weight,_=H.SubVV(r[l],r[f],t),d=H.MulSV(s*h,_,e),r[f].SelfAdd(d),r[l].SelfSub(d))},X.prototype.SolveRepulsive=function(t){var e=X.SolveRepulsive_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_velocityBuffer.data,n=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t),r=0;r<this.m_contactBuffer.count;r++){var s,a,o,l=this.m_contactBuffer.data[r];l.flags&W.b2ParticleFlag.b2_repulsiveParticle&&(s=l.indexA,a=l.indexB,this.m_groupBuffer[s]!==this.m_groupBuffer[a]&&(o=l.weight,l=l.normal,o=H.MulSV(n*o,l,e),i[s].SelfSub(o),i[a].SelfAdd(o)))}},X.prototype.SolvePowder=function(t){var e=X.SolvePowder_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var i,n,r=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,a=this.m_def.powderStrength*this.GetCriticalVelocity(t),o=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var h,c,u,_,d,f=(i=this.m_bodyContactBuffer.data[l]).index;this.m_flagsBuffer.data[f]&W.b2ParticleFlag.b2_powderParticle&&.25<(n=i.weight)&&(h=i.body,c=i.mass,u=r[f],_=i.normal,d=H.MulSV(a*c*(n-.25),_,e),s[f].SelfMulSub(o,d),h.ApplyLinearImpulse(d,u,!0))}for(l=0;l<this.m_contactBuffer.count;l++)(i=this.m_contactBuffer.data[l]).flags&W.b2ParticleFlag.b2_powderParticle&&.25<(n=i.weight)&&(f=i.indexA,h=i.indexB,_=i.normal,d=H.MulSV(a*(n-.25),_,e),s[f].SelfSub(d),s[h].SelfAdd(d))},X.prototype.SolveSolid=function(t){var e=X.SolveSolid_s_f;if(!this.m_velocityBuffer.data)throw new Error;var i=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var n=t.inv_dt*this.m_def.ejectionStrength,r=0;r<this.m_contactBuffer.count;r++){var s,a,o=this.m_contactBuffer.data[r],l=o.indexA,h=o.indexB;this.m_groupBuffer[l]!==this.m_groupBuffer[h]&&(s=o.weight,o=o.normal,a=this.m_depthBuffer[l]+this.m_depthBuffer[h],a=H.MulSV(n*a*s,o,e),i[l].SelfSub(a),i[h].SelfAdd(a))}},X.prototype.SolveForce=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),n=0;n<this.m_count;n++)e[n].SelfMulAdd(i,this.m_forceBuffer[n]);this.m_hasForce=!1},X.prototype.SolveColorMixing=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_colorBuffer.data)throw new Error;var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e],n=i.indexA,i=i.indexB;this.m_flagsBuffer.data[n]&this.m_flagsBuffer.data[i]&W.b2ParticleFlag.b2_colorMixingParticle&&(n=this.m_colorBuffer.data[n],i=this.m_colorBuffer.data[i],ct.MixColors(n,i,t))}},X.prototype.SolveZombie=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var t=0,e=[],i=0;i<this.m_count;i++)e[i]=-1;var n=0;for(i=0;i<this.m_count;i++){var r,s,a=this.m_flagsBuffer.data[i];a&W.b2ParticleFlag.b2_zombieParticle?(r=this.m_world.m_destructionListener,a&W.b2ParticleFlag.b2_destructionListenerParticle&&r&&r.SayGoodbyeParticle(this,i),this.m_handleIndexBuffer.data&&(s=this.m_handleIndexBuffer.data[i])&&(s.SetIndex(-1),this.m_handleIndexBuffer.data[i]=null),e[i]=-1):(i!==(e[i]=t)&&(this.m_handleIndexBuffer.data&&((s=this.m_handleIndexBuffer.data[i])&&s.SetIndex(t),this.m_handleIndexBuffer.data[t]=s),this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[i],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[i]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[i]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[i]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[i]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[i]),this.m_groupBuffer[t]=this.m_groupBuffer[i],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[i]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[i]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[i]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[i]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[i]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[i])),t++,n|=a)}for(var o,l=0;l<this.m_proxyBuffer.count;l++){var h=this.m_proxyBuffer.data[l];h.index=e[h.index]}for(this.m_proxyBuffer.RemoveIf(function(t){return t.index<0}),l=0;l<this.m_contactBuffer.count;l++)(o=this.m_contactBuffer.data[l]).indexA=e[o.indexA],o.indexB=e[o.indexB];for(this.m_contactBuffer.RemoveIf(function(t){return t.indexA<0||t.indexB<0}),l=0;l<this.m_bodyContactBuffer.count;l++)(o=this.m_bodyContactBuffer.data[l]).index=e[o.index];for(this.m_bodyContactBuffer.RemoveIf(function(t){return t.index<0}),l=0;l<this.m_pairBuffer.count;l++){var c=this.m_pairBuffer.data[l];c.indexA=e[c.indexA],c.indexB=e[c.indexB]}for(this.m_pairBuffer.RemoveIf(function(t){return t.indexA<0||t.indexB<0}),l=0;l<this.m_triadBuffer.count;l++){var u=this.m_triadBuffer.data[l];u.indexA=e[u.indexA],u.indexB=e[u.indexB],u.indexC=e[u.indexC]}if(this.m_triadBuffer.RemoveIf(function(t){return t.indexA<0||t.indexB<0||t.indexC<0}),this.m_indexByExpirationTimeBuffer.data)for(var _=0,d=0;d<this.m_count;d++){var f=e[this.m_indexByExpirationTimeBuffer.data[d]];-1!==f&&(this.m_indexByExpirationTimeBuffer.data[_++]=f)}for(var p=this.m_groupList;p;p=p.GetNext()){for(var m=t,y=0,g=!1,i=p.m_firstIndex;i<p.m_lastIndex;i++){var v=e[i];0<=v?(m=I(m,v),y=P(y,v+1)):g=!0}m<y?(p.m_firstIndex=m,p.m_lastIndex=y,g&&p.m_groupFlags&W.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(p,p.m_groupFlags|W.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(p.m_firstIndex=0,p.m_lastIndex=0,p.m_groupFlags&W.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(p,p.m_groupFlags|W.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}for(this.m_count=t,this.m_allParticleFlags=n,this.m_needsUpdateAllParticleFlags=!1,p=this.m_groupList;p;){var b=p.GetNext();p.m_groupFlags&W.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(p),p=b}},X.prototype.SolveLifetimes=function(t){if(!this.m_expirationTimeBuffer.data)throw new Error;if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),n=this.m_expirationTimeBuffer.data,i=this.m_indexByExpirationTimeBuffer.data,t=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(Hs(i,0,t,function(t,e){var t=n[t],e=n[e],i=t<=0;return i==e<=0?e<t:i}),this.m_expirationTimeBufferRequiresSorting=!1);for(var r=t-1;0<=r;--r){var s=i[r],a=n[s];if(e<a||a<=0)break;this.DestroyParticle(s)}},X.prototype.RotateBuffer=function(e,i,n){if(e!==i&&i!==n){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;if(Zs(this.m_flagsBuffer.data,e,i,n),this.m_lastBodyContactStepBuffer.data&&Zs(this.m_lastBodyContactStepBuffer.data,e,i,n),this.m_bodyContactCountBuffer.data&&Zs(this.m_bodyContactCountBuffer.data,e,i,n),this.m_consecutiveContactStepsBuffer.data&&Zs(this.m_consecutiveContactStepsBuffer.data,e,i,n),Zs(this.m_positionBuffer.data,e,i,n),Zs(this.m_velocityBuffer.data,e,i,n),Zs(this.m_groupBuffer,e,i,n),this.m_hasForce&&Zs(this.m_forceBuffer,e,i,n),this.m_staticPressureBuffer&&Zs(this.m_staticPressureBuffer,e,i,n),this.m_depthBuffer&&Zs(this.m_depthBuffer,e,i,n),this.m_colorBuffer.data&&Zs(this.m_colorBuffer.data,e,i,n),this.m_userDataBuffer.data&&Zs(this.m_userDataBuffer.data,e,i,n),this.m_handleIndexBuffer.data){Zs(this.m_handleIndexBuffer.data,e,i,n);for(var t=e;t<n;++t){var r=this.m_handleIndexBuffer.data[t];r&&r.SetIndex(d(r.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Zs(this.m_expirationTimeBuffer.data,e,i,n);var s=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;for(var a=this.m_indexByExpirationTimeBuffer.data,t=0;t<s;++t)a[t]=d(a[t])}for(var o,l=0;l<this.m_proxyBuffer.count;l++){var h=this.m_proxyBuffer.data[l];h.index=d(h.index)}for(l=0;l<this.m_contactBuffer.count;l++)(o=this.m_contactBuffer.data[l]).indexA=d(o.indexA),o.indexB=d(o.indexB);for(l=0;l<this.m_bodyContactBuffer.count;l++)(o=this.m_bodyContactBuffer.data[l]).index=d(o.index);for(l=0;l<this.m_pairBuffer.count;l++){var c=this.m_pairBuffer.data[l];c.indexA=d(c.indexA),c.indexB=d(c.indexB)}for(l=0;l<this.m_triadBuffer.count;l++){var u=this.m_triadBuffer.data[l];u.indexA=d(u.indexA),u.indexB=d(u.indexB),u.indexC=d(u.indexC)}for(var _=this.m_groupList;_;_=_.GetNext())_.m_firstIndex=d(_.m_firstIndex),_.m_lastIndex=d(_.m_lastIndex-1)+1}function d(t){return t<e?t:t<i?t+n-i:t<n?t+e-i:t}},X.prototype.GetCriticalVelocity=function(t){return this.m_particleDiameter*t.inv_dt},X.prototype.GetCriticalVelocitySquared=function(t){t=this.GetCriticalVelocity(t);return t*t},X.prototype.GetCriticalPressure=function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)},X.prototype.GetParticleStride=function(){return.75*this.m_particleDiameter},X.prototype.GetParticleMass=function(){var t=this.GetParticleStride();return this.m_def.density*t*t},X.prototype.GetParticleInvMass=function(){var t=this.m_inverseDiameter*(1/.75);return this.m_inverseDensity*t*t},X.prototype.GetFixtureContactFilter=function(){return this.m_allParticleFlags&W.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},X.prototype.GetParticleContactFilter=function(){return this.m_allParticleFlags&W.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},X.prototype.GetFixtureContactListener=function(){return this.m_allParticleFlags&W.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},X.prototype.GetParticleContactListener=function(){return this.m_allParticleFlags&W.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},X.prototype.SetUserOverridableBuffer=function(t,e,i){t.data=e,t.userSuppliedCapacity=i},X.prototype.SetGroupFlags=function(t,e){var i=t.m_groupFlags;(i^e)&W.b2ParticleGroupFlag.b2_solidParticleGroup&&(e|=W.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&W.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e},X.BodyContactCompare=function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index},X.prototype.RemoveSpuriousBodyContacts=function(){Hs(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,X.BodyContactCompare);var s=X.RemoveSpuriousBodyContacts_s_n,a=X.RemoveSpuriousBodyContacts_s_pos,o=X.RemoveSpuriousBodyContacts_s_normal,l=this,h=-1,c=0;this.m_bodyContactBuffer.count=Ys(this.m_bodyContactBuffer.data,function(t){if(t.index!==h&&(c=0,h=t.index),3<c++)return 1;var e=s.Copy(t.normal);if(e.SelfMul(l.m_particleDiameter*(1-t.weight)),!l.m_positionBuffer.data)throw new Error;var i=H.AddVV(l.m_positionBuffer.data[t.index],e,a);if(!t.fixture.TestPoint(i)){for(var n=t.fixture.GetShape().GetChildCount(),r=0;r<n;r++)if(t.fixture.ComputeDistance(i,o,r)<V)return;return 1}},this.m_bodyContactBuffer.count)},X.prototype.DetectStuckParticle=function(t){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp}},X.prototype.ValidateParticleIndex=function(t){return 0<=t&&t<this.GetParticleCount()&&-1!==t},X.prototype.GetQuantizedTimeElapsed=function(){return Math.floor(this.m_timeElapsed/4294967296)},X.prototype.LifetimeToExpirationTime=function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)},X.prototype.ForceCanBeApplied=function(t){return!(t&W.b2ParticleFlag.b2_wallParticle)},X.prototype.PrepareForceBuffer=function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}},X.prototype.IsRigidGroup=function(t){return null!==t&&0!=(t.m_groupFlags&W.b2ParticleGroupFlag.b2_rigidParticleGroup)},X.prototype.GetLinearVelocity=function(t,e,i,n){if(t&&this.IsRigidGroup(t))return t.GetLinearVelocityFromWorldPoint(i,n);if(this.m_velocityBuffer.data)return n.Copy(this.m_velocityBuffer.data[e]);throw new Error},X.prototype.InitDampingParameter=function(t,e,i,n,r,s,a,o){t[0]=0<n?1/n:0,e[0]=0<r?1/r:0,i[0]=H.CrossVV(H.SubVV(a,s,H.s_t0),o)},X.prototype.InitDampingParameterWithRigidGroupOrParticle=function(t,e,i,n,r,s,a,o){if(r&&n)this.InitDampingParameter(t,e,i,r.GetMass(),r.GetInertia(),r.GetCenter(),a,o);else{if(!this.m_flagsBuffer.data)throw new Error;n=this.m_flagsBuffer.data[s];this.InitDampingParameter(t,e,i,n&W.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,a,a,o)}},X.prototype.ComputeDampingImpulse=function(t,e,i,n,r,s,a){t=t+e*i*i+n+r*s*s;return 0<t?a/t:0},X.prototype.ApplyDamping=function(t,e,i,n,r,s,a,o){if(r&&n)r.m_linearVelocity.SelfMulAdd(a*t,o),r.m_angularVelocity+=a*i*e;else{if(!this.m_velocityBuffer.data)throw new Error;this.m_velocityBuffer.data[s].SelfMulAdd(a*t,o)}},X.xTruncBits=12,X.yTruncBits=12,X.tagBits=32,X.yOffset=1<<X.yTruncBits-1,X.yShift=X.tagBits-X.yTruncBits,X.xShift=X.tagBits-X.yTruncBits-X.xTruncBits,X.xScale=1<<X.xShift,X.xOffset=X.xScale*(1<<X.xTruncBits-1),X.yMask=(1<<X.yTruncBits)-1<<X.yShift,X.xMask=~X.yMask,X.DestroyParticlesInShape_s_aabb=new me,X.CreateParticleGroup_s_transform=new O,X.ComputeCollisionEnergy_s_v=new H,X.QueryShapeAABB_s_aabb=new me,X.QueryPointAABB_s_aabb=new me,X.RayCast_s_aabb=new me,X.RayCast_s_p=new H,X.RayCast_s_v=new H,X.RayCast_s_n=new H,X.RayCast_s_point=new H,X.k_pairFlags=W.b2ParticleFlag.b2_springParticle,X.k_triadFlags=W.b2ParticleFlag.b2_elasticParticle,X.k_noPressureFlags=W.b2ParticleFlag.b2_powderParticle|W.b2ParticleFlag.b2_tensileParticle,X.k_extraDampingFlags=W.b2ParticleFlag.b2_staticPressureParticle,X.k_barrierWallFlags=W.b2ParticleFlag.b2_barrierParticle|W.b2ParticleFlag.b2_wallParticle,X.CreateParticlesStrokeShapeForGroup_s_edge=new $i,X.CreateParticlesStrokeShapeForGroup_s_d=new H,X.CreateParticlesStrokeShapeForGroup_s_p=new H,X.CreateParticlesFillShapeForGroup_s_aabb=new me,X.CreateParticlesFillShapeForGroup_s_p=new H,X.UpdatePairsAndTriads_s_dab=new H,X.UpdatePairsAndTriads_s_dbc=new H,X.UpdatePairsAndTriads_s_dca=new H,X.AddContact_s_d=new H,X.UpdateBodyContacts_s_aabb=new me,X.Solve_s_subStep=new $r,X.SolveCollision_s_aabb=new me,X.SolveGravity_s_gravity=new H,X.SolveBarrier_s_aabb=new me,X.SolveBarrier_s_va=new H,X.SolveBarrier_s_vb=new H,X.SolveBarrier_s_pba=new H,X.SolveBarrier_s_vba=new H,X.SolveBarrier_s_vc=new H,X.SolveBarrier_s_pca=new H,X.SolveBarrier_s_vca=new H,X.SolveBarrier_s_qba=new H,X.SolveBarrier_s_qca=new H,X.SolveBarrier_s_dv=new H,X.SolveBarrier_s_f=new H,X.SolvePressure_s_f=new H,X.SolveDamping_s_v=new H,X.SolveDamping_s_f=new H,X.SolveRigidDamping_s_t0=new H,X.SolveRigidDamping_s_t1=new H,X.SolveRigidDamping_s_p=new H,X.SolveRigidDamping_s_v=new H,X.SolveExtraDamping_s_v=new H,X.SolveExtraDamping_s_f=new H,X.SolveRigid_s_position=new H,X.SolveRigid_s_rotation=new R,X.SolveRigid_s_transform=new O,X.SolveRigid_s_velocityTransform=new O,X.SolveElastic_s_pa=new H,X.SolveElastic_s_pb=new H,X.SolveElastic_s_pc=new H,X.SolveElastic_s_r=new R,X.SolveElastic_s_t0=new H,X.SolveSpring_s_pa=new H,X.SolveSpring_s_pb=new H,X.SolveSpring_s_d=new H,X.SolveSpring_s_f=new H,X.SolveTensile_s_weightedNormal=new H,X.SolveTensile_s_s=new H,X.SolveTensile_s_f=new H,X.SolveViscous_s_v=new H,X.SolveViscous_s_f=new H,X.SolveRepulsive_s_f=new H,X.SolvePowder_s_f=new H,X.SolveSolid_s_f=new H,X.RemoveSpuriousBodyContacts_s_n=new H,X.RemoveSpuriousBodyContacts_s_pos=new H,X.RemoveSpuriousBodyContacts_s_normal=new H,X),function(_){_.UserOverridableBuffer=function(){this.data=null,this.userSuppliedCapacity=0},e.CompareProxyProxy=function(t,e){return t.tag<e.tag},e.CompareTagProxy=function(t,e){return t<e.tag},e.CompareProxyTag=function(t,e){return t.tag<e};var t=e;function e(){this.index=-1,this.tag=0}function i(t,e,i,n,r){this.m_system=t,this.m_xLower=(e&_.xMask)>>>0,this.m_xUpper=(i&_.xMask)>>>0,this.m_yLower=(e&_.yMask)>>>0,this.m_yUpper=(i&_.yMask)>>>0,this.m_first=n,this.m_last=r}_.Proxy=t,i.prototype.GetNext=function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&_.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return-1},_.InsideBoundsEnumerator=i;_.ParticleListNode=function(){this.next=null,this.count=0,this.index=0},n.prototype.Allocate=function(t,e){return e},n.prototype.Clear=function(){},n.prototype.GetCount=function(){return 0},n.prototype.Invalidate=function(t){},n.prototype.GetValidBuffer=function(){return[]},n.prototype.GetBuffer=function(){return[]},n.prototype.SetCount=function(t){};t=n;function n(){}_.FixedSetAllocator=t;_.FixtureParticle=function(t,e){this.second=-1,this.first=t,this.second=e},A(s,r=_.FixedSetAllocator),s.prototype.Initialize=function(t,e){},s.prototype.Find=function(t){return-1};var r,t=s;function s(){return null!==r&&r.apply(this,arguments)||this}_.FixtureParticleSet=t;_.ParticlePair=function(t,e){this.first=-1,this.second=-1,this.first=t,this.second=e},A(o,a=_.FixedSetAllocator),o.prototype.Initialize=function(t,e){},o.prototype.Find=function(t){return-1};var a,t=o;function o(){return null!==a&&a.apply(this,arguments)||this}function l(){}_.b2ParticlePairSet=t,l.prototype.IsNecessary=function(t){return!0},l.prototype.ShouldCreatePair=function(t,e){return!0},l.prototype.ShouldCreateTriad=function(t,e,i){return!0},_.ConnectionFilter=l;A(c,h=Jr),c.prototype.ReportFixture=function(t){return!1},c.prototype.ReportParticle=function(t,e){if(t!==this.m_system)return!1;if(this.m_system.m_positionBuffer.data)return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0;throw new Error},c.prototype.Destroyed=function(){return this.m_destroyed};var h,t=c;function c(t,e,i,n){var r=h.call(this)||this;return r.m_callDestructionListener=!1,r.m_destroyed=0,r.m_system=t,r.m_shape=e,r.m_xf=i,r.m_callDestructionListener=n,r.m_destroyed=0,r}_.DestroyParticlesInShapeCallback=t;A(d,u=_.ConnectionFilter),d.prototype.ShouldCreatePair=function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t},d.prototype.ShouldCreateTriad=function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)};var u,t=d;function d(t){var e=u.call(this)||this;return e.m_threshold=0,e.m_threshold=t,e}_.JoinParticleGroupsFilter=t;A(p,f=Xi),p.prototype.Clone=function(){throw new Error},p.prototype.GetChildCount=function(){return 1},p.prototype.TestPoint=function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1},p.prototype.ComputeDistance=function(t,e,i,n){return 0},p.prototype.RayCast=function(t,e,i,n){return!1},p.prototype.ComputeAABB=function(t,e,i){var n=new me;t.lowerBound.x=+B,t.lowerBound.y=+B,t.upperBound.x=-B,t.upperBound.y=-B;for(var r=0;r<this.m_shapeCount;r++)for(var s=this.m_shapes[r].GetChildCount(),a=0;a<s;a++){var o=n;this.m_shapes[r].ComputeAABB(o,e,a),t.Combine1(o)}},p.prototype.ComputeMass=function(t,e){},p.prototype.SetupDistanceProxy=function(t,e){},p.prototype.ComputeSubmergedArea=function(t,e,i,n){return 0},p.prototype.Dump=function(t){};var f,t=p;function p(t,e){void 0===e&&(e=t.length);var i=f.call(this,W.b2ShapeType.e_unknown,0)||this;return i.m_shapeCount=0,i.m_shapes=t,i.m_shapeCount=e,i}_.CompositeShape=t;A(y,m=_.ConnectionFilter),y.prototype.IsNecessary=function(t){if(this.m_flagsBuffer.data)return 0!=(this.m_flagsBuffer.data[t]&W.b2ParticleFlag.b2_reactiveParticle);throw new Error};var m,t=y;function y(t){var e=m.call(this)||this;return e.m_flagsBuffer=t,e}_.ReactiveFilter=t;A(v,g=ta),v.prototype.ShouldCollideFixtureParticle=function(t,e,i){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[i]&W.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)},v.prototype.ReportFixtureAndParticle=function(t,e,i){var n=_.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,r=_.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error;if(!this.m_system.m_positionBuffer.data)throw new Error;var s,a,o,l,h,c=this.m_system.m_positionBuffer.data[i],e=t.ComputeDistance(c,n,e);e<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,this.m_system,i)&&(l=(s=t.GetBody()).GetWorldCenter(),a=0<(o=s.GetMass())?1/o:0,o=0<(o=s.GetInertia()-o*s.GetLocalCenter().LengthSquared())?1/o:0,h=this.m_system.m_flagsBuffer.data[i]&W.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),c=H.SubVV(c,l,r),r=h+a+o*(l=H.CrossVV(c,n))*l,(h=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()]).index=i,h.body=s,h.fixture=t,h.weight=1-e*this.m_system.m_inverseDiameter,h.normal.Copy(n.SelfNeg()),h.mass=0<r?1/r:0,this.m_system.DetectStuckParticle(i))},v.ReportFixtureAndParticle_s_n=new H,v.ReportFixtureAndParticle_s_rp=new H;var g,t=v;function v(t,e){t=g.call(this,t)||this;return t.m_contactFilter=e,t}_.UpdateBodyContactsCallback=t;A(x,b=ta),x.prototype.ReportFixtureAndParticle=function(t,e,i){var n=_.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,r=_.SolveCollisionCallback.ReportFixtureAndParticle_s_output,s=_.SolveCollisionCallback.ReportFixtureAndParticle_s_input,a=_.SolveCollisionCallback.ReportFixtureAndParticle_s_p,o=_.SolveCollisionCallback.ReportFixtureAndParticle_s_v,l=_.SolveCollisionCallback.ReportFixtureAndParticle_s_f,h=t.GetBody();if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var c=this.m_system.m_positionBuffer.data[i],u=this.m_system.m_velocityBuffer.data[i];0===this.m_system.m_iterationIndex?(n=O.MulTXV(h.m_xf0,c,n),t.GetShape().GetType()===W.b2ShapeType.e_circleShape&&(n.SelfSub(h.GetLocalCenter()),R.MulRV(h.m_xf0.q,n,n),R.MulTRV(h.m_xf.q,n,n),n.SelfAdd(h.GetLocalCenter())),O.MulXV(h.m_xf,n,s.p1)):s.p1.Copy(c),H.AddVMulSV(c,this.m_step.dt,u,s.p2),s.maxFraction=1,t.RayCast(r,s,e)&&(h=r.normal,(n=a).x=(1-r.fraction)*s.p1.x+r.fraction*s.p2.x+V*h.x,n.y=(1-r.fraction)*s.p1.y+r.fraction*s.p2.y+V*h.y,(t=o).x=this.m_step.inv_dt*(n.x-c.x),t.y=this.m_step.inv_dt*(n.y-c.y),this.m_system.m_velocityBuffer.data[i].Copy(t),(e=l).x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(u.x-t.x),e.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(u.y-t.y),this.m_system.ParticleApplyForce(i,e))},x.prototype.ReportParticle=function(t,e){return!1},x.ReportFixtureAndParticle_s_p1=new H,x.ReportFixtureAndParticle_s_output=new pe,x.ReportFixtureAndParticle_s_input=new fe,x.ReportFixtureAndParticle_s_p=new H,x.ReportFixtureAndParticle_s_v=new H,x.ReportFixtureAndParticle_s_f=new H;var b,t=x;function x(t,e){t=b.call(this,t)||this;return t.m_step=e,t}_.SolveCollisionCallback=t}(W.b2ParticleSystem||(W.b2ParticleSystem={}));function ca(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new H(0,0),this.damping=.1,this.k2=.9,this.k3=.1}M.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},M.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},M.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},M.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},M.prototype.CreateBody=function(t){if(void 0===t&&(t={}),this.IsLocked())throw new Error;t=new ln(t,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},M.prototype.DestroyBody=function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e,e=e.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var n=t.m_controllerList;n;){var r=n,n=n.nextController;r.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var a=s,s=s.next;this.m_contactManager.Destroy(a.contact)}t.m_contactList=null;for(var o=t.m_fixtureList;o;){var l=o,o=o.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxies(),l.Destroy(),t.m_fixtureList=o,--t.m_fixtureCount}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount},M._Joint_Create=function(t,e){switch(t.type){case W.b2JointType.e_distanceJoint:return new Vn(t);case W.b2JointType.e_mouseJoint:return new Yn(t);case W.b2JointType.e_prismaticJoint:return new Jn(t);case W.b2JointType.e_revoluteJoint:return new $n(t);case W.b2JointType.e_pulleyJoint:return new Kn(t);case W.b2JointType.e_gearJoint:return new jn(t);case W.b2JointType.e_wheelJoint:return new sr(t);case W.b2JointType.e_weldJoint:return new nr(t);case W.b2JointType.e_frictionJoint:return new Gn(t);case W.b2JointType.e_ropeJoint:return new er(t);case W.b2JointType.e_motorJoint:return new Hn(t);case W.b2JointType.e_areaJoint:return new kn(t)}throw new Error},M._Joint_Destroy=function(t,e){},M.prototype.CreateJoint=function(t){if(this.IsLocked())throw new Error;var e=M._Joint_Create(t,null),i=(e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB,t.bodyA),n=t.bodyB;if(!t.collideConnected)for(var r=n.GetContactList();r;)r.other===i&&r.contact.FlagForFiltering(),r=r.next;return e},M.prototype.DestroyJoint=function(t){if(this.IsLocked())throw new Error;var e=t.m_collideConnected,i=(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next),t.m_bodyA),n=t.m_bodyB;if(i.SetAwake(!0),n.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===n.m_jointList&&(n.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,M._Joint_Destroy(t,null),--this.m_jointCount,!e)for(var r=n.GetContactList();r;)r.other===i&&r.contact.FlagForFiltering(),r=r.next},M.prototype.CreateParticleSystem=function(t){if(this.IsLocked())throw new Error;t=new W.b2ParticleSystem(t,this);return t.m_prev=null,t.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=t),this.m_particleSystemList=t},M.prototype.DestroyParticleSystem=function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)},M.prototype.CalculateReasonableParticleIterations=function(t){return null===this.m_particleSystemList?1:Os(this.m_gravity.Length(),function(t){for(var e=B,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=I(e,i.GetRadius());return e}(this),t)},M.prototype.Step=function(t,e,i,n){void 0===n&&(n=this.CalculateReasonableParticleIterations(t));var r=M.Step_s_stepTimer.Reset(),s=(this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0,M.Step_s_step),e=(s.dt=t,s.velocityIterations=e,s.positionIterations=i,s.particleIterations=n,s.inv_dt=0<t?1/t:0,s.dtRatio=this.m_inv_dt0*t,s.warmStarting=this.m_warmStarting,M.Step_s_timer.Reset());if(this.m_contactManager.Collide(),this.m_profile.collide=e.GetMilliseconds(),this.m_stepComplete&&0<s.dt){for(var i=M.Step_s_timer.Reset(),a=this.m_particleSystemList;a;a=a.m_next)a.Solve(s);this.Solve(s),this.m_profile.solve=i.GetMilliseconds()}this.m_continuousPhysics&&0<s.dt&&(n=M.Step_s_timer.Reset(),this.SolveTOI(s),this.m_profile.solveTOI=n.GetMilliseconds()),0<s.dt&&(this.m_inv_dt0=s.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=r.GetMilliseconds()},M.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},M.prototype.DrawParticleSystem=function(t){var e,i,n;null!==this.m_debugDraw&&(e=t.GetParticleCount())&&(i=t.GetRadius(),n=t.GetPositionBuffer(),t.m_colorBuffer.data?(t=t.GetColorBuffer(),this.m_debugDraw.DrawParticles(n,i,t,e)):this.m_debugDraw.DrawParticles(n,i,null,e))},M.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){var t=this.m_debugDraw.GetFlags(),e=M.DrawDebugData_s_color.SetRGB(0,0,0);if(t&W.b2DrawFlags.e_shapeBit)for(var i=this.m_bodyList;i;i=i.m_next){var n=i.m_xf;this.m_debugDraw.PushTransform(n);for(var r=i.GetFixtureList();r;r=r.m_next)i.IsActive()?i.GetType()===W.b2BodyType.b2_staticBody?e.SetRGB(.5,.9,.5):i.GetType()===W.b2BodyType.b2_kinematicBody?e.SetRGB(.5,.5,.9):i.IsAwake()?e.SetRGB(.9,.7,.7):e.SetRGB(.6,.6,.6):e.SetRGB(.5,.5,.3),this.DrawShape(r,e);this.m_debugDraw.PopTransform(n)}if(t&W.b2DrawFlags.e_particleBit)for(var s=this.m_particleSystemList;s;s=s.m_next)this.DrawParticleSystem(s);if(t&W.b2DrawFlags.e_jointBit)for(var a=this.m_jointList;a;a=a.m_next)this.DrawJoint(a);if(t&W.b2DrawFlags.e_aabbBit){e.SetRGB(.9,.3,.9);for(var o=M.DrawDebugData_s_vs,i=this.m_bodyList;i;i=i.m_next)if(i.IsActive())for(r=i.GetFixtureList();r;r=r.m_next)for(var l=0;l<r.m_proxyCount;++l){var h=r.m_proxies[l].treeNode.aabb;o[0].Set(h.lowerBound.x,h.lowerBound.y),o[1].Set(h.upperBound.x,h.lowerBound.y),o[2].Set(h.upperBound.x,h.upperBound.y),o[3].Set(h.lowerBound.x,h.upperBound.y),this.m_debugDraw.DrawPolygon(o,4,e)}}if(t&W.b2DrawFlags.e_centerOfMassBit)for(i=this.m_bodyList;i;i=i.m_next)(n=M.DrawDebugData_s_xf).q.Copy(i.m_xf.q),n.p.Copy(i.GetWorldCenter()),this.m_debugDraw.DrawTransform(n);if(t&W.b2DrawFlags.e_controllerBit)for(var c=this.m_controllerList;c;c=c.m_next)c.Draw(this.m_debugDraw)}},M.prototype.QueryAABB=function(e,t,i){if(this.m_contactManager.m_broadPhase.Query(t,function(t){t=t.userData.fixture;return e?e.ReportFixture(t):!i||i(t)}),e instanceof Jr)for(var n=this.m_particleSystemList;n;n=n.m_next)e.ShouldQueryParticleSystem(n)&&n.QueryAABB(e,t)},M.prototype.QueryAllAABB=function(t,e){return void 0===e&&(e=[]),this.QueryAABB(null,t,function(t){return e.push(t),!0}),e},M.prototype.QueryPointAABB=function(e,t,i){if(this.m_contactManager.m_broadPhase.QueryPoint(t,function(t){t=t.userData.fixture;return e?e.ReportFixture(t):!i||i(t)}),e instanceof Jr)for(var n=this.m_particleSystemList;n;n=n.m_next)e.ShouldQueryParticleSystem(n)&&n.QueryPointAABB(e,t)},M.prototype.QueryAllPointAABB=function(t,e){return void 0===e&&(e=[]),this.QueryPointAABB(null,t,function(t){return e.push(t),!0}),e},M.prototype.QueryFixtureShape=function(i,n,r,s,a){var t=M.QueryFixtureShape_s_aabb;if(n.ComputeAABB(t,s,r),this.m_contactManager.m_broadPhase.Query(t,function(t){var t=t.userData,e=t.fixture;if(we(n,r,e.GetShape(),t.childIndex,s,e.GetBody().GetTransform())){if(i)return i.ReportFixture(e);if(a)return a(e)}return!0}),i instanceof Jr)for(var e=this.m_particleSystemList;e;e=e.m_next)i.ShouldQueryParticleSystem(e)&&e.QueryAABB(i,t)},M.prototype.QueryAllFixtureShape=function(t,e,i,n){return void 0===n&&(n=[]),this.QueryFixtureShape(null,t,e,i,function(t){return n.push(t),!0}),n},M.prototype.QueryFixturePoint=function(e,i,n){if(this.m_contactManager.m_broadPhase.QueryPoint(i,function(t){t=t.userData.fixture;if(t.TestPoint(i)){if(e)return e.ReportFixture(t);if(n)return n(t)}return!0}),e)for(var t=this.m_particleSystemList;t;t=t.m_next)e.ShouldQueryParticleSystem(t)&&t.QueryPointAABB(e,i)},M.prototype.QueryAllFixturePoint=function(t,e){return void 0===e&&(e=[]),this.QueryFixturePoint(null,t,function(t){return e.push(t),!0}),e},M.prototype.RayCast=function(s,a,o,l){var t=M.RayCast_s_input;if(t.maxFraction=1,t.p1.Copy(a),t.p2.Copy(o),this.m_contactManager.m_broadPhase.RayCast(t,function(t,e){var e=e.userData,i=e.fixture,e=e.childIndex,n=M.RayCast_s_output;if(i.RayCast(n,t,e)){var e=n.fraction,r=M.RayCast_s_point;if(r.Set((1-e)*a.x+e*o.x,(1-e)*a.y+e*o.y),s)return s.ReportFixture(i,r,n.normal,e);if(l)return l(i,r,n.normal,e)}return t.maxFraction}),s)for(var e=this.m_particleSystemList;e;e=e.m_next)s.ShouldQueryParticleSystem(e)&&e.RayCast(s,a,o)},M.prototype.RayCastOne=function(t,e){var r=null,s=1;return this.RayCast(null,t,e,function(t,e,i,n){return n<s&&(s=n,r=t),s}),r},M.prototype.RayCastAll=function(t,e,r){return void 0===r&&(r=[]),this.RayCast(null,t,e,function(t,e,i,n){return r.push(t),1}),r},M.prototype.GetBodyList=function(){return this.m_bodyList},M.prototype.GetJointList=function(){return this.m_jointList},M.prototype.GetParticleSystemList=function(){return this.m_particleSystemList},M.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},M.prototype.SetAllowSleeping=function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},M.prototype.GetAllowSleeping=function(){return this.m_allowSleep},M.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},M.prototype.GetWarmStarting=function(){return this.m_warmStarting},M.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},M.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},M.prototype.SetSubStepping=function(t){this.m_subStepping=t},M.prototype.GetSubStepping=function(){return this.m_subStepping},M.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},M.prototype.GetBodyCount=function(){return this.m_bodyCount},M.prototype.GetJointCount=function(){return this.m_jointCount},M.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},M.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},M.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},M.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},M.prototype.SetGravity=function(t,e){if(void 0===e&&(e=!0),!H.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)},M.prototype.GetGravity=function(){return this.m_gravity},M.prototype.IsLocked=function(){return this.m_locked},M.prototype.SetAutoClearForces=function(t){this.m_clearForces=t},M.prototype.GetAutoClearForces=function(){return this.m_clearForces},M.prototype.ShiftOrigin=function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)},M.prototype.GetContactManager=function(){return this.m_contactManager},M.prototype.GetProfile=function(){return this.m_profile},M.prototype.Dump=function(t){if(!this.m_locked){t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n");for(var e=0,i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;for(var e=0,n=this.m_jointList;n;n=n.m_next)n.m_index=e,++e;for(n=this.m_jointList;n;n=n.m_next)n.m_type!==W.b2JointType.e_gearJoint&&(t("{\n"),n.Dump(t),t("}\n"));for(n=this.m_jointList;n;n=n.m_next)n.m_type===W.b2JointType.e_gearJoint&&(t("{\n"),n.Dump(t),t("}\n"))}},M.prototype.DrawJoint=function(t){if(null!==this.m_debugDraw){var e=t.GetBodyA(),i=t.GetBodyB(),e=e.m_xf,i=i.m_xf,n=e.p,r=i.p,s=t.GetAnchorA(M.DrawJoint_s_p1),a=t.GetAnchorB(M.DrawJoint_s_p2),o=M.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(t.m_type){case W.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(s,a,o);break;case W.b2JointType.e_pulleyJoint:var l=t,h=l.GetGroundAnchorA(),l=l.GetGroundAnchorB();this.m_debugDraw.DrawSegment(h,s,o),this.m_debugDraw.DrawSegment(l,a,o),this.m_debugDraw.DrawSegment(h,l,o);break;case W.b2JointType.e_mouseJoint:h=M.DrawJoint_s_c;h.Set(0,1,0),this.m_debugDraw.DrawPoint(s,4,h),this.m_debugDraw.DrawPoint(a,4,h),h.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(s,a,h);break;default:this.m_debugDraw.DrawSegment(n,s,o),this.m_debugDraw.DrawSegment(s,a,o),this.m_debugDraw.DrawSegment(r,a,o)}}},M.prototype.DrawShape=function(t,e){if(null!==this.m_debugDraw){var i=t.GetShape();switch(i.m_type){case W.b2ShapeType.e_circleShape:var n=i.m_p,r=i.m_radius,s=H.UNITX;this.m_debugDraw.DrawSolidCircle(n,r,s,e);break;case W.b2ShapeType.e_edgeShape:var a=i.m_vertex1,o=i.m_vertex2;this.m_debugDraw.DrawSegment(a,o,e);break;case W.b2ShapeType.e_chainShape:var n=i,l=n.m_count,h=n.m_vertices,r=M.DrawShape_s_ghostColor.SetRGBA(.75*e.r,.75*e.g,.75*e.b,e.a),a=h[0];this.m_debugDraw.DrawPoint(a,4,e),n.m_hasPrevVertex&&(s=n.m_prevVertex,this.m_debugDraw.DrawSegment(s,a,r),this.m_debugDraw.DrawCircle(s,.1,r));for(var c=1;c<l;++c)o=h[c],this.m_debugDraw.DrawSegment(a,o,e),this.m_debugDraw.DrawPoint(o,4,e),a=o;n.m_hasNextVertex&&(s=n.m_nextVertex,this.m_debugDraw.DrawSegment(s,a,r),this.m_debugDraw.DrawCircle(s,.1,r));break;case W.b2ShapeType.e_polygonShape:n=i.m_count,h=i.m_vertices;this.m_debugDraw.DrawSolidPolygon(h,n,e)}}},M.prototype.Solve=function(t){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf0.Copy(e.m_xf);for(var i=this.m_controllerList;i;i=i.m_next)i.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var n=this.m_island;for(n.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener),e=this.m_bodyList;e;e=e.m_next)e.m_islandFlag=!1;for(var r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_islandFlag=!1;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var a=this.s_stack,o=this.m_bodyList;o;o=o.m_next)if(!o.m_islandFlag&&o.IsAwake()&&o.IsActive()&&o.GetType()!==W.b2BodyType.b2_staticBody){n.Clear();var l=0;for((a[l++]=o).m_islandFlag=!0;0<l;){if(!(e=a[--l]))throw new Error;if(n.AddBody(e),e.m_awakeFlag=!0,e.GetType()!==W.b2BodyType.b2_staticBody){for(var h=e.m_contactList;h;h=h.next){var c=h.contact;if(!c.m_islandFlag&&c.IsEnabled()&&c.IsTouching()){var u=c.m_fixtureA.m_isSensor,_=c.m_fixtureB.m_isSensor;if(!u&&!_){if(n.AddContact(c),c.m_islandFlag=!0,!(d=h.other))throw new Error;d.m_islandFlag||((a[l++]=d).m_islandFlag=!0)}}}for(var d,f=e.m_jointList;f;f=f.next)f.joint.m_islandFlag||(d=f.other).IsActive()&&(n.AddJoint(f.joint),f.joint.m_islandFlag=!0,d.m_islandFlag||((a[l++]=d).m_islandFlag=!0))}}var p=new Qr;n.Solve(p,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=p.solveInit,this.m_profile.solveVelocity+=p.solveVelocity,this.m_profile.solvePosition+=p.solvePosition;for(var m=0;m<n.m_bodyCount;++m)(e=n.m_bodies[m]).GetType()===W.b2BodyType.b2_staticBody&&(e.m_islandFlag=!1)}for(m=0;m<a.length&&a[m];++m)a[m]=null;for(var y=new xt,e=this.m_bodyList;e;e=e.m_next)e.m_islandFlag&&e.GetType()!==W.b2BodyType.b2_staticBody&&e.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=y.GetMilliseconds()},M.prototype.SolveTOI=function(t){var e=this.m_island;if(e.Initialize(64,32,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var i=this.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_toiFlag=!1,n.m_islandFlag=!1,n.m_toiCount=0,n.m_toi=1}for(;;){for(var r=null,s=1,n=this.m_contactManager.m_contactList;n;n=n.m_next)if(n.IsEnabled()&&!(8<n.m_toiCount)){var a=1;if(n.m_toiFlag)a=n.m_toi;else{var o=n.GetFixtureA(),l=n.GetFixtureB();if(o.IsSensor()||l.IsSensor())continue;var h=o.GetBody(),c=l.GetBody(),u=h.m_type,_=c.m_type,d=h.IsAwake()&&u!==W.b2BodyType.b2_staticBody,f=c.IsAwake()&&_!==W.b2BodyType.b2_staticBody;if(!d&&!f)continue;d=h.IsBullet()||u!==W.b2BodyType.b2_dynamicBody,f=c.IsBullet()||_!==W.b2BodyType.b2_dynamicBody;if(!d&&!f)continue;u=h.m_sweep.alpha0,_=(h.m_sweep.alpha0<c.m_sweep.alpha0?(u=c.m_sweep.alpha0,h.m_sweep.Advance(u)):c.m_sweep.alpha0<h.m_sweep.alpha0&&(u=h.m_sweep.alpha0,c.m_sweep.Advance(u)),n.GetChildIndexA()),d=n.GetChildIndexB(),f=M.SolveTOI_s_toi_input,o=(f.proxyA.SetShape(o.GetShape(),_),f.proxyB.SetShape(l.GetShape(),d),f.sweepA.Copy(h.m_sweep),f.sweepB.Copy(c.m_sweep),f.tMax=1,M.SolveTOI_s_toi_output),_=(ti(o,f),o.t),a=o.state===W.b2TOIOutputState.e_touching?I(u+(1-u)*_,1):1;n.m_toi=a,n.m_toiFlag=!0}a<s&&(r=n,s=a)}if(null===r||1-10*F<s){this.m_stepComplete=!0;break}var p=r.GetFixtureA(),m=r.GetFixtureB(),y=p.GetBody(),g=m.GetBody(),p=M.SolveTOI_s_backup1.Copy(y.m_sweep),m=M.SolveTOI_s_backup2.Copy(g.m_sweep);if(y.Advance(s),g.Advance(s),r.Update(this.m_contactManager.m_contactListener),r.m_toiFlag=!1,++r.m_toiCount,r.IsEnabled()&&r.IsTouching()){y.SetAwake(!0),g.SetAwake(!0),e.Clear(),e.AddBody(y),e.AddBody(g),e.AddContact(r),y.m_islandFlag=!0,g.m_islandFlag=!0,r.m_islandFlag=!0;for(var v=0;v<2;++v)if((S=0===v?y:g).m_type===W.b2BodyType.b2_dynamicBody)for(var b=S.m_contactList;b&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==e.m_contactCapacity;b=b.next){var x,A,C,T=b.contact;T.m_islandFlag||((x=b.other).m_type!==W.b2BodyType.b2_dynamicBody||S.IsBullet()||x.IsBullet())&&(C=T.m_fixtureA.m_isSensor,A=T.m_fixtureB.m_isSensor,C||A||(C=M.SolveTOI_s_backup.Copy(x.m_sweep),x.m_islandFlag||x.Advance(s),T.Update(this.m_contactManager.m_contactListener),T.IsEnabled()&&T.IsTouching()?(T.m_islandFlag=!0,e.AddContact(T),x.m_islandFlag||(x.m_islandFlag=!0,x.m_type!==W.b2BodyType.b2_staticBody&&x.SetAwake(!0),e.AddBody(x))):(x.m_sweep.Copy(C),x.SynchronizeTransform())))}var S,w=M.SolveTOI_s_subStep;for(w.dt=(1-s)*t.dt,w.inv_dt=1/w.dt,w.dtRatio=1,w.positionIterations=20,w.velocityIterations=t.velocityIterations,w.particleIterations=t.particleIterations,w.warmStarting=!1,e.SolveTOI(w,y.m_islandIndex,g.m_islandIndex),v=0;v<e.m_bodyCount;++v)if((S=e.m_bodies[v]).m_islandFlag=!1,S.m_type===W.b2BodyType.b2_dynamicBody)for(S.SynchronizeFixtures(),b=S.m_contactList;b;b=b.next)b.contact.m_toiFlag=!1,b.contact.m_islandFlag=!1;if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else r.SetEnabled(!1),y.m_sweep.Copy(p),g.m_sweep.Copy(m),y.SynchronizeTransform(),g.SynchronizeTransform()}},M.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t},M.prototype.RemoveController=function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t},M.Step_s_step=new $r,M.Step_s_stepTimer=new xt,M.Step_s_timer=new xt,M.DrawDebugData_s_color=new ct(0,0,0),M.DrawDebugData_s_vs=H.MakeArray(4),M.DrawDebugData_s_xf=new O,M.QueryFixtureShape_s_aabb=new me,M.RayCast_s_input=new fe,M.RayCast_s_output=new pe,M.RayCast_s_point=new H,M.DrawJoint_s_p1=new H,M.DrawJoint_s_p2=new H,M.DrawJoint_s_color=new ct(.5,.8,.8),M.DrawJoint_s_c=new ct,M.DrawShape_s_ghostColor=new ct,M.SolveTOI_s_subStep=new $r,M.SolveTOI_s_backup=new ht,M.SolveTOI_s_backup1=new ht,M.SolveTOI_s_backup2=new ht,M.SolveTOI_s_toi_input=new Ge,M.SolveTOI_s_toi_output=new Ue;var ua,_a,da,fa,pa,_=M,ma=function(t,e){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=e},ya=(Ba.prototype.GetNext=function(){return this.m_next},Ba.prototype.GetPrev=function(){return this.m_prev},Ba.prototype.GetBodyList=function(){return this.m_bodyList},Ba.prototype.AddBody=function(t){var e=new ma(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount},Ba.prototype.RemoveBody=function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount},Ba.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},Ba),ga=(A(Da,pa=ya),Da.prototype.Step=function(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()){for(var n,r=new H,s=new H,a=0,o=0,l=i.GetFixtureList();l;l=l.m_next){var h,c=new H,u=l.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),c);a+=u,r.x+=u*c.x,r.y+=u*c.y;o+=u*(h=this.useDensity?l.GetDensity():1),s.x+=u*c.x*h,s.y+=u*c.y*h}r.x/=a,r.y/=a,s.x/=o,s.y/=o,a<F||((n=this.gravity.Clone().SelfNeg()).SelfMul(this.density*a),i.ApplyForce(n,s),(n=i.GetLinearVelocityFromWorldPoint(r,new H)).SelfSub(this.velocity),n.SelfMul(-this.linearDrag*a),i.ApplyForce(n,r),i.ApplyTorque(-i.GetInertia()/i.GetMass()*a*i.GetAngularVelocity()*this.angularDrag))}}}},Da.prototype.Draw=function(t){var e=new H,i=new H,n=(e.x=this.normal.x*this.offset+100*this.normal.y,e.y=this.normal.y*this.offset-100*this.normal.x,i.x=this.normal.x*this.offset-100*this.normal.y,i.y=this.normal.y*this.offset+100*this.normal.x,new ct(0,0,.8));t.DrawSegment(e,i,n)},Da),va=(A(Ma,fa=ya),Ma.prototype.Step=function(t){for(var e=H.MulSV(t.dt,this.A,Ma.Step_s_dtA),i=this.m_bodyList;i;i=i.nextBody){var n=i.body;n.IsAwake()&&n.SetLinearVelocity(H.AddVV(n.GetLinearVelocity(),e,H.s_t0))}},Ma.prototype.Draw=function(t){},Ma.Step_s_dtA=new H,Ma),ba=(A(Ea,da=ya),Ea.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}},Ea.prototype.Draw=function(t){},Ea),xa=(A(wa,_a=ya),wa.prototype.Step=function(t){if(this.invSqr)for(var e=this.m_bodyList;e;e=e.nextBody)for(var i=(o=e.body).GetWorldCenter(),n=o.GetMass(),r=this.m_bodyList;r&&r!==e;r=r.nextBody){var s=(l=r.body).GetWorldCenter(),a=l.GetMass();(u=(h=s.x-i.x)*h+(c=s.y-i.y)*c)<F||((_=wa.Step_s_f.Set(h,c)).SelfMul(this.G/u/Q(u)*n*a),o.IsAwake()&&o.ApplyForce(_,i),l.IsAwake()&&l.ApplyForce(_.SelfMul(-1),s))}else for(e=this.m_bodyList;e;e=e.nextBody)for(var o,i=(o=e.body).GetWorldCenter(),n=o.GetMass(),r=this.m_bodyList;r&&r!==e;r=r.nextBody){var l,h,c,u,_,s=(l=r.body).GetWorldCenter(),a=l.GetMass();(u=(h=s.x-i.x)*h+(c=s.y-i.y)*c)<F||((_=wa.Step_s_f.Set(h,c)).SelfMul(this.G/u*n*a),o.IsAwake()&&o.ApplyForce(_,i),l.IsAwake()&&l.ApplyForce(_.SelfMul(-1),s))}},wa.prototype.Draw=function(t){},wa.Step_s_f=new H,wa),Aa=(A(Sa,ua=ya),Sa.prototype.Step=function(t){var e=t.dt;if(!(e<=F)){e>this.maxTimestep&&0<this.maxTimestep&&(e=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var n,r=i.body;r.IsAwake()&&(n=r.GetWorldVector(ot.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity(),H.s_t0),H.s_t1),Sa.Step_s_damping),r.SetLinearVelocity(H.AddVV(r.GetLinearVelocity(),H.MulSV(e,n,H.s_t0),H.s_t1)))}}},Sa.prototype.Draw=function(t){},Sa.prototype.SetAxisAligned=function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=0<t||0<e?1/P(t,e):0},Sa.Step_s_damping=new H,Sa),Ca=(Ta.prototype.GetVertexCount=function(){return this.m_count},Ta.prototype.GetVertices=function(){return this.m_ps},Ta.prototype.Initialize=function(t){this.m_count=t.count,this.m_ps=H.MakeArray(this.m_count),this.m_p0s=H.MakeArray(this.m_count),this.m_vs=H.MakeArray(this.m_count),this.m_ims=U(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=0<i?1/i:0}var n=this.m_count-1,r=this.m_count-2;for(this.m_Ls=U(n),this.m_as=U(r),e=0;e<n;++e){var s=this.m_ps[e],a=this.m_ps[e+1];this.m_Ls[e]=H.DistanceVV(s,a)}for(e=0;e<r;++e){var s=this.m_ps[e],a=this.m_ps[e+1],o=this.m_ps[e+2],l=H.SubVV(a,s,H.s_t0),o=H.SubVV(o,a,H.s_t1),h=H.CrossVV(l,o),l=H.DotVV(l,o);this.m_as[e]=rt(h,l)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3},Ta.prototype.Step=function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),n=0;n<this.m_count;++n)this.m_p0s[n].Copy(this.m_ps[n]),0<this.m_ims[n]&&this.m_vs[n].SelfMulAdd(t,this.m_gravity),this.m_vs[n].SelfMul(i),this.m_ps[n].SelfMulAdd(t,this.m_vs[n]);for(n=0;n<e;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var r=1/t,n=0;n<this.m_count;++n)H.MulSV(r,H.SubVV(this.m_ps[n],this.m_p0s[n],H.s_t0),this.m_vs[n])}},Ta.prototype.SolveC2=function(){for(var t=this.m_count-1,e=0;e<t;++e){var i,n=this.m_ps[e],r=this.m_ps[e+1],s=H.SubVV(r,n,Ta.s_d),a=s.Normalize(),o=this.m_ims[e],l=this.m_ims[e+1];o+l!==0&&(i=l/(o+l),n.SelfMulSub(this.m_k2*(o/(o+l))*(this.m_Ls[e]-a),s),r.SelfMulAdd(this.m_k2*i*(this.m_Ls[e]-a),s))}},Ta.prototype.SetAngle=function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t},Ta.prototype.SolveC3=function(){for(var t=this.m_count-2,e=0;e<t;++e){var i=this.m_ps[e],n=this.m_ps[e+1],r=this.m_ps[e+2],s=this.m_ims[e],a=this.m_ims[e+1],o=this.m_ims[e+2],l=H.SubVV(n,i,Ta.s_d1),h=H.SubVV(r,n,Ta.s_d2),c=l.LengthSquared(),u=h.LengthSquared();if(c*u!=0){var _=H.CrossVV(l,h),d=H.DotVV(l,h),f=rt(_,d),_=H.MulSV(-1/c,l.SelfSkew(),Ta.s_Jd1),d=H.MulSV(1/u,h.SelfSkew(),Ta.s_Jd2),c=H.NegV(_,Ta.s_J1),l=H.SubVV(_,d,Ta.s_J2),u=d;if(0!=(h=s*H.DotVV(c,c)+a*H.DotVV(l,l)+o*H.DotVV(u,u))){for(var h=1/h,p=f-this.m_as[e];x<p;)p=(f-=2*x)-this.m_as[e];for(;p<-x;)p=(f+=2*x)-this.m_as[e];_=-this.m_k3*h*p;i.SelfMulAdd(s*_,c),n.SelfMulAdd(a*_,l),r.SelfMulAdd(o*_,u)}}}},Ta.prototype.Draw=function(t){for(var e=new ct(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)},Ta.s_d=new H,Ta.s_d1=new H,Ta.s_d2=new H,Ta.s_Jd1=new H,Ta.s_Jd2=new H,Ta.s_J1=new H,Ta.s_J2=new H,Ta);function Ta(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new H,this.m_damping=0,this.m_k2=1,this.m_k3=.1}function Sa(){var t=null!==ua&&ua.apply(this,arguments)||this;return t.T=new ot,t.maxTimestep=0,t}function wa(){var t=null!==_a&&_a.apply(this,arguments)||this;return t.G=1,t.invSqr=!0,t}function Ea(){var t=null!==da&&da.apply(this,arguments)||this;return t.F=new H(0,0),t}function Ma(){var t=null!==fa&&fa.apply(this,arguments)||this;return t.A=new H(0,0),t}function Da(){var t=null!==pa&&pa.apply(this,arguments)||this;return t.normal=new H(0,1),t.offset=0,t.density=0,t.velocity=new H(0,0),t.linearDrag=0,t.angularDrag=0,t.useDensity=!1,t.useWorldGravity=!0,t.gravity=new H(0,0),t}function Ba(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}function M(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new Kr,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new H,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new Qr,this.m_island=new hs,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}W.b2Assert=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!t)throw new(Error.bind.apply(Error,[void 0].concat(e)))},W.b2Maybe=f,W.b2_maxFloat=B,W.b2_epsilon=F,W.b2_epsilon_sq=b,W.b2_pi=x,W.b2_maxManifoldPoints=2,W.b2_maxPolygonVertices=8,W.b2_aabbExtension=.1,W.b2_aabbMultiplier=2,W.b2_linearSlop=V,W.b2_angularSlop=N,W.b2_polygonRadius=.016,W.b2_maxSubSteps=8,W.b2_maxTOIContacts=32,W.b2_velocityThreshold=1,W.b2_maxLinearCorrection=.2,W.b2_maxAngularCorrection=.13962634015955555,W.b2_maxTranslation=2,W.b2_maxTranslationSquared=4,W.b2_maxRotation=1.570796326795,W.b2_maxRotationSquared=2.4674011002726646,W.b2_baumgarte=.2,W.b2_toiBaumgarte=.75,W.b2_invalidParticleIndex=-1,W.b2_maxParticleIndex=2147483647,W.b2_particleStride=.75,W.b2_minParticleWeight=1,W.b2_maxParticlePressure=.25,W.b2_maxParticleForce=.5,W.b2_maxTriadDistance=2,W.b2_maxTriadDistanceSquared=4,W.b2_minParticleSystemBufferCapacity=256,W.b2_barrierCollisionTime=2.5,W.b2_timeToSleep=.5,W.b2_linearSleepTolerance=.01,W.b2_angularSleepTolerance=.03490658503988889,W.b2Alloc=function(t){return null},W.b2Free=function(t){},W.b2Log=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},W.b2Version=w,W.b2_version=k,W.b2_branch="master",W.b2_commit="fbf51801d80fc389d43dc46524520e89043b6faf",W.b2ParseInt=function(t){return parseInt(t,10)},W.b2ParseUInt=function(t){return Math.abs(parseInt(t,10))},W.b2MakeArray=G,W.b2MakeNullArray=function(t){for(var e=[],i=0;i<t;++i)e.push(null);return e},W.b2MakeNumberArray=U,W.b2_pi_over_180=j,W.b2_180_over_pi=Y,W.b2_two_pi=6.28318530718,W.b2Abs=D,W.b2Min=I,W.b2Max=P,W.b2Clamp=q,W.b2Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},W.b2IsValid=J,W.b2Sq=Z,W.b2InvSqrt=K,W.b2Sqrt=Q,W.b2Pow=$,W.b2DegToRad=function(t){return t*j},W.b2RadToDeg=function(t){return t*Y},W.b2Cos=tt,W.b2Sin=et,W.b2Acos=it,W.b2Asin=nt,W.b2Atan2=rt,W.b2NextPowerOfTwo=function(t){return 1+((t=(t=(t=(t|=t>>1&2147483647)|t>>2&1073741823)|t>>4&268435455)|t>>8&16777215)|t>>16&65535)},W.b2IsPowerOfTwo=function(t){return 0<t&&0==(t&t-1)},W.b2Random=function(){return 2*Math.random()-1},W.b2RandomRange=function(t,e){return(e-t)*Math.random()+t},W.b2Vec2=H,W.b2Vec2_zero=st,W.b2Vec3=at,W.b2Mat22=ot,W.b2Mat33=lt,W.b2Rot=R,W.b2Transform=O,W.b2Sweep=ht,W.b2Color=ct,W.b2Draw=bt,W.b2Timer=xt,W.b2Counter=At,W.b2GrowableStack=Ct,W.b2BlockAllocator=mt,W.b2StackAllocator=yt,W.b2ContactFeature=ne,W.b2ContactID=re,W.b2ManifoldPoint=se,W.b2Manifold=he,W.b2WorldManifold=ce,W.b2GetPointStates=function(t,e,i,n){for(var r=0;r<i.pointCount;++r){var s=i.points[r].id.key;t[r]=W.b2PointState.b2_removeState;for(var a=0,o=n.pointCount;a<o;++a)if(n.points[a].id.key===s){t[r]=W.b2PointState.b2_persistState;break}}for(;r<2;++r)t[r]=W.b2PointState.b2_nullState;for(r=0;r<n.pointCount;++r)for(s=n.points[r].id.key,e[r]=W.b2PointState.b2_addState,a=0,o=i.pointCount;a<o;++a)if(i.points[a].id.key===s){e[r]=W.b2PointState.b2_persistState;break}for(;r<2;++r)e[r]=W.b2PointState.b2_nullState},W.b2ClipVertex=de,W.b2RayCastInput=fe,W.b2RayCastOutput=pe,W.b2AABB=me,W.b2TestOverlapAABB=xe,W.b2ClipSegmentToLine=Ae,W.b2TestOverlapShape=we,W.b2DistanceProxy=Tt,W.b2SimplexCache=St,W.b2DistanceInput=wt,W.b2DistanceOutput=Et,W.b2ShapeCastInput=gt,W.b2ShapeCastOutput=vt,W.b2_gjk_reset=function(){W.b2_gjkCalls=0,W.b2_gjkIters=0,W.b2_gjkMaxIters=0},W.b2SimplexVertex=Ft,W.b2Simplex=Vt,W.b2Distance=qt,W.b2ShapeCast=function(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,n=e.proxyB,r=P(i.m_radius,.016)+P(n.m_radius,.016),s=e.transformA,a=e.transformB,o=e.translationB,l=Jt.Set(0,0),h=0,c=Zt;c.m_count=0;for(var u=c.m_vertices,_=i.GetSupport(R.MulTRV(s.q,H.NegV(o,H.s_t1),H.s_t0)),d=O.MulXV(s,i.GetVertex(_),Kt),f=n.GetSupport(R.MulTRV(a.q,o,H.s_t0)),p=O.MulXV(a,n.GetVertex(f),Qt),m=H.SubVV(d,p,$t),y=P(.016,r-.016),g=0;g<20&&.004<D(m.Length()-y);){t.iterations+=1;var _=i.GetSupport(R.MulTRV(s.q,H.NegV(m,H.s_t1),H.s_t0)),d=O.MulXV(s,i.GetVertex(_),Kt),f=n.GetSupport(R.MulTRV(a.q,m,H.s_t0)),p=O.MulXV(a,n.GetVertex(f),Qt),v=H.SubVV(d,p,te),v=(m.Normalize(),H.DotVV(m,v)),b=H.DotVV(m,o);if(h*b<v-y){if(b<=0)return!1;if(1<(h=(v-y)/b))return!1;l.Copy(m).SelfNeg(),c.m_count=0}v=u[c.m_count];switch(v.indexA=f,v.wA.Copy(p).SelfMulAdd(h,o),v.indexB=_,v.wB.Copy(d),v.w.Copy(v.wB).SelfSub(v.wA),v.a=1,c.m_count+=1,c.m_count){case 1:break;case 2:c.Solve2();break;case 3:c.Solve3()}if(3===c.m_count)return!1;c.GetClosestPoint(m),++g}return c.GetWitnessPoints(ee,ie),0<m.LengthSquared()&&(l.Copy(m).SelfNeg(),l.Normalize()),t.normal.Copy(l),t.lambda=h,t.iterations=g,!0},W.b2Pair=De,W.b2BroadPhase=Be,W.b2PairLessThan=Re,W.b2TreeNode=Ee,W.b2DynamicTree=Me,W.b2_toi_reset=function(){W.b2_toiTime=0,W.b2_toiMaxTime=0,W.b2_toiCalls=0,W.b2_toiIters=0,W.b2_toiMaxIters=0,W.b2_toiRootIters=0,W.b2_toiMaxRootIters=0},W.b2TOIInput=Ge,W.b2TOIOutput=Ue,W.b2SeparationFunction=je,W.b2TimeOfImpact=ti,W.b2CollideCircles=ni,W.b2CollidePolygonAndCircle=oi,W.b2CollidePolygons=Bi,W.b2CollideEdgeAndCircle=ki,W.b2CollideEdgeAndPolygon=Wi,W.b2MassData=Hi,W.b2Shape=Xi,W.b2CircleShape=zi,W.b2PolygonShape=Ui,W.b2EdgeShape=$i,W.b2ChainShape=tn,W.b2Filter=en,W.b2FixtureDef=nn,W.b2FixtureProxy=rn,W.b2Fixture=sn,W.b2BodyDef=on,W.b2Body=ln,W.b2World=_,W.b2DestructionListener=Hr,W.b2ContactFilter=Xr,W.b2ContactImpulse=Yr,W.b2ContactListener=qr,W.b2QueryCallback=Jr,W.b2RayCastCallback=Zr,W.b2Island=hs,W.b2Profile=Qr,W.b2TimeStep=$r,W.b2Position=ts,W.b2Velocity=es,W.b2SolverData=is,W.b2ContactManager=Kr,W.b2MixFriction=Sr,W.b2MixRestitution=wr,W.b2ContactEdge=Or,W.b2Contact=Lr,W.b2ContactRegister=jr,W.b2ContactFactory=Wr,W.g_blockSolve=!1,W.b2VelocityConstraintPoint=ns,W.b2ContactVelocityConstraint=rs,W.b2ContactPositionConstraint=ss,W.b2ContactSolverDef=as,W.b2PositionSolverManifold=os,W.b2ContactSolver=ls,W.b2CircleContact=Fr,W.b2PolygonContact=Vr,W.b2PolygonAndCircleContact=Nr,W.b2EdgeAndCircleContact=kr,W.b2EdgeAndPolygonContact=zr,W.b2ChainAndCircleContact=Gr,W.b2ChainAndPolygonContact=Ur,W.b2Jacobian=t,W.b2JointEdge=On,W.b2JointDef=hn,W.b2Joint=Ln,W.b2AreaJointDef=Nn,W.b2AreaJoint=kn,W.b2DistanceJointDef=Fn,W.b2DistanceJoint=Vn,W.b2FrictionJointDef=zn,W.b2FrictionJoint=Gn,W.b2GearJointDef=Un,W.b2GearJoint=jn,W.b2MotorJointDef=Wn,W.b2MotorJoint=Hn,W.b2MouseJointDef=Xn,W.b2MouseJoint=Yn,W.b2PrismaticJointDef=qn,W.b2PrismaticJoint=Jn,W.b2_minPulleyLength=2,W.b2PulleyJointDef=Zn,W.b2PulleyJoint=Kn,W.b2RevoluteJointDef=Qn,W.b2RevoluteJoint=$n,W.b2RopeJointDef=tr,W.b2RopeJoint=er,W.b2WeldJointDef=ir,W.b2WeldJoint=nr,W.b2WheelJointDef=rr,W.b2WheelJoint=sr,W.b2ControllerEdge=ma,W.b2Controller=ya,W.b2BuoyancyController=ga,W.b2ConstantAccelController=va,W.b2ConstantForceController=ba,W.b2GravityController=xa,W.b2TensorDampingController=Aa,W.b2ParticleDef=Rs,W.b2CalculateParticleIterations=Os,W.b2ParticleHandle=Ls,W.b2ParticleGroupDef=Vs,W.b2ParticleGroup=Ns,W.b2GrowableBuffer=$s,W.b2FixtureParticleQueryCallback=ta,W.b2ParticleContact=ea,W.b2ParticleBodyContact=ia,W.b2ParticlePair=na,W.b2ParticleTriad=ra,W.b2ParticleSystemDef=sa,W.b2RopeDef=ca,W.b2Rope=Ca,Object.defineProperty(W,"__esModule",{value:!0})},"object"==typeof i&&void 0!==e?n(i):"function"==typeof define&&define.amd?define(["exports"],n):n((void 0).box2d={})},{}],427:[function(t,e,i){"use strict";var n="undefined"==typeof window?global:window;n.cc=n.cc||{},cc.internal=cc.internal||{},t("./predefine"),t("./polyfill/string"),t("./polyfill/misc"),t("./polyfill/array"),t("./polyfill/object"),t("./polyfill/array-buffer"),t("./polyfill/number"),t("./polyfill/typescript"),t("./cocos2d/core/predefine"),t("./cocos2d"),t("./extends"),e.exports=n.cc},{"./cocos2d":343,"./cocos2d/core/predefine":255,"./extends":402,"./package":void 0,"./polyfill/array":429,"./polyfill/array-buffer":428,"./polyfill/misc":430,"./polyfill/number":431,"./polyfill/object":432,"./polyfill/string":433,"./polyfill/typescript":434,"./predefine":435}],428:[function(t,e,i){"use strict";var n;ArrayBuffer.isView||(n=Object.getPrototypeOf(Int8Array),ArrayBuffer.isView="function"==typeof n?function(t){return t instanceof n}:function(t){if("object"!=typeof t)return!1;t=t.constructor;return t===Float32Array||t===Uint8Array||t===Uint32Array||t===Int8Array})},{}],429:[function(t,e,i){"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.find||(Array.prototype.find=function(t){for(var e=this.length,i=0;i<e;i++){var n=this[i];if(t.call(this,n,i,this))return n}}),Array.prototype.includes||(Array.prototype.includes=function(t){return-1!==this.indexOf(t)})},{}],430:[function(t,e,i){"use strict";var n,r;Math.sign||(Math.sign=function(t){return 0==(t=+t)||isNaN(t)?t:0<t?1:-1}),Math.log2||(Math.log2=function(t){return Math.log(t)*Math.LOG2E}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),console.time||(n=window.performance||Date,r=Object.create(null),console.time=function(t){r[t]=n.now()},console.timeEnd=function(t){var e=r[t],e=n.now()-e;console.log(t+": "+e+"ms")})},{}],431:[function(t,e,i){"use strict";Number.parseFloat=Number.parseFloat||parseFloat,Number.parseInt=Number.parseInt||parseInt},{}],432:[function(t,e,i){"use strict";Object.assign||(Object.assign=function(t,e){return cc.js.mixin(t,e)}),Object.getOwnPropertyDescriptors||(Object.getOwnPropertyDescriptors=function(t){var e={},i=Object.getOwnPropertyNames(t);Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t)));for(var n=0;n<i.length;++n){var r=i[n];e[r]=Object.getOwnPropertyDescriptor(t,r)}return e})},{}],433:[function(t,e,i){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.lastIndexOf(t,e=e||0)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){(void 0===e||e>this.length)&&(e=this.length),e-=t.length;t=this.indexOf(t,e);return-1!==t&&t===e}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")})},{}],434:[function(t,e,i){"use strict";var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};window.__extends=function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},window.__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},window.__rest=function(t,e){var i={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&(i[r[n]]=t[r[n]]);return i},window.__decorate=function(t,e,i,n){var r,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;0<=o;o--)(r=t[o])&&(a=(s<3?r(a):3<s?r(e,i,a):r(e,i))||a);return 3<s&&a&&Object.defineProperty(e,i,a),a},window.__param=function(i,n){return function(t,e){n(t,e,i)}},window.__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},window.__awaiter=function(s,a,o,l){return new(o=o||Promise)(function(t,e){function i(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new o(function(t){t(e.value)}).then(i,n)}r((l=l.apply(s,a||[])).next())})},window.__generator=function(n,r){var s,a,o,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(s)throw new TypeError("Generator is already executing.");for(;l;)try{if(s=1,a&&(o=2&e[0]?a.return:e[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,e[1])).done)return o;switch(a=0,(e=o?[2&e[0],o.value]:e)[0]){case 0:case 1:o=e;break;case 4:return l.label++,{value:e[1],done:!1};case 5:l.label++,a=e[1],e=[0];continue;case 7:e=l.ops.pop(),l.trys.pop();continue;default:if(!(o=0<(o=l.trys).length&&o[o.length-1])&&(6===e[0]||2===e[0])){l=0;continue}if(3===e[0]&&(!o||e[1]>o[0]&&e[1]<o[3])){l.label=e[1];break}if(6===e[0]&&l.label<o[1]){l.label=o[1],o=e;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(e);break}o[2]&&l.ops.pop(),l.trys.pop();continue}e=r.call(n,l)}catch(t){e=[6,t],a=0}finally{s=o=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},window.__exportStar=function(t,e){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])},window.__values=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return{value:(t=t&&i>=t.length?void 0:t)&&t[i++],done:!t}}}},window.__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(n=s.next()).done;)a.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return a},window.__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},window.__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},window.__asyncGenerator=function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),s=[],a={};return n("next"),n("throw"),n("return"),a[Symbol.asyncIterator]=function(){return this},a;function n(n){r[n]&&(a[n]=function(i){return new Promise(function(t,e){1<s.push([n,i,t,e])||o(n,i)})})}function o(t,e){try{(i=r[t](e)).value instanceof __await?Promise.resolve(i.value.v).then(l,h):c(s[0][2],i)}catch(t){c(s[0][3],t)}var i}function l(t){o("next",t)}function h(t){o("throw",t)}function c(t,e){t(e),s.shift(),s.length&&o(s[0][0],s[0][1])}},window.__asyncDelegator=function(n){var r,t={};return e("next"),e("throw",function(t){throw t}),e("return"),t[Symbol.iterator]=function(){return this},t;function e(e,i){t[e]=n[e]?function(t){return(r=!r)?{value:__await(n[e](t)),done:"return"===e}:i?i(t):t}:i}},window.__asyncValues=function(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=a[Symbol.asyncIterator];return e?e.call(a):(a="function"==typeof __values?__values(a):a[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=a[s]&&function(r){return new Promise(function(t,e){var i,n;i=t,t=e,n=(r=a[s](r)).done,e=r.value,Promise.resolve(e).then(function(t){i({value:t,done:n})},t)})}}},window.__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},window.__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e},window.__importDefault=function(t){return t&&t.__esModule?t:{default:t}}},{}],435:[function(t,e,i){"use strict";var n="undefined"==typeof window?global:window;function r(e,i){void 0===n[e]&&Object.defineProperty(n,e,{get:function(){var t;return"CC_WECHATGAMESUB"===e?t="cc.sys.platform === cc.sys.WECHAT_GAME_SUB":"CC_WECHATGAME"===e?t="cc.sys.platform === cc.sys.WECHAT_GAME":"CC_QQPLAY"===e&&(t="cc.sys.platform === cc.sys.QQ_PLAY"),cc.warnID(1400,e,t),i}})}function s(t){return"object"==typeof n[t]}o=!(a="CC_BUILD"),void 0===n[a]&&(n[a]=o),n.CC_BUILD=!0,n.CC_DEV=!1,n.CC_DEBUG=!1,n.CC_JSB=!1,n.CC_NATIVERENDERER=!1,n.CC_SUPPORT_JIT=!0,n.CC_PHYSICS_BUILTIN=!1,n.CC_PHYSICS_CANNON=!0,n.CC_EDITOR=!1,n.CC_PREVIEW=!1,n.CC_TEST=!1,n.CC_RUNTIME=!1,n.CC_JSB=!1;var a=!(!s("wx")||!wx.getSharedCanvas),o=!(!s("wx")||!wx.getSystemInfoSync&&!wx.getSharedCanvas),l=s("bk");r("CC_WECHATGAMESUB",a),r("CC_WECHATGAME",o),r("CC_QQPLAY",l),n.CocosEngine=cc.ENGINE_VERSION="2.3.4"},{}]},{},[427]);</script><script>var isRuntime;window.boot=function(){var s=window._CCSettings;if(window._CCSettings=void 0,!s.debug){var e,r=s.uuids,c=s.rawAssets,i=s.assetTypes,t=s.rawAssets={};for(e in c){var o,n=c[e],a=t[e]={};for(o in n){var u=n[o],d=u[1];"number"==typeof d&&(u[1]=i[d]),a[r[o]||o]=u}}for(var l=s.scenes,g=0;g<l.length;++g){var b=l[g];"number"==typeof b.uuid&&(b.uuid=r[b.uuid])}var p,C=s.packedAssets;for(p in C)for(var y=C[p],m=0;m<y.length;++m)"number"==typeof y[m]&&(y[m]=r[y[m]]);var w,A=s.subpackages;for(w in A){var f=A[w].uuids;if(f)for(var v=0,N=f.length;v<N;v++)"number"==typeof f[v]&&(f[v]=r[f[v]])}}var _=s.jsList,_={id:"GameCanvas",scenes:s.scenes,debugMode:s.debug?cc.debug.DebugMode.INFO:cc.debug.DebugMode.ERROR,showFPS:s.debug,frameRate:60,jsList:_,groupList:s.groupList,collisionMatrix:s.collisionMatrix};cc.AssetLibrary.init({libraryPath:"res/import",rawAssetsBase:"res/raw-",rawAssets:s.rawAssets,packedAssets:s.packedAssets,md5AssetsMap:s.md5AssetsMap,subpackages:s.subpackages}),cc.game.run(_,function(){var e,c;cc.loader.downloader._subpackages=s.subpackages,cc.view.enableRetina(!0),cc.view.resizeWithBrowserSize(!0),cc.sys.isBrowser&&(e=document.getElementById("splash"),c=e.querySelector(".progress-bar span"),cc.loader.onProgress=function(e,s,r){e=100*e/s;c&&(c.style.width=e.toFixed(2)+"%")},e.style.display="block",c.style.width="0%",cc.director.once(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){e.style.display="none"})),cc.sys.isMobile&&("landscape"===s.orientation?cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE):"portrait"===s.orientation&&cc.view.setOrientation(cc.macro.ORIENTATION_PORTRAIT)),cc.sys.isBrowser&&cc.sys.os===cc.sys.OS_ANDROID&&(cc.macro.DOWNLOAD_MAX_CONCURRENT=2),function s(r){cc.director.loadScene(r,function(e){e?CC_BUILD&&setTimeout(function(){s(r)},1e3):(cc.sys.isBrowser&&(document.getElementById("GameCanvas").style.visibility="",(e=document.getElementById("GameDiv"))&&(e.style.backgroundImage="")),cc.loader.onProgress=null,console.log("Success to load scene: "+r))})}(s.launchScene)})},window.jsb&&((isRuntime="function"==typeof loadRuntime)?(require("src/settings.js"),require("src/cocos2d-runtime.js"),(CC_PHYSICS_BUILTIN||CC_PHYSICS_CANNON)&&require("src/physics.js"),require("jsb-adapter/engine/index.js")):(require("src/settings.js"),require("src/cocos2d-jsb.js"),(CC_PHYSICS_BUILTIN||CC_PHYSICS_CANNON)&&require("src/physics.js"),require("jsb-adapter/jsb-engine.js")),cc.macro.CLEANUP_IMAGE_CACHE=!0,window.boot());</script><script>window._CCSettings={platform:"web-mobile",groupList:["default"],collisionMatrix:[[!0]],rawAssets:{assets:{},internal:{1:["materials/builtin-3d-particle.mtl",1],2:["effects/builtin-3d-particle.effect",0],3:["materials/builtin-unlit.mtl",1],4:["effects/builtin-unlit.effect",0],5:["effects/builtin-2d-gray-sprite.effect",0],6:["materials/builtin-2d-gray-sprite.mtl",1],7:["effects/builtin-3d-trail.effect",0],8:["materials/builtin-3d-trail.mtl",1],9:["effects/builtin-clear-stencil.effect",0],10:["materials/builtin-clear-stencil.mtl",1],11:["effects/builtin-2d-spine.effect",0],12:["materials/builtin-2d-spine.mtl",1],"28dPjdQWxEQIG3VVl1Qm6T":["effects/builtin-2d-sprite.effect",0],"6fgBCSDDdPMInvyNlggls2":["materials/builtin-2d-base.mtl",1],"ecpdLyjvZBwrvm+cedCcQy":["materials/builtin-2d-sprite.mtl",1]}},assetTypes:["cc.EffectAsset","cc.Material"],launchScene:"db://assets/Scene/helloworld.fire",scenes:[{url:"db://assets/Scene/helloworld.fire",uuid:0}],packedAssets:{"03ab6c522":["02delMVqdBD70a/HSD99FK","60AwGqM1dKELCGhPAR+jK6","6aoKpq6+5BVaCIpoemqt7E","71VhFCTINJM6/Ky3oX9nBT","a8Anh32NZGRZegUtSgEj26","b4P/PCArtIdIH38t6mlw8Y","e8Ueib+qJEhL6mXAHdnwbi"],"03f133834":["29FYIk+N1GYaeWH/q1NxQO",0,"31vIlawANFZqnzLlSuHBfc","41D7kWhyFGY7q4NDlzkazn","e97GVMl6JHh5Ml5qEDdSGa","f0BIwQ8D5Ml7nTNQbh1YlS"],"0771a325d":[1,2],"079499991":[3,4],"07ce7530a":[5,6],"0a5cba09d":[7,8],"0d669730c":[9,10],"0e4bc3b03":[11,12]},md5AssetsMap:{},orientation:"",debug:!1,subpackages:{},uuids:["2dL3kvpAxJu6GJ7RdqJG5J","43L6CczwNM/6GGmCYEQIoH","82migssElAGb04Ws6NimQX","2aKWBXJHxKHLvrBUi2yYZQ","6dkeWRTOBGXICfYQ7JUBnG","14TDKXr2NJ6LjvHPops74o","3ae7efMv1CLq2ilvUY/tQi","2afAA24LNP4YmYiaVLiivs","46bU+b5fROqIXVPG6aZWWK","c0BAyVxX9JzZy8EjFrc9DU","cffgu4qBxEqa150o1DmRAy","0ek66qC1NOQLjgYmi04HvX","7a/QZLET9IDreTiBfRn2PD"]};</script><script>window.__require=function n(c,i,l){function p(e,t){if(!i[e]){if(!c[e]){var o=(o=e.split("/"))[o.length-1];if(!c[o]){var r="function"==typeof __require&&__require;if(!t&&r)return r(o,!0);if(u)return u(o,!0);throw new Error("Cannot find module '"+e+"'")}e=o}t=i[e]={exports:{}};c[e][0].call(t.exports,function(t){return p(c[e][1][t]||t)},t,t.exports,n,c,i,l)}return i[e].exports}for(var u="function"==typeof __require&&__require,t=0;t<l.length;t++)p(l[t]);return p}({CTA:[function(t,e,o){"use strict";cc._RF.push(e,"022bdTiycxNbptQlUdWs387","CTA");var r,n,e=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),c=this&&this.__decorate||function(t,e,o,r){var n,c=arguments.length,i=c<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,r);else for(var l=t.length-1;0<=l;l--)(n=t[l])&&(i=(c<3?n(i):3<c?n(e,o,i):n(e,o))||i);return 3<c&&i&&Object.defineProperty(e,o,i),i},i=(Object.defineProperty(o,"__esModule",{value:!0}),cc._decorator),l=i.ccclass,i=(i.property,n=cc.Component,e(p,n),p.prototype.start=function(){Cocos2Playable.gameReady()},p.prototype.complete=function(){Cocos2Playable.gameComplete()},p.prototype.CTA=function(){Cocos2Playable.callToAction()},c([l],p));function p(){return null!==n&&n.apply(this,arguments)||this}o.default=i,cc._RF.pop()},{}],Cocos2Playable:[function(t,e,o){"use strict";cc._RF.push(e,"a82624V3OtLjpsI/tfuhVeE","Cocos2Playable"),cc._RF.pop()},{}],Helloworld:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","Helloworld");var r,n,e=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),c=this&&this.__decorate||function(t,e,o,r){var n,c=arguments.length,i=c<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,r);else for(var l=t.length-1;0<=l;l--)(n=t[l])&&(i=(c<3?n(i):3<c?n(e,o,i):n(e,o))||i);return 3<c&&i&&Object.defineProperty(e,o,i),i},i=(Object.defineProperty(o,"__esModule",{value:!0}),cc._decorator),l=i.ccclass,i=i.property,e=(n=cc.Component,e(p,n),p.prototype.start=function(){this.label.string=this.text},c([i(cc.Label)],p.prototype,"label",void 0),c([i],p.prototype,"text",void 0),c([l],p));function p(){var t=null!==n&&n.apply(this,arguments)||this;return t.label=null,t.text="hello",t}o.default=e,cc._RF.pop()},{}]},{},["CTA","Helloworld","Cocos2Playable"]);</script><script>function b64ToUint6(n){return 64<n&&n<91?n-65:96<n&&n<123?n-71:47<n&&n<58?n+4:43===n?62:47===n?63:0}function base64DecToArr(n,e){for(var r,a,o=n.replace(/[^A-Za-z0-9+/]/g,""),u=o.length,i=e?Math.ceil((3*u+1>>>2)/e)*e:3*u+1>>>2,l=new Uint8Array(i),t=0,c=0,s=0;s<u;s++)if(a=3&s,t|=b64ToUint6(o.charCodeAt(s))<<18-6*a,3==a||u-s==1){for(r=0;r<3&&c<i;r++,c++)l[c]=t>>>(16>>>r&24)&255;t=0}return l}function setTimeCallBack(n,e){setTimeout(function(){e(null,n)},10)}cc.loader.addDownloadHandlers({json:function(n,e){e(null,window.res[n.url])},plist:function(n,e){e(null,window.res[n.url])},bin:function(n,e){e(null,base64DecToArr(window.res[n.url],2))},png:function(n,e){var r=new Image;r.src="data:image/png;base64,"+window.res[n.url],e(null,r)},jpg:function(n,e){var r=new Image;r.src="data:image/jpeg;base64,"+window.res[n.url],e(null,r)},mtl:function(n,e){var r=new Image;r.src="data:image/mtl;base64,"+window.res[n.url],setTimeCallBack(r,e)},webp:function(n,e){var r=new Image;r.src="data:image/webp;base64,"+window.res[n.url],e(null,r)},mp3:function(n,e){cc.sys.__audioSupport.context.decodeAudioData(base64DecToArr(window.res[n.url]).buffer,function(n){e(null,n)},function(n){e(new Error("mp3-res-fail"),null)})},wav:function(n,e){cc.sys.__audioSupport.context.decodeAudioData(base64DecToArr(window.res[n.url]).buffer,function(n){e(null,n)},function(n){e(new Error("wav-res-fail"),null)})}});</script><script>var game_entrance=!1;function viewableChangeHandler(e){e&&0==game_entrance&&(game_entrance=!0,window.boot())}function onSdkReady(){mraid.addEventListener("viewableChange",viewableChangeHandler),mraid.isViewable()&&0==game_entrance&&(game_entrance=!0,window.boot())}"loading"===mraid.getState()?mraid.addEventListener("ready",onSdkReady):onSdkReady();</script></body></html>